# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make clean  - removes all files generated by make.

TARGET1 = ml_main
TARGET2 = ml_main_fref

# Where to find user code.
USER_DIR = .

CPPFLAGS += -isystem $(GTEST_DIR)/include -isystem $(GMOCK_DIR)/include 

# CXXFLAGS += -std=c++11 -g -Wall -Wextra -pthread -D_GLIBCXX_DEBUG
CXXFLAGS += -std=c++11 -g -Wall -Wextra -pthread -D_GLIBCXX_DEBUG

TESTS = ex_data_out ex_func_out 

# House-keeping build targets.
all : $(TESTS)

clean :
	rm -f $(TESTS) *.a *.o

#
$(TARGET1).o : $(TARGET1).c
	gcc -g -fpic -c $(TARGET1).c -o $(TARGET1).o

ex_data_out : $(TARGET1).o driver.c
#	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -lpthread $^ -o $@
	gcc -g -std=c99 -shared $(TARGET1).o -o libdata.so
	gcc -g -std=c99 driver.c libdata.so -o $@

#
$(TARGET2).o : $(TARGET2).c
	gcc -g -fpic -c $(TARGET2).c -o $(TARGET2).o

ex_func_out : $(TARGET2).o driver.c
	gcc -g -std=c99 -shared $(TARGET2).o -o libfunc.so
	gcc -g -std=c99 driver.c libfunc.so -o $@

