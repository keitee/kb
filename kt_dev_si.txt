*kt_dev_si*                                                                tw=101

kt.dev.si

/^[#=]{
Use #{ for a group and ={ for a item

|kt_dev_si_0001| si-pi-dirs
|kt_dev_si_0001| si-pi-snug-mac
|kt_dev_si_0001| si-pi si-snug
|kt_dev_si_0001| si-pi-signed image-version
|kt_dev_si_0001| si-pi-git-logs
|kt_dev_si_0001| si-pi-deploy
|kt_dev_si_0001| si-pi-py
|kt_dev_si_0001| si-pi-modified
|kt_dev_si_0001| si-pi-flash
|kt_dev_si_0001| si-pi-upload
|kt_dev_si_0001| si-pi-upload-log
|kt_dev_si_0001| si-pi-dropbox-upgrade

|kt_dev_si_0002| si-vstb

|kt_dev_si_0002| si-jabber
|kt_dev_si_0002| si-links
|kt_dev_si_0002| si-feature-team
|kt_dev_si_0002| si-box
|kt_dev_si_0002| si-box-sceret-screen
|kt_dev_si_0002| si-box-mount
|kt_dev_si_0002| si-boot-start-mw
|kt_dev_si_0002| si-boot-pwm
|kt_dev_si_0002| si-bootlog
|kt_dev_si_0001| si-httpsend
|kt_dev_si_0002| si-git
|kt_dev_si_0002| si-build-flist
|kt_dev_si_0002| si-build-server
|kt_dev_si_0002| si-build-command
|kt_dev_si_0002| si-core
|kt_dev_si_0002| si-build-baseline
|kt_dev_si_0002| si-build-artifactory
|kt_dev_si_0002| si-build-errors
|kt_dev_si_0002| si-build-main
|kt_dev_si_0002| si-build-make-image
|kt_dev_si_0002| si-build-make-image-external-toolchain
|kt_dev_si_0002| si-build-map-file
|kt_dev_si_0002| si-build-jpa
|kt_dev_si_0002| si-build-spk si-build-driver
|kt_dev_si_0002| si-theyard
|kt_dev_si_0002| si-sh-check-log
|kt_dev_si_0002| si-sh-check-log-mc
|kt_dev_si_0002| si-sh-check-log-auto
|kt_dev_si_0002| si-sh-check-back
|kt_dev_si_0002| si-mysql
|kt_dev_si_0002| si-log-parser
|kt_dev_si_0002| si-sh-log-parser-entry
|kt_dev_si_0002| si-sh-log-parser-mine
|kt_dev_si_0002| si-sh-to-dates si-keycodes
|kt_dev_si_0002| si-sh-alog
|kt_dev_si_0002| si-sh-list-log
|kt_dev_si_0002| si-sh-convert-logs
|kt_dev_si_0002| si-sh-wombat
|kt_dev_si_0002| si-flipper si-manatee
|kt_dev_si_0002| si-process-snug

|kt_dev_si_0002| si-splunk
|kt_dev_si_0002| si-tcpdump
|kt_dev_si_0002| si-dmalloc

|kt_dev_si_0002| si-q
|kt_dev_si_0002| si-q-comp-ui

|kt_dev_si_0003| si-log-commands
|kt_dev_si_0003| si-log-lines
|kt_dev_si_0003| si-log-lines-mil

|kt_dev_si_0001| comp-doc
|kt_dev_si_0002| comp-process
|kt_dev_si_0001| comp-filldisk
|kt_dev_si_0002| comp-smartctl comp-badblocks
|kt_dev_si_0001| comp-dms
|kt_dev_si_0001| comp-tree
|kt_dev_si_0001| comp-term
|kt_dev_si_0001| comp-cdi comp-ioctl
|kt_dev_si_0001| comp-build enable-comp-diag
|kt_dev_si_0001| comp-jpa
|kt_dev_si_0001| comp-jpa-print-systemstring
|kt_dev_si_0001| comp-jvm
|kt_dev_si_0001| comp-aem comp-iapp
|kt_dev_si_0001| comp-lae
|kt_dev_si_0001| comp-uam comp-ams
|kt_dev_si_0001| comp-gfx
|kt_dev_si_0001| comp-atm comp-adsmart
|kt_dev_si_0001| comp-bem
|kt_dev_si_0001| comp-ctm
|kt_dev_si_0001| comp-guide
|kt_dev_si_0001| comp-fem
|kt_dev_si_0001| comp-drv
|kt_dev_si_0001| comp-mcm
|kt_dev_si_0001| comp-mdm
|kt_dev_si_0001| comp-memman
|kt_dev_si_0001| comp-membuster
|kt_dev_si_0001| comp-memprof
|kt_dev_si_0001| comp-timedoctor
|kt_dev_si_0001| comp-ofs
|kt_dev_si_0001| comp-mfs
|kt_dev_si_0001| comp-msm
|kt_dev_si_0001| comp-rmf
|kt_dev_si_0001| comp-rmf-conclict-disk-quota
|kt_dev_si_0001| comp-rmf-conclict-disk-full
|kt_dev_si_0001| comp-rmf-conclict-tune
|kt_dev_si_0001| comp-vrm
|kt_dev_si_0001| comp-diag
|kt_dev_si_0001| comp-diag-cli
|kt_dev_si_0001| comp-mil
|kt_dev_si_0001| comp-ncm
|kt_dev_si_0001| comp-dhcp
|kt_dev_si_0001| comp-sbm
|kt_dev_si_0001| comp-scm
|kt_dev_si_0001| comp-ssm
|kt_dev_si_0001| comp-upnp
|kt_dev_si_0001| comp-sfm
|kt_dev_si_0001| comp-sim
|kt_dev_si_0001| comp-spm
|kt_dev_si_0001| comp-power comp-standby
|kt_dev_si_0001| comp-vgc
|kt_dev_si_0001| comp-srm comp-pvod
|kt_dev_si_0001| comp-pcat
|kt_dev_si_0001| comp-pcat-dbengine
|kt_dev_si_0001| comp-fdm
|kt_dev_si_0001| comp-pshed
|kt_dev_si_0001| comp-pdm comp-storage
|kt_dev_si_0001| comp-disk-check
|kt_dev_si_0001| comp-player
|kt_dev_si_0001| comp-sharedplanner
|kt_dev_si_0001| comp-planner
|kt_dev_si_0001| comp-prefs
|kt_dev_si_0001| comp-systemobject
|kt_dev_si_0001| comp-systemutil
|kt_dev_si_0001| comp-systemalarm
|kt_dev_si_0001| comp-systemtime
|kt_dev_si_0001| comp-systemcommon comp-systemexception
|kt_dev_si_0001| comp-systemlocator
|kt_dev_si_0001| comp-systemipc
|kt_dev_si_0001| comp-sysinit
|kt_dev_si_0001| comp-wlm
|kt_dev_si_0001| comp-ca
|kt_dev_si_0001| comp-ca-vgv
|kt_dev_si_0001| comp-ca-camm
|kt_dev_si_0001| comp-xtvfs
|kt_dev_si_0001| comp-xtvfs-tool
|kt_dev_si_0001| comp-nvram
|kt_dev_si_0001| comp-helper
|kt_dev_si_0001| comp-app
|kt_dev_si_0001| comp-app-affirm-runner
|kt_dev_si_0001| comp-app-analytics
|kt_dev_si_0001| comp-dpl comp-pdl
|kt_dev_si_0001| comp-dpl-auto-play
|kt_dev_si_0001| comp-atg comp-oigc comp-pdl
|kt_dev_si_0001| comp-http comp-ctm comp-pdl
|kt_dev_si_0001| comp-update


# ============================================================================
#{
={============================================================================
|kt_dev_si_0001| si-pi-dirs

// git repo. modified to support mac list
drwxr-xr-x  5 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-for-support-mac/

// git repo. the latest from git repo
// drwxr-xr-x  5 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-git/
// replaced to
kyoupark@kit-debian64:/home/kyoupark/si/new-pi/snugupdate-v2-snugberrypi

// to use different dropbox folder which means different link
// this is one actually used for testing and deploying on pi
drwxr-xr-x  4 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-modified/

// copy of home dir from the pi
drwxr-xr-x  3 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-org/si-pi-from-box

// since packing update uses dropbox rather then using git, need to prepare it
// seperately as a zip file. this is a directory used to do that.
si-pi-prepare-deploy-roll

// necessary packages
drwxr-xr-x  4 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-packages-to-install/

// to experiment image files
drwxrwxrwx  3 kyoupark kyoupark  4096 Jun 12 13:32 si-pi-images-to-use/

https://www.dropbox.com/sh/seoj7ol1u9wxrex/AADeMGLzF6Tl4ZKHyclLWcQxa?dl=0


<pi-scp> copy-from-pi
scp pi@10.209.60.102:/home/pi/snugupdate-v2-snugberrypi/stblog.sh .

// copy-from-server
// /home/kyoupark/si/new-pi/snugupdate-v2-snugberrypi/snugupdate-v2-python
scp libraries/utilities.py pi@10.209.60.106:/home/pi/snugupdate-v2-snugberrypi/snugupdate-v2-python/libraries/utilities.py


={============================================================================
|kt_dev_si_0001| si-pi-snug-mac

// snug pi 783e533494c2
mysql --batch --table -u root uploads -e "select version, upload_time, filename, pcat_status from upload where mac='783e533494c2' order by upload_time desc limit 10"

// b8-27-eb-89-8d-12, 0019fb63ea04, SYSF85.03.00, Martin Watson (martinwa)
mysql --batch --table -u root uploads -e "select version, upload_time, filename, pcat_status from upload where mac='0019fb63ea04' order by upload_time desc limit 10"


783e533494e9, SYSF85.19.02, SNUG rack 2(kyoupark)

pi mac, box max,

b8:27:eb:11:5f:d6, 783e533494c2, pi 1st board mac for kit
b8-27-eb-1a-a7-5e, 783e533494c2, pi 2dn board mac for kit (kyoupark)


b8-27-eb-19-9c-e6, 0019fb0db2a7, SYSF85.03.00, Alan Mardell (amardell)
b8-27-eb-65-5e-f3, 0019fbd18cd8, SYSF85.03.00, Graeme Waggott (grwaggot)
b8-27-eb-2d-27-4c, 783e533494ef, SYSF85.03.00, Dave Faulkner (dfaulkne)
b8-27-eb-2d-27-4c, 0019fb0bb35c, SYSF85.03.00, Dave Faulkner (dfaulkne)
b8-27-eb-4a-e2-48,
b8-27-eb-29-7a-f2, 0019fb0fbeae, SYSF85.03.00, Natasha White (natwhite)
b8-27-eb-51-00-51, 0019fb0bae0f, ??, Chris Tomlin
b8-27-eb-89-8d-12, 0019fb63ea04, SYSF85.03.00, Martin Watson (martinwa)
b8-27-eb-89-8d-12, 0019fb54aa1f, SYSF85.03.00, Martin Watson (martinwa)
b8-27-eb-98-7f-fd, 0019fb603c3f, SYSF85.03.00, Mike Park (mikepa)
b8-27-eb-c4-9b-9f,
b8-27-eb-c5-5a-45, 0019fb63ea0a, SYSF85.03.00, Isaac Norman (inorman)
b8-27-eb-c5-5a-45, 0019fb0f3d4e, SYSF85.03.00, Isaac Norman (inorman)
b8-27-eb-d5-04-6e, 0019fb6384f6, ??, Edward Hadley-Clifton
b8-27-eb-7c-4e-75, 0019fb0f4454, , Lee Edwards
b8-27-eb-7c-4e-75, 0019fb603c26, , Lee Edwards


0019fbd18cc3, SYSF85.03.00, Andy Haynes (andhayne)
0019fb2d3f66, SYSF85.03.00, Chris Bassett (chbasset)
0019fb0f3cf9, SYSF85.03.00, Chris Bassett (chbasset)
0019fb0badd0, SYSF85.03.00, Chin Li (chili1)
0019fb105f84, SYSF85.03.00, Edd Beale (ebeale)
0019fb0f7b1a, SYSF85.03.00, Elliott Lansdown-Bridge (elansdow)
0019fb0bcd65, SYSF85.03.00, Ian Bartlam (ibartlam)
0019fb63ea0f, SYSF85.03.00, Jonathan Watkins (jonwatki)
0019FB63ea4a, SYSF85.03.00, Steddy Smit (jsmit) <jsmit@cisco.com>
0019fb1a2bde, SYSF85.03.00, Karl Botragyi (kbotragy)
0019fb5ae2c6, SYSF85.03.00, Mike Park (mikepa)
0019fb603c5c, SYSF85.03.00, Mike Park (mikepa)
0019fb0bae07, SYSF85.03.00, Nigel Parsons (niparson)
0019fb63ea1b, SYSF85.03.00, Nigel Parsons (niparson)
0019fb1a2c21, SYSF85.03.00, Paul Riley (pariley)
0019fb0bac83, SYSF85.03.00, Paul Riley (pariley)
0019fb638532, SYSF85.03.00, Paul Riley (pariley)
0019fb0bae10, SYSF85.03.00, Rhys Parry (rhparry)
0019fb0bc80e, SYSF85.03.00, Richard Sargent (ricsarge)


={============================================================================
|kt_dev_si_0001| si-pi

<pi-install>
// Instructions to set up Pi
You also need PIP for installing python packages:
http://hetty.cisco.com/marvin/Snugupdate_python

http://hetty.cisco.com/fusionmadesimple/index.php/SnugberryPi

Photograph 2

1. Remove the Micro SD card from the Pi front slot [Refer Photograph 1] and
insert it into the SD to Micro SD card adapter provided with the Pi.[Refer
Photograph 2]

2. Insert the SD to Micro SD card adapter into the slot in your laptop/PC.

3. Format the SD card that is 4GB or larger as FAT32

4. Download the SD Association's Formatting Tool, from
https://www.sdcard.org/downloads/formatter_4/

note: have to use full format but not quick one.

5. Once the SD card is formatted, download the “snugupdater-software.rar” from
https://www.dropbox.com/s/wl1r3dci1znddm5/snugupdate-software.rar?dl=0

6. Extract the files contained in this zip file.

7. Copy the extracted files onto the SD card that you just formatted so that
these files are at the root directory of the SD card.

8. Insert the SD card into your Pi and connect the power supply.

9. Once the Pi boots up, it will automatically install the software. [If you
want to know what is happening you can connect a TV/Monitor to the Pi through
HDMI cable]


INSTRUCTIONS-README.txt

NOOBS INSTALLATION INSTRUCTIONS

1. Insert an SD card that is 4GB or greater in size into your computer.
2. Format the SD card using the platform-specific instructions below:
   a. Windows
      i. Download the SD Association's Formatting Tool from https://www.sdcard.org/downloads/formatter_4/eula_windows/
      ii. Install and run the Formatting Tool on your machine
      iii. Set "FORMAT SIZE ADJUSTMENT" option to "ON" in the "Options" menu
      iv. Check that the SD card you inserted matches the one selected by the Tool
      v. Click the "Format" button
   b. Mac
      i. Download the SD Association's Formatting Tool from https://www.sdcard.org/downloads/formatter_4/eula_mac/
      ii. Install and run the Formatting Tool on your machine
      iii. Select "Overwrite Format"
      iv. Check that the SD card you inserted matches the one selected by the Tool
      v. Click the "Format" button
   c. Linux
      i. We recommend using gparted (or the command line version parted)
      ii. Format the entire disk as FAT

3. Extract the files contained in this NOOBS zip file.

4. Copy the extracted files onto the SD card that you just formatted so that
this file is at the root directory of the SD card. Please note that in some
cases it may extract the files into a folder, if this is the case then please
copy across the files from inside the folder rather than the folder itself.

5. Insert the SD card into your Pi and connect the power supply.

Your Pi will now boot into NOOBS and should display a list of operating
systems that you can choose to install.

If your display remains blank, you should select the correct output mode for
your display by pressing one of the following number keys on your keyboard:

1. HDMI mode - this is the default display mode.
2. HDMI safe mode - select this mode if you are using the HDMI connector and cannot see anything on screen when the Pi has booted.
3. Composite PAL mode - select either this mode or composite NTSC mode if you are using the composite RCA video connector.
4. Composite NTSC mode

If you are still having difficulties after following these instructions, then
please visit the Raspberry Pi Forums ( http://www.raspberrypi.org/forums/ )
for support.

// uses two repos. one for pi code and the other for python code
// git clone http://gitlab.cisco.com/snug-si/snugupdate-v2-snugberrypi.git
// moved to new git server, https://wwwin-gitlab-sjc.cisco.com/snug-si

https://www.dropbox.com/s/wl1r3dci1znddm5/snugupdate-software.rar?dl=0


<pi-git>
https://wwwin-gitlab-sjc.cisco.com/snug-si
https://wwwin-gitlab-sjc.cisco.com/snug-si/snugupdate-v2-snugberrypi
https://wwwin-gitlab-sjc.cisco.com/snug-si/snugupdate-v2-python


<1>
git clone git@wwwin-gitlab-sjc.cisco.com:snug-si/snugupdate-v2-snugberrypi.git

-rwxr-xr-x  1 kyoupark ccusers  1260 Feb 23 11:18 autoupdate.sh*
drwxr-xr-x  8 kyoupark ccusers  4096 Feb 23 11:18 .git/
-rw-r--r--  1 kyoupark ccusers   128 Feb 23 11:18 .gitmodules
-rwxr-xr-x  1 kyoupark ccusers 20955 Feb 23 11:18 httpsend*
-rwxr-xr-x  1 kyoupark ccusers   227 Feb 23 11:18 mkrelease.sh*
-rwxr-xr-x  1 kyoupark ccusers   175 Feb 23 11:18 run_auto.sh*
-rwxr-xr-x  1 kyoupark ccusers   582 Feb 23 11:18 run.sh*

// the is emptry folder for python submodule
drwxr-xr-x  2 kyoupark ccusers  4096 Feb 23 11:18 snugupdate-v2-python/

-rwxr-xr-x  1 kyoupark ccusers  2360 Feb 23 11:18 stblog.sh*
-rwxr-xr-x  1 kyoupark ccusers  2337 Feb 23 11:18 upload_log.py*
-rwxr-xr-x  1 kyoupark ccusers     5 Feb 23 11:18 version.txt*
drwxr-xr-x  2 kyoupark ccusers  4096 Feb 23 11:18 www/

<2>
// since it will create snugupdate-v2-python which is submodule
// git clone http://gitlab.cisco.com/snug-si/snugupdate-v2-python.git 

git clone git@wwwin-gitlab-sjc.cisco.com:snug-si/snugupdate-v2-python.git 

drwxr-xr-x  8 kyoupark ccusers 4096 Feb 23 11:16 .git/
-rw-r--r--  1 kyoupark ccusers   27 Feb 23 11:16 .gitignore
drwxr-xr-x  2 kyoupark ccusers 4096 Feb 23 11:16 images/
drwxr-xr-x  2 kyoupark ccusers 4096 Feb 23 11:16 libraries/
-rw-r--r--  1 kyoupark ccusers  750 Feb 23 11:16 README
-rw-r--r--  1 kyoupark ccusers 3104 Feb 23 11:16 README.manual
drwxr-xr-x  2 kyoupark ccusers 4096 Feb 23 11:16 resources/
-rwxr-xr-x  1 kyoupark ccusers 3813 Feb 23 11:16 update.py*


<submodule-setting>
kyoupark@kit-debian64:~/si/new-pi/snugupdate-v2-snugberrypi$ cat .gitmodules
[submodule "snugupdate-v2-python"]
        path = snugupdate-v2-python
  url = git@wwwin-gitlab-sjc.cisco.com:snug-si/snugupdate-v2-python.git

git submodule sync

kyoupark@kit-debian64:~/si/new-pi/snugupdate-v2-snugberrypi$ cat .git/config
[submodule "snugupdate-v2-python"]
        url = git@wwwin-gitlab-sjc.cisco.com:snug-si/snugupdate-v2-python.git


<3>
git clone http://gitlab.cisco.com/snug-si/snugupdate-v2.git updater
# /home/kyoupark/si-pi/updater/src/update.c

Steddy Smit

High
1.	Targeted Builds.
2.	Allow updating any image.
3.	Protect/Encrypt Pi source code.

Medium
1.	Remote core dump.
2.	Reporting D12/SNUG issues from the Pi webpage.
3.	Email notifications about box updated, core dump found etc.
4.	Remote control of boxes for debugging. [Can include Reboot and Flashing Debug builds]
5.	Capture image from surface. [For eg OOSDs, by pressing 555]

Low
1.	Run Scripts.[Key presses captured and converted into script]
2.	Detect non SNUG image.
3.	Webpage layout.[Include Version updated, Force Core Dump button, Issue pre populate etc]


<special-image>
// note: do not work
// version of snug special image:
// R011.075.59.00U


<login>
http://<pi ip>

pi/pi


<pi-mac>
eth0      Link encap:Ethernet  HWaddr b8:27:eb:11:5f:d6, 10.209.60.102
eth0      Link encap:Ethernet  HWaddr b8:27:eb:1a:a7:5e
 

<gpg>
// windows version
http://hetty.cisco.com/marvin/SnugUpdate-v2

set PATH=%PATH%;"c:\Program Files (x86)\GNU\GnuPG\"
gpg --gen-key

Accept all the default values by pressing enter.

Export your public key to brian using
gpg --armor --output public.key --export <Your Email address>

C:\Users\kyoupark\AppData\Local\VirtualStore\Program Files (x86)\
GNU\GnuPG\public.key

Use usual file such as:
drx890.SYSF40.79.00.enc.snugupdate

Verify that you've picked the image you want and enter your passphrase for the
`decryption`. 

Hitting next will then run the update. The box will not reboot immediately -
It will wait until:

    It's in standby
    There's nothing recording now
    There's nothing recording in the next 30 minutes
    There's nothing from this box being played by Remote Planner boxes 

Note that it only runs these checks every 10 minutes, so the reboot time may
be a little unpredictable. 

mine is saved in and was shared to make snug image.
/home/kyoupark/git/kb/si/snug


<format>
http://hetty.cisco.com/marvin/SnugUpdateFileFormat


<version-on-box>
python 2.7.3


<required-package>
sudo easy_install pip
sudo pip install twisted
Installing /usr/local/lib/python2.7/dist-packages/z

sudo pip install dropbox


={============================================================================
|kt_dev_si_0001| si-pi-sh

pi@raspberrypi ~ $ ls -al /bin/sh /bin/bash /bin/dash
-rwxr-xr-x 1 root root 813992 Sep 25  2014 /bin/bash
-rwxr-xr-x 1 root root  88340 Mar 30  2012 /bin/dash
lrwxrwxrwx 1 root root      4 Jan  1  1970 /bin/sh -> dash


={============================================================================
|kt_dev_si_0001| si-pi-signed image-version si-boot-loader

# sign request
https://hudkinsmaster1.cisco.com:8443/view/_AutoSigning/job/AS20_RequestSigning_Darwin/177/
https://hudkinsmaster1.cisco.com:8443/view/_AutoSigning/job/AS20_RequestSigning_Darwin/177/console
21:27:52 sign_version/5364/flash.out.sky_trials_signed.mux_dr
21:27:52 sign_version/5364/APPLI_0.FLA_flash.out.sky_trials.etp_signed.bin
21:27:52 sign_version/5364/ethupdater.bin_signed.mux_dr


<si-serial-boot-loader>
http://hetty.cisco.com/fusionmadesimple/index.php/Flashing_Signed_Image

01 and 02 are the two flash banks. '-1-' means the image in that bank is
considered valid. 

'-2-' means it is invalid. The 182 and 183 are version numbers - the STB will
try to boot from the highest valid bank. 

The '03-1' means it is trying to boot from bank 1. If it has '03-0' it is
booting from bank 0. 

1.3.5
01-1-5364-0     # snug signed
02-1-5362-0     # snug singed
03-0            # boots from 0

1.3.5
01-1-65535-1    # not sung signed and usual build
02-1-5364-0     # snug signed
03-0


/home/si_logs/snuggles/incoming
-rw-r--r-- 1 snuggles snuggles 16611504 Dec 15 22:25 R000.040.73.00U_ams-drx890_APPLI_0.FLA_flash.out.sky_trials.etp_signed.bin
-rw-r--r-- 1 snuggles snuggles 16651200 Jan  5 12:23 R000.040.78.00U_ams-drx890_APPLI_0.FLA_flash.out.sky_trials.etp_signed.bin
-rw-r--r-- 1 snuggles snuggles 16628100 Jan 10 11:27 R000.040.79.00U_ams-drx890_APPLI_0.FLA_flash.out.sky_trials.etp_signed.bin

/home/si_logs/snuggles/outgoing
-rwxr-xr-x 1 snuggles snuggles  16722541 Dec 15 22:25 drx890.SYSF40.73.00.enc.snugupdate
-rwxr-xr-x 1 snuggles snuggles  16763040 Jan  5 12:24 drx890.SYSF40.78.00.enc.snugupdate
-rwxr-xr-x 1 snuggles snuggles  16740210 Jan 10 11:28 drx890.SYSF40.79.00.enc.snugupdate
-rwxr-xr-x 1 snuggles snuggles  16390145 Jan 12 10:43 drx890.SYSF84.64.00.enc.snugupdate

-rwxr--r--  1 kyoupark ccusers 16349360 Jan  6 13:17 APPLI_0.FLA_40.73.FLA*
-rwxr--r--  1 kyoupark ccusers 16722541 Jan  5 09:52 drx890.SYSF40.73.00.enc.snugupdate*
-rw-r--r--  1 kyoupark ccusers 16722379 Jan  6 13:28 drx890_SYSF40.73.00.gpg
-rw-r--r--  1 kyoupark ccusers 16611504 Jan  6 13:33 drx890_SYSF40.73.00.clear


={============================================================================
|kt_dev_si_0001| si-pi-git-logs

<1> supports grouping

* b44dc22 : (HEAD, to-support-group) tidy up codes (82 seconds ago) <Kit Park>
* b880aff : updates maclist to have all snug users as of now (2 weeks ago) <Kit Park>
* 7239c07 : converts fileformats to unix and adds supports of grouping (2 weeks ago) <Kit Park>
* 269a8c4 : (origin/master, origin/HEAD, master) Remove urllib warnings (10 months ago) <vijeta hegde>

kyoupark@kit-debian:~/si-pi/snugupdate-v2-python$ git diff --ignore-space-at-eol --stat master..HEAD
 libraries/dropbox_integration.py | 16 ++++++++++++++++
 libraries/stb.py                 | 36 ++++++++++++++++++++++++++++++++----
 libraries/stbimages.py           |  0
 libraries/update_engine.py       |  0
 libraries/update_engine_test.py  |  0
 libraries/webserver.py           |  0
 maclist.txt                      | 37 +++++++++++++++++++++++++++++++++++++
 update.py                        | 24 ++++++++++++++++--------
 8 files changed, 101 insertions(+), 12 deletions(-)


// note that python is submodule

// /home/kyoupark/si/new-pi/snugupdate-v2-snugberrypi
// * master

* 60efd72 : (HEAD, origin/master, origin/HEAD, master) Fix a bug which do not pick the current version of package (3 months ago) <Kit Park>
* 2623c23 : Add support to limit the size of log file and tidy up log message. (3 months ago) <Kit Park>
* 29cc714 : Add support to log uploads in the log. (4 months ago) <Kit Park>
* 086a1ad : Add support to log a mac of connected boxes in the log. (4 months ago) <Kit Park>
* a5c6464 : SI-11161: Fix to uploading a log to dropbox (5 months ago) <Kit Park>
*   4e5500a : Merge branch 'dropboxv2' into 'master' (5 months ago) <jsmit>
|\
| * c489dcb : (origin/dropboxv2) SI-11161: Migrate to dropbox v2 (5 months ago) <Kit Park>
| * 457af5b : SI-11161: Migrate to dropbox v2: Update submodule configuration (5 months ago) <Kit Park>
|/
* 6e9c79e : (tag: BEFORE_DAREN) support manatee build in searching stbs (10 months ago) <Kit Park>


// /home/kyoupark/si/new-pi/snugupdate-v2-snugberrypi/snugupdate-v2-python
// * master

* ed92ae2 : (HEAD, master) From: Rhys P <rhysp@gmail.com> (11 minutes ago) <Kit Park>
*   36374f1 : (origin/master, origin/HEAD) Merge branch 'dropboxv2' into 'master' (5 months ago) <jsmit>
|\
| * 10db0ce : (origin/dropboxv2) SI-11161: Migrate to dropbox v2 (5 months ago) <Kit Park>


git push
https://wwwin-gitlab-sjc.cisco.com/snug-si/snugupdate-v2-snugberrypi


={============================================================================
|kt_dev_si_0001| si-pi-deploy

<test-release-dropbox>
https://www.dropbox.com/home/snugberrypi/snugupdate-v2-snugberrypi-roll

files to be changed to use roll folder:

# when run this command on pi, gets html rather then actual file. why??

curl -L -o run_auto.sh https://www.dropbox.com/s/c0loawayjk13c09/run_auto.sh?dl=2
run_auto.h
curl -L -o autoupdate.sh https://www.dropbox.com/s/db0dqjvrfur0cbo/autoupdate.sh?dl=0
autoupdate.sh

# curl -L -o newversion.txt https://www.dropbox.com/s/aty3cz12cvs0xu4/version.txt?dl=1
curl -L -o pi_software.zip https://www.dropbox.com/sh/seoj7ol1u9wxrex/AADeMGLzF6Tl4ZKHyclLWcQxa?dl=1

# copy to pi
scp -r run_auto.sh autoupdate.sh pi@10.209.60.87:/home/pi/snugupdate-v2-snugberrypi

change version.txt on the pi.


<live-dropbox>
https://www.dropbox.com/home/snugberrypi/snugupdate-v2-snugberrypi

all links belows comes from this dropbox folder which has files on live. 


<pi-update-package>
pi@raspberrypi ~ $ crontab -l
00 02 * * * /home/pi/snugupdate-v2-snugberrypi/run_auto.sh


pi@raspberrypi ~/snugupdate-v2-snugberrypi $ more run_auto.sh
#!/bin/bash
sec=$(( $RANDOM % 900 ))
sleep $sec
curl -L -o autoupdate.sh https://www.dropbox.com/s/yo8uyu4q1pn6v1l/autoupdate.sh?dl=1
chmod 777 autoupdate.sh
./autoupdate.sh


<autoupdate>

note:
simply use `cp` and that's why local_settings.py which is not in repo remains
on pi over deploying.

// kyoupark@kit-debian:~/si-pi$ cat version.txt
// 1.10

pi@raspberrypi ~/snugupdate-v2-snugberrypi $ more autoupdate.sh
#!/bin/bash
FILE="version.txt"
while read line; do
cur_ver=`echo $line|awk '{print $1}'`
done <$FILE
echo "$(date)" > /home/pi/snugupdate-v2-snugberrypi/www/log

// *get-new-version* get version.txt from dropbox
curl -L -o newversion.txt https://www.dropbox.com/s/csty3cjjqtki4s2/version.txt?dl=1
if [ $? != 0 ]; then
    echo "Failed to download the Pi version file!" >> /home/pi/snugupdate-v2-snugberrypi/www/log
    exit 1
fi

FILE="newversion.txt"
while read line; do
new_ver=`echo $line|awk '{print $1}'`
done <$FILE
rm newversion.txt
cd /home/pi/snugupdate-v2-snugberrypi/snugupdate-v2-python

if test "$cur_ver" = "$new_ver";then
   echo "Pi has the latest version:$cur_ver Auto update not required" >> ../www/log
else
   echo "Current Version: $cur_ver Auto updating to New Version: $new_ver" >> ../www/log
   cd /home/pi/

   // *get-new-package* get snugupdate-v2-snugberrypi.zip
   curl -L -o pi_software.zip https://www.dropbox.com/sh/d806r7k415g3fkq/AACrX2dQYOWlPolWp0CV8wAUa?dl=1

   if [ $? != 0 ]; then
      echo "Failed to download the new Pi software!" >> ../www/log
      exit 1
   fi
   mkdir pi_software
   unzip pi_software.zip -d pi_software &>/dev/null
   cp -r /home/pi/pi_software/* /home/pi/snugupdate-v2-snugberrypi/
   rm -rf pi_software.zip
   rm -rf pi_software
   echo "Auto update done!!" >> /home/pi/snugupdate-v2-snugberrypi/www/log
fi


<zip>
snugupdate-v2-snugberrypi.zip

-rw-r--r--   1 kyoupark ccusers    1260 Jul 22  2015 autoupdate.sh
-rw-r--r--   1 kyoupark ccusers   20955 Jul  2  2015 httpsend
-rw-r--r--   1 kyoupark ccusers     227 Jul  2  2015 mkrelease.sh
-rw-r--r--   1 kyoupark ccusers     175 Jul  2  2015 run_auto.sh
-rw-r--r--   1 kyoupark ccusers     582 Jul 24  2015 run.sh
drwxr-xr-x   5 kyoupark ccusers    4096 Feb 23 11:14 snugupdate-v2-python/
-rw-rwx---+  1 nobody   ccusers 3555827 Feb 23 11:09 snugupdate-v2-snugberrypi.zip*
-rw-r--r--   1 kyoupark ccusers    2360 Jul  2  2015 stblog.sh
-rw-r--r--   1 kyoupark ccusers    2337 Jul  2  2015 upload_log.py
-rw-r--r--   1 kyoupark ccusers       5 Apr 27  2016 version.txt
drwxr-xr-x   2 kyoupark ccusers    4096 Feb 23 11:14 www/


={============================================================================
|kt_dev_si_0001| si-pi-py

<log-no-update>
Tue Dec  6 14:57:20 UTC 2016
Manually updating the box now
Deleting images and orphaned log upload files older than 10 days
Taking 120s to look for 99 STBs...
Found 1 STBs in 119s
  10.209.60.66 drx890 - R011.075.59.00U (4n7ol6k)

Trying to get new image from dropbox
Found 1 images, ignoring those matching 'Archived' filtering on 'drx890'
Downloading images/drx890.SYSF40.65.00.enc.snugupdate
Already exists
Found the following images:
drx890 : images/drx890.SYSF40.65.00.enc.snugupdate

Checking action for each STB...
  10.209.60.66 drx890 - R011.075.59.00U (4n7ol6k)
   - No need to upgrade

Extracting images...
File version: 1
Number of images: 1
Image version: 0
Baseline: SYSF40.65.00
Platform: drx890
Encrypted: 1
Encrypted for: keyholders@company.com
Found data length: 16707133
Writing file images/drx890.SYSF40.65.00.enc.snugupdate.gpg

Updating...

All done.  You stay classy now.


<log-with-update>
Tue Jan  3 15:35:10 UTC 2017
Manually updating the box now
Deleting images and orphaned log upload files older than 10 days
Taking 120s to look for 99 STBs...
Found 1 STBs in 119s
  10.209.60.36 drx890 - R000.040.73.00U (4ldzfno)

Trying to get new image from dropbox
Found 3 images, ignoring those matching 'Archived' filtering on 'drx890'
DEBUG: image: /snug full release/SNUG Staines/drx890.SYSF40.73.00.enc.snugupdate
Downloading images/drx890.SYSF40.73.00.enc.snugupdate
Already exists
DEBUG: imageGroup: ['drx890']
DEBUG: f: drx890.SYSF40.74.00.enc.snugupdate, match.group(type): match.group(version):
DEBUG: f: drx890.SYSF40.73.00.enc.snugupdate, match.group(type): match.group(version):
DEBUG: f: .gitignore, match.group(type): match.group(version):
Found the following images:
drx890 : images/drx890.SYSF40.74.00.enc.snugupdate

Checking action for each STB...
  10.209.60.36 drx890 - R000.040.73.00U (4ldzfno)
  DEBUG: self.info: drx890
 - upgrade to images/drx890.SYSF40.74.00.enc.snugupdate

DEBUG: action: yes
Extracting images...
File version: 1
Number of images: 1
Image version: 0
Baseline: SYSF40.73.00
Platform: drx890
Encrypted: 1
Encrypted for: keyholders@company.com
Found data length: 16722379
Writing file images/drx890.SYSF40.74.00.enc.snugupdate.gpg
DEBUG: cmd: gpg --batch --no-tty --passphrase-fd 0 --decrypt "images/drx890.SYSF40.74.00.enc.snugupdate.gpg"

Updating...
DEBUG: device:updateSTBs:performAction
Updating
  10.209.60.36 drx890 - R000.040.73.00U (4ldzfno)
Creating pi_addr file for log uploads
location = /mnt/nds/dev_6/part_0/FSN_DATA/PI_ADDR
Creating working dir
-sh-3.2# STEP_1_5
Downloading update utility resources/updater.ams890.tar

-sh-3.2# Connecting to 10.209.60.125:1024 (10.209.60.125:1024)

updater.tar            0% |                               |     0  --:--:-- ETA
updater.tar          100% |*******************************|   780k --:--:-- ETA
STEP_2
Extracting update utility

-sh-3.2# STEP_2_5
Download new SNUG image images/drx890.SYSF40.74.00.enc.snugupdate.gpg.clear

-sh-3.2# Connecting to 10.209.60.125:1024 (10.209.60.125:1024)

image.img              0% |                               |     0  --:--:-- ETA

image.img             60% |******************             |  9792k 00:00:00 ETA
image.img            100% |*******************************| 16222k 00:00:00 ETA
STEP_3
Updating...

-sh-3.2# SnugUpdate v2: Guard 1800 seconds, checking host localhost at 600 second intervals
Writing image.img to flash banks...

0 - 131072 written
0 - 262144 written
...
0 - 16515072 written

Moving to background...
STEP_4
Done

All done.  You stay classy now.


<local-settings>
From README

To use
======
1) Take a look at settings.py. If it all looks good, skip to step 3.

2) To override a setting, make a file called local_settings.py and
add your overrides in there. For example, if you have 2 set top boxes
at home, local_settings.py should look like this:

numSTBs = 2

3) Put your .snugupdate image files in the images folder.

4) Run this command to detect set top boxes on your network and
perform the update:

    python update.py


From REAEME.manual

Here is a worked example:

$ python snug_update_linux/extract_image.py sam-7401.SYSF62.04.enc.snugupdate
File version: 1
Number of images: 1
Image version: 2685599744
Baseline: SYSF62.04
Platform: sam-7401
Encrypted: 1
Encrypted for: keyholders@company.com
Found data length: 14739278
Writing file sam-7401_SYSF62.04.gpg

Now we have the encrypted image, decrypt it with gpg:

note: on pi and extract_image.py works only on linux but not windows.
$ sudo python ./libraries/extract_image.py ~/drx890.SYSF40.73.00.enc.snugupdate


$ gpg --decrypt sam-7401_SYSF62.04.gpg > sam-7401_SYSF62.04
You need a passphrase to unlock the secret key for
user: "Rob Fisher (Snugupdate key) <rfisher@ndsuk.com>"
2048-bit ELG-E key, ID 0337F932, created 2011-01-07 (main key ID 1A62845E)

gpg: encrypted with RSA key, ID 74EFA50A
...

Now copy the updater and image to your web server:

$ scp snug_update/SnugUpdate/SnugUpdate/Resources/updater_sam_7401 mywebserver:/var/www/snug/
$ scp sam-7401_SYSF62.04 mywebserver:/var/www/snug/


<si-pi-local-settings>

`settings.py`

try:
    from local_settings import *
    if verboseLogging:
      print 'Successfully imported local settings'


`local_settings.py` note: this is not in git repo.

pi@raspberrypi ~/snugupdate-v2-snugberrypi/snugupdate-v2-python $ cat local_settings.py
from libraries.utilities import get_ipv4_address

# GPG passphrase
gpgPassphrase = 'Zft4ngX4#_q5HvzELy9pnW#L-Sw=LnTgN$jkCgPPcyCrQrCuSQ78s=45uNujm*$Q'

# Don't ask whether to update or not assume this tool will do the correct thing!
acceptDefaultActions = True

# enable log uploading via a SnugberryPi
piLogUploading = True


*pi-update-image*
<cron-run>
pi@$ crontab -l
00 03 * * * /home/pi/snugupdate-v2-snugberrypi/run.sh

// www/index.php
// for "Force update on next run"
    if(isset($_GET['force']))
    {
        touch("force");
        file_put_contents("log", "Version Numbers will be ignored on next run.");
        header("Location: index.php");
        exit;
    }

// for "Update box now" button
     if(isset($_GET['now']))
    {
        touch("manual-update/manual");
        header("Location: index.php");
        exit;
    }

pi@$ incrontab -l
/srv/ftp/upload IN_CLOSE_WRITE /home/pi/snugupdate-v2-snugberrypi/stblog.sh $@/ $#
/home/pi/snugupdate-v2-snugberrypi/www/manual-update IN_CREATE /home/pi/snugupdate-v2-snugberrypi/run.sh


<run-sh>
echo "$(date)" >> ../www/log
if [ -f ../www/manual-update/manual ]; then
    rm -f ../www/manual-update/manual
    echo "Manually updating the box now" >> ../www/log
fi

if [ -f ../www/force ]; then
    rm -f ../www/force
    force="-f"
fi

python update.py $force >> ../www/log 2>&1


~/si-pi/snugupdate-v2-python
├── images
├── libraries
├── resources
└── update.py

# snugupdate-v2-python/update.py

from libraries import settings

  parser.add_argument('-f', '--force', dest='force_update', action='store_true',
                      help='update anyway (default: only update with different version)')
  parser.add_argument('-y', '--yes', dest='accept_default_actions', action='store_true',
                      help='answer yes to questions (default: prompt for answers)')

  # To make things quicker, first find the STBs we need to match.
  # `libraries/stb.py`
  # from libraries.stb import Devices              # Keeps track of STBs on the network
  devices = Devices()
  webServices = WebServices(devices.deviceDiscover)
  webServices.startWebServices()

  # class Devices():
  # def deviceDiscover(self, packet, address):
  #   stb = STB(ip, port, packet)
  #
  # class STB:
  # def __init__(self, ip, port, packet=None):
  #   if packet != None:
  #     self.initFromPacket(packet)
  #
  # # overrides existing init stuff
  # def initFromPacket(self, packet):
  #   self.packet = packet
  #   self._parsepacket(packet)
  #   self._getEndPoint() *getEndPoint*
  #
  # note: 
  # This is box ip and gets data from a box over uPNP.  
  #
  # xmldoc = minidom.parseString(data)
  # note: when print data
  #
  # <?xml version="1.0"?>
  # <root xmlns="urn:schemas-upnp-org:device-1-0">
  # <specVersion>
  # <major>1</major>
  # <minor>0</minor>
  # </specVersion>
  # <device>
  # <deviceType>urn:schemas-nds-com:device:SkyControl:2</deviceType>
  # note <modelDescription>4f310d</modelDescription>
  # <modelName>Sky+HD</modelName>
  # note <modelNumber>R000.040.86.00U (4ldzgns)</modelNumber>
  # <friendlyName>375528275</friendlyName>
  # <manufacturer>Sky</manufacturer>
  # <nds:X_NDS_ChipID xmlns:nds="urn:schemas-nds-com:device-1-0">3138216726</nds:X_NDS_ChipID>
  # <nds:X_NDS_Configuration_Manifest xmlns:nds="urn:schemas-nds-com:device-1-0">http://10.209.60.45:0//</nds:X_NDS_Configuration_Manifest>
  # <nds:X_NDS_DSSURI xmlns:nds="urn:schemas-nds-com:device-1-0">http://10.209.60.45:8080</nds:X_NDS_DSSURI>
  # note: <UDN>uuid:444D5276-3247-536B-7943-0019fb63d645</UDN>
  # <serviceList>
  # <service>
  # <serviceType>urn:schemas-nds-com:service:SkyPlay:2</serviceType>
  # <serviceId>urn:nds-com:serviceId:SkyPlay</serviceId>
  # <SCPDURL>/player_avt.xml</SCPDURL>
  # <controlURL>/444D5276-3247-536B-7943-0019fb63d645SkyPlay</controlURL>
  # <eventSubURL>/444D5276-3247-536B-7943-0019fb63d645SkyPlay</eventSubURL>
  # </service>
  # <service>
  # <serviceType>urn:schemas-nds-com:service:SkyCM:2</serviceType>
  # <serviceId>urn:nds-com:serviceId:SkyCM</serviceId>
  # <SCPDURL>/player_cm.xml</SCPDURL>
  # <controlURL>/444D5276-3247-536B-7943-0019fb63d645SkyCM</controlURL>
  # <eventSubURL>/444D5276-3247-536B-7943-0019fb63d645SkyCM</eventSubURL>
  # </service>
  # <service>
  # <serviceType>urn:schemas-nds-com:service:SkyRC:2</serviceType>
  # <serviceId>urn:nds-com:serviceId:SkyRC</serviceId>
  # <SCPDURL>/player_rc.xml</SCPDURL>
  # <controlURL>/444D5276-3247-536B-7943-0019fb63d645SkyRC</controlURL>
  # <eventSubURL>/444D5276-3247-536B-7943-0019fb63d645SkyRC</eventSubURL>
  # </service>
  # </serviceList>
  # </device>
  # <URLBase>http://10.209.60.45:49153/</URLBase>
  # </root>
  # 
  # DEBUG: packet: HTTP/1.1 200 OK
  # CACHE-CONTROL: max-age=115
  # DATE: Mon, 03 Jan 2000 10:16:15 GMT
  # EXT:
  # LOCATION: http://10.209.60.36:49153/description0.xml
  # OPT: "http://schemas.upnp.org/upnp/1/0/"; ns=01
  # 01-NLS: 15cb2792-1dd2-11b2-8034-c4b603dd6193
  # SERVER: Linux/2.6.18.8 UPnP/1.0 SKY DLNADOC/1.50
  # X-User-Agent: redsonic
  # ST: urn:schemas-nds-com:device:SkyControl:2
  # USN: uuid:444D5276-3247-536B-7943-0019fbf2d46b::urn:schemas-nds-com:device:SkyControl:2
  #
  # *getEndPoint* *regex*
  # >>> DEBUG: _getEndPoint: self.info[model]: R000.040.73.00U (4ldzfno)
  #
  # regexes = (r'(?P<model_release>R\d+)\.(?P<version>\d+\.\d+\.\d+)',
  #            r'(?P<version>\d+\.\d+\.\d+)_\d+_(?P<model_release>WALRUS-ENG-\d+)' )
  # note: 
  # Use regex to search `valid` stb. When parsing, if does not match up with
  # version and model, not see it as valid so it acts as filtering.
  #
  # def _getVersionNumber(self, value): 
  # Exception(u'Could not parse model # number 85.41.00_1174_MNTEE',) at PARSE
  
  # return a list of STB objects.
  valids = devices.getValidDevices()

  # note: `print` shows on log output.
  # print 'Found %d STBs in %ds' % (len(valids), i)
  # >>> Found 1 STBs in 119s

  # stb.printBoxInfo()
  # stb.getBoxInfo('boxtype') = drx890
  # >>> 10.209.60.66 drx890 - R011.075.59.00U (4n7ol6k)

  # when found boxes on network then add `all` of the boxes found to the regular
  # search patten.
  `regex_search` = '|'.join([stb.getBoxInfo('boxtype') for stb in valids])

  # when not found boxes
  # regex_search = '.*'

  # from libraries.dropbox_integration import find_and_download_images
  # `libraries/dropbox_integration.py`
  # find `all` images from a dropbox and write it to /images/
  #
  # def find_and_download_images(stb_regex='.*'):
  
    <dropbox-account> <mapfile>
    https://www.dropbox.com/home
    username: rajchop@cisco.com
    pwd: generic1
    
    https://www.dropbox.com/sh/wlz5ikbmggua3cu/AAB2hrH6Um6GarVD2nhBe4sYa?dl=0

    # images = find_images(client)
    #
    # first *regex*
    # *settings.imageNameRegex* = r'^(?P<type>.+)\.SYSF(?P<version>[\d.]+)'
    #
    # `libraries/settings.py`
    # Drop box token for getting the images (only override this to None)
    dropboxToken = 'As9R5GK3uV0AAAAAAAAAAaQSpZQzKjuBGvh9XOZh46ofLqEbYh7Xj-yMhHAdRj-2'

    >>> folder_metadata['contents']
    [
    {u'read_only': False, u'revision': 1, u'bytes': 249159, u'thumb_exists': True, u'rev': u'1124b72fd', u'modified': u'Mon, 15 Jul 2013 10:59:51 +0000', u'mime_type': u'application/pdf', u'size': u'243.3 KB', u'path': u'/Getting Started.pdf', u'is_dir': False, u'modifier': None, u'root': u'dropbox', u'content_hash': u'c3dfdd86981548e48bc8efb6c4162c76ba961ec92e60f6ba26189068a41fcaf2', u'client_mtime': u'Mon, 15 Jul 2013 10:59:51 +0000', u'icon': u'page_white_acrobat'}, 
    {u'read_only': False, u'revision': 2565, u'bytes': 3029, u'thumb_exists': False, u'rev': u'a05124b72fd', u'modified': u'Sat, 25 Oct 2014 14:07:26 +0000', u'mime_type': u'application/octet-stream', u'size': u'3 KB', u'path': u'/Microsoft Outlook 2010.lnk', u'is_dir': False, u'modifier': None, u'root': u'dropbox', u'content_hash': u'781fb680b4c9eb8201e692ad81c1258547c3613b30eab9de5b9d5080ea2edea5', u'client_mtime': u'Mon, 20 Jan 2014 21:37:10 +0000', u'icon': u'page_white'}, 
    {u'read_only': False, u'revision': 2987, u'bytes': 0, u'thumb_exists': False, u'rev': u'bab124b72fd', u'modified': u'Wed, 21 Jan 2015 11:13:38 +0000', u'size': u'0 bytes', u'path': u'/Miscellaneous', u'is_dir': True, u'modifier': None, u'root': u'dropbox', u'content_hash': u'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', u'icon': u'folder'}, 
    {u'read_only': False, u'revision': 14268, u'bytes': 0, u'thumb_exists': False, u'rev': u'37bc124b72fd', u'modified': u'Mon, 05 Dec 2016 10:09:45 +0000', u'size': u'0 bytes', u'path': u'/SNUG Full Release', u'is_dir': True, u'modifier': None, u'root': u'dropbox', u'content_hash': u'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', u'icon': u'folder'}, 
    {u'read_only': False, u'revision': 4633, u'bytes': 0, u'thumb_exists': False, u'rev': u'1219124b72fd', u'modified': u'Thu, 18 Jun 2015 15:33:52 +0000', u'size': u'0 bytes', u'path': u'/snugberrypi', u'is_dir': True, u'modifier': None, u'root': u'dropbox', u'content_hash': u'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', u'icon': u'folder'}]

    note: 
    search from root('/') and find all. see that it has *full* path fromt the
    root and use regex to filter them out.

    when print images from find_images()
    dropbox image: /snug full release/Archived/drx890.SYSF40.65.00.enc.snugupdate
    dropbox image: /snug full release/SNUG Staines/drx890.SYSF40.93.00.enc.snugupdate

    # if re.search(settings.imageNameRegex, item['path']):
    #   files_found.append(item['path'])
    
    # second *regex*
    # This setting is used to filter the list of filenames that dropbox
    # returns. If this regex matches, then the image will be ignored.
    # *settings.dropBoxIgnoreRegex* = r'Archived'
    #
    # note: see `regex_search`
    #
    # print 'Found %d images, ignoring those matching \'%s\'%s' % (
    #     len(images),
    #     settings.dropBoxIgnoreRegex,
    #     '' if stb_regex == '.*' else ' filtering on \'' + stb_regex + '\'')
    #
    # >>> Found 1 images, ignoring those matching 'Archived' filtering on 'drx890'
    #
    # note: to remove images that matches to `IgnoreRegex` and do not match
    # `boxtype` from `downloading`
    #
    # for image in images:
    #   if re.search(settings.dropBoxIgnoreRegex, image) or not re.search(stb_regex, image):
    #       continue
    #
    # print 'DEBUG: image:', image
    # DEBUG: image: /snug full release/SNUG Staines/drx890.SYSF40.73.00.enc.snugupdate
    #
    # note: see `image`
    # out_filename = 'images/' + image.split('/')[-1]
    # print 'Downloading', out_filename 
    # >>> Downloading images/drx890.SYSF40.65.00.enc.snugupdate
    # 
    # # download each which are not filtered out.
    # download_file(client, image, out_filename)

  find_and_download_images(`regex_search`)

  # note:
  # find files from image directory and build a dict per box type with image
  # file name.
  #
  # Now we'll find the available images to use for the specific STBs
  # `libraries/stbimages.py`
  # from libraries.stbimages import STBImages      # Keeps track of image files
  #
  # note: split up as words. will be only one 'boxtype' which is drx890 in
  # this case.
  #
  # def __init__(self, path='images/', filter_on='.*'):
  #   self.imageGroup = re.split('\W+', filter_on)
  # DEBUG: imageGroup: ['drx890']
  #
  # note: 
  # once downloaded all files from dropbox,
  # check each file in "image" directory on Pi and if matches then add it
  #
  # image name regex (do not change this)
  # *settings.imageNameRegex* = r'^(?P<type>.+)\.SYSF(?P<version>[\d.]+)'
  #
  # f='drx890.SYSF40.73.00.enc.snugupdate'
  # re.match(r'^(?P<type>.+)\.SYSF(?P<version>[\d.]+)', f)
  # 'drx890.SYSF40.73.00.enc.snugupdate'
  #  ^^^^^^     ^^^^^^^^
  #
  # for f in contents:                  # list of files in "image"
  #   regex = `settings.imageNameRegex`
  #   match = re.match(regex, f)
  #
  #   if match and (not len(self.imageGroup) or match.group('type') in self.imageGroup):
  #     self._addImage(f, match)
  #
  # note: contents contains .gitignore so is handled here
  #
  # def _addImage(self, name, image):
  #
  #   # filename is going to be fullpath.
  #   filename = os.path.join(self.path, name)
  #
  #   box = image.group('type')
  #   new_version = image.group('version')
  #
  # note: self.images is dictionary and if there is already a value for
  # images[box] then `compare versions of image, compareVersions` and if not,
  # add it to dictionary when there is an exception since there is no key and
  # it's first time.
  #
  # note: when add an entry to `nested dict`, compareVersions and set `update`
  #
  # note: <bug> when there are multiple images in the folder, update always
  # dict with a `higher` version.
  #
  # note: <bug> if there already is a image in images, then it'll pick up.
  # that's why run.sh run rm before run this script.
  # 
  # Downloading images/drx890.SYSF84.65.00.enc.snugupdate
  # Downloading images/drx890.SYSF40.93.00.enc.snugupdate
  # Found the following images:
  # drx890 : images/drx890.SYSF84.65.00.enc.snugupdate
  #
  #   old_version = self.images[box].get('version', '0.0.0')
  #
  #   if update is True:
  #     self.images[box] = { 'version': new_version, 'filename': filename }
  #
  # note: if image already exist, then use it.
  #
  stbImages = STBImages(filter_on=regex_search)
  stbImages.findImages()

  # def printImages(self):
  #     print 'Found the following images:'        
  #     for image in self.images.keys():
  #         print image, ':', self.images[image]['filename']
  #
  # >>> Found the following images:
  # >>> drx890 : images/drx890.SYSF40.65.00.enc.snugupdate
  # 
  stbImages.printImages()

  # *pi-check-version*
  #
  # Now let's decide what we want to do with each of the STB
  # `libraries/stb.py`
  # devices = Devices()
  #
  # note: can set from "force" option
  # If you want to ignore what file versions are being returned, ie the STBs
  # will be flashed with the highest image version that we have, regardless of
  # what version they have, set this to true 
  # *settings.ignoreFileVersions* = False
  #
  # note: decide if update is necessary?
  #
  # for stb in self.validDevices:
  #   stb.checkAction(images)
  #
  # class STB:
  # def checkAction(self, images):
  #
  #   image = images.getImage(self.info['boxtype'])
  #
  # *pi-force-option*
  # If you want to ignore what versions a box has, ie the STBs will be flashed
  # with the highest image version that we have
  #
  #   # Let's check the versions (if we have to)
  #   if *settings.ignoreFileVersions* == True:
  #     print ' - Ignoring file versions and flashing with %s' % image['filename']
  #     self._update = True
  #   elif images.compareVersions(self.info['version'], image['version']) is -1:
  #     print ' - upgrade to %s' % image['filename']
  #     self._update = True
  #
  # // compare version
  #
  # <modelNumber>R000.040.86.00U (4ldzgns)</modelNumber>
  #
  #  def _getVersionNumber(self, value):
  #      regexes = (r'(?P<model_release>R\d+)\.(?P<version>\d+\.\d+\.\d+)',
  #                 r'(?P<version>\d+\.\d+\.\d+)_\d+_(?P<model_release>WALRUS-ENG-\d+)' )
  #
  # result: ('R000', '040.86.00')
  # self.info['version'] is '040.86.00'
  #
  # 'drx890.SYSF40.73.00.enc.snugupdate'
  #
  # images.compareVersions('stb-version', 'image-version')
  #
  # # returns 1 if greater is bigger than lesser
  # #        -1 is lesser  is bigger than greater
  # #         0 if they are equal
  # def compareVersions(self, greater, lesser):
  #
  devices.checkSTBActions(stbImages)

  # note: NOT executed for some reason when settings.acceptDefaultActions =
  # False in settings.py? Different place to define it? 
  # *settings.acceptDefaultActions* = True
  # turns out if comes from `local_settings.py`

  # note: decrypt image using `gpg`
  # note: settings.gpgPassphrase comes from `local_settings.py`
  # GPG passphrase
  # gpgPassphrase = 'Zft4ngX4#_q5HvzELy9pnW#L-Sw=LnTgN$jkCgPPcyCrQrCuSQ78s=45uNujm*$Q'
  #
  #
  # def extractImages(self):
  #
  # with open(self.images[image]['filename'], 'rb') as f:                
  #     out_filename=self.images[image]['filename'] + '.gpg'
  #     self.images[image]['extracted'] = `extract_image`(f, filename=out_filename)
  #
  # `extract_image.py`
  # def extract_image(f, filename=None):
  #
  # note: prints from extract_image which is to get file info.
  # # File version: 1
  # # Number of images: 1
  # # Image version: 0
  # # Baseline: SYSF40.73.00
  # # Platform: drx890
  # # Encrypted: 1
  # # Encrypted for: keyholders@company.com
  # # Found data length: 16722379
  # # Writing file images/drx890.SYSF40.74.00.enc.snugupdate.gpg
  #
  # in_file = self.images[image]['extracted']
  # out_file =  in_file + '.clear'
  # self.images[image]['clear'] = out_file
  #
  # >>> DEBUG: cmd: gpg --batch --no-tty --passphrase-fd 0 --decrypt "images/drx890.SYSF40.73.00.enc.snugupdate.gpg"
  # echo 'Zft4ngX4#_q5HvzELy9pnW#L-Sw=LnTgN$jkCgPPcyCrQrCuSQ78s=45uNujm*$Q' | gpg --batch --no-tty --passphrase-fd 0 --decrypt "drx890_SYSF88.22.00.gpg" > drx890_SYSF88.22.00.gpg.clear
  #
  # 16722541 Jan  3 11:55 drx890.SYSF40.74.00.enc.snugupdate
  # 16722379 Jan  4 09:01 drx890.SYSF40.74.00.enc.snugupdate.gpg
  # 16611504 Jan  4 09:01 drx890.SYSF40.74.00.enc.snugupdate.gpg.clear

  # note: WHY size changes? since do not write header to output
  #
  # pi@raspberrypi ~/snugupdate-v2-snugberrypi/snugupdate-v2-python $ gpg --list-secret-keys
  # /home/pi/.gnupg/secring.gpg
  # ---------------------------
  # sec   2048R/E7204075 2014-09-16
  # uid                  Snug User (SnugberryPi) <pi@snugupdater>
  # ssb   2048R/2C335150 2014-09-16

  # /home/pi/snugupdate-v2-snugberrypi/snugupdate-v2-python
  # python libraries/extract_image.py ./images/drx890.SYSF88.22.00.enc.snugupdate
  # gpg -vvv --decrypt drx890_SYSF88.22.00.gpg
  #
  # kyoupark@kit-debian:~/si-pi-image$ python ./extract_image.py drx890.SYSF40.73.00.enc.snugupdate
  # File version: 1
  # Number of images: 1
  # Image version: 0
  # Baseline: SYSF40.73.00
  # Platform: drx890
  # Encrypted: 1
  # Encrypted for: keyholders@company.com
  # Found data length: 16722379
  # Writing file drx890_SYSF40.73.00.gpg
  # 
  # -rwxr--r--  1 kyoupark ccusers 16722541 Jan  5 09:52 drx890.SYSF40.73.00.enc.snugupdate*
  # -rw-r--r--  1 kyoupark ccusers 16722379 Jan  6 13:28 drx890_SYSF40.73.00.gpg
  #
  # note: WHY FLA from CI is different x.out?
  #
  # gpg --output x.out --passphrase tegI3301 --decrypt drx890_SYSF40.79.00.gpg
  #
  # -rwxr--r--  1 kyoupark ccusers 16349360 Jan  6 13:17 APPLI_0.FLA_40.73.FLA*
  # -rwxr--r--  1 kyoupark ccusers 16722541 Jan  5 09:52 drx890.SYSF40.73.00.enc.snugupdate*
  # -rw-r--r--  1 kyoupark ccusers 16722379 Jan  6 13:28 drx890_SYSF40.73.00.gpg
  # -rw-r--r--  1 kyoupark ccusers 16611504 Jan  6 13:33 x.out

  stbImages.extractImages()

  # *si-pi-flash*
  # def updateSTBs(self, images, confirm=False):
  #   stb.performAction(images)
  #
  #   *Q* performAction can raise exception and this leads to print:
  #   print "Ignoring this box since it is invalid"
  #   Under what cases can it raise exception? telnet into a production box?
  #
  # def performAction(self, images):
  #   # do only when *self._update* = True
  #   update_stb(self, image['clear'], settings.webserverIPAddress)
  #
  # `libraries/update_engine.py`
  # update_stb(self, image['clear'], settings.webserverIPAddress)
  #
  # My IP address.  Only set this if the auto detection is failing (advanced setting)
  # *settings.webserverIPAddress* = get_ipv4_address()  
  #
  # def update_stb(stb, image_path, server_ip):
  #     server_root = 'http://%s:%d/' % (server_ip, settings.webserverFileServerPort)
  #
  # # snugupdate-v2-python/resources/updater.ams890.tar
  # ├── bin.ams890
  # │   └── update
  # ├── rootfs.ams890
  # │   └── lib
  # │       ├── libcurl.so -> libcurl.so.4.3.0
  # │       ├── libcurl.so.4 -> libcurl.so.4.3.0
  # │       ├── libcurl.so.4.3.0
  # │       ├── libexpat.so -> libexpat.so.1.6.0
  # │       ├── libexpat.so.1 -> libexpat.so.1.6.0
  # │       └── libexpat.so.1.6.0
  # 
  # # def getUpdaterImage(self):
  # #     box = self.getBoxInfo('boxtype')
  # #     if box == 'ams-drx78':
  # #         return 'resources/updater.drx780.tar'
  # #     else:
  # #         return 'resources/updater.ams890.tar'
  #
  #     updater_path = stb.getUpdaterImage()
  # 
  #     # 1) Telnet into the STB
  #     tn = stb.openTelnetConnection()
  #     #import telnetlib
  #     #tn = telnetlib.Telnet('172.20.111.21', 23, 30)
  #     #tn.read_until('login:')
  #     #tn.write('root\n')
  #     tn.write('stty -echo\n')
  #     tn.read_until('# ')
  # 
  #     try:
  #
  #         # 1.5) Create working directory
  #         print 'Creating working dir'
  #         tn.write('mkdir -p /update && cd /update && echo STEP_1_5\n')
  #         read_until_step(tn, 'STEP_1_5', 5)
  # 
  #         # *from-pi*
  #         # Downloading update utility http://10.209.60.125:1024/, resources/updater.ams890.tar
  #
  #         # 2) Download the updater file
  #         print 'Downloading update utility %s' % updater_path
  #         tn.write('wget -O updater.tar %s%s && echo STEP_2\n' % (server_root, updater_path))
  #         read_until_step(tn, 'STEP_2', 120)
  # 
  #         # 2.5) Extract the updater image
  #         print 'Extracting update utility'
  #         tn.write('tar -xf updater.tar && cd bin.* && mv ../rootfs.*/lib/* . && echo STEP_2_5\n')
  #         read_until_step(tn, 'STEP_2_5', 120)
  # 
  #         #3) Download the image
  #         print 'Download new SNUG image %s' % image_path
  #         tn.write('wget -O image.img %s%s && echo STEP_3\n' % (server_root, image_path))
  #         read_until_step(tn, 'STEP_3', 120)
  # 
  #         *update* 
  #         #4) Update the image
  #         print 'Updating...'
  #         cmd = 'LD_LIBRARY_PATH=. ./update -t %d -w %s' % (time.time(), 'image.img')
  #         tn.write('%s && echo STEP_4\n' % cmd)
  #         read_until_step(tn, 'STEP_4', 300)
  #         
  #     except EOFError:
  #         raise Exception('telnet connection to %s closed' % stb.ip)
  # 
  #     except:
  #         #print 'Exception when updating %s' % stb.ip
  #         raise
  #     finally:
  # 		tn.close()
  devices.updateSTBs(stbImages, confirm=confirmEach)


={============================================================================
|kt_dev_si_0001| si-pi-modified

print ' - No need to upgrade. %s, %s, %s' % (self.info['version'], self.info['update_version'], image['version'])

Checking action for each STB...
  10.209.56.84, 783e533494e9, drx890 - R017.085.06.00U (4o7gmjs) -> SYSF85.06.00, SNUG rack 2(kyoupark)
   - No need to upgrade. 085.06.00, SYSF85.06.00, 85.15.00

  10.209.56.189, 783e533494c2, drx890 - R017.085.06.00U (4o7gmjs) -> SYSF85.15.00, SNUG rack 1(kyoupark)
   - No need to upgrade. 085.06.00, SYSF85.15.00, 85.15.00


={============================================================================
|kt_dev_si_0001| si-pi-flash

cmd = 'LD_LIBRARY_PATH=. ./update -t %d -w %s' % (time.time(), 'image.img')

-sh-3.2# pwd
/update/bin.ams890
-sh-3.2# ls -al
-rw-r--r--    1 root     root     16628100 Jan  1 08:06 image.img
lrwxrwxrwx    1 root     root           16 Jan  1 08:06 libcurl.so -> libcurl.so.4.3.0
lrwxrwxrwx    1 root     root           16 Jan  1 08:06 libcurl.so.4 -> libcurl.so.4.3.0
-rwxr-xr-x    1 root     root       372181 Mar 18  2013 libcurl.so.4.3.0
lrwxrwxrwx    1 root     root           17 Jan  1 08:06 libexpat.so -> libexpat.so.1.6.0
lrwxrwxrwx    1 root     root           17 Jan  1 08:06 libexpat.so.1 -> libexpat.so.1.6.0
-rwxr-xr-x    1 root     root       368023 Mar 18  2013 libexpat.so.1.6.0
-rwxr-xr-x    1 root     root        46288 May  3  2013 update

# WHY not work?
# wget -O updater.tar http://11.209.60.125:1024/resources/updater.ams890.tar


// /home/kyoupark/si_logs/updater/bin.ams890
mkdir /mnt/tmp
mount -o rw -t nfs 10.209.62.106:/home/kyoupark/si_logs/updater /mnt/tmp
mount -o rw -t nfs 10.209.62.106:/home/kyoupark /mnt/tmp

LD_LIBRARY_PATH=. ./update -t `date +%s` -w image.img
LD_LIBRARY_PATH=. ./update -t `date +%s` -w image.img.40.73

    LOG(LOG_LEVEL_ERROR, "  -w <filename> - Flash image to write - Can be local or http://\n");

            case 'w':
                z_image_to_write = optarg;
                break;

    LOG(LOG_LEVEL_ERROR, "  -t <time>     - Set current time - Unix timestamp in seconds since 1970\n");

            case 't':
                z_time_offset = atoi(optarg) - time(NULL);
                break;

<reboot>
            case 'f':
                z_force_reboot = 1;
                break;

    /* Wait until it's safe to reboot */
    if (z_force_reboot == 0)
    {
        while(check_box_state() != ERR_OK)
        {
            sleep(z_check_interval);
        }
    }


    else
    {
        LOG(LOG_LEVEL_ERROR, "Rebooting...\n");
#ifndef PLATFORM_x86
        sleep(5);
        sync();
        reboot(RB_AUTOBOOT);
#endif
    }

note:
DO not reboot immediately whether use Windows update or python update.


<write>
  write_flash_banks(z_image_to_write);

  uses CDI software download device and input source can be either uPnP or
  input file.


={============================================================================
|kt_dev_si_0001| si-pi-upload

<run-sh>

../upload_log.py ../www/log
./upload_log.py /home/pi/snugupdate-v2-snugberrypi/www/log


Upload /snugberrypi/logs/b8-27-eb-11-5f-d6/2017-09-25 00:28 ~ _home_pi_snugupdate-v2-snugberrypi_www_log.txt
Uploaded  2017-09-25 00:28 ~ _home_pi_snugupdate-v2-snugberrypi_www_log.txt

import dropbox
# Upload the file
dropboxToken = 'As9R5GK3uV0AAAAAAAAAAaQSpZQzKjuBGvh9XOZh46ofLqEbYh7Xj-yMhHAdRj-2'
filename = '/home/pi/snugupdate-v2-snugberrypi/www/log'
f = open(filename)
dbox = dropbox.dropbox.Dropbox(dropboxToken)

# name = dropbox_base_url + mac + '/' + time + ' ~ ' + dropbox_log_name
# okay
response = dbox.files_upload(f.read(), "/snugberrypi/logs/b8-27-eb-11-5f-d6/log.txt")

# no error from dropbox but do not get uploaded.
response = dbox.files_upload(f.read(), "/snugberrypi/logs/b8-27-eb-11-5f-d6/2017-09-25 00:28 ~ _home_pi_snugupdate-v2-snugberrypi_www_log.txt")
response = dbox.files_upload(f.read(), "/snugberrypi/logs/b8-27-eb-11-5f-d6/2017-09-25 00:28_www_log.txt")
response = dbox.files_upload(f.read(), "/snugberrypi/logs/b8-27-eb-11-5f-d6/2017-09-25-00-28_www_log.txt")


# push log to
dropbox_base_url = '/snugberrypi/logs/'

# like
/snugberrypi/logs/b8-27-eb-11-5f-d6/2017-09-12 06:52 ~ www_log.txt


={============================================================================
|kt_dev_si_0001| si-pi-upload-log

<to-show-uploading-log-in-html>
Clear or echo "uploadlog" to a page:
upload.php
        $log = file_get_contents("uploadlog");


<local-settings>
# enable log uploading via a SnugberryPi
piLogUploading = True


1. update_stb creates this file which has PI's IP:

`libraries/update_engine.py`
update_stb(self, image['clear'], settings.webserverIPAddress)
  #
  #         # enable log uploading via a SnugberryPi
  #         # piLogUploading = False
  #         if *settings.piLogUploading* :
  #
  #             # /dev/sda1 on /mnt/nds/dev_6/part_0 type xtvfs (rw,nosuid)
  #             #
  #             # -sh-3.2# mount | grep "/dev/sda.*/mnt/nds/dev" | cut -f3 -d" "
  #             # /mnt/nds/dev_6/part_0
  #
  #             # note: WHY make this file?
  #             print 'Creating pi_addr file for log uploads'
  #
  #             # this finds the locations of FSN_DATA and then creates a file
  #             # in it called PI_ADDR and puts PI's IP address in that file
  #             tn.write('echo ``mount | grep "/dev/sda.*/mnt/nds/dev" | cut -f3 -d" "``/FSN_DATA/PI_ADDR\n')
  #             fsndata = tn.read_until('PI_ADDR', 10)
  #             tn.read_until('# ')
  # 
  #             if fsndata is "/FSN_DATA/PI_ADDR":
  #                 tn.write('echo `mount | grep "/dev/mtdblock.*/mnt/nds/dev" | cut -f3 -d" "`/FSN_DATA/PI_ADDR\n')
  #                 fsndata = tn.read_until('PI_ADDR', 10)
  #                 tn.read_until('# ')
  # 
  #             if fsndata is "/FSN_DATA/PI_ADDR":
  #                 print 'Unable to find FSN_DATA, cannot create PI_ADDR'
  #             else:
  #                 # create a file 
  #                 # >>> location = /mnt/nds/dev_6/part_0/FSN_DATA/PI_ADDR
  #                 print 'location = ' + fsndata
  #                 tn.write('echo ' + settings.webserverIPAddress + ' > ' + fsndata + '\n')
  # 


2. put files to pi via ftp

filelist="${BLOG_DATAPATH}/UPLOAD.LOG \
$logdir/LOG \
$toobigfilename \
$keeping \
$logdir/*.CUR \
$logdir/*.TXT \
$logdir/*.CSV \
$logdir/CDB.DB \
$logdir/MFS.DB \
$logdir/PCAT.DB \
$logdir/PSL.BIX \
$logdir/PSL.DB \
$logdir/PSL.DBW \
$logdir/PSL.NSA \
$logdir/REMBOOK.DB \
$logdir/NVRAM0.BIN \
$logdir/NVRAM1.BIN \
$logdir/*.COR"

# bootlog-upload-1.sh
/usr/bin/bootlog-upload-pi.sh "$logdir" "$hwaddr" "$filelist"

note: only do uploads when bootlog-upload-pi.sh fails.

# bootlog-upload-pi.sh
pi_addr=`cat $BLOG_DATAPATH/PI_ADDR`

# exit if there is no PI_ADDR.
if [ $? != 0 ]; then
	echo "BLL:bootlog-upload-pi.sh: PI address not set, skipping pi upload attempt" >> "${BLLFILENAME}"
	exit 1
fi

# exit if web server is down
id=`wget -q -O - http://$pi_addr/time.php`

if [ $? != 0 ] || [ -z "$id" ]; then
	rm $BLOG_DATAPATH/PI_ADDR
	echo "BLL:bootlog-upload-pi.sh: PI not responding, disabling future pi upload attempts"  >> "${BLLFILENAME}"
	exit 1
fi

for srcfile in $filelist
do
	if [ -f "$srcfile" ]; then
		echo "BLL:bootlog-upload-pi.sh: FTPPUT: $srcfile" >> "${BLLFILENAME}"
		ftpput -u anonymous -p pi "$pi_addr" upload/"$hwaddr"_"$id"_"${srcfile##*/}" "$srcfile"
	fi
done

# mac_time_xxx.xxx
pi@raspberrypi /srv/ftp/upload $ pwd
/srv/ftp/upload

783e533494c2_1505797761_BLL.LOG       783e533494c2_1505797761_INFO.TXT      783e533494c2_1505797761_MPROFPWM.CSV  783e533494c2_1505797761_P582.LOG    783e533494c2_1505797761_UPLOAD.LOG
783e533494c2_1505797761_BLL_PREV.LOG  783e533494c2_1505797761_KMSG.LOG      783e533494c2_1505797761_MPROFSCD.CSV  783e533494c2_1505797761_PCAT.DB     783e533494c2_1505797761_UPLOAD.URL
783e533494c2_1505797761_DF.LOG        783e533494c2_1505797761_MFS.DB        783e533494c2_1505797761_MPROFSTM.CSV  783e533494c2_1505797761_PSL.BIX     783e533494c2_1505797761_VERHIST.LOG
783e533494c2_1505797761_FILES.TXT     783e533494c2_1505797761_MPROFAPP.CSV  783e533494c2_1505797761_NVRAM0.BIN    783e533494c2_1505797761_PSL.DB
783e533494c2_1505797761_HDPARM.LOG    783e533494c2_1505797761_MPROFCAK.CSV  783e533494c2_1505797761_NVRAM1.BIN    783e533494c2_1505797761_PSL.NSA
783e533494c2_1505797761_IFCONFIG.LOG  783e533494c2_1505797761_MPROFMWS.CSV  783e533494c2_1505797761_P582.CUR      783e533494c2_1505797761_REMBOOK.DB


3. Use icron to run script whenever file uploads to pi occurs.

pi@$ incrontab -l
/srv/ftp/upload IN_CLOSE_WRITE /home/pi/snugupdate-v2-snugberrypi/stblog.sh $@/ $#

$@
Watched filesystem path

$#
Event-related file name

/home/pi/snugupdate-v2-snugberrypi/stblog.sh /srv/ftp/upload/ filename


4. run stblog.sh for each file

must exist STBLOGSDIR="/home/pi/snugupdate-v2-snugberrypi/stblogs/" and fails
otherwise.

Moves from /srv/ftp/upload to STBLOGSDIR="/home/pi/snugupdate-v2-snugberrypi/stblogs/"

$2 0019fbf2d46b_1484200015_BLL.LOG

[Thu Jan 12 05:46:55 UTC 2017-0019fbf2d46b_1484200015] Received File: 0019fbf2d46b_1484200015_BLL.LOG (6855b) - Prefix: 0019fbf2d46b_1484200015 Name: BLL.LOG
macaddr: 00:19:fb:f2:d4:6b

When gets "UPLOAD.URL", tars and upload it to 

  # 783e533494c2_1505799673
  mkdir $STBLOGSDIR$prefix

  # move files to
  $STBLOGSDIR$prefix/

  # log "Uploading $tgzname"
  # Uploading darwin_783e533494c2_cba3ff37180482f901afabdc5ffbd157.tgz
  # ${SHDIR}httpsend "$macaddr" "$tgzname"
  # ./httpsend "00:19:fb:f2:d4:6b" version.txt
  /home/pi/snugupdate-v2-snugberrypi/httpsend "78:3e:53:34:94:c2" darwin_783e533494c2_cba3ff37180482f901afabdc5ffbd157.tgz

UPLOAD: [Thu Oct 26 08:21:52 UTC 2017-783e533494c2_1509006112] args /srv/ftp/upload/ 783e533494c2_1509006112_BLL.LOG
UPLOAD: [Thu Oct 26 08:21:52 UTC 2017-783e533494c2_1509006112] Received File: 783e533494c2_1509006112_BLL.LOG (9174b) - Prefix: 783e533494c2_1509006112 Name: BLL.LOG

UPLOAD: [Thu Oct 26 08:23:28 UTC 2017-783e533494c2_1509006112] All files received
UPLOAD: [Thu Oct 26 08:23:29 UTC 2017-783e533494c2_1509006112] Creating TGZ file
UPLOAD: [Thu Oct 26 08:25:14 UTC 2017-783e533494c2_1509006112] TGZ file created, size = 33994004b, md5 = 3d295d27cdb62e30c41e0a0eb1d0f480
UPLOAD: [Thu Oct 26 08:25:14 UTC 2017-783e533494c2_1509006112] Uploading darwin_783e533494c2_3d295d27cdb62e30c41e0a0eb1d0f480.tgz
UPLOAD: [Thu Oct 26 08:25:18 UTC 2017-783e533494c2_1509006112] Upload complete
UPLOAD: [Thu Oct 26 08:25:18 UTC 2017-783e533494c2_1509006112] Cleanup done


={============================================================================
|kt_dev_si_0001| si-pi-dropbox-upgrade

<dropbox-cli>
https://github.com/andreafabrizi/Dropbox-Uploader
# creates si-pi-prepare-deploy-roll under db:snugupdate-v2-snugberrypi-roll/
/home/kyoupark/si/si-pi-prepare-deploy-roll$ /home/kyoupark/Dropbox-Uploader/dropbox_uploader.sh upload . /snugberrypi/snugupdate-v2-snugberrypi-roll

# works and use grep since failed message for existing and same directories
# and files.
kyoupark@kit-debian64:~/si/snugupdate-v2-snugberrypi-roll$ /home/kyoupark/Dropbox-Uploader/dropbox_uploader.sh upload . /snugberrypi/ | grep DONE


// dropbox python apis from https://www.dropbox.com/developers which shows v2.
// so can think this is v2 api set.
http://dropbox-sdk-python.readthedocs.io/en/latest/index.html

// API v1 → v2 Migration guide
https://www.dropbox.com/developers/reference/migration-guide#endpoint-mapping

<1> dropbox_integration.py, changes to list files which both has full path

# old

client = dropbox.client.DropboxClient(settings.dropboxToken)

def find_images(client):
    
    paths_to_check = collections.deque(['/upgrade-images'])
    files_found = []

    while 1:
        try:
            path = paths_to_check.popleft()
        except IndexError:
           break
        
        print 'path=', path
        
        folder_metadata = client.metadata(path)

        for item in folder_metadata['contents']:
            if item['is_dir']:
                paths_to_check.append(item['path'])

            else:
                if re.search(settings.imageNameRegex, item['path']):
                    files_found.append(item['path'])

    return files_found


# new

dropboxToken = 'As9R5GK3uV0AAAAAAAAAAaQSpZQzKjuBGvh9XOZh46ofLqEbYh7Xj-yMhHAdRj-2'
dbox = dropbox.dropbox.Dropbox(dropboxToken)
import x
x.find_images(dbox)

# x.py
import dropbox
import collections
import re

def find_images(dbox):
    
    paths_to_check = collections.deque(['/SNUG Full Release'])
    files_found = []

    imageNameRegex = r'^(?P<type>.+)\.SYSF(?P<version>[\d.]+)'

    while 1:
        try:
            path = paths_to_check.popleft()
        except IndexError:
           break
        
        print 'path=', path
        
        ls_results = dbox.files_list_folder(path)
        if ls_results.has_more:
            raise Exception('files_list_folder result has more element. This is not currently handled in the code.')
        for item in ls_results.entries:
            print 'item.name=', item.name
            if (isinstance(item, dropbox.files.FolderMetadata)):
                paths_to_check.append(path + '/' + item.name)
            elif (isinstance(item, dropbox.files.FileMetadata)):
                if re.search(imageNameRegex, item.name):
                    files_found.append(path + '/' + item.name)

    return files_found

scp x.py pi@10.209.60.87:/home/pi/snugupdate-v2-snugberrypi/snugupdate-v2-python/libraries/dropbox_integration.py
scp libraries/dropbox_integration.py pi@10.209.60.87:/home/pi/snugupdate-v2-snugberrypi/snugupdate-v2-python/libraries/dropbox_integration.py

def find_images(dbox):
    
    # *change* since have to use '.' to start from root and see too many
    # files.
    paths_to_check = collections.deque(['/SNUG Full Release'])
    files_found = []

    while 1:
        try:
            path = paths_to_check.popleft()
        except IndexError:
           break
        
        print 'path=', path
        
        ls_results = dbox.files_list_folder(path)
        if ls_results.has_more:
            raise Exception('files_list_folder result has more element. This is not currently handled in the code.')
        for item in ls_results.entries:
            print 'item.name=', item.name
            if (isinstance(item, dropbox.files.FolderMetadata)):
              paths_to_check.append(path + '/' + item.name)
            elif (isinstance(item, dropbox.files.FileMetadata)):
              # *change* to filter out what do not match
              if re.search(settings.imageNameRegex, item.name):
                files_found.append(path + '/' + item.name)

    return files_found

<2> dropbox_integration.py
# old
def download_file(client, input_file, output_file):
    f, metadata = client.get_file_and_metadata(input_file)
    out = open(output_file, 'w')
    data = f.read(1024*1024)
    size = 0
    while data != '':
        size += len(data)
        out.write(data)
        data = f.read(1024)

# new

dropboxToken = 'As9R5GK3uV0AAAAAAAAAAaQSpZQzKjuBGvh9XOZh46ofLqEbYh7Xj-yMhHAdRj-2'
import dropbox
dbox = dropbox.dropbox.Dropbox(dropboxToken)
dbox.files_download_to_file('drx890.SYSF40.65.00.enc.downloaded', '/SNUG Full Release/Archived/drx890.SYSF40.65.00.enc.snugupdate')

def download_file(dbox, input_file, output_file):
    dbox.files_download_to_file(output_file, input_file)

<3> upload_log.py
# old
  # Upload the file
  client = dropbox.client.DropboxClient(settings.dropboxToken)
  getURL(client)
  response = client.put_file(getURL(client), f)
  print response['path']

# new
  # Upload the file
  dbox = dropbox.dropbox.Dropbox(settings.dropboxToken)
  response = dbox.files_upload(f.read(), getURL())
  print 'Uploaded: ' + response.name

<log>
SI-11161: Migrate to dropbox v2: Update submodule configuration 

Since the repository was moved to the new server, submodule should be
updated accordingly.

This commit update submoule configuration for SNUG SI to use the new
server, wwwin-gitlab-sjc.cisco.com.


SI-11161: Migrate to dropbox v2

Since dropbox ends its support of V1 API at the end of September[1], pi codes
shall upgrade its code to V2 API.

This commit update dropbox interface and other following enhancements:

  * Limit search path in dropbox so that reduce search and response time using
    dropbox.
  * Have single point of logging for easy debugging and maintenance.     
  * Suppots package updates

[1] https://blogs.dropbox.com/developers/2016/06/api-v1-deprecated/


# ============================================================================
#{
={============================================================================
|kt_dev_si_0002| si-vstb

http://vstb.cisco.com/

<vm-setting>
Under the vstb-XX.X.X settings:
Serial Ports:
Make note of serial port Path/Address E.g. “\\.\pipe\vstb-19.3.1_COM1”

\\.\pipe\vstb-20.6.2_COM1
\\.\pipe\vstb-21.1.0_COM1

Network-> Adapter 1->Advanced->Port Forwarding:
Add new rule using same Guest IP as Telnet but with Host Port/Guest Port for Remote Control Unit 8080
Modify the Telnet host port to something different from 23 like 8023
E.g.
Name	Protocol	Host IP	Host Port	Guest IP	Guest Port
Telnet	TCP	-	8023	10.0.2.15	23
RCU	TCP	-	8080	10.0.2.15	8080

<build>
./initialise_hooks
Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01 FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01

rm -rf /home/kyoupark/STB_SW/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/out

cd FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/
./make.sh --profile nds_si_devel --debug_level release_dbg --os_debug_level release --project picasso --platform vstb --clean --output $PWD --baseline ENG_vSTB_40.40.00 --epg_bld_type release-trials |& tee b.log
./make.sh --debug_level release_dbg --os_debug_level release --project picasso --platform vstb --clean --output $PWD --baseline ENG_vSTB_40.40.00 --epg_bld_type release-trials |& tee b.log

<output>
./release.sh --platform vstb --project picasso
$ ls
flash0.tar.gz

/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian

<toolchain>
CC=/home/kyoupark/STB_SW/FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/compiler/i686-nptl-linux-gnu/bin/i686-nptl-linux-gnu-gcc

// STB_SW/deps/SYSTEM_BIN_3/i686_nptl_gcc_x86_linux_01

$ more crosstool-ng.config
# Automatically generated make config: don't edit
# crosstool-NG 1.21.0 Configuration
# Wed May 18 13:28:31 2016


i686-nptl-linux-gnu-gcc (crosstool-NG 1.21.0) 4.9.1
Copyright (C) 2014 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

GNU ld (crosstool-NG 1.21.0) 2.25


<mount>
export PROFILE=FUSION-MRFUSION-01
export STREAM_NETWORK=BSKYB_DARWIN
mkdir /flash0
mount -o nfsvers=4 10.209.62.106:/home/kyoupark/si_logs/flash0-asan-v4/flash0 /flash0
/flash0/scripts/startstack.sh

// copy libasan* into /flash0
mkdir /flash0

0x0819b606 is located 0 bytes to the right of global variable 'gClientName' from 'diagctl_log_req_handler.c' (0x819b600) of size 6
  'gClientName' is ascii string '_DLRH'

/home/kyoupark/STB_SW/CMS_SYSTEM_INFRASTRUCTURE/DIAG/src/log/src/diagctl_log_req_handler.c


export PROFILE=FUSION-MRFUSION-01
export STREAM_NETWORK=BSKYB_DARWIN
export ASAN_OPTIONS="verbosity=2:halt_on_error=0"
export LD_LIBRARY_PATH="/flash0:${LD_LIBRARY_PATH}"
mkdir /flash0
mount -o nfsvers=4 10.209.62.106:/home/kyoupark/si_logs/flash0-asan-v6/flash0 /flash0
/flash0/scripts/startstack.sh
ulimit -c unlimited
LD_PRELOAD=/flash0/libasan.so /NDS/bin/PWM_Process


mkdir /flash0
mount -o nfsvers=4 10.209.62.106:/home/kyoupark/si_logs/flash0-asan-v6-with-recover/flash0 /flash0

export LD_PRELOAD=/flash0/libasan.so
// LD_PRELOAD=/usr/lib/libforcesched.so:/lib/libresolv-refresh.so:/lib/libifnameindex.so:/usr/lib/libmutex-desched.so  /NDS/bin/PWM_Process

mkdir /flash0
mount -o nfsvers=4 10.209.62.106:/home/kyoupark/asn /flash0

export ASAN_OPTIONS="verbosity=2"
export ASAN_OPTIONS="verbosity=2:halt_on_error=0"
export LD_LIBRARY_PATH="/flash0:${LD_LIBRARY_PATH}"

// since /root/run.sh is read-only, made this file in /flash0 and set
// LD_PRELOAD there.
//
// rather than LD_PRELOAD=/flash0/libasan.so /flash0/scripts/startstack.sh
//
// note: this also pick ups asan
// /flash0/fs/NDS/bin/FusionConfigImport: error while loading shared libraries: libasan.so.3: cannot open shared object file: No such file or directory
//
// can be fixed by using:
// export LD_LIBRARY_PATH="/flash0:${LD_LIBRARY_PATH}"
//
// note:
// ==1779==ASan runtime does not come first in initial library list; you should either link runtime to your application or manually preload it with LD_PRELOAD.
//
// /flash0/run.sh
// ulimit -c unlimited
// LD_PRELOAD=/usr/lib/libforcesched.so:/lib/libresolv-refresh.so:/lib/libifnameindex.so:/usr/lib/libmutex-desched.so \
// /NDS/bin/PWM_Process
//
// note:
// with/without this, both still show the above error. With this, can see
// verbose message from asan but asan stops on:
//
// ==1350==AddressSanitizer Init done
//
// LD_PRELOAD=/flash0/libasan.so:

/flash0/scripts/startstack.sh

LD_PRELOAD=/flash0/libasan.so gdb /NDS/bin/PWM_Process

ulimit -c unlimited
LD_PRELOAD=/flash0/libasan.so /NDS/bin/PWM_Process

~/x-tools/i686-nptl-linux-gnu/bin/i686-nptl-linux-gnu-gcc -g -fsanitize=address uaf.c -o out_uaf_use_4

export LD_LIBRARY_PATH=".:${LD_LIBRARY_PATH}"
export ASAN_OPTIONS="verbosity=2:halt_on_error=0"


<vstb>
[root@vSTB lib]# ./ld-2.23.so


# ============================================================================
#{
={============================================================================
|kt_dev_si_0002| si-jabber

http://benmorgan.com.au/blog/cisco-jabber-save-chat-history-to-outlook/

Cisco Jabber: Save Chat History to Outlook

C:\Program Files (x86)\Cisco Systems\Cisco Jabber\jabber-config-defaults.xml

  <!-- Exchange -->
  <userConfig name="SaveChatHistoryToExchangeOperationMode" value="EnabledByPolicy"/>
  <userConfig name="EnableSaveChatHistoryToExchange" value="TRUE"/>
  <userConfig name="ExchangeAuthenticateWithSystemAccount" value="TRUE"/>
  <userConfig name="archive_im_on_exchange" value="TRUE"/>
  <userConfig name="ExchangeDomain" value=""/>


={============================================================================
|kt_dev_si_0002| si-jira

project = SI AND issuetype = Bug AND status in (Open, "In Progress", Reopened, Blocked, Deferred) AND "Product Release" in ("Release 15", "Release 16") AND Severity in (Minor, Major, Showstopper) ORDER BY cf[10010] ASC, Priority DESC, Severity DESC, "Product Sub-Release"

Type = Bug AND project = NGDEV AND component = "Systems Integration" AND (Country is EMPTY OR Country in (Sky_UK)) AND status not in (resolved, "Ready For Test", closed) AND "Epic Link" in (NGDEV-98367) ORDER BY priority, Created DESC


={============================================================================
|kt_dev_si_0002| si-links

http://ndpedia.il.nds.com/index.php/Fusion/DMS/TestPlan | | DMS
http://ndpedia.nds.com/index.php/Fusion/DMS/TestPlan | | DMS
http://10.209.51.91:8081/index.html || DMS SPY
http://ci.uk.nds.com//tracker/ || DMS tracker
http://air.uk.nds.com/tracker/

https://www.stb.bskyb.com/confluence/display/Relmgmt/Release+Management | SKY | Release Management
https://www.stb.bskyb.com/confluence/display/docs/Middleware+Document+Library | SKY | Docs
https://www.stb.bskyb.com/confluence/display/Relmgmt/Release+11 | SKY | Release 11

https://www.stb.bskyb.com/jira/projects/SI | SI | jira
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?MAC=0019FBF2D46B | SI | wobmat: BOX 6B
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?MAC=0019FB63D645 | SI | wombat: BOX 45
http://theyard.cisco.com/missing/checklog.php?log=1f047ae19daf49d912235e7d884ee5e4 | SI | web check log

http://hetty.cisco.com/fusionmadesimple/index.php/Log_Parser | FMS | Log Parser
http://hetty.cisco.com/fusionmadesimple/index.php/TEST_LOG | FMS | Log Parser
http://hetty.cisco.com/fusionmadesimple/index.php/FillDisk | FMS | FillDisk
http://hetty.cisco.com/fusionmadesimple/index.php/SIProcesses#Requesting_retests_for_Brentwood_Stress_defects | FMS | process - brentwood
http://hetty.cisco.com/fusionmadesimple/index.php/SI-101 | FMS | SI-101
https://docs.cisco.com/share/page/site/nextgen-edcs/document-details?nodeRef=workspace://SpacesStore/df081074-9288-4b35-af48-34fe45cce120 | FMS | Doc Central
http://hetty.cisco.com/fusionmadesimple/index.php/Building_GDB | FMS | Building GDB
http://hetty.cisco.com/fusionmadesimple/index.php/Git_Fusion_standard_workflow | Git Fusion standard workflow - Fusion Made Simple
http://hetty.cisco.com/fusionmadesimple/index.php/Core_dumps_on_theyard | Core dumps on theyard - Fusion Made Simple
http://hetty.cisco.com/fusionmadesimple/index.php/Full_Stack_-_BSKYB | Full Stack - BSKYB - Fusion Made Simple
http://hetty.cisco.com/fusionmadesimple/index.php/MiscellaneousGaudiTips#Sky_Viewing_Cards | MiscellaneousGaudiTips - Fusion Made Simple
http://hetty.cisco.com/fusionmadesimple/index.php/Main_Page#Darwin_in_depth | Fusion Made Simple

http://hudkinsflipper.cisco.com/walrus/flipper/ | BLD | F.L.I.P.P.E.R
http://hetty.cisco.com/fusionmadesimple/index.php/Flipper_SI_scripts | BLD | Flipper SI scripts
http://hetty.cisco.com/fusionmadesimple/index.php/Creating_and_Releasing_a_Darwin_SI_Baseline_via_Git | BLD | make a build
http://hudsonmaster1.uk.nds.com:8080/hudson/view/Maintenance/job/generate_fullstack_table/lastSuccessfulBuild/artifact/FSI.html | BLD | search FSI
http://hudsonmaster1.uk.nds.com:8080/hudson/job/AutoSign_RequestSigning_Live/ | BLD | auto sign
http://hudsonmaster1.uk.nds.com:8080/hudson/view/WALRUS/job/build_fullstack_image/ | BLD | build_fullstack_image
http://engci-maven.cisco.com/artifactory/STB_BIN-repo/third_party/BSKYB_JTH/ | BLD | STB_BIN-repo/third_party/BSKYB_JTH
http://10.209.56.204/cgi-bin/t.sh | BLD | Compare Build Folders
http://hudsonmaster1.uk.nds.com:8080/hudson/ | BLD | Releases PVR [Jenkins]
http://manatee.cisco.com/Manatee | BLD | manatee

http://wwwin-tools.cisco.com/itsm/mailer/welcome.do | CISCO | Mailer
http://wwwin-tools.cisco.com/dir/details/kyoupark | CISCO | Directory | Kyoungtaek Park
https://wwwin-git-gpk-2.cisco.com:8081/#/admin/projects/ | CISCO | Code Review

https://wiki.cisco.com/display/DEVTEST/Linux+Mint+13+on+Thinkpad+W520 | CISCO | Linux Mint 13 on Thinkpad W520 - DEVTEST DevTest Team - IT Wiki
https://www.stb.bskyb.com/confluence/pages/viewpage.action?spaceKey=2016&title=Creating+Test+Requests

<search-tag>
http://tbird2.cisco.com/repo/list


={============================================================================
|kt_dev_si_0002| si-feature-team
lynx-sm@cisco.com and beagle-sm@cisco.com. If those don't work, use
@external.cisco.com. 

Those lists will get you to the current scrum masters (they rotate around the
team, which is why we use the mailing lists). 


={============================================================================
|kt_dev_si_0002| si-box

The Amstrad DRX890 is a Broadcom 7335 based box
The Amstrad DRX595 is a Broadcom 7350 based box

<box-up> dynamic ip
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?MAC=0019FBF2D46B
0019FBF2D46B  
mysql --batch --table --column-names -u root uploads -e "select upload_time, version, directory_name, viewing_card from upload where mac='0019FBF2D46B' order by upload_time desc limit 10"
ftpsky "ls *_00019FBF2D46B_*" 
ftpsky "ls *_00019FBF2D46B_*" | grep 'Mar 27'

<box-down> dynamic ip
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?MAC=0019FB63D645
mysql --batch --skip-column-names -u root uploads -e "select upload_time, version, directory_name, parser_result from upload where mac='0019FB63D645' order by upload_time desc limit 10"


<kernel-verion>
Linux drx890 2.6.18.8 #2 Thu Nov 17 16:01:46 GMT 2016 7335a0 unknown
Linux version 2.6.18.8 (jenkins@hudkinsslave17.cisco.com) (gcc version 4.2.0 20070124 (prerelease) - BRCM 10tsHound-20140508) #2 Thu Nov 17 16:01:46 GMT 2016


<fsn_data>
/mnt/nds/dev_6/part_0/FSN_DATA


<mtd>
# 595 box 
# mtd devices
sh-3.2# cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 0f800000 00020000 "rootfs"
mtd1: 0ff00000 00020000 "all"
mtd2: 00400000 00020000 "kernel"
mtd3: 00400000 00020000 "cfe"
mtd4: 03c00000 00020000 "nor"


={============================================================================
|kt_dev_si_0002| si-box-sceret-screen

1. Press "Services" button on remote control
2. Enter "001" and press "Select" to access setup screen 


={============================================================================
|kt_dev_si_0002| si-box-mount

udhcpc -nR -t3 -T5

mkdir /mnt/tmp
// from a box and 10.209.62.232 is ukstbuild02 which shares all under /home
mount -o rw -t nfs 10.209.62.233:/home/NDS-UK/kyoupark/ /mnt/tmp
// castor-03
mount -o rw -t nfs 10.209.62.106:/home/kyoupark/ /mnt/tmp


// to kit-debian
mount -o rw -t nfs 10.209.56.97:/home/kyoupark/si_logs /mnt/tmp

http://hetty.cisco.com/fusionmadesimple/index.php/Cisco_SG_200-08_Ethernet_Switch

NFS issues

If you got one of the Cisco switches from me, be aware that NFS will not work
through it.

This is because it has a denial of service protection feature that drops TCP
SYN packets on privileged ports, because of
http://en.wikipedia.org/wiki/SYN_flood .

You can’t turn this feature off; you need to upgrade the firmware.

See bug discussion: http://www.viktorious.nl/2013/11/05/cisco-sg200-08-nfs/

This issue is fixed in version 1.0.7.4. 


={============================================================================
|kt_dev_si_0002| si-boot-sign comp-etp


ETP

Ethernet Updater (ETP) is a utility software for use on STBs (Engineering and
    Production) making it easier to automate the process of updating images to
STBs. It is an attempt to improve operational efficiency through time saving,
automation and better rack utilisation. 
  
In essence it is yet another codeloader meant for use within SKY (and its
    businesses), with a view to remove human intervention needed in the
process of software updating Sky+ HD STBs. The images carry a .etp extension
to indicate they are usable with ETP-ready infrastructure. Unlike other
engineering software, ETP is  usable on the Engineering and Production boxes.
This frees us from the limitation to have Engineering boxes on the racks. 

The numbering assigned to signed images are a key to the software update
mechanism. In the field, images can only roll-forward i.e. go from lower to
higher signed number. As a result, the development and test builds were
constantly up-signed in order to supersede the old images. While the maximum
number image numbers supported is large, it is still finite. 

The ETP thus was designed to allow development and test environments to load
and overwrite images, `without the constraint of up-signed image numbering.`

Prod      : managed manually by programmes, increment accordingly
Prod Trial: managed manually by programmes, increment accordingly
SNUG      : managed by cisco
Eng       : any less than WIPE
Devel     : 1
ETP       : Picasso 4998, SKY Q 2998

Who can sign?
Most of the test teams at Sky use ETP builds which need to be signed by one of
the SI Team Leads. The people who can ETP sign builds are….


={============================================================================
|kt_dev_si_0002| si-boot-start-mw

note:
'build_mw_epg.sh' builds /etc and /NDS for images to flash
# - snippet from the end of running
#
# Creating middleware epg package
#./
#./etc/
#./etc/start-mw.sh
#./NDS/
#./NDS/bin/
#./NDS/bin/SCD_Process
#./NDS/bin/MW_Process
#./NDS/bin/APP_Process
#./NDS/bin/CA_Process

<boot>
// /etc/init.d/rcS

if [ -e /etc/start-mw.sh ]; then
    /etc/start-mw.sh
fi

<nds-drivers>
if [ -e /etc/load-nds-drivers.sh ]; then
insmod /lib/modules/2.6.18.8/mhxnvramfs.ko
insmod /lib/modules/2.6.18.8/xtvfs.ko

// -sh-3.2# cat load-nds-drivers.sh
// #!/bin/sh
// insmod /lib/modules/2.6.18.8/mhxnvramfs.ko
// insmod /lib/modules/2.6.18.8/xtvfs.ko


<boot-start-mw>
// generated from build_mw_epg.sh
// /etc/start-mw.sh  *start-mw*

#!/bin/sh
echo
echo "##########################"
echo "# Loading NDS middleware #"
echo "##########################"
echo
echo "####################################"
echo "# Middleware starting in 5 seconds #"
echo "# Hit ctrl-C to cancel             #"
echo "####################################"
echo
stty brkint
sleep 5 || exit
ulimit -c unlimited
mkdir -p /mnt/nds
chgrp NDS_MW /mnt/nds
chown NDS_U2 /mnt/nds
mkdir -p /mnt/nds/disk/FSN_DATA && mount -t tmpfs none /mnt/nds/disk/FSN_DATA -o ro
killall udhcpc || true
OVERRIDE_LOCATION=asbo.bskyb.com:/home/asbo/mac
SERVER=`echo ${OVERRIDE_LOCATION} | cut -d":" -f1`
SCRIPT_PATH=`echo ${OVERRIDE_LOCATION} | cut -d":" -f2`
OVERRIDE_DIR=/tmp/override_dir
echo "Enabling udhcp"
udhcpc -nR -t3 -T5
ping -W 1 -c 1 ${SERVER} && (
MAC_ADDR=`ifconfig eth0 | grep HWaddr | head -n1 | tr -s " " | cut -d" " -f5`
mkdir -p ${OVERRIDE_DIR}
echo "mount ${SERVER}:${SCRIPT_PATH}/${MAC_ADDR} ${OVERRIDE_DIR}"
mount ${SERVER}:${SCRIPT_PATH}/${MAC_ADDR} ${OVERRIDE_DIR}
if [ -x "${OVERRIDE_DIR}/runme.sh" ]; then
    ${OVERRIDE_DIR}/runme.sh
    umount ${OVERRIDE_DIR}
else
    echo "OVERRIDE script failed to be executed: ${OVERRIDE_LOCATION}"
fi
)
killall udhcpc
   udhcpc -nR -t3 -T5
mkdir -p /mnt/nds/hudson_18_07_16_16_20_55
mount -o mountport=892 theyard.cisco.com:/home/si_logs/si_devel_posts/hudson_18_07_16_16_20_55  /mnt/nds/hudson_18_07_16_16_20_55
cp -f /mnt/nds/hudson_18_07_16_16_20_55/*_Process /NDS/bin/
chmod a+x /NDS/bin/*_Process
umount /mnt/nds/hudson_18_07_16_16_20_55
rm -rf /mnt/nds/hudson_18_07_16_16_20_55
   killall udhcpc
mkdir /mnt/nds/tmp
mount /dev/sda1 /mnt/nds/tmp
UPNPUAID_PATH=/mnt/nds/tmp/FSN_DATA
if [ ! -f ${UPNPUAID_PATH}/UPNPUAID ]; then
   echo "######################"
   echo "Creating UPNP Agent ID using MAC"
   echo "######################"
   echo "Grabbing MAC"
   MACADDR=`ifconfig -a | grep ^eth0|sed -e s/.*HWaddr[[:space:]]// -e s/://g -e s/[[:space:]]//g`
   echo "USERAGENTID=$MACADDR" > ${UPNPUAID_PATH}/UPNPUAID
fi
if [ -f ${UPNPUAID_PATH}/UPNPUAID ]; then
   echo "######################"
   echo "Changing UPNP Agent ID"
   echo "######################"
   UAID=`cat ${UPNPUAID_PATH}/UPNPUAID | sed s/USERAGENTID=//`
   sed -i "s/FILTERING_ENABLED.*/FILTERING_ENABLED=TRUE/" /NDS/config/libupnp.cfg
   sed -i "s/PRODUCTNAME=.*/PRODUCTNAME=\"$UAID\"/" /NDS/config/libupnp.cfg
   sed -i "s/PRODUCTNAME_FILTER=.*/PRODUCTNAME_FILTER=\"$UAID\"/" /NDS/config/libupnp.cfg
fi
umount /mnt/nds/tmp
rmdir /mnt/nds/tmp

// *comp-config*
cd /NDS/config
/NDS/bin/FusionConfigImport CFG2BIN ./ *

cd /etc
PATH_RESCONF=`readlink /etc/resolv.conf`
if [ -f ${PATH_RESCONF} ]; then
   echo "resolv.conf exists. Deleting ${PATH_RESCONF}"
   rm -f ${PATH_RESCONF}
fi
cd /tmp
export LD_PRELOAD=/usr/lib/libforcesched.so:/lib/libresolv-refresh.so:/lib/libifnameindex.so
/NDS/bin/PWM_Process


={============================================================================
|kt_dev_si_0002| si-boot-pwm

<startstack-sh>
/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/release/startstack.sh

*diag-config*
cd /flash0/fs/NDS/config
/flash0/fs/NDS/bin/FusionConfigImport CFG2BIN ./ *

if [ -f /flash0/scripts/this_is_first_boot ]
then
    rm /flash0/scripts/this_is_first_boot
    echo "This is first boot; enable format"
    /flash0/scripts/unified_startup.sh . /flash0 FORMAT NORUN $SERIAL $*
else
    echo "Reboot app - keeping recordings and data"
    /flash0/scripts/unified_startup.sh . /flash0 NOCLEAN NODELETE NORUN $SERIAL $*
fi

/root/run.sh


<unified-startup-sh>
note:
What is it for?
deps/FUSIONOS_OUTPUT_DEL_2/KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/Scripts/unified_startup.sh

# unified_startup.sh FORMAT NORUN
#
# In sum, 
# FORMAT will format sda or delete db and recordings
# NORUN will setup env for MW or for test env.
#
# 1. copy xtvfs_format on to box:/usr/bin (actually not used)
# 2. make dirs. no effect appart from /NDS
# 3. untar driver file on to box:/. This includes ko and script files:
#        etc/bumpup.cfg
#        etc/load-cdi-drivers.sh
#        lib/modules/2.6.18.8/callisto_drx890.ko
#        lib/modules/2.6.18.8/callisto_periph.ko
#        lib/modules/2.6.18.8/callisto_tuner.ko
# 
# 4. run /etc/load-cdi-drivers.sh, nfs:/drivers/xtvfs.ko, nfs:/drivers/jhmknods_nds.sh, and nfs:/drivers/mhxnvramfs.ko
#    if NOCLEAN=false(default), populate nvram?.bin to /dev/nds/nvram[01].bin. (actually no effect since no nvram?.bin in nfs.)

# 5. if FORMAT=true, delete /dev/sda3,4 (no effect since there aren't 3, 4 partiiton in a box)
# 6. if FORMAT=true, delete /dev/sda1,2. create /dev/sda1 with FAT12 and format it using xtvfs_format. formatting xtvfs will create own file and dirs.
# 7. if NOCLEAN=false(default), delete /dev/sda1/FSN_DATA/* for dbs and /dev/sda1/* for recodring. Actually, has an effect only when not use FORMAT.
# 8. copy nfs:/fs/NDS/* on to /NDS
# 9. mount sysfs on /sys (no effect since already done after boot)
# 10. copy nfs:/drivers/libs on to /usr/lib, run /etc/bumpup.sh (no effect), delete /tmp/* and /fifo/*
#
# Once system loaded, see that there are fs mounded. Done by MW?
#   /dev/nds/nvram0 on /mnt/nds/dev_2/part_0 type MHNVRAMFS (rw,nosuid)
#   /dev/sda1 on /mnt/nds/dev_5/part_0 type xtvfs (rw,nosuid)


<ex>
# to use with kernel only env.
udhcpc
mkdir /host
mount -t nfs 172.18.253.143:/home/NDS-UK/parkkt/cc/parkkt_BSKYB_GM_01/vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian /host
cd /host
./unified_startup.sh . /host FORMAT NORUN
./unified_startup.sh . /host NORUN
LD_PRELOAD=/usr/lib/libforcesched.so /NDS/bin/SCD_Process
LD_PRELOAD=/NDS/lib/cdi_tracker.so /usr/lib/libforcesched.so /NDS/bin/SCD_Process
LD_PRELOAD=/NDS/lib/cdi_tracker.so /usr/lib/libfollrcesched.so /NDS/bin/SCD_Process_us
LD_PRELOAD=/usr/lib/cdi_tracker.so /usr/lib/libforcesched.so /usr/lib/libresolv-refresh.so /usr/lib/libifnameindex.so /NDS/bin/SCD_Process

# FOSH
mount -t nfs 172.18.253.143:/home/NDS-UK/parkkt/fob/595/fosh/Darwin97350_BE/debug/FOSH/NDS /NDS

<run-sh>
[root@vSTB flash0]# more /root/run.sh
ulimit -c unlimited
LD_PRELOAD=/usr/lib/libforcesched.so:/lib/libresolv-refresh.so:/lib/libifnameindex.so:/usr/lib/libmutex-desched.so \
/NDS/bin/PWM_Process

this is read-only since it is part of fs. To change this file, modify
startstack.sh to run a different file in somewhere else.

<pwm-process>
# MSCQ181809
# PWM_Process is the start binary (instead of SCD for WP2807)
# We are waiting on the platforms to change unified_startup.sh so just replace all instances of SCD with PWM
/NDS/bin/PWM_Process

/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/mw_process_main.c
drwxrwxrwx  2 kyoupark ccisco 4096 Oct 18 09:46 APP_Process/
drwxrwxrwx  2 kyoupark ccisco 4096 Oct 18 09:46 CA_Process/
drwxrwxrwx  2 kyoupark ccisco 4096 Oct 18 09:46 STM_Process/
drwxrwxrwx  2 kyoupark ccisco 4096 Oct 18 09:46 SCD_Process/
drwxrwxrwx  2 kyoupark ccisco 4096 Oct 18 09:46 PWM_Process/


={============================================================================
|kt_dev_si_0002| si-bootlog

# trial-boot-scripts

// from *build-mw-epg* 

  # Enable FTP uploading for Trials only
  if [ -z "$UPLOAD" ]; then
    if ([ ${PROFILE} =  "sky_trials" ] || [ ${PROFILE} =  "mem_trials" ] || [ ${PROFILE} =  "cust_trials" ]); then
       UPLOAD=1
      # Enable new BOOTLOG Mechanism to upload logs for trials builds
       BOOTLOG=1
    fi
  else
    [ "$UPLOAD" = 0 ] && unset UPLOAD
  fi

      if [ -n "$BOOTLOG" ]; then
        echo 'echo'
        echo 'echo "###########"'
        echo 'echo "# Bootlog #"'
        echo 'echo "###########"'
        echo 'echo'
        # Call Bootlog and if upload is set upload the logs
        if [ -n "$UPLOAD" ]; then
          echo "/usr/bin/bootlog.sh  upload $LOGUPLOADMETHOD"
        else
          echo '/usr/bin/bootlog.sh '
        fi
      fi

// from start-mw.sh which made from *build-mw-epg* *start-mw*

/usr/bin/bootlog.sh 15 1024 upload
run CFG2BIN
call SCD process

# http://hoover.uk.nds.com/fusionmadesimple/index.php/Boot_Log
# /FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/bootlog


<bootlog-readme>

TYPES OF ROTATION
=================
There are 2 types of rotation:

1) BOOTLOG ROTATE
   On reboot. The diag logs along with other bits like nvram, pcat, file list,
   info etc are packed into a folder named BOOTLOG.
   This is then uploaded. The BOOTLOG folder from the previous reboot is renamed
   as BOOTLOG.1, and BOOTLOG.1 as BOOTLOG.2, and so on, until a max of 15 for
   890 and 3 for 595 is reached. The max number is defined in bootlog-config.sh.
   (See MAX_BOOTLOG_ROTATE in bootlog-config.sh)

2) RLOG ROTATE
   The other type of rotation is for the current log.  When current log reaches
   a max size, it will trigger DIAG to itself rotate the file - this happens by
   DIAG renaming the Sxxx.CUR(S<pid>.CUR) as Sxxx.LOG file and starting a blank
   new Sxxx.CUR file. The background rotation script (bootlog-copyrotated.sh)
   then detects this .LOG file and copies/moves it into the RLOG folder with a
   timestamp filename as <timestamp>.LOG.
   The max size is defined in diag-binary.cfg. At present there is a system
   override in SI_Config.xml.  This is set to 20 MB for now. as <timestamp>.LOG.
   (See MAX_RLOG_ROTATE_COPY in bootlog-config.sh)


<bootlog-config>
# -sh-3.2# cat /etc/hostname
# drx890

  # Source storage device to mount
  `BLOG_mntdev`="/dev/sda1"

  # Mount point of data partition
  BLOG_mntpath="/tmp/dummydisk/BLOGDIR"

  # Path where data/logs are stored
  `BLOG_DATAPATH`="${BLOG_mntpath}/FSN_DATA"

  # Maximum memory available  and maximum number of log rotations on reboot i.e Bootlogs
  MAX_MEM_FOR_LOG_MB=1024
  MAX_OLD_BOOTLOG_ROTATE=15
  MAX_BOOTLOG_ROTATE=6
  # RLOG step size is now set to 20 Mb in diag_binary.cfg
  MAX_RLOG_ROTATE_COPY=19

FSN_ROOT="/mnt/nds"

# Rotated LOG Path where rotated logs will be moved
BLROTATED="${BLOG_DATAPATH}/RLOG"

# Path where INFO.TXT file is stored;
# INFO.TXT includes version info about the system;
BLINFOPATH="${BLOG_DATAPATH}/VERINFO"


<bootlog-sh> main
# Usage: bootlog.sh <rotate limit> <size limit> [upload]
#
# check if it's already mounted.
grep -q "${BLOG_mntpath}" /proc/mounts

  # mounts
  mount "${`BLOG_mntdev`}" "${`BLOG_mntpath`}" || exit $?

#
/usr/bin/bootlog-rotate.sh "$rotate_limit"

*call-bootlog-create*
/usr/bin/bootlog-create.sh

#
/usr/bin/bootlog-diskusage.sh "$rotate_limit" "$size_limit"

*call-bootlog-upload*
# BLL:bootlog.sh: MILESTONE Args: upload = upload, loguploadmethod = http
  if [ -n "$upload" ]; then
    echo "BLL:bootlog.sh: MILESTONE Calling bootlog-upload.sh $loguploadmethod"  >> "${BLLFILENAME}"
    echo "51#>>  PREPARING NETWORK" >> "${UPLOAD_SCREEN_UPDATE}"
    /usr/bin/bootlog-upload.sh "$loguploadmethod"
  else

# Run crash monitor at high priority in background
chrt -r 97 /usr/bin/crash-monitor.sh </dev/null &

# COPY MEMPROF log in background 
chrt -r 2 /usr/bin/bootlog-copymemprof.sh </dev/null &

# umount. updated from 21.15 baseline
umount "${BLOG_mntpath}"


<bootlog-rotate>
# Logs are rotated into numbered directories with the following naming scheme: 
# Higher numbered directories are older. 
# base="/mnt/nds/BLOGDIR/FSN_DATA/BOOTLOG.x"
mv 'BOOTLOG' to 'BOOTLOG.1'


<bootlog-create>

# `BLOG_DATAPATH`="${BLOG_mntpath}/FSN_DATA"
cd "${BLOG_DATAPATH}"/ || exit $?

rm BOOTLOG
mkdir /mnt/nds/BLOGDIR/FSN_DATA/VERINFO

# Copy database files
echo "BLL:bootlog-create.sh: MILESTONE Copy database files (*.DB* to BOOTLOG/)"  >> "${BLLFILENAME}"
cp -a ` *.DB* BOOTLOG/`

echo "BLL:bootlog-create.sh: MILESTONE Create FILES.TXT"  >> "${BLLFILENAME}"
echo "42#        Creating list of files on disk." >> "${UPLOAD_SCREEN_UPDATE}"
# Recursive directory listing of the disk
ls -lR "${BLOG_mntpath}" >BOOTLOG/FILES.TXT


mv ${BLINFOPATH}/INFO.TXT LOG LOG.* *.LOG *.CUR *.COR *.TXT BOOTLOG/

*call-bootlog-makeinfo*
# [bootlog-mkinfo.sh] create info file, nvram file, etc..
/usr/bin/bootlog-mkinfo.sh >${BLINFOPATH}/INFO.TXT

# # Middleware version
# grep NDS_SW_VERSION /NDS/config/version.cfg && echo
# 
# # CDI version information properties
# /usr/bin/cdi-vi STBM_NAME MODEL_VER STB_ID && echo
# 
# # Linux kernel version
# uname -a
# cat /proc/version && echo
# 
# # CDI driver version
# cat /proc/callisto/version && echo
#
# INFO.TXT
# --------
# NDS_SW_VERSION="84.51.00_1809_MNTEE"
# 
# STBM_NAME="Sky"
# MODEL_VER="4f317e"
# STB_ID="16c8d522"
# 
# Linux drx890 2.6.18.8 #2 Tue Oct 18 10:13:08 BST 2016 7335a0 unknown
# Linux version 2.6.18.8 (jenkins@hudkinsslave10.cisco.com) (gcc version 4.2.0 20070124 (prerelease) - BRCM 10tsHound-20140508) #2 Tue Oct 18 10:13:08 BST 2016
# 
# Software version: Rev 4606 for darwin-spk-1.19 debug built 19-05-2016
# Running on 7335 B0


*update-version-history*
cat /NDS/config/version.cfg >>${BLOG_DATAPATH}/VERHIST
cp -f ${BLOG_DATAPATH}/VERHIST  ${BLOG_DATAPATH}/BOOTLOG/VERHIST.LOG


<bootlog-upload>
# Do upload
logdir="${BLOG_DATAPATH}"/BOOTLOG

*call-bootlog-upload-1*
if /usr/bin/bootlog-upload-1.sh "$logdir" &>/tmp/UPLOAD.LOG; then
  echo '---- UPLOAD COMPLETE ----' >>"$logdir"/UPLOAD.LOG
  cat /tmp/UPLOAD.LOG >>"$logdir"/UPLOAD.LOG

  # Remove global log file if upload succeeded
  rm -f "${BLOG_DATAPATH}"/UPLOAD.LOG
else

*bootlog-log*
cat /tmp/UPLOAD.LOG >>"${logdir}"/UPLOAD.LOG
echo "BLL:bootlog-upload.sh: INFO Copy(eth0) of /tmp/UPLOAD.LOG BEGIN"  >> "${BLLFILENAME}"
cat /tmp/UPLOAD.LOG >> "${BLLFILENAME}"
echo "BLL:bootlog-upload.sh: INFO Copy(eth0) of /tmp/UPLOAD.LOG END"  >> "${BLLFILENAME}"

# Disable "online" LED
/usr/bin/cdi-fpi 0 0 0

<bootlog-upload-1-sh>
note: only do uploads when bootlog-upload-pi.sh fails.

# FTP settings
host=87.86.191.132
user=anonymous
pass=upload@sky.com
path=upload

# Enable "online" LED
# "usage: cdi-fpi <index> <state> <luminosity>\n"
/usr/bin/cdi-fpi 0 1 1

# note: set files to upload which can be different from what's copied from
# bootlog-create.

# Create tarball. upload 'BOOTLOG'
tar -c \
  "${BLOG_DATAPATH}"/UPLOAD.LOG \
  "$logdir"/LOG \
  "$logdir"/*.LOG \   # previous binary DIAG log
  "$logdir"/*.CUR \   # current binary DIAG log
  "$logdir"/*.TXT \
  "$logdir"/MFS.DB \
  "$logdir"/PCAT.DB \
  "$logdir"/REMBOOK.DB \
  "$logdir"/NVRAM0.BIN \
  "$logdir"/NVRAM1.BIN \
  "$logdir"/*.COR \ 
| gzip >"$logdir"/UPLOAD || exit $?


# get mac
# -sh-3.2# cat /sys/class/net/eth0/address
# 00:10:18:00:12:00
# 
cut -c1-2,4-5,7-8,10-11,13-14,16-17 </sys/class/net/eth0/address

note: use httpsend

# Send the tarball
# if [ "$use_ftp" = "ftp" ] ; then
#   echo "BLL:bootlog-upload.sh: MILESTONE Send Tarball by FTP: ${srcfile} to ${destfile}"  >> "${BLLFILENAME}"
#   echo "67#        Uploading logs via FTP on ${interface}." >> "${UPLOAD_SCREEN_UPDATE}"
#   echo "Uploading to ftp://$user@$host/$destfile"
#   ftpput -u "$user" -p "$pass" "$host" "$destfile" "$srcfile" || exit $?
#   echo "BLL:bootlog-upload.sh: MILESTONE Upload complete"  >> "${BLLFILENAME}"
#   echo "ftp://$user@$host/$destfile" >"$logdir"/UPLOAD.URL
elif [ "$use_ftp" = "http" ] ; then
  # name of the file to be httpsend does not matter.Could be anything.
  # The way the naming of the upload file works is: generate the file,any name (UPLOAD) --> using md5sum generate the name and for records store in UPLOAD.URL
  # --> Upload the file, any name (UPLOAD)  --> in httpsend sky renames it as "2014-07-08_14-08-21_00:19:fb:f1:71:d8_10.10.8.54.tgz" --> On theyard, it regenerates the md5 sum name
  echo "BLL:bootlog-upload.sh: MILESTONE Upload via HTTP on $interface , srcfile: ${srcfile}, md5name: $md5name"  >> "${BLLFILENAME}"
  echo "67#        Uploading logs via HTTP on ${interface}." >> "${UPLOAD_SCREEN_UPDATE}"
  /sbin/httpsend "$macaddr" "$srcfile" || exit $?
  `echo "$md5name" >"$logdir"/UPLOAD.URL`   *upload-url* *upload-filename*
  echo "BLL:bootlog-upload.sh: MILESTONE Delete compressed and zipped UPLOAD file: ${srcfile}"  >> "${BLLFILENAME}"
  rm "$srcfile" || exit $?
fi
echo "BLL:bootlog-upload.sh: MILESTONE Upload finished"  >> "${BLLFILENAME}"

<upload-log>
BLL:bootlog-upload-pi.sh: MILESTONE START_OF_SCRIPT
Uploading V2.0 (3)(00:19:fb:63:d6:45)(/tmp/dummydisk/BLOGDIR/FSN_DATA/BOOTLOG/UPLOAD.TGZ)
filelen = 1895987
Connecting to server...(80)(drop.stb.bskyb.com)(50ee01ba)
Sending header...
Sending header... complete
Sending payload string or binary...
Sending payload via callback...
currpos = (247568/1895987)
currpos = (491520/1895987)
currpos = (745472/1895987)
currpos = (991232/1895987)
currpos = (1236992/1895987)
currpos = (1482752/1895987)
currpos = (1720320/1895987)
currpos = (1895987/1895987)
Receiving response...
Received 761/761 bytes
Response header:
HTTP/1.0 200 OK
Date: Thu, 12 Jan 2017 15:18:16 GMT
Server: Apache/2.2.17 (Unix)
Uploaded-file: 2017-01-12_15-18-17_00:19:fb:63:d6:45_173.38.209.9.tgz
Content-Type: text/html; charset=ISO-8859-1
Via: 1.0 aer01-mda2-dmz-wsa-4-mgmt.cisco.com:80 (Cisco-WSA/9.0.1-162)
Connection: keep-alive

Response header:
HTTP/1.0 200 OK
Date: Thu, 12 Jan 2017 15:18:16 GMT
Server: Apache/2.2.17 (Unix)
Uploaded-file: 2017-01-12_15-18-17_00:19:fb:63:d6:45_173.38.209.9.tgz
Content-Type: text/html; charset=ISO-8859-1
Via: 1.0 aer01-mda2-dmz-wsa-4-mgmt.cisco.com:80 (Cisco-WSA/9.0.1-162)
Connection: keep-alive


# [crash-monitor.sh]
# Set core dump location and format
echo '/tmp/%p.COR' >/proc/sys/kernel/core_pattern

# The crash monitor is a process which runs in the background checking for
# core dumps and then copying them to the disk when they appear.  The core
# dumps are written to /tmp/<pid>.COR by the kernel. The crash monitor copies
# these to /FSN_DATA/.  Looking at the date of the core files may give you a
# clue as to when a crash occurred. 


<bootlog-manual-upload>
http://hetty.cisco.com/fusionmadesimple/index.php/SkyTrialsInfo

Instructions for manually uploading to FTP site[edit]

You can TAR the BOOTLOG directory (and any other directory) to upload the ftp
server using ftpput. However, please note that doing this whilst the
middleware is running can lead to side-effects that later cause other issues,
           therefore, it is strongly recommended that after doing the manual
             upload, the STB is rebooted.

Run “Putty” with “telnet” option, “Host Name (or IP address)” as the IP address of the STB and “port” as default (23)

Enter login password as “root”. You should now be in the shell terminal

/usr/bin/bootlog-uploadManual.sh X (The "X" specifies how many previous logs to upload, 1 if you've rebooted once)

Wait for the upload to complete and make a note of the uploaded files (starting darwin_*.tgz_). E.g.

 * UPLOAD.TGZ = httpsend /tmp/darwin_*MAC Address*_*MD5 checksum*.tgz - Equivalent to BOOTLOG (Previous run)
 * UPLOAD1.TGZ = httpsend /tmp/darwin_*MAC Address*_*MD5 checksum*.tgz - Equivalent to BOOTLOG.1 (1 run previous)
 * UPLOAD2.TGZ = httpsend /tmp/darwin_*MAC Address*_*MD5 checksum*.tgz - Equivalent to BOOTLOG.1 (2 runs previous)
 * UPLOADX.TGZ = httpsend /tmp/darwin_*MAC Address*_*MD5 checksum*.tgz - Equivalent to BOOTLOG.1 (X runs previous)
 * UPLDFSN.TGZ = httpsend /tmp/darwin_*MAC Address*_*MD5 checksum*.tgz - Equivalent to FSN_DATA (Current run)
 * UPLOADURL.TGZ= httpsend /tmp/darwin_0019fbfeedde_70a4e2fd32222759a1049d92b184d0f9.tgz - List of the above files
 *
Send SI the darwin*.tgz file corresponding to the upload required

<ex>
-sh-3.2# /usr/bin/bootlog-uploadManual.sh 2
+ VERSION=1.1
+ DATE=04/02/2016
+ echo '###########################################################'
###########################################################
+ echo '# /usr/bin/bootlog-uploadManual.sh 2                                                  '
# /usr/bin/bootlog-uploadManual.sh 2
+ echo '# Last Modified Date: 04/02/2016                              '
# Last Modified Date: 04/02/2016
+ echo '# VERSION: 1.1                                      '
# VERSION: 1.1
+ echo '###########################################################'
###########################################################
+ . /usr/bin/bootlog-fsn_data-config.sh
++ set -xv

LINE=""
++ LINE=

while :
do
  LINE=`grep "/dev/sda.*/mnt/nds/dev" /etc/mtab`
  if [ -n "$LINE" ]; then
    # Copy 2nd tokenized string &  add /FSN_DATA path
    FSN_DATAPATH=`echo "$LINE" | cut -d " " -f2`/FSN_DATA
    break
  fi

  LINE=`grep "/dev/mtdblock.*/mnt/nds/dev" /etc/mtab`
  if [ -n "$LINE" ]; then
    # Copy 2nd tokenized string
    FSN_DATAPATH=`echo "$LINE" | cut -d " " -f2`
    break
  fi

  sleep 30

done
++ :
grep "/dev/sda.*/mnt/nds/dev" /etc/mtab
+++ grep '/dev/sda.*/mnt/nds/dev' /etc/mtab
++ LINE='/dev/sda1 /mnt/nds/dev_6/part_0 xtvfs rw,nosuid 0 0'
++ '[' -n '/dev/sda1 /mnt/nds/dev_6/part_0 xtvfs rw,nosuid 0 0' ']'
echo "$LINE" | cut -d " " -f2
+++ echo '/dev/sda1 /mnt/nds/dev_6/part_0 xtvfs rw,nosuid 0 0'
+++ cut -d ' ' -f2
++ FSN_DATAPATH=/mnt/nds/dev_6/part_0/FSN_DATA
++ break

FSN_ROOT="/mnt/nds"
++ FSN_ROOT=/mnt/nds

# Do not use variables [BLOG_DATAPATH, BLROTATED, BLINFOPATH] for background tasks
# Only use std FSN_DATAPATH variable for background tasks

# RLOG is the switch for the choice of uploading BOOTLOG or RLOG
if [ "$1" == "--rlog" ]; then
  if [ $# -eq 2 ]; then
    uploaded_bootlog_name=$2
    RLOG=1
  else
    echo "The bootlog-uploadManual.sh --rlog command will upload the remaining logs in RLOG folder."
    echo "  Usage: bootlog-uploadManual.sh --rlog <uploaded_bootlog_name>"
    echo "    e.g. bootlog-uploadManual.sh --rlog darwin_0019fbfeedde_71c19dbc8831781ee36061c913e333a4"
    echo "  Usage: bootlog-uploadManual.sh --rlog 0 => Upload logs from current session present in FSN_DATA/RLOG directory"
    exit
  fi
else
# Get 1st parameter: The number of bootlog dirs to upload.
  upload_limit=$1
# Get 2nd parameter: Use FTP
  use_ftp=$2
fi
+ '[' 2 == --rlog ']'
+ upload_limit=2
+ use_ftp=


###############################################################################
# Init
###############################################################################

blghost=87.86.191.132
+ blghost=87.86.191.132
blguser=anonymous
+ blguser=anonymous
blgpass=upload@sky.com
+ blgpass=upload@sky.com
blgpath=upload
+ blgpath=upload

# Default upload_limit is 2
if ! [ -n "$upload_limit" ]; then
  upload_limit=2
fi
+ '[' -n 2 ']'

# Need to restore TCP SYN retries later
syn_retries=`cat /proc/sys/net/ipv4/tcp_syn_retries`
cat /proc/sys/net/ipv4/tcp_syn_retries
++ cat /proc/sys/net/ipv4/tcp_syn_retries
+ syn_retries=5
mtu_probing=`cat /proc/sys/net/ipv4/tcp_mtu_probing`
cat /proc/sys/net/ipv4/tcp_mtu_probing
++ cat /proc/sys/net/ipv4/tcp_mtu_probing
+ mtu_probing=0

echo 1 >/proc/sys/net/ipv4/tcp_syn_retries
+ echo 1
echo 1 >/proc/sys/net/ipv4/tcp_mtu_probing
+ echo 1

# Get MAC address
hwaddr=`cut -c1-2,4-5,7-8,10-11,13-14,16-17 </sys/class/net/eth0/address` || exit $?
cut -c1-2,4-5,7-8,10-11,13-14,16-17 </sys/class/net/eth0/address
++ cut -c1-2,4-5,7-8,10-11,13-14,16-17
+ hwaddr=0019fbf2d46b
macaddr=`cat /sys/class/net/eth0/address` || exit $?
cat /sys/class/net/eth0/address
++ cat /sys/class/net/eth0/address
+ macaddr=00:19:fb:f2:d4:6b

# URL compilation file
url_comp="/tmp/UPLOAD.URL"
+ url_comp=/tmp/UPLOAD.URL
rm $url_comp || true
+ rm /tmp/UPLOAD.URL
rm: cannot remove '/tmp/UPLOAD.URL': No such file or directory
+ true

toobigfilename=
+ toobigfilename=
keeping=
+ keeping=

###############################################################################                                                                                                                      [453/1247]
# Functions
#
# Note that functions are not supported in the msh (Minimal Shell) of the
# pre-prod kernel, but neither is telnet, so this script is only likely to be
# run on builds running the debug kernel (si_devel, sky_trials etc), where
# functions are fine.
###############################################################################

#############################
# sendfile( $zipfilename, $zipfile )
#############################
sendfile()
{
  md5=`md5sum "$2" | cut -c1-32` || exit $?
  src_file=$2

  if [ "$use_ftp" ] ; then
      echo "Uploading to ftp://${blguser}@${blghost}${src_file}"
      dst_file="${blgpath}/darwin_${hwaddr}_${md5}.tgz"
      ftpput -u "${blguser}" -p "${blgpass}" "${blghost}" "${dst_file}" "${src_file}" || exit $?
      echo "$1 = ftp://${blguser}@${blghost}/${dst_file}" >> ${url_comp}
      echo "bootlog-uploadManual.sh:  FTP Upload finished"
  else
      echo "Uploading to http://${blguser}@${blghost}${src_file}"
      md5name="darwin_${hwaddr}_${md5}.tgz"
      # name of the file to the httpsend does not matter.Could be anything.
      # The way the naming of the upload file works is: generate the file,any name (UPLOAD.TGZ)
      # --> using md5sum generate the name and for records store in UPLOAD.URL
      # --> Upload the file, any name (UPLOAD.TGZ)
      # --> in httpsend sky renames it as "2016-02-05_10-10-50_00:19:fb:f1:71:d8_10.10.8.54.tgz"
      # --> On theyard, it regenerates the md5 sum name
      echo "bootlog-uploadManual.sh: Upload via HTTP, file=${src_file}, md5name=${md5name}"
      /sbin/httpsend "${macaddr}" "${src_file}" || exit $?
      echo "$1 = httpsend ${md5name}" >> ${url_comp}
      echo "bootlog-uploadManual.sh:  HTTP Upload finished"
  fi

  rm "${src_file}"
}

#############################
# getFileLists( $logdir )
#############################
getFileLists()
{
  logdir="${1}"

  discarded=
  keeping=

  # Get list of log files
  for i in `ls "${logdir}"/*.LOG`
  do
    # Get size of file
    isize=`ls -s ${i} | awk '{print $1}'`
    if [ ${isize} -le 50000 ]
    then
      # Files to send
      keeping="${keeping} ${i}"
    else
      # Files not sent
      discarded="${discarded} ${i}"
    fi
  done

  # Create file of too-big file filenames
  if [ "${discarded}" ]
  then
    toobigfilename="${logdir}"/TOOBIG.TXT
    echo "The following files need to be processed manually." > ${toobigfilename}
    echo ${discarded} > ${toobigfilename}
  fi
}

#############################
# prepareLogsFrom( $logdir )
#############################
prepareAndSendLogsFrom()
{
  logdir=$1

  postfix=`echo "$logdir" | awk -F. '{print $2}'`
  zipfilename="UPLOAD${postfix}.TGZ"
  zipfile="${FSN_DATAPATH}/$zipfilename"

  # Store IP address assigned
  ifconfig > "${logdir}"/IFCONFIG.LOG

  keeping="${logdir}"/*.LOG
  toobigfilename=

  # If this is a 780 then dont send larger files.
  is780=`grep ARM920T /proc/cpuinfo`
  if [ "${is780}" ]
  then
    getFileLists "${logdir}"
  fi

  if ( grep -qi "drx595" /etc/hostname ); then
    tar -cv \
      "${logdir}"/UPLOAD.* \
      "${logdir}"/LOG \
      $toobigfilename \
      $keeping \
      "${logdir}"/*.CUR \
      "${logdir}"/*.CSV \
      "${logdir}"/*.TXT \
      "${logdir}"/CDB.DB \
      "${logdir}"/MFS.DB \
      "${logdir}"/PCAT.DB \
      "${logdir}"/PSL.BIX \
      "${logdir}"/PSL.DB \
      "${logdir}"/PSL.DBW \
      "${logdir}"/PSL.NSA \
      "${logdir}"/REMBOOK.DB \
      "${logdir}"/NVRAM0.BIN \
      "${logdir}"/NVRAM1.BIN \
      "${logdir}"/*.COR \
    | gzip >"$zipfile" || exit $?
  else
    tar -cv \
      "${logdir}"/UPLOAD.* \
      "${logdir}"/LOG \
      $toobigfilename \
      $keeping \
      "${logdir}"/*.CUR \
      "${logdir}"/*.CSV \
      "${logdir}"/*.TXT \
      "${logdir}"/CDB.DB \
      "${logdir}"/MFS.DB \
      "${logdir}"/PCAT.DB \
      "${logdir}"/PSL.BIX \
      "${logdir}"/PSL.DB \
      "${logdir}"/PSL.DBW \
      "${logdir}"/PSL.NSA \
      "${logdir}"/REMBOOK.DB \
      "${logdir}"/NVRAM0.BIN \
      "${logdir}"/NVRAM1.BIN \
      "${logdir}"/*.COR \
    | gzip -1 >"$zipfile" || exit $?
  fi

  sendfile $zipfilename $zipfile
}

#############################
# prepareAndSendRlogFrom( $logdir )
#############################
prepareAndSendRlogFrom()
{
  logdir=$1
  postfix=`echo "$logdir" | awk -F. '{print $2}'`
  zipfilename="UPLOAD${postfix}.TGZ"
  zipfile="${FSN_DATAPATH}/$zipfilename"
  # Check if any cur files present.
  if ( ls $logdir/RLOG/*.LOG )
  then
    echo "Found some .LOG. Will be stitching and uploading them"
  else
    echo "No .LOG files in the RLOG of $logdir. NO  UPLOAD "
    exit
  fi
  # Have a MANUAL.TXT file for theyard to know that this is a manual upload.store IP address assigned
  ifconfig > "${logdir}"/RLOG/MANUAL.TXT
  # Log parser on the yard uses INFO.TXT file to decode logs. Copying it to RLOG. run cl . to get the logs parsed manually on theyard.
  cp "${logdir}"/INFO.TXT "${logdir}"/RLOG/
  # Stitch together the cur files in RLOG. These would be the remaining one after MAX_RLOG_ROTATE_COPY of these were uploaded as part of regular upload.

  # Get the logname from RLIST.LOG  e.g. "S278.LOG"
  logname=`grep "LOG-" ${logdir}/RLOG/RLIST.LOG | tail -n 1 | cut -d "-" -f 1`;

  # Copy RLIST.LOG to RLIST.TXT as we are deleting all *.LOG files
  cp "${logdir}"/RLOG/RLIST.LOG "${logdir}"/RLOG/RLIST.TXT

  # Loop and stitch
  for ff in `ls $logdir/RLOG/*.LOG`
  do
    cat "${ff}" >> "${logdir}/RLOG/${logname}"
    # The rm is done here because 595 might run out of memory if left for later.
    rm -f  "${ff}"
  done

  # Copy back RLIST.TXT to RLIST.LOG to support manual uploads later when needed on for this log.
  cp "${logdir}"/RLOG/RLIST.TXT "${logdir}"/RLOG/RLIST.LOG

  if ( grep -qi "drx595" /etc/hostname ); then
    tar -cv \
      "${logdir}"/UPLOAD.* \
      "${logdir}/RLOG/${logname}" \
      "${logdir}"/RLOG/MANUAL.TXT \
      "${logdir}"/RLOG/INFO.TXT \
      "${logdir}"/RLOG/RLIST.LOG \
    | gzip >"$zipfile" || exit $?
  else
    tar -cv \
      "${logdir}"/UPLOAD.* \
      "${logdir}/RLOG/${logname}" \
      "${logdir}"/RLOG/MANUAL.TXT \
      "${logdir}"/RLOG/INFO.TXT \
      "${logdir}"/RLOG/RLIST.LOG \
    | gzip -1 >"$zipfile" || exit $?
  fi

  sendfile $zipfilename $zipfile
}

# Get list of bootlog dirs, and process the ones we need to do.
uploadBootlog()
{
  for ff in `find ${FSN_DATAPATH} -iname "BOOTLOG*"  -type d | awk -F. '{print $2"\t"$0}' | sort -n | cut -f 2 | head -n $upload_limit`
  do
    echo "uploading files from $ff"
    prepareAndSendLogsFrom $ff
    tail -1 $url_comp >> $ff/UPLOAD.URL
  done
}
# Upload the RLOG of the matching md5 bname bootlog upload
uploadRlog()
{
  if [ "$uploaded_bootlog_name" = "0" ]; then
      echo "BLL:bootlog-uploadManual.sh: MILESTONE Generate INFO.TXT file. Call bootlog-mkinfo.sh"
      /usr/bin/bootlog-mkinfo.sh >${FSN_DATAPATH}/RLOG/INFO.TXT
      if  [ ! -e ${FSN_DATAPATH}/RLOG/INFO.TXT ]; then
         echo "BLL:bootlog-uploadManual.sh: WARNING INFO.TXT not found. Recreate from ${FSN_DATAPATH}/RLOG/INFO.TXT. Information may be incorrect."
         echo 'WARNING: Information may be incorrect' >${FSN_DATAPATH}/RLOG/INFO.TXT
         echo >>${FSN_DATAPATH}/RLOG/INFO.TXT
      else
         echo "BLL:bootlog-uploadManual.sh: MILESTONE INFO.TXT found OK"

         echo "uploading RLOG from ${FSN_DATAPATH} "
         cat ${FSN_DATAPATH}/UPLOAD.URL
         prepareAndSendRlogFrom ${FSN_DATAPATH}
         tail -1 $url_comp >> ${FSN_DATAPATH}/UPLOAD.URL
      fi
  else
      echo "checking for  $uploaded_bootlog_name in ${FSN_DATAPATH} "
      for ff in `find ${FSN_DATAPATH} -iname "BOOTLOG*"  -type d`
      do
         if ( grep $uploaded_bootlog_name "$ff/UPLOAD.URL" )
         then
            echo "uploading RLOG from $ff "
            cat $ff/UPLOAD.URL
            prepareAndSendRlogFrom $ff
            tail -1 $url_comp >> $ff/UPLOAD.URL
            break
            fi
      done
  fi
}

###############################################################################
# main
###############################################################################


if [ -n "$RLOG" ]; then
  uploadRlog
else
  uploadBootlog
fi
+ '[' -n '' ']'
+ uploadBootlog
find ${FSN_DATAPATH} -iname "BOOTLOG*"  -type d | awk -F. '{print $2"\t"$0}' | sort -n | cut -f 2 | head -n $upload_limit
++ find /mnt/nds/dev_6/part_0/FSN_DATA -iname 'BOOTLOG*' -type d
++ awk -F. '{print $2"\t"$0}'
++ sort -n
++ head -n 2
++ cut -f 2
+ for ff in '`find ${FSN_DATAPATH} -iname "BOOTLOG*"  -type d | awk -F. '\''{print $2"\t"$0}'\'' | sort -n | cut -f 2 | head -n $upload_limit`'
+ echo 'uploading files from /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG'
uploading files from /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG
+ prepareAndSendLogsFrom /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG
+ logdir=/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG
echo "$logdir" | awk -F. '{print $2}'
++ echo /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG
++ awk -F. '{print $2}'
+ postfix=
+ zipfilename=UPLOAD.TGZ
+ zipfile=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
+ ifconfig
+ keeping='/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/*.LOG'
+ toobigfilename=
grep ARM920T /proc/cpuinfo
++ grep ARM920T /proc/cpuinfo
+ is780=
+ '[' '' ']'
+ grep -qi drx595 /etc/hostname
+ gzip -1
+ tar -cv /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.URL /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/BLL.LOG /mnt/nd
s/dev_6/part_0/FSN_DATA/BOOTLOG/BLL_PREV.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/DF.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/HDPARM.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/IFCONFIG.LOG /mnt/nds/dev_6
/part_0/FSN_DATA/BOOTLOG/KMSG.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/VERHIST.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/P598.CUR /mnt/nds/dev_6/part_0/FS
N_DATA/BOOTLOG/MPROFAPP.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFCAK.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFMWS.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFPWM.CSV /mnt/nds/dev_6/part_0/F
SN_DATA/BOOTLOG/MPROFSCD.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFSTM.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/FILES.TXT /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/INFO.TXT /mnt/nds/dev_6/part_0/FSN_DAT
A/BOOTLOG/CDB.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MFS.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PCAT.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.BIX /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.DB /mnt
/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.DBW /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.NSA /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/REMBOOK.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/NVRAM0.BIN /mnt/nds/dev_6/pa
rt_0/FSN_DATA/BOOTLOG/NVRAM1.BIN '/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/*.COR'
tar: removing leading '/' from member names
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.URL
tar: /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/LOG: No such file or directory
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/BLL.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/BLL_PREV.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/DF.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/HDPARM.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/IFCONFIG.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/KMSG.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/UPLOAD.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/VERHIST.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/P598.CUR
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFAPP.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFCAK.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFMWS.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFPWM.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFSCD.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MPROFSTM.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/FILES.TXT
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/INFO.TXT
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/CDB.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/MFS.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PCAT.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.BIX
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.DBW
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/PSL.NSA
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/REMBOOK.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/NVRAM0.BIN
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/NVRAM1.BIN
tar: /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG/*.COR: No such file or directory
tar: error exit delayed from previous errors
+ sendfile UPLOAD.TGZ /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
md5sum "$2" | cut -c1-32
++ md5sum /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
++ cut -c1-32
+ md5=91f53985231ba3d57555da3797467e04
+ src_file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
+ '[' '' ']'
+ echo 'Uploading to http://anonymous@87.86.191.132/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ'
Uploading to http://anonymous@87.86.191.132/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
+ md5name=darwin_0019fbf2d46b_91f53985231ba3d57555da3797467e04.tgz
+ echo 'bootlog-uploadManual.sh: Upload via HTTP, file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ, md5name=darwin_0019fbf2d46b_91f53985231ba3d57555da3797467e04.tgz'
bootlog-uploadManual.sh: Upload via HTTP, file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ, md5name=darwin_0019fbf2d46b_91f53985231ba3d57555da3797467e04.tgz
+ /sbin/httpsend 00:19:fb:f2:d4:6b /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
Uploading V2.0 (3)(00:19:fb:f2:d4:6b)(/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ)
filelen = 3335206
Connecting to server...(80)(drop.stb.bskyb.com)(50ee01ba)
Sending header...
Sending header... complete
Sending payload string or binary...
Sending payload via callback...
currpos = (3335206/3335206)
Receiving response...
Received 743/743 bytes
Response header:
HTTP/1.1 200 OK
Date: Mon, 24 Jul 2017 10:52:47 GMT
Server: Apache/2.4.26 (Unix)
Uploaded-file: 2017-07-24_11-52-47_00:19:fb:f2:d4:6b_91.234.201.1.tgz
Content-Length: 464
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=ISO-8859-1

Response header:
HTTP/1.1 200 OK
Date: Mon, 24 Jul 2017 10:52:47 GMT
Server: Apache/2.4.26 (Unix)
Uploaded-file: 2017-07-24_11-52-47_00:19:fb:f2:d4:6b_91.234.201.1.tgz
Content-Length: 464
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=ISO-8859-1

Payload bytes: 464
Allocating 464 bytes for payload buffer
Header includes 464 bytes of payload
Payload received: 464 bytes
End of stream
+ echo 'UPLOAD.TGZ = httpsend darwin_0019fbf2d46b_91f53985231ba3d57555da3797467e04.tgz'
+ echo 'bootlog-uploadManual.sh:  HTTP Upload finished'
bootlog-uploadManual.sh:  HTTP Upload finished
+ rm /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD.TGZ
+ tail -1 /tmp/UPLOAD.URL
+ for ff in '`find ${FSN_DATAPATH} -iname "BOOTLOG*"  -type d | awk -F. '\''{print $2"\t"$0}'\'' | sort -n | cut -f 2 | head -n $upload_limit`'
+ echo 'uploading files from /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1'
uploading files from /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1
+ prepareAndSendLogsFrom /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1
+ logdir=/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1
echo "$logdir" | awk -F. '{print $2}'
++ echo /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1
++ awk -F. '{print $2}'
+ postfix=1
+ zipfilename=UPLOAD1.TGZ
+ zipfile=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
+ ifconfig
+ keeping='/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/*.LOG'
+ toobigfilename=
grep ARM920T /proc/cpuinfo
++ grep ARM920T /proc/cpuinfo
+ is780=
+ '[' '' ']'
+ grep -qi drx595 /etc/hostname
+ gzip -1
+ tar -cv /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.URL /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/BLL.LOG
 /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/BLL_PREV.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/DF.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/HDPARM.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/IFCONFIG.LO
G /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/KMSG.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/P603.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.LOG /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/VERHIST.LOG
/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/P603.CUR /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFAPP.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFCAK.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFMWS
.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFPWM.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFSCD.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFSTM.CSV /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1
/FILES.TXT /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/INFO.TXT /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/CDB.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MFS.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PCAT.DB /
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.BIX /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.DBW /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.NSA /mnt/nds/dev_
6/part_0/FSN_DATA/BOOTLOG.1/REMBOOK.DB /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/NVRAM0.BIN /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/NVRAM1.BIN '/mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/*.COR'
tar: removing leading '/' from member names
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.URL
tar: /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/LOG: No such file or directory
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/BLL.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/BLL_PREV.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/DF.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/HDPARM.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/IFCONFIG.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/KMSG.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/P603.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/UPLOAD.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/VERHIST.LOG
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/P603.CUR
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFAPP.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFCAK.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFMWS.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFPWM.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFSCD.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MPROFSTM.CSV
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/FILES.TXT
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/INFO.TXT
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/CDB.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/MFS.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PCAT.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.BIX
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.DBW
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/PSL.NSA
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/REMBOOK.DB
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/NVRAM0.BIN
mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/NVRAM1.BIN
tar: /mnt/nds/dev_6/part_0/FSN_DATA/BOOTLOG.1/*.COR: No such file or directory
tar: error exit delayed from previous errors
+ sendfile UPLOAD1.TGZ /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
md5sum "$2" | cut -c1-32
++ md5sum /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
++ cut -c1-32
+ md5=878169ef4a7888d4ce4b1bc9f65fa841
+ src_file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
+ '[' '' ']'

# what's the actual upload filename?
#
+ echo 'Uploading to http://anonymous@87.86.191.132/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ'
Uploading to http://anonymous@87.86.191.132/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
+ md5name=darwin_0019fbf2d46b_878169ef4a7888d4ce4b1bc9f65fa841.tgz
+ echo 'bootlog-uploadManual.sh: Upload via HTTP, file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ, md5name=darwin_0019fbf2d46b_878169ef4a7888d4ce4b1bc9f65fa841.tgz'
bootlog-uploadManual.sh: Upload via HTTP, file=/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ, md5name=darwin_0019fbf2d46b_878169ef4a7888d4ce4b1bc9f65fa841.tgz
+ /sbin/httpsend 00:19:fb:f2:d4:6b /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
Uploading V2.0 (3)(00:19:fb:f2:d4:6b)(/mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ)
filelen = 13300684
Connecting to server...(80)(drop.stb.bskyb.com)(50ee01ba)
Sending header...
Sending header... complete
Sending payload string or binary...
Sending payload via callback...
currpos = (13300684/13300684)
Receiving response...
Received 685/685 bytes
Response header:
HTTP/1.1 200 OK
Date: Mon, 24 Jul 2017 10:53:10 GMT
Server: Apache/2.4.26 (Unix)
Uploaded-file: 2017-07-24_11-53-13_00:19:fb:f2:d4:6b_91.234.201.1.tgz
Connection: close
Content-Type: text/html; charset=ISO-8859-1

Response header:
HTTP/1.1 200 OK
Date: Mon, 24 Jul 2017 10:53:10 GMT
Server: Apache/2.4.26 (Unix)
Uploaded-file: 2017-07-24_11-53-13_00:19:fb:f2:d4:6b_91.234.201.1.tgz
Connection: close
Content-Type: text/html; charset=ISO-8859-1

Payload bytes: 0
Allocating 0 bytes for payload buffer
Header includes 464 bytes of payload
Payload received: 464 bytes
End of stream
+ echo 'UPLOAD1.TGZ = httpsend darwin_0019fbf2d46b_878169ef4a7888d4ce4b1bc9f65fa841.tgz'
+ echo 'bootlog-uploadManual.sh:  HTTP Upload finished'
bootlog-uploadManual.sh:  HTTP Upload finished
+ rm /mnt/nds/dev_6/part_0/FSN_DATA/UPLOAD1.TGZ
+ tail -1 /tmp/UPLOAD.URL

# Restore TCP SYN entries
echo $syn_retries >/proc/sys/net/ipv4/tcp_syn_retries
+ echo 5
echo $mtu_probing >/proc/sys/net/ipv4/tcp_mtu_probing
+ echo 0

echo "++++++++++++++++++++++++++++++++++++++++"
+ echo ++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++++++++++++++
echo "List of files uploaded"
+ echo 'List of files uploaded'
List of files uploaded
echo "++++++++++++++++++++++++++++++++++++++++"
+ echo ++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++++++++++++++
cp $url_comp $FSN_DATAPATH
+ cp /tmp/UPLOAD.URL /mnt/nds/dev_6/part_0/FSN_DATA
cat $url_comp
+ cat /tmp/UPLOAD.URL
UPLOAD.TGZ = httpsend darwin_0019fbf2d46b_91f53985231ba3d57555da3797467e04.tgz
UPLOAD1.TGZ = httpsend darwin_0019fbf2d46b_878169ef4a7888d4ce4b1bc9f65fa841.tgz
echo "+++++++ List finished ++++++++++++++++++"
+ echo '+++++++ List finished ++++++++++++++++++'
+++++++ List finished ++++++++++++++++++


={============================================================================
|kt_dev_si_0002| si-bootlog-log


// bootlog-config.sh

# Path to initial/temporary BootLog Log (BLL) file
# (MSCQ00182643: BSKYB_SI_BOOTLOG_AddMilestonesAndFilesizeChecks)
BLLTEMPPATH="/tmp"

// bootlog.sh
# ------------------------------------------------------------------------------
# Set up BootLogLog (BLL)
# ------------------------------------------------------------------------------

# Set BootLogLog (BLL) filename
# Initialially we use the temporary location, until the mounts are in place
export `BLLFILENAME`="${BLLTEMPPATH}"/BLL.LOG

// BLL:bootlog.sh: MILESTONE CONFIG1: BLOG_mntdev = /dev/sda1, BLOG_mntpath = /tmp/dummydisk/BLOGDIR, `BLOG_DATAPATH = /tmp/dummydisk/BLOGDIR/FSN_DATA`, MAX_MEM_FOR_LOG_MB = 2048, MAX_BOOTLOG_ROTATE = 6, MAX_RLOG_ROTATE_COPY = 59
// BLL:bootlog.sh: MILESTONE CONFIG2: FSN_ROOT = /mnt/nds, BLLPATH = , BLINFOPATH = /tmp/dummydisk/BLOGDIR/FSN_DATA/VERINFO, MPROFPATH = /tmp, MAX_INDIVIDUAL_FILESIZE_KB = 256000
// 
// BLL:bootlog.sh: MILESTONE Mount  BLOG_mntdev BLOG_mntpath: /dev/sda1 /tmp/dummydisk/BLOGDIR
mount "${BLOG_mntdev}" "${BLOG_mntpath}"

// *TN* mounted

# ------------------------------------------------------------------------------
# Initialise BootLog Log (BLL) in persistant storage
#   Before now, all BLL output was being written to /tmp/BLL.LOG. We can set
#   things up properly.  (See also ReadMe.txt in this directory).
# ------------------------------------------------------------------------------
# Set BootLogLog filename to the mounted device, and briefly remember the temp location.
TEMPBLLNAME="${BLLFILENAME}"
export BLLFILENAME="${BLOG_DATAPATH}"/BLL.LOG


# Rename the previous BootLogLog (BLL) file (if it exists), in preparation to start a new one
if [ -e "${BLLFILENAME}" ]; then
  cp "${BLLFILENAME}" "${BLOG_DATAPATH}"/BLL_PREV.LOG
  rm -f "${BLLFILENAME}"
  `PrevBLLFileFound=true`
else
  PrevBLLFileFound=false
fi


# Copy the temporary BLL.LOG from "${BLLTEMPPATH}"/BLL.LOG to "${BLOG_DATAPATH}"/BLL.LOG
if [ -e "${TEMPBLLNAME}" ]; then
  cp "${TEMPBLLNAME}" "${BLLFILENAME}"
  rm -f "${TEMPBLLNAME}"
  echo "BLL:bootlog.sh: MILESTONE Temp BLL file copied to persistent storage"  >> "${BLLFILENAME}"
else
  echo "BLL:bootlog.sh: WARNING Temp BLL file not found. Starting new file in persistant storage"  > "${BLLFILENAME}"
fi


*TN* so BILLFILENAME changes are okay

# Report on earlier "BLL_PREV.LOG" activity
if [ `"${PrevBLLFileFound}" == "true"` ]; then
   echo "BLL:bootlog.sh: MILESTONE Previous BLL file renamed to ${BLOG_DATAPATH}/BLLPREV.LOG"  >> "${BLLFILENAME}"
else
   echo "BLL:bootlog.sh: WARNING Previous BLL file not found"  >> "${BLLFILENAME}"
fi

// BLL:bootlog.sh: MILESTONE Temp BLL file copied to persistent storage
// BLL:bootlog.sh: MILESTONE Previous BLL file renamed to /tmp/dummydisk/BLOGDIR/FSN_DATA/BLLPREV.LOG

# ------------------------------------------------------------------------------
# Execute child scripts
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Unmount the disk used to create BOOTLOG folder
# ------------------------------------------------------------------------------
// *TN* see from BLL.PREV.LOG due to switch between disk and tmp
BLL:bootlog.sh: MILESTONE Disk/FFS is being unmounted, so BLL.LOG moved back to temp: /tmp

# ------------------------------------------------------------------------------
# Create background processes
# ------------------------------------------------------------------------------


={============================================================================
|kt_dev_si_0002| si-bootlog-logfile-monitor

// build_mw_epg.sh

      if [ -n "${LOGFILE_MONITOR}" -a "${PROFILE}" = "sky_trials" ]; then
          # Run debug logfile monitor script at high priority in background
          echo 'chrt -r 97 /usr/bin/logfile-monitor.sh </dev/null &'
      fi


// logfile-monitor.sh

#!/bin/sh
#
# 'logfile-monitor.sh' checks periodically (every $INTERVAL seconds) if there
# has been a change to the debug log file size. If there hasn't (which might be
# indicative of a process stuck in a tight loop) then it will kill the MW, APP,
# and CA processes to obtain their core files.
#
# The script will not kill the SCD process: PWM receives a SIGCHLD signal when
# SCD (its child process) dies which causes it to restart the STB. There is
# also a software watchdog which would eventually trigger.
#
# Before killing the processes the script will capture the output of the 'ps'
# and 'top' commands in files 'PS.TXT' and 'TOP.TXT', respectively. Those files
# will be uploaded automatically as part of the logs and will be available on
# the respective log parser page.
#
# The script also creates two empty files, FORCED.TXT and AUTOKILL.TXT, which
# will enable the log parser to mark the logs appropriately.
#
# After having been triggered and successfully done the above, the script will
# (where it is supported) flash the STB's front panel indicators in one second
# intervals.
#
# The process killing sequence can also be triggered manually by logging onto
# the STB and sending signal SIGHUP to the script, like this:
#
# -sh-3.2# kill -s 1 $(pidof logfile-monitor.sh)


={============================================================================
|kt_dev_si_0001| si-httpsend

<from-spk>
/home/kyoupark/spk-out/build_mips/httpsend-0.0/src/httpsend.c

build by spk and seems to be modified to send it sky.

printf("Uploading (%d)(%s)(%s)\n",argc, /* mac */ argv[1],argv[2]);

./httpsend "00:19:fb:f2:d4:6b" version.txt

Fixed to: http://drop.stb.bskyb.com/cgi-bin/stbdump.cgi

<ftp-sky>
# fsky?
kyoupark@kit-debian:~/si-logs/theyard/bin$ cat fsky
ftpsky "dir *$1*"

ftpsky "ls *_001018001200_*" | grep 'Mar 27'
./ftpsky "get darwin_001018001200_30c26f7d966c03ff4f850a19380182b4.tgz"

# si-logs/theyard/bin/ftpsky
##:Go to the ftp server at sky
(
echo quote user hound
echo quote pass K8tRAcr9
echo cd upload
echo bin
echo $*
) | ftp -n 87.86.191.132


<ftp-get>
# check_log for eng build
./ftpsky "get darwin_00101800122e_1f0e4cfd6280fce012291bfe8abc6b7e.tgz"
diag_binary
unstripped_processes
check_log -p <path> <file>
    Use "path" as the path for the diag_binary and unstripped_processes
    folders, and otherwise translate <file>.
check_log -p . darwin_00101800122e_1f0e4cfd6280fce012291bfe8abc6b7e.tgz 

# use known bins
check_log darwin_0019fb0bad0c_f6b90f0bd7dd874e65817e34fea126af.tgz

tar -cjvf ~/ktpark/SI-4453.bz2 .


={============================================================================
|kt_dev_si_0002| si-git 

Git global setup

git config --global user.name "kyoupark"
git config --global user.email "kyoupark@cisco.com"

Create a new repository
git clone https://wwwin-gitlab-sjc.cisco.com/kyoupark/SI-REPO.git
cd sample
touch README.md
git add README.md
git commit -m "add README"
git push -u origin master

Existing folder or Git repository

cd existing_folder
git init
git remote add origin https://wwwin-gitlab-sjc.cisco.com/kyoupark/SI-REPO.git
git add .
git commit
git push -u origin master

git@wwwin-gitlab-sjc.cisco.com:kyoupark/SI-REPO.git

git remote set-url origin git@wwwin-gitlab-sjc.cisco.com:kyoupark/SI-REPO.git


git diff BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.07.00_BSKYB_GM_Integration BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.09.00_BSKYB_GM_Integration
git diff BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.22.00_BSKYB_GM_Integration BSKYB_HR020_Int/BSKYB_INTEGRATION_BLD_88.15.00_BSKYB_HR020_Int
git diff BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.07.00_BSKYB_GM_Integration BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.09.00_BSKYB_GM_Integration -- THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/config/stbe.ini

<register-ssh-key>
https://wiki.cisco.com/display/GITFUSION/Getting+started+in+Git

The gerrit server is a git server and uses ssh config file.


<si-git>
http://hetty.cisco.com/fusionmadesimple/index.php/Git_Fusion_standard_workflow

git clone ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW STB_SW
git clone ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW STB_SW -b BSKYB_HQnnn_ETHAN_Int


={============================================================================
|kt_dev_si_0002| si-build-flist

ag -U --nopager --follow --nocolor --nogroup -g '' > gtaglist.out
ag -U --nopager --nocolor --nogroup -g '' THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa
ag -U --nopager --nocolor --nogroup -g '' DARWIN_PLATFORM/dms/build/integration/dms/services

find -L THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion -name '*.java' 
find -L THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion -name '*.java' -o -name '*.[ch]pp' > flist.out 
find -L DARWIN_PLATFORM/dms/build/integration/dms/services -name '*.[ch]pp'

#.agignore
build/
test/
unit_test/
tests/
mock/
DARWIN_PLATFORM/dms
Resolve_Deps/
doc/
curl/
openssl/
config/
FREETYPE2/
FUSION_SYSTEM_INTEGRATION/
.git/
# CMS_MEDIA_SERVICES/Media_Streamer/
VQE_SRC/
simulators/
mediastreamer/config_files/
CMS_MEDIA_SERVICES/Media_Streamer/proj_specific/mha/
CMS_MEDIA_SERVICES/Media_Streamer/generic/config_files/
proj_specific/mor/
proj_specific/fosh/
proj_specific/ip_vod/src/
CMS_MEDIA_SERVICES/metadata/proj_specific/legacy/
CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/ICU3/
CMS_SECURITY_SERVICES/NAGRA_CA_KERNEL/
BUILD_SYSTEM/
CMS_MEDIA_SERVICES/MPM/src/.doxygen.d/
NDS_TOOLSETS/


={============================================================================
|kt_dev_si_0002| si-build-server

alias shb='ssh 10.209.62.106'

Darwin SI
Staines  Europe	st-castor-03.cisco.com	10.209.62.106


HOWTO: Using NFS client on Windows7/10
https://cisco.jiveon.com/docs/DOC-1635735

mount -o mtype=hard,tcp <server_ip>:/path/to/share/directory Z:
mount -o mtype=hard,tcp <server_ip>:/path/to/share/directory *

mount -o mtype=hard,tcp 10.209.62.106:/home/kyoupark K:


={============================================================================
|kt_dev_si_0002| si-build-xr060

// so far example you could use `target` instead of the load rule , for example skad-ams0201
FYI - platforms are defined as targets in file BUILD_SYSTEM/COMMON_MAKEFILES/projects/fusion2/Fusion_Targets.ini

Resolve_Deps/scripts/resolve_deps.sh skpd-ams0201
Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01


={============================================================================
|kt_dev_si_0002| si-build-command

<baseline>
tag name:
BSKYB_HR014_Int/BSKYB_INTEGRATION_BLD_83.01.00_BSKYB_HR014_Int

R014.083.57.00

From
http://hudsonmaster1.uk.nds.com:8080/hudson/view/Maintenance/job/generate_fullstack_table/lastSuccessfulBuild/artifact/FSI.html

BSKYB_HR014_Int

BSKYB_INTEGRATION_BLD_83.57.00_BSKYB_HR014_Int

ams-drx890

cust_trials

preprod

No


git clone ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW STB_SW_o

git tag | grep "BLD_.*_HR015"
git tag | grep "BLD_.*_HR019"
git tag | grep "BLD_84.51.*"
git tag | grep "BLD_.*_GM"

git show BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_41.95.00_BSKYB_GM_Integration

git reset --hard BSKYB_HR019_Int/BSKYB_INTEGRATION_BLD_87.52.00_BSKYB_HR019_Int
git reset --hard BSKYB_HR019_Int/BSKYB_INTEGRATION_BLD_87.67.03_BSKYB_HR019_Int
git reset --hard BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.12.00_BSKYB_GM_Integration
git submodule deinit -f .
git submodule update --init


# R13
git co BSKYB_HR018_Int
git co BSKYB_GM_Integration
git reset --hard BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_42.04.00_BSKYB_GM_Integration

http://hetty.cisco.com/fusionmadesimple/index.php/Git_Fusion_standard_workflow

*build-01*
cd STB_SW
./initialise_hooks
Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01

  # ivy_files
  # STB_SW/Resolve_Deps/ivy_files

  <Platform> parameter is one or more of the listed in: 
  
  $ more FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/git_scripts/load_rules.txt 
  #
  # This contains load rules for this stream. create_SI_bl_source.sh loads
  # load rules by using this file. Hence this is not a regular text file.
  # Be careful when making changes, especially space characters between rules.
  #
  # Hudkins also needs this file. Check below link for further details
  # http://hudsonmaster1:9000/projects/hudsonadmin/wiki/Requirements_for_GetSourceToHudsonsh
  #
  
  PLATFORM_ams_drx890="FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01"
  PLATFORM_ams_drx595="FUSIONOS_5/BLD_DARWIN_SKYDRX595_BCM97350_LNUX_01"


*build-02*
cd FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/


2) Upload jar files and replace it with car files. 
note: requires hudson page to do that.


*build-03* <release-darwin-platform-sh>

time ./release_darwin_platform.sh --platform ams-drx890 --profile mem_trials --project picasso --enable_full_parallel_build --variant debug --disable_ccache --cartool no --clean --baseline ENG_87_26_00_8888_KT
time ./release_darwin_platform.sh --platform ams-drx890 --profile mem_trials --project picasso --enable_full_parallel_build --variant debug --disable_ccache --cartool no --clean --baseline ENG_KT
time ./release_darwin_platform.sh --platform ams-drx890 --profile sky_trials --project picasso --enable_full_parallel_build --variant debug --disable_ccache --cartool no --clean --baseline ENG_KT
time ./release_darwin_platform.sh --platform ams-drx890 --profile nds_si_devel --project picasso --enable_full_parallel_build --variant debug --disable_ccache --cartool no --clean --baseline ENG_KT

// Profile mem_trials settings: CLEAN=TRUE, BUILD_TYPE=release_dbg, PICASSO_BLD_TYPE=release-trials, PICASSO_TRIALS_TYPE=unknown, PDL_SERVER=SKY_Production, DIAG_BINARY_MODE=YES
// OUTPUT=/home/jenkins/workspaces/build/workspace/build_fullstack_image/executors/0/work/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build
// PLATFORM=ams-drx890 settings: PLATFORM_DIR=AMS_BCM_MIPS4K_LNUX_DARWIN_01, FUSIONOS=FUSIONOS_2, ENDIAN=Big
// Building MW=YES, EPG=YES
// BUILD_CARANGE_LIB_ONLY=NO
// Checking & calculating Version string - 'mem_trials' 'ENG_87.26.00_4307_MNTEE'
// VERSION = 87.26.00_4307_MNTEE


<see-build-commands>
From FSI console log:
http://hudsonmaster1.uk.nds.com:8080/hudson/job/build_fullstack_image/102440/console
12:48:35 + ./release_darwin_platform.sh \
   --output /hudson/workspace/workspace/build_fullstack_image/executors/7/work/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build \
   --project picasso --clean --cartool yes --enable_full_parallel_build \
   --disable_ccache --profile nds_si_devel --platform ams-drx890 \
   --variant debug --baseline ENG_99.99.99_6814 \
   --override_location asbo.bskyb.com:/home/asbo/mac

./release_darwin_platform.sh --output /home/jenkins/workspaces/build/workspace/build_fullstack_image/executors/3/work/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build --project picasso --clean --cartool yes --enable_full_parallel_build --disable_ccache --profile mem_trials --platform ams-drx890 --variant debug --baseline BSKYB_INTEGRATION_BLD_87.47.00_BSKYB_HR019_Int --override_location asbo.bskyb.com:/home/asbo/mac
./release_darwin_platform.sh --project picasso --clean --cartool yes --enable_full_parallel_build --disable_ccache --profile mem_trials --platform ams-drx890 --variant debug --baseline BSKYB_INTEGRATION_BLD_87.47.00_BSKYB_HR019_Int --override_location asbo.bskyb.com:/home/asbo/mac
./release_darwin_platform.sh --project picasso --clean --cartool no --enable_full_parallel_build --disable_ccache --profile mem_trials --platform ams-drx890 --variant debug --baseline ENG_KT


*build-04* <build-commands>

# `profile` will be translated to lower case in the script

    echo "  --cartool                 Forces the use of the jar file compression tool if set to yes or just uses jar files if set to no"
    echo "  --enable_full_parallel_build   Enables full parallel build for the MW/EPG"
    echo "  --disable_full_parallel_build  Disables full parallel build and reverts to leaf-node parallelism"

./build_mw_epg.sh --platform ams-drx890 --profile sky_trials --project picasso --variant debug --baseline ENG_TST_41.44.00U --cartool no --enable_full_parallel_build
./build_mw_epg.sh --platform ams-drx890 --profile sky_trials --project picasso --variant debug --baseline ENG_KT_FD --cartool no --enable_full_parallel_build --filldisk
./make_image.sh -c --platform ams-drx890 --profile sky_trials --project picasso --variant debug --baseline ENG_KT --cartool no --enable_full_parallel_build


# to have component debug build *enable-comp-diag*
--build_in_debug dbe_interface,darwin_planner_src,rmfplugin

./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --clean [--output /home/NDS-UK/parkkt/cc/parkkt_BSKYB_INTEGRATION_MAIN_01/vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build]
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --clean
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --clean --baseline ENG_KT
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --use_sysinit_cfg 
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --memprof --baseline ENG_KT_SP
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --clean --mw_only --baseline ENG_KT_PCAT_05
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --memprof --bootlog --baseline ENG_SOC_03
./build_mw_epg.sh --platform ams-drx890 --project picasso --variant debug --profile nds_si_devel --clean --enable_full_parallel_build --disable_ccache --cartool no --baseline ENG_KT --build_in_debug memman


*build-05* 
make.sh --platform "ams-drx890" --profile "NDS_SI_Devel" 
make.sh -c --platform "ams-drx890" --profile "NDS_SI_Devel"


*build-06* 
# takes about 5 mins
./make_image.sh --platform ams-drx890 --project picasso --profile "NDS_SI_Devel" 
./make_image.sh --platform ams-drx890 --project picasso --profile "sky_trials" -c

# prod
--variant preprod --profile cust_trials
--variant prod --profile sky_prod -c

# takes about 37 mins
./make_image.sh --platform ams-drx890 --project picasso --profile "NDS_SI_Devel" -c
./make_image.sh --platform ams-drx890 --project picasso --profile "NDS_SI_Devel" --kernel_only 
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.nds_si_devel


*build-07* *comp-cfe*
5. Use image from 
/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/\
AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/


kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build$ ./release.sh --platform ams-drx890 --project picasso
kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build$ ls flash0.tar.gz
flash0.tar.gz

./release.sh --platform ams-drx890 --project picasso
/home/kyoupark/si_logs/flash0


<si-boot-cfe> comp-cfe
this explains the way that uses EOTV image which has only kernel in it. Then
can mount nfs directory as flash0 and run startstack.sh manually. So can
change flash0 to whatever you want as CFE do.

http://hetty.cisco.com/fusionmadesimple/index.php/EOTV_Not_CFE

cp /home/kyoupark/STB_SW/deps/KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/debug/BootImage/vmlinuz /tftpboot/kyoupark/
kyoupark@st-castor-03:~$ ls /tftpboot/kyoupark/
readme.in  vmlinuz


CFE> ifconfig eth0 -auto; boot -elf somehost:/vmlinux 'mem=128M ip=dhcp console=uart,mmio,0x10400b00,115200n8'

# ifconfig eth0 -auto; boot -elf 10.209.62.106:/kyoupark/vmlinuz
# this emits error saying thet it is not elf format so use -z option.

ifconfig eth0 -auto

// /tftpboot/kyoupark
// CFE> boot -z -elf 10.209.62.106:/kyoupark/vmlinuz
boot -z -elf 10.209.62.106:/kyoupark/vmlinuz

sh-3.2# 
// mount -t nfs -o nolock <your_nfs_machine_ip_addr>:/home/NDS-UK/<nfs_folder_build_path>/flash0 /flash0

mkdir /flash0
mount -t nfs -o nolock 10.209.62.106:/home/kyoupark/si_logs/flash0 /flash0

*TN* will format ar first time. How to make it not to format?
/flash0/scripts/startstack.sh


<ex>
setenv -p STARTUP "ifconfig eth0 -auto; boot -z -elf <tftp_server>:/<vmlinuz-path-given-in-release-email> 'ip=dhcp console=uart,mmio,0x10400b00,115200n8'"

// # to get flash0.tar.gz. use this but not release.sh
// ./utils/picasso_flash_H1.sh -b ams_bcm -p stripped_optim -s nds
// ./picasso_flash_H1.sh -b ams_bcm -p debug -s nds


<build-gcc-version>
Linux version 2.6.18.8 (hudson@hudkinsslave8.cisco.com) (gcc version 4.2.0 20070124 (prerelease) - BRCM 10tsHound-20140508) #2 Thu Sep 15 12:49:55 BST 2016

// 890
~/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gcc --version
mips-linux-uclibc-gcc (GCC) 4.2.0 20070124 (prerelease) - BRCM 10tsHound-20140508

~/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gcc \
-Os -fno-strict-aliasing -Wall -g -fno-builtin -Wmissing-prototypes \
-Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations


<build-uclibc-version>
-rwxrwxrwx    1 root     root        29028 Sep 15  2016 ld-uClibc-0.9.29.so
lrwxrwxrwx    1 root     root           19 Jan  1 00:00 ld-uClibc.so.0 -> ld-uClibc-0.9.29.so


<build-option>
To see the output of -E option

FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gcc -E -Os 
-fno-strict-aliasing -Wall -g -fno-builtin -DNeedFunctioPrototypes=1 
-Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations   
-DAPP_MGMT_SIGNAL_24_7_SERVICE_TYPE_82H -DAPP_MGMT_SIGNAL_ETV_OTV_TRIGGER_MOD 
-DAPP_MGMT_SIGNAL_RECOMMENDATION_OTV_PROMO_MOD -DAUTHENTICATION_NDS_SAC 
-DBSKYB_SUPPORT_HEP_WITH_OIG -DCALLBACK_PSTN -DCAPTION_TELETEXT_LEGACY_LAYOUT 
-DCAROUSEL_MHC -DCAROUSEL_OTV -DCA_VIDEOGUARD_NDS_SECURE_RETURN_PATH 
-DCA_VIDEOGUARD_PARENTAL_RESTRICT -DCA_VIDEOGUARD_WATERSHED -DFRONT_END_DTT_USB 
-DFRONT_END_SAT -DFRONT_END_SAT_SCR -DFUSION_APP_MGMT_SUPPORTED 
-DFUSION_AUTHENTICATION_SUPPORTED -DFUSION_BDL_SUPPORTED 
-DFUSION_CA_VIDEOGUARD_SUPPORTED -DFUSION_DYNAMIC_TSA_SUPPORTED 
-DFUSION_HEADEND_METADATA_SUPPORTED -DFUSION_HOME_NETWORK_SUPPORTED 
-DFUSION_METADATA_SUPPORTED -DFUSION_NETWORK_SUPPORTED -DFUSION_PDL_SUPPORTED 
-DFUSION_PVOD_SUPPORTED -DFUSION_PVR_SUPPORTED -DFUSION_TARGETED_MESSAGING_SERVICE_SUPPORTED 
-DFUSION_USER_ACTIVITY_SUPPORTED -DFUSION_VIDEOGUARD_NOTIFY_SUPPORTED -DFUSION_VWS_SUPPORTED 
-DGUIDE_BSKYB_FORMAT_LOGICAL_CHAN_NO -DGUIDE_BSKYB_SUBSCRIBER_PROPERTIES_USED 
-DHEADEND_METADATA_OIGC -DHOME_NETWORK_MEDIA_RENDERER -DHOME_NETWORK_PLANNER_SERVER 
-DHOME_NETWORK_REMOTE_UI -DHOTPLUG_SUPPORT -DIPPV -DMCM_PVR_RECORD_CA_HOLES 
-DMETADATA_SI_XSI_SSR -DNETWORK_CONFIGURE_LAN -DPDL_NDS_SECURE_AUTH -DPLAYER_PIN_HANDLING_A 
-DPLAYER_REMOTE_UI_HTTP -DPVOD_LINEAR_TRANSPORT -DPVR_CHECK_XTV_STATUS -DPVR_CLASSIC_REVIEW_BUFFER 
-DSERIES_IMPLICIT_SERIES_DELETION -DSERIES_SYNCHRONIZE_BOOKINGS_WITH_SIGNUPS 
-DSI_SERVICE_SCAN_XSI -DSOFTWARE_DOWNLOAD_OTV -DSRM_ELEMENTARY_STREAMS_SELECTION_A 
-DSRM_USE_PI_SCHEDULE_FLAG_FOR_AVAILABILITY -DUSBTUNER_SUPPORTED -DUSB_SUPPORTED 
-DUSER_ACTIVITY_BARB -DUSER_ACTIVITY_SSP -DWIFI_SUPPORTED -DWLM_SUPPORTED -DRELEASE_DBG -DDIAG_RELEASE_DBG -DDIAG_BINARY_MODE -DDIAG_PERFORMANCE_MODE -DOTV_CAROUSEL_SUPPORTED -DXSI_SUPPORTED -DLINT_ERRORS_ONLY= -DLINT_RESTORE= -DMEMLIST -DMEMLIST_SLEEP_PERIOD=60 -DMEMPROF -DPROFILE_A -DDIAG_LOG_NDEBUG -DNDEBUG -DMEMMAN_TRUSTED_CLIENT -DGFX_NO_SHAPE -DGFX_IMAGE_NO_DITHERING -DGFX_PAINTER_NO_ARGB16_4444 -DGFX_PAINTER_NO_ARGB16_4444_PREMULT -DGFX_PAINTER_NO_RGB16_565 -DGFX_PAINTER_NO_SURFACE_RW -DMSCQ189287_CLOCK_MONOTONIC_NOT_SUPPORTED -DCQ171339 -DLEGACY_MIGRATION_SUPPORT -DSUN_BUILD -DNDS_APP_TYPE_PICASSO -DDIAG_JAVA_DEBUG -D_XOPEN_SOURCE=600 -DAMS_BCM_MIPS4K_LNUX_DARWIN_01 -DFUSION_PROFILE -DMEMMAN_TRUSTED_CLIENT -DMSCQ1854424_SP_SCHEMA_ONLY -DMSCQ2375670_SET_PROVIDER_CLASS_MEMBERSHIP -DCQ380004_USE_STB_SW_01 
-DMEMMAN_FORCE_USE_MALLOC_DIRECTLY 
-DPLAYER_DUMP_VTABLES -DPLAYER_VTABLE_LEAK_DETECTION -DCAPTIONS_SUBTITLES -DCDI_IOCTL_DEFINITIONS="/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/ioctl_magic.h" -DCDI -DIS_BIG_ENDIAN -D__BIG_ENDIAN -D_XOPEN_SOURCE=600 -D__USE_XOPEN2K -D_GNU_SOURCE -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemcommon/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemlang/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemlocator/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemstring/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemtime/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemobject/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemitc/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemconfig/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/diag/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/memman/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/misc_libraries/httpserver/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_control_and_diagnostics/sysinit/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_platform_components/darwin_player/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_platform_components/darwin_planner/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_platform_components/darwin_player/src/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_platform_components/darwin_guide/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_platform_components/darwin_prefs/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_system_platform_components/darwin_spm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/darwin_system_platform_components/darwin_uam/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/vrm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/msm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/fem/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/mcm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/bem/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/mdm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/mpm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/media_services/camm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/information_services/sim/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/information_services/pcat/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/pdm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/rmf/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/presentation_services/gfx/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemutil/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/presentation_services/cappres/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/ssm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/security_services/vgv/darwin/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/security_services/vgv/darwin/carange -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemalarm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/information_services/fdm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/information_services/fdm/fdm_optv -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/tests/CUnit-2.0-2/CUnit/Headers -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/ipc/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/CDI_INC/include -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/nds -include /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds/inc/clocks.h -ffunction-sections -fdata-sections -DDIAG_FILE_ID=260 -c /home/NDS-UK/kyoupark/STB_SW/DARWIN_PLATFORM/DARWIN_PLAYER/src/player_api_session.c > out.txt


<build-output>
/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg$
drwxr-xr-x  3 kyoupark ccusers 4096 Jul 22 09:08 applications/
drwxr-xr-x 15 kyoupark ccusers 4096 Jul 22 09:29 components/
drwxr-xr-x  4 kyoupark ccusers 4096 Jul 22 09:28 dyn/
drwxr-xr-x  3 kyoupark ccusers 4096 Jul 22 09:28 engines/
drwxr-xr-x  2 kyoupark ccusers 4096 Aug 26 15:06 processes/
drwxr-xr-x  3 kyoupark ccusers 4096 Jul 22 09:28 projects/

/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components/media_services/bem/src/server$ ls
bem_cec.deps                      bem_composition_table.deps  bem_device_denc_conf.deps  bem_link_discovery.deps  bem_path_determine.deps  bem_plane_table.deps    bem_server_oc.deps             bem_terminal.deps
bem_cec.o                         bem_composition_table.o     bem_device_denc_conf.o     bem_link_discovery.o     bem_path_determine.o     bem_plane_table.o       bem_server_oc.o                bem_terminal.o
bem_channel.deps                  bem_connection.deps         bem_device_discovery.deps  bem_link_table.deps      bem_path_release.deps    bem_port.deps           bem_source.deps                bem_track.deps
bem_channel.o                     bem_connection.o            bem_device_discovery.o     bem_link_table.o         bem_path_release.o       bem_port.o              bem_source.o                   bem_track.o
bem_channel_table.deps            bem_connection_table.deps   bem_device_table.deps      bem_lock.deps            bem_path_reserve.deps    bem_server.deps         bem_source_table.deps          bem_track_table.deps
bem_channel_table.o               bem_connection_table.o      bem_device_table.o         bem_lock.o               bem_path_reserve.o       bem_server_ipc.deps     bem_source_table.o             bem_track_table.o
bem_composition.deps              bem_db.deps                 bem_eedid.deps             bem_monitor.deps         bem_path_utils.deps      bem_server_ipc.o        bem_teletext_frame.deps        libms_bem_server_src.a
bem_composition_links_table.deps  bem_db.o                    bem_eedid.o                bem_monitor.o            bem_path_utils.o         bem_server_ipc_oc.deps  bem_teletext_frame.o           temp2_libms_bem_server_src.a
bem_composition_links_table.o     bem_device_configure.deps   bem_internal_event.deps    bem_path_attach.deps     bem_plane.deps           bem_server_ipc_oc.o     bem_teletext_frame_table.deps  temp_libms_bem_server_src.a
bem_composition.o                 bem_device_configure.o      bem_internal_event.o       bem_path_attach.o        bem_plane.o              bem_server.o            bem_teletext_frame_table.o


<build-spk>
/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/build_mips/staging_dir/mips-linux-uclibc
/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/build_mips/staging_dir/mips-linux-uclibc/include/asm/errno.h


={============================================================================
|kt_dev_si_0002| si-core si-gdb

// 890
~/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gdb

$ file 498.COR
498.COR: ELF 32-bit MSB core file, MIPS, MIPS-I version 1 (SYSV), SVR4-style

$ file MW_Process
MW_Process: ELF 32-bit MSB executable, MIPS, MIPS32 version 1 (SYSV), dynamically linked (uses shared libs), not stripped

http://hetty.cisco.com/fusionmadesimple/index.php/Core_dumps_on_theyard

Find the unstripped binaries[edit]

The HTML page shows you the version, e.g. R009.066.46.00U and the platform,
e.g. ams-drx780.

If those files do not exist you can populate the tx directory with them with a
command like this:

<newyard-fetch>
you can get by saying newyard_fetch_diag.sh <platform> <version>
It then puts them in ~/tx/<platform>/<version>

newyard_fetch_diag.sh $PLATFORM $VERSION

newyard_fetch_diag.sh ams-drx890 R019.087.52.00U
newyard_fetch_diag.sh ams-drx890 R019.087.01.00D  // KO since not keep si devel

Darwin_SI_Drop_R019.087.13.00D_picasso_ams-drx890_nds_si_devel_Binary_Image.tgz

[si_logs@theyard R018.085.67.00U]$ pwd
/home/si_logs/tx/ams-drx890/R018.085.67.00U

drwxr-xr-x  3 si_logs si_logs 4096 Jul 31 16:33 diag_binary
drwxr-xr-x  2 si_logs si_logs   24 Jun 20 10:58 jars
-rw-r--r--  1 si_logs si_logs    6 Jun 20 11:28 marker.ps
drwxr-xr-x  2 si_logs si_logs   31 Jun 20 10:54 picasso_map_files
drwxr-xr-x  2 si_logs si_logs 4096 Jun 20 11:04 unstripped_libraries
drwxr-xr-x  2 si_logs si_logs 4096 Jun 20 10:57 unstripped_processes


The unstripped binaries for the build are in
~/tx/$PLATFORM/$VERSION/unstripped_processes/.

$ ls ~/tx/ams-drx780/R009.066.46.00U/unstripped_processes/
APP_Process  disk_partition    FusionConfigExport  FusionConfigPatch     MW_Process   SCD_Process
CA_Process   FusionConfigDump  FusionConfigImport  FusionConfigXmlPatch  PWM_Process  STM_Process

theyard$ ~/bin/mips-gdb

// don't seem to have all libs
// set solib-search-path ~/com.nds.darwin.debugsupport/debug_libs/uClibc-nptl-0.9.29-20070423

set solib-absolute-prefix /junk
set solib-search-path /home/si_logs/kit.park/unstripped_libraries
set solib-search-path /home/si_logs/tx/ams-drx890/R019.087.46.00U/unstripped_libraries


// (gdb) i source
// Current source file is libc/stdlib/malloc-standard/free.c
// Compilation directory is /usr/src/redhat/BUILD/uClibc-nptl-0.9.29-20070423
/home/si_logs/kit.park/uClibc-nptl-0.9.29-20070423

set substitute-path /usr/src/redhat/BUILD /home/si_logs/kit.park

file /home/si_logs/tx/ams-drx890/R019.087.46.00U/unstripped_processes/MW_Process
core 465.COR

set solib-search-path /home/kyoupark/si_logs/memb/R019.087.52.00M/unstripped_libraries
file /home/kyoupark/si_logs/memb/R019.087.52.00M/unstripped_processes/APP_Process

thread apply all bt full
bt full


={============================================================================
|kt_dev_si_0002| si-build-baseline

http://hetty.cisco.com/fusionmadesimple/index.php/Creating_and_Releasing_a_Darwin_SI_Baseline_via_Git

$ git pull --rebase
$ git submodule update --init  # in case the pull brought in submodule changes

note:
When make a commit in submodule, this will be shown in upper module and cause
to make a commit there.

note:
Should make a branch in submodule before making any changes.


{dms}
// Bring in a new DMS

SI_BRANCH=BSKYB_HR015_Int
DMS_BRANCH=DMS_BSKYB_HR015
OLD_DMS="D91.0.6"
NEW_DMS="D91.0.8"
echo -e "\nSI_BRANCH:  ${SI_BRANCH}\nDMS_BRANCH: ${DMS_BRANCH}\nOLD_DMS: ${OLD_DMS}\nNEW_DMS: ${NEW_DMS}\n"

echo git merge ${DMS_BRANCH}/${NEW_DMS} --no-commit
git merge ${DMS_BRANCH}/${NEW_DMS} --no-commit

# Git will report (possibly amongst other conflicts):
...
CONFLICT (file/directory): There is a directory with name THIRD_PARTY_LIBRARIES/BSKYB_JTH in ${DMS_BRANCH}/${NEW_DMS}. Adding THIRD_PARTY_LIBRARIES/BSKYB_JTH as THIRD_PARTY_LIBRARIES/BSKYB_JTH~HEAD
...
# To resolve that conflict, just type:
git add THIRD_PARTY_LIBRARIES/BSKYB_JTH

# If there's been a merge conflict for `resolve_deps.ini`
$ git mergetool Resolve_Deps/ini_files/resolve_deps.ini

# Otherwise, check for upstream changes to resolve_deps.ini between old and new DMS:
git log -p ${DMS_BRANCH}/${OLD_DMS}..${DMS_BRANCH}/${NEW_DMS} -- Resolve_Deps/ini_files/resolve_deps.ini

# If the output of the previous command is *not* empty:
# {
$ git checkout ${SI_BRANCH} -- Resolve_Deps/ini_files/resolve_deps.ini
$ emacs Resolve_Deps/ini_files/resolve_deps.ini  # edit as appropriate
$ git add Resolve_Deps/ini_files/resolve_deps.ini
# }

$ git commit

# Reflect any merged-in changes to submodules in the workspace:
git submodule update --init

*goto-make-baseline*


{picasso}
this is `submodule` and have own git repo.

BSKYB_JTH_pvrR12.99428_BSKYB_JTH_HR015_Int

NEW_PICASSO_BRANCH="HR015_Int"
NEW_PICASSO="pvrR12.99428"
echo -e "\nNEW_PICASSO \t\t: ${NEW_PICASSO}\nNEW_PICASSO_BRANCH \t: ${NEW_PICASSO_BRANCH}\n"

note:
# A new Picasso baseline might come from GM or from branch, e.g.:
# BSKYB_JTH_trunk.94366_BSKYB_JTH_GM_Integration / BSKYB_JTH_trunk.97292_BSKYB_JTH_HR014_Int
#                                 ^^^^^^^^^^^^^^                                   ^^^^^^^^^


cd THIRD_PARTY_LIBRARIES/BSKYB_JTH; git fetch

// check if it is already imported in git
// http://hudsonmaster1.uk.nds.com:8080/hudson/view/import_releases/
// 
// or inspect fetch
//
// git ll BSKYB_JTH_HR015_Int..origin/BSKYB_JTH_HR015_Int
//
// # * [new tag]         BSKYB_JTH_pvrR12.98832_BSKYB_JTH_HR015_Int -> BSKYB_JTH_pvrR12.98832_BSKYB_JTH_HR015_Int
// # * [new tag]         BSKYB_JTH_pvrR12.98863_BSKYB_JTH_HR015_Int -> BSKYB_JTH_pvrR12.98863_BSKYB_JTH_HR015_Int
// # * [new tag]         BSKYB_JTH_pvrR12.98895_BSKYB_JTH_HR015_Int -> BSKYB_JTH_pvrR12.98895_BSKYB_JTH_HR015_Int
//
// from email
// FW: R12  Release-picasso__BSKYB_HR015_Integration__pvrR12__98832


echo git checkout BSKYB_JTH_${NEW_PICASSO}_BSKYB_JTH_${NEW_PICASSO_BRANCH}
git checkout BSKYB_JTH_${NEW_PICASSO}_BSKYB_JTH_${NEW_PICASSO_BRANCH}
// git co BSKYB_JTH_pvrR12.98832_BSKYB_JTH_HR015_Int

$ cd ../..
$ git status
git add THIRD_PARTY_LIBRARIES/BSKYB_JTH

# git commit -m "Switch to new Picasso (pvrR12.98863)"
echo git commit -m "Switch to new Picasso (${NEW_PICASSO})"


{check-what-to-push}
git ll origin/BSKYB_HR015_Int..BSKYB_HR015_Int


{make-tag}
SI_BRANCH=BSKYB_HR015_Int

NEW_SI_BL="84.48.00"
echo -e "\nSI_BRANCH:  ${SI_BRANCH}\nNEW_SI_BL: ${NEW_SI_BL}\n"


<new-dms-only>
echo git tag ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH} \
-am "SI baseline ${NEW_SI_BL} with new DMS (${NEW_DMS})"

// echo git tag ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH} -am "SI baseline ${NEW_SI_BL} with new DMS (${NEW_DMS})"
// git tag BSKYB_HR015_Int/BSKYB_INTEGRATION_BLD_84.48.00_BSKYB_HR015_Int -am SI baseline 84.48.00 with new DMS (D91.0.8)


<new-dms-and-picasso>
echo git tag ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH} \
-am "SI baseline ${NEW_SI_BL} with new DMS (${NEW_DMS}) and new Picasso (${NEW_PICASSO})"

git tag BSKYB_HR015_Int/BSKYB_INTEGRATION_BLD_84.40.00_BSKYB_HR015_Int -am "SI baseline 84.40.00 with new Picasso (pvrR12.98863)"



# Create the new SI BL tag:-

echo git tag ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH} \
-am "SI baseline ${NEW_SI_BL} with new Picasso (${NEW_PICASSO})"



{pssh}
// Push the committed changes to Gerrit:

echo git push origin HEAD:refs/for/${SI_BRANCH}

git push -n origin HEAD:refs/for/${SI_BRANCH}
git push origin HEAD:refs/for/BSKYB_HR015_Int
git push -n origin HEAD:refs/for/BSKYB_GM_Integration
git push -n origin HEAD:refs/for/master


To ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW
 ! [remote rejected]       HEAD -> refs/for/BSKYB_GM_Integration (missing Change-Id in commit message footer)
error: failed to push some refs to 'ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW'


<gerrit>
// Go to Gerrit (the URL is in the output of the previous command), get the
// changes reviewed ('Code-Review +2') and then 'Submit' them.

<push>
// Push the new SI BL tag:
echo git push -n origin ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH}
git push -n origin ${SI_BRANCH}/BSKYB_INTEGRATION_BLD_${NEW_SI_BL}_${SI_BRANCH}


<hudson>
note: reuse the previous build
Goto http://hudsonmaster1:8080/hudson/job/AutoSI_GetBaseline/, log in, select
'Build with Parameters' on the left hand side, fill in the appropriate values
and start the baseline build.
NB: Use if possible 'ukstbuild3_bskyb' as CC_SERVER; the Bash shell on
'hudsconccspur' appears to be set up slightly differently.


={============================================================================
|kt_dev_si_0002| si-build-artifactory comp-nds-driver

https://wiki.cisco.com/display/GITFUSION/Platform+configuration+in+Git

// git clone -b AMS_BCM_MIPS4K_LNUX_DARWIN_01 ssh://phburnet@wwwin-git-gpk-2.cisco.com:29418/platforms/platform_hub

git clone -b AMS_BCM_MIPS4K_LNUX_DARWIN_01 ssh://kyoupark@wwwin-git-gpk-2.cisco.com:29418/platforms/platform_hub platform_hub_repo

cd platform_hub

Resolve_Deps/scripts/resolve_deps.sh

kyoupark@st-castor-03:~/platform_hub$ git submodule status
 e08ce3183b1fd216cb1776a6ba47d803d9b03e38 AMS_BCM_MIPS4K_LNUX_DARWIN_01 (AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20)
 ac852f3614b562902597a27b2e30678aa85be306 FUSIONOS/CDI_INC (CDI_INC_FOSVERSION_29.1.1.1)
 2bfe35e6143a1fbc952f002d1be8ddb8934eea89 FUSIONOS/FOS_INC (FOS_INC_FOSVERSION_29.1.1.1)
 f7403257fbe5d05b5e46b79efe76d90f3280fcb1 FUSIONOS/MHXNVRAMFS (MHXNVRAMFS_F83.0.0.REL_MHXNVRAMFS_MAIN_Int)
 9debc66e770305d28bb6effe3c13f9257f157b77 FUSIONOS/XTVFS (master/XTVFS_OS20.0.41_XTVFS_MAIN_2_Int)
 e55ce2459371f8eaecc382e8d732c971438b1208 FUSIONOS_3/CDI_TRACKER (master/CDI_TRACKER_1.0.29_CDI_TRACKER_MAIN_Int)

 fa1685318a162ef15f630c9682b0e697bdb9d828 `XTV_Low_Level_VOB/XTVFS_Comp` (master/XTVFS_Comp_20.0.66_xtvfs_main_3_Int)

 e97542ce5916574f7c4b08ccd7d08bbabc89906a XTV_Low_Level_VOB/xi64_comp (master/xi64_comp_Ver.1.0.4_xi64_main_Integration)
 854002a74386263f233300343ed5016a9b400935 XTV_Tools_VOB/xdat_comp (master/xdat_comp_xdat_main_2.0.9)


http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/

Importing customer CDI tarball
------------------------------
The customer CDI tarball is imported into the platform repo here are the steps
that should be taken

# From the starting point of the `platform_hub` root directory
cd <platform git submodule path>

// kyoupark@st-castor-03:~/platform_hub/AMS_BCM_MIPS4K_LNUX_DARWIN_01$ ll
// total 36
// -rw-rw-r--  1 kyoupark ccisco   54 Feb 28 15:02 .git
// -rw-rw-r--  1 kyoupark ccisco    6 Feb 28 15:02 .gitignore
// drwxrwxr-x  4 kyoupark ccisco 4096 Feb 28 15:02 BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/
// drwxrwxr-x  6 kyoupark ccisco 4096 Feb 28 15:02 DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/
// drwxrwxr-x  3 kyoupark ccisco 4096 Feb 28 15:02 Resolve_Deps/
// drwxrwxr-x  3 kyoupark ccisco 4096 Feb 28 15:02 KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/
// -rwxrwxr-x  1 kyoupark ccisco  792 Feb 28 15:02 initialise_hooks*
// drwxr-xr-x  6 kyoupark ccisco 4096 Feb 28 15:02 ./
// drwxr-xr-x 15 kyoupark ccisco 4096 Feb 28 15:02 ../

// kyoupark@st-castor-03:~/platform_hub/AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball$ ll
// lrwxrwxrwx 1 kyoupark ccisco   96 Feb 28 15:02 kernel-headers-ams-drx890-preprod.tar.gz -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/kernel-headers-ams-drx890-preprod.tar.gz
// lrwxrwxrwx 1 kyoupark ccisco   94 Feb 28 15:02 kernel-headers-ams-drx890-debug.tar.gz -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/kernel-headers-ams-drx890-debug.tar.gz
// lrwxrwxrwx 1 kyoupark ccisco   91 Feb 28 15:02 cdi-drivers-ams-drx890-prod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-prod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   94 Feb 28 15:02 cdi-drivers-ams-drx890-preprod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-preprod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   92 Feb 28 15:02 cdi-drivers-ams-drx890-debug.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-debug.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   94 Feb 28 15:02 service-centre-ams-drx890-prod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/service-centre-ams-drx890-prod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   97 Feb 28 15:02 service-centre-ams-drx890-preprod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/service-centre-ams-drx890-preprod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   95 Feb 28 15:02 service-centre-ams-drx890-debug.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/service-centre-ams-drx890-debug.tar.bz2*
//
// lrwxrwxrwx 1 kyoupark ccisco   87 Feb 28 15:02 nds-drv-ams-drx890-prod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-prod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   90 Feb 28 15:02 nds-drv-ams-drx890-preprod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-preprod.tar.bz2
// lrwxrwxrwx 1 kyoupark ccisco   88 Feb 28 15:02 nds-drv-ams-drx890-debug.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-debug.tar.bz2
//
// lrwxrwxrwx 1 kyoupark ccisco   93 Feb 28 15:02 kernel-headers-ams-drx890-prod.tar.gz -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/kernel-headers-ams-drx890-prod.tar.gz


// * e08ce31 : (HEAD -> AMS_BCM_MIPS4K_LNUX_DARWIN_01, tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20, origin/HEAD, origin/AMS_BCM_MIPS4K_LNUX_DARWIN_01_SquashFS, origin/AMS_BCM_MIPS4K_LNUX_DARWIN_01) Automated driver import script (5 months ago) <Hudkins automated>
// * 05e4432 : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.0-h1.19p20) Automated driver import script (5 months ago) <Hudkins automated>
// * 247f6ef : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.15.0-h1.19p19) Automated driver import script (7 months ago) <Hudkins automated>
// * bf2e176 : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.14.1-h1.19p19) Automated driver import script (7 months ago) <Hudkins automated>
// * 7128c46 : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.14.0-h1.19p18, origin/AMS_BCM_MIPS4K_ENGG_VER3_LNUX_DARWIN_01) Automated driver import script (12 months ago) <Hudkins automated>
// * fa8eacf : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.13.1-h1.19p18) Automated driver import script (1 year, 3 months ago) <Hudkins automated>


<1> an important step before importing any files

Resolve_Deps/scripts/rm_deps_symlinks.sh
  
# Now extract files customer CDI tarball into appropriate folders BLD_<platform>, DEL_<platform> and KERN_<platform>

note:# Build platform and once built:
  
# stage any code changes
find . ! -path "./.git/*"  -type f -exec grep -Il . {} \; | while read file; do echo "git add \"${file}\"" ;done | bash
 
# add any imported symlinks
find . -type l -exec git add -f {} \;
 
# create tarball
git ls-files --others | tar -zcf /tmp/<platform>.tar.gz --files-from –


<2>
// AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20.tar.gz
//
// Has two dirs which don't have sym links:
//
// drwxr-xr-x 3 kyoupark ccisco 4096 Oct 16 16:44 KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/
// drwxr-xr-x 6 kyoupark ccisco 4096 Oct 16 16:44 DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/
//
// when untar nds-drv-ams-drx890-debug.tar.bz2:
//
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./etc/
// -rwxr-xr-x bskyb/cisco      91 2018-04-17 18:23 ./etc/load-nds-drivers.sh
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./usr/
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./usr/bin/
// -rwxr-xr-x bskyb/cisco  163324 2018-04-17 18:23 ./usr/bin/xtvfs_format
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./lib/
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./lib/modules/
// drwxr-xr-x bskyb/cisco       0 2018-04-17 18:23 ./lib/modules/2.6.18.8/
// -rw-r--r-- bskyb/cisco  556960 2018-04-17 18:23 ./lib/modules/2.6.18.8/xtvfs.ko
// -rw-r--r-- bskyb/cisco   61684 2018-04-17 18:23 ./lib/modules/2.6.18.8/mhxnvramfs.ko
//
// tar cvjfp filename
//
// the current tag/tar  : AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20
// the next             : AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20
//
// tar cvzfp AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20.tar.gz -C xxx .
// tar czvf AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21.tar.gz -C xxx .
//
// -rw-r--r--  1 kyoupark ccisco 226961844 Oct 16 16:44 AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20.tar.gz   
// -rw-r--r--  1 kyoupark ccisco 226964700 Mar  1 09:32 AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20.tar.gz
  

<3> deploy artifact, push tar file

// curl -u stb-bin-deployer:7Th3kSL7ED -X PUT --data-binary @/tmp/<platform>.tar.gz http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/<platform>/<revision>/<platform>-<revision>.tar.gz

// <where-to-push>
// curl -u stb-bin-deployer:7Th3kSL7ED -X PUT --data-binary @./AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20.tar.gz \
// http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20.tar.gz
// http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20.tar.gz
// http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.4-h1.19p21
// http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/

curl -u stb-bin-deployer:7Th3kSL7ED -X PUT --data-binary @./AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21.tar.gz \
http://engci-maven.cisco.com/artifactory/STB_BIN-thirdparty-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21.tar.gz


// disregard since cannot push and seems like it mirrors thirdparty-repo
// <where-to-get>
// http://engci-maven.cisco.com/artifactory/STB_BIN-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.4-h1.19p21/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.4-h1.19p21.tar.gz ...
// downloading http://engci-maven.cisco.com/artifactory/STB_BIN-repo/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.4-h1.19p21/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.4-h1.19p21.tar.gz ...


# remove untracked files
for a in `git ls-files --others` ; do rm $a ;done
  

<4> `edit ivy file` and replace the artifact revision with the new deployed in the previous step
// /home/kyoupark/platform_hub_repo
vi Resolve_Deps/ivy_files/download_platform_bin_ivy.xml

// <?xml version="1.0" encoding="UTF-8"?>
// <ivy-module version="2.0">
// <info organisation="platforms" module="bin_AMS_BCM_MIPS4K_LNUX_DARWIN_01"/>
// <dependencies>
//
// <dependency org="platforms" name="AMS_BCM_MIPS4K_LNUX_DARWIN_01" rev="AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.1-h1.19p20">
// <artifact name="AMS_BCM_MIPS4K_LNUX_DARWIN_01" ext="tar.gz" type="gz"/>
//         </dependency>
//
// <dependency org="toolchains" name="mips4k_gcc_x86_linux_hound_2_debuglibs" rev="mips4k_gcc_x86_linux_hound_2_debuglibs_crosstools_hf-linux-2.6.18.0_gcc-4.2-10tsHound_uclibc-nptl-0.9.29-20070423_20140508">
// <artifact name="mips4k_gcc_x86_linux_hound_2_debuglibs" ext="tar.gz" type="gz"/>
//         </dependency>
// <dependency org="toolchains" name="mips4k_gcc_x86_linux_hound_2" rev="mips4k_gcc_x86_linux_hound_2_crosstools_hf-linux-2.6.18.0_gcc-4.2-10tsHound_uclibc-nptl-0.9.29-20070423_20140508">
// <artifact name="mips4k_gcc_x86_linux_hound_2" ext="tar.gz" type="gz"/>
//         </dependency>
// </dependencies>
// </ivy-module>
  

# <5> retrieve newly deployed artifact
cd ..
Resolve_Deps/scripts/resolve_deps.sh

# now recreate symlinks
cd <platform>
../Resolve_Deps/scripts/create_dependencies.pl ../deps/DEL_<platform> DEL_<platform>
../Resolve_Deps/scripts/create_dependencies.pl ../deps/KERN_<platform> KERN_<platform>

// cd AMS_BCM_MIPS4K_LNUX_DARWIN_01/
// ../Resolve_Deps/scripts/create_dependencies.pl ../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01 DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01
// ../Resolve_Deps/scripts/create_dependencies.pl ../deps/KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01 KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01


<history>
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20        // for removing ko files in script


AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20        // for xtvfs debug, tag used for the build

-> keep, AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20	import of AMS_BCM_MIPS4K_LNUX_DARWI...	tag	| commit | shortlog | log
// `7c7dcea3e2e47636aa310923f33cfec02bc25d67`

-> keep, AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20	import of AMS_BCM_MIPS4K_LNUX_DARWI...	tag	| commit | shortlog | log
// 2ad7efc9d61db828f0bc0dc2caed74f6b3ebbf25

  diff --git a/AMS_BCM_MIPS4K_LNUX_DARWIN_01 b/AMS_BCM_MIPS4K_LNUX_DARWIN_01
  index 8bfb474..7c7dcea 160000
  --- a/AMS_BCM_MIPS4K_LNUX_DARWIN_01
  +++ b/AMS_BCM_MIPS4K_LNUX_DARWIN_01
  @@ -1 +1 @@
  -Subproject commit 8bfb474647368647e7bc3421d05755226a05b5c3
  +Subproject commit `7c7dcea3e2e47636aa310923f33cfec02bc25d67`
  diff --git a/XTV_Low_Level_VOB/XTVFS_Comp b/XTV_Low_Level_VOB/XTVFS_Comp
  index fa16853..4673649 160000
  --- a/XTV_Low_Level_VOB/XTVFS_Comp
  +++ b/XTV_Low_Level_VOB/XTVFS_Comp
  @@ -1 +1 @@
  -Subproject commit fa1685318a162ef15f630c9682b0e697bdb9d828
  +Subproject commit 467364987754691d41f73ccfc1884dd7104f250a


// for xtvfs debug, tag used for the build. same contents but different tag
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21

// different commit but content are the same
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p22
// 0cf659685361122c5f917645d6b06f30cc17a074


// same
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20	import of AMS_BCM_MIPS4K_LNUX_DARWI...	tag	| commit | shortlog | log
AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21	import of AMS_BCM_MIPS4K_LNUX_DARWI...	tag	| commit | shortlog | log
// 1a2920a2982b849445096c5441a41a39269e983c
  +Subproject commit 7c7dcea3e2e47636aa310923f33cfec02bc25d67
  +Subproject commit 467364987754691d41f73ccfc1884dd7104f250a


// delete from remote 
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p22
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21

AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p22
AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21

// make a new
AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21
AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21


<history-xtvfs-back>
// xtvfs fix
Tag: BSKYB_HR019_XTVFS/XTVFS_Comp_87.67.01_xtvfs_main_3_Int

* 4673649 : (HEAD, tag: BSKYB_HR019_XTVFS/XTVFS_Comp_87.67.01_xtvfs_main_3_Int, origin/BSKYB_HR019_XTVFS) [SI-11369] - Increase the max file open to 300"" (3 weeks ago) <Rayees Khan (rayekhan)>
* 60ac1fe : Revert "[SI-11369] - Increase the max file open to 300" (3 weeks ago) <Rayees Khan (rayekhan)>
* c6ca747 : [NGDEV-XXX] - Increase the max file open to 300 (3 weeks ago) <Pushparaj>
* fa16853 : (tag: master/XTVFS_Comp_20.0.66_xtvfs_main_3_Int) sync of XTVFS_Comp_20.0.66_xtvfs_main_3_Int (2 years, 7 months ago) <Phil Burnett-Yerkess>
* e785865 : (tag: master/XTVFS_Comp_20.0.65_xtvfs_main_3_Int) sync of XTVFS_Comp_20.0.65_xtvfs_main_3_Int (2 years, 7 months ago) <Phil Burnett-Yerkess>


<from-driver-import-script>

note: to run it locally

// buildserver@/home/kyoupark/si/ETHAN_SI_SCRIPTS/scripts/driver_import

cd /home/kyoupark/si/ETHAN_SI_SCRIPTS/scripts/driver_import
mkdir ./temp
export WORKSPACE=/home/kyoupark/ETHAN_SI_SCRIPTS/scripts/driver_import/temp
export GIT_REPO_HOST=ssh://wwwin-git-gpk-2.cisco.com:29418
./drivertar2platformbl.sh cdi-release_ams-drx890_16.16.8-h1.19p21_BSKYB_HR020_Int.tar.bz2 |& tee out.log


NOTE: means that DRV_REVISION comes from tar filename or command line

        # Gather the required information from the the driver release tarball name
        # using the underscore as a delimiter.
        # PLATFORM - name of the driver platform i.e. ams-drx890
        PLATFORM=`echo ${TARBALL_NAME} | cut -d'_' -f2`
        # DRV_REVISION - the version of the driver release.
        DRV_REVISION=`echo ${TARBALL_NAME} | cut -d'_' -f3`

            DRV_REVISION=$2


<commands>
Stage, commit, tag and push for review

This has to be done in two stages, first to be applied is any changes in the
platform submodule. Then secondly, within the platform_hub. 


function commit_and_push_changes () {
    echo "Committing changes to git"
    echo "------------------------"

    # Commit and make a tag in the submodule
    
    # NOTE: ivy file changes. THIS is how tar file picked up.
    #        modified:   Resolve_Deps/ivy_files/download_platform_bin_ivy.xml

    pushd ${PLATFORM_HUB}/${COMPONENT_NAME}/

    // git commit -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20"
    // git commit -a -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21"

    git commit -a -m "Automated driver import script" -m "${GIT_BRANCH}_${DRV_REVISION}"

    // Date:   Tue Mar 13 21:52:50 2018 +0000
    // 
    //     Automated driver import script
    // 
    //     AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.3-h1.19p20
    // 
    // diff --git a/AMS_BCM_MIPS4K_LNUX_DARWIN_01 b/AMS_BCM_MIPS4K_LNUX_DARWIN_01

    //     GIT_BRANCH   : "AMS_BCM_MIPS4K_LNUX_DARWIN_01" 
    //     DRV_REVISION : "16.16.3-h1.19p20"
    
    // * 9476517 : (tag: AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.3-h1.19p20) Automated driver import script (6 weeks ago) <Hudkins automated>

    git tag -a ${GIT_BRANCH}_${DRV_REVISION} -m "Automated driver import script" \
        -m " ${GIT_BRANCH}_${DRV_REVISION}"

    // git tag -a AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20 -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20"
    // git tag -a AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21 -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21"
    // git tag -a AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.6-h1.19p21 -m "SI-11392: changes to remove ko files once loaded"

    popd

    # NOTE: parent module, platform_hub. use the same commit message and tag name
    # once changes have been reviewed and submitted then commit change in platform_hub

    # Commit and make a tag in the repository

    # NOTE: 
    pushd ${PLATFORM_HUB}

    git add ${COMPONENT_NAME} # Commit the changes in the submodule
    git commit -m "Automated driver import script" -m "${GIT_BRANCH}_${DRV_REVISION}"

    // git commit -a -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21"

    git tag -a ${GIT_BRANCH}/${GIT_BRANCH}_${DRV_REVISION} -m "Automated driver import script" \
        -m "${GIT_BRANCH}_${DRV_REVISION}"

    // git tag -a AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20 -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20"
    // git tag -a AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21 -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21"

    if [ ${IS_TEST_EXECUTION} = "False" ]; then
        echo "Pushing changes to git remote repository"
        echo "----------------------------------------"

        # The push command is different when running depending on the user: Jenkins user can push directly into gerrit.
        # I assume if the JENKINS_URL variable exists the job is running in Jenkins

        // NOTE:
        pushd ${PLATFORM_HUB}/${COMPONENT_NAME}

        # Some debug commands
        pwd
        git branch
        git status

        if [ ! -z ${JENKINS_URL+x} ]; then
            echo "Running as a Jenkins job"
            git push origin ${SUBMODULE_WORKING_BRANCH}:${SUBMODULE_BRANCH}
        else
            echo "Running outside Jenkins"
            git push origin HEAD:refs/for/${SUBMODULE_BRANCH}
        fi

        # NOTE: Now push the tag. do not ceate a review
        // git push origin AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p22
        git push origin ${GIT_BRANCH}_${DRV_REVISION}

        # Sometimes it fails but everything seems alright. I don't know why
        if [ $? -ne 0 ]; then
            echo "#######################################################"
            echo "ERROR: git push failed!"
            echo "#######################################################"
            return 1
        fi

        # NOTE
        popd

        # Push the changes in the main repository
        if [ ! -z ${JENKINS_URL+x} ]; then
            echo "Running as a Jenkins job"
            git push origin ${GIT_BRANCH}
        else
            # NOTE:
            echo "Running outside Jenkins"
            git push origin HEAD:refs/for/${GIT_BRANCH}
        fi

# Sometimes this push fail and I don't know why
#       if [ $? -ne 0 ]; then
#echo "#######################################################"
#echo "ERROR: git push failed!"
#echo "#######################################################"
#return 1
#fi

        # Now push the tag
        # NOTE: do not create a review
        // git push origin AMS_BCM_MIPS4K_LNUX_DARWIN_01/AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21
        git push origin ${GIT_BRANCH}/${GIT_BRANCH}_${DRV_REVISION}

#        if [ $? -ne 0 ]; then
#            echo "#######################################################"
#            echo "ERROR: git push failed!"
#            echo "#######################################################"
#            return 1
#        fi

    fi

    popd
    return 0
}

// NOTE: TWO PUSH for AMS and platform_hub
// NOTE: need to check changeid in the commit and means that hooks is ready
// before making a commit.
// NOTE: seems unnecessary since will have a review for platform_review.
// push for review 
//
// git push origin HEAD:refs/for/<branch> 
// 
// // git push origin HEAD:refs/for/AMS_BCM_MIPS4K_LNUX_DARWIN_01
// //
// // push tag
// // git push origin AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20


// push the main and make a review
cd /home/kyoupark/platform_hub_x
git push origin HEAD:refs/for/AMS_BCM_MIPS4K_LNUX_DARWIN_01
git push origin HEAD:refs/for/AMS_BCM_MIPS4K_LNUX_DARWIN_01_HR020
# review and submit change in gerrit
 

<for-stb-sw>
Making any change live on STB_SW project branch

For projects to use a a new release of the platform imported into git, then
the submodule needs to be switched to the new sha-1 or tag

# on project or feature branch
git submodule update --init <platform>
cd <platform>

// NOTE: not platform_hub
// cd AMS_BCM_MIPS4K_LNUX_DARWIN_01

// NOTE: ensure up to date
git fetch --tags    

// * [new tag]         AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20 -> AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.2-h1.19p20

# this can also be a branch or a specific sha-1
git checkout <tag>    
// git co AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p20

cd ..

// git add -f <platform>
// git add -f AMS_BCM_MIPS4K_LNUX_DARWIN_01

# then follow your project git playbook instructions for commit, tag and push
# for review
git commit -a -m "import of AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21"
git push -n origin HEAD:refs/for/BSKYB_GM_Integration


// to verify
executing command tar -C /home/kyoupark/STB_SW/deps -xf /mnt/ivycache/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01/gzs/AMS_BCM_MIPS4K_LNUX_DARWIN_01-AMS_BCM_MIPS4K_LNUX_DARWIN_01_16.16.5-h1.19p21.t*gz
/home/kyoupark/STB_SW/deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball


<nds-driver-script>
/home/kyoupark/si/ETHAN_SI_SCRIPTS/scripts/driver_import/drivertar2platformbl.sh
/home/kyoupark/platform_hub/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build/build.sh

# Create binary package
SPK_SCRIPT_NDS_DRIVERS=/etc/load-nds-drivers.sh

echo "Creating NDS drivers package"

# only create tarballs for release type
type="release"
  for end in ${endian}
  do
    for variant in ${spk_variant}
    do
      mkdir -p output/nds-drv
      rm -f output/nds-drv/lib/modules/2.6.18.8/mhxnvramfs.ko
      install -D -m644 ${build_root}_lib/${platform}/${end}/${variant}/${type}/mhxnvramfs.ko output/nds-drv/lib/modules/2.6.18.8/mhxnvramfs.ko
      rm -f output/nds-drv/lib/modules/2.6.18.8/xtvfs.ko
      install -D -m644 ${build_root}_lib/${platform}/${end}/${variant}/${type}/xtvfs.ko output/nds-drv/lib/modules/2.6.18.8/xtvfs.ko
      rm output/nds-drv/usr/bin/xtvfs_format
      install -D ${build_root}_lib/${platform}/${end}/${variant}/${type}/xtvfs_format output/nds-drv/usr/bin/xtvfs_format
      mkdir -p "output/nds-drv/`dirname "$SPK_SCRIPT_NDS_DRIVERS"`"
      {
        echo '#!/bin/sh'
        echo 'insmod /lib/modules/2.6.18.8/mhxnvramfs.ko'
        echo 'insmod /lib/modules/2.6.18.8/xtvfs.ko'
      } >"output/nds-drv/$SPK_SCRIPT_NDS_DRIVERS"
      chmod +x "output/nds-drv/$SPK_SCRIPT_NDS_DRIVERS"
      tar -cjvf "output/nds-drv-${spk_platform}-${variant}.tar.bz2" -C output/nds-drv .
    done
  done


={============================================================================
|kt_dev_si_0002| si-build-errors

quota_resource.c: In function 'QuotasOnDevice_Add':
quota_resource.c:3475: `error:` 'Idx' undeclared (first use in this function)
quota_resource.c:3475: error: (Each undeclared identifier is reported only once
quota_resource.c:3475: error: for each function it appears in.)

make[3]: *** [/hudson/workspace/workspace/build_fullstack_image/executors/1/work/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug//components/system_resource_management/rmf/src/plugins/.//quota_resource.o] Error 1
make[3]: Leaving directory `/hudson/workspace/workspace/build_fullstack_image/executors/1/work/CMS_SYSTEM_RESOURCE/RMF/src/plugins'
make[2]: *** [rmfplugin] Error 2
make[2]: *** Waiting for unfinished jobs....


cc1: warnings being treated as errors


={============================================================================
|kt_dev_si_0002| si-build-main

<si-build>

./release_darwin_platform.sh
  calls *build-build-mw-epg*
    calls *build-make-sh*   see build.log

  calls *build-make-image*


<build-build-mw-epg>
// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/build_mw_epg.sh

    *build-version-cfg*
    echo "  --baseline <baseline>     Used to manually override the version field"
                          Can be in the form of official SI baseline name or
                          Engineering baseline name: " E. g.
                          BSKYB_INTEGRATION_BLD_15.05.00_BSKYB_GM_Integration
                          or" ENG_15.05.00_Dbg_Test" \"ENG_\" prefix will skip
                          base36 calculation and insert string after \"ENG_\"
                          into version.cfg" If no baseline parameter is
                          entered and there is no ClearCase access \"~*~dev
                          version~*~\" will be used"

                          note: HOW long?

    *build-mw-only*
    echo "  --mw_only                 builds the middleware only, no EPG built"

    echo "  --build_in_debug <component,component+1,...>  
    set specified components to be built as full debug libraries - comma separated no spaces"

    echo "  --build_in_release <component,component+1,...>  
    set specified components to be built as release libraries - comma separated no spaces"


# ./build_mw_epg.sh --platform ams-drx890 --project picasso 
#   --variant debug --profile sky_trials --baseline ENG_48.96.00U_4790_AEM_ENG
# ./build_mw_epg.sh --platform ams-drx890 --project picasso 
#   --variant debug --profile nds_si_devel --clean
# 
# OUTPUT = $(pwd)
# VARIANT = debug
#
# else [ "${USE_SYSINIT_CFG}" == "YES" ]
# ./make.sh --clean --profile ${PROFILE} --project ${PROJECT} -a ${PROJECT} --box ${BOX} --output ${OUTPUT} --baseline ${BASELINE}
# ./make.sh --clean --profile nds_si_devel --project picasso -a picasso --box ams_bcm 
# --output /home/NDS-UK/parkkt/cc/parkkt_BSKYB_GM_001/vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build --baseline  
#
# BUILD_OUTPUT_ROOT == .../picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/fs/NDS
#
parse_args "$@"

if [ -z "${WORKSPACE}" ]; then
    export WORKSPACE=$(readlink -f ${OUTPUT})
fi

source setup_platform.sh
set_up_platform $PLATFORM
ENDIAN=${ENDIAN}Endian
BUILD_OUTPUT_ROOT=${OUTPUT}/${PROJECT}/${PLATFORM_DIR}/${ENDIAN}/fs/NDS

if [ -n "$WIPEOUT" ]; then
  package_mw_epg_wipeout_binary
else
  if [ -n "$NO_APP" ]; then
      package_no_app
  else
      build_mw_epg
      package_mw_epg_binary
  fi
fi

+ STD_OPTIONS='--clean --profile sky_trials --project picasso --platform ams-drx890 --output /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build '
+ ADDED_OPTIONS='                                                      '
+ /usr/bin/time -o /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/bfi_stats -a 
  -f %C,R=%E,K=%S,U=%U ./make.sh --clean --profile sky_trials --project picasso --platform ams-drx890 
  --output /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build


function build_mw_epg()
{
  if [ -n "${NOMAKE}" ]; then
    echo "Running nomake option - not calling make.sh"
  else

    STD_OPTIONS="${CLEAN} --profile ${PROFILE} --project ${PROJECT} --platform ${PLATFORM} --output ${OUTPUT} ${BASELINE}"

    ADDED_OPTIONS="${BUILD_MW} ${BUILD_EPG} ${MEMPROF} ${TIMEDOCTOR} ${USE_SYSINIT_CFG} ${MEMBUSTER} ${MEMMAP_ANALYSE} \
      ${ENABLE_LAE_DEBUG_HACKS} `${PATCH_BLD_OPT_DBG}` ${PATCH_BLD_OPT_REL} ${LOGFILE_MONITOR} ${FILLDISK} \
      ${FULL_PARALLEL}"

    # *build-make-sh*   
    /usr/bin/time -o ${WORKSPACE}/bfi_stats -a -f "%C,R=%E,K=%S,U=%U" `./make.sh ${STD_OPTIONS} ${ADDED_OPTIONS}`

    if [ "${PIPESTATUS[0]}" -ne 0 ]; then
      echo "**** FAILED TO make ${project} ****"
      exit 1
    fi
  fi
}

package_mw_epg_binary()
{
  SPK_TARBALL_MW=mw-epg-${PLATFORM}-${VARIANT}-${PROFILE}.tar.bz2
  SPK_SCRIPT_MW=/etc/start-mw.sh

  tar -cjvf "$SPK_TARBALL_MW" -C nds-mw .
  rm -rf nds-mw

  // *build-mw-output*
  // FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/mw-epg-ams-drx890-debug-sky_trials.tar.bz2
  mv ${SPK_TARBALL_MW} ${OUTPUT}/${PROJECT}/${PLATFORM_DIR}/${ENDIAN}/
}


<build-make-sh>
// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/make.sh

  echo "  --mw_only                 builds the middleware only, no EPG built"

  echo "  -d, --debug_level <level> build middleware for a specific debug level."
  echo "                            level may be \"debug\", \"release_dbg\" or \"release\""

  echo "  -o, --os_debug_level <level>"
  echo "                            link OS-specific libraries for a specific debug level."
  echo "                            level may be \"debug\", \"release_dbg\" or \"release\""
  echo "                            H=Hound-Development, NH=Non-Hound;"

# *build-options-mk* *enable-comp-diag*
#
# --build_in_debug dbe_interface,darwin_planner_src,rmfplugin
#
# To build a component to have diag, set NDS_BUILD_TYPE_$COMPONENT_NAME = debug
# this is where changes are made by flipper or makefile. NEED TO set diag
# level in xml or else
#
# NDS_BUILD_TYPE_rmfplugin = debug
# NDS_BUILD_TYPE_darwin_planner_src = debug
# NDS_BUILD_TYPE_dbe_interface = debug
#
# include $(NDS_ROOT)/projects/fusion2/build_options.mk

    --build_in_debug)
      shift
      patch_build_options_debug `echo $1 | sed 's/,/ /g'`
      ;;
    --build_in_release)
      shift
      patch_build_options_release `echo $1 | sed 's/,/ /g'`
      ;;


// echo "dbe_interface,darwin_planner_src,rmfplugin" | sed 's/,/ /g'
// dbe_interface darwin_planner_src rmfplugin


# Patch build options to enable debug on release_dbg build for selected components
function patch_build_options_debug()
{
    echo "##############################"
    echo "# Patching  build options.mk #"
    echo "##############################"

    while [ "$1" != "" ]; do
      if ! ( grep -qi "NDS_BUILD_TYPE_$1 = debug" ${CWD}/projects/$PROJECT/build_options.mk); then
         echo "Setting $1 to debug"
         sed -i '3i NDS_BUILD_TYPE_'$1' = debug' ${CWD}/projects/$PROJECT/build_options.mk
      fi
      shift
    done
}


  // NDS_OS_BUILD_TYPE:="${OS_BUILD_TYPE}". 'release' is default
  // NDS_OS_BUILD_TYPE:=release     

    // (version_string_calculation.py)
    //
    // def get_letter_for_build_type(build_type):
    //     build_type_list=dict(sky_prod='P', 
    //                          sky_trials='U', 
    //                          sky_tpt='T', 
    //                          nds_si_devel='D',
    //                          cust_trials='C')
    // 


  <build-variant>
  nds_si_devel )  ## for development
      BUILD_TYPE=release_dbg
      PICASSO_BLD_TYPE=release-trials
      DIAG_MIN_FOOTPRINT=YES

  sky_trials )    ## for trials testing
        BUILD_TYPE=release_dbg
        PDL_SERVER=SKY_Trials
        PICASSO_BLD_TYPE=release-trials
        DIAG_BINARY_MODE=YES
        DIAG_PERFORMANCE_MODE=YES
        MEMPROF=YES
        ;;

  cust_trials )    ## for Sky customer testing 
        BUILD_TYPE=release_dbg
        PDL_SERVER=SKY_Production
        PICASSO_BLD_TYPE=release-trials
        DIAG_BINARY_MODE=YES
        DIAG_PERFORMANCE_MODE=YES
        ;;

  VERSION_STRING=`python tools/nds/si/python/version_string_calculation.py ${PROFILE} ${BASELINE}`

{

  ${MAKE_EXE} -s \
    BUILD_EPG:="${BUILD_EPG}" \
    BUILD_MW:="${BUILD_MW}" \
    NDS_MW_PROJECT:="${NDS_MW_PROJECT_SI}" \
    MEMMAN_TIMINGS:="${MEMMAN_TIMINGS}" \
    MEMMAN_OUTPUT_ONCE:="${MEMMAN_OUTPUT_ONCE}" \
    NDS_BUILD_ROOT:="${OUTPUT}" \
    NDS_BUILD_PROJECT:="${PROJECT}" \
    NDS_PLATFORM:="${PLATFORM_DIR}" \
    SQLITE_WANT_PROFILING:=YES \
    NDS_PLATFORM_ENDIAN:="${ENDIAN}Endian" \
    NDS_FUSIONOS:=${FUSIONOS} \
    NDS_USE_CPP:=YES \
    NDS_LOCATION:=ST \
    `NDS_BUILD_TYPE_DEFAULT`:="${BUILD_TYPE}" // from profile sets.

    *diag-debug*
    `DIAG_BINARY_MODE`:=${DIAG_BINARY_MODE} \
    ...
}


*build-makefile*
// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/makefile
// makefile -> ../../../BUILD_SYSTEM/COMMON_MAKEFILES/makefile

make - --directory=projects/picasso --print-directory --no-builtin-rules \
NDS_BUILD_SYSTEM=FUSION NDS_ROOT=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build 
NDS_ROOT_UNIX=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build NDS_LOCAL_TOOLS= NDS_PLATFORM=AMS_BCM_MIPS4K_LNUX_DARWIN_01 NDS_PROJECT=picasso NDS_BUILD_PROJECT=picasso NDS_STB= NDS_BUILD_ROOT=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso NDS_HOST=linux NDS_MAKE=make --debug NDS_PARALLEL=1 NDS_BUILD_TYPE_DEFAULT=release_dbg NDS_DEFINES="" NDS_LOCATION=ST COMPONENTS_DIR="/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components" NDS_TOOLS_ROOT="/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build" VOB_ROOT="/home/NDS-UK/kyoupark/STB_SW" VOB_ROOT_UNIX="/home/NDS-UK/kyoupark/STB_SW" PLATFORMS_TOOLS_ROOT="/home/NDS-UK/kyoupark/STB_SW" NDS_FUSIONOS="FUSIONOS_2" NDS_FUSIONOS_PRE="FUSIONOS" NDS_FUSIONOS_VER=" _2" NDS_USE_CCACHE= NDS_USE_REL_PATHS= NDS_CCACHE_EXE= NDS_HOST_CC=/usr/bin/ NDS_TARGET:=install install


note:
--directory=projects/picasso

‘--directory=dir’
    Change to directory dir before reading the makefiles. If multiple ‘-C’
    options are specified, each is interpreted relative to the previous one:
    ‘-C / -C etc’ is equivalent to ‘-C /etc’. This is typically used with
    recursive invocations of make (see Recursive Use of make).


ifeq (,$(PLATFORMS_TOOLS_ROOT))
  ifneq (,$(wildcard $(VOB_ROOT)/$(NDS_PLATFORM)/BLD_$(NDS_PLATFORM)))
    PLATFORMS_TOOLS_ROOT:=$(VOB_ROOT)
  else
    ifneq (,$(wildcard $(VOB_ROOT)/deps))
      PLATFORMS_TOOLS_ROOT:=$(VOB_ROOT)/deps
    else
      PLATFORMS_TOOLS_ROOT:=$(VOB_ROOT)
    endif
  endif
endif

common.mk
261:# Remove unnecessary white spaces in variables used in platform.mk
275:include $(PLATFORMS_TOOLS_ROOT)/$(NDS_FUSIONOS)/BLD_$(NDS_PLATFORM)/platform_cfg/$(NDS_HOST)/platform.mk


<project-picasso-makefile>
// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/makefile

ifeq ($(MEMBUSTER), YES)
    # updating NDS_DEFINE here as memman src.mk requires this.
    override NDS_DEFINES += MEMMAN_MEMBUSTER
    override NDS_DEFINES += MEMBUSTER_SHORT_LOG
    override NDS_DEFINES += MEMBUSTER_NO_DOUBLE_FREE_MSG
endif

# using dynamic memory allocation for all platforms
override PROJECT_DEFINES+=`MEMMAN_FORCE_USE_MALLOC_DIRECTLY`

ifneq ($(BUILD_CARANGE_LIB_ONLY), YES)
    LOCAL_COMPONENTS += ../processes/APP_Process
endif

ifeq ($(BUILD_MW),YES)
    LOCAL_COMPONENTS += ../processes/MW_Process
endif

.PHONY: $(LOCAL_COMPONENTS)
$(LOCAL_COMPONENTS):
	/usr/bin/time -o ${WORKSPACE}/bfi_stats -a -f "%C,R=%E,K=%S,U=%U" $(MAKE) $(PARALLELISM) -C $(NDS_ROOT)/components/$@ $(MAKE_ARGS)

// /usr/bin/time -o /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/bfi_stats -a -f "%C,R=%E,K=%S,U=%U" 
// make  -C /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/../processes/APP_Process  
// NDS_TRANSPORT_MODE=""
// PROJECT_PREBUILT_LIBRARIES="/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/engines/lae/lib/BigEndian/libcore.a
// /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/engines/lae/lib/BigEndian/libstbeplatform.a
// /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/engines/lae/lib/BigEndian/libstbecommon.a"
// PRODUCT_IDENTIFIER="" PROJECT_IDENTIFIER="" NDS_OS_BUILD_TYPE=release
// PROJECT_DEFINES="MEMLIST MEMLIST_SLEEP_PERIOD=60 MEMPROF PROFILE_A
// DIAG_LOG_NDEBUG NDEBUG MEMMAN_TRUSTED_CLIENT GFX_NO_SHAPE
// GFX_IMAGE_NO_DITHERING GFX_PAINTER_NO_ARGB16_4444
// GFX_PAINTER_NO_ARGB16_4444_PREMULT GFX_PAINTER_NO_RGB16_565
// GFX_PAINTER_NO_SURFACE_RW MSCQ189287_CLOCK_MONOTONIC_NOT_SUPPORTED CQ171339
// LEGACY_MIGRATION_SUPPORT SUN_BUILD NDS_APP_TYPE_PICASSO DIAG_JAVA_DEBUG
// _XOPEN_SOURCE=600 AMS_BCM_MIPS4K_LNUX_DARWIN_01 FUSION_PROFILE
// MEMMAN_TRUSTED_CLIENT MSCQ1854424_SP_SCHEMA_ONLY
// MSCQ2375670_SET_PROVIDER_CLASS_MEMBERSHIP CQ380004_USE_STB_SW_01
// MEMMAN_FORCE_USE_MALLOC_DIRECTLY" PROJECT_SHARED_LIBS="" NDS_DEFINES=""
// PROJECT_ENABLE_PUBLICLIBS="" PROJECT_LINT_CONFIG="" PROJECT_PARENT=fusion2
// NDS_VGV_PROJECT="darwin" NDS_MW_PROJECT="BSKYB_HD_PVR_SI" install
// FUSION_PROFILE="BSKYB_HD_PVR_SI"
// FUSION_PROFILE_DEFINES="APP_MGMT_SIGNAL_24_7_SERVICE_TYPE_82H
// APP_MGMT_SIGNAL_ETV_OTV_TRIGGER_MOD
// APP_MGMT_SIGNAL_RECOMMENDATION_OTV_PROMO_MOD AUTHENTICATION_NDS_SAC
// BSKYB_SUPPORT_HEP_WITH_OIG CALLBACK_PSTN CAPTION_TELETEXT_LEGACY_LAYOUT
// CAROUSEL_MHC CAROUSEL_OTV CA_VIDEOGUARD_NDS_SECURE_RETURN_PATH
// CA_VIDEOGUARD_PARENTAL_RESTRICT CA_VIDEOGUARD_WATERSHED FRONT_END_DTT_USB
// FRONT_END_SAT FRONT_END_SAT_SCR FUSION_APP_MGMT_SUPPORTED
// FUSION_AUTHENTICATION_SUPPORTED FUSION_BDL_SUPPORTED
// FUSION_CA_VIDEOGUARD_SUPPORTED FUSION_DYNAMIC_TSA_SUPPORTED
// FUSION_HEADEND_METADATA_SUPPORTED FUSION_HOME_NETWORK_SUPPORTED
// FUSION_METADATA_SUPPORTED FUSION_NETWORK_SUPPORTED FUSION_PDL_SUPPORTED
// FUSION_PVOD_SUPPORTED FUSION_PVR_SUPPORTED
// FUSION_TARGETED_MESSAGING_SERVICE_SUPPORTED FUSION_USER_ACTIVITY_SUPPORTED
// FUSION_VIDEOGUARD_NOTIFY_SUPPORTED FUSION_VWS_SUPPORTED
// GUIDE_BSKYB_FORMAT_LOGICAL_CHAN_NO GUIDE_BSKYB_SUBSCRIBER_PROPERTIES_USED
// HEADEND_METADATA_OIGC HOME_NETWORK_MEDIA_RENDERER
// HOME_NETWORK_PLANNER_SERVER HOME_NETWORK_REMOTE_UI HOTPLUG_SUPPORT IPPV
// MCM_PVR_RECORD_CA_HOLES METADATA_SI_XSI_SSR NETWORK_CONFIGURE_LAN
// PDL_NDS_SECURE_AUTH PLAYER_PIN_HANDLING_A PLAYER_REMOTE_UI_HTTP
// PVOD_LINEAR_TRANSPORT PVR_CHECK_XTV_STATUS PVR_CLASSIC_REVIEW_BUFFER
// SERIES_IMPLICIT_SERIES_DELETION SERIES_SYNCHRONIZE_BOOKINGS_WITH_SIGNUPS
// SI_SERVICE_SCAN_XSI SOFTWARE_DOWNLOAD_OTV
// SRM_ELEMENTARY_STREAMS_SELECTION_A
// SRM_USE_PI_SCHEDULE_FLAG_FOR_AVAILABILITY USBTUNER_SUPPORTED USB_SUPPORTED
// USER_ACTIVITY_BARB USER_ACTIVITY_SSP WIFI_SUPPORTED WLM_SUPPORTED"
// NDS_DIAG_MODE:=sync SUN_BUILD:=YES NDS_APP_TYPE:=PICASSO

// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/makefile
COMPONENT_SOURCE_LIBRARIES+=camm


// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/fusion2/makefile
// STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects
// fusion2 -> ../../../../BUILD_SYSTEM/COMMON_MAKEFILES/projects/fusion2/
// STB_SW/BUILD_SYSTEM/COMMON_MAKEFILES/projects/fusion2/makefile
-include $(NDS_ROOT)/projects/fusion2/makefile


ifneq (,$(wildcard $(PLATFORMS_TOOLS_ROOT)/$(NDS_FUSIONOS)/BLD_$(NDS_PLATFORM)/platform_cfg/$(NDS_HOST)/setenv.mk))
  include $(PLATFORMS_TOOLS_ROOT)/$(NDS_FUSIONOS)/BLD_$(NDS_PLATFORM)/platform_cfg/$(NDS_HOST)/setenv.mk
else
  LOCAL_MSG:=Unable to find $(PLATFORMS_TOOLS_ROOT)/$(NDS_FUSIONOS)/BLD_$(NDS_PLATFORM)/platform_cfg/$(NDS_HOST)/setenv.mk
  $(call WARNING,LOCAL_MSG)
  include $(NDS_TOOLS_ROOT)/platforms/$(NDS_PLATFORM)/setenv.mk
endif


<setenv-mk>
// NDS_INTEL_X86_LNUX_MRFUSION_01/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/setenv.mk

ifeq ($(`COMPILER_ROOT`),)
    COMPILER_ROOT := $(PLATFORM_ROOT)/compiler/i686-nptl-linux-gnu
endif

// COMPILER_ROOT = /home/kyoupark/STB_SW/FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/compiler/i686-nptl-linux-gnu
// i686-nptl-linux-gnu -> ../../../../../SYSTEM_BIN_3/i686_nptl_gcc_x86_linux_01//
// STB_SW/deps/SYSTEM_BIN_3/i686_nptl_gcc_x86_linux_01

# Toolchain prefix 
# Very useful for compiling open-source applications, libraries and also the Linux Kernel
# Examples, 
# when the toolchain is "arm-linux-none-gcc" COMPILER_PREFIX should be "arm-linux-none"
# when the toolchain is "mipsel-linux-uclibc-gcc" COMPILER_PREFIX should be "mipsel-linux-uclibc"
COMPILER_PREFIX := i686-nptl-linux-gnu

# "version" must be updated according to the vesion directory
# For example: NDS_GCOV_PATH := $(COMPILER_ROOT)/lib/gcc/$(COMPILER_PREFIX)/4.2.0
NDS_GCOV_PATH := $(COMPILER_ROOT)/lib/gcc/$(COMPILER_PREFIX)/4.9.1


<platform-mk>
// FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/platform.mk

LOCAL_PLATFORM_CC_FLAGS += -fsanitize=address

LOCAL_PLATFORM_CPP_FLAGS += -fsanitize=address

LOCAL_PLATFORM_TOOLSET_LIBRARIES := -lm -lpthread -lrt -ldl -ltirpc -lsky_airplay_helper -lminizip -ljsoncpp -lglib -lgio -lgobject -ldbus -lz -lasan


<linking>
/home/kyoupark/x-tools/i686-nptl-linux-gnu/bin/i686-nptl-linux-gnu-gcc
-Xlinker -Map -Xlinker
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process.map
-Xlinker --start-group `echo
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/app_process_main.o
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../applications/Picasso/libPicasso.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/platform_management/aem/src/libaem.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/camm/src/rpc/client/src/libcamm_rpc_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/presentation_services/cappres/src/libcappres.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/cmdc/src/libcmdc.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/modem/src/client/libcomms_modem_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/ciscosafec/src/libciscosafec.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/ctm/src/server/libctm_server.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/ctm/src/client/libctm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_atg/src/libdarwin_atg.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_dlm/src/dlm_client/libdarwin_dlm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_guide/src/libdarwin_guide_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_planner/src/libdarwin_planner_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_player/src/libdarwin_player_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_prefs/src/client/libdarwin_prefs_cli.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_sbm/src/client/libdarwin_sbm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_scm/src/mscp/libdarwin_scm_mscp.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_scm/src/client/libdarwin_scm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_uam/src/client/src/libdarwin_uam_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_uam/src/utils/src/libdarwin_uam_utils.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_uam/src/dcm/src/libdarwin_uam_dcm.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/diag/src/log/src/libdiag_log.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/fdm/src/fdm_api/fdm_api_optv/src/libfdm_api_optv.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/fdm/src/fdm_fs/src/libfdm_fs.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/freetype2/src/libfreetype2.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/presentation_services/gfx/src/libgfx.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/http/src/libhttp.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/httpserver/src/libhttpserver.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/ipc/src/client/libIPC_CLIENT.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/ipc/src/server/libIPC_SERVER.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sdm/src/libis_sdm.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/libJPEG/src/liblibJPEG.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/libPNG/src/liblibPNG.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/memman/src/libmemman.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/fem/src/libms_fem_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/mcm/src/libms_mcm_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/mdm/src/libms_mdm_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/mpm/src/libms_mpm_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/bem/src/client/libms_bem_client_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/capproc/src/client/libms_capproc_client_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/mpm/src/client/libms_mpm_client_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/ncm/src/client/libncm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/oigc/src/liboigc.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_platform_components/darwin_ofs/src/libOFS.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/pcat/src/client/libpcat_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/pcat/src/common/libpcat_common.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_resource_management/pdm/src/client/libpdm_cli.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_resource_management/rmf/src/framework/client/librmf_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sfm/src/libsfm.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sim/src/client/fecm/libsim_client_fecm.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sim/src/client/si/libsim_client_si.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sim/src/server/sql/lifecycle-ctrl/libsim_sql_lifecycle_controller.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sim/src/utils/thread_creation/libsim_thread_create_library.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/information_services/sim/src/utils/toolbox/libsim_toolbox_src.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_spm/utils/src/libspm_utils.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_spm/src/client/libspm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_spm/sw_download/src/client/libspm_client_sw_dwnld.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/darwin_system_platform_components/darwin_spm/service_acquisition/src/client/libspm_client_service_acquisition.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/spc/src/client/libspc_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/spc/src/common/libspc_common.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_resource_management/ssm/src/ssm_client/libSSM_CLIENT.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_resource_management/ssm/src/ssm_client/ssm_client_upnp/libSSM_CLIENT_UPNP.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_resource_management/ssm/src/ssm_common/libSSM_COMMON.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_control_and_diagnostics/sysinit/src/client/libSYSINIT_CLIENT.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemalarm/src/libsystemalarm.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemconfig/src/libsystemconfig.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemitc/src/libsystemitc.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemlang/src/libsystemlang.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemlocator/src/libsystemlocator.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemobject/src/libsystemobject.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemstring/src/libsystemstring.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemtime/src/libsystemtime.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/system_libraries/systemutil/src/libsystemutil.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/media_services/vrm/src/client/libvrm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/wlm/src/common/libwlm_common.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/comms_services/wlm/src/client/libwlm_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/common_middleware/xipc/src/client/libxipc_client.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/common_middleware/xipc/src/xipc_tl/libxipc_tl.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/misc_libraries/zlib/src/libzlib.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/input_helper/src/libinput_helper.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/security_services/vgv/darwin/src/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/libvgc_ae.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/iptunnel_helper/src/libiptunnel_helper_api.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/network_helper/src/libnetwork_helper_api.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/serial_helper/src/libserial_helper.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/storage_helper/src/storage_helper/src/libstorage_helper_api.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/utilities_helper/src/libutilities_helper_osi_api.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/hotplug_helper/src/libhotplug_helper.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg//components/../projects/fusion2/helper_libraries/usb_helper/src/libusb_helper.a
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/libmockvg/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/lib//libmockvg.a
| sed -e 's/[^ ]*libvg[^ ]*//g; s/[^ ]*libdsam[^ ]*//g'`
-L/home/kyoupark/STB_SW/FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/LittleEndian/release/lib
-lm -lpthread -lrt -ldl -ltirpc -lsky_airplay_helper -lminizip -ljsoncpp
-lglib -lgio -lgobject -ldbus -lz
-Wl,-rpath-link=/home/kyoupark/x-tools/i686-nptl-linux-gnu/i686-nptl-linux-gnu/lib
-Wl,-rpath-link=/home/kyoupark/STB_SW/FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/LittleEndian/release_dbg/lib/
-L/home/kyoupark/STB_SW/FUSIONOS_9/BLD_NDS_INTEL_X86_LNUX_MRFUSION_01/platform_cfg/linux/LittleEndian/release_dbg/lib/
-Xlinker -R/NDS/lib
/home/kyoupark/x-tools/i686-nptl-linux-gnu/i686-nptl-linux-gnu/lib/libstdc++.a
-lusb
-L/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/fs/NDS/lib
-lxusb -Xlinker --end-group -o
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process

mkdir -p /home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/unstripped_processes

cp
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/unstripped_processes/APP_Process

Removing debug information from /home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process
/home/kyoupark/x-tools/i686-nptl-linux-gnu/bin/i686-nptl-linux-gnu-strip
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process

Copying /home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process to file system
cp -fRL
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/release_dbg/components/../processes/APP_Process
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/NDS_INTEL_X86_LNUX_MRFUSION_01/LittleEndian/fs/NDS/bin/APP_Process


={============================================================================
|kt_dev_si_0002| si-build-make-image

<build-variant>
http://hetty.cisco.com/fusionmadesimple/index.php/SIBuildProfiles

Sky_TPT: Production build for Sky testing (point to their own OIG server)
NDS_SI_Devel: Development build with readable diag
Sky_Trials: Testing build with binary diag for performance - logs are uploaded on reboot
Devel_Bin: Testing build with binary diag for performance - INFO logging for key components included
cust_trials: similar to sky_trials, but with a preprod kernel(? tbc)

There are 3 types of kernel or variant:
prod      - Only suitable for a production release of the software
preprod   - Production kernel with a minimum of tools to enable some trace info to be extracted
debug     - Development kernel suitable for component teams and SI to investigate issues


<build-make-image-sh> make_image.sh

SPK_VARIANT="$2"

SPK_VARIANT=debug
# will be override when use --variant

./make_image.sh --platform ams-drx595 --project picasso --profile "NDS_SI_Devel" 

# Load platform specific script
function set_up_platform() {
  local SCRIPTS_PATH
  SCRIPTS_PATH="`dirname "$0"`/tools/nds/si"
  SCRIPTS_PATH="`readlink -f "$SCRIPTS_PATH"`"
  source "$SCRIPTS_PATH/platform.sh" "$SCRIPTS_PATH" "$SPK_PLATFORM"
}

// # STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si
// # Platform specific stuff
// 
// set -xv
// # usage: source platform.sh <scripts path> <platform> <endian>
// {
//   local SCRIPTS_PATH="$1"; shift
//   local PLATFORM="$1"; shift
// 
//   case "$PLATFORM" in
//     ams_bcm|ams-drx890)
//       PLATFORM="ams-drx890"
//       NDS_ENDIAN="BigEndian"
//       ;;
// 
//     ams_595|ams-drx595)
//       PLATFORM="ams-drx595"
//       NDS_ENDIAN="BigEndian"
//           ;;
// 
//     *)
//       echo "Unknown platform $PLATFORM"
//       return 1
//     ;;
//   esac
// 
//   NDS_VOB_ROOT=`readlink -f ../../..`
//   source "$SCRIPTS_PATH/platform/$PLATFORM/functions.sh" "$@"
//   platform_init
// }
// 
// # STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/platform/ams-drx890
// # Platform specific functions for Amstrad DRX890
// #set -xv
// # Initialise platform
// function platform_init() {
//   NDS_PLATFORM=AMS_BCM_MIPS4K_LNUX_DARWIN_01
//   NDS_FUSIONOS_PATH=${NDS_VOB_ROOT}/FUSIONOS_2/BLD_${NDS_PLATFORM}
//   NDS_FUSIONOS_INPUT_PATH=${NDS_VOB_ROOT}/FUSIONOS_INPUT_DEL_2/DEL_${NDS_PLATFORM}
//   NDS_FUSIONOS_OUTPUT_PATH=${NDS_VOB_ROOT}/FUSIONOS_OUTPUT_DEL_2/KERN_${NDS_PLATFORM}
//   NDS_FUSIONOS_TOOLCHAIN_PATH=${NDS_FUSIONOS_PATH}/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2
//   SPK_TARBALL_DIR="${NDS_FUSIONOS_INPUT_PATH}/build_platform/spk/"
//   SPK_TARBALL=`find "${SPK_TARBALL_DIR}" -maxdepth 1 -name darwin-spk-*.tar.bz2`
//   OTV_TOOLS="${NDS_FUSIONOS_INPUT_PATH}/build_platform/image_generation"
//   SPK_PLATFORM=ams-drx890
//   CDI_DRIVERS_TARBALL_DIR=${NDS_FUSIONOS_INPUT_PATH}/Tarball
//   NDS_DRIVERS_TARBALL_DIR=${NDS_FUSIONOS_INPUT_PATH}/Tarball
//   CDI_DRIVERS_CONFIG_TARBALL_DIR=${NDS_FUSIONOS_INPUT_PATH}/build_platform/configs
//   EOTV_IMAGE_OUTPUT=APPLI_0.FLA
//   OTV_IMAGE=flash.out
//   OTV_IMAGE_GEN_SCRIPT=generate-otv-image.sh
//   OTV_IMAGE_GEN_TARBALL=image-generation-${SPK_PLATFORM}.tar.bz2
//   IMAGE_INPUT_TO_GEN_SCRIPT=vmlinux
// }
// 
// # Platform specific SPK patching
// function platform_patch_spk() {
//   return 0
// }


function make_image_timer() {
  s=`date +%s`
  $1
  rv=$?
  e=`date +%s`
  t=`expr $e - $s`
  echo "WORKSPACE="${WORKSPACE}
  echo "make_image_timer::$1,$t" >> ${WORKSPACE}/bfi_stats
  return $rv
}


make_image_timer check_input_tarballs || exit 1

// WORKSPACE=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build

// *input-tarball* <driver-tarball>
// STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball
//
// -r-xr--r-- 1 parkkt ccusers 2860009 Apr 12 16:17 cdi-drivers-ams-drx595-debug.tar.bz2*
// -r--r--r-- 1 parkkt ccusers 1950345 Apr 12 16:17 cdi-drivers-ams-drx595-preprod.tar.bz2
// -r--r--r-- 1 parkkt ccusers 1909451 Apr 12 16:17 cdi-drivers-ams-drx595-prod.tar.bz2
// -r--r--r-- 1 parkkt ccusers 5478873 Apr 12 16:17 kernel-headers-ams-drx595-debug.tar.gz
// -r--r--r-- 1 parkkt ccusers 5477086 Apr 12 16:18 kernel-headers-ams-drx595-preprod.tar.gz
// -r--r--r-- 1 parkkt ccusers 5477524 Apr 12 16:18 kernel-headers-ams-drx595-prod.tar.gz
// -r-xr-xr-x 1 parkkt ccusers   21349 Apr 12 16:17 nds-drv-ams-drx595-debug.tar.bz2*
// -r-xr-xr-x 1 parkkt ccusers   21355 Apr 12 16:17 nds-drv-ams-drx595-preprod.tar.bz2*
// -r-xr-xr-x 1 parkkt ccusers   15675 Apr 12 16:17 nds-drv-ams-drx595-prod.tar.bz2*
// -r--r--r-- 1 parkkt ccusers   36305 Apr 12 16:18 service-centre-ams-drx595-debug.tar.bz2
// -r--r--r-- 1 parkkt ccusers   36305 Apr 12 16:18 service-centre-ams-drx595-preprod.tar.bz2
// -r--r--r-- 1 parkkt ccusers   36305 Apr 12 16:18 service-centre-ams-drx595-prod.tar.bz2

# checks if tarballs exists or not
function check_input_tarballs()
{
  // *build-mw-output*
  MW_EPG_TARBALL_DIR=${OUTPUT}/${PROJECT}/${NDS_PLATFORM}/${NDS_ENDIAN}
  MW_EPG_TARBALL=${MW_EPG_TARBALL_DIR}/mw-epg-${SPK_PLATFORM}-${SPK_VARIANT}-${PROFILE}.tar.bz2
  MW_EPG_SPK_TARBALL_NAME=mw-epg-${SPK_PLATFORM}-${SPK_VARIANT}.tar.bz2

  // xtvfs and nvramfs.ko
  NDS_DRIVERS_TARBALL=${NDS_DRIVERS_TARBALL_DIR}/nds-drv-${SPK_PLATFORM}-${SPK_VARIANT}.tar.bz2

  CDI_DRIVERS_TARBALL=${CDI_DRIVERS_TARBALL_DIR}/cdi-drivers-${SPK_PLATFORM}-${SPK_VARIANT}.tar.bz2
  CDI_DRIVERS_CONFIG_TARBALL=${CDI_DRIVERS_CONFIG_TARBALL_DIR}/config-${SPK_PLATFORM}-${SPK_VARIANT}.tar.bz2
  SCS_BINARY_TARBALL=${CDI_DRIVERS_TARBALL_DIR}/service-centre-${SPK_PLATFORM}-${SPK_VARIANT}.tar.bz2

  // *nds-drivers*
  // + MW_EPG_TARBALL_DIR=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian
  // + MW_EPG_TARBALL=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/mw-epg-ams-drx890-debug-sky_trials.tar.bz2
  // + MW_EPG_SPK_TARBALL_NAME=mw-epg-ams-drx890-debug.tar.bz2
  // + NDS_DRIVERS_TARBALL=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-debug.tar.bz2
  // + CDI_DRIVERS_TARBALL=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-debug.tar.bz2
  // + CDI_DRIVERS_CONFIG_TARBALL=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/configs/config-ams-drx890-debug.tar.bz2
  // + SUPPORT_PACKAGE_TARBALL=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/support-ams-drx890-debug.tar.bz2

  // /home/kyoupark/STB_SW/deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball
  // lrwxrwxrwx 1 kyoupark ccisco   87 Feb 13 16:13 nds-drv-ams-drx890-prod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-prod.tar.bz2
  // lrwxrwxrwx 1 kyoupark ccisco   90 Feb 13 16:13 nds-drv-ams-drx890-preprod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-preprod.tar.bz2
  // lrwxrwxrwx 1 kyoupark ccisco   88 Feb 13 16:13 nds-drv-ams-drx890-debug.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-debug.tar.bz2
  //
  // they are the same file.
  // diff3 debug/etc/load-nds-drivers.sh preprod/etc/load-nds-drivers.sh prod/etc/load-nds-drivers.sh
} 


<set-up-spk>
make_image_timer set_up_spk || exit 1

function set_up_spk() 
{
  // note: this seems to be only difference between cust and sky trials.
  // SCS to be disabled for Cust_trials for security purposes
  if [ "${PROFILE}" ==  "cust_trials" ]; then
    SCS_FLAG="noscs"
  fi

  // + SPK_FS=initramfs
  // + SPK_CONFIG='initramfs otv fullstack   '
  // + SPK_BUILD_OUTPUT_DIR=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug
  SPK_CONFIG="${SPK_FS} ${SPK_BOOTLOADER} ${FULLSTACK} ${SCS_FLAG} ${DHCP} ${LZMA_FLAG}"
  `SPK_BUILD_OUTPUT_DIR`=${OUTPUT}/${PROJECT}/SPK/${SPK_PLATFORM}-${SPK_VARIANT}

  // <spk-enable-console>
  // from:
  //
  // if [ "${PROFILE}" ==  "sky_prod" ] || [ "${PROFILE}" ==  "sky_tpt" ] || \
  //  [ "${PROFILE}" ==  "sky_trials" ] || [ "${PROFILE}" ==  "mem_trials" ] || [ "${PROFILE}" ==  "cust_trials" ]; then
  //   SPK_CONFIG+=" noconsole"
  // fi
  //
  // to:
  //
  // if [ "${PROFILE}" ==  "sky_prod" ] || [ "${PROFILE}" ==  "sky_tpt" ] || \
  //  [ "${PROFILE}" ==  "sky_trials" ] || [ "${PROFILE}" ==  "cust_trials" ]; then
  //   SPK_CONFIG+=" console"
  // fi
  //
  // or simply enable for all and this uses *configure*
  //
  // SPK_CONFIG+=" console"

  // <spk-path>
  // ++ find /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/ -maxdepth 1 -type d -name 'darwin-spk*'
  // + SPK_PATH=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19
  
  // note: remove_spk for a clean build and tar spk
  // ++ SPK_TARBALL_DIR=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/
  
  <clean-spk>
  if [[ $PASS -eq 1 && -n "$CLEAN" ]]; then
    echo
    echo "Doing a clean build"
    remove_spk || return $?
  fi

  // <get-spk> <untar-spk>
  // + tar -C /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/ -jxvf \
  //  /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19-20131014.tar.bz2
  //
  // note: interesting bits are
  //
  // darwin-spk-1.19/patches/
  //
  // darwin-spk-1.19/toolchain/binutils/
  // darwin-spk-1.19/toolchain/uClibc/
  // darwin-spk-1.19/toolchain/uClibc/uClibc-0.9.29-fix-fget_putc.diff
  // darwin-spk-1.19/toolchain/gcc/4.2.0/
  //
  // darwin-spk-1.19/package/sky/httpsend/
  // darwin-spk-1.19/package/sky/bumper/
  // darwin-spk-1.19/package/sky/firewall/
  // darwin-spk-1.19/package/sky/skelmir/
  // darwin-spk-1.19/package/sky/craftworks/
  //
  // darwin-spk-1.19/package/valgrind/
  // darwin-spk-1.19/package/valgrind/valgrind.mk
  // darwin-spk-1.19/package/valgrind/valgrind.sh
  // darwin-spk-1.19/package/valgrind/uclibc.supp
  // darwin-spk-1.19/package/valgrind/Config.in
  // darwin-spk-1.19/package/valgrind/valgrind.patch
  // darwin-spk-1.19/package/dmalloc/
  // darwin-spk-1.19/package/dmalloc/dmalloc-mips.patch
  // darwin-spk-1.19/package/dmalloc/dmalloc.mk
  // darwin-spk-1.19/package/dmalloc/Config.in
  // 
  // darwin-spk-1.19/package/tcpdump/
  // 
  // darwin-spk-1.19/package/ltrace/
  // darwin-spk-1.19/package/strace/
  // darwin-spk-1.19/package/procps/
  // darwin-spk-1.19/package/editors/vim/
  // 
  // darwin-spk-1.19/target/device/Sky/kernel-patches/hardening/
  // darwin-spk-1.19/target/device/Sky/kernel-patches/hardening/linux-2.6.18.8-270-CVE-2008-0007.patch
  // darwin-spk-1.19/target/device/Sky/kernel-patches/hardening/arch/
  // darwin-spk-1.19/target/device/Sky/kernel-patches/hardening/arch/mips/
  // darwin-spk-1.19/target/device/Sky/kernel-patches/hardening/arch/mips/linux-2.6.18.8-005-clock-drift-fix-pr7337.patch
  // 
  // darwin-spk-1.19/target/device/Sky/ams-drx890/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/kernel-prod.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/device_table.txt
  // darwin-spk-1.19/target/device/Sky/ams-drx890/buildroot-preprod.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/rootfs/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/rootfs/preprod/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/rootfs/debug/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/rootfs/prod/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/buildroot-prod.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/kernel-patches/
  // darwin-spk-1.19/target/device/Sky/ams-drx890/kernel-patches/linux-2.6.18.8-001-drx890-uart-B.patch
  // darwin-spk-1.19/target/device/Sky/ams-drx890/busybox-prod.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/busybox-preprod.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/busybox-debug.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/kernel-debug.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/buildroot-debug.config
  // darwin-spk-1.19/target/device/Sky/ams-drx890/kernel-preprod.config
  // 
  // darwin-spk-1.19/scripts/
  // darwin-spk-1.19/scripts/arm-carefully-strip.sh
  // darwin-spk-1.19/scripts/builder.pl
  // darwin-spk-1.19/scripts/sky-make-release.sh
  // 
  // darwin-spk-1.19/dl/
  // darwin-spk-1.19/dl/libusb-1.0.8.tar.bz2
  // darwin-spk-1.19/dl/squashfs4.2.tar.gz
  // 
  // darwin-spk-1.19/dl/tcpdump-4.4.0.tar.gz
  // darwin-spk-1.19/dl/cdi-drivers-sample-debug.tar.bz2
  // 
  // darwin-spk-1.19/dl/craftworks-arm-0.1-prod.tar.bz2
  // darwin-spk-1.19/dl/linux-2.6.18.8.tar.bz2
  // darwin-spk-1.19/dl/hdparm-9.36.tar.gz
  // darwin-spk-1.19/dl/smartmontools-5.33.tar.gz
  // darwin-spk-1.19/dl/httpsend-0.0.tar.gz
  // 
  // darwin-spk-1.19/dl/gdb-6.7.1.tar.bz2
}


<patch-spk>
function patch_spk() 
{
  // + tar -jxvf /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/../patches/darwin-spk-1.19-patches.tar.bz2 \
  //  -C /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/patches

  ## SI specific patches can be added from build/spk_patches/[platform][[/variant]]. 
  ## These can be created for all variant builds or for a specific one or both.

  # kyoupark@ukstbuild2:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/spk_patches/ams-drx890$ ls -al
  # drwxr-xr-x 2 kyoupark ccusers 4096 Jun 28 10:35 debug
  # drwxr-xr-x 2 kyoupark ccusers 4096 Jun 28 10:35 preprod

  # note: copy SI patches
      # patches are applied after any official SPK specific patches
      echo "Copying SI patch - ${patch_file} to the SPK..."
      cp $patch_file ${SPK_PATCHES_DIR}
}


<copy-packages>
function copy_packages() 
{
  # + pwd
  # /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19

  // copy epg, driver config, nds driver, cdi driver tar files
  # + cp -f /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/configs/`config-ams-drx890-debug.tar.bz2` 
    \ /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/
  # + cp -f /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/`mw-epg-ams-drx890-debug-sky_trials.tar.bz2` 
    \ /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/mw-epg-ams-drx890-debug.tar.bz2
  # + cp -f /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/`nds-drv-ams-drx890-debug.tar.bz2` 
    \ /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/
  # + cp -f /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/`cdi-drivers-ams-drx890-debug.tar.bz2` 
    \ /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/
  # + cp -f /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/applications/BSKYB_SCS/ams-drx890/`service-centre-ams-drx890-prod.tar.bz2` 
    \ /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/service-centre-ams-drx890-debug.tar.bz2
}


// kyoupark@ukstbuild2:~/STB_SW/`FUSIONOS_INPUT_DEL_2`/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19$ ll
// total 216
// drwxr-xr-x  10 kyoupark ccusers  4096 Dec 15 10:50 ./
// drwxr-xr-x   4 kyoupark ccusers  4096 Dec 15 14:25 ../
// -rw-r--r--   1 kyoupark ccusers   450 Dec 15 10:43 .auto.deps
// -rw-r--r--   1 kyoupark ccusers 21979 Dec 15 10:43 .config
// -rw-r--r--   1 kyoupark ccusers 25980 Dec 15 10:43 .config.cmd
// -rw-r--r--   1 kyoupark ccusers 11101 Oct 14  2013 Config.in
// -rw-r--r--   1 kyoupark ccusers 21979 Dec 15 10:43 .config.old
// -rwxr-xr-x   1 kyoupark ccusers 25040 Dec 15 10:43 configure*
// -rw-r--r--   1 kyoupark ccusers  1291 Oct 14  2013 .defconfig
// drwxr-xr-x   2 kyoupark ccusers  4096 Dec 15 10:43 dl/
// drwxr-xr-x   3 kyoupark ccusers  4096 Oct 14  2013 docs/
// -rw-r--r--   1 kyoupark ccusers   189 Dec 15 10:50 flashfilecheckresult.xml
// -rw-r--r--   1 kyoupark ccusers 17135 Dec 15 10:43 Makefile
// drwxr-xr-x 308 kyoupark ccusers 12288 Dec 15 10:43 package/
// drwxr-xr-x   2 kyoupark ccusers  4096 Dec 15 10:43 patches/
// drwxr-xr-x   3 kyoupark ccusers  4096 Oct 14  2013 project/
// -rw-r--r--   1 kyoupark ccusers  6827 Oct 14  2013 README.txt
// drwxr-xr-x   2 kyoupark ccusers  4096 Oct 14  2013 scripts/
// -rw-r--r--   1 kyoupark ccusers    17 Dec 15 10:43 .spk_configured
// drwxr-xr-x  22 kyoupark ccusers  4096 Oct 14  2013 target/
// -rw-r--r--   1 kyoupark ccusers   445 Oct 14  2013 TODO
// drwxr-xr-x  14 kyoupark ccusers  4096 Oct 14  2013 toolchain/
// -rw-r--r--   1 kyoupark ccusers    20 Oct 14  2013 VERSION


<configure_spk> 
function configure_spk() 
{
  # <spk-buildroot-config>
  # Set toolchain path
  # note use `$NDS_FUSIONOS_TOOLCHAIN_PATH` to set path 
  sed -i "s?.*\(BR2_TOOLCHAIN_EXTERNAL_PATH\).*?\1=\"$NDS_FUSIONOS_TOOLCHAIN_PATH\"?" target/device/Sky/$SPK_PLATFORM/buildroot-${SPK_VARIANT}.config
  # + sed -i 's?.*\(BR2_TOOLCHAIN_EXTERNAL_PATH\).*?\1="/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2"?' \
    target/device/Sky/ams-drx890/buildroot-debug.config

  # BR2_TOOLCHAIN_EXTERNAL_PATH="/opt/toolchains/crosstools_hf-linux-2.6.18.0_gcc-4.2-10tsHound_uclibc-nptl-0.9.29-20070423_20091015"
  # BR2_TOOLCHAIN_EXTERNAL_PATH="/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2"

  # <output-config>      
  # O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug

  # so do not apply this patch which changes toolchain version
  # + UNWANTED_SPK_PATCH=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/patches/darwin-spk-1.19-0010-drx890-spk-newtoolchain.patch
  # + rm -rf /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/patches/darwin-spk-1.19-0010-drx890-spk-newtoolchain.patch

  # Configure the SPK
  ./configure `O=${SPK_BUILD_OUTPUT_DIR}` $SPK_PLATFORM $SPK_VARIANT $SPK_CONFIG
  # + ./configure O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug ams-drx890 debug initramfs otv fullstack noconsole
}


<configure-script>
# ./configure O=/home/kyoupark/si-logs/spk/output ams-drx890 debug initramfs otv noconsole
#
+ OBJDIR=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug
+ BOARD=ams-drx890
+ VARIANT=debug
# Grab main config file
CFG=target/device/Sky/${BOARD}/buildroot-${VARIANT}.config
+ CFG=target/device/Sky/ams-drx890/buildroot-debug.config

# Apply any SPK patches
apply_patches

note: *spk-path*
cwd is + SPK_PATH=/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19
# <spk-buildroot-config>
# `target/device/Sky/ams-drx890/buildroot-debug.config' -> `.config'
cp -v $CFG .config

# Grab a few variables from the .config. We can't just source the
# .config file as a shell script because some variable values are
# makefile variables.
grep `BR2_TOOLCHAIN_EXTERNAL_PATH` .config >> /tmp/spkconf$$
. /tmp/spkconf$$

make -n O=$OBJDIR SPK_CONFIGURED= oldconfig
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= oldconfig
  * Buildroot Configuration
    > 9. mips (BR2_mips)
    > 5. mips 32 (BR2_mips_32)
    > 1. o32 (BR2_MIPS_OABI32)
    > 2. External binary toolchain (BR2_TOOLCHAIN_EXTERNAL)
      >
    The core C library from the external toolchain (BR2_TOOLCHAIN_EXTERNAL_LIB_C) [libc.so.0] libc.so.0
    Libraries to copy from the external toolchain (BR2_TOOLCHAIN_EXTERNAL_LIBS) [ld-uClibc.so.0 libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0] ld-uClibc.so.0 libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0
    Strip shared libraries (BR2_TOOLCHAIN_EXTERNAL_STRIP) [Y/n/?] y
    > 4. Native POSIX Threading (NPTL) (BR2_EXT_PTHREADS_NATIVE)
    >
    > 2. BusyBox 1.13.x (BR2_BUSYBOX_VERSION_1_13_X)
    vim (BR2_PACKAGE_VIM) [N/y/?] n
    tar the root filesystem (BR2_TARGET_ROOTFS_TAR) [Y/n/?] y
      > 3. bzip2 (BR2_TARGET_ROOTFS_TAR_BZIP2)
    initramfs for initial ramdisk of linux kernel (BR2_TARGET_ROOTFS_INITRAMFS) [Y/n/?] y
    Linux Tarball version (BR2_CUSTOM_DOWNLOAD_LINUX26_VERSION) [2.6.18.8] 2.6.18.8
    Linux Version (BR2_CUSTOM_LINUX26_VERSION) [2.6.18.8] 2.6.18.8

  # Makefile
  
  oldconfig: $(CONFIG)/conf
  	@mkdir -p $(CONFIG)/buildroot-config
  	@KCONFIG_AUTOCONFIG=$(CONFIG)/buildroot-config/auto.conf \
  		KCONFIG_AUTOHEADER=$(CONFIG)/buildroot-config/autoconf.h \
  		$(CONFIG)/conf -o $(CONFIG_CONFIG_IN)
  
  + make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= oldconfig
  + mkdir -p package/config/buildroot-config
  + KCONFIG_AUTOCONFIG=package/config/buildroot-config/auto.conf \
                  KCONFIG_AUTOHEADER=package/config/buildroot-config/autoconf.h \
                  package/config/conf -o Config.in
  
  KCONFIG_AUTOCONFIG=package/config/buildroot-config/auto.conf \
  KCONFIG_AUTOHEADER=package/config/buildroot-config/autoconf.h \
  package/config/conf -o Config.in

# Setup kernel config
# target stuff is last so it can override anything else
include target/Makefile.in

  # kernel rules
  # We already did add the kernel target to TARGETS and now just pull in the rules
  # to actually build this target.
  
  ifeq ($(BR2_KERNEL_LINUX),y)
  include target/linux/Makefile.in
  endif

  # target/linux/Makefile.in.advanced
  linux_patch: $(LINUX26_DIR)/.patched.board

+ KNLDIR=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/linux-2.6.18.8
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= linux_patch

  toolchain/patch-kernel.sh /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/linux-2.6.18.8 toolchain/kernel-headers \
		linux-2.6.18.8-\*.patch{,.gz,.bz2}


# Setup busybox config
# package/busybox/busybox.mk
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= busybox-config
+ BBDIR=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/busybox-1.13.1

echo "BOARD ${BOARD}" >> $OBJDIR/configured.flags
echo "VARIANT $VARIANT" >> $OBJDIR/configured.flags
echo "ARCH" $BR2_ARCH >> $OBJDIR/configured.flags

note: change BR, kernel .config
# echo "initramfs" >> $OBJDIR/configured.flags
# echo "otv" >> $OBJDIR/configured.flags
# echo "noconsole" >> $OBJDIR/configured.flags

note: again?
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= oldconfig
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug SPK_CONFIGURED= linux26-config

# Copy .config to user's objdir for safe-keeping
if [ $OBJDIR != "." ]; then
    cp -f .config $OBJDIR/.config
fi

# Write flag file, used to indicate to SPK that we are configured
echo "SPK_CONFIGURED=y" > .spk_configured


<no-fullstack>
fullstack) to add mw, driver and epg binaries. so not use fullstack?
./configure O=/home/kyoupark/si-logs/spk/output ams-drx890 debug initramfs otv noconsole

NO since make_image.sh defines by default:

FULLSTACK="fullstack"

So:
      --kernel_only)
        FULLSTACK=
        DHCP="dhcp"
        ;;

  echo "  --kernel_only             Build an EOTV binary without app/middleware or drivers - CFE mode"


<build-spk>
// make_image_timer build_spk || exit 1
// + make_image_timer build_spk

function build_spk() 
{
  # SPK Package Level Parallel setting support.
  if [ -z "${NDS_PARALLEL}" ]; then
      NDS_PARALLEL=$(grep 'processor.*:' /proc/cpuinfo|wc -l)
      if [ "${NDS_PARALLEL}" -eq 0 ]; then
          NDS_PARALLEL=1
      fi
  fi
  SPK_PARALLEL="BR2_JLEVEL=${NDS_PARALLEL}"
+ SPK_PARALLEL=BR2_JLEVEL=24

  make ${FULL_PARALLEL} O=${SPK_BUILD_OUTPUT_DIR} || return $?

  # *target/device/Sky/Makefile.in*
  # .PHONY:     kernel-menuconfig kernel-dirclean kernel-clean kernel-force kernel-config rootfs-clean
  # rootfs-clean:
+ echo 'Building clean rootfs'

  make ${FULL_PARALLEL} `O=${SPK_BUILD_OUTPUT_DIR}` rootfs-clean || return $?
+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug rootfs-clean
  make ${FULL_PARALLEL} `O=${SPK_BUILD_OUTPUT_DIR}` || return $?

  note: *spk-main-makefile*
  PWD: /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19-use-own' 
  use Makefile there.

+ make O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug
  make V=1 O=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug |& tee spk.log

  echo "Build complete"
  echo "rootfs: ${SPK_BUILD_OUTPUT_DIR}/binaries/${SPK_PLATFORM}"
  echo "kernel: ${SPK_BUILD_OUTPUT_DIR}/binaries/${SPK_PLATFORM}/vmlinuz"
}


Checking build system dependencies:
...

<make-image-makefile-nds-mk>
package/sky/nds/nds.mk

Unpacking /home/NDS-UK/kyoupark/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/mw-epg-ams-drx890-debug.tar.bz2...
bzcat /home/NDS-UK/kyoupark/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19/dl/mw-epg-ams-drx890-debug.tar.bz2 | tar -C 
  /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root   -xf -
touch /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/build_mips/nds-mw/.unpacked

$(NDS_DRV_DIR)/.unpacked: $(DL_DIR)/$(NDS_DRV_SOURCE) $(TARGET_DIR)/$(NDS_DRV_FILE)
	@echo "Unpacking $(DL_DIR)/$(NDS_DRV_SOURCE)..."
	$(NDS_DRV_CAT) $(DL_DIR)/$(NDS_DRV_SOURCE) | tar -C $(TARGET_DIR) $(TAR_OPTIONS) -
	-@mkdir -p $(NDS_DRV_DIR)
	touch $@

#############################################################
#
# Toplevel Makefile options
#
#############################################################
ifeq ($(BR2_PACKAGE_SKY_NDS_DRIVERS),y)
TARGETS+=nds-drv
endif
ifeq ($(BR2_PACKAGE_SKY_NDS_MW),y)
TARGETS+=nds-mw
endif


<make-image-makefile-copy-libraries>
target/device/Sky/ams-drx890/buildroot-prod.config
160:BR2_TOOLCHAIN_EXTERNAL_LIB_C="libc.so.0"
161:BR2_TOOLCHAIN_EXTERNAL_LIBS="ld-uClibc.so.0 libdl.so.0 libgcc_s.so libm.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0"

*spk-buildroot-config*
target/device/Sky/ams-drx890/buildroot-debug.config
160:BR2_TOOLCHAIN_EXTERNAL_LIB_C="libc.so.0"
161:BR2_TOOLCHAIN_EXTERNAL_LIBS="ld-uClibc.so.0 libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0"
    BR2_SKY_TOOLCHAIN_WITHOUT_SYSROOT=y

target/device/Sky/ams-drx890/buildroot-preprod.config
160:BR2_TOOLCHAIN_EXTERNAL_LIB_C="libc.so.0"
161:BR2_TOOLCHAIN_EXTERNAL_LIBS="libcrypt.so.0 ld-uClibc.so.0 libdl.so.0 libgcc_s.so libm.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0"

# The core C library from the external toolchain (BR2_TOOLCHAIN_EXTERNAL_LIB_C) 
# [libc.so.0] libc.so.0
# Libraries to copy from the external toolchain (BR2_TOOLCHAIN_EXTERNAL_LIBS) 
# [ld-uClibc.so.0 libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0
# libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0] 
#
# ld-uClibc.so.0
# libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0 libpthread.so.0
# libresolv.so.0 librt.so.0 libutil.so.0

toolchain/external-toolchain/ext-tool.mk

copy_toolchain_lib_root lib=libc.so.0 dst=/lib
SKIPPING copy_toolchain_lib_root lib=libuClibc-0.9.29.so dst=/lib
for libs in ld-uClibc.so.0 libcrypt.so.0 libdl.so.0 libgcc_s.so libm.so.0 libnsl.so.0 libpthread.so.0 libresolv.so.0 librt.so.0 libutil.so.0; do \
		LIB="$libs"; DST="/lib"; STRIP="y"; SYSROOT="" ; if test -z y; then PREFIX=`/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-gcc -v 2>&1 | grep ^Configured | tr " " "\n" | grep -- "--prefix" | head -1 | cut -f2 -d=`; SYSROOT_DIR=`echo ""/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2"" | sed -e "s|\(.*\)${PREFIX}|\1|"` ; SYSROOT="--sysroot ${SYSROOT_DIR}" ; fi ; LIB_DIR=`/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-gcc ${SYSROOT} -print-file-name=${LIB} | sed -e "s,${LIB}\$,,"`; if test -z "${LIB_DIR}"; then echo "copy_toolchain_lib_root: lib=${LIB} not found"; exit -1; fi; if test -z ; then LINKS="-type l"; fi; LIB="$libs"; for FILE in `find ${LIB_DIR} -maxdepth 1 ${LINKS} -name "${LIB}*"`; do LIB=`basename ${FILE}`; while test \! -z "${LIB}"; do if test -f /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}; then echo "SKIPPING copy_toolchain_lib_root lib=${LIB} dst=${DST}"; chmod +x "/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}"; case "${STRIP}" in (0 | n | no) ;; (*) /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-strip "/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}"; ;; esac; else rm -fr /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}; mkdir -p /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}; echo "copy_toolchain_lib_root lib=${LIB} dst=${DST}"; if test -h ${LIB_DIR}/${LIB}; then cp -d ${LIB_DIR}/${LIB} /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/; elif test -f ${LIB_DIR}/${LIB}; then /usr/bin/install -D -m0755 ${LIB_DIR}/${LIB} /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}; case "${STRIP}" in (0 | n | no) ;; (*) /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-strip "/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/root${DST}/${LIB}"; ;; esac; else exit -1; fi; fi; LIB="`readlink ${LIB_DIR}/${LIB}`"; done; done; echo -n; \
	done
copy_toolchain_lib_root lib=ld-uClibc.so.0 dst=/lib
copy_toolchain_lib_root lib=ld-uClibc-0.9.29.so dst=/lib
...

+ LIB_DIR=/home/NDS-UK/kyoupark/STB_SW/deps/SYSTEM_BIN_4/mips4k_gcc_x86_linux_hound_2/bin/../lib/gcc/mips-linux-uclibc/4.2.0/../../../../mips-linux-uclibc/lib/

Copying toolchain files from /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2
cp -a $${SYSROOT_DIR}/* $(STAGING_DIR)/ ; \
find $(STAGING_DIR) -type d | xargs chmod 755 ;\

#
cp -av /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/include /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/info /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/lib /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/libexec /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/man /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mipsel-linux /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mipsel-linux-uclibc /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mips-linux /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mips-linux-uclibc /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/build_mips/staging_dir/
ls /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/build_mips/staging_dir/

+ cp -av /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/include 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/info 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/lib 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/libexec 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/man 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mipsel-linux 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mipsel-linux-uclibc 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mips-linux 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/mips-linux-uclibc 
/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds 
/home/nds-uk/kyoupark/spk-out/build_mips/staging_dir/

...

note: target/linux/Makefile.in.advanced
$(LINUX26_KERNEL): $(LINUX26_DIR)/$(LINUX26_BINLOC) $(BINARIES_DIR)
	echo "KT:AD: F, $(LINUX26_FORMAT), K, $(LINUX26_KERNEL)"
	echo "KT:AD: cp -pf $(LINUX26_DIR)/$(LINUX26_BINLOC) $(LINUX26_KERNEL)"
	cp -pf $(LINUX26_DIR)/$(LINUX26_BINLOC) $(LINUX26_KERNEL)
	touch -c $@
linux26-prepare:	$(LINUX26_DIR)/.depend_done


// F, vmlinux, 
// K, /home/nds-uk/kyoupark/spk-out-use-own-brcm/binaries/ams-drx890/mips-linux-2.6.18.8-20170217
//
// KT:AD: cp -pf /home/nds-uk/kyoupark/spk-out-use-own-brcm/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux 
//  /home/nds-uk/kyoupark/spk-out-use-own-brcm/binaries/ams-drx890/mips-linux-2.6.18.8-20170217
// cp -pf /home/nds-uk/kyoupark/spk-out-use-own-brcm/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux 
//  /home/nds-uk/kyoupark/spk-out-use-own-brcm/binaries/ams-drx890/mips-linux-2.6.18.8-20170217
//
// this leads to:
// + ./generate-otv-image.sh /home/nds-uk/kyoupark/spk-out-use-own-brcm/binaries/ams-drx890/vmlinux -E 4.X
// Could not find file /home/nds-uk/kyoupark/spk-out-use-own-brcm/binaries/ams-drx890/vmlinux
//
// if LINUX26_KERNEL not defined, the set with `date`. 
//
// ifndef LINUX26_KERNEL
// LINUX26_KERNEL:=$(BINARIES_DIR)/$(BOARD_NAME)-linux-$(LINUX26_VERSION)-$(DATE)$(KERNEL_EXT)
// endif
//
// target/device/Sky/Makefile.in
// 42:LINUX26_KERNEL:=$(BINARIES_DIR)/$(strip $(subst ",,$(BR2_PACKAGE_LINUX_FORMAT)))
//
// temp fix:
//	cp -pf $(LINUX26_DIR)/$(LINUX26_BINLOC) $(BINARIES_DIR)/$(LINUX26_BINLOC)


make[1]: Leaving directory `/home/NDS-UK/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8'
cp -pf /home/nds-uk/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux /home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux
touch -c /home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux
cp -fv /home/nds-uk/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux /home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux
`/home/nds-uk/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux' -> `/home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux'

+ ./generate-otv-image.sh /home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux -E 4.X


note: from target/device/Sky/Makefile.in
.PHONY: make-vmlinux-unstripped-file
make-vmlinux-unstripped-file : linux26

cp -fv /home/nds-uk/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux /home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux.unstripped
`/home/nds-uk/kyoupark/spk-out/project_build_mips/ams-drx890/linux-2.6.18.8/vmlinux' -> `/home/nds-uk/kyoupark/spk-out/binaries/ams-drx890/vmlinux.unstripped'
#echo -en '\E[47;34m'"[Change]"   
echo "\n Copied UNstriped version. Preparing stripped version \n"
\n Copied UNstriped version. Preparing stripped version \n


note: from target/tar/tarroot.mk
Building rootfs...
# Use fakeroot to pretend all target binaries are owned by root

tarroot: host-fakeroot makedevs tarroot-prep tarroot2
	@echo Building rootfs...


note: from *spk-main-makefile*
build-done:
	@echo "****************************************************************************"
	@echo "Build outputs at:-"
	@echo "  $(BINARIES_DIR)"
	@ls -lh $(BINARIES_DIR)
	@echo "****************************************************************************"
	@echo "BUILD COMPLETE: `date`"
	@echo "****************************************************************************"

****************************************************************************
Build outputs at:-
  /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890
total 141M
-rw-r--r-- 1 kyoupark ccusers 114K Dec 16 08:15 rootfs.mips.initramfs_list
-rw-r--r-- 1 kyoupark ccusers  59M Dec 16 08:19 rootfs.mips.tar
-rw-r--r-- 1 kyoupark ccusers  22M Dec 16 08:19 rootfs.mips.tar.bz2
-rwxr-xr-x 1 kyoupark ccusers  20M Dec 16 08:19 vmlinux
-rwxr-xr-x 1 kyoupark ccusers  41M Dec 16 08:19 vmlinux.unstripped
****************************************************************************
BUILD COMPLETE: Fri Dec 16 08:19:23 GMT 2016
****************************************************************************

+ echo 'rootfs: /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890'
rootfs: /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890
+ echo 'kernel: /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890/vmlinuz'
kernel: /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890/vmlinuz
}

# Post-process the build
function post_process_build() {

  + IMAGE_OUTPUT_PATH=/home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV
  + echo 'Signing image for OTV bootloader'

  + `cd /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/image_generation`
  + echo 'Deleting existing image generation tools and untarring the package'
  + tar --overwrite -jxvf image-generation-ams-drx890.tar.bz2
  ./
  ./cl.c
  ./generate-otv-image.sh
  ./makepartition
  ./pad.sh
  ./codeloader.bin
  ./ethupdater.bin

  <image-generation>
  # merge codeloader and vmlinuz into flash.out
  ./cl codeloader.bin vmlinuz flash.out

  ## change version number to high value. Stops over the air downloads from 
  ## overwriting test builds
  case ${SPK_PLATFORM} in
    ams-drx890)
      sed -i 's/-v 0x01/-v 0x01 -s 0x99999999/' ${OTV_IMAGE_GEN_SCRIPT}
      ;;

  + case ${SPK_PLATFORM} in
  + sed -i 's/-v 0x01/-v 0x01 -s 0x99999999/' generate-otv-image.sh
  + '[' ams-drx890 '!=' ams-drx890 ']'
  + ./generate-otv-image.sh /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/binaries/ams-drx890/vmlinux
  ==============================================================
  |        ./generate-otv-image.sh - Version: 2.2              |
  ==============================================================
  Please make sure VMLINUX was built with the OTV flags!! *** 
  Using S/W version number=0xFFFF 
  ./generate-otv-image.sh: Preparing "Legacy ETP image" type; which support image size upto 15.625MB, please wait ...
  Done
  Updated APPLI_0.FLA.etp  18684652 d800b0bc0f563c519ce68ccdcadca566
  Updated vmlinuz-890  18422508 ca8c2c7edbf0d0e70431309805686911
  ./generate-otv-image.sh Execution completed
  ==============================================================

  + cp ./APPLI_0.FLA /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.sky_trials
  + cp ./flash.out /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/flash.out.sky_trials
  + cp ./APPLI_0.FLA.etp /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials
  + cp ./flash.out.etp /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/flash.out.etp.sky_trials
  + cp ./FileInfo.txt /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV

  + cd /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/darwin-spk-1.19
  + echo 'Signed boot image: /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV'

  ## Check if the images will fit on the STB if option is selected
  ## This has to cater for local builds but also official builds through Hudson
  ## Any non-etp build which is too big will fail for local builds and official builds in Hudson
  ## Non-etp images which are too big will mean the etp image will also not fit so it is a complete build fail
  ## If either the non-etp or etp image is too big it will be renamed to highlight it is too big but only fail this script if the non-etp is too big
  ## Hudson can fail the job when checking for the etp image (if renamed it is too big)
  ## Hudson can then check the etp image after signing using the same python script

  if  [ "${CHECK_IMAGE_SIZE}" == "yes" ]; then
    FileSizeRet=0

  # Check the non-etp image first
  python ${BUILD_ROOT}/tools/nds/si/python/FlashFileCheckLib.py ${SPK_PLATFORM} ${IMAGE_OUTPUT_PATH}/${EOTV_IMAGE_OUTPUT}.${PROFILE}

  + '[' yes == yes ']'
  + FileSizeRet=0
  + python /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/python/`FlashFileCheckLib.py` 
    ams-drx890 
    /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.sky_trials

  #######################################################
  2017-01-10 14:19:49,567 INFO: Start of Flash File Check
  #######################################################
  
  2017-01-10 14:19:49,567 INFO: Checking /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.sky_trials
  Flash Bank Size = 16777216
  Overheads       = 0
  Flash File Size = 18553736
  Max File Size   = 16777216
  ERROR - File too big

  + mv /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.sky_trials /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.sky_trials.FILE_TOO_BIG
  + echo '######### NON-ETP IMAGE TOO BIG ########'

  + FileSizeRet=1

  + '[' -f /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials ']'
  + python /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/python/FlashFileCheckLib.py ams-drx890 /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials -e

  #######################################################
  2017-01-10 14:19:49,596 INFO: Start of Flash File Check
  #######################################################
  
  2017-01-10 14:19:49,597 INFO: Checking /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials
  ETP already added so just allowing for ETP storage
  Flash Bank Size = 16777216
  Overheads       = 131072
  Flash File Size = 18684652
  Max File Size   = 16646144
  ERROR - File too big

  + mv /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials /home/nds-uk/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.etp.sky_trials.FILE_TOO_BIG
  + echo '########### ETP IMAGE TOO BIG ##########'
}


={============================================================================
|kt_dev_si_0002| si-build-make-image-external-toolchain

<make-image-kernel-config>
# cust trial shell
CONFIG_FEATURE_SH_IS_MSH=y

# from other changes
CONFIG_SERIAL_8250_EXTENDED=y
CONFIG_SERIAL_8250_SHARE_IRQ=y

# from console options
#
# Serial drivers
#
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_8250_NR_UARTS=0
CONFIG_SERIAL_8250_RUNTIME_UARTS=0
# CONFIG_SERIAL_8250_EXTENDED is not set

#
# Non-8250 serial port support
#
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y

CONFIG_CMDLINE="console=ttyS0,115200n8 ....


# from make_img log
# `target/device/Sky/ams-drx595/kernel-debug.config' -> `/home/NDS-UK/parkkt/cc/parkkt_BSKYB_HZ001_03
# FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx595-debug/project_build_mips/ams-drx595/linux-2.6.18.8/.config'

#*
#* Linux Kernel Configuration
#*
#Linux Kernel Configuration
#> 1. .config file (BR2_PACKAGE_LINUX_USE_KCONFIG)
#  2. Run make <board>_defconfig  (BR2_PACKAGE_LINUX_USE_DEFCONFIG)
#  3. Run make ARCH=$(ARCH) [xconfig|menuconfig] before build (BR2_PACKAGE_LINUX_USE_XCONFIG)
#choice[1-3?]: 1
#.config file (BR2_PACKAGE_LINUX_KCONFIG) [target/device/Sky/ams-drx595/kernel-preprod.config] target/device/Sky/ams-drx595/kernel-preprod.config

# vobs\FUSIONOS_INPUT_DEL_5\DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01\build_platform\spk\darwin-spk-1.17 will be created once the build is done previously.
#
vobs\FUSIONOS_INPUT_DEL_5\DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01\build_platform\spk\darwin-spk-1.17\target\device\Sky\ams-drx595\

-rw-r--r-- 1 parkkt ccusers 21178 Apr 21  2010 buildroot-debug.config
-rw-r--r-- 1 parkkt ccusers 20729 Apr 21  2010 buildroot-preprod.config
-rw-r--r-- 1 parkkt ccusers 20658 Mar 16 13:33 buildroot-prod.config
-rw-r--r-- 1 parkkt ccusers 24587 Aug 25  2009 busybox-debug.config
-rw-r--r-- 1 parkkt ccusers 26031 Feb  1  2010 busybox-preprod.config
-rw-r--r-- 1 parkkt ccusers 26173 Feb  1  2010 busybox-prod.config
-rwxrwxr-x 1 parkkt ccusers  7631 Feb 10 13:29 cdi_device_table.txt
-rw-r--r-- 1 parkkt ccusers  2074 Jul 26  2010 device_table.txt
-rw-r--r-- 1 parkkt ccusers 22542 Jan 17 15:33 kernel-debug.config
drwxr-xr-x 2 parkkt ccusers  4096 Jan 28 13:13 kernel-patches
-rw-r--r-- 1 parkkt ccusers 21978 Jan 17 15:33 kernel-preprod.config
-rw-r--r-- 1 parkkt ccusers 21897 Jan 17 15:33 kernel-prod.config
drwxr-xr-x 5 parkkt ccusers  4096 Jan 28 13:13 rootfs


<make-image>

<methond-01>
The build procedure is as follows

1. First build a normal Cust trials build with variant preprod
2. This will build all the tarballs necessary and will place them in the
location
FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/spk/darwin-spk-1.18

3. Now cd to this directory and configure for a preprodbuild 

./configure O=drx595-debugging ams-drx595 preprod initramfs otv dhcp console fullstack noscs

4. As the console is enabled we have to share the IRQ , if this is not enabled
it will not allow the extradrivers.ko to be insmoded and we would encounter
kernel crashes
		
make O=drx595-debugging kernel-menuconfig
	(D)evice Drivers ? (C)haracter devices ? (S)erial Drivers  ? (E)xtended 8250/16550 serial driver options ? (S)upport for sharing serial interrupts 

5. Then make the image
make O=drx595-debugging

6. Once the vmlinux is made we have to dummy sign the image using the image
generation tool and flash it to the box
 
Regards Krishnendhu Prakasan   

# this makes:
Build outputs at:-
  /home/NDS-UK/parkkt/cc/parkkt_BSKYB_HR006_002/vobs/FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/spk/darwin-spk-1.18/drx595-debugging/binaries/ams-drx595

# go to followings and and rm all except image-generation-ams-drx595.tar.bz2. untar image-generation-ams-drx595.tar.bz2.
/home/NDS-UK/parkkt/cc/parkkt_BSKYB_HR006_002/vobs/FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/image_generation

# copy vmlinux from 
# /home/NDS-UK/parkkt/cc/parkkt_BSKYB_HR006_002/vobs/FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/spk/darwin-spk-1.18/drx595-debugging/binaries/ams-drx595
# to 
# /home/NDS-UK/parkkt/cc/parkkt_BSKYB_HR006_002/vobs/FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/image_generation

# run this command.
./generate-otv-image.sh vmlinux .

# get APPLI_0.FLA


<methond-02>

# comment out ./configure O=/hom.. from make_image.sh

# make changes to followings directly
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx595-prod/project_build_mips/ams-drx595/linux-2.6.18.8/.config

# run make_image.sh as usual.


# this is dest:
# /home/NDS-UK/parkkt/cc/parkkt_BSKYB_HR004_002/vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug

* Buildroot Configuration
* Sky packages
Allow DNS requests/replies (BR2_PACKAGE_SKY_FIREWALL_ALLOW_DNS) [Y/n/?] y
* Kernel

# output from configurations
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/.config


# output, should rename it for usb flashing
# picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/image/OTV/APPLI_0.FLA.nds_si_devel -> image\OTV\APPLI_0.FLA

Build outputs at:-
  .../build/picasso/SPK/ams-drx595-prod/binaries/ams-drx595
total 53M
-rwxrwxrwx 1 parkkt ccusers  50K Mar 18 14:56 rootfs.mips.initramfs_list
-rw-r--r-- 1 parkkt ccusers  11M Mar 18 14:57 rootfs.mips.squashfs
-rwxrwxrwx 1 parkkt ccusers  23M Mar 18 14:57 rootfs.mips.tar
-rwxrwxrwx 1 parkkt ccusers  10M Mar 18 14:57 rootfs.mips.tar.bz2
-rwxr-xr-x 1 parkkt ccusers 9.8M Mar 18 14:57 vmlinux


SPK path: 
vobs/FUSIONOS_INPUT_DEL_5/DEL_DARWIN_SKYDRX595_BCM97350_LNUX_01/build_platform/spk/darwin-spk-1.17/

OUTPUT path:
\FUSION_SYSTEM_INTEGRATION\BSKYB_INTEGRATION\build\picasso\SPK\ams-drx890-debug\project_build_mips\ams-drx890\linux-2.6.18.8\include\asm-mips\ucontext.h
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx595-prod/project_build_mips/ams-drx595/
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx595-debug/project_build_mips/ams-drx595/root/lib/

actuall config file:
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx595-prod/project_build_mips/ams-drx595/linux-2.6.18.8/.config


={============================================================================
|kt_dev_si_0002| si-build-mapfile

/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/
picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/processes
-rwxr-xr-x 1 kyoupark ccusers 17832996 Aug  1 16:54 MW_Process*
-rw-r--r-- 1 kyoupark ccusers    22835 Jul 22 09:31 mw_process_main.deps
-rw-r--r-- 1 kyoupark ccusers    16392 Jul 22 09:31 mw_process_main.o
-rw-r--r-- 1 kyoupark ccusers 27298232 Aug  1 16:53 MW_Process.map

  49629  .text.Curl_cookie_add
  49630                 0x000000000076cb40      0xb5c /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION
    /build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg//components/misc_libraries/http/src/libhttp.a(cookie.o)

  49631                 0x000000000076cb40                Curl_cookie_add


={============================================================================
|kt_dev_si_0002| si-build-jpa

download tar:  
BSKYB_JTH-BSKYB_JTH_trunk.97338_BSKYB_JTH_HR014_Int.tar.gz 

jpa fron unzipped tree:
THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa

version.txt:
83.51.00_BSKYB_HR014_Int


={============================================================================
|kt_dev_si_0002| si-build-spk si-build-driver

<spk>
# again, apk is a sym link
# AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/patches
# FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/patches
/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk
darwin-spk-1.19-20131014.tar.bz2 -> ../../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/patches
darwin-spk-1.19-patches.tar.bz2

# delete and replace it with the other
/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk
darwin-spk-1.19-20131014.tar.bz2

<driver>
# again, driver is a sym link
# FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball
/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball
cdi-drivers-ams-drx890-preprod.tar.bz2 -> ../../../deps/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-preprod.tar.bz2*

# delete and replace it with the other
/STB_SW/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball
cdi-drivers-ams-drx890-debug.tar.bz2

# both are in the same submodule.

#.gitmodules
[submodule "AMS_BCM_MIPS4K_LNUX_DARWIN_01"]
        path = AMS_BCM_MIPS4K_LNUX_DARWIN_01
        url = ssh://wwwin-git-gpk-2.cisco.com:29418/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01


kyoupark@ukstbuild2:~/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01$ g st
HEAD detached from c058bd7
nothing to commit (use -u to show untracked files)

kyoupark@ukstbuild2:~/STB_SW$ g st
On branch try-td-log-on-driver
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   AMS_BCM_MIPS4K_LNUX_DARWIN_01 (new commits)

no changes added to commit (use "git add" and/or "git commit -a")

# git commit -am and see diff

kyoupark@ukstbuild2:~/STB_SW$ git diff c5452b3..HEAD
diff --git a/AMS_BCM_MIPS4K_LNUX_DARWIN_01 b/AMS_BCM_MIPS4K_LNUX_DARWIN_01
index c058bd7..bc53963 160000
--- a/AMS_BCM_MIPS4K_LNUX_DARWIN_01
+++ b/AMS_BCM_MIPS4K_LNUX_DARWIN_01
@@ -1 +1 @@
-Subproject commit c058bd74915495e869e957e3589eab2cf6939908
+Subproject commit bc5396335e811ea485602222a8f5080609543bc2

# but still
kyoupark@ukstbuild2:~/STB_SW/AMS_BCM_MIPS4K_LNUX_DARWIN_01$ g st
HEAD detached from c058bd7
nothing to commit (use -u to show untracked files)


={============================================================================
|kt_dev_si_0002| si-build-flipper

$ git tag ENG_XX.09.12


={============================================================================
|kt_dev_si_0002| si-theyard

Yard Link: http://theyard.cisco.com/si_logs/translation/

<config>
Use ".cfg" to have settings in other scripts.

/home/si_logs/bin/.cfg
MIRRORMACHINE=theyard
MIRRORDIR=/home/si_logs/mirrored/upload
LOCALUSER=si_logs
...


<clone>
$ git clone si_logs@theyard:/home/si_logs/bin sbin


={============================================================================
|kt_dev_si_0002| si-sh-check-log

Decode and examine a user-trial upload.

~/bin/check_log

check_log: check_log <md5sum or mac address>: do the conversion of the upload file 

note:
check_log darwin_0019fbd18c9a_487032cd821312aea3b11274c2ff7384  // not find
check_log 487032cd821312aea3b11274c2ff7384                      // find


<log-reparse>
newyard_reparse_request darwin_xxxx_xxxxx.tgz


<alias>
t()
{
    cd $HOME/translation
    L=`echo *$1 | grep -v '*' | wc -w`
    echo "Match count $L"
    if [ $L -eq 0 ]
    then
        echo "No such directory found: $1"
    else
        if [ $L -gt 1 ]
        then
            echo "Multiple directories found - specify further:"
            ls -ld *$1
        else
            echo "Changing to \"$1\""
            cd *$1
        fi
    fi
}

cl()
{
    # check_log do not `cd` so need to run t.
    check_log $1
    t $1
}


<ex>
[si_logs@ukstbuild01 parkkt]$ check_log 930bfc54ac88565a249ae01328a8a88b
WC=1
File line now {Jul 5 10:22 darwin_0019fbddef0c_930bfc54ac88565a249ae01328a8a88b.tgz}
Using 
...
# from the below log, can get diag_bin_parser from '/home/si_logs/tx/drx890/20.05.00'
diag_bin1 (/home/si_logs/tx/drx890/19.14.00,/home/si_logs/tx/drx890/20.05.00) Pre-parse...


# grep from UPLOAD.LOG
# Uploading to ftp://anonymous@87.86.191.132/upload/darwin_00101800122e_c9a6001730871c2bc4b38f57a34844f9.tgz
+ hwaddr=001018001200
+ md5=080f6bcc972075befa5dc039265e54f6

# get list of uploaded files (890 case)
ls /home/si_logs/mirrored/upload/darwin_00101800122e*

cp /home/si_logs/mirrored/upload/darwin_00101800122e_157cab819be0c785f41d8cdcde7aaead.tgz .


<sh>
declare -ar list=(
    darwin_0019fbd18c9a_487032cd821312aea3b11274c2ff7384
    darwin_0019fbb71c47_c4130c208206b80b3963ee05c861b5c3
    darwin_0019fbb71bb1_d23afbe329e75a1d9bcabc233373d398
)

for item in ${list[@]}; do echo ${item}; pushd ${item};egrep -anH "Leak de|Could not unravel" LOGlastrun_realtime;popd; done


declare -ar list=(
  0019fb2c562c
  0019fb2c5624
  0019fbc3572c
  0019fbe9554c
  0019fbd76222
)

for item in ${list[@]}; do echo ${item}; ssh thyard check_log ${item}; done


<internal>

[si_logs@theyard ~]$ check_log 85c768cdc006973f32b4e98c7c34d582
Looking in /home/si_logs/mirrored/upload...
ls: cannot access *85c768cdc006973f32b4e98c7c34d582*: No such file or directory
WC=1
File line now {}
Nothing found locally - checking remote servers...
ssh si_logs_mirror@theyard grep "^" /home/si_logs/mac_list | cut -d' ' -f2
Using /home/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582
User=si_logs@theyard.cisco.com
See if we can find this log anywhere else (already parsed)...
ssh -o ServerAliveInterval=10 -p 9199 si_logs@newyard.cisco.com build -s USR_request_log -p FILENAME="darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582.tgz" -p DESTINATION="si_logs@theyard.cisco.com:/local/storage/translated_receive"
Started USR_request_log #29910
Completed USR_request_log #29910 : SUCCESS
Looking for /local/storage/translated_receive/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582.lzma...
Running check_log -dir darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582.tgz
Will go to /home/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582
Found /home/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582
/home/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582 to be used
mkdir: cannot create directory `/home/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582': File exists
About to unpack...
Done unpacking
Yard Link: http://theyard.cisco.com/si_logs/translation/darwin_0019fb986706_85c768cdc006973f32b4e98c7c34d582/index.html
If using sad-faced dog and auto-refresh doesn't work, try link above.


# use cfg file
++ CONFIGFILE=/home/si_logs/bin/.cfg

# cfg values
++ MIRRORMACHINE=theyard
++ MIRRORUSER=si_logs_mirror
++ LOGDIR=/home/si_logs/translation
++ MIRRORDIR=/home/si_logs/mirrored/upload
++ TXDIR=/home/si_logs/tx
++ TXUSER=
++ TXMACHINE=
++ TRY_TO_GET=YES
++ WORK_OUT_MACHINE=work_out_machine_bskyb
++ WORK_OUT_VER_BY_MACHINE=
++ PRODUCE_ALOG=YES
++ LOCALUSER=si_logs
++ SORTFILE=/home/si_logs/mac_list
++ TRANSLATIONDIR=/home/si_logs/translation
++ ADDITIONAL_TESTS=note_hudkins.sh
++ USEINFO=YES
++ SEND_COOKED=YES
++ HTTPROOT=http://theyard.cisco.com
++ ADDITIONAL_NOTIFY=hippo_queue_log.sh
++ TIDY_INTERMEDIATE_FILES=
++ UNIFY_KMSG=
++ GREPFOR='darwin_|picassodigi_|rlog_'
++ WOMBAT_DBNAME=uploads
++ WOMBAT_DBCONNECT='-u root'

++ export TXMACHINE

+++ pwd
++ '[' /home/si_logs == /home/si_logs/mirrored/upload ']'
++ ALWAYS_FIND=0
++ FORCE=0
++ NOCASE=0
++ NEVERPARSE=0
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -p ']'
++ DIAGPATH=
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -f ']'
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -neverparse ']'
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -k ']'
++ JUST_DIR=0
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -dir ']'
++ UPDATE_DETAIL=0
++ '[' b558b7a71573867c0b68cb77bfb97e57 = -update_detail ']'
+++ echo b558b7a71573867c0b68cb77bfb97e57

++ echo 'Looking in /home/si_logs/mirrored/upload...'

# A=``ssh $MIRRORUSER@$MIRRORMACHINE "(cd $DIR;ls -lrt *$LOOKFOR*)" | while read perm inode uid gid size mon dt tm fname; do echo "$mon $dt $tm $fname";done | tail -20``

+++ ssh si_logs_mirror@theyard '(cd /home/si_logs/mirrored/upload;ls -lrt *b558b7a71573867c0b68cb77bfb97e57*)'
+++ read perm inode uid gid size mon dt tm fname
+++ tail -20

bash: line 0: cd: /home/si_logs/mirrored/upload: No such file or directory
ls: cannot access *b558b7a71573867c0b68cb77bfb97e57*: No such file or directory

++ echo 'Nothing found locally - checking remote servers...'

# execute other script
++ '[' theyard.cisco.com == theyard.cisco.com ']'
+++ newyard_does_log_exist.sh b558b7a71573867c0b68cb77bfb97e57
++ FNAME=darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz
++ '[' darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz = '' ']'

# remove ext
+++ basename darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz .tgz
++ ADDED_BIT=darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57

# check translation dir
++ D=/home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57

# make dir
++ mkdir /home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57
++ cd /home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57

# newyard_bring_us_log.sh $FNAME && exit 0
# this stops here
++ echo 'See if we can find this log anywhere else (already parsed)...'
++ newyard_bring_us_log.sh darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz

# run `newyard_bring_us_log.sh`
# ssh -o ServerAliveInterval=10 -p 9199 si_logs@newyard.cisco.com build -s USR_request_log -p FILENAME="darwin_0019fbd18c68_a3d4781b9564b2b3d59838ea196ce12f.tgz" -p DESTINATION="si_logs@theyard.cisco.com:/local/storage/translated_receive"
echo "ssh -o ServerAliveInterval=10 -p 9199 si_logs@${WHICH_NEW} build -s USR_request_log -p FILENAME=\"$FILENAME\" -p DESTINATION=\"$DESTINATION\""
ssh -o ServerAliveInterval=10 -p 9199 si_logs@newyard.cisco.com build \
  -s USR_request_log \
  -p FILENAME="darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz" \
  -p DESTINATION="si_logs@theyard.cisco.com:/local/storage/translated_receive"

Started USR_request_log #47724
Completed USR_request_log #47724 : SUCCESS

# runs command on newyard, copy files from newyard to
# /local/storage/translated_receive.
#
# note: 
# requested .tgz but get .lzma
# the .lzma file is one that already translated

# [si_logs@theyard ~]$ ls /local/storage/translated_receive/
# ...
# darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.lzma
# darwin_0019fb4375f3_5bf1255201f33533befb570a54378c1c.lzma

# runs `process_translated`
    if [ -f /local/storage/translated_receive/$FILENAME_LZMA ]
    then
        process_translated $FILENAME_LZMA
        exit 0
    fi

# `process_translated` script in `newyard_bring_us_log.sh`

Looking for /local/storage/translated_receive/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.lzma...

# note: run check_log 2nd

Running check_log -dir darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz

    echo "Running check_log -dir ${OTHER}.tgz"
    DIR=`check_log -dir ${OTHER}.tgz`

# see in pwd which is different from where starts
+++ export TXMACHINE
++++ pwd
+++ '[' /home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57 == /home/si_logs/mirrored/upload ']'

+++ JUST_DIR=1

+++ LOOKFOR=darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz

# runs sql this time since JUST_DIR=1 and exit. update a db?
++++ mysql --batch --skip-column-names -u root uploads '--execute=select directory_name from upload where filename = '\''darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz'\'' or md5sum = '\''darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57.tgz'\'''
+++ LOCATION=/home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57

# echo $LOCATION
# exit 0

+++ exit 0

# will be DIR=LOCATION

# back to `process_translated`
Will go to /home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57
Found /home/si_logs/translation/darwin_0019fb0f53b4_b558b7a71573867c0b68cb77bfb97e57

# `unpacking`
About to unpack...
+ cat /local/storage/translated_receive/darwin_0019fbd18c68_a3d4781b9564b2b3d59838ea196ce12f.lzma
+ unlzma -
+ tar xvf -
+ echo 'Done unpacking'

Done unpacking
        echo "About to unpack..."
        cat $F | unlzma - | tar xvf - > .lzma.out 2>&1
        echo "Done unpacking"

# note: run check_log 3nd
# check_log -update_detail ${OTHER}.tgz > .check_log.out 2>&1
+ check_log -update_detail darwin_0019fbd18c68_a3d4781b9564b2b3d59838ea196ce12f.tgz

++ UPDATE_DETAIL=1

# parse fname
++ MAC=0019fbd18c68
++ MD5=a3d4781b9564b2b3d59838ea196ce12f
++ D=/home/si_logs/translation/darwin_0019fbd18c68_a3d4781b9564b2b3d59838ea196ce12f
+++ ssh si_logs_mirror@theyard grep '^0019fbd18c68' /home/si_logs/mac_list
++ NAME=BrentwoodB328

# if [ $UPDATE_DETAIL -eq 1 ]
# then
#     FULLVER=`get version`
#     MACHINE=`get platform`
#     A=``get parser_result``       # gets parser_result from .detailed_output


<no-log>
if [ -s LOG -a ! -f .bestguess ]

# expects there is no CUR file but there is. so no translation.
#
else
    if [ "`echo [SP]*.CUR`" != '[SP]*.CUR' -o "`echo [SP]*.LOG`" != '[SP]*.LOG' ]
    then
        echo "<p0>LOG translation did not succeed or was not available</p0>" >.bestguess
    else
        echo "<p0>No Snnn.CUR/Pnnn.CUR or equivalent .LOG files in log upload</p0>" >.bestguess
    fi
    RETVAL=1
fi


<pcat-check>
PCATDB=PCAT.DB
PCAT=""
if [ $CORRUPT -eq 0 -a -f $PCATDB ]
then
    # $? is 0 when db corrupted
    # $? is 0 when db is ok
    # $? is 11 when db corrupted
    SQRES=`sqlite3 ${PCATDB} "pragma integrity_check" 2>.pcat_error`
    SQRN=$?
    echo "$SQRES"
    NEW_A=

    # okay, something is wrong. let's check
    if [ $SQRN -ne 0 ]
    then
        XX=`cat .pcat_error | cut -d':' -f1-2`
        if [ "$XX" = "Error: no such collation sequence" ]
        then
          echo "PCAT DB is ok"
        else
          echo "PCAT DB is corrupted"
          NEW_A="PCAT.DB is corrupted"

          # 2016.11. added to fix the issue that not shows pcat corrpution in
          # result when integirity check fails on db file
          PCAT="[PCAT.DB corrupted]"      <pcat> see different message
        fi

    # return okay but still need to check
    else
        if [ "$SQRES" != "ok" -a "$SQRES" != "Error: no such collation sequence: DEUTCH" ]
        then
            echo "PCAT DB is corrupted (2)"
            PCAT="[PCAT.DB corruption]"   <pcat>
        else
            echo "PCAT DB is ok"
        fi

        items > item.txt
        items -x > item.csv
        items -b > itemk.txt
        signup_jobs PCAT.DB > signup_jobs.txt
        pcat.py -b
        pcat.py -d
        $MYPATH/pvod_scan/pvod.py
    fi

    if [ "$NEW_A" != "" ]
    then
        OLD_A=`head -1 .bestguess | grep "<p1>" | sed -e's/<p1>//' | sed -e's/<\/p1>//'`
        if [ "$OLD_A" != "" ]
        then
            A="<p1>$OLD_A, $NEW_A</p1>"
        else
            A="<p1>$NEW_A</p1>"
        fi
        echo "$A" > .bestguess
    fi
else
    echo "PCAT DB not found"
fi


# *write_result*
# 
# where does $A comes from?
#
# @1379
# A=
# if [ -f .bestguess ]
# then
#     A=`head -1 .bestguess`
#     P_FOUND=`echo "$A" | cut -d'>' -f1 | cut -c3`
# fi
#

++ `write_results` -update_only   # updates .detailed_output
#    echo "BestGuess (P1): $A" >> .summary

++ HTML=http://theyard.cisco.com/si_logs/translation/darwin_0019fbd18c68_a3d4781b9564b2b3d59838ea196ce12f/index.html

# <detailed-output>
# create detailed_output
#     (
# cat << END
# version=$FULLVER
# parser_result=$A
# 
# pcat_status=$PCAT       # <pcat>
# ...
# END
#     ) > .detailed_output

++ echo 'Done .detailed_output'

++ `produce_index_html`   # this is a script

html=`grep "^html=" .detailed_output | sed -e's/html=/Yard Link: /' | sed -e's/theyard.uk.nds.com/theyard.cisco.com/'`
echo "$html"
echo "If using sad-faced dog and auto-refresh doesn't work, try link above."

    add_html "<h3>All p1/p2 log parser results (regarded as test failures)</h3>"


<produce_index_html>

# Original Upload Name:
# 
# Last log entry at 00:09:05 (box-time, not real-time)
# <p1>DBENGINE fatal error: status = 0x203000b [PCAT.DB corrupt], PCAT.DB is corrupted (built by hudson)</p1>

# greps on .detailed_output and gets a value
RESULT=`get_val parser_result`

add_html "`echo \"Last log entry at $LASTLOG (box-time, not real-time)\"| to_xml` <br>"
add_html "`echo $RESULT | to_xml`"


PCAT_STATUS=`get_val pcat_status`
if [ "$PCAT_STATUS" != "" ]
then
    add_html "<h3>WARNING!  PCAT.DB failed 'pragma integrity_check' (run <i>sqlite3 PCAT.DB 'pragma integrity_check'</i> to see what is corrupt)</h3>"
fi


# All p1/p2 log parser results (regarded as test failures)
# use other then prio 1 and 2

add_html "<h3>All p1/p2 log parser results (regarded as test failures)</h3>"
sort -n -k3 .all_tests_found | while read priority testid lineno text
do
  case $priority in
  1)	colour='bgcolor=Red';;
  2)	colour='bgcolor=Orange';;
  *)	continue;;
  esac
  real_time=`time_from_line.py $lineno 2>/dev/null`
  add_html "<tr $colour><td>P$priority</td><td>$testid</td><td><a href='${HTTPROOT}:8080/gator/logs/$SMALLDIR/$lineno'>$lineno</a></td><td>$real_time</td><td>$text</td></tr>"
done

# All lower-priority log parser results (ignore these unless you know what they mean)
# use other then prio 1 and 2

add_html "<h3>All lower-priority log parser results (ignore these unless you know what they mean)</h3>"
sort -n -k3 .all_tests_found | while read priority testid lineno text
do
  case $priority in
  1)	continue;;
  2)	continue;;
  3)	colour='bgcolor=Yellow';;
  *)	colour='';;
  esac
  real_time=`time_from_line.py $lineno 2>/dev/null`
  add_html "<tr $colour><td>P$priority</td><td>$testid</td><td><a href='${HTTPROOT}:8080/gator/logs/$SMALLDIR/$lineno'>$lineno</a></td><td>$real_time</td><td>$text</td></tr>"
done


={============================================================================
|kt_dev_si_0002| si-sh-check-log-mc

357@check_log

    if [ -f LOGlast ]
    then
        if [ "$1" != "-update_only" ]
        then
            if [ $DO_NOT_ANALYSE -eq 1 ]
            then
                echo "DO NOT ANALYZE"
            else
                ######## Analysis Scripts #######
                if [ "$TXMACHINE" == "" -a $LOCAL_NON_DIAG -eq 0 ]
                then
                    nohup analyze_log $NAME > analyze_log 2>&1 &
                else
                    timeout 600s analyze_log $NAME > analyze_log 2>&1
                fi
            fi
        fi
    fi
    echo "After analyze log."


analyze_log

##### MCM state machine validation #####
timeout 120s mcm_validate.sh


mcm_validate.sh

### Execute Python Script
mc_check.py mc_jobtypes.txt mc_statechanges.txt  tuner_hmc.info


<mc_check-txt>
hMc       Tuner Id  MCM Job             MC create line#     MC Active duration  MCM Pending State   MCM Uninitiated State
---       --------  -------             ---------------     ------------------  -----------------   ---------------------
0xf354    1         mc-record           9911710             73.9049             mc-stop             mc-free             
0xf355              mc-live             9912674             60.0019             mc-create           PHEW                

<mc-full-txt>
0xf353    1         mc-live             9910153             84.7748             mc-freed            mc-free             
0xf354    1         mc-record           9911710             73.9049             mc-stop             mc-free             
0xf355              mc-live             9912674             60.0019             mc-create           PHEW                

<etlog>
MC	         jhVRM	Title	shrec	create	     created	    prepare	      prepared	     run	          running	      stop	        stopped	free	freed	destroy	destroyed
hMC=0xf354	jb-rbrec		s2567	22 12:03:19,  22 12:03:19,  22 12:03:19,  22 12:03:20,  22 12:03:20,  22 12:03:20,  22 12:04:33
hMC=0xf353	mc-live     s2567	22 12:03:19,  22 12:03:19,  22 12:03:19,  22 12:03:20,  22 12:03:20,  22 12:03:20,  22 12:04:33 


={============================================================================
|kt_dev_si_0002| si-sh-check-log-auto


/home/nds-uk/kyoupark/si-bin/cklog.sh

#!/bin/bash

declare -ar list=(
1ba390bfa3bb30da94b11adecf0d83f6
3ce683e48e5ca64f36a91d02ca490b3c
)

#
for item in ${list[@]}; do ssh yard /home/si_logs/tmp_kit/worker_cklog.sh ${item}; done

for item in ${list[@]}; do ssh yard /home/si_logs/tmp_kit/worker_cklog.sh ${item}; echo "press to continue..."; read -n1 x; done


[si_logs@theyard darwin_0019fb441e09_e463ac5298d3dc6888575a4d4f68fca3]$ cat /home/si_logs/tmp_kit/worker_cklog.sh
#!/bin/bash

# bold=$(tput bold)
# normal=$(tput sgr0)

t()
{
    cd $HOME/translation
    L=`echo *$1 | grep -v '*' | wc -w`
    echo "Match count $L"
    if [ $L -eq 0 ]
    then
        echo "No such directory found: $1"
    else
        if [ $L -gt 1 ]
        then
            echo "Multiple directories found - specify further:"
            ls -ld *$1
        else
            echo "Changing to \"$1\""
            cd *$1
        fi
    fi
}

cl()
{
    check_log $1
    t $1
}

echo ""
echo "==========================================="
echo " ${bold} worker: doing $1... ${normal}"
echo "-------------------------------------------"
cl $1
echo "${bold} +++ pwd ${normal}"
echo "`pwd`"
echo "${bold} +++ grep 1299 ${normal}"
egrep -an "Showing dialog 1299" LOGlastrun_realtime | wc -l
echo "${bold} +++ grep 1300 ${normal}"
egrep -an "Showing dialog 1300" LOGlastrun_realtime | wc -l
echo "${bold} +++ cat all ${normal}"
cat .all_tests_found

# END


={============================================================================
|kt_dev_si_0002| si-sh-check-back

note:
assumes that all logs are translated. that is they are in translation folder.

++ TRANSLATIONDIR=/home/si_logs/translation
++ WOMBAT_DBNAME=uploads
++ WOMBAT_DBCONNECT='-u root'

<option>

if [ "$1" = "-o" ]
then
    shift
    G=$1
    shift
fi


// number of logs

M=1000
if [ "$1" = "-m" ]
then
    M=$2
    shift;shift
fi

1. cd TRANSLATIONDIR=/home/si_logs/translation
2. run sql statement and result `by upload_time`

<run-on-parser>
// sorted by upload_time so the latest comes first. use `tac` to reverse.
mysql --batch --skip-column-names -u root uploads -e "select platform, version, upload_time, parser_result from upload where directory_name is not null and parser_result != 'Not Yet Parsed' order by upload_time desc limit 3000"


3. when "-for" is given, cd and grep the given pattern on LOGlastrun.log.gz.
only when there is a log file.

if [ "$1" = "-for" ]

// check_back -for 'look for this pattern'
// ...would search the logs for any containing "look for this pattern"


4. if not "-for" then the given script on a log.

        else
            E=`$X "$f"`
        fi

// check_back sfm_bad_tpid
// ...would run <git-repo>/tests/sfm_bad_tpid on every log in all the uploads
//
// check_back $HOME/my_new_test
// ...would run $HOME/my_new_test on every log in all the uploads


={============================================================================
|kt_dev_si_0002| si-mysql

{how-yard-db-made}

note: `id` in both tables is foreign key to link together.

mysql> show columns from all_tests_found;
+------------+----------+------+-----+---------+-------+
| Field      | Type     | Null | Key | Default | Extra |
+------------+----------+------+-----+---------+-------+
| id         | int(11)  | NO   | MUL | NULL    |       |
| test_id    | int(11)  | YES  |     | NULL    |       |
| priority   | int(11)  | YES  |     | NULL    |       |
| line_no    | int(11)  | YES  |     | NULL    |       |
| found_time | datetime | YES  |     | NULL    |       |
+------------+----------+------+-----+---------+-------+
5 rows in set (0.07 sec)

mysql> show columns from upload;
+----------------+------------+------+-----+---------+----------------+
| Field          | Type       | Null | Key | Default | Extra          |
+----------------+------------+------+-----+---------+----------------+
| project        | char(10)   | YES  |     | NULL    |                |
| filename       | char(255)  | YES  | UNI | NULL    |                |
| version        | char(40)   | YES  | MUL | NULL    |                |
| platform       | char(20)   | YES  | MUL | NULL    |                |
| boxname        | char(80)   | YES  | MUL | NULL    |                |
| mac            | char(12)   | YES  | MUL | NULL    |                |
| md5sum         | char(32)   | YES  | MUL | NULL    |                |
| upload_time    | datetime   | YES  | MUL | NULL    |                |
| parser_result  | char(255)  | YES  |     | NULL    |                |
| lastlogtime    | float      | YES  |     | NULL    |                |
| corrupt        | char(10)   | YES  |     | NULL    |                |
| diskerrors     | char(10)   | YES  |     | NULL    |                |
| pcat_status    | char(20)   | YES  |     | NULL    |                |
| nvram_status   | char(20)   | YES  |     | NULL    |                |
| parser_testid  | int(11)    | YES  |     | NULL    |                |
| priority       | int(11)    | YES  |     | NULL    |                |
| directory_name | char(255)  | YES  |     | NULL    |                |
| html           | char(255)  | YES  |     | NULL    |                |
| from_time      | datetime   | YES  |     | NULL    |                |
| to_time        | datetime   | YES  |     | NULL    |                |
| skykeycode     | char(4)    | YES  |     | NULL    |                |
| iterative      | tinyint(1) | YES  |     | NULL    |                |
| dylan          | tinyint(1) | YES  |     | NULL    |                |
| viewing_card   | char(9)    | YES  |     | NULL    |                |
| id             | int(11)    | NO   | PRI | NULL    | auto_increment |
| wake_reason    | char(2)    | YES  |     | NULL    |                |
| boot_token     | char(64)   | YES  | MUL | NULL    |                |
| eedid          | char(10)   | YES  | MUL | NULL    |                |
+----------------+------------+------+-----+---------+----------------+
28 rows in set (0.00 sec)


// `see all columns`
mysql --batch --table -u root uploads -e "select * from upload where  mac='0019fbf2d46b' order by upload_time desc limit 1"
+---------+----------------------------------------------------------+---------------------+------------+---------
| project | filename                                                 | version             | platform   | boxname 
+---------+----------------------------------------------------------+---------------------+------------+---------
| BSKYB   | darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01.tgz | 85.73.00_5920_MNTEE | ams-drx890 |         
+---------+----------------------------------------------------------+---------------------+------------+---------
+--------------+----------------------------------+---------------------+---------------------------------------------------------------------
| mac          | md5sum                           | upload_time         | parser_result                                                       
+--------------+----------------------------------+---------------------+---------------------------------------------------------------------
| 0019fbf2d46b | 776fb0633fa4c28b932d4955df99eb01 | 2017-08-01 06:23:51 | <p4>Stuck on SKEVT file processing complete (built by jenkins)</p4> 
+--------------+----------------------------------+---------------------+---------------------------------------------------------------------

+-------------+---------+------------+-------------+--------------+---------------+----------+--------------------------------------------------------------------------------
| lastlogtime | corrupt | diskerrors | pcat_status | nvram_status | parser_testid | priority | directory_name                                                                 
+-------------+---------+------------+-------------+--------------+---------------+----------+--------------------------------------------------------------------------------
| 9.46705e+08 |         |            |             |              |           546 |        4 | /home/si_logs/translation/darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01 
+-------------+---------+------------+-------------+--------------+---------------+----------+--------------------------------------------------------------------------------

+--------------------------------------------------------------------------------------------------------------+---------------------+---------------------
| html                                                                                                         | from_time           | to_time             
+--------------------------------------------------------------------------------------------------------------+---------------------+---------------------
| http://theyard.cisco.com/si_logs/translation/darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01/index.html | 2017-07-28 09:32:58 | 2017-07-28 14:59:42 
+--------------------------------------------------------------------------------------------------------------+---------------------+---------------------

+------------+-----------+-------+--------------+----------+-------------+------------+-------+
| skykeycode | iterative | dylan | viewing_card | id       | wake_reason | boot_token | eedid |
+------------+-----------+-------+--------------+----------+-------------+------------+-------+
|            |         0 |     0 | 592778963    | 90505128 |             |            |       |
+------------+-----------+-------+--------------+----------+-------------+------------+-------+


<test_id> 
// see id has multiple matches.

mysql --batch --table -u root uploads -e "select * from all_tests_found limit 10"
+----------+---------+----------+---------+------------+
| id       | test_id | priority | line_no | found_time |
+----------+---------+----------+---------+------------+
| 73126574 |     462 |        2 |  269835 | NULL       |
| 73126574 |     520 |        4 |  403723 | NULL       |
| 73126574 |     482 |        4 |  298173 | NULL       |
| 73126574 |     483 |        3 |    3345 | NULL       |
+----------+---------+----------+---------+------------+

mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, all_tests_found.test_id FROM upload, all_tests_found WHERE mac='0019fbf2d46b' AND all_tests_found.id=upload.id ORDER BY upload_time DESC LIMIT 10"
+---------------------+---------------------+----------------------------------------------------------+---------+
| version             | upload_time         | filename                                                 | test_id |
+---------------------+---------------------+----------------------------------------------------------+---------+
| 85.73.00_5920_MNTEE | 2017-08-01 06:23:51 | darwin_0019fbf2d46b_`776fb0633fa4c28b932d4955df99eb01`.tgz |     438 |
| 85.73.00_5920_MNTEE | 2017-08-01 06:23:51 | darwin_0019fbf2d46b_`776fb0633fa4c28b932d4955df99eb01`.tgz |     546 |
| 85.73.00_5920_MNTEE | 2017-08-01 06:23:51 | darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01.tgz |     119 |
| 85.73.00_5920_MNTEE | 2017-08-01 06:23:51 | darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01.tgz |     122 |

[si_logs@theyard darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01]$ cat .all_tests_found
4 438 257877 Client buffer full - Client is not reading data fast enough MHC sections during aquisition
4 546 4536 Stuck on SKEVT file processing complete
5 119 5298 Signal quality/strength has become very poor
5 122 5564 RMF_ET in RMF_Server - Possible conflict issue if near time of problem.

[si_logs@theyard darwin_0019fbf2d46b_776fb0633fa4c28b932d4955df99eb01]$ cat .bestguess
<p4>Stuck on SKEVT file processing complete</p4>


<scripts>

1. use a text file which has a format:
  mac_address_1 user_name_1
  ...

2. runs sql statements on each mac from the list

<1>
# use only mac in running sql statment
find_latest_uploads_from_mac_addresses.sh

# ex, this list out the latest 15 uploads for each mac
./find_latest_uploads_from_mac_addresses.sh -l brentwood_macs_and_names.txt -m 15

<2>
# use version and testid
find_matching_tests_by_version_and_mac.sh

    # Find uploads for the current MAC address.
    SQL_FIND_MATCHING_UPLOADS=""
    SQL_FIND_MATCHING_UPLOADS+="        SELECT"
    SQL_FIND_MATCHING_UPLOADS+="            version"
    SQL_FIND_MATCHING_UPLOADS+="          , upload_time"
    SQL_FIND_MATCHING_UPLOADS+="          , filename"
    SQL_FIND_MATCHING_UPLOADS+="          , all_tests_found.test_id"
    SQL_FIND_MATCHING_UPLOADS+="        FROM"
    SQL_FIND_MATCHING_UPLOADS+="            upload"
    SQL_FIND_MATCHING_UPLOADS+="          , all_tests_found"
    SQL_FIND_MATCHING_UPLOADS+="        WHERE"
    SQL_FIND_MATCHING_UPLOADS+="            mac = '$MAC_ADDRESS'"
    SQL_FIND_MATCHING_UPLOADS+="        AND"
    SQL_FIND_MATCHING_UPLOADS+="            all_tests_found.id=upload.id"
    # Add Version to the clause only if one was provided.
    if [ -n "$VERSION" ]
    then
        SQL_FIND_MATCHING_UPLOADS+="    AND"
        SQL_FIND_MATCHING_UPLOADS+="        version REGEXP('"$VERSION"')"
    fi
    if [ -n "$TEST_IDS" ]
    then
        SQL_FIND_MATCHING_UPLOADS+="    AND"
        SQL_FIND_MATCHING_UPLOADS+="        all_tests_found.test_id in ($TEST_IDS)"
    fi
    SQL_FIND_MATCHING_UPLOADS+="        ORDER BY"
    SQL_FIND_MATCHING_UPLOADS+="            upload_time DESC"
    SQL_FIND_MATCHING_UPLOADS+="          , version DESC"
    SQL_FIND_MATCHING_UPLOADS+="          , filename"
    SQL_FIND_MATCHING_UPLOADS+="        LIMIT"
    SQL_FIND_MATCHING_UPLOADS+="            $MAXIMUM_NUMBER_OF_UPLOADS_TO_FIND"
    SQL_FIND_MATCHING_UPLOADS+="        ;"


mysql --batch --table --column-names -u root uploads -e \
"SELECT version, upload_time, filename, all_tests_found.test_id FROM upload, all_tests_found WHERE mac = '0019fb091948' AND all_tests_found.id=upload.id AND all_tests_found.test_id in (442) ORDER BY upload_time DESC LIMIT 5"
+-----------------+---------------------+----------------------------------------------------------+---------+
| version         | upload_time         | filename                                                 | test_id |
+-----------------+---------------------+----------------------------------------------------------+---------+
| R014.083.64.00U | 2016-11-04 11:08:00 | darwin_0019fb0fc051_a213b57f7d19b46193caeccc485bbd2f.tgz |      59 |
| R014.083.64.00U | 2016-11-04 10:56:00 | darwin_0019fb0fc051_9eb0ef5a62d41b41b592c6f01571dbe5.tgz |      59 |
| R014.083.64.00U | 2016-11-04 10:35:00 | darwin_0019fb0fc051_9a2346415cd474f0f8be7e075e86f61a.tgz |      59 |
| R014.083.64.00U | 2016-11-04 10:13:00 | darwin_0019fb0fc051_3523e56ab3172c3763dcc72e200cce24.tgz |      59 |
| R014.083.64.00U | 2016-11-04 09:52:00 | darwin_0019fb0fc051_0552694f30c1fb1f6920a58c8713dc9d.tgz |      59 |
| R014.083.64.00U | 2016-11-04 09:31:00 | darwin_0019fb0fc051_15f231ec9fee53d1d4a73915097de1ba.tgz |      59 |
| R014.083.64.00U | 2016-11-04 09:10:00 | darwin_0019fb0fc051_94b69f5c3e485f87a55a2d6821641aa1.tgz |      59 |
| R014.083.64.00U | 2016-11-04 08:49:00 | darwin_0019fb0fc051_eb5aa2652b89acca00b243b62b6e262e.tgz |      59 |
| R014.083.64.00U | 2016-11-04 08:28:00 | darwin_0019fb0fc051_3686fbc91bde164ad593ef2f0c933835.tgz |      59 |
| R014.083.64.00U | 2016-11-04 08:06:00 | darwin_0019fb0fc051_fbceb6522f10a62547a6a85243e97f74.tgz |      59 |
+-----------------+---------------------+----------------------------------------------------------+---------+

mysql --batch --table -u root uploads -e \
"select version, upload_time, filename, all_tests_found.test_id from upload, all_tests_found where mac='0019FB0FC051' and all_tests_found.test_id in (59) order by upload_time desc limit 10"
# this show the same uploads. why?
# +---------------------+---------------------+----------------------------------------------------------+---------+
# | version             | upload_time         | filename                                                 | test_id |
# +---------------------+---------------------+----------------------------------------------------------+---------+
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |
# | 83.64.00_7120_MNTEE | 2016-11-17 06:43:00 | darwin_0019fb0fc051_4497e17380be16a370fb5ce183405eb9.tgz |      59 |


mysql --batch --table -u root uploads -e "SELECT version, upload_time, filename, pcat_status, all_tests_found.test_id FROM upload, all_tests_found WHERE mac='0019FB0FC051' AND all_tests_found.id=upload.id AND all_tests_found.test_id in (590) ORDER BY upload_time DESC LIMIT 10"


<3> search all with the test id

mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, parser_result, all_tests_found.test_id FROM upload, all_tests_found WHERE all_tests_found.id=upload.id AND all_tests_found.test_id in (70) ORDER BY upload_time DESC LIMIT 100"
mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, all_tests_found.test_id FROM upload, all_tests_found WHERE version LIKE '%R0%' and all_tests_found.id=upload.id AND all_tests_found.test_id in (75) ORDER BY upload_time DESC LIMIT 10"

mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, diskerrors, pcat_status, all_tests_found.test_id \
FROM upload, all_tests_found WHERE version LIKE '%R0%' and all_tests_found.id=upload.id AND all_tests_found.test_id in (50) ORDER BY upload_time DESC LIMIT 10"

mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, all_tests_found.test_id \
FROM upload, all_tests_found WHERE version LIKE '%R0%' and all_tests_found.id=upload.id AND all_tests_found.test_id in (50) ORDER BY upload_time DESC LIMIT 100"

// on mac
mysql --batch --table --column-names -u root uploads -e "SELECT version, upload_time, filename, all_tests_found.test_id \
FROM upload, all_tests_found WHERE mac='0019fbf2d46b' AND all_tests_found.id=upload.id ORDER BY upload_time DESC LIMIT 10"


<ex>
BSKYB   darwin_783e53f4a368_c8f60dd992bb8aa7dddc2cc2d2259c34.tgz        X038.002.21.00C eu-q-falconv2-it        HudsonR24B3     783e53f4a368    c8f60dd992bb8aa7dddc2cc2d2259c34        
  2016-09-14 10:23:00   <p0>No Snnn.CUR/Pnnn.CUR or equivalent .LOG files in log upload (built by hudson)</p0>   
  0                                       0       0       
  /home/si_logs/translation/darwin_783e53f4a368_c8f60dd992bb8aa7dddc2cc2d2259c34 http://theyard.cisco.com/si_logs/translation/darwin_783e53f4a368_c8f60dd992bb8aa7dddc2cc2d2259c34/index.html    
  0000-00-00 00:00:00     0000-00-00 00:00:00             0       0             78949490

BSKYB   darwin_783e53f46ce8_51fd4f16d4ad8619dafc62c1a208c0e0.tgz        Q000.010.46.00U eu-q-falconv2-uk                        783e53f46ce8    51fd4f16d4ad8619dafc62c1a208c0e0        
  2016-09-14 10:22:00   <p3>Tuner failed to lock (built by hudson)</p3>        
  1088.63                                 513     3       
  /home/si_logs/translation/darwin_783e53f46ce8_51fd4f16d4ad8619dafc62c1a208c0e0  http://theyard.cisco.com/si_logs/translation/darwin_783e53f46ce8_51fd4f16d4ad8619dafc62c1a208c0e0/index.html   
  2016-09-14 09:02:45     2016-09-14 09:20:14             0       0       713496685       78949489


// `select directory_name`
mysql --batch --skip-column-names -u root uploads -e "select directory_name  from upload where directory_name is not null and parser_result != 'Not Yet Parsed' order by upload_time desc limit 1000"
...
/home/si_logs/translation/darwin_783e53eb9bb0_303c159641cc331299e1fc89a20e3f92
/home/si_logs/translation/darwin_0019fb54a9eb_6ee84b2d05c8d8fc7b1aea742be63d96
/home/si_logs/translation/darwin_783e53ffd885_86413132ddf506ccb2d3264b0e8785ab
/home/si_logs/translation/darwin_783e53ffd3fd_ce7877cf7c67d5a2b526e7b4d1b02bfb


// `specify search`
mysql --batch --skip-column-names -u root uploads -e  "select directory_name from upload WHERE (version LIKE '%Q003%' OR version LIKE '%Q004%')"
mysql --batch --skip-column-names -u root uploads -e "select upload_time, diskerrors, boxname, directory_name, parser_result from upload where version LIKE '%R015%' and parser_result LIKE '%DBENGINE%' and directory_name is not null and parser_result != 'Not Yet Parsed' order by upload_time desc limit 10"
mysql -u root uploads --execute='select upload_time, version, parser_testid, parser_result, diskerrors from upload where mac in ("0019FB38E30A", "0019FB0F53B4", "0019FB515474", "0019FB8817BF", "0019FB 384838", "0019FB0F4CBC", "0019FBB71C47", "0019FBB71BB1") order by upload_time desc, version desc limit 10'
mysql --batch --skip-column-names -u root uploads -e "select upload_time, boxname, directory_name, parser_result from upload where mac LIKE '%0019fb42ddb6%' order by upload_time desc"
mysql --batch --skip-column-names -u root uploads -e "select upload_time, boxname, directory_name, parser_result from upload where mac='%0019fb42ddb6' order by upload_time desc"


// `with and without table`  --table
// note "from one, two where one and two"

$ mysql --batch --table --column-names -u root uploads -e "select version, upload_time, filename, all_tests_found.test_id from upload, all_tests_found where mac='0019FB0BAF44' and all_tests_found.id=upload.id order by upload_time desc limit 10"
+-----------------+---------------------+----------------------------------------------------------+---------+
| version         | upload_time         | filename                                                 | test_id |
+-----------------+---------------------+----------------------------------------------------------+---------+
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     113 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     410 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     358 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     546 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     119 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     438 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     287 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     170 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     122 |
| R000.040.39.00U | 2016-09-20 10:27:00 | darwin_0019fb0baf44_d7c0a121d1723b2ca1148c4729eceee5.tgz |     447 |
+-----------------+---------------------+----------------------------------------------------------+---------+


<ex>
To help with this I’ve written us a little SQL query.  I’ll turn it into a
script later, but for now you can run it from the command line on
theyard.uk.nds.com.

mysql -u root uploads --execute='SELECT COUNT(*) AS Frequency, test_id AS "Log Parser Test ID" FROM upload, all_tests_found WHERE filename IN ("darwin_0019fb603c3f_cabe232507beac9b3fdf11c49d5b8991.tgz", "darwin_0019fb0f4442_1e705274579e3cdb84e11d53249cbdec.tgz", "darwin_0019fb603bf0_59c01ab6a0a20ede0b58453679f3d724.tgz", "darwin_0019fbf2d46f_a5061f3173807d701c0cf05491a892f2.tgz", "darwin_0019fb0f52a5_e847eb9b1b9376f082a8240ab1d34deb.tgz") AND all_tests_found.id = upload.id GROUP BY test_id ORDER BY COUNT(*) DESC, test_id'

All you need to do is replace the tgz filenames.  You can have as many as you
like. When you run it, it will give you a table like this:

+-----------+--------------------+
| Frequency | Log Parser Test ID |
+-----------+--------------------+
|         5 |                122 |
|         5 |                546 |
|         4 |                106 |
|         4 |                119 |
|         4 |                170 |
|         4 |                199 |
|         4 |                358 |
|         4 |                468 |
|         3 |                 46 |
|         3 |                217 |
|         3 |                405 |
|         3 |                410 |
|         3 |                438 |
|         2 |                114 |
|         2 |                117 |
|         2 |                123 |
|         2 |                167 |
|         2 |                462 |
|         2 |                482 |
|         2 |                523 |
|         1 |                 45 |
|         1 |                 83 |
|         1 |                109 |
|         1 |                113 |
|         1 |                145 |
|         1 |                291 |
|         1 |                362 |
|         1 |                412 |
|         1 |                414 |
|         1 |                447 |
|         1 |                507 |
|         1 |                513 |
|         1 |                549 |
+-----------+--------------------+


={============================================================================
|kt_dev_si_0002| si-log-parser sh-test-log

http://hetty.cisco.com/fusionmadesimple/index.php/TEST_LOG

Assuming that works, book the test into git (git add <mytest>;git commit -m
'Why I added this test'). Then do 'gitrefresh' to push the test
everywhere. 

<2> 
check_log
518:    test_log.py $1
1358:    echo ">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> About to run test_log"
1360:    test_log.py $OUTLOGFILE 2>&1 | tee .test_out
1362:    echo ">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Finished running test_log"


<1> for a standalone run?
# run_log_parser

output='_analysis.txt';
OUTFILE=$name$output
cd $path
$WHERE/test_log $1 >> $OUTFILE

# expect to have .bestguess and .bgline from test_log

if [ -f .bestguess ]
then
echo "Best guess is `cat .bestguess` at line `cat .bgline`" >> $OUTFILE
fi


# test_log 
# $FILE should be 'LOGlastrun' or 'LOGlastrun.gz'

#!/bin/bash
test_log.py $FILE $FORCE

note:
.bestguess can be written by someone other than test_log.py from check_log?
`.test_out` has log from test_log

# test_log.py
#
# *1-simple-test*
# while: `while by section_size`
#
#   reads a log file by section_size, 100000 and make it a list
#   ingest_log_bit(log_file, section_size)
#
#   arg "-force_positive" makes run this checks if it comes out of standby:
#   check_positive_states(log_file)
#
#     if ("UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_OUT" in line) or ("FRAME_PRESENTED:" in line):
#       states_found = True
#
#   # starts with simple_test = None, simple_tests = [], found_failures = []  
#   # scan_testlist(log, best_so_far, line_start, all_so_far, optimise_search, failed_so_far):
#   # `found_failures` is to log found tests in this section.
#   simple_test = scan_testlist(log_list, simple_test, line_start, simple_tests, optimise_search, found_failures) 
#
#     simple_tests = get_testlist_cvs():
#       # reads `testlist.txt`, build a list and return it
#
#       # *parser-testlist-format*
#
#       # "\t" is delimeter. prio starts from 1(high)
#
#       # [0] id  [1] prio  [2] message                     [3] *text-to-search*                   [4]       [5] message                     [6] script name
#       # 2<tab>  1<tab>    Failed to lock semaphore<tab>   Failed to lock semaphore<tab>   None<tab> Failed to lock semaphore<tab>   None
#
#       # NOTE: the “text to search” should be empty if you've got a script.
#
#       # 18	
#       # 1	
#       # Engage17184/CQ381836 - VRM does not response to planner job request	
#       # Call to PLANNER_SRM_FindRMFJobFromVRMJob function failed	
#       # None	
#       # Engage17184/CQ381836 - VRM does not response to planner job request	
#       # None
#       
#       # run def get_override_list() to see if there are override priority
#       # from $FILE.cfg.
#
#     current_re = produce_whole_re(simple_tests, best_p_so_far, optimise_search, failed_so_far)
#       # skip a test id when "test text" is null
#       # skip a test id if in faild_so_far
#       # build a reg expr made up with `all` `text-to-search` from a list. 
#       `| text |text | ...`
#
#     for line in log:
#
#       if re.search(current_re, line):
#         # found a match in `this line` but which test case? so
#         best_p_so_far, message, test_id = which_test_failed(simple_tests, line, failed_so_far)
#           # for each test in simple_tests
#           #   try to find `highest` prio test matched and if found 1, return
#           #   immediately.
#           #   possible multiple matches but return highest(best)
#
#         # update lists
#         failed_so_far.append(test_id)
#         all_so_far.append((best_p_so_far, line_count, message, test_id))
#         `best_so_far` = (best_p_so_far, line_count, `message`, test_id)
#
#         # `reduce` test list by removing failed_so_far. 
#         # means picks `first occurance` and ignore ones afterwards.
#         current_re = produce_whole_re(simple_tests, int(best_p_so_far), optimise_search, failed_so_far)
#
#     return `best_so_far`
#
# # after all, gets `one highest` test if there is for a whole file.
# logging.info("Simple test found: " + str(simple_test) )
#
#
# *log-parser-run-script* on $FILE
# read testlist.txt and build a list made up with script and test id
#
# NOTE: the *text-to-search* should be empty if you've got a script.
#
# all_scripts = find_scripts_from_list()
#   # scripts_to_run.append((test[6], test[1], test[0]))
#
# script_tests = get_shellscripts( all_scripts )
#   # create a subprocess for each script in the list against `$FILE`
#   # parse the output from each script
#
#   # *script-output-format*
#   #
#   # fail case which is not shell convention. non-zero means failure.
#   # print "0 0" for python
#   # echo 0 for sh
#   #
#   # okay case(found) "line number message" format
#   # print str(lineNo) + " Player blocked"
#   # echo $L "Time:$X, $Y"
#   # echo 1
#
#   # pick first occurance
#   # A=`mycat $1 | grep -n "PC at exception" | head -1`
#
#   # 28:NDS: ^[2016:08:30 13:34:38]0946684934.243088 !INFO <...> config file: pdm_fs.cfg
#   # # line number
#   # L=`echo $A | cut -d':' -f1`
#   # # time 0946684934.243088
#   # X=`echo $A | cut -d'.' -f1 | cut -d'^' -f2`
#   # # mesg config file: pdm_fs.cfg
#   # Y=`echo $A | cut -d'>' -f2 | cut -d',' -f1`
#   # echo $L "Time:$X, $Y"
#   # exit 1
#
#   2016-09-05 10:49:54,482: root - DEBUG - Current script pcat_client_leak
#   2016-09-05 10:49:54,482: root - DEBUG - Output: ('1533776 Time:0946732403, Memory Leak in PCATC pool\n', '')

#   if test_output[0].split( )[0] != '0':
#   logging.debug("Test output: " + test_output[0].split( )[0])
#   bglist.append( ( priority, int(test_output[0].split( )[0] ), script_name, test_id ) )
#
#   note: Q. from .all_tests_found. WHY is it different from the script?
#   1 58 1533776 PCAT Client Memory Leak
#
#   return bglist
#
#
# after all, get a list of matched scripts
#
# print 'simple:', simple_tests
# print 'script:', script_tests
#
# *3-output*
#
# <all-tests-found>
# `.all_tests_found` is used to show detailed parser result in index.html
#
# output_all_finds(simple_tests, script_tests):
#   # writes out result to `.all_tests_found`
#   #
#   # *all_tests_found*
#   # $ cat .all_tests_found
#
#   # prio, test id, line, text
#
#   # 1 0 1 Core dump found in MW_Process
#   # 2 247 2730154 Indicates some sort of lockup in the system.
#   # 3 468 29538 Planner error when attempting to rebook missing series link
#   # 3 405 39804 MSM stalled - this could be temporary, but if frozen video observed this could be the reason.
#   # 3 358 2195659 Error receiving PAT section (SkyD: Hinweis 313)
#   # 3 287 2205210 This CAPROC semaphore failure was seen on many STBs with lockup issues.
#   # 3 362 2730081 MW is closing tschannel earlier than tpidfilter attached to tschannel.
#   # 4 438 8110 Client buffer full - Client is not reading data fast enough MHC sections during aquisition
#   # 5 46 24651 PTS errors - check whether this is causing video glitch
#   # 5 151 337718 User could not record a PDL event due to entitlement not being set on the card.
#   # 5 48 1455053 Missing SKEVT-A causing lack of PVOD recordings
#   # 5 410 2067850 May be related to: TV Guide is missing schedule data (NGDEV-20253)
#   # 2 462 1822573 33866 Message appearing too often (97048 times/2733860 lines): (NDS: ^0946689772.205164 !WARN   -MSM_MS                   < p:0x000001f2 P:MW t:0x018d3520 T:EVENT_MGR_THREAD M:transition_contro
#
#   # sort -n -k3 .all_tests_found | while read priority testid lineno text
#
# *4-pick-only-one*
#
# note:
# simple and script has the same priority since simple only have a priority.
#
# choose only one highest from either simple or script tests
# print 'Chosen test:', chosen_test
#
# priority = int(chosen_test[0])
#   if not need_positive or priority <= 2:
#     finalise_bg_files(chosen_test, is_script)
#       only when is_script is False, do create a .bestguess. means only for
#       simple tests
#
#       or for script tests
#
#       *run-verbose* which is why the final log parser result is different
#       from first script run.
#
#       run_verbose_shellscript(chosen_test)           
#       def run_verbose_shellscript(script_to_test):
#       """Given a script to test, runs it in verbose mode and passes the output to make the bestguess files"""
#
#       for both, do:
#
#       # .bestguess
#       create_bestguess(bestguess_text, int(chosen_test[0]))
#       # .bgline
#       create_bgline(bgline)
#       # .bgid
#       create_bgid(test_id)

note:
see `.test_out` for logging.

Chosen test: ('1', 1533776, 'pcat_client_leak', '58')


<py-tests-used-in-testlist-txt>

# search two lines in order
xtvfs_write_error2
play_block.py

kernel_oom.py
ADSMART_test_BDL_monitoring.py
ADSMART_test_time.py
ADSMART_test_wrong_PTS.py
memory_pool_increasing.py
kernel_oops.py
stack_overflow.py
yellowBanner.py
page_allocation_failure.py
check_bt_usb_disconnect.py
core_deleted.py
lanss_tcp_retransmissions.py
lanss_cpu_stats.py
software_download.py
pcat_fail_vlist_create.py
gapflood.py
sbm_queue_find_slow_nodes.py


# if cannot find it from the sky then look for it under theyard
cd /home/si_logs/mirrored/upload
ls -alt picassodigi*

# 890 case
darwin_001018001200_30c26f7d966c03ff4f850a19380182b4.tgz


# on the box
/mnt/nds/dev_2/part_0/BOOTLOG/*
/mnt/nds/dev_2/part_0/*


={============================================================================
|kt_dev_si_0002| si-log-parser-manual

https://hudkinsmaster1.cisco.com:8443/job/ServeDocs/lastSuccessfulBuild/artifact/Documentation/log_parsing/IWantToDecodeManually.html

newyard_fetch_diag.sh ams-drx890 41.88.00_3085_MNTEE


={============================================================================
|kt_dev_si_0002| si-log-parser-entry

{testlist}
http://theyard.cisco.com/cgi-bin/test_list.sh

# [0] id  [1] prio  [2] message                     [3] *text-to-search*                   [4]       [5] message                     [6] script name

http://theyard.uk.nds.com/logparseradmin/admin/logparser/test/
http://theyard.uk.nds.com/logparseradmin/admin/logparser/test/442/

/home/kyoupark/si_logs/sbin/tests


<log-parser-core>
// line # in the result page is not relavant
check_log::handle_core()


<log-parser-2>
2	
  "SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)" message from EPG.Example: NDS: ^[2014:08:17 17:05:52]0946730023.344540 !ERROR  -EPG_ME       < p:0x000001d0 P:APP t:0x2bbab520 T:no name M:SatelliteSignalGainedLostHandler F:handlePlayerEventComponentFail L:214 > T:PooledExecutor#0:SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)	
  SOMETHING TIMEDOUT		
  "SOMETHING TIMEDOUT" message from EPG (NSS/TF code 30): PLAYER timeout on media selection. Check VRM/MCM/MDM.	

!ERROR  -EPG_ME                      < M:SatelliteSignalGainedLostHandler F:handlePlayerEventComponentFail L:229 > T:PooledExecutor#2:SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)

*comp-mcm*
// may see this as well
!WARN   -MCM                         < T:SYSTEMALARM_MAIN M:mcm_mediaconn_event.c F:MCM_Mediaconn_AsyncResponseTimeoutCallback L:1619 > hMC=0x5b Response from device manager expected but not received after 7 seconds


note:
Timeout for 10 secs and looks valid. See *player-something-timeout*


<247>
247	2	This indicates some sort of lockup. Here Planner calls SBM which in-turn calls RMF, but no reply is received at planner.	planner_disk.c F:PLANNER_Disk_GetQuotaStatusFromSBM.*Wait timeout	SI-7792	Indicates some sort of lockup in the system.		Vinay Acharya	2013-08-09		None

!ERROR  -PLANNER < M:planner_disk.c F:PLANNER_Disk_GetQuotaStatusFromSBM L:385 > Wait timeout

if(PLANNER_Cond_TimedWaitRel(&(l_payload->data.sbm_quota_status.cond), 10) !=  PLANNER_API_STATUS_OK)
{
  DIAG_LOG_ERROR(g_planner_diag_segment_id, ("Wait timeout"));
}

note:
Waits for 10 secs and looks valid

<157>
157	2	

Planner pool OOM issue happened only once in R3 Trail after 4 days of
continuous usage of STB and ended up in empty planner pool in 4th day(slow
leak within 4 hours). PCAT has allocated memory for value list to send
notification data and notification should be handled by planner and free those
memory allocated for value lists. Planner will be deleting the PCAT value
lists when planner have processed the notifications. 

We suspect that the main planner thread is blocked for some reason, so the
notifications are not being handled and are building up - however no evidence
of this, or any other suspicious Planner errors in the log. 

Planner ever does not wait for Picasso to do anything either.
We(Planner/PCAT/SI team) are not very sure how we can proceed with this until
we have reproducible scenario.	

VL hdl=0x.*allocated but not freed for view PLANNER.*flags=0, ObType=0, num_rows=	
SI-5559	
Losing Planner Pool Handles SI-5559	


<462>
462	2	Single message occupying too much of the log			A single message is flooding the log file	single_message_flooding

705549 Message appearing too often

single_message_flooding

note:
runs on raw LOG and use -v


<tid-322>
322	3	Download of Secondary Asset is skipped in DPL Asset.Reason can be 1. PA PID not found in SA2. There is mismatch of Audio Type in PA and SA.3. SA having less PID than PA.
The current asset has to be skipped*		Download of Secondary Asset is skipped in DPL Asset.	


<342>
342	2	Planner has detected that an excessive number of Planner booked programme handles is being used. Often this indicates that there is a leak of Planner booked programme handles in the EPG.	booked programme handles in use in session		Excessive number of Planner booked programme handles	

NDS: ^[2016:09:04 21:07:36]0946710163.172216 !WARN   -PLANNER                   < p:0x0000020e P:APP t:0x2df8b520 T:no name M:planner_bookedprogramme_management.c 
  F:PLANNER_BookedProgramme_NoteCreation L:268 > 50 booked programme handles in use in session 0x4:


<468>
468 3       AS error when attempting to rebook missing series link  F:PLANNER_ListElement_UnravelData.*Booking.*not found   NGDEV-39050     Planner error when attempting to rebook missing series link

NDS: ^[2016:09:20 10:26:24]0946688450.689724 !WARN   -PLANNER      		< p:0x0000019c P:APP t:0x01500520 T:PLANNER_CB4 M:planner_list_element.c 
  F:PLANNER_ListElement_UnravelData L:691 > Booking 0x290037D8 not found 


<tid-444>
444	2	Ad viewing Report buffer is full and can cause system to become unresponsive. In SI-9703, this issue was seen when Manifest campaign update was being processed when large number of assets are marked for deletion.
Ads report buff is full - drop Ad report container	SI-9703	Ad viewing Report buffer is full, can cause system to become unresponsive. Refer SI-9703	


107749:NDS: ^[2016:10:01 13:01:01]0946714482.363655 !WARN   -ATM                        < p:0x000001d6 P:MW t:0x01cbc520 T:VRM_SRV M:campman.c F:CAMPMAN_ViewingReport L:372 
> Ads report buff is full - drop Ad report container
>

<<tid-59>
59	1	P1 db_corrupt: Robert Kibble, 11/06/2010 Check for a variety of fatal DBENGINE errors indicating a corrupt database. These are still under investigation as intermittent - 
possibly XTVFS errors.			P1 db_corrupt: Robert Kibble, 11/06/2010 Check for a variety of fatal DBENGINE errors indicating a corrupt database. These are still under investigation as intermittent - possibly XTVFS errors.	
`db_corrupt`

theyard/bin/tests/db_corrupt

note:
<p1>DBENGINE fatal error: status = 0x202000a [PCAT.DB corrupt], PCAT.DB is corrupted (built by hudson)</p1>
<p1>DBENGINE fatal error:  status = 0x203000b  [MFS.DB corrupt]</p1>

Greps on two different issue

!FATAL  -DBENGINE_SRV              < p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:dbengine_api.c F:DBENGINE_API_GetErrcode__ L:1612 > status = 0x203000b

mycat $1 | grep -n "DBENGINE_SRV" 2>/dev/null | grep -Ei 'status = 0x202000a|status = 0x203000b|OUT OF MEMORY|status = 0x2020007' 2>/dev/null | head -1

2016-08-20 04:15:52,254: root - DEBUG - Current script db_corrupt
2016-08-20 04:15:52,254: root - DEBUG - Output: ('2703 Time:0946684974,  status = 0x203000b\n', '')

From *run-verbose*

if [ "$1" = "-v" ]
then
    FIRST=`mycat $2 | grep -n "VACUUM operation has failed with errmsg = out of memory.Ignore it" 2>/dev/null | head -1 | cut -d':' -f1`
    if [ "$FIRST" = "" ]
    then
        FIRST=0
    fi
    A=`find_first_match $2 | cut -d'>' -f2`
    WHICH=""
    for file in *.DB
    do
        if [ -f $file ]
        then
            # check file depending on return from `dbcheck`
            dbcheck $file >/dev/null 2>&1 || WHICH="[$file corrupt]"
        fi
    done
    echo "DBENGINE fatal error: $A $WHICH"
    exit 1
fi

# dbcheck, runs check and if it returns fail, return is back

X=`sqlite3 $1 "pragma integrity_check" 2>&1`
A=$?    # this is exit status

# this seems that there is case when it returns this which is okay.
if [ "$X" = "Error: no such collation sequence: DEUTCH" ]
then
    echo "ok"
    exit 0
fi

echo "$X"
if [ $A -eq 0 ]
then
    if [ "$X" != "ok" ]
    then
        A=1
    fi
fi
exit $A


<tid-96>
96	2	P2 sata_errors: Robert Kibble, 28/10/2010 Look for errors from SATA in KMSG.LOG Often caused by disk failure and/or garbage 
collection errors		SI-6572	P2 sata_errors: Robert Kibble, 28/10/2010 Look for errors from SATA in KMSG.LOG Often caused by disk failure and/or garbage collection errors	
`sata_errors`

theyard/bin/tests/sata_errors

A=`cat $K | grep -E 'end_request: I/O error|ata1: exception Emask |(device error)' | grep sda | head -1`

$ egrep "O error" KMSG.LOG
<4>[0946684879.477503]end_request: I/O error, dev sda, sector 3205540

180:<4>[0946685142.902134]end_request: I/O error, dev sda, sector 343620

181:<3>[0946685142.902134]Buffer I/O error on device sda1, logical block 343556


<tid-54> use script
54      1       P1 affirm: Robert Kibble, 24/06/2011 Check for "AFFIRM!!!" in Picasso builds    None    None    P1 affirm: Robert Kibble, 24/06/2011 Check for "AFFIRM!!!" in Picasso builds    
affirm


<tid-10>

!WARN   -SYSINIT_S                 < p:0x000001dd P:SCD t:0x00647530 T:STATE_MACHINE_THREAD M:state_machine.c F:stateMachineThread L:1402 > PVR transition failed at ring level 6


<tid-53> driver-lock see <ms-watchdog>
tests/driver_lock

Looks for time diff which > 5 digits.

53	1	P1 driver_lock: Robert Kibble, 21/05/2010 Look for an MS_WATCHDOG message involving the CDI_WT time diff field where the value is at least 100000 ms (i.e. 100 seconds).
driver_lock

<tid-50>
[si_logs@theyard tests]$ more utilsem_wait
A=`mycat $2 | grep "SemWait() Failed" 2>/dev/null | head -1 | cut -d'<' -f2 | cut -d: -f6 | cut -d' ' -f1`

9791757:NDS: ^[2017:05:21 14:18:01]0946884257.762331 !WARN   -MCM                       < p:0x00000206 P:MW t:0x01d54520 T:VRM_SRV M:mcm_media_connection.c F:MCSemWait L:1215 > sem failed, status = 0x11c2100d
9791758:NDS: ^[2017:05:21 14:18:01]0946884257.762350 !ERROR  -MCM                       < p:0x00000206 P:MW t:0x01d54520 T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:689 > hMC=0xaa SYSTEMUTIL_SYNC_SemWait() Failed

P1	50	9791758	2017:05:21 14:18:01	SemWait() returned error in mcm_mediaconn.c


<tid-117> driver_veryshortlock

grep -v 'at time 0' 2>/dev/null |
grep -vE "time diff = [0-4][0-9][0-9]," 2>/dev/null | head -1`

117	4	P4 driver_veryshortlock: 
This is identical to driver lock in P1, but is for 0.5 seconds, which should no longer occur, as of driver fix.  Currently being investigated by Smitha. XXXX - COMMENT
driver_veryshortlock

<tid-113> note: this reports wrong line

grep -v 'at time 0' 2>/dev/null |
grep -vE "time diff = [0-9][0-9][0-9]," 2>/dev/null |
grep -vE "time diff = [0-1][0-9][0-9][0-9]," 2>/dev/null | head -1`


<tid-556>
556	2	MID-6812: Blue screen failures while stopping Substitution job	
Injection Completed event should be ignored as item switch was already triggered by an API call
MID-6812	MID-6812: Blue screen failures while stopping Substitution job	

!WARN   -MSM_MS < T:EVENT_MGR_THREAD M:splicer.cpp F:(HandleInjectionCompleteEvent) L:1358 > <  >" "Injection Completed event should be ignored as item switch was already triggered by an API call[1]
!WARN   -MSM_MS < T:EVENT_MGR_THREAD M:splicer.cpp F:(HandleInjectionCompleteEvent) L:1358 > <  >" "Injection Completed event should be ignored as item switch was already triggered by an API call[1]


<tid-699>
526:699 2       Planner errors for failing to compare strings of event names due to SYSTEMSTRING_GetByteLength() error. PLANNER_PRV_CompareSystemString.*Unable to compare strings due to SYSTEMSTRING_GetByteLength.*error    STR-9345        Recording failures due to Planner errors for failing to compare strings of event names.


<653>
http://theyard.uk.nds.com/logparseradmin/admin/logparser/test/653/


<parser-771> *comp-mcm*
python ~/si_logs/sbin/tests/mcm_timeout.py -v LOGlastrun_realtime_2481
mcm_timeout.py


!WARN   -MCM          		< p:0x00000210 P:MW t:0x0183e520 T:SYSTEMALARM_MAIN M:mcm_mediaconn_event.c F:MCM_Mediaconn_AsyncResponseTimeoutCallback L:1770 > hMC=0x4b Response from device manager expected but not received after 7 seconds 
!WARN   -MCM          		< p:0x00000210 P:MW t:0x01dac520 T:MCM_ITCMAIN_THREAD M:mcm_mediaconn_event.c F:MCM_Mediaconn_CancelAsyncResponseTimeoutAlarm L:1865 > hMC=0x4b Response from device manager received (after timeout) 

this script do not return the line number of first MC which shows the problem.

this script does add MC into a dic when see "expected" and del matching MC
when see "received". So the dict would have MCs which don't get received
message and this script would return the line of first entry of the dict whcih
is the fist MC. 

However, when see many "expected" for the same MC but no "received" and would
return the line number of last occurance since the scipts keep inserting the
entry into the dict.

* when see "expected", read two more line and gets activity. add {mc, {line, activity}}

5450818:NDS: ^[2017:10:22 05:33:02]0947092447.434188 !WARN   -MCM                       < p:0x000001f9 P:MW t:0x01b58520 T:SYSTEMALARM_MAIN M:mcm_mediaconn_event.c F:MCM_Mediaconn_AsyncResponseTimeoutCallback L:1670 > 
hMC=0xe5e7 Response from device manager expected but not received after 7 seconds

5450819-NDS: ^[2017:10:22 05:33:02]0947092447.434284 !WARN   -MCM                       < p:0x000001f9 P:MW t:0x01b58520 T:SYSTEMALARM_MAIN M:mcm_mediaconn_event.c F:MCM_Mediaconn_StateDebug L:1632 > 
1678 hMC=0xe5e7 MCM_MEDIACONN_TYPE_LIVE (0x7000002) STATE_PREPARING SYSTEM_EXCEPTION_TYPE_NO_EXCEPTION (0x10000102 : 0x64) PREPARING_VRM_UPDT_SCI [VRM] (0x16) ITC_EV_??? (00000000) (DM ??? (00) Activity 0) (0x0) re try_count 3 is_retrying 0 event_flag 0x00020007 mcm_wait_flags 0x00000008

* when print a map

[e5e7] = 5450818,PREPARING_VRM_UPDT_SCI [VRM]
[118a6] = 11189610,PREPARING_VRM_UPDT_SCI [VRM]
[118a6] = 11190501,PREPARING_VRM_UPDT_SCI [VRM]
[118a6] = 11190963,PREPARING_VRM_UPDT_SCI [VRM]
OrderedDict([('e5e7', (5450818, 'PREPARING_VRM_UPDT_SCI [VRM] ')), ('118a6', (11190963, 'PREPARING_VRM_UPDT_SCI [VRM] '))])
Response not received from PREPARING_VRM_UPDT_SCI [VRM] to MCM

* when use -v, return a string using an activity found first


{all-benigh}
P4	217	1		Memory pools growing: CAK:DRMM_MEMORY_POOL APP:STBE_POOL MWS:MW_HTTP_POOL APP:ADPT_PLANNER
P5	123	1		PVOD not recorded within 24 hours
P4	546	2829	2016:09:28 08:10:34	Filling time took 838s
P3	291	7161	2016:09:28 08:13:48	Response not received from PREPARING_SIM_MONI_SEI [SIM] to MCM
P4	438	7889	2016:09:28 08:18:56	Client buffer full - Client is not reading data fast enough MHC sections during aquisition
P3	109	8080	2016:09:28 08:20:18	Demux Output buffer overflow detected - (17532) - may lead to TF7

P4	117	8099	2016:09:28 08:20:19	Driver lockup E_MS_PORT_THREAD_TYPE_CDI_WT (17068/17145/17147) - E_REQUEST_TYPE_STOP_OUTPUT at time 1793294853, " "time diff = 570, " "halt value 500
// driver_lock
// 36:echo "Driver lockup E_MS_PORT_THREAD_TYPE_CDI_WT (17068/17145/17147) - $V"

P5	119	9417	2016:09:28 08:26:41	Signal quality/strength has become very poor
P5	122	9473	2016:09:28 08:26:42	RMF_ET in RMF_Server - Possible conflict issue if near time of problem.
P5	46	13580	2016:09:28 08:29:15	PTS errors - check whether this is causing video glitch
P5	410	22175	2016:09:28 09:06:54	May be related to: TV Guide is missing schedule data (NGDEV-20253)
P3	468	22936	2016:09:28 09:08:16	Planner error when attempting to rebook missing series link
P4	447	34568	2016:09:28 09:43:00	Problem with getting network information from NCM - null IP addresses
P3	405	36903	2016:09:28 09:58:39	MSM stalled - this could be temporary, but if frozen video observed this could be the reason.

P4	113	75069	2016:09:28 13:20:36	Driver lockup - generic watchdog taking >2s (17068/17145/17147) - E_REQUEST_TYPE_DEMUX_OUTPUT_RELEASE_CHUNK at time 1811312171, " "time diff = 2, " "warn value 100
// 113	4	P4 driver_shortlock: Robert Kibble, 04/06/2010 Look for an MS_WATCHDOG message involving the CDI_WT time diff field where the value is at least 100000 ms (i.e. 100 seconds).  That is far higher than any legitimate wait in the drivers should be, so as soon as this happens it implies a hang in the drivers. Engage issues 17068, 17145 and 17147 were different varieties of this. This is identical to driver lock in P1, but is for 2 seconds, which should no longer occur, as of driver fix.  Currently being investigated by Smitha.	None	None	P4 driver_shortlock: Robert Kibble, 04/06/2010 Look for an MS_WATCHDOG message involving the CDI_WT time diff field where the value is at least 100000 ms (i.e. 100 seconds).  That is far higher than any legitimate wait in the drivers should be, so as soon as this happens it implies a hang in the drivers. Engage issues 17068, 17145 and 17147 were different varieties of this. This is identical to driver lock in P1, but is for 2 seconds, which should no longer occur, as of driver fix.  Currently being investigated by Smitha.	driver_shortlock

P3	358	176576	2016:09:28 22:56:01	Error receiving PAT section (SkyD: Hinweis 313)
P4	523	192954	2016:09:29 01:10:04	Software download seen
P4	106	310149	2016:09:29 16:43:08	E_FSSERVER_REQUEST taking >500ms - could be bad disk (26632)
P3	199	429075	2016:09:30 00:14:01	Poll error fd resulting in a lock-up.
P3	539	567434	2016:09:30 07:43:05	Playout descriptor length failure for campaign which causes manifest failure
P3	540	567437	2016:09:30 07:43:05	Manifest processing failed
P3	549	622048	2016:09:30 16:33:12	User-pressed 444 - indication of user-trial fault.
P4	481	637578	2016:09:30 17:29:15	DNS failed to respond after 3.5s and there is no address to reuse (is the box sluggish?)
P4	482	666928	2016:09:30 18:32:21	Re-using old IP address as DNS quick response timeout expired
P3	167	769918	2016:10:01 03:20:28	VRM shows this warning when user makes booking 2 seconds before the event ends. Planner shows failed recording with TF 10.
P3	170	815343	2016:10:01 04:55:40	815343 number of errors[277], look in ADSMART_test_BDL_monitoring.log for more information. in LOGlastrun.log.gz line #815343 test finds BDL's that started the download flow, started with asset request but didn't reach recording asset end. found error in [{[] [d-rec-asset-end] [None] #[29047790]}] state[state_illegal]


={============================================================================
|kt_dev_si_0002| si-sh-log-parser-mine

<f>
i2c_errors

#!/usr/bin/env python
import sys, gzip, os
#
# This script is trying to find a situation where shows unresponsive box and I2C
# errors from driver and which are: 
#
# DRV: ^[2016:08:22 04:54:59]0946738246.285778 KERN_WARNING !!!Error BREG_I2C_Read(hHDMI->hI2cRegHandle, \ 
#   0x3A, 0x41, (uint8_t *) &Status, 2)(0x110001) at \
#   //home/masterci/workspace/AMS_DRX890_R11/cdisource/trunk/build/ams-drx890/source//magnum/magnum7335/portinginterface/hdm/7335/bhdm_hdcp.c:2162
#
# > T:PooledExecutor#2:SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)
#

def processFile (fileName):
    WAIT_FOR_I2C = 0
    WAIT_FOR_TIMEOUT = 1
    FOUND_ERROR = 2
    if fileName.endswith('gz'):
        fp = gzip.open(fileName, 'r')
    else:
        fp = open (fileName, 'r')
    status = WAIT_FOR_I2C
    lineNo = 1
    errorLineNo = 0
    for line in fp:
        if status == WAIT_FOR_I2C:
            if -1 != line.find ("Error BREG_I2C_Read"):
                status = WAIT_FOR_TIMEOUT
        else:
            if -1 != line.find ("SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)"):
                status = FOUND_ERROR
                errorLineNo = lineNo
                break
        lineNo += 1

    if status == FOUND_ERROR:                   
        return errorLineNo 
    else:
        return -1

def processFolder (folder, fileName):
    lineNo = -1
    fileName = os.path.join (folder, fileName)

    if os.path.isfile (fileName):
        lineNo = processFile (fileName)

    return lineNo

if __name__ == "__main__":
    if len(sys.argv) > 1 and sys.argv[1] == '-v':
        verbose = True
        fileName=sys.argv[2]
        print 'Unresponsive box due to I2C errors @SI-10757.'
        sys.exit(0)
    else:
        verbose = False
        fileName=sys.argv[1]

    lineNo = processFolder (".", fileName)
    if lineNo == -1:
        print "0 0"
        sys.exit (0)
    else:
        print str(lineNo) + " Unresponsive box due to I2C errors @SI-10757."
        sys.exit (1)


<tid-590>
db_journal_check.sh

## P3
## db_journal_check: 19/10/2016
## Check for a result of PCAT journal rollback.

if [ "$1" = "-v" ]
then
  head -c 10 PCAT.DBJ 2>/dev/null | tr -d '\0' | read -n 1
  A=$?
  if [ $A -eq 1 ]
  then
    echo "PCAT journal rollback is recovered"
    exit 0
  fi
  echo "PCAT journal rollback is not recovered"
  exit 1
fi

head -c 10 PCAT.DBJ 2>/dev/null | tr -d '\0' | read -n 1
A=$?


# `when read fails which means $? is 1` 
# read fails since there is no input and it means DBJ has null bytes which
# means recovered. This covers when there is no DBJ file.
# can check with hexdump -n

if [ $A -eq 1 ]
then
echo 0
exit 0
fi

# read okay which means not recovered.
echo 1
exit 1

# when used PCAT.DBJ which has first null bytes
$ ./db_check_journal.sh
0
$ ./db_check_journal.sh -c
0

# when used PCAT.DB which don't have first null bytes
$ ./db_check_journal.sh -v
$ cp PCAT.DB PCAT.DBJ
$ ./db_check_journal.sh -v
PCAT journal rollback is not recovered

# when there is no file
$ rm PCAT.DBJ
$ ./db_check_journal.sh
0
$ ./db_check_journal.sh -v
$


={============================================================================
|kt_dev_si_0002| si-sh-to-dates si-keycodes

<keycode>
/home/kyoupark/si-logs/theyard/bin/bskyb_charcodes


<to-dates>
Readable Any Date

to_dates converts any possible timestamp into a date format.

Usage guide: cat something | to_dates

Example usage:

tail -1 LOGlastrun | to_dates 

NDS: ^[16:28:22]0946744102.035999 ...

To save this to a file, just do

cat LOGlastrun | to_dates > LOG.converted

It is also possible to convert the file "in place":

to_dates LOGlastrun

Additionally, if the time desired is the actual time from the stream, rather than the time related to the box's last boot-time, it is possible to use

to_dates -real LOGlastrun

This uses the first SYSTEMTIME message "Time has been updated to" as callibration, and amends all times relative to that, e.g.

-
NDS: ^[18:21:16]0946685685.229684 !MIL   -SYSTEMTIME   < p:00000064 t:2aeb4830 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD 
 M:systemtime.c F:SYSTEMTIME_SetTime L:00911 > Time has been updated to 18:21:16
NDS: ^[18:21:23]0946685692.827540 !MIL   -aem          < p:00000065 t:010d3c40 T:AEM_INPUT_MONITOR_THREAD 
 M:aem_userinput.c F:AEM_InputMonitorThread L:00429 > KEY_PRESS: code=0x(INFO)e00e
-

={============================================================================
|kt_dev_si_0002| si-sh-alog

# ALOG
key_parser.py


={============================================================================
|kt_dev_si_0002| si-sh-list-log

http://hetty.cisco.com/fusionmadesimple/index.php/MySecondCheckLog

Find a log file given a MAC address

With what you've got, type list_log <what-I've-got>, e.g.

list_log 0019fb0f4471

...
Feb 7 21:10     7329041 SalimEsmailjee  darwin_0019fb0f4471_cb3def20493a8ceee8ec9ad35569bc5a.tgz
Feb 10 17:06    1922793 SalimEsmailjee  darwin_0019fb0f4471_d3aaf5d9876971aefd3dbbf2c13ce2ee.tgz
Feb 17 19:09    2293143 SalimEsmailjee  darwin_0019fb0f4471_5a610fb09c64b2f3c5be6dd693df70a8.tgz
Feb 18 00:17    759514  SalimEsmailjee  darwin_0019fb0f4471_e911603a22f3a5e875f389dd3de82051.tgz

That shows you a series of log files available, by date. In this case there is
also a name, because we know whose box this is.

After this, select the file you want, and then refer to MyFirstCheckLog for
how to decrypt that. 


={============================================================================
|kt_dev_si_0002| si-sh-convert-logs

http://hetty.cisco.com/fusionmadesimple/index.php/FTPUploadOMatic

If you get a FSN_DATA directory by email, you can easily convert the binary
logs to textual logs like so:

diag <platform> <version>

e.g.:

diag thom 30.11

Once you have a log file, you can analyse it with test_log:

test_log LOG


={============================================================================
|kt_dev_si_0002| si-sh-get-logs


={============================================================================
|kt_dev_si_0002| si-sh-wombat

Search through all uploads, with extensive filtering options to find only the
uploads you want. Basically a simplified way of running grep on the logs
uploaded. 

<file>
theyard/public_html/cgibin/Generate_WOMBAT.sh

* Translate cgi string to options based on:

usage ()
{
    set +x
    output_logging
    output_logging "####################################################################"
    output_logging "Usage: $(basename $0) [-p path] [-m message] [-n num_logs|-a]"
    output_logging "                      [-s stream] [-h H/W Platform] [-b baseline] "
    output_logging "                      [-P Priority] [-e error] "
    output_logging
    output_logging "Optional arguments:"
    output_logging "  -h, --help  - Show this help text."
    output_logging "  -p path     - Path to translated logs (default: /home/si_logs/translation)"
    output_logging "  -m message  - Addition to the title"
    output_logging "  -n num_logs - number of most recent logs to parse."
    output_logging "  -a          - parse all logs present"
    output_logging "  -s stream   - Stream to select logs for"
    output_logging "  -H H/W plat - Hardware platform to select logs for"
    output_logging "  -b baseline - Baseline to select logs for"
    output_logging "  -P priority - Priority to select logs for (eg. 1, 2, 3, 4, 5 - but only select one)"
    output_logging "  -e error    - Error message to select logs for"
    output_logging "  -M mac      - MAC address to select logs for"
#    output_logging "  -D date     - Max Date of logs (format: YYYY:MM:DD)"
#    output_logging "  -d date     - Min Date of logs (format: YYYY:MM:DD)"
    output_logging "####################################################################"
    output_logging
}

* Can be run from cgi or command line.

* main is.

  parse_cgibin_query # sets up $FLAGS
  parse_args $FLAGS  # calls add_filter_to_globals depending on options
                     # add_filter_to_globals # add args to FILTERS
                     # don't seem to use FILTERS

  # build `query` string
  generate_sql_filter_options

  <error>
  # seems that only looks for `parser_result` for error string.

    then
        RE=``echo "$REQUESTED_ERROR" | python -c 'import sys,urllib, cgi;print urllib.unquote(cgi.escape(sys.stdin.read().strip()))' | sed -e"s/'/_/g"``
        WHERE_CLAUSE="$WHERE_CLAUSE AND parser_result like '%$RE%'"
        RAW_WHERE=0
    fi

  # calls run_sql whcih calls mysql. means to use DB?
  find_sql_filter_options

  # build `query` string and run
  # run_sql "$QUERY" | sed -e 's/	/|/g' | while read line
  output_log_rows_for_files


# db name
WOMBAT_DBNAME=uploads


<ex> 
// to set params
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?STREAM=&BASELINE=&PRIORITY=&LOGS=100&ERROR=

// decoded string: <p1>Player VTable ref leak found, might cause serious errors once ref count is wrapped around (built by hudson)</p1>
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?STREAM=R014&PLATFORM=drx890&PRIORITY=1&ERROR=%3Cp1%3EPlayer%20VTable%20ref%20leak%20found%2C%20might%20cause%20serious%20errors%20once%20ref%20count%20is%20wrapped%20around%20%28built%20by%20hudson%29%3C/p1%3E&INTERVAL=3%20month&MACLIST=&LOGS=999999

// Out of memory in " "MW_HTTP_POOL" pool
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?STREAM=R015&PLATFORM=drx890&PRIORITY=1&ERROR=SOMETHING%20TIMEDOUT&INTERVAL=3%20month&MACLIST=&LOGS=999999
http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?STREAM=R015&PLATFORM=drx890&PRIORITY=1&ERROR=systemobject&INTERVAL=3%20month&MACLIST=&LOGS=999999

http://theyard.cisco.com/cgi-bin/Generate_WOMBAT.sh?MAC=0019FB63D645&ERROR=Tuner%20failed&LOGS=999999


={============================================================================
|kt_dev_si_0002| si-flipper si-manatee

https://hudkinsgit.cisco.com/rodolgon/manatee

// http://hetty.cisco.com/fusionmadesimple/index.php/Flipper_SI_scripts
// 
// git clone ssh://wwwin-git-gpk-2.cisco.com:29418/ETHAN_SI_SCRIPTS -b main_branch ETHAN_SI_SCRIPTS_TWO
// 
// /ETHAN_SI_SCRIPTS_TWO/manatee is the same as:
// git clone git@hudkinsgit.cisco.com:rodolgon/manatee.git
// 
// 
// `/ETHAN_SI_SCRIPTS/scripts/common`$ ll *.py
// -rwxr-xr-x 1 kyoupark kyoupark    97 Aug  7 08:27 cmdLine.py*
// -rwxr-xr-x 1 kyoupark kyoupark 31431 Aug  7 08:27 Diag.py*
// 
// # run a given cmd using subprocess
// -rwxr-xr-x 1 kyoupark kyoupark  1476 Aug  7 08:27 ExecuteCommand.py*
// 
// -rwxr-xr-x 1 kyoupark kyoupark  9016 Aug  7 08:27 functionalTestResults.py*
// -rwxr-xr-x 1 kyoupark kyoupark  3785 Aug  7 08:27 FusionConfig.py*
// 
// # has GitClass to provide git commands
// # has class BranchInfo (object):
// # has class BranchManagement (object):
// # has class LoadRules (object):
// 
// -rwxr-xr-x 1 kyoupark kyoupark 51675 Aug  7 08:27 GitClass.py*
// -rw-r--r-- 1 kyoupark kyoupark     0 Aug  7 08:27 __init__.py
// -rwxr-xr-x 1 kyoupark kyoupark 12094 Aug  7 08:27 JenkinsJob.py*
// -rwxr-xr-x 1 kyoupark kyoupark 17103 Aug  7 08:27 JobFileProcessor.py*
// -rwxr-xr-x 1 kyoupark kyoupark 16910 Aug  7 08:27 SkyComponents.py*
// -rwxr-xr-x 1 kyoupark kyoupark  4681 Aug  7 08:27 ThirdPartyComp.py*
// -rw-r--r-- 1 kyoupark kyoupark  4777 Aug  7 08:27 Version.py
// 
// 
// /ETHAN_SI_SCRIPTS/scripts/flipper/*.py:

{py-listtag}
note: standalone script? not used anywhere?

listTags.py Listing the existing tags in one branch

* BM has all branch details in a dict.
* BM in `ETHAN_SI_SCRIPTS/scripts/common/GitClass.py`
* BM.listBranches() is simply to look in the dict(nested dict) to show branch name.

    # a nested dict with {branchname, {repo, branch, pattern}}.
    AVAILABLE_BRANCHES = {
	   "HR014": {'repo' : "ssh://wwwin-git-gpk-2.cisco.com:29418/STB_SW",
            'branch' : 'BSKYB_HR014_Int',
            'pattern' : 'refs/tags/BSKYB_HR014_Int/BSKYB_INTEGRATION_BLD_[0-9][0-9].[0-9][0-9].[0-9][0-9]_BSKYB_HR014_Int' }
        },

    DRIVER_BRANCHES = {
        "ams-drx890": {'repo':"ssh://wwwin-git-gpk-2.cisco.com:29418/platforms/AMS_BCM_MIPS4K_LNUX_DARWIN_01",
            'branch' : "AMS_BCM_MIPS4K_LNUX_DARWIN_01",
            'pattern' : 'AMS_BCM_MIPS4K_LNUX_DARWIN_01_*',
            'submodule' : 'AMS_BCM_MIPS4K_LNUX_DARWIN_01',
            'type':'darwin'},

  BM.listBranches ():
    for key in BranchManagement.AVAILABLE_BRANCHES:

* BM.listTags (args.tags, args.maxNum):

    tags = self.getListOfTags (branch, number)

      GC = GitClass (self._logger)
      tagList = GC.getListOfTags (BranchManagement.AVAILABLE_BRANCHES [branch]['repo'],
                    BranchManagement.AVAILABLE_BRANCHES [branch]['pattern'], number)

        cmd = ['git', 'ls-remote', '--tags', repo]

        logger.debug ('executeCommand: ' + str(cmd))

// ls-remote output:
fd50131012c5a1b81aabec38e805844946f1ffe4	refs/tags/ADSMART102_CI/D88.0.38.0-master
8213e5feacb24269038f2a967b36bf3d1818d378	refs/tags/ADSMART102_CI/D88.0.38.0-master^{}
61c8416b0a8892791ee840ec6a1b739540d3f591	refs/tags/ADSMART102_CI/D88.0.38.1-master
8213e5feacb24269038f2a967b36bf3d1818d378	refs/tags/ADSMART102_CI/D88.0.38.1-master^{}
21c2b145e02960764d252433f85cd0f91e4aebe2	refs/tags/ADSMART102_CI/D88.0.38.2-master
0cd4b4c654f3fd28a64b065c011e125cef968368	refs/tags/ADSMART102_CI/D88.0.38.2-master^{}
cd81d6681624bea82ad80d8b43e5d814e356f08a	refs/tags/ADSMART102_CI/D88.0.38.3-master
2693ca979382a4067b86b30758d81a22f03c3d42	refs/tags/ADSMART102_CI/D88.0.38.3-master^{}
fb7069df9ae391887e5a3903e295062c0921a723	refs/tags/ADSMART102_CI/D88.0.45.0-master
5c71272600eeefc742b980dfaa3d513a9a028860	refs/tags/ADSMART102_CI/D88.0.45.0-master^{}
d0b6721a8ea5e840a014d5368f1f3866fcfcc7fd	refs/tags/ADSMART102_CI/D88.0.45.1-master
f42aafae25048f7eb198130fb75ef904b9f53304	refs/tags/ADSMART102_CI/D88.0.45.1-master^{}
db842cee35e2a4bcd47ac0c162ce620e3e7c8a7c	refs/tags/ADSMART102_CI/D88.0.54.0-master
b57a6a4e1f4386782e49957644faf0bcbae6ac86	refs/tags/ADSMART102_CI/D88.0.54.0-master^{}
b1535f93a5028797de19ac8eb8eccd471a07a87f	refs/tags/ADSMART102_CI/D88.0.54.1-master
5b23e16dae33e44239723f3dbe6336396127cad4	refs/tags/ADSMART102_CI/D88.0.54.1-master^{}
94cabb4c874b1992aaaafaacd5cb0219bd12cbc6	refs/tags/ADSMART_ATM_CI/D89.0.18.0-master
...

59f36a86e8581ff483f236d83c6fd7ceeede97d0        refs/tags/BSKYB_SI_ETHAN/BSKYB_INTEGRATION_BLD_09.34.00_BSKYB_HQ000_ETHAN_Int

<ex>
./listTags.py -t Q000 -m 3
refs/tags/BSKYB_HQ000_ETHAN_Int/BSKYB_INTEGRATION_BLD_08.08.00_BSKYB_HQ000_ETHAN_Int
refs/tags/BSKYB_HQ000_ETHAN_Int/BSKYB_INTEGRATION_BLD_08.07.00_BSKYB_HQ000_ETHAN_Int
refs/tags/BSKYB_HQ000_ETHAN_Int/BSKYB_INTEGRATION_BLD_08.06.00_BSKYB_HQ000_ETHAN_Int

listTags.py -t HR015 -m 3


{py-gettag}
Clone the repository and check-out a tag.

def extractRepository (branch, tag, dir):

  retAux, folder = BM.getTagCode (branch, tag)
  # note: always clone from remote repo.
  # 
  #     FOLDER = "STB_SW"
  # 
  #     def getTagCode (self, branch, tag=None):
  #             if GC.cloneRepository (BranchManagement.AVAILABLE_BRANCHES [branch]['repo'],
  #                     BranchManagement.AVAILABLE_BRANCHES [branch]['branch'], BranchManagement.FOLDER):
  # 
  #             # cmd = ['git', 'clone', repo, folder, '-b', branch]
  # 
  #             os.chdir (BranchManagement.FOLDER)
  #             GC.initialise_hooks ():
  # 
  #             if GC.checkout (tag, None):
  # 
  #             # cmd = ['git', 'checkout', tag]


{py-createJobfile}
// flipper/createJobfile.py

// note: what this mean??

# This script creates a jobfile in the parent directory of the git repository.
# You need this file before calling uploadTarball.py. The getTag script will
# generate one but if you have a `random repository` then you need to use this
# script

def createJobFiles (branch, tag, dir):

* receives three parameters: the branch, tag, as listed by listTag.py and the
  directory where the repository is created. This directory must be empty. 
* clone, run initialize_hooks script, and check-out a tag.
* create jenkins job file and baseline_details.txt

* import scripts.common.JenkinsJob as JenkinsJob
* use JF = JenkinsJob.JobFile


./getTag.py Q000 refs/tags/BSKYB_HQ000_ETHAN_Int/BSKYB_INTEGRATION_BLD_08.08.00_BSKYB_HQ000_ETHAN_Int ~/provis/example/


# <jenkins-job-file>
# 
# The job files have roughly two "sections" what I call the normal parameters
# and the extra parameters.
# 
# The normal parameters are between the two '#######' lines. The extra
# parameters are added at a later stage after the second '######'. We are trying
# to follow the format that hudkins uses with WALRUS builds.
# 
# The last three are extra parameters.
# 
# note:
# Works when use remote tag but no txt files created when use local tag.
# 
# $getTag.py HR015 refs/tags/BSKYB_HR015_Int/BSKYB_INTEGRATION_BLD_84.31.00_BSKYB_HR015_Int ~/get_tags/xx
# 
# ~/get_tags/xx$
# -rw-r--r--  1 kyoupark ccusers  101 Sep 27 15:50 baseline_details.txt
# -rw-r--r--  1 kyoupark ccusers  413 Sep 27 15:50 jobfile.txt
# drwxr-xr-x 24 kyoupark ccusers 4096 Sep 27 15:50 STB_SW/
# 
# ~/get_tags/xx$ more baseline_details.txt
# SIGM:ENG_84.31.00_5401_MNTEE_BSKYB_HR015_Int
# BASELINE:ENG_84.31.00_5401_MNTEE
# STREAM:BSKYB_HR015_Int
# 
# ~/get_tags/xx$ more jobfile.txt
# #######
# email_subject=Manually triggered build
# baseline=ENG_84.31.00_5401_MNTEE
# stream_prefix=HR015
# must_pass_test=False
# project=bskybgen2
# pvob=BSKYB_INTEGRATION_BLD_84.31.00_BSKYB_HR015_Int
# branch=BSKYB_HR015_Int
# test=False
# output=/home/NDS-UK/kyoupark/get_tags/xx
# ca_cleanup=False
# bin_to_sky=False
# #######
# 
# BUILD_NUMBER=5401
# UseEmailSubject=Re: FLIPPER build: Manually triggered build
# SERVER=theyard.cisco.com


{py-diag} *diag-segment-list*
# This script is used to change the diag levels of the components. It also
# allows to list the available segments and the configuration flags.
# 
# Example 1 List, with detail, the available segments:
# 
# ./diag.py -l -e
# AFLPROXY: darwin_aflproxy_bindings_AS3
# AIni: darwin_systemcommon_native
# AMS: AMS
# ...
# 
# Example 2 List the available diag configuration flags:
# 
# ./diag.py -c
# A E F I M P R W ! < >
# 
# Example 3 Change the diag level on two components
# 
# ./diag.py -u  AMS:AFEIMPRW\<\>  MSM:AFEIMPRW\<\> -d ~/provis/example/Ethan/

// flipper/scripts/flipper/diag.py
import scripts.common.Diag as Diag

# 
* this can be read from "http://theyard.cisco.com/diagconf.txt"
* getsegment() has defined SEGMENTs:

# segment and debug component name
SEGMENTS = """ [
      [["AMS"], ["AMS"]],
      [["AFLPROXY"],["darwin_aflproxy_bindings_AS3"]],
      ...
      ] """


* updateDiag (self, param_dict, directory): *enable-comp-diag-in-manatee*
                                             *
parser.add_argument ("-u", "--update", help="List of segment:config values. <> must be escaped. For example AMS:AFEIMPRW\<\>", nargs='+')
parser.add_argument ("-d", "--dir", help="Folder containing the repository to configure.")

./diag.py -u  AMS:AFEIMPRW\<\>  MSM:AFEIMPRW\<\> -d ~/provis/example/Ethan/

  1. build a dict from arg, {'AMS', ['A', 'F', 'E'...] } and build segment
  data attribue of Diag object.

        param_dict = validateUpdateList (D, args.update)

  2. set debug and diag file path
  # debug file
  "darwin":"FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk",
  # diag file
  "darwin":"FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/SI_config.xml",

  3. for each arg segment in _segments 
        processSegment(segment, flag)   # ('AMS', ['A', 'F', ...])

          # add debug component name to debug file
          # "NDS_BUILD_TYPE_xxx=debug" in build_options.mk
          #
          # # before, build_options.mk
          # 
          # # Example entry for building a debug library (darwin_player_src) in a release_dbg or release build 
          # # NDS_BUILD_TYPE_darwin_player_src = debug
          # 
          # # DO NOT REMOVE THE FOLLOWING INLCUDE
          # include $(NDS_ROOT)/projects/fusion2/build_options.mk
          #
          # # after build_options.mk
          # NDS_BUILD_TYPE_darwin_player_src=debug
          # 
          # # Example entry for building a debug library (darwin_player_src) in a release_dbg or release build 
          # # NDS_BUILD_TYPE_darwin_player_src = debug
          # 
          # # DO NOT REMOVE THE FOLLOWING INLCUDE
          # include $(NDS_ROOT)/projects/fusion2/build_options.mk

          enableDebugConfig(seg)

          # use xml.dom.minidom to handle diag xml file.
          # adds overrides for `all profiles`:
          # 
          #    <file name="diag.cfg">
          #     <section name="OVERRIDDEN_VALUES">
          #      <key name="TRACE_LEVEL_LIBCURL" type="STRING" value="AFEWMI"></key>
          #     </section>
          #   </file>
          #
          # <key name="TRACE_LEVEL_DLM_SVR" type="STRING" value="AFEWMI&lt;&gt;"/> \
          # <key name="TRACE_LEVEL_SPM_CLIENT" type="STRING" value="AFEWMI&lt;&gt;"/><key name="TRACE_LEVEL_SPM_SERVER" type="STRING" value="AFEWMI&lt;&gt;"/><key name="TRACE_LEVEL_NCM_SERVER" type="STRING" value="AFEWMI&lt;"/><key name="TRACE_LEVEL_SPM_NETWORK" type="STRING" value="AFEWMI&lt;"/></section>

          changeSegmentFlags(seg, flag)


kyoupark@st-castor-03:~/si_logs/SI-11091/6190$ more FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk
NDS_BUILD_TYPE_pwm_server=debug
NDS_BUILD_TYPE_spm_server=debug
NDS_BUILD_TYPE_spm_server_sw_dwnld=debug
NDS_BUILD_TYPE_spm_server_service_acquisition=debug
NDS_BUILD_TYPE_spm_utils=debug
NDS_BUILD_TYPE_SYSINIT_SERVER=debug

# Example entry for building a debug library (darwin_player_src) in a release_dbg or release build
# NDS_BUILD_TYPE_darwin_player_src = debug

# DO NOT REMOVE THE FOLLOWING INLCUDE
include $(NDS_ROOT)/projects/fusion2/build_options.mk


{py-uploadtarball}
This script receives three parameters: the email, the profile and the kernel
variant. Any STB_SW repository can be used with this script. It expect certain
files to be updated as the previous commands are called.

This script creates a WALRUS_ReceiveTarball job in hudkins and then a hudkins
build_fullstack job does the actual compilation.

The files copies the tarball to a certain folder in the yard. You need to copy
your public key in the yard for that step to work.

Example
./uploadTarball.py -d ~/provis/example/Ethan/ rodolgon@cisco.com sky_trials debug

# parser = argparse.ArgumentParser ("Uploads a repository to be compiled. ")
# parser.add_argument ("-d", "--dir", help="Folder containing the repository to upload.")
# parser.add_argument ("-p", "--platform", help="The plaform to compile as listed by resolveDeps.")
# parser.add_argument ("email", help="Comma separated email list")
# parser.add_argument ("profile", help="Profile to compile")
# parser.add_argument ("variant", help="Variant to compile")

# ~/get_tags/xx$
# -rw-r--r--  1 kyoupark ccusers  101 Sep 27 15:50 baseline_details.txt
# -rw-r--r--  1 kyoupark ccusers  413 Sep 27 15:50 jobfile.txt
# drwxr-xr-x 24 kyoupark ccusers 4096 Sep 27 15:50 STB_SW/

  # assumes that a jobfile is in the parent of cloned repository.
  # create a build number
  JFP = JobFileProcessor.JobFileProcessor (logging, "..")
  JFP.patchBuildNumber ("..")

  # create a tar file
  dest_tarfile = os.path.abspath (os.path.join ("..", "SOURCE.tgz"))
  createTarBall (dest_tarfile):

  # update job file params. What if not set those?      
  updateJobFile (args.email, args.profile, args.variant, args.platform):

  # send a job to Jenkins.
  triggerCompilation (dest_tarfile)


<job-file-from-flipper>
###########
project=
profile=sky_trials
platform=ams-drx890
branch=BSKYB_HR015_Int
stream_prefix=R015
git_tag=00.28.09
server_choice=ukstbuild2.uk.nds.com
repo_location=/home/NDS-UK/kyoupark/STB_SW
output=/home/si_logs/builds/kyoupark_1475087346189
add build opt=--override_location asbo.bskyb.com:/home/asbo/mac 
test=False
must_pass_test=False
ca_cleanup=False
bin_to_sky=False
email=kyoupark@cisco.com
variant=debug
loadrule=
system_details_tag=
check_upload=
emailsubject=tag: 00.28.09, try-duma) add duma files
########


BUILD_NUMBER=330239
SERVER=theyard.cisco.com
UseEmailSubject=Re: WALRUS build: tag: 00.28.09, try-duma) add duma files


<si-manatee> <si-build-hijack>
note:
do not matter if use absolute or sym link path for hijacks.
hijack_1=FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/build_mw_epg.sh
path must be FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build

Build has completed successfully.
Hudkins build URL: https://hudkinsmaster1.cisco.com:8443/job/build_fullstack_image/118374/artifact

Your MANATEE job:

#######
profile=sky_trials
system_details_tag=MNTEE
stream_prefix=R015
short_branch=HR015
added_params=--override_location asbo.bskyb.com:/home/asbo/mac variant=debug git_tag=refs/tags/BSKYB_HR015_Int/BSKYB_INTEGRATION_BLD_84.54.00_BSKYB_HR015_Int
platform=ams-drx890
hijack_1=FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/build_mw_epg.sh
branch=BSKYB_HR015_Int
email_subject=eng build with driver hijacks
hijack_3=AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/cdi-drivers-ams-drx890-debug.tar.bz2
hijack_2=AMS_BCM_MIPS4K_LNUX_DARWIN_01/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/build_platform/spk/patches/darwin-spk-1.19-patches.tar.bz2
email=kyoupark@cisco.com
#######


<si-manatee> profile selection

manatee/GetData.py

    @staticmethod
    def getProfilesInBranch (branch):
        # hardcoded for now
        # This is now obselete for Ethan/Hudkins2
        if branch.startswith ("HR") or branch == "XR047":
            profiles = {'profiles' : ['cust_trials', 'mem_trials', 'nds_si_devel', 'sky_prod',              'sky_trials', 'sdk_image', 'sky_tpt'] }
        elif branch.startswith ("Q0") or branch.startswith ("XR0"):
            profiles = {'profiles' : ['cust_trials',               'nds_si_devel',             'prod_logs', 'sky_trials', 'sdk_image', 'sky_tpt'] }
        else:
            profiles = {'profiles' : ['cust_trials', 'mem_trials', 'nds_si_devel', 'sky_prod', 'prod_logs', 'sky_trials', 'sdk_image', 'sky_tpt'] }

        return json.dumps (profiles)

manatee/manatee.py

@app.route ('/profiles/<branch_id>')
def getProfiles (branch_id):
    GD = GetData.GetData ()
    return GD.getProfilesInBranch(branch_id)


={============================================================================
|kt_dev_si_0002| si-process-snug

http://hetty.cisco.com/fusionmadesimple/index.php/SIProcesses#D12.2FSNUG_Engineering_Support


={============================================================================
|kt_dev_si_0002| si-splunk

http://spvss-confluence.cisco.com/pages/viewpage.action?title=Splunk+-+overview&spaceKey=CCP

index=darwin mac=0019fbf2d46b

<ex> tests-found

note: TESTS_FOUND do not include all tests as shown in index.html
PRI	TESTID	Line No	Real Time Parser Result
4 217 1 Memory pools growing: MWS:SSM_UPNP_POOL APP:VGC_MEMORY_POOL
3 549 1324817 2017:07:11 09:05:30 User-pressed 444 - indication of user-trial fault.

message:
5 46 63343 2017:11:20 09:29:42 PTS errors - check whether this is causing video glitch
3 521 3  Excessive number of TCP retransmissions detected

index=darwin component="TESTS_FOUND" version=Q004.001.55.19C | rex field=message "^\"?(?<prio>[1-9]{1})\s\d*\s\d*\s(?<pdate>[0-9:]*\s*[0-9:]*)(?<msg>.*$)"  | table logid mac prio pdate msg
index=darwin component=TESTS_FOUND | rex field=message "^\"?(?<prio>[0-9]{1})\s(?<tid>\d*)\s\d*\s(?<pdate>[0-9:]*\s*[0-9:]*)\s*(?<msg>.*$)" | search tid=50
index=darwin component=TESTS_FOUND | rex field=message "^\"?(?<prio>[0-9]{1})\s(?<tid>\d*)\s\d*\s(?<pdate>[0-9:]*\s*[0-9:]*)\s*(?<msg>.*$)" | search tid=50 | table version
index=darwin component=TESTS_FOUND | rex field=message "^\"?(?<prio>[0-9]{1})\s(?<tid>\d*)\s\d*\s(?<pdate>[0-9:]*\s*[0-9:]*)\s*(?<msg>.*$)" | search prio<4 | top msg

>
<<ex>
index=darwin component=DETAILED_INFO
message = The main text of the actual log message


<splunk-on-log-message>
index=darwin component=VRM_SERVER | rex filed=message "VRM-FSM: Live( (?<job>[01])): E_LIVE_STATE_DESTROY -> (E_LIVE_INPUT_FREE_FSM) -> E_LIVE_STATE_NONE"

// 256090:NDS: ^[2017:10:20 20:35:10]0946973886.069153 !MIL    -VRM_SERVER   		< p:0x00000318 P:MW t:0x02108520 T:VRM_SRV M:fsm.c F:FSMRun L:917 > 
// VRM-FSM: Live(  1): E_LIVE_STATE_CREATED -> (E_LIVE_INPUT_COMMIT) -> E_LIVE_STATE_COMMITTING 

index=darwin component=VRM_SERVER message="VRM-FSM: Live( 0): E_LIVE_STATE_DESTROY -> (E_LIVE_INPUT_FREE_FSM) -> E_LIVE_STATE_NONE"

// VRM-FSM: job_man:0x300925a: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED 
index=darwin component=VRM_SERVER message="VRM-FSM: job_man:0x300925a: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED" 
index=darwin component=VRM_SERVER | rex field=message "VRM-FSM: job_man:(?<handle>0x[0-f]*: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED" 


https://www.stb.bskyb.com/confluence/pages/viewpage.action?spaceKey=2016&title=Splunk+source+data

http://spvss-confluence.cisco.com/display/CCP/Basic+Use+Cases
http://spvss-confluence.cisco.com/display/CCP/Slightly+More+Advanced+Use+Cases

index=darwin component=DETAILED_INFO* priority=1 parser_testid=70
| regex version="(R019.\d+.\d+.\d+U)"
| rex field=message "(?i)parser_result=.""\s""(?<pool_name>.)""\spool"
| chart dc(logid) by version, pool_name
| sort -version

index=darwin component=DETAILED_INFO* priority=1 parser_testid=50

index=darwin component=DETAILED_INFO* priority=1 platform="ams-drx890"
| regex version="(R019\.\d+.\d+.\d+U)"
| rex field=message "parser_result=<p\d+>(?i)(?<parser_result>.*)\s*\(built by jenkins\)\s*<\/p\d+>"
| search parser_result="HALT detected in IAPP: Application termination timeout! "

index=darwin component=VRM_SERVER "Bad parameter """"hMC=0x0"
index=darwin component=VRM_SERVER "Bad parameter """"hMC=0x0" | dedup logid

// to see log sha
component=MEMMAN "Cannot allocate 3592 bytes in pool " "PREFS"
| dedup logid | eval logfile="darwin_".mac."_".logid | table logfile platform version


<splunk-chart>
// !WARN   -MEMMAN       		< p:0x000007f6 P:MW t:0x01f46450 T:IPC_WRAPPER_THREAD M:mem_static.c F:MHWMemAllocStatic L:75 > Cannot allocate 3592 bytes in pool " "PREFS"  
component=MEMMAN "Cannot allocate" "PREFS" | dedup logid | timechart span=1h count by platform

component=FDM_API_OPTV "limit number of module download session request" | dedup logid | eval logfile="darwin_".mac."_".logid | table logfile platform version

// for epg
component1=com.bskyb.epgui "BERR" | dedup logid | timechart span=1h count by platform

<splunk-index>
* | stats values(index)

<ex>
Here's one I did for Adsmart which will flag all the consecutive capped
rotation ("rotation method = 1") impressions that are exceeding the capping
limit (in this case 2, see "max impressions =2" and "where count>2"). Bear in
mind that this one requires ATM/ASM INFO to be turned on but you can remove
the joins if you don't have that and it should still work.

index=darwin component=ASM function=ASMLIB_SO_CreateTransition "New entry" Type = 2 NOT AdID = 0 NOT AdID = CmpID | join mac type=inner [search index=darwin component=ATM function=UpdateAdTableWithCopyRotationProperties "max impressions = 2"] | join mac type=inner [search index=darwin component=ATM function=UpdateAdTableWithCopyRotationProperties "rotation method = 1"] | dedup _time logid CmpID InstanceID | table _time mac logid CmpID InstanceID | sort mac CmpID date _time | streamstats count BY InstanceID mac reset_on_change=true | where count>2

The new command I used here was streamstats and it was used to count the
number of consecutive InstanceIDs per mac ("streamstats count BY InstanceID
    mac reset_on_change=true") in some cases spanning separate logs. (edited)



={============================================================================
|kt_dev_si_0002| si-tcpdump

For instructions, see SI-10771


={============================================================================
|kt_dev_si_0002| si-dmalloc

<dmalloc-build>

1. change app_process_main.c

+++ b/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/mw_process_main.c
@@ -51,6 +51,8 @@ static uint32_t f_diag_id;
 #define  FSI_UA_PROCESS_SHORT FSI_UA_MWS_PROCESS_SHORT
 #endif

+#include "../../../FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/dmalloc.h"

/* Token 12 */
dmalloc_debug_setup("log-stats,log-non-free,check-fence,error-free-null,print-messages");

pagesize = dmalloc_page_size();
printf("APP_Process dmalloc pagesize = %d system pagesize = %d\n", pagesize, getpagesize());
printf("APP_Process size of long = %d\n", sizeof(long));


2. change makefile to link with dmalloc lib for each process

+++ b/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/makefile
@@ -124,6 +124,11 @@ VGC_PLATFORM_LIB_PREFIX=$(PLATFORM_LIB_PREFIX)
 VGC_PLATFORM_LIB_SUFFIX=$(PLATFORM_LIB_SUFFIX)
 include $(COMPONENTS_DIR)/security_services/vgv/$(NDS_VGV_PROJECT)/src/libraries_mw.mk

COMPONENT_SOURCE_LIBRARIES+=\
	$(NDS_ROOT)/libdmallocth.a
COMPONENT_PREBUILT_OBJECTS+=\
	$(NDS_ROOT)/libdmallocth.a


3. enable console
note: careful since it's different from release to release

+++ b/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/make_image.sh
@@ -277,9 +277,10 @@ function set_up_spk() {
   SPK_BUILD_OUTPUT_DIR=${OUTPUT}/${PROJECT}/SPK/${SPK_PLATFORM}-${SPK_VARIANT}

   # nds_si_devel profile does not boot up with noconsole - but not required as of Nov '09.
-  if [ "${PROFILE}" ==  "sky_prod" ] || [ "${PROFILE}" ==  "sky_tpt" ] || [ "${PROFILE}" ==  "sky_trials" ] || [ "${PROFILE}" ==  "mem_trials" ] || [ "${PROFILE}" ==  "cust_trials" ]; then
-    SPK_CONFIG+=" noconsole"
-  fi
+  #if [ "${PROFILE}" ==  "sky_prod" ] || [ "${PROFILE}" ==  "sky_tpt" ] || [ "${PROFILE}" ==  "sky_trials" ] || [ "${PROFILE}" ==  "mem_trials" ] || [ "${PROFILE}" ==  "cust_trials" ]; then
+  #  SPK_CONFIG+=" noconsole"
+  #fi
+  SPK_CONFIG+=" console"


4. copy two files

vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/dmalloc.h
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/libdmallocth.a


25:08:16 15:46:17 946684826: 593: WARNING: tried to free(0) from 'unknown' 
25:08:16 15:46:17 946684826: 593:   error details: invalid 0L pointer 
25:08:16 15:46:17 946684826: 593:   from 'unknown' prev access 'unknown' 
25:08:16 15:46:17 946684826: 593: ERROR: free: pointer is null (err 20) 
25:08:16 15:46:17 946684826: 600: WARNING: tried to free(0) from 'unknown' 
25:08:16 15:46:17 946684826: 600:   error details: invalid 0L pointer 
25:08:16 15:46:17 946684826: 600:   from 'unknown' prev access 'unknown' 
25:08:16 15:46:17 946684826: 600: ERROR: free: pointer is null (err 20) 
25:08:16 15:46:17 946684826: 607: WARNING: tried to free(0) from 'unknown' 
25:08:16 15:46:17 946684826: 607:   error details: invalid 0L pointer 
25:08:16 15:46:17 946684826: 607:   from 'unknown' prev access 'unknown' 
25:08:16 15:46:17 946684826: 607: ERROR: free: pointer is null (err 20) 
25:08:16 15:46:17 946684826: 628: WARNING: tried to free(0) from 'unknown' 
25:08:16 15:46:17 946684826: 628:   error details: invalid 0L pointer 
25:08:16 15:46:17 946684826: 628:   from 'unknown' prev access 'unknown' 
25:08:16 15:46:17 946684826: 628: ERROR: free: pointer is null (err 20) 


// dmalloc.h

#define malloc(size) \
  dmalloc_malloc(__FILE__, __LINE__, (size), DMALLOC_FUNC_MALLOC, 0, 0)

// shows double free but it was about use-after-free which doesn't seem to
// catch.
https://www.stb.bskyb.com/jira/browse/DRI-1845

        new file:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/duma.h
        new file:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/duma_config.h
        new file:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/libduma.a
        modified:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/make_image.sh
        modified:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/makefile
        modified:   FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/MW_Process/mw_process_main.c


={============================================================================
|kt_dev_si_0002| si-q

git co BSKYB_HQ000_ETHAN_Int

// tag
BSKYB_HQ000_ETHAN_Int/BSKYB_INTEGRATION_BLD_06.27.04_BSKYB_HQ000_ETHAN_Int

chrmicha@st-castor-03 ~ $ type rd-falcon-D1
rd-falcon-D1 is aliased to `Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_BSKYB/BLD_ETHAN_SKY97445_BCM7445_LNUX_01'
chrmicha@st-castor-03 ~ $ type rd-falcon-V2
rd-falcon-V2 is aliased to `Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_BSKYB_2/BLD_ETHAN_SKYH419_FALCONV2_LNUX_01'
chrmicha@st-castor-03 ~ $ type rd-mr
rd-mr is aliased to `Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_BSKYB/BLD_ETHAN_SKYH412_MRBOX_LNUX_01'
chrmicha@st-castor-03 ~ $ type rd-xwing
rd-xwing is aliased to `Resolve_Deps/scripts/resolve_deps.sh FUSIONOS_BSKYB/BLD_ETHAN_SKYH412_XWING_LNUX_01'

// process
BAU and the use of Epics
https://www.stb.bskyb.com/confluence/pages/viewpage.action?spaceKey=2016&title=BAU+and+the+use+of+Epics

Ethan Release Builds
http://hetty.cisco.com/fusionmadesimple/index.php/Ethan_Release_Builds#Build_Engineer_Guide


={============================================================================
|kt_dev_si_0002| si-q-comp-live-to-http


NDS: ^[2018:02:10 20:04:37]0000000566.655145 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: job_man:0x2000003: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
NDS: ^[2018:02:10 20:04:37]0000000566.655150 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live-to-http, jhVRM=0x2000003 
NDS: ^[2018:02:10 20:04:37]0000000566.687310 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,18,job-create-type=,jb-live-to-http,job-srcloc=,locator:5:3:FD2,job-destloc=,locator:3:20:57600002:::601:uuid%3A52554976-3247-4D52-536B-783e53ff62af:LIVE 


NDS: ^[2018:02:10 20:04:37]0000000566.654790 !MIL    -SCM          		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:scm_streaming.c F:__FUNCTION__ L:1024 > SCM_STRM_ParseURI - \"http://10.64.149.52:80/stream/CHAN%3Alocator%3A5%3A3%3AFD2\" successfully parsed 
NDS: ^[2018:02:10 20:04:37]0000000566.654878 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:vrm_nsm_srv_vrp.c F:NSM_SRV_VRP_SessionCreate L:553 > ------------- VRP New Session request ------------- 
NDS: ^[2018:02:10 20:04:37]0000000566.654930 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:vrm_nsm_srv_vrp.c F:vrpPrintCreateParams L:3140 > CREATE: vrpHdl:0x201 , Src:locator:5:3:FD2, Dest:locator:3:20:57600002:::601:uuid%3A52554976-3247-4D52-536B-783e53ff62af:LIVE, SYSTEMJOB_TYPE_LIVE_TO_HTTP ipClient_FromHttpHDL:0x601 
NDS: ^[2018:02:10 20:04:37]0000000566.655145 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: job_man:0x2000003: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
NDS: ^[2018:02:10 20:04:37]0000000566.655150 !MIL    -VRM_SERVER   		< p:0x00000678 P:MW t:0x6cef0450 T:VRM_NSM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live-to-http, jhVRM=0x2000003 


={============================================================================
|kt_dev_si_0002| si-q-comp-ui

https://www.stb.bskyb.com/confluence/display/2016/Useful+Information#UsefulInformation-EnablingUIQTDebug

Enabling UI QT Debug 
By default all UI qdebug is turned off in an SI build, to enable the UI qdebug you need to modify a build define and do a clean build
Index: THIRD_PARTY_LIBRARIES/BSKYB_GEN2_AMS/Components/Qt/Qt5-Ethan/build/component.mk
===================================================================
--- THIRD_PARTY_LIBRARIES/BSKYB_GEN2_AMS/Components/Qt/Qt5-Ethan/build/component.mk     (revision 677)
+++ THIRD_PARTY_LIBRARIES/BSKYB_GEN2_AMS/Components/Qt/Qt5-Ethan/build/component.mk     (working copy)
@@ -147,7 +147,7 @@
 $(shell chmod a+x ${QT_MOC} ${QT_RCC})
 ## Ensure no debug in SI builds
-SKY_OPTIONS += -DQT_NO_DEBUG_OUTPUT
+#SKY_OPTIONS += -DQT_NO_DEBUG_OUTPUT
See the following link maintained by the UI team on how the UI logging mechanism works:
EPG Application Logging


// note
This conversation between Douglas and Pratchi is about building the epg from source.

Douglas Lima15/01/2018, 15:03
Hi, has anyone recently built with --epg_from_src ?

Prachi Joshi15/01/2018, 15:04
sometime last year
had to change this
THIRD_PARTY_LIBRARIES/BSKYB_GEN2_UI/Applications/makefile
add not parallel at line 265

262 ## ************************************************************************
263 # Run the packaging / signing tool over the output
264 ## ************************************************************************
265 .NOTPARALLEL:
266

Salim Esmailjee15/01/2018, 15:06
Please do update http://hetty.cisco.com/fusionmadesimple/index.php/Epg_hijack after you manage to successfully build it

Douglas Lima15/01/2018, 15:21
Thanks Prachi, I had an old patch from NGDEV-84050 (still open) and have updated with .NOTPARALLEL but still fails in manatee due to ( No module named jsonschema), it works fine in build servers. I wonder if it is actually an missing python package.

Prachi Joshi15/01/2018, 15:21
oh ok
I had tried this locally not on manatee so I dont know. May be it doesn't work locally as well
something changed

Douglas Lima15/01/2018, 15:22
locally it works fine, guess best bet is build the wgt locally and attach it to manatee (ok not ideal, symbols will be messed, etc)

Prachi Joshi15/01/2018, 15:23
ok yes I agree


<q-ui>

4506:NDS: ^[2018:01:23 03:19:40]0000000072.065365 !MIL    -com.bskyb.epgui		< p:0x0000063c P:APP t:0x70f921d0 T:no name M:main.cpp F:int main(int, char**) L:312 > MS:EPG MainView Start

QtEpgApp/source/prod_epg/epg_ui/src/MainView.cpp
776:    NotificationModel::notificationsInJSON = FileUtils::instance().readQJsonDocumentFromFile(QStringLiteral(":/notifications/notifications.json")).toVariant().toMap();
777:    Q_ASSERT_X(NotificationModel::notificationsInJSON.count(), "Badly formed resource", "Failed to load notifications resource");


12278:NDS: ^[2018:01:23 03:34:22]0000000954.102201 !MIL    -com.bskyb.epgui		< p:0x0000063c P:APP t:0x70f921d0 T:no name M:NotificationModel.cpp F:void NotificationModel::showById(const NotificationId&, Notifica L:195 > MS:EPG Show notification id :  "NSS"

resources/notifications/notifications.json
    "NSS":
    {
        "Title":"$['NSS_MINI_TV']",
        "Type":"Banner",
        "Timeout":0,
        "Groups":"Player,MainTV,MiniTV",
        "Priority":200
    },

resources/localeFiles/language/eng/strings.json
        {
            "id": "SCHEDULE_NOT_READY_MESSAGE",
            "t": "Waiting for TV Schedule\u2026",
            "d": "Text shown in UI areas that require schedule data when not enough data have been harvested yet.",
            "f": ""
        },

!INFO   -com.bskyb.epgui		< p:0x0000063c P:APP t:0x70f921d0 T:no name M:PanelContainerGadget.cpp F:void PanelContainerGadget::processPanelRequests() L:2467 > REQUEST_ADD_PANEL_URI: "guide://message?stringWithSpinnerKey=SCHEDULE_NOT_READY_MESSAGE"
!MIL    -com.bskyb.epgui		< p:0x0000063c P:APP t:0x70f921d0 T:no name M:PanelGadget.cpp F:virtual void PanelGadget::setUri(const QString&, bool, Navigatio L:229 > MS:EPG Set new panel :  "guide://message?stringWithSpinnerKey=SCHEDULE_NOT_READY_MESSAGE"


NDS: ^[2018:03:13 12:36:11]0000024572.165718 !INFO   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:PanelContainerGadget.cpp F:void PanelContainerGadget::processPanelRequests() L:2470 > REQUEST_ADD_PANEL_URI: "guide://qms/sections/continuewatching?clear_model=false&emptyModelStringKey=CONTINUE_WATCHING_EMPTY_MODEL&offline=true&ondemand_context=qms&previewMetadata=true"
NDS: ^[2018:03:13 12:36:11]0000024572.166675 !MIL    -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:PanelGadget.cpp F:virtual void PanelGadget::setUri(const QString&, bool, Navigatio L:229 > MS:EPG Set new panel :  "guide://qms/sections/continuewatching?clear_model=false&emptyModelStringKey=CONTINUE_WATCHING_EMPTY_MODEL&offline=true&ondemand_context=qms&previewMetadata=true"
NDS: ^[2018:03:13 12:36:11]0000024572.167056 !INFO   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:QMSGadget.cpp F:virtual void QMS::QMSGadget::onSetUri(const QString&, const Pane L:304 > "guide://qms/sections/continuewatching?clear_model=false&emptyModelStringKey=CONTINUE_WATCHING_EMPTY_MODEL&offline=true&ondemand_context=qms&previewMetadata=true"

NDS: ^[2018:03:13 12:36:11]0000024572.206072 !INFO   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:QMSContentManager.cpp F:void QMS::QMSContentManager::logCompleteTiming() L:735 > "QMS Bookmark (CWNODEID - CWNODEID) load complete"
NDS: ^[2018:03:13 12:36:11]0000024572.206078 !INFO   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:QMSContentManager.cpp F:void QMS::QMSContentManager::logCompleteTiming() L:747 > "Continue Watching: 0.00 s"
NDS: ^[2018:03:13 12:36:11]0000024572.206082 !INFO   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:QMSContentManager.cpp F:void QMS::QMSContentManager::logCompleteTiming() L:752 > "Total load time: 0.00 s"

// asset image (not seeing this when reported continued tab is empty.
NDS: ^[2018:03:13 12:36:11]0000024572.206202 !WARN   -com.bskyb.epgui		< p:0x000009a3 P:APP t:0xa4cd21d0 T:no name M:ImageUrlHelper.cpp F:static QString ImageUrlHelper::fromPvrId(const QString&, ImageUr L:224 > "http://images.metadata.sky.com/pd-image/e287e574-a6db-4df4-a644-ec8347b7257e/16-9/456?providername=skyonehd&pvrid=P2900035c"


={============================================================================
|kt_dev_si_0003| si-log-commands

$ list_log 0019fb2d3660 | grep R014.083.60.00C | cut -f 4 | cut -f 1 -d'.' | xargs check_log


={============================================================================
|kt_dev_si_0003| si-log-lines


`FRAME_PRESENTED`
!MIL    -MPM         < P:MW T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1374 > FRAME_PRESENTED: hMC=0x2ff7 

`FRAME_DECODED`
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_pres_video_control.c F:MPM_PresHandleVideoDecoderBufferLowEvent L:01577 > FRAME_DECODED on decoder 0

# TransponderId
!MIL   -UAMC         < T:PLAYER_MAIN M:live_pbag.c F:Live_Pbag_Print L:00980 > UAM LIVE EVENT PROGRAM_OPEN
!MIL   -UAMC         < T:PLAYER_MAIN M:live_pbag.c F:Live_Pbag_Print L:00985 > Live params: NetworkId=0x00000002, TransponderId=0x000007F9 ServiceId=0x000023FB

OR

!MIL   -UAMC         < T:PLAYER_MAIN M:live_pbag.c F:Live_Pbag_Print L:00984 > UAM_DCM_PARAM_DATA_TYPE_PROGRAM_OFF
!MIL   -UAMC         < T:PLAYER_MAIN M:live_pbag.c F:Live_Pbag_Print L:00985 > Live params: NetworkId=0x00000002, TransponderId=0x000007F9 ServiceId=0x000023FB


KEY_PRESS
!MIL   -aem          < p:00000076 t:00c47b40 T:AEM_INPUT_MONITOR_THREAD M:aem_userinput.c F:AEM_InputMonitorThread L:00429 > KEY_PRESS: code=0xe007

DECODER_STARTED and DECODER_STOPPED:
!MIL   -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_component_video.c F:MPMComponentVideoStop L:00526 > DECODER_STOPPED: hMC=4
!MIL   -MPM          < p:00000075 t:009d50a0 T:MPM_ITCMAIN_THREAD M:mpm_component_video.c F:MPMComponentVideoStart L:00440 > DECODER_STARTED: hMC=30
!MIL   -MPM          < p:00000075 t:009d50a0 T:MPM_ITCMAIN_THREAD M:mpm_component_audio.c F:MPMComponentAudioStart L:00392 > DECODER_STARTED: hMC=30

`CHANNEL UP`
ioctl VIDEO_DECODER_STOP
ioctl DEMUX_STOP posted OK on /dev/nds/demux0/elementaryfilter
ioctl VIDEO_DECODER_FLUSH_RATE_BUFFER
ioctl DEMUX_STOP posted OK on /dev/nds/demux1/remux0

# remove pids: 0(video), 1(audio)
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_demux.c F:MPMDemuxInvalidateTPid L:01455 > Invalidated tpid for component 0
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_demux.c F:MPMDemuxInvalidateTPid L:01455 > Invalidated tpid for component 1

# remove tipd of remux, do 4 times in total.
ioctl DEMUX_REMUX_REMOVE_TPID posted OK on /dev/nds/demux1/remux0

# change pids:
# 0x04, SYSTEMOBJECT_ESI_STREAM_TYPE_MPEG_2_VIDEO
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_media_connection.c F:MPM_MCProcessESIObject L:01037 > Got ESI object of type 0x4 tpid 0xd00
# 0x02, SYSTEMOBJECT_ESI_STREAM_TYPE_MPEG_2_AUDIO
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_media_connection.c F:MPM_MCProcessESIObject L:01037 > Got ESI object of type 0x2 tpid 0xd01
# 0x0a, SYSTEMOBJECT_ESI_STREAM_TYPE_TELETEXT
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_media_connection.c F:MPM_MCProcessESIObject L:01037 > Got ESI object of type 0xa tpid 0x91d
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_media_connection.c F:MPM_MCProcessESIObject L:01037 > Got ESI object of type 0xa tpid 0x91d
# 0x0d, SYSTEMOBJECT_ESI_STREAM_TYPE_OTV_CAROUSEL
!INFO  -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_media_connection.c F:MPM_MCProcessESIObject L:01037 > Got ESI object of type 0xd tpid 0x901

# 
ioctl DEMUX_ATTACH_TPIDFILTER posted OK on /dev/nds/demux0/elementaryfilter


<si-diag--error-mesg>

# memory
!WARN  -MEMMAN       < M:mem_moveable.c F:MHWMemAlloc L:00152 > Cannot allocate 16444 bytes in pool systemobject, not enough memory

# key buffer overflow
!ERROR -GFXINPUT     < M:gfx_eventbuffer_p.c F:GfxInputEventBufferPostEventSafe L:00109 > EventBuffer Overflow

# mutex deadlock since this mutex is already locked. 
!ERROR -aem          < M:aem_sys.c F:AEM_ThreadPrintError L:02399 > aem_api.c @ 2905 ~~~ !!!!! DEADLOCK detected !!!!!! ~~~ (try SYSTEMUTIL_DEADLOCK_DEBUG_EXT for more info) (mutex = &g_aem_list_mutex)

!ERROR -MSM_MDI      < M:meta_utl.c F:getStringFromArray L:04311 > can not find the string for offset 258, the array lengthis 1, and the array base is 256
!ERROR -MSM_MDI      < M:msm_indexer.c F:handleRecordCloseIndex L:03337 > getMasterContextByIndexHandle failed! stat = unknownString

ERROR cdi/demux/cdi_rasp.c:3467:Cannot corrupt packets unless RASP is used on remux 0


={============================================================================
|kt_dev_si_0003| si-log-lines-mil

!MIL    -P_Api        < T:no name M:player_api_session.c F:PLAYER_API_Session_Play L:4106 > PLAY 
!MIL    -P_Api        < T:no name M:player_api_session.c F:PLAYER_PRV_Session_Play L:6157 > PLAY on target MAIN_TARGET 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1109 > VIDEO IS HIDDEN 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8959 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=NOT_RUNNING 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9182 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001 [PROCESSED_ASI (524952) NOT_RUNNING] [SELECTION_ASI (524952) NOT_RUNNING] 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStopped L:9849 > Job 0x03000001 STOPPED on Display Target MAIN_TARGET 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobDestroyed L:10102 > Job 0x03000001 DESTROYED on Display Target MAIN_TARGET 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSSI L:4224 > FRONT END SIGNAL LOCKED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSCI L:4668 > PMT RECEIVED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1932 > CA STREAM STATUS : ACCESS GRANTED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1932 > CA STREAM STATUS : ACCESS GRANTED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1906 > CA STREAM STATUS : FREE TO AIR 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1906 > CA STREAM STATUS : FREE TO AIR 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9182 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003 [PROCESSED_ASI (524948) RUNNING] [SELECTION_ASI (524948) RUNNING] 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStarted L:5829 > Job 0x03000003 STARTED on Display Target MAIN_TARGET 

!MIL    -MCM            T:FEM_WORKER_THREAD M:mcm_dev_notifications.c F:MCM_DEV_MAN_ListenerMSO L:134 > hMC=0x257  TUNER_LOCKED: 
!MIL    -MPM            T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1374 > FRAME_PRESENTED: hMC=0x257 

!MIL    -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1105 > VIDEO IS SHOWN 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8959 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003, status=RUNNING 
!MIL    -EPG_ME       < T:no name M:MediaEngine F:tuningIsFinished L:4717 > T:PooledExecutor#4:SYSTEMTEST tuning complete
!MIL    -EPG_ME       < T:no name M:MediaEngine F:channelChanged L:2027 > T:PooledExecutor#4:CHANNEL CHANGED TO Sky1 HD, 106


!MIL    -VRM_SERVER   < T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: pleLive:0x1be0000: E_PLE_STATE_NONE -> (E_PLE_INPUT_SESSION_CREATED) -> E_PLE_STATE_SESSION_CREATED 
!MIL    -MCM          < T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,599,mc-create-mcid=,599,mc_create-str=,mc-live,fsnfmt=,hMC=0x257 


={============================================================================
|kt_dev_si_0001| comp-doc

Documents > Engineering > Service Provider Business > SPVideo > SPVSS > Customers & Partners > Sky Europe > Sky UK > Archives > Pull VOD
Documents > Engineering > Service Provider Business > SPVideo > SPVSS > Products > Fusion > Architecture > WPDS Documents


={============================================================================
|kt_dev_si_0002| comp-process

STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/APP_Process


={============================================================================
|kt_dev_si_0001| comp-filldisk

1. see broken link for darwin
/home/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk

lrwxrwxrwx 1 kyoupark ccisco   41 Apr 20 10:25 src -> ../../../../../../SYSTEM_BIN/FILLDISK/src
lrwxrwxrwx 1 kyoupark ccisco   41 Apr 20 10:25 inc -> ../../../../../../SYSTEM_BIN/FILLDISK/inc

2. 

kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk$ rm inc
kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk$ ln -s ../../../../../../deps/SYSTEM_BIN/FILLDISK/inc inc
kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk$ rm src
kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk$ ln -s ../../../../../../deps/SYSTEM_BIN/FILLDISK/src src
kyoupark@st-castor-03:~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/filldisk$ ll
total 8
drwxrwxrwx 6 kyoupark ccisco 4096 Oct  4  2017 ../
lrwxrwxrwx 1 kyoupark ccisco   46 Apr 23 13:26 inc -> ../../../../../../deps/SYSTEM_BIN/FILLDISK/inc/
lrwxrwxrwx 1 kyoupark ccisco   46 Apr 23 13:26 src -> ../../../../../../deps/SYSTEM_BIN/FILLDISK/src/
drwxrwxrwx 2 kyoupark ccisco 4096 Apr 23 13:26 ./


./build_mw_epg.sh --platform ams-drx890 --profile sky_trials --project picasso --variant debug --baseline ENG_KT_FD --cartool no --enable_full_parallel_build --filldisk
./make_image.sh -c --platform ams-drx890 --profile sky_trials --project picasso --variant debug --baseline ENG_KT_FD --cartool no --enable_full_parallel_build


={============================================================================
|kt_dev_si_0002| comp-smartctl comp-badblocks

-sh-3.2# which smartctl
/usr/sbin/smartctl

-sh-3.2# which badblocks
/sbin/badblocks


={============================================================================
|kt_dev_si_0001| comp-dms

http://ndpedia.il.nds.com/index.php/Main_Page
http://ndpedia.il.nds.com/index.php/Fusion/DMS/TestPlan/DMS_BSkyB_Test_Scenarios_Summary_Table

<reports>
http://10.126.62.195/ui/#id=0/GEO/views~regexp:%5ESTB_SW.*BSKYB 
this one is for real hw history for release branch 

https://engci-private-gpk.cisco.com/jenkins/ethan/job/p/job/master/ 

this one is vstb test history for each commit on internal master. 
the latter one, you might have to look around if you can access 

7836:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_9_DPL_Suspend_and_Resume_Download.c                                                                              [16/1873]
7837:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_8_DPL_Download_Playlist_Assets.c
7840:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_DPL_Failure_Retry_Give_Up_and_Start_Over.c
7851:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_42_Book_PDL_DPL_from_slave.c
7859:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_15_Progressive_Playback_Control_for_DPL.c
7863:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_Finding_DPL_Programmes.c
7867:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_40_Finding_DPL_Programmes_in_Ipclient.c
7868:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_33_Re_stamping_DPL_Short_assets_that_overlaps_with_other_assets_in_PDL_suite.c
7877:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_39_Widget_listing_for_DPL_assets.c
7878:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_4_Book_DPL_asset_with_typical_number_and_error_playlist_item.c
7882:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_38_DPL_Filter_bookings_by_Viewed_State_Date.c
7883:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_17_Threshold_Reporting_Verification_for_DPL.c
7884:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_35_DPL_Display_Subtitles.c
7899:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_30_DPL_Download_Exception_Handling.c
7901:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_47_Threshold_Reporting_Verification_for_DPL_On_MR.c
7913:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c
7914:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_Book_PDL_DPL_asset_with_STB_supported_delivery_types.c
7918:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_28_DPL_Exit_TrickMode_To_Normal_Play.c
7922:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_3_Playlist_Item_Verification_With_Different_Smartcard_Configuration.c
7926:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_26_DPL_Playback_Check_Accurate_Detection_of_Asset_Boundaries.c
7927:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_27_DPL_SA_removal_verification.c
7932:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_22_DPL_SAC_behaviour_with_ADM_errors.c
7934:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_11_DPL_Asset_Expiry.c
7946:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_34_DPL_Partial_SA_removal_verification.c
7950:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_13_DPL_Playback_and_Trick_Modes.c
7952:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_29_DPL_Playback_With_TrickMode_Restrictions.c
7953:./DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_12_DPL_Asset_Expiry_Recycle_Quota.c


<ex>
http://ndpedia.nds.com/index.php/Fusion/DMS/TestPlan/DMS_5209_16

DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite.c

	else if(0 == strcmp(test_number, "DMS_5209_16"))
    {
        g_DMS_TEST_DATA_FILE = "/NDS/test_data_files/DMS_5209_16.dat";
        pTest = CU_add_test(suite, "DMS_5209_16", DMS_5209_16_Real_Time_playback_Reporting_for_DPL );
    }

DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/setup/BSKYB_HD_PVR/DMS_5209_16.dat
# This is the test data file for scenario DMS_5209_16
# This scenario book DPL assets and does real time playback verification.

[EMM_INJECT.0]
NUM_EMM_ACTIONS=6
NUM_EMM_ACTIONS_1=1

ACTION_NAME.0="EMM_RESET_CARD"
EXPECTED_OSD.0="CARD_RESET_COMPLETE"

ACTION_NAME.1="EMM_NDS_DYNAMIC_SCMSID_SET_CARDID"
ACTION_NAME.2="EMM_NDS_DYNAMIC_ENTITLEMENT_DEAUTH"
ACTION_NAME.3="EMM_NDS_DYNAMIC_ENTITLEMENT_AUTH"
ACTION_NAME.4="EMM_NDS_DYNAMIC_SCMSID_SET_ACTUAL_CARDID"
ACTION_NAME.5="EMM_NDS_DYNAMIC_SCMSID_SET_CARDID"


[EMM_INJECT.1]
NUM_EMM_ACTIONS=5
ACTION_NAME.1="EMM_NDS_DYNAMIC_SCMSID_SET_CARDID"
ACTION_NAME.2="EMM_NDS_DYNAMIC_ENTITLEMENT_DEAUTH"
ACTION_NAME.3="EMM_NDS_DYNAMIC_ENTITLEMENT_AUTH"
ACTION_NAME.4="EMM_NDS_DYNAMIC_SCMSID_SET_ACTUAL_CARDID"
ACTION_NAME.5="EMM_NDS_DYNAMIC_SCMSID_SET_CARDID"


[TEST_DATA]
URL="http://10.10.200.142/reps_logs/"
REFERENCE_LOG_FILE="/NDS/test_data_files/DMS_5209_16_reference_log.dat"
ACTUAL_LOG_FILE="/tmp/dms/final_file.dat"
IS_SP=FALSE

[ASSETS]
NUM_ASSETS = 2
# ASSET_NAME.0="DPLReportAsset01"
ASSET_NAME.0="DPLReportAsset01_nonull"
# ASSET_NAME.1="DPLReportAsset02"
ASSET_NAME.1="DPLReportAsset02_nonull"
ASSET_NAME.2=DPLAsset14

[PLANNER_VERIFICATION.0]
PLANNER_LIST_SIZE=2

# End of file.


DARWIN_PLATFORM/dms/build/integration/dms/suites/DMS_PDL_Suite/tests/DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c

/* CUnit test entry point for scenario DMS_5209_16. */
void DMS_5209_16_Real_Time_playback_Reporting_for_DPL(void)
{
}

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:dms_mae_cunit_application.c F:dms_mae_cunit_application L:00157 > Starting CUnit run (test=DMS_5209_16, run=0)

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00480 > 
  ASSET_NAME[0] as read from DAT file is : DPLReportAsset01_nonull

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00480 > 
  ASSET_NAME[1] as read from DAT file is : DPLReportAsset02_nonull

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00598 > Sent EMM ACTION_NAME.0=EMM_RESET_CARD


        /* Find out initial status of reporting server */
        call_status = retrieve_files_from_server(begin_prev_file, 0, &begin_prev_file_lines);
        DMS_ASSERT_EQUAL_FATAL(call_status, DMS_STATUS_OK, ("retrieve_files_from_server failed ."));

        call_status = retrieve_files_from_server(begin_cur_file, 1, &begin_cur_file_lines);
        DMS_ASSERT_EQUAL_FATAL(call_status, DMS_STATUS_OK, ("retrieve_files_from_server failed ."));

        DIAG_LOG_INFO(g_DMS_DIAG_SEG, ("BEGIN File_1: <%s> <%u>", begin_prev_file, begin_prev_file_lines));
        DIAG_LOG_INFO(g_DMS_DIAG_SEG, ("BEGIN File_2: <%s> <%u>", begin_cur_file, begin_cur_file_lines));

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01703 > Server URL as read from DAT file is : http://10.10.200.142/reps_logs/
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01718 > Changing newline to NULL
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01730 > Changing newline in line_count to NULL
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01739 > stbreports.20170228_11.csv.1, 41, 41
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01757 > Results file name <stbreports.20170228_11.csv.1> with 41 lines at AMS Proxy <,L÷p>
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01703 > Server URL as read from DAT file is : http://10.10.200.142/reps_logs/
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01718 > Changing newline to NULL
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01730 > Changing newline in line_count to NULL
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01739 > stbreports, 79, 79
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:retrieve_files_from_server L:01757 > Results file name <stbreports> with 79 lines at AMS Proxy <,L÷p>
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00693 > BEGIN File_1: <stbreports.20170228_11.csv.1> <41>
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00694 > BEGIN File_2: <stbreports> <79>

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00708 > Booking done 

!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00965 > 
  Step 6: Reporting verification on Trick-Mode.
!INFO  -DMS_T        < T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:DMS_5209_16_Real_Time_playback_Reporting_for_DPL L:00968 > 
  Starting Playback of : DPLReportAsset01_nonull


        /*Verification for the logged data in ADM SERVER*/
        (void)DMS_GRAPHICS_DisplayStatusMessage(application_window, "retrieve files from_server");
        call_status=retrieve_files_from_server(end_prev_file, 0, &end_prev_file_lines);
        DMS_ASSERT_EQUAL_FATAL(call_status, DMS_STATUS_OK, ("retrieve_files_from_server failed ."));

        call_status=retrieve_files_from_server(end_cur_file, 1, &end_cur_file_lines);
        DMS_ASSERT_EQUAL_FATAL(call_status, DMS_STATUS_OK, ("retrieve_files_from_server failed ."));

        /* retrieve prev prev file */
        call_status=retrieve_files_from_server(end_prev_prev_file, 2, &end_prev_prev_file_lines);
        DMS_ASSERT_EQUAL_FATAL(call_status, DMS_STATUS_OK, ("retrieve_files_from_server failed ."));

        DIAG_LOG_INFO(g_DMS_DIAG_SEG, ("END Prev_Prev_File: <%s> <%u>", end_prev_prev_file, end_prev_prev_file_lines));
        DIAG_LOG_INFO(g_DMS_DIAG_SEG, ("END Prev_File     : <%s> <%u>", end_prev_file, end_prev_file_lines));
        DIAG_LOG_INFO(g_DMS_DIAG_SEG, ("END Cur_File      : <%s> <%u>", end_cur_file, end_cur_file_lines));

NDS: ^1488288035.382196 !INFO  -DMS_T        < p:00000472 t:2c5d4530 T:DMS_MAE_APPLICATION_THREAD M:dms_graphics_display_status_message.c F:DMS_GRAPHICS_DisplayStatusMessage L:00107 > compare expected with actual results
NDS: ^1488288035.404398 !INFO  -DMS_T        < p:00000472 t:2c5d4530 T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:compare_result_files L:01849 > Reference Log File  : </NDS/test_data_files/DMS_5209_16_reference_log.dat>
NDS: ^1488288035.404580 !INFO  -DMS_T        < p:00000472 t:2c5d4530 T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:compare_result_files L:01853 > ACTUAL_LOG_FILE  : </tmp/dms/final_file0.dat>
NDS: ^1488288035.404826 !INFO  -DMS_T        < p:00000472 t:2c5d4530 T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:compare_result_files L:01857 > Expected NUM_OF_REPORTS : 49
NDS: ^1488288035.410823 !INFO  -DMS_T        < p:00000472 t:2c5d4530 T:DMS_MAE_APPLICATION_THREAD M:DMS_5209_16_Real_Time_playback_Reporting_for_DPL.c F:compare_result_files L:01861 > Expected NUM_OF_REPORTS : 49

<make>
# STB_SW. Use _FST for branch and master for GM
./Resolve_Deps/scripts/resolve_deps.sh skpd-ams0201

# STB_SW
./build_dms.sh dms_darwin -d DMS_5209_16

cd DARWIN_PLATFORM/dms/build/integration/dms
pushd DARWIN_PLATFORM/dms/build/integration/dms/DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian
./make_SKPD-AMS0201_scenario.sh --enable_full_parallel_build DMS_PDL_Suite

Copying /home/nds-uk/kyoupark/STB_SW/DARWIN_PLATFORM/dms/public/config/etc.default/* to 
/home/nds-uk/kyoupark/STB_SW/DARWIN_PLATFORM/dms/build/integration/dms/DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/fs/NDS/etc...
/home/nds-uk/kyoupark/STB_SW/DARWIN_PLATFORM/dms/build/integration/dms/DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian

root
mkdir /host
mount -otcp "ukstbuild2:/home/nds-uk/kyoupark/STB_SW/DARWIN_PLATFORM/dms/build/integration/dms/DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian" /host
/host/set_pdl_region.sh "CI" "bskybtrain1.uk.nds.com" "10.209.22.14"
/host/set_cmdc_region.sh "" "" "" "5600"
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -F
# /host/set_stb_id.sh "16E35C23"
/host/set_stb_id.sh ""
# ? /host/set_diag_output.sh "udp:10.209.56.197:5555"
# /host/set_sgw_region.sh "CI" "bskyb-sgw-sim1" "172.19.96.136" "5007"

export FUSION_CA_REPORTBACK_SGW_SERVER_ADDRESS="10.10.200.136"
export FUSION_CA_REPORTBACK_SGW_SERVER_PORT="4343"
export FUSION_DMS_MASTER_NODE_IP="192.168.7.2"
export FUSION_SGW_SIMULATOR_ADDRESS="$FUSION_SGW_SIMULATOR_ADDRESS$"
export FUSION_SGW_SIMULATOR_PORT="$FUSION_SGW_SIMULATOR_PORT$"
export FUSION_APP_SGW_SIMULATOR_ADDRESS="$FUSION_APP_SGW_SIMULATOR_ADDRESS$"
export FUSION_APP_SGW_SIMULATOR_PORT="$FUSION_APP_SGW_SIMULATOR_PORT$"
export FUSION_SGW_LAB_SERVER_NAME="$FUSION_SGW_LAB_SERVER_NAME$"
export FUSION_SGW_LAB_SERVER_ADDRESS="$FUSION_SGW_LAB_SERVER_ADDRESS$"
export FUSION_SGW_LAB_SERVER_PORT="$FUSION_SGW_LAB_SERVER_PORT$"
export FUSION_IS_MASTER=""
export FUSION_HN_NODE_NUMBER="1"
export FUSION_SLAVE_LIST=""
export FUSION_SLAVE_SOAP_PORT=""
export FUSION_SECOND_IP=""
export FUSION_APC_GW_IP="$FUSION_APC_GW_IP$"
export FUSION_CEC_IP="$FUSION_CEC_IP$"
export FUSION_CEC_PORT="$FUSION_CEC_PORT$"
export FUSION_CEC_NUMBER="$FUSION_CEC_NUMBER$"
export FUSION_MOUNT_POINT="192.168.7.1:/home/ci-worker/cruisecontrol/SYSTEM_BIN/w_drive/822528587/DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian"
export FUSION_STREAM_STORE_ADDRESS="10.209.116.1"
export FUSION_CPE_ID=0
export FUSION_AMS_PROXY_URL=http://172.21.240.101:8080/ams_proxy
export FUSION_CARD_ID=360235568
export FUSION_CI_JOBSERVER_IP=10.209.115.194
export FUSION_CI_JOB_ID=822528587
export FUSION_CI_REGION="CF1"
export FUSION_STB_CHIP_ID="4273351098C6C15F2BF1356400000000"
export FUSION_NTP_SERVER_NAME="10.209.31.249"

/host/dms_startup.sh skpd-ams0201 DMS_5209_16 FORMAT 

<walled-garden>
http://hetty.cisco.com/fusionmadesimple/index.php/General_CI_Tips
http://nemesis.uk.nds.com/jobserver/auth/walledgarden/

STB_SW.master           # for GM
STB_SW.master-DAILY     # for GM
STB.SW.DMS_BSKYB_HR017

rsync -rptLv 'DMS_PDL_Suite' --exclude '*.deps' --exclude '*.o' --exclude '*.a' --exclude 'DMS_PDL_Suite/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components' 'rsync://ci-fusion@nemesis.uk.nds.com/walledgarden/822588797/'


={============================================================================
|kt_dev_si_0001| comp-tree

|-- BUILD_SYSTEM
|   |-- CCACHE
|   |-- COMMON_MAKEFILES
|   |-- FUSION_PROFILE
|   |-- cygwin_win32
|   `-- hosts
|-- CMS_INFORMATION_SERVICES
|   |-- DBENGINE
|   |-- FDM
|   |-- PCAT
|   |-- PSCHED
|   |-- SDM
|   |-- SFM
|   |-- SIM
|   `-- SIM_CO
|-- CMS_MEDIA_SERVICES
|   |-- BEM
|   |-- CAMM
|   |-- CAPPROC
|   |-- CTM
|   |-- FEM
|   |-- FS_FOS
|   |-- MCM
|   |-- MDM
|   |-- MFS
|   |-- MPM
|   |-- MSM
|   |-- MSM_COMMON
|   |-- Media_Streamer
|   |-- RASP_High
|   |-- VRM                   *comp-vrm*
|   |-- metadata
|   `-- msm_import

|-- CMS_PLATFORM_SERVICES
|   |-- AEM                   *comp-aem*
|   |-- CAPPRES
|   `-- GFX                   *comp-gfx*

|-- CMS_SECURITY_SERVICES
|   `-- CA_RANGE
|-- CMS_SYSTEM_INFRASTRUCTURE
|   |-- AVCU
|   |-- CMDC
|   |-- DHCP
|   |-- DIAG                  *comp-diag*
|   |-- FREETYPE2
|   |-- HTTP
|   |-- HTTPSERVER
|   |-- IPC
|   |-- MEMMAN
|   |-- NCM
|   |-- OIGC
|   |-- RTSP
|   |-- SERIAL
|   |-- SSL
|   |-- SYSINIT
|   |-- SYSTEMALARM
|   |-- SYSTEMCOMMON
|   |-- SYSTEMCONFIG
|   |-- SYSTEMITC
|   |-- SYSTEMLANG
|   |-- SYSTEMLOCATOR
|   |-- SYSTEMOBJECT
|   |-- SYSTEMSTRING
|   |-- SYSTEMTIME
|   |-- SYSTEMUTIL
|   |-- UPNP
|   `-- ZLIB
|-- CMS_SYSTEM_RESOURCE
|   |-- PDM
|   |-- RMF                   *comp-rmf*
|   `-- SSM
|-- COMMON_MIDDLEWARE
|   |-- ASMlib
|   |-- EXPAT
|   `-- RNC
|-- DARWIN_PLATFORM
|   |-- DARWIN_AEM_JAVA
|   |-- DARWIN_ATG
|   |-- DARWIN_ATG_JAVA
|   |-- DARWIN_DIAG_JAVA
|   |-- DARWIN_DLM
|   |-- DARWIN_DLM_JAVA
|   |-- DARWIN_GUIDE
|   |-- DARWIN_GUIDE_JAVA
|   |-- DARWIN_OFS
|   |-- DARWIN_OFS_JAVA
|   |-- DARWIN_PCATP
|   |-- DARWIN_PLANNER
|   |-- DARWIN_PLANNER_JAVA
|   |-- DARWIN_PLAYER
|   |-- DARWIN_PLAYER_JAVA
|   |-- DARWIN_PREFS
|   |-- DARWIN_PREFS_JAVA
|   |-- DARWIN_REMBOOK
|   |-- DARWIN_RMFPLUGIN
|   |-- DARWIN_SBM
|   |-- DARWIN_SCM
|   |-- DARWIN_SPC_JAVA
|   |-- DARWIN_SPM
|   |-- DARWIN_SPM_JAVA
|   |-- DARWIN_SRM
|   |-- DARWIN_SYSTEMCOMMON_JAVA
|   |-- DARWIN_SYSTEMCONFIG_JAVA
|   |-- DARWIN_SYSTEMLANG_JAVA
|   |-- DARWIN_SYSTEMLOCATOR_JAVA
|   |-- DARWIN_SYSTEMTIME_JAVA
|   |-- DARWIN_UAM
|   |-- DARWIN_VGC_JAVA
|   |-- DARWIN_WLM_JAVA
|   `-- dms
|-- FUSIONOS
|   |-- CDI_INC
|   |-- FOS_INC
|   `-- STORAGE_HELPER
|-- FUSIONOS_2
|   |-- BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01
|   |-- HOTPLUG_HELPER
|   |-- NETWORK_HELPER
|   |-- NGI_HELPER
|   |-- POWER_HELPER
|   |-- SERIAL_HELPER
|   `-- USB_HELPER
|-- FUSIONOS_INPUT_DEL_2
|   `-- DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01
|-- FUSIONOS_OUTPUT_DEL_2
|   `-- KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01
|-- FUSION_SYSTEM_INTEGRATION
|   `-- BSKYB_INTEGRATION
|-- MH_MW_SERVICES
|   |-- MHSI
|   `-- MH_BINXML
|-- SYSTEM_BIN
|   |-- TOOLS_FUSIONCONFIG
|   |-- auto_mock
|   |-- doxygen_win32
|   |-- doxymock
|   |-- doxyuml
|   |-- jdk_1.6_linux
|   `-- pclint_win32
|-- SYSTEM_BIN_2
|   `-- mips4k_gcc_x86_linux_hound
|-- THIRD_PARTY_LIBRARIES
|   |-- BSKYB_JTH
|   |-- CRAFTWORK_LAE
|   |-- MODEM_WIPRO_CMP
|   |-- PPPD_WIPRO_CMP
|   |-- S3_WLM
|   `-- SKELMIR_CEEJVM
|-- VGV
|   `-- VGV_DARWIN


comp-JPA
comp-JVM

# CMS_PLATFORM_SERVICES
comp-AEM
cpmp-GFX

# CMS_SYSTEM_RESOURCE
comp-RMF
comp-PDM

# DARWIN_PLATFORM
comp-ATG
comp-GUIDE
comp-FEM
comp-MCM
comp-MDM
comp-MEMMAN
comp-OFS

# CMS_MEDIA_SERVICES
comp-MSM
comp-VRM

# CMS_SYSTEM_INFRASTRUCTURE
comp-DIAG
comp-NCM
comp-DHCP
comp-UPNP

comp-SBM
comp-SFM
comp-SIM
comp-SPM
comp-SRM
comp-PLAYER
comp-PLANNER
comp-PSCHED
comp-SYSTEMUTIL
comp-SYSTEMTIME
comp-SYSINIT
comp-WLM

# CMS_INFORMATION_SERVICES
comp-DBENGINE
comp-PCAT

# CA
comp-VGV
comp-CAMM

# FUSIONOS
comp-HELPER


={============================================================================
|kt_dev_si_0001| comp-term

ATG   Anytime Guide
CTM   Content Transfer Management
DLM   Download Management
DSM   Disk Space Management
PCAT  Program Catalogue
PDL   Progressive Download
PPC   Progressive Playback Control
PPV   Pay Per View
PVOD  Push Video On Demand
PVR   Personal Video Recorder
RB    Review Buffer
RMF   Resource Management Framework
SBM   System Booking Management
SIM   Service Information Management
SPM   System Platform Management
SRM   System record manager
URI   Uniform Resource Identifier
VGC   VideoGuard Client
VGV   VideoGuard Verifier
VRM   Viewing And Recording Management
SCI   Service Component Information


={============================================================================
|kt_dev_si_0001| comp-cdi comp-ioctl

-DCDI_IOCTL_DEFINITIONS="/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/ioctl_magic.h" 

~/STB_SW/FUSIONOS/CDI_INC/include$ ls 
audienceresearch.h     cawd.h                 demuxcommon.h            fpindicator.h         multiplexer.h    raspdemuxraspcontrol.h        serial.h               vgdemuxicamcontrol.h
audiocapture.h         cawd_ioctl.h           demuxcontrol.h           fpsegmenteddisplay.h  muxer.h          raspdemuxrasp.h               spdifformatter.h       vgdemuxicamdescrambler.h
audiodecoder.h         cdi_errno.h            demuxdescrambler.h       fptextdisplay.h       nskcmchannel.h   raspdemuxraspindexer.h        surface.h              vgdemuxicamecmfilter.h
audioencoder.h         cdi_net_if.h           demuxelementaryfilter.h  frontendcommon.h      nskcmgroup.h     rasp_ioctl.h                  svpcpmchannel.h        vgdemuxicamemmfilter.h
audiomixer.h           cdi_stdint.h           demuxinput.h             gpdmachannel.h        nskemmfilter.h   relays.h                      svpcpmcontrol.h        vg_ioctl.h
audiooutputencoder.h   cdi_sys_socket.h       demuxoutput.h            graphics.h            nsk.h            remod.h                       svp_ioctl.h            vgscreader.h
audiooutput.h          cdi_sys_types.h        demuxremux.h             hddac.h               nsk_ioctl.h      resetcontrol.h                svpnsk.h               videodecoder.h
audiopostprocessor.h   clocksync.h            demuxsectionfilter.h     hdmi.h                nskm2mchannel.h  rf4cecommon.h                 swdownload.h           videoencoder.h
audiovolumeleveller.h  cmchannel.h            demuxtpidfilter.h        ieee1394.h            nskm2mgroup.h    rf4cecontrol.h                switch.h               viewport.h
avinlet.h              cmgroup.h              demuxtschannel.h         iframedecoder.h       nskotp.h         rf4cegenericrw.h              temperaturesensors.h   vi_properties.h
avmixer.h              cmmapper.h             denc.h                   imagedecoder.h        nskscreader.h    rf4cehid.h                    tpidproxy.h            watermarkingchannel.h
avoutlet.h             cmtcontrol.h           digitaloutlet.h          ipdatagramreader.h    nsktpidproxy.h   rf4cemso.h                    transcodeoutput.h      watermarkingcontrol.h
avoutputcommon.h       common.h               digitaloutput.h          ipfrontend.h          nvram.h          rf4cezrc.h                    tuner.h                watermarking_tables.h
blender.h              common_ioctl.h         digitiser.h              irblaster.h           oobcommon.h      rtc.h                         userinput.h
blitter.h              contiguousmemory.h     dvbcicontroller.h        keyladder.h           oobrx.h          sarfttunerabss.h              vbi.h
bskyb_ioctl.h          cryptocommon.h         dvbci_ioctl.h            lnb.h                 oobtx.h          sarftvideodecoderavs.h        versioninformation.h
bskybswdownload.h      cryptodma.h            dvihdmi.h                m2mchannel.h          otp.h            scart.h                       vgdemuxcommon.h
bskybtuner.h           decoderstreamformat.h  encodermuxercommon.h     m2mgroup.h            pcm_format.h     screader.h                    vgdemuxcontrol.h
bslcomm.h              demuxchunkinput.h      esprocessor.h            masterclock.h         pcmplayer.h      secondaryscramblingchannel.h  vgdemuxdescrambler.h
bslcomm_tables.h       demuxclockfilter.h     flash.h                  mpegencoder.h         power.h          secondaryscramblingcontrol.h  vgdemuxecmcorruptor.h


={============================================================================
|kt_dev_si_0001| comp-build enable-comp-diag

NDS_BUILD_SYSTEM=FUSION 

NDS_BUILD_PROJECT=picasso NDS_PLATFORM=AMS_BCM_MIPS4K_LNUX_DARWIN_01 NDS_ROOT=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build NDS_PROJECT=picasso NDS_BUILD_ROOT=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso NDS_BUILD_TYPE=debug make makefile

NDS_ROOT_UNIX=/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build NDS_LOCAL_TOOLS= 

NDS_STB=  NDS_HOST=linux NDS_MAKE=make --debug NDS_PARALLEL=1 NDS_BUILD_TYPE_DEFAULT=release_dbg NDS_DEFINES="" NDS_LOCATION=ST COMPONENTS_DIR="/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components" NDS_TOOLS_ROOT="/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build" VOB_ROOT="/home/NDS-UK/kyoupark/STB_SW" VOB_ROOT_UNIX="/home/NDS-UK/kyoupark/STB_SW" PLATFORMS_TOOLS_ROOT="/home/NDS-UK/kyoupark/STB_SW" NDS_FUSIONOS="FUSIONOS_2" NDS_FUSIONOS_PRE="FUSIONOS" NDS_FUSIONOS_VER=" _2" NDS_USE_CCACHE= NDS_USE_REL_PATHS= NDS_CCACHE_EXE= NDS_HOST_CC=/usr/bin/ NDS_TARGET:=install install

<component-makefile>

Each component makefile defines:

$/comp/src/makefile

  COMPONENT_NAME := darwin_planner_src
  COMPONENT_CC_DEFINES :=

  # this starts the process of refering global make files.
  include $(NDS_ROOT)/projects/$(NDS_PROJECT)/build_options.mk
  # see  *build-options-mk* *enable-comp-diag*

  // include $(NDS_ROOT)/projects/fusion2/build_options.mk
  {
    // For example, suppose build "darwin_planner_src" and if NDS_BUILD_TYPE
    // is defined for this component, define macros for debug diag build.
    //
    // ifeq (NDS_BUILD_TYPE_darwin_planner_src, debug)

    ifeq ($(strip $(NDS_BUILD_TYPE_$(COMPONENT_NAME))),debug)
      GLOBAL_DEFINES += DEBUG
      GLOBAL_DEFINES += DIAG_DEBUG    *diag-debug*
    endif

    ifeq ($(strip $(NDS_BUILD_TYPE_$(COMPONENT_NAME))),release)
      GLOBAL_DEFINES += RELEASE
      ifeq (YES,$(DIAG_RELEASE_MIL))
        GLOBAL_DEFINES += DIAG_RELEASE_MIL
      else
        GLOBAL_DEFINES += DIAG_RELEASE
      endif
    endif

    ifeq ($(strip $(NDS_BUILD_TYPE_$(COMPONENT_NAME))),release_dbg)
      ifeq (YES,$(DIAG_ENABLE_ALL_LEVELS))
        GLOBAL_DEFINES += RELEASE_DBG
        GLOBAL_DEFINES += DIAG_DEBUG
      else
        GLOBAL_DEFINES += RELEASE_DBG
        GLOBAL_DEFINES += DIAG_RELEASE_DBG
      endif
    endif
  }


<platform-mk>
// FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/platform.mk

LOCAL_PLATFORM_CC_DEFINE_FLAGS += $(COMPONENT_CC_DEFINES:%=-D%)

ifeq ($(NDS_BUILD_TYPE_$(COMPONENT_NAME)), debug)
  LOCAL_PLATFORM_CC_FLAGS += -O0
else
  ifneq ($(NDS_GCOV_$(COMPONENT_NAME)), YES)
    LOCAL_PLATFORM_CC_FLAGS += -Os
  endif
  LOCAL_PLATFORM_CC_FLAGS += -fno-strict-aliasing
endif

LOCAL_PLATFORM_CC_FLAGS += $(LOCAL_PLATFORM_CC_DEFINE_FLAGS)


// note: to print custom message in make

##################################################################
#
# Dependency builder.Notice that the generated dependency file
# is placed in the build tree.
# gcc is used to build dependencies using the MM option.
# The MT option specifies the name of dependent file.
# Dependency generation works in the same way on all platforms.
#
##################################################################

define PLATFORM_CC_BUILD_DEPENDENCY                                                                                                                                                                        
  @$(COMMANDS_MKDIR_EX) $(dir $@)
  @echo +++ Message from $(NDS_PLATFORM)/platform.mk - building dependencies for $@
  $(LOCAL_PLATFORM_CC) -MM $(LOCAL_PLATFORM_DEP_FLAGS) -MT $@ $< -o $(@:$(PLATFORM_OBJ_SUFFIX)=$(PLATFORM_DEPS_SUFFIX))
endef

<build-option-compile> <build-defines>
# +++ Message from AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform.mk - 
# building dependencies for /home/NDS-UK/kyoupark/STB_SW/\
# FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/\
# /AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components/\
# darwin_platform_components/darwin_player/src/player_xx_.o

@472
define PLATFORM_CC_BUILD_OBJECT
     echo +++ Message from $(NDS_PLATFORM)/platform.mk - Creating object $@
     echo "KT: $(LOCAL_PLATFORM_CC) $(LOCAL_PLATFORM_CC_FLAGS) $(COMMON_CC_FLAGS) -c $< -o $@"
     $(LOCAL_PLATFORM_CC) $(LOCAL_PLATFORM_CC_FLAGS) $(COMMON_CC_FLAGS) -c $< -o $@
endef

// as of 02/09/2016
//
KT:CC: /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gcc 
-Os -fno-strict-aliasing -Wall -g -fno-builtin -DNeedFunctioPrototypes=1 -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations   

-DAPP_MGMT_SIGNAL_24_7_SERVICE_TYPE_82H -DAPP_MGMT_SIGNAL_ETV_OTV_TRIGGER_MOD -DAPP_MGMT_SIGNAL_RECOMMENDATION_OTV_PROMO_MOD 
-DAUTHENTICATION_NDS_SAC -DBSKYB_SUPPORT_HEP_WITH_OIG -DCALLBACK_PSTN -DCAPTION_TELETEXT_LEGACY_LAYOUT -DCAROUSEL_MHC -DCAROUSEL_OTV -DCA_VIDEOGUARD_NDS_SECURE_RETURN_PATH 
-DCA_VIDEOGUARD_PARENTAL_RESTRICT -DCA_VIDEOGUARD_WATERSHED -DFRONT_END_DTT_USB -DFRONT_END_SAT 
-DFRONT_END_SAT_SCR -DFUSION_APP_MGMT_SUPPORTED -DFUSION_AUTHENTICATION_SUPPORTED -DFUSION_BDL_SUPPORTED 
-DFUSION_CA_VIDEOGUARD_SUPPORTED -DFUSION_DYNAMIC_TSA_SUPPORTED -DFUSION_HEADEND_METADATA_SUPPORTED 
-DFUSION_HOME_NETWORK_SUPPORTED -DFUSION_METADATA_SUPPORTED -DFUSION_NETWORK_SUPPORTED -DFUSION_PDL_SUPPORTED 
-DFUSION_PVOD_SUPPORTED -DFUSION_PVR_SUPPORTED -DFUSION_TARGETED_MESSAGING_SERVICE_SUPPORTED 
-DFUSION_USER_ACTIVITY_SUPPORTED -DFUSION_VIDEOGUARD_NOTIFY_SUPPORTED -DFUSION_VWS_SUPPORTED -DGUIDE_BSKYB_FORMAT_LOGICAL_CHAN_NO 
-DGUIDE_BSKYB_SUBSCRIBER_PROPERTIES_USED -DHEADEND_METADATA_OIGC -DHOME_NETWORK_MEDIA_RENDERER 
-DHOME_NETWORK_PLANNER_SERVER -DHOME_NETWORK_REMOTE_UI -DHOTPLUG_SUPPORT -DIPPV -DMCM_PVR_RECORD_CA_HOLES 
-DMETADATA_SI_XSI_SSR -DNETWORK_CONFIGURE_LAN -DPDL_NDS_SECURE_AUTH -DPLAYER_PIN_HANDLING_A 
-DPLAYER_REMOTE_UI_HTTP -DPVOD_LINEAR_TRANSPORT -DPVR_CHECK_XTV_STATUS -DPVR_CLASSIC_REVIEW_BUFFER 
-DSERIES_IMPLICIT_SERIES_DELETION -DSERIES_SYNCHRONIZE_BOOKINGS_WITH_SIGNUPS -DSI_SERVICE_SCAN_XSI 
-DSOFTWARE_DOWNLOAD_OTV -DSRM_ELEMENTARY_STREAMS_SELECTION_A -DSRM_USE_PI_SCHEDULE_FLAG_FOR_AVAILABILITY 
-DUSBTUNER_SUPPORTED -DUSB_SUPPORTED -DUSER_ACTIVITY_BARB -DUSER_ACTIVITY_SSP 
-DWIFI_SUPPORTED -DWLM_SUPPORTED -DRELEASE_DBG -DDIAG_RELEASE_DBG 
-DDIAG_MIN_FOOTPRINT -DOTV_CAROUSEL_SUPPORTED -DXSI_SUPPORTED -DLINT_ERRORS_ONLY= 
-DLINT_RESTORE= -DPROFILE_A -DDIAG_LOG_NDEBUG -DNDEBUG -DMEMMAN_TRUSTED_CLIENT 
-DGFX_NO_SHAPE -DGFX_IMAGE_NO_DITHERING -DGFX_PAINTER_NO_ARGB16_4444 
-DGFX_PAINTER_NO_ARGB16_4444_PREMULT -DGFX_PAINTER_NO_RGB16_565 
-DGFX_PAINTER_NO_SURFACE_RW -DMSCQ189287_CLOCK_MONOTONIC_NOT_SUPPORTED 
-DCQ171339 -DLEGACY_MIGRATION_SUPPORT -DSUN_BUILD -DNDS_APP_TYPE_PICASSO 
-DDIAG_JAVA_DEBUG -D_XOPEN_SOURCE=600 -DAMS_BCM_MIPS4K_LNUX_DARWIN_01 
-DFUSION_PROFILE -DMEMMAN_TRUSTED_CLIENT -DMSCQ1854424_SP_SCHEMA_ONLY 
-DMSCQ2375670_SET_PROVIDER_CLASS_MEMBERSHIP -DCQ380004_USE_STB_SW_01 
-D`MEMMAN_FORCE_USE_MALLOC_DIRECTLY` -DBUILDING_DISK_PARTITION 

-DCDI_IOCTL_DEFINITIONS="/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/ioctl_magic.h" 
-DCDI -DIS_BIG_ENDIAN -D__BIG_ENDIAN -D_XOPEN_SOURCE=600 -D__USE_XOPEN2K -D_GNU_SOURCE 

-I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/fusion2/helper_libraries/storage_helper/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_S
YSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemcommon/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemlang/
inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemlocator/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/b
uild/components/system_libraries/systemutil/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemstring/inc -I/home/NDS-UK/kyoupark/STB_SW/FU
SION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemtime/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemi
tc/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemconfig/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION
/build/components/system_libraries/systemobject/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/diag/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION
_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/memman/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemitc/inc -
I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/ssm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/
components/system_libraries/ipc/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/common_middleware/xipc/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRA
TION/BSKYB_INTEGRATION/build/components/system_control_and_diagnostics/sysinit/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/pdm/i
nc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_resource_management/pdm/src/server/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INT
EGRATION/build/components/system_resource_management/pdm/src/common/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/tests/CUnit-2.0-2/CUnit/Headers -I/home/NDS
-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/components/system_libraries/systemalarm/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linu
x/inc/CDI_INC/include -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BL
D_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc -I/home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/inc/nds -include /home/NDS-UK/kyoupark/STB_SW/FUSIONOS_2/
BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/nds/inc/clocks.h -ffunction-sections -fdata-sections   -c /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSK
YB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/components/system_resource_management/pdm/makefile_generated_config.c -o /home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTE
GRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components/system_resource_management/pdm/src/disk_partition//home/NDS-UK/kyoupark/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION
/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/components/system_resource_management/pdm/makefile_generated_config.o

// $(LOCAL_PLATFORM_CC)
// /STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/\
// linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-linux-uclibc-gcc,
//
// $(LOCAL_PLATFORM_CC_FLAGS)
// -Os -fno-strict-aliasing -Wall -g -fno-builtin -DNeedFunctioPrototypes=1 \
// -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes \
// -Wmissing-declarations -DAPP_MGMT_SIGNAL_24_7_SERVICE_TYPE_82H 
// -DAPP_MGMT_SIGNAL_ETV_OTV_TRIGGER_MOD 
// ...
// -D_GNU_SOURCE \
// -I/... -ffunction-sections -fdata-sections,
//
// $(COMMON_CC_FLAGS)
// -DDIAG_FILE_ID=111, 
//
// -c aem_version.c 
// -o ../build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/\
// components/platform_management/aem/src/aem_version.o

<build-option-link>
define PLATFORM_BUILD_PROCESS_FROM_OBJECTS
    @echo +++ Message from $(NDS_PLATFORM)/platform.mk Linking Process $@
    @echo "KT: $(LOCAL_PLATFORM_LD) -Xlinker -Map -Xlinker $@.map -Xlinker --start-group $(^:$(PLATFORM_LIB_PREFIX)%$(PLATFORM_LIB_SUFFIX)=-l%) $(LOCAL_PLATFORM_PROCESS_LD_FLAGS) -Xlinker --end-group -o $@"
    $(LOCAL_PLATFORM_LD) -Xlinker -Map -Xlinker $@.map -Xlinker --start-group $(^:$(PLATFORM_LIB_PREFIX)%$(PLATFORM_LIB_SUFFIX)=-l%) $(LOCAL_PLATFORM_PROCESS_LD_FLAGS) -Xlinker --end-group -o $@
endef

PLATFORM_STRIP := $(COMPILER_ROOT)/bin/$(MIPS)-linux-uclibc-strip

# BUILD_SYSTEM/COMMON_MAKEFILES/process.mk
ifeq (YES,$(NDS_STRIP_PROCESS))
define LOCAL_PROCESS_STRIP_PROCESS
    $(COMMANDS_MKDIR) $(NDS_BUILD_ROOT)/$(NDS_PLATFORM)/$(NDS_PLATFORM_ENDIAN)/unstripped_processes
    $(COMMANDS_CP) $@ $(NDS_BUILD_ROOT)/$(NDS_PLATFORM)/$(NDS_PLATFORM_ENDIAN)/unstripped_processes/$(notdir $@)
    @echo Removing debug information from $@
    $(PLATFORM_STRIP) $@
endef


={============================================================================
|kt_dev_si_0001| comp-build-define

To set defines for a component, change component's makefile

COMPONENT_CC_DEFINES :=PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
COMPONENT_CC_DEFINES +=PCAT_LOG_POSSIBLE_VL_LEAKS                             

 
={============================================================================
|kt_dev_si_0001| comp-jpa

# diag.cfg
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/fs/NDS/config
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk

<jpa-package>
package com.nds.fusion.atg;

import com.nds.fusion.RetrievalCallback;
import com.nds.fusion.systemcommon.Abortable;
import com.nds.fusion.systemcommon.SystemCommonObject;
import com.nds.fusion.systemcommon.SystemException;
import com.nds.fusion.systemlocator.SystemLocator;

./THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion

drwxr-xr-x 20 kyoupark ccusers  4096 Sep 26 12:05 ./
drwxr-xr-x  3 kyoupark ccusers  4096 Sep 26 12:05 ../
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 aem/
-r--r--r--  1 kyoupark ccusers   955 Sep 26 12:05 ApiFactory.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 atg/
-r--r--r--  1 kyoupark ccusers   235 Sep 26 12:05 BroadcastTimeClock.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 diag/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 dlm/
-r--r--r--  1 kyoupark ccusers   223 Sep 26 12:05 Factories.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 guide/
-r--r--r--  1 kyoupark ccusers   363 Sep 26 12:05 NativeCallback.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 ofs/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 pdm/
drwxr-xr-x  2 kyoupark ccusers 12288 Sep 26 12:05 planner/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 player/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 prefs/
-r--r--r--  1 kyoupark ccusers   602 Sep 26 12:05 ReflectiveReferenced.java
-r--r--r--  1 kyoupark ccusers  1083 Sep 26 12:05 RetrievalCallback.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 spc/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 spm/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 27 10:09 systemcommon/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 systemlang/
-r--r--r--  1 kyoupark ccusers   144 Sep 26 12:05 SystemLangFactory.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 systemlocator/
-r--r--r--  1 kyoupark ccusers   277 Sep 26 12:05 SystemLocatorFactory.java
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 systemtime/
-r--r--r--  1 kyoupark ccusers   458 Sep 26 12:05 SystemTimeFactory.java
-r--r--r--  1 kyoupark ccusers   510 Sep 26 12:05 TooLateException.java
drwxr-xr-x  5 kyoupark ccusers  4096 Sep 26 12:05 vgc/
drwxr-xr-x  2 kyoupark ccusers  4096 Sep 26 12:05 wlm/


# JPA VTABLE(jpa_vtable.c)
#
# NOTE: node handle keeps increasing when created and not to be decreased when
# released. Each vtable has its own handleseed!  this means that need to have
# vtable and node handle to locate a unique node/element.
#
# NOTE: it will alloc note and element when creation is called. node size is 24
# bytes.
#

# VTable_t g_planner_adaptor_IteratorCreateRequest;
#
# INIT: just initialize vtable struct
#
# JPA_VTABLE_InitTable
# ((VTable_t*)&g_planner_adaptor_IteratorCreateReques,
# g_planner_native_mem_pool,
# g_planner_adaptor_api_diag_segment_id,
# NULL,JPA_VTABLE_MAX_UNBALANCED_ADDS)

# CREATE: 
# 	MEMMAN alloc the given size from the pool assigned when initialized and this is new element.
# 	MEMMAN alloc the VTNode(24 bytes) from the pool assigned when initialized and keep this new element's ptr in the node.
# 	return vtable node handle which is increments from its global vtable struct.
# 	return ptr of new element.
#
# out: el(element ptr), handle(node handle(idx) of the vtree).
# JPA_VTABLE_Create(&g_planner_adaptor_IteratorCreateRequest, &iteratorCreateRequest, &vtable_handle,sizeof(PLANNER_JAVA_ITERATOR_CREATE_REQUEST))
# JPA_VTABLE_Create(VTable_t* vtable, void **el, uint32_t *handle, size_t size)
#
# GET ELEMENT:
# 	traverse vtable binary tree using the given node handle, increase node's ref count and return note's ptr(that's element's ptr)
#
# JPA_VTABLE_GetElement(const VTable_t* vtable, uint32_t handle, void **el)
#
# FIND ELEMENT:
# 	traverse vtable tree using the given data ptr(element) and return data ptr(ele) and node handle. Basically to get node handle.
#
# JPA_VTABLE_FindElement(const VTable_t* vtable, VTABLE_CheckElementFunc check, void *data, void **el, uint32_t *handle)
#
# RELEASE ELEMENT:
# 	traverse vtable tree using the given handle and "free" element when node's ref count is 1 and decrease ref count to 0.
#
# JPA_VTABLE_ReleaseElement(VTable_t* vtable, uint32_t handle)

1. when vtable created, ref count of node is 1.
2. function calls which increases/decrease ref count:
	JPA_VTABLE_Create
		CreateNode # 32 bytes in MEMMAN alloc
	JPA_VTABLE_GetElement	
	JPA_VTABLE_ReleaseElement
	JPA_VTABLE_FindElement


={============================================================================
|kt_dev_si_0001| comp-jpa-print-systemstring

# How to print out systemstring

SYSTEM_STATUS KT_SYSTEMCOMMON_Print_SysString(SYSTEMSTRING_Handle l_SysString)
{
    uint8_t     * l_byte_array = NULL;
    uint32_t      l_byte_length= 0U;
    SYSTEM_STATUS l_result = SYSTEMSTRING_STATUS_FAILED;
    uint16_t    * l_unicode_array = 0U;
    uint32_t      i = 0U;
    uint32_t      j = 0U;
    SYSTEMSTRING_Encoding l_encoding = SYSTEMSTRING_ENCODING_UNDEF;

    DIAG_DECLARE_FUNCTION("KT_SYSTEMCOMMON_Print_SysString");

    /* NOTE: If this is being modified, it should be updated to use SYSTEMSTRING's ability
     * to return UTF16 instead of doing the conversion here.
     */
    if (SYSTEMSTRING_NULL_HANDLE == l_SysString)
    {
        l_result = SYSTEMSTRING_STATUS_OK;
    }
    else if (SYSTEMSTRING_GetEncoding((SYSTEMSTRING_Handle)l_SysString, &l_encoding) != SYSTEMSTRING_STATUS_OK)
    {
        DIAG_LOG_ERROR(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: SYSTEMSTRING_GetEncoding failed"));
    }
    else if (SYSTEMSTRING_GetByteLength((SYSTEMSTRING_Handle)l_SysString, l_encoding, &l_byte_length) != SYSTEMSTRING_STATUS_OK )
    {
        DIAG_LOG_ERROR(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: SYSTEMSTRING_GetByteLength failed"));
    }
    else if (l_byte_length == 0U)
    {
	    l_result = SYSTEMSTRING_STATUS_OK;
        DIAG_LOG_ERROR(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: l_byte_length(%d)", l_byte_length ));
    }
    else
    {
        l_byte_array = MEMMAN_API_AllocStaticP(g_systemcommon_mem_pool,l_byte_length);

        if (NULL != l_byte_array)
        {
			/* here are changes */
            if (SYSTEMSTRING_GetBytes((SYSTEMSTRING_Handle)l_SysString,
                l_encoding, l_byte_length, &l_byte_length, l_byte_array ) == SYSTEMSTRING_STATUS_OK)
            {
                    DIAG_LOG_WARN(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: l_encoding(%d), str(%s)", l_encoding, (char*)l_byte_array ));
            }
            else
            {
                DIAG_LOG_ERROR(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: Could not get bytes"));
            }

            (void)MEMMAN_API_FreeStaticP(g_systemcommon_mem_pool, l_byte_array);
        }
        else
        {
            DIAG_LOG_FATAL(g_systemcommon_adaptor_api_diag_segment_id, ("KT_SYSTEMCOMMON_Print_SysString: Failed to allocate memory 0x%x",SYSTEMCOMMON_JAVA_getLeakCount()));
        }
    }

    return l_result;
}

void PLANNER_JAVA_ApiBookedProgrammeGetString(NDSJNI_ENV *l_env)
{
    jint jHandle     = *((jint*)(l_env->params[0]));
    jint jPropertyID = *((jint*)(l_env->params[1]));

    SYSTEMSTRING_Handle l_string = SYSTEMSTRING_NULL_HANDLE;
    jstring jString              = NULL;
    SYSTEM_STATUS status         = PLANNER_API_STATUS_NOT_OK;

    DIAG_DECLARE_FUNCTION("PLANNER_JAVA_ApiBookedProgrammeGetString");
    DIAG_LOG_FN_ENTRY(g_planner_adaptor_api_diag_segment_id);

    status = PLANNER_API_BookedProgramme_GetPropertyString(
        (PLANNER_API_BookedProgramme_Handle)jHandle,
        (PLANNER_API_BookedProgramme_PropId)jPropertyID,
        &l_string);

    if (!SYSTEM_STATUS_IS_OK(status))
    {
        DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("PLANNER_API_BookedProgramme_GetPropertyString failed: 0x%x",status));
    }
    else
    {
		### HERE ###
        KT_SYSTEMCOMMON_JAVA_SysStringtoJavaString(l_env, l_string, &jString);
		
        if (!SYSTEM_STATUS_IS_OK(SYSTEMCOMMON_JAVA_SysStringtoJavaString(l_env, l_string, &jString)))
        {
            DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("Failed to create Java string"));
            status = PLANNER_API_STATUS_NOT_OK;
        }
        else
        {
            /* success */
        }

        (void)SYSTEMSTRING_Destroy(l_string);
    }

    l_env->returnVal = (uint32_t)jString;

    (void)PLANNER_JAVA_ParseReturn(l_env, status);

    DIAG_LOG_FN_EXIT(g_planner_adaptor_api_diag_segment_id, status);
}


void KT_PRINT_SYS_STRING(DIAG_LOG_uiSegmentId_t segment_id, SYSTEMSTRING_Handle str_handle)
{
	SYSTEM_STATUS status;
	SYSTEMSTRING_Encoding encoding = SYSTEMSTRING_ENCODING_UNDEF;
	uint32_t max_length = 0U, actualLength = 0U;
	uint8_t buffer[256] = {0}; /* limit the print buffer size */

	DIAG_DECLARE_FUNCTION("KT_PRINT_SYS_STRING");

	if(str_handle == SYSTEMSTRING_NULL_HANDLE){
		DIAG_LOG_ERROR(segment_id,("string = SYSTEMSTRING_NULL_HANDLE"));
		return;
	}

	status = SYSTEMSTRING_GetEncoding(str_handle, &encoding);

	if (SYSTEM_STATUS_IS_OK(status))
	{
		status = SYSTEMSTRING_GetByteLength(str_handle ,encoding, &max_length);	
	}

	if ( (max_length > 0U) && (SYSTEM_STATUS_IS_OK(status)))
	{
		status = SYSTEMSTRING_GetBytes(str_handle,encoding, 256U,&actualLength,buffer);
	}

	/* make sure there is a null terminator at end of buffer for print */
	if(SYSTEM_STATUS_IS_OK(status)){
		if(actualLength>256U){
			buffer[255U] = 0U;
		}else{
			buffer[actualLength] = 0U;
		}
	}else{
		buffer[0] = 0U;
	}
	
	DIAG_LOG_ERROR(segment_id,("KT_PRINT_SYS_STRING: string = %s",buffer));
}


#
# DARWIN_PLATFORM\DARWIN_DIAG_JAVA
#

# as of Jan. 2012
#
(DiagFactory.java)
final public class DiagFactory 
{
	private final String DEFAULT_SEGMENT = "J_GC";


NDS_BUILD_TYPE_darwin_diag_native = debug
#define DIAG_JAVA_DIAGNAME "JDiag"
#
# use this call for all levels except info from Picasso
logChunksExtended
	Java_com_nds_fusion_diagimpl_DiagImpl_natLogExt
		DIAG_JAVA_natLogExt

# APP is actually using different diag segment and this causes confusion.
#
J_GC                |  on   | _ _ E W _ _ _ _ _ _ _

\DARWIN_PLATFORM\DARWIN_SYSTEMCOMMON_JAVA\impl\SystemCommonObjectImpl.java
	public static Diag diag = DiagImpl.create("J_GC", Diag.Trace.WARN | Diag.Trace.ERROR ); /*singleton instance, there can't be more than one DIAG Instance with the same segment name */
	protected boolean isValid = false; /* isValid and nativeHandle are protected because they need to be visible in derived classes so can be set directly from C code*/

DiagImpl.java
    public static Diag create(String segmentName, int traceBitPattern)
    {
        Diag newDiag = create(segmentName);
        newDiag.setTraceSettings(traceBitPattern);
        return newDiag; 
    }

# lists as of 14 Sept 2011
#
**KT: DIAG_JAVA_natCreate(l_string:J_GC, pSegmentID:0xbeef005a
**KT: DIAG_JAVA_natCreate(l_string:PICASSO, pSegmentID:0xbeef006a
**KT: DIAG_JAVA_natCreate(l_string:EPG_PRFM, pSegmentID:0xbeef006b
**KT: DIAG_JAVA_natCreate(l_string:MST_SSR, pSegmentID:0xbeef006c
**KT: DIAG_JAVA_natCreate(l_string:MST_ET, pSegmentID:0xbeef006d
**KT: DIAG_JAVA_natCreate(l_string:EPG_ANYT, pSegmentID:0xbeef006e
**KT: DIAG_JAVA_natCreate(l_string:EPG_ME, pSegmentID:0xbeef006f
**KT: DIAG_JAVA_natCreate(l_string:EPG_CONF, pSegmentID:0xbeef0070
**KT: DIAG_JAVA_natCreate(l_string:EPG_SCR, pSegmentID:0xbeef0071
**KT: DIAG_JAVA_natCreate(l_string:EPG_KEY, pSegmentID:0xbeef0072
**KT: DIAG_JAVA_natCreate(l_string:MST_DFIL, pSegmentID:0xbeef0073
**KT: DIAG_JAVA_natCreate(l_string:EPG_BOOK, pSegmentID:0xbeef0074
**KT: DIAG_JAVA_natCreate(l_string:EPG_LISD, pSegmentID:0xbeef0075
**KT: DIAG_JAVA_natCreate(l_string:MST_EVT, pSegmentID:0xbeef0076
**KT: DIAG_JAVA_natCreate(l_string:EPG_DEV1, pSegmentID:0xbeef0077
**KT: DIAG_JAVA_natCreate(l_string:EPG_UI, pSegmentID:0xbeef0078
**KT: DIAG_JAVA_natCreate(l_string:EPG_DEV2, pSegmentID:0xbeef0079
**KT: DIAG_JAVA_natCreate(l_string:EPG_TVVM, pSegmentID:0xbeef007a
**KT: DIAG_JAVA_natCreate(l_string:EPG_DEV3, pSegmentID:0xbeef007b
**KT: DIAG_JAVA_natCreate(l_string:EPG_DEV4, pSegmentID:0xbeef007c
**KT: DIAG_JAVA_natCreate(l_string:EPG_DEV5, pSegmentID:0xbeef007d
**KT: DIAG_JAVA_natCreate(l_string:EPG_DLG, pSegmentID:0xbeef007e
**KT: DIAG_JAVA_natCreate(l_string:PICO, pSegmentID:0xbeef007f
**KT: DIAG_JAVA_natCreate(l_string:EPG_PLAY, pSegmentID:0xbeef0080
**KT: DIAG_JAVA_natCreate(l_string:EPG_ALM, pSegmentID:0xbeef0081
**KT: DIAG_JAVA_natCreate(l_string:MST, pSegmentID:0xbeef0082
**KT: DIAG_JAVA_natCreate(l_string:EPG_LIST, pSegmentID:0xbeef0083
**KT: DIAG_JAVA_natCreate(l_string:MST_ASP, pSegmentID:0xbeef0084
**KT: DIAG_JAVA_natCreate(l_string:EPG_PRF, pSegmentID:0xbeef0085
**KT: DIAG_JAVA_natCreate(l_string:EPG_FS, pSegmentID:0xbeef0086
**KT: DIAG_JAVA_natCreate(l_string:EPG_MISC, pSegmentID:0xbeef0087
**KT: DIAG_JAVA_natCreate(l_string:MST_TEST, pSegmentID:0xbeef0088
**KT: DIAG_JAVA_natCreate(l_string:EPG_BAN, pSegmentID:0xbeef0089
**KT: DIAG_JAVA_natCreate(l_string:EPG_TVG, pSegmentID:0xbeef008a
**KT: DIAG_JAVA_natCreate(l_string:EPG_COMP, pSegmentID:0xbeef008b
**KT: DIAG_JAVA_natCreate(l_string:EPG_GNOM, pSegmentID:0xbeef008c
**KT: DIAG_JAVA_natCreate(l_string:EPG_CA, pSegmentID:0xbeef008d
**KT: DIAG_JAVA_natCreate(l_string:MST_AR, pSegmentID:0xbeef008e
**KT: DIAG_JAVA_natCreate(l_string:EPG_INIT, pSegmentID:0xbeef008f
**KT: DIAG_JAVA_natCreate(l_string:EPG_AFRM, pSegmentID:0xbeef0090
**KT: DIAG_JAVA_natCreate(l_string:VGC_JAVA, pSegmentID:0xbeef0091

<comp-jpa>
STB_SW/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/
/modules/jpa-impl/src/c/inc/natPlayerCommon.h
/modules/jpa-impl/src/c/src/natPlayerSessionImpl.c

#
# DARWIN_PLATFORM\DARWIN_PLAYER_JAVA
#
COMPONENT_NAME:= darwin_player_native
DARWIN_PLATFORM\DARWIN_GUIDE_JAVA\src\inc\natPlayerCommon.h: #define PLAYER_JAVA_DIAGNAME "J_PLAYER"


#
# DARWIN_PLATFORM\DARWIN_SYSTEMCOMMON_JAVA
#
COMPONENT_NAME:= darwin_systemcommon_native
\DARWIN_PLATFORM\DARWIN_SYSTEMCOMMON_JAVA\src\inc\natSystemCommon.h #define SYSTEMCOMMON_JAVA_DIAGNAME "J_SYSTEMCOMMON"
NDS: ^0946686835.523503 !ERROR -AIni         < 


#
# SYSINIT. From sysinit point of view, there is one 'ADAPTOR_INIT' component and it manages all actual jpa components. 
# So each jpa component is not SYSINT aware. 
#
ADAPTOR_INIT_AddRunlevelListeners(adaptor_init_list)
	f_adaptor_init_adaptors = adaptor_init_list

ADAPTOR_INIT_StartInitialiseListeners

ADAPTOR_INIT_RunLevelRequest
	ADAPTOR_INIT_MainThread
		SYSINIT_RunLevelRequestShutdown
			ADAPTOR_INIT_ChangeWrapperEndState
				f_adaptor_init_adaptors[i](newstate,&env)
					SYSINIT_API_NotifyRunLevelChanged


={============================================================================
|kt_dev_si_0001| comp-jvm comp-ceej

COMPONENT_NAME := javaengine

#
DIAG_LOG_RegisterTraceSegment("JAE", 3, NULL, &g_javaengine_segment_id)) 

# Function for initialising the JavaEngine component, and registering 
# its callbacks with the AEM component. 
#
jpa/modules/jvm-glue/src/c/src/je_aem.c

SYSTEM_STATUS JE_AEM_Register(void)
{
  .launch_fn              = JE_AEM_LaunchCallback,
  .user_input_fn          = JE_AEM_UserInputCallback,

  callback.terminate_fn = JE_TerminateFunctionCB; 
  callback.user_input_fn = JE_UserInputFunctionCB; 
  ...(more callbacks)

  AEM_API_RegisterApplicationEngine(callback); 
}


(vobs\THIRD_PARTY_LIBRARIES\BSKYB_JTH\build\engines\java\src\ceej_bsp.c)
JE_UserInputFunctionCB
	CEEJ_BSP_PostKeyEvent # point where pumping keys to app


<mem>
[JAVAENGINE_MEM_CONFIG]
POOL_FLAGS=123
POOL_NAME="JAVAENGINE"
POOL_SIZE=24117248

jpa/modules/jvm-glue/src/c/src/ceej_bsp.c

static BSP sBSPStorage = {
	.version                        = BSP_VERSION,

	.InitPostflight                 = InitPostflight,

	.Memory_Alloc                   = Memory_Alloc,
	.Memory_AllocCode               = Memory_AllocCode,
	.Memory_Dispose                 = Memory_Dispose,
	.Memory_DisposeCode             = Memory_DisposeCode,
	.Memory_TotalPhysical           = Memory_TotalPhysical,
	.Memory_MaximumHeapSize         = Memory_MaximumHeapSize,
};


/** -----------------------------------------------------------------------------*
* @function Memory_Alloc
*
* @description
* This method is used by the VM to allocate memory.  Since the VM
* has its own internal memory manager, it will only allocate
* large chuncks of memory with this method.
* 
* @param inBSP The BSP pointer.
* @param outPtr The returned memory allocated.
* @param inSize The amount of memory to allocate.
*                 
* @return Returns BSP_NOERR on success, BSP_ERR otherwise.  If
* successful, the pointer to the memory is returned in outPtr.
* -----------------------------------------------------------------------------*/
static ooInt BSPCALL Memory_Alloc(BSP* inBSP, void** outPtr, UInt32 inSize)
{
	return CEEJ_Memory_Alloc(outPtr,inSize);
}

jpa/modules/jvm-glue/src/c/src/ceej_mem.c

ooInt CEEJ_Memory_Alloc(void** outPtr, UInt32 inSize)
{
	DIAG_DECLARE_FUNCTION(__FUNCTION__);

 	if (hMemoryPool == 0L)
	{
		CEEJ_Memory_Init();
	}

	ooInt result = BSP_NOERR;
	*outPtr = MEMMAN_API_AllocStaticP(hMemoryPool, inSize);

	return result;
}


={============================================================================
|kt_dev_si_0001| comp-aem comp-iapp

https://www.stb.bskyb.com/confluence/display/PBFeatures/High+Level+Architecture+%3A+Launch+of+Interactive+Apps+over+IP

COMPONENT_NAME := aem

#
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/gaudi_orchid/build_options.mk
# picasso
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk

NDS_BUILD_TYPE_aem = debug

\components\platform_management\aem\src


AEM_API_STATUS_ERROR 0x421008

<key-pressed> <keycode>
/home/kyoupark/si-logs/theyard/bin/bskyb_charcodes

// these three are pair
!MIL    -aem          		< p:0x000001f6 P:APP t:0x01400520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(GREEN)e201 
!ERROR  -JAE          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:modules/jvm-glue/src/c/src/je_aem.c F:JE_AEM_UserInputCallback L:103 > KT: JavaEngine: Key pressed: 0xe303, type 0x1 
!MIL    -EPG_KEY      		< p:0x000001f6 P:APP t:0x2bfeb520 T:no name M:KeyProcessor F:keyPressed L:159 > T:CEE-J EventQueue Reader 0:Keycode is 1:GREEN x1 @946792115994-946792118495
!MIL    -EPG_MISC     		< p:0x000001f6 P:APP t:0x2bfeb520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": 
  "`KeyPressRemote`","action": "GREEN","title": "Key Press GREEN","label": "","currentscreen": "/tv/live/108/banner"}

NDS: ^MIL   -EPG_UI       < M:PresentationManager F:dispatchKey L:00739 > KEYPRESS 1:35 handled by Screen FULLSCREEN layer=0, id=0 View 458756
NDS: ^MIL   -EPG_UI       < M:PresentationManager F:dispatchKey L:00739 > KEYPRESS 1:145 handled by Screen FULLSCREEN layer=0, id=0 View 458756
NDS: ^MIL   -EPG_UI       < M:PresentationManager F:dispatchKey L:00739 > KEYPRESS 1:140 handled by Screen OPTIONS layer=3, id=8 View 65544

or

NDS: !MIL    -EPG_UI      < P:APP M:ScreenDirectingKeyListener F:dispatchKeyToViewOf L:57 > 
  T:CEE-J EventQueue Reader 0:KEYPRESS 1:PLAY x1 @946694137138-946694151311 handled by Screen FULLSCREEN layer=0, id=0 View 458756


#-----------------------------------------------------------
# internal
#-----------------------------------------------------------
# threads:
# AEM_StateMonitorThread
# AEM_InputMonitorThread
#
# rcu flows:
# GfxInputStartDirect->GfxInputDispatcher(poll)->GfxInputPostReadEvents(read)->
#
# (aem_userinput.c)
# AEM_InputMonitorThread::
# 	GFX_INPUT_EVENTBUFFER_WaitForEventWithTimeout 
# 	GFX_INPUT_EVENTBUFFER_GetEvent
#	
#	if(anEvent.type == GFX_INPUT_KEYPRESS) 
# 		DIAG_LOG_MIL(g_aem_segment_id, ("KEY_PRESS: code=0x%.4x", anEvent.key_code));
# 
#

THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jvm-glue/src/c/src/je_aem.c

/*----- Category: User input ----------------------------------------------------------------------*/

/**
 * @brief Defines a pointer to a function for passing user input to an application. This callback function is implemented by the application engine.
 * @param[in] application_handle - The handle of the application which is being specified to change to shown state.
 * @param[in] input_source - The Source of the input.
 * @param[in] key_code - The CDI keycode for the user input. The keycodes are defined in CDI header file <userinput.h>
 * @return A ::SYSTEM_STATUS - OK if the key has been handled, Not OK if it should be passed to the Default Application Engine
 */
SYSTEM_STATUS JE_AEM_UserInputCallback(AEM_API_ApplicationHandle application_handle,
			     AEM_API_UserInputSource input_source,
			     AEM_API_UserInputType event_type,
			     uint32_t key_code)
{
    int rv;
    int32_t inPressed;

	DIAG_DECLARE_FUNCTION(__FUNCTION__);
	DIAG_LOG_FN_ENTRY(g_javaengine_segment_id);

	TIMEDOCTOR_START_EVENT("SG11");

	(void)input_source;         /* We don't care where the keypress came from. */
	(void)application_handle;   /* We don't care where it's going either. */

	DIAG_LOG_INFO(g_javaengine_segment_id, ("JavaEngine: Key pressed: 0x%x, type 0x%x ",key_code, event_type));

    inPressed = (event_type != AEM_USER_INPUT_TYPE_KEYRELEASE) ? 1:0;
    rv = CEEJ_BSP_PostKeyEvent(key_code, inPressed, input_source);

	TIMEDOCTOR_STOP_EVENT("SG11");

	return (SYSTEM_STATUS)rv;
}


THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jvm-glue/src/c/src/ceej_bsp.c

int CEEJ_BSP_PostKeyEvent(uint32_t inKeyCode, int32_t inPressed, AEM_API_UserInputSource inInputSource)

# (to use a key to do something specific, see below. Need to edit 'AEM/inc/dependencies.mk' to include necessary files to compile.)
# MEMCHECK
#
# print out decimal as well as app use its decimal value
#
# if (anEvent.type == GFX_INPUT_KEYPRESS)
# {
# 	input_type = AEM_USER_INPUT_TYPE_KEYPRESS;
# 	DIAG_LOG_MIL(g_aem_segment_id, ("KEY_PRESS: code=0x%.4x", anEvent.key_code));
# 
# 	/* USER_INPUT_KEY_BACK */
# 	if((anEvent.key_code == 0xE002U) && (g_planner_native_mem_pool) )
# 	{
# 		DIAG_LOG_WARN(g_aem_segment_id, ("KT_JPA_UP: code=0x%.4x, free=%d", anEvent.key_code, MEMMAN_API_GetMemorySizeP(g_planner_native_mem_pool, MEMMAN_API_MemInfoPoolFreeSize) ));
# 		DUMP_USED_BLOCKS(g_planner_native_mem_pool);
# 		/*MemCheckMemory(g_planner_native_mem_pool, MEMSTATUS_LOGLEVEL(MEMMAN_API_MEMSTATUS_ALL, MEMSTATUS_LOGLEVEL_WARN)); */
# 	}
# }
# 
#
# (app)
#class KeyPressedTask implements Runnable
#{
#	public void run()
#	{
#		Zapper.getInstance().getKeyProcessor().keyPressed(keyEvent);
#	}
#}
# 
#
# (define app key codes)
# /Tools/CEUIFramework/src/java/picasso/framework/IKeyCode.java
#
(\Picasso\picasso\Picasso\src\java\picasso\ui\epg15\KeyProcessor.java)
(1)
public void setIgnoreKeyEvents(boolean b)
{
    LOGGER.logWarn("=" + b);
    System.err.println("KT: setIgnoreKeyEvents=" + b );
}

(2)
public void keyPressed(final KeyEvent e)
{
    System.err.println("KT: keyPressed=" + e.getKeyCode() );
    if (respondingToKeyPresses)
    {
        respondingToKeyPressed(e);
    }
    else
    {
        LOGGER.logInfo("We're in 'responding to key releases' mode', so ignoring key press "
                + e.getKeyCode());
    }
    e.consume();

}


(\Picasso\picasso\Picasso\src\java\picasso\ui\epg15\presentationmgr\PresentationManager.java)
public boolean dispatchKey(IKeyCode key)
{
}


# AEM_API_xxx is an interface to upper app(epg). from vobs/CMS_PLATFORM_SERVICES/AEM/inc/aem_api.h
# call shm_open for a promo
# The only case where AEM creates a shared memory object for Promo applications is when AEM_API_Signalling_GetParameters is called
# AEM_API_Signalling_GetParameters


# ADPT_AEM. g_vt_aem_adaptor_invite_listeners and g_vt_aem_adaptor_application_data
#

COMPONENT_NAME:= darwin_aem_native


DARWIN_ADAPTOR_AEM_AllocateMemory
[AEM_MEM_CONFIG]
GFX_PIXEL_FMT=0x00000002
POOL_FLAGS=123
POOL_NAME="ADPT_AEM"
POOL_SIZE=1000

# this pool is used only in AEM_JAVA_Invite_RegisterStateListener/AEM_JAVA_Invite_DeregisterStateListener
#
g_aem_native_mem_pool. 	/* ADPT_AEM */
=================================
AEM_JAVA_API_SetKeyFilterList
	MEMMAN_API_AllocStaticP(g_aem_native_mem_pool,)

DARWIN_ADAPTOR_AEM_Init	
	/* ADPT_AEM */
	DARWIN_ADAPTOR_AEM_AllocateMemory
		SYSTEMCOMMON_JAVA_AllocateMemory(&g_aem_native_mem_pool, AEM_JAVA_MEMORY_POOL_SECTION_NAME, sizeof(AEM_JAVA_MEMORY_POOL_SECTION_NAME))
	DARWIN_ADAPTOR_AEM_InitVTables
		DARWIN_ADAPTOR_AEM_InitVTable(&g_vt_aem_adaptor_invite_listeners,)
		DARWIN_ADAPTOR_AEM_InitVTable(&g_vt_aem_adaptor_application_data,)
			DARWIN_ADAPTOR_AEM_InitVTable
				JPA_VTABLE_InitTable(vtable, g_aem_native_mem_pool, g_aem_adaptor_diag_seg_id, NULL, JPA_VTABLE_MAX_UNBALANCED_ADDS)))

				
g_vt_aem_adaptor_invite_listeners. 
=================================
AEM_JAVA_Invite_RegisterStateListener: JPA_VTABLE_Create
AEM_JAVA_Invite_DeregisterStateListener: JPA_VTABLE_ReleaseElement
AEM_JAVA_InviteStateListener: JPA_VTABLE_GetElement and JPA_VTABLE_ReleaseElement

		uint32_t vtable_cnt=0;
		
		if(JPA_VTABLE_GetCount(&g_vt_aem_adaptor_invite_listeners, &vtable_cnt) != JPA_VTABLE_STATUS_SUCCESS)
		{
			DIAG_LOG_ERROR(g_aem_adaptor_diag_seg_id, ("JPA_VTABLE_GetCount failed" ));
		}
		
		DIAG_LOG_ERROR(g_aem_adaptor_diag_seg_id, ("KT: DSL: %d, %d", g_cnt_invite_listener, vtable_cnt ));

g_vt_aem_adaptor_application_data
=================================
		uint32_t vtable_cnt=0;
		
		/* KT */
		if(JPA_VTABLE_GetCount(&g_vt_aem_adaptor_application_data, &vtable_cnt) != JPA_VTABLE_STATUS_SUCCESS)
		{
			DIAG_LOG_ERROR(g_aem_adaptor_diag_seg_id, ("JPA_VTABLE_GetCount failed" ));
		}
		
		DIAG_LOG_ERROR(g_aem_adaptor_diag_seg_id, ("KT: AT: adata vtable %d", vtable_cnt ));
		/* KT */

AEM_JAVA_Application_Terminate: Find and Release
AEM_JAVA_ApplicationEventListener: AEM_API_ApplicationEventCreated and AEM_API_ApplicationEventDeleted. Callback from AEM.
AEM_JAVA_DeregisterCleanup_DeleteAllApplicationData: Clean Up.


# -2
public class ALMManager extends BaseManager implements IALMManager
{
	private EventListener					eventListener;
	...
	eventListener = new EventListener(EXECUTOR, model);
	...
}

# 0: DARWIN_AEM_JAVA/api/AemApplicationEventListner
public interface AemApplicationEventListener


# -1
public class EventListener implements IExecutorTaskDispatcher, AemApplicationEventListener
{
  ...
	public EventListener(IExecutor executor, InteractiveApplicationModel model)
	{
		tde = TaskDispatchingExecutorFactory.getInstance().create(executor, this);
		this.model = model;
	}
	public void register(AemApi aemApi)
	{
		##
		aemApi.registerApplicationEventListener(this, DUMMY_USERTAG);
	}
	...
}


# 1
public class AemApiImpl extends AemApi
{
	  ...
    public void registerApplicationEventListener(AemApplicationEventListener listener, Object userTag) 
    throws AemAlreadyRegisteredException
    {
        natAemRegisterApplicationEventListener(listener, userTag);
    }
    ...
}

# 2: DARWIN_AEM_JAVA/src_sun/sunnatAemRegisterNatives.c
const JNINativeMethod com_nds_fusion_aemimpl_AemApiImpl[]	=	{
  ...
    { (char*)"natAemRegisterApplicationEventListener",    (char*)"(Lcom/nds/fusion/aem/AemApplicationEventListener;Ljava/lang/Object;)V",
        (void*)Java_com_nds_fusion_aemimpl_AemApiImpl_natAemRegisterApplicationEventListener}, 
  ...
};

# 3: DARWIN_AEM_JAVA/src_sun/sunnatAemApiImpl.c
JNIEXPORT void JNICALL Java_com_nds_fusion_aemimpl_AemApiImpl_natAemRegisterApplicationEventListener
  (JNIEnv *THIS, jclass jClass, jobject param1, jobject param2)
{
    NDSJNI_ENV env;

    env.THIS = THIS;
    env.jClass = &jClass;
    env.params[0] = (void*)&param1; /* listener */
    env.params[1] = (void*)&param2; /* user tag */

    AEM_JAVA_API_RegisterApplicationEventListener(&env);
}

# 4: DARWIN_AEM_JAVA/src/natAemApiImpl.c
void AEM_JAVA_API_RegisterApplicationEventListener(NDSJNI_ENV *env)
{
        status = AEM_API_Application_RegisterStateChangeListener(AEM_JAVA_ApplicationEventListener,
                        (uint32_t)AEM_JAVA_APPLICATION_EVENT_LISTENER_USERTAG);
}


<application-engine>
// AE regiser callbacks to AEM so that AEM can call AE

typedef struct AEM_API_ApplicationEngineCallbackTag
{
  AEM_API_ApplicationEngineAttributes attributes;     /*!< @brief Specifies fixed application engine attributes */
  AEM_API_EngineLaunchApplicationCB launch_fn;        /*!< @brief A pointer to a function in the application engine which launches an application. */
  AEM_API_EngineTerminateApplicationCB terminate_fn;  /*!< @brief A pointer to a function in the application engine which terminates an application. */
  AEM_API_EnginePauseCB pause_fn;                     /*!< @brief A pointer to a function in the application engine which pauses an application. */
  AEM_API_EngineResumeCB resume_fn;                   /*!< @brief A pointer to a function in the application engine which resumes an application. */
  AEM_API_MessageReceivedCB message_received_fn;      /*!< @brief A pointer to a function in the application engine which receives a message from another application engine. This parameter may be null, if the application engine does not support this feature. */
  AEM_API_EngineHideCB hide_fn;                       /*!< @brief A pointer to a function in the application engine which hides an application. */
  AEM_API_EngineShowCB show_fn;                       /*!< @brief A pointer to a function in the application engine which shows an application. */
  AEM_API_EngineUserInputCB user_input_fn;            /*!< @brief A pointer to a function in the application engine which handles user input. */
  AEM_API_EngineUserHIDInputCB user_hid_input_fn;     /*!< @brief A pointer to a function in the application engine which handles user HID input. */
  AEM_API_EngineUserMultiInputCB user_multi_input_fn; /*!< @brief A pointer to a function in the application engine which handles user inputs. If set, it excludes the use of the user input callbacks user_hid_input_fn and user_input_fn*/
} AEM_API_ApplicationEngineCallback;


SYSTEM_STATUS AEM_API_RegisterApplicationEngine (AEM_API_ApplicationEngineCallback application_engine)


<error-handling>
https://www.stb.bskyb.com/jira/browse/LAE-1113
After discussion with Jim Hawkins and Rune Petersen, the LAE should simply
call its AEM_ENGINE_EVENT_LISTENER callback into the middleware, and pass
AEM_API_ApplicationEventFailed when an error has occurred. This should be
sufficient for flagging a non-specific error at launch, which is the current
requirement.

22. LAE notifies AEM that the Application is Running

typedef void (*AEM_APPLICATION_EVENT_LISTENER)  (AEM_API_ApplicationHandle application_handle,
                                                 AEM_API_ApplicationEvent application_event,
                                                 uint32_t user_tag);

<iapp-event>
/** @brief Application event enumeration. This specifies the application event.
 */
typedef enum AEM_API_ApplicationEventTag
{
  AEM_API_ApplicationEventUNDEF          = 0,
  AEM_API_ApplicationEventCreated        = 1,         /*!< @brief Application event is created */
  AEM_API_ApplicationEventRunning        = 2,         /*!< @brief Application event is running */
  AEM_API_ApplicationEventPaused         = 3,         /*!< @brief Application event is paused */
  AEM_API_ApplicationEventStopping       = 4,         /*!< @brief Application event is stopping */
  AEM_API_ApplicationEventFailed         = 5,         /*!< @brief Application event is failed */
  AEM_API_ApplicationEventTerminated     = 6,         /*!< @brief Application event is closing down */
  AEM_API_ApplicationEventDeleted        = 7,         /*!< @brief Application event is deleted */
  AEM_API_ApplicationEventPending        = 8,         /*!< @brief Remote Trigger Application event is pending launch due to wait for MH Carousel Mount*/
  AEM_API_ApplicationEventLastValue      = 9
} AEM_API_ApplicationEvent;


// /** @brief Application error code enumeration. This specifies what type of failure occurred.
//  */
// typedef enum AEM_API_ApplicationErrorCodeTag
// {
//   AEM_API_ApplicationErrorCodeUndef = 0U,
//     AEM_API_ApplicationErrorCodeServerFailure ,
//     AEM_API_ApplicationErrorCodeWANFailure,
//     AEM_API_ApplicationErrorCodeMemoryFailure,
//     AEM_API_ApplicationErrorCodeExecutionFailure ,
//     AEM_API_ApplicationErrorCodeUnknown,
//     AEM_API_ApplicationErrorCodeLastValue
// } AEM_API_ApplicationErrorCode;
// 
// 
// note: 1. EPG -> AEM
// // register error code listener on startup
// 
// /**  @brief AEM allows client to register an error notification listener callback - which is used to notify
//  *   the client when the application encounters an error.
//  *   Registration of the listener has to be done only once before starting any application,
//  *   and this listener is used by all applications.
//  *   @param[in] client_listener  	A pointer to an #AEM_APPLICATION_ERRORCODE_LISTENER function that will be called by AEM
//  *   								when the application has encountered one of the errors enumerated
//  *   								in #AEM_API_ApplicationErrorCode.
//  */
//
// CMS_PLATFORM_SERVICES/AEM/inc/aem_api.h
// SYSTEM_STATUS AEM_API_Application_RegisterErrorNotificationListener (AEM_APPLICATION_ERRORCODE_LISTENER client_listener,
//                                                                      uint32_t user_tag)
// {}
// 
// 
// note: 2. LAE -> AEM
// 
// /** @brief Allows AEM to receive error notification and pass it on to its clients.
//  *
//  *  @param[in] application_handle  The handle of the application which is reporting an error.
//  *  @param[in] application_errorcode  One of the error codes enumerated in #AEM_API_ApplicationErrorCode.
//  *
//  *  @retval #AEM_API_STATUS_OK if successful.
//  *  @retval #AEM_API_STATUS_ERROR in case of error.
//  */
// SYSTEM_STATUS AEM_API_Application_NotifyApplicationErrorCode (AEM_API_ApplicationHandle application_handle,
//                                                               AEM_API_ApplicationErrorCode application_errorcode)
// {}
// 
// 
// note: 3. AEM -> EPG
// 
// /** @brief Callback function to provide notification of a particular error type on an application.
//  *
//  *  Callback function that is used by clients of AEM (e.g. EPG) in order that
//  *  they can receive notifications from AEM relating to application failures.
//  *  The event types that will be notified are enumerated in #AEM_API_ApplicationErrorCode.
//  *
//  *  @param[in] application_handle  The handle of the application which has failed.
//  *  @param[in] app_errorcode       The current error code of the application failure.
//  *  @param[in] user_tag            User tag used to identify the caller.
//  *  @retval None.
//  */
// typedef void (*AEM_APPLICATION_ERRORCODE_LISTENER) (AEM_API_ApplicationHandle application_handle,
//                                                                               AEM_API_ApplicationErrorCode app_errorcode,
//                                                                               uint32_t user_tag);
// 
// SYSTEM_STATUS AEM_Common_ProcessErrorNotificationListener(AEM_API_ApplicationHandle applicationHandle,
//                                               AEM_API_ApplicationErrorCode applicationErrorCode)
// {
//       pListener->listener(applicationHandle, applicationErrorCode, pListener->usertag);
// }


<comp-iapp-red>
http://spvss-confluence.cisco.com/display/SE/Triggers

STB performs the iTV application authentication prior to download is started.
This includes validation of the iTV application certificate.  The certificate
is validated by AEM.  


FSION-DSN-2657 WP471 iTV Application Certificates
covers all aspects of the iTV application download and relevant content
authentication process.

The AEM relies on the PLAYER component to signal the presence of applications
that can be launched, and on the GUIDE component to retrieve stream
information for the service currently tuned to and the services containing
applications that are able to be launched.

Interactive Main Menu

IMS: Interactive Menu Service (or Pure Interactive Service) 
service which is mainly used to launch interactive applications. It may or may
not contain video/audio content

The System shall display the Interactive Trigger graphic to the Viewer when it
loads an `Interactive Trigger module` that contains a graphic, while presenting
Live TV in full-screen.

transer file:
FSION-DSN-2563_WP469_-_Application_Transitions_and_Communications.doc. 3.3.
The EPG and the AE use cookies to transfer information between the EPG and
interactive applications and vice versa. These cookies are handled by the OFS. 

The AEM passes this URI to the AE as a parameter to pre-registered launch
call-back. The AEM parses passed URIs to determine which application engines
support specific content types, and therefore which application engine should
be used to launch any specified URI.


type of interactive applications 

The Trigger Interactive Applications.

The application of this type can be started automatically by regular tuning
(by DCA, TV Guide, etc.) to the service after back-off period if this
application was defined as an auto-launched linked trigger application or by
pressing GREEN trigger on the channel. An Interactive Trigger application can
be local or remote.  The Local Trigger application means that the linked
service is the same as the currently tuned. The each part of triplet (network
    id, transport stream id and service id) should be defined as 0.  The
Remote Trigger application means that the linked service is different to the
currently tuned.

The Auto-launch Interactive Applications.
The Applications of this type can be started by regular tuning (by DCA, TV
    Guide, etc.) to the service that is defined as auto-launch interactive
service.

The Pure Interactive applications.
The Applications of this type can be started by selecting an interactive
application from the Interactive Main Menu.


Load Trigger Module: When a Trigger Module is received, FDM notifies Player.
The EPG is notified via AEM of its receipt.

Launch Interactive Application: When the user presses the linkKey, the
referenced interactive application is loaded and launched.

*comp-live-reservation*

note:
"A live reservation job cannot run concurrently with two recording jobs." and
this make rbrec fail when try to run live-reserve


2.2	Launch An Interactive Application
2.2.1	Main Flow

1.	EPG requests Player to start live reservation (method returns PLAYER_API_STATUS_PENDING).
2.	Player creates Live Reservation job using VRM
3.	VRM notifies Player that the Job is created
4.	Player checks for conflicts using Planner.
5.	If a conflict exists, then execute the exception flow: All tuners are in use by recordings.
6.	Planner notifies Player that there is no conflict.
7.	Player starts the Live Reservation job using VRM
8.	VRM notifies Player that the Job is started.
9.	Player notifies PLAYER_EVENT_SESSION_START event for live reservation request.
10.	If the user requested to launch the application from an Interactive Trigger, then variation 1 is followed.
11.	Otherwise, if the user has requested to launch the application from the IMM, then the EPG tunes the Service selected from the IMS menu.
12.	AEM receives a PLAYER_EVENT_SESSION_START event for a new Live TV service.

13.	If the Live TV service is a True interactive service, AEM creates a new
      24_7 application and binds it to the current service.

14.	`AEM notifies the EPG` that a new Application has been Created.
15.	The EPG determines the type of the application.
16.	The EPG displays the Title and Synopsis for the service.
17.	EPG still create transfer file for IMS App, but it’s empty.
18.	EPG requests AEM to start the application.
19.	AEM resolves the application to an App Engine and constructs the launch URI

20.	`AEM requests the LAE` to launch the Application using a pre-registered callback.
21.	LAE loads and starts the application.
22.	LAE notifies AEM that the Application is Running
23.	AEM notifies the EPG that the Application is Running
24.	EPG inhibits Display Updates (note: LAE clears the Graphics Surface before drawing to it).
25.	EPG requests AEM to Show the Application.
26.	AEM requests the LAE to Show the Application using a pre-registered callback.
27.	LAE sets the Input Window of the Graphics Source to 720x576.
28.	LAE clears the Graphics GFX Surface before drawing to the surface (not shown).


<comp-iapp-type>
// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion/aem/AemApplication.java

    /** Types of application */
    interface Type
    {
        /** eTV application from trigger module */
        int eTV = 1;

        /** Recommendation application from promo module */
        int RECOMMENDATION = 2;

        /** 24_7 application from IMM service */
        int _24_7 = 3;

        /** Resident app */
        int RESIDENT = 4;

        /** Boot app */
        int BOOTAPP = 5;

        /** Finger print application from promo module */
        int FINGERPRINT = 6;

        /** Direct Subscription Upgrade Application  */
        int DSU = 7;

        /** Client Application  */
        int CLIENT = 8;
    }

// on 101, two apps found; trigger and text. both launchs digital text app.


<comp-iapp-epg-listener-from-aem>
// build/applications/Picasso/picasso/Picasso/src/java/picasso/almmgr/EventListener.java
	/**
	 * This is the entry point for the MW events from AemApplicationEventListener
	 *
	 * @see com.nds.fusion.aem.AemApplicationEventListener#notify(com.nds.fusion.aem.AemApplication, int)
	 */
	@Override public void notify(final AemApplication app, final int event)
	{
		executor.runLater(new Runnable()
		{
			@Override public void run()
			{
				Affirm.affirmNotNull(app);

				ALMManager.LOGGER.logMilestone("IAPP: AEM event: app=" + app + ", event=" + event + eventName(event));

					switch (event)
					{
						case AemApplication.EventType.CREATED:
							model.onCreated(app);
							break;
               }
         }
      }
  }


// takes 4 secs to get all apps from tuning start

// text
!MIL    -EPG_ALM      		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:`EventListener`$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8ddd3, event=1 CREATED
!MIL    -EPG_ALM      		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel F:onCreated L:948 > T:CEE-J EventQueue Reader 0:AEM app created with type 1


// ^[2017:11:06 07:30:46] !MIL    -aem          		< p:0x00000286 P:APP t:0x015c6520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(1)e301 
// ^[2017:11:06 07:30:47] !MIL    -EPG_ME       		< p:0x00000286 P:APP t:0x2c161520 T:no name M:MediaEngine F:playService L:1509 > T:PooledExecutor#1:TUNING TO BBC One Lon, 101 locator:5:3:7D2
// !MIL    -VRM_SERVER   		< p:0x00000284 P:MW t:0x01d72520 T:VRM_SRV M:live.c F:LIVE_Create L:1393 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:7D2,job-destloc=,locator:3:2E:4B:0 
//
// note: looks it gets called whenever player session gets started.
//
// CMS_PLATFORM_SERVICES/AEM/src/aem_signalling_xsi.c
//        registered &= registerFn(PLAYER_EVENT_SESSION_START, AEM_XSI_StartPlayerSession);
//
// !INFO   -aem          		< p:0x00000286 P:APP t:0x01572520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling_xsi.c F:`AEM_XSI_StartPlayerSession` L:841 > Creating text application 
// !ENTER  -aem          		< p:0x00000286 P:APP t:0x01572520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling.c F:AEM_AppSignalling_CreateApplication L:270 > |-> AEM_AppSignalling_CreateApplication
//
// typedef enum AEM_API_ApplicationEventTag
// {
//   AEM_API_ApplicationEventCreated        = 1,         /*!< @brief Application event is created */
// } AEM_API_ApplicationEvent;
//
// !INFO   -aem          		< p:0x00000286 P:APP t:0x01572520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling_xsi.c F:AEM_XSI_InitApplication L:1328 > *app->service_binding: on=0x2 ts=0x7fd service=0x189d) 
// !INFO   -aem          		< p:0x00000286 P:APP t:0x01572520 T:AEM_STATE_MONITOR_THREAD M:aem_common.c F:AEM_NotifyEventListeners L:639 > Notify listener for appHandle <2>, appEvent <0x00000001> 
// !MIL    -EPG_ALM      		< p:0x00000286 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8c884, event=1 CREATED
// !MIL    -EPG_ALM      		< p:0x00000286 P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel F:onCreated L:948 > T:CEE-J EventQueue Reader 0:AEM app created with type 1


<comp-iapp-red-trigger>

uses OPTV which is different from text app.

3.2 Monitor for Interactive Applications
3.2.1 Brief Description

On tuning to a new channel, Player checks whether any of its elementary
streams is a Trigger Track and, if so, FDM to download Interactive Trigger
Module and Promo Modules.

3.2.2 Use Case Realisation Design
3.2.2.1 Main Flow

The flow is described in relation to Figure 5.

[1.X] Player opens an OpenTV session and registers an event listener with FDM.

// register at boot 
!ENTER  -P_Api        		< p:0x0000026c P:APP t:0x013e8520 T:PLAYER_MAIN M:player_optv.c F:PLAYER_OPTV_OpenSession L:1283 > |-> PLAYER_OPTV_OpenSession
!EXIT   -P_Api        		< p:0x0000026c P:APP t:0x013e8520 T:PLAYER_MAIN M:player_optv.c F:PLAYER_OPTV_OpenSession L:1295 > <-| PLAYER_OPTV_OpenSession : return_status = 0x6801000

// CMS_INFORMATION_SERVICES/FDM/src/fdm_api/fdm_api_optv/src/fdm_api_optv.c
static void *FDM_API_OPTV_P_EventListenerThreadProxy(void *args)
{
        /* Execute the client callback */
        if (NULL != mde_cb)
        {
            (mde_cb) (mds, mod_hdl, evt, user_ctx);
            DIAG_LOG_INFO(g_optv_segid, ("callback called"));
        }
}

// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_optv.c
/*
 * Open the FDM session.
 * The FDM interface will have been initialised when the Player was started.
 */
SYSTEM_STATUS PLAYER_OPTV_OpenSession(void);
{
  if (FDM_STATUS_OK == FDM_API_OPTV_ModuleDownloadSessionOpen(PLAYER_OPTV_ModuleDownloadEventListener));
}

/*
 * This is the listener that the FDM uses to tell us of events on the OPTV carousel.
 *
 * Set up in the FDM_API_OPTV_ModuleDownloadSessionOpen() call.
 */
static void PLAYER_OPTV_ModuleDownloadEventListener(FDM_API_OPTV_ModuleDownloadSession_t mds)
{

  if(SYSTEMITC_OK!=SYSTEMITC_API_PostEvent(&(g_player_component.queue_id),
        (uint32_t)`PLAYER_EVT_OPTV_CAROUSEL`));
}

!MIL    -EPG_ME       		< p:0x0000026c P:APP t:0x2c1ac520 T:no name M:MediaEngine F:playService L:1509 > T:PooledExecutor#4:TUNING TO BBC One Lon, 101 locator:5:3:7D2

*comp-fdm*
// Player sets the media selection and waits for FDM to generate an OTVCSI.
// CMS_INFORMATION_SERVICES/FDM/src/fdm_common/fdm_plugin/src/fdm_plugin_optv.c
// sends OTVCSI out and Then MCM picks it up and passes it on to anyone who
// needs it.  VRM is one (maybe the only one) VRM then forwards it to Player
//
// !INFO   -FDM_CMN_CLT   < p:0x00000555 P:MW t:0x758c5450 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Run L:586 > processing SCI object...
//
// http://hetty.cisco.com/marvin/MCM_training#Notify_Client_Media_Selection_Object_.28MSO.29
// Notify Client Media Selection Object (MSO) MCM client (VRM or SPM) will
// register a MSO listener with MCM in order to get the updates of the MSO.
// MSO is generated by the device manager. Then device manager will notify MCM
// via the listener which is registered with device managers by MCM. Once MCM
// receives the MSO, MCM will pass up to its client via the listener. This
// debug will have the following format:


== !ENTER  -P_Api        		< p:0x0000026c P:APP t:0x0143a520 T:VRM_CLNT M:player_common.c F:PLAYER_VRM_EventDispatcher L:642 > |-> PLAYER_VRM_EventDispatcher
== !INFO   -P_Api        		< p:0x0000026c P:APP t:0x0143a520 T:VRM_CLNT M:player_common.c F:PLAYER_VRM_EventDispatcher L:646 > VRM Job 0x03000001, Event 0x1 
== !EVENT  -P_Api        		< p:0x0000026c P:APP t:0x0143a520 T:VRM_CLNT M:player_common.c F:PLAYER_VRM_EventDispatcher L:654 > VRM_JOB_EVENT_MEDIA_STATUS_UPDATED  
== !ENTER  -P_Api        		< p:0x0000026c P:APP t:0x0143a520 T:VRM_CLNT M:player_common.c F:PLAYER_GetVRMEvent L:3192 > |-> PLAYER_GetVRMEvent
== !EVENT  -P_Api        		< p:0x0000026c P:APP t:0x0143a520 T:VRM_CLNT M:player_common.c F:PLAYER_GetEventFromObject L:3116 > SYSTEMOBJECT_TYPE_OTVCSI 

!ENTER  -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11339 > |-> PLAYER_SM_VRM_ProcessOTVCSI
!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11343 > job handle 0x03000003 Context : MAIN_TARGET Type 1 State 7  
!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11364 > Got data component track tag [2014:10:22 06:51:44]1413960704 
!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11367 > Got data component selected PID 0x90D 

!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11403 > Got the trigger track (handle = 0x00290d9d) 
!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11413 > Load modules only for Main (handle = 0x00290d9d) 

!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_optv.c F:PLAYER_CAROUSEL_Load_Initial L:709 > Requested initial OPTV module:  mod_id 2 mod_hdl 0x3b258000 
!INFO   -P_Api        		< p:0x0000026c P:APP t:0x013ef520 T:PLAYER_MAIN M:player_optv.c F:PLAYER_CAROUSEL_Load_Initial L:709 > Requested initial OPTV module:  mod_id 3 mod_hdl 0x3b458001 

// void PLAYER_CAROUSEL_Load_Initial(PLAYER_CAROUSEL *carousel, uint32_t track_handle)
// {
//     /*
//      * Load the OPTV carousel.
//      *
//      * The FDM OPTV interface must have been Init'd, and the session created.
//      */
//     if (FDM_STATUS_OK == FDM_API_OPTV_ModuleDownloadSessionRqCreate(g_player_component.optv->mds,  /* OPTV module download session */
//                                                                     carousel->track_handle,         /* Track handle from CSI */
//                                                                     FDM_OPTV_APPLICATION_ID_UNKNOWN,/* From ICD */
//                                                                     carousel->mod_id,               /* From trigger design specification */
//                                                                     FDM_OPTV_MODULE_VERSION_ANY,    /* Any module version from ICD */
//                                                                     g_player_component.optv->timeout,
//                                                                     (void*)carousel,
//                                                                     &carousel->mod_hdl))             /* Identifies this session */
// }

!EXIT   -P_Api        		< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessOTVCSI L:11438 > <-| PLAYER_SM_VRM_ProcessOTVCSI : return_status = 0x6801000

// get event back from FDM
!ENTER  -P_Api        		< T:FDM_OPTV_EventListenerThread M:player_optv.c F:PLAYER_OPTV_ModuleDownloadEventListener L:539 > |-> PLAYER_OPTV_ModuleDownloadEventListener
!INFO   -P_Api        		< T:FDM_OPTV_EventListenerThread M:player_vtable.c F:VTABLE_Create L:692 > CREATE VTable 15 new element = 0x1793b74 
!EXIT   -P_Api        		< T:FDM_OPTV_EventListenerThread M:player_optv.c F:PLAYER_OPTV_ModuleDownloadEventListener L:584 > <-| PLAYER_OPTV_ModuleDownloadEventListener : return_status = 0x0

!INFO   -P_Api        		< T:PLAYER_MAIN M:player_common.c F:MessageThread L:3984 > *** Message received (event = OPTV_CAROUSEL) *** 
!ENTER  -P_Api        		< T:PLAYER_MAIN M:player_optv.c F:`PLAYER_OPTV_StateMachine` L:352 > |-> PLAYER_OPTV_StateMachine
!INFO   -P_Api        		< T:PLAYER_MAIN M:player_optv.c F:PLAYER_OPTV_StateMachine L:376 > Carousel: 0x01381B0C, c_mod_hdl: 0x3B258000, ev_mod_hdl: 0x3B258000, Module ID: 0x2 
!INFO   -P_Api        		< T:PLAYER_MAIN M:player_optv.c F:PLAYER_OPTV_StateMachine L:384 > FDM state: PLAYER_OPTV_STATE_INITIAL_REQUESTED 
!INFO   -P_Api        		< T:PLAYER_MAIN M:player_optv.c F:PLAYER_OPTV_StateMachine L:419 > FDM event: FDM_OPTV_DWNLD_EVENT_RQ_LOADED 

!INFO   -P_Api        		< T:PLAYER_EVENT M:player_api_events.c F:PlayerEventThread L:1230 > *** Message received (event = 1103  : TRIGGERMODULE)  *** 

!ENTER  -aem          		< T:AEM_STATE_MONITOR_THREAD M:aem_signalling.c F:AEM_AppSignalling_CreateApplication L:270 > |-> AEM_AppSignalling_CreateApplication

!ENTER  -aem          		< T:AEM_STATE_MONITOR_THREAD M:aem_trigger.c F:AEM_InitTriggerApp L:83 > |-> AEM_InitTriggerApp
!INFO   -aem          		< T:AEM_STATE_MONITOR_THREAD M:aem_common.c F:AEM_NotifyEventListeners L:639 > Notify listener for appHandle <3>, appEvent <0x00000001> 
!MIL    -EPG_ALM      		< T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8c007, event=1 CREATED
!MIL    -EPG_ALM      		< T:no name M:InteractiveApplicationModel F:onCreated L:948 > T:CEE-J EventQueue Reader 0:AEM app created with type 1
!MIL    -EPG_ALM      		< T:no name M:ApplicationFactory F:createApplicationForTrigger L:205 > T:CEE-J EventQueue Reader 0:IAPP: New legacy trigger

!MIL    -EPG_ME       		< T:no name M:MediaEngine F:channelChanged L:2092 > T:PooledExecutor#1:CHANNEL CHANGED TO BBC One Lon, 101


// show trigger(may or may not) think "please wait" text on red or "press" on red.
!MIL    -EPG_FS       		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:VisibilityController F:show L:668 > T:CEE-J EventQueue Reader 0:VisibilityController.show LEGACY_TRIGGERS

// launch trigger which launch digital text automatically?
!MIL    -aem          		< p:0x00000270 P:APP t:0x01479520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(RED)e200 

// this shows action but not mean app launch becuase it a response to red key
// press
!MIL    -EPG_MISC     		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveApplication","action": "launch=TRIGGER","label": "channel=101;bannerVisible=false;launchTimeMs=946686424731;none","currentscreen": "/tv/live/101"}

!MIL    -EPG_ALM      		< p:0x00000270 P:APP t:0x2c161520 T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:PooledExecutor#1:Starting live reservation

!MIL    -VRM_SERVER   		< p:0x0000026e P:MW t:0x01d72520 T:VRM_SRV M:reservation_job.c F:RESERVATION_JOB_Create L:190 > @@PMON@@,mark,job,job-create,10,job-create-type=,jb-live-reserve,job-srcloc=,SYSTEMLOCATOR_NULL_HANDLE,job-destloc=,SYSTEMLOCATOR_NULL_HANDLE 

!MIL    -SYSINIT_S    		< p:0x0000026b P:SCD t:0x0062e530 T:SERVER_TASKS_THREAD M:server_tasks.c F:handleGetHardwareString L:468 > HW_String = STBM_ID, Value = 4f 
!MIL    -SYSINIT_S    		< p:0x0000026b P:SCD t:0x0062e530 T:SERVER_TASKS_THREAD M:server_tasks.c F:handleGetHardwareString L:468 > HW_String = STBM_NAME, Value = Sky 
!WARN   -LAE          		< p:0x00000270 P:APP t:0x014ad520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:86 > [W] ServiceSm initial state message type = 0

!MIL    -EPG_ALM      		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@`5a8dda0`, event=2 RUNNING
!ERROR  -EPG_DEV1     		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /interactive_background
!MIL    -EPG_MISC     		< p:0x00000270 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_background"}
!MIL    -AMS          		< p:0x0000026e P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:307 > APP_START event 
!MIL    -AMS          		< p:0x0000026e P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:327 > Application params: app_id=750, provider_id=400 
!MIL    -EPG_INIT     		< p:0x00000270 P:APP t:0x2c1c5520 T:no name M:InitialisationManager$StateChanger F:startOperatingOn L:2393 > T:IM#0:Starting state change to INTERACTIVE

// when press text
8370:NDS: ^[2017:11:03 11:53:52]0946685833.909669 !MIL    -EPG_MISC     		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "TEXT","label": "Key Press TEXT","currentscreen": "/tv/live/101"}
8380:NDS: ^[2017:11:03 11:53:52]0946685833.916913 !MIL    -EPG_MISC     		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveApplication","action": "launch=SKYTEXT","label": "channel=101;bannerVisible=false;launchTimeMs=946685833916;none","currentscreen": "/tv/live/101"}
8383:NDS: ^[2017:11:03 11:53:52]0946685833.921185 !MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c148520 T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:PooledExecutor#0:Starting live reservation

8423:NDS: ^[2017:11:03 11:53:53]0946685834.049471 !MIL    -EPG_FS       		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:VisibilityController F:show L:668 > T:CEE-J EventQueue Reader 0:VisibilityController.show SKY_TEXT_LOADING

// this app matches up with the text app
8548:NDS: ^[2017:11:03 11:53:56]0946685837.832786 !MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8e1c0, event=2 RUNNING


<comp-iapp-when-there-is-no-app>
// to 103(itv) which has no app
!MIL    -aem          		< p:0x00000276 P:APP t:0x01479520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(CHANNEL+)e006 

!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8e007, event=1 CREATED
!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel F:onCreated L:948 > T:CEE-J EventQueue Reader 0:AEM app created with type 1

!MIL    -EPG_ME       		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MediaEngine F:playService L:1509 > T:CEE-J EventQueue Reader 0:TUNING TO ITV, 103 locator:5:3:1770

!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a92417, event=1 CREATED
!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel F:onCreated L:948 > T:CEE-J EventQueue Reader 0:AEM app created with type 1
!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:ApplicationFactory F:createApplicationForTrigger L:205 > T:CEE-J EventQueue Reader 0:IAPP: New legacy trigger

!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a92417, event=7 DELETED
!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5a8e007, event=7 DELETED

!MIL    -aem          		< p:0x00000276 P:APP t:0x01479520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(RED)e200 

!MIL    -EPG_MISC     		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "RED","label": "Key Press RED","currentscreen": "/tv/live/103"}
!MIL    -EPG_MISC     		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveApplication","action": "launch=TRIGGER","label": "channel=103;bannerVisible=false;launchTimeMs=946685860761;none","currentscreen": "/tv/live/103"}
!MIL    -EPG_ALM      		< p:0x00000276 P:APP t:0x2c193520 T:no name M:InteractiveApplicationModel$10 F:run L:682 > T:PooledExecutor#3:IAPP: App not available: Trigger

!MIL    -aem          		< p:0x00000276 P:APP t:0x01479520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(TEXT)e00f 
!MIL    -EPG_MISC     		< p:0x00000276 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "TEXT","label": "Key Press TEXT","currentscreen": "/tv/live/103"}


<comp-iapp-live-reservation>

// DARWIN_PLATFORM/DARWIN_PLAYER/inc/player_api_session.h

/**  @brief Requests the start of a live reservation job.
  *  A live reservation job cannot run concurrently with two recording jobs.
  *  @param[in] sessionId The handle for this object.
  *  @param[in] sourceUserTag Client-specific private data
  *  @retval #PLAYER_API_STATUS_OK on successful completion,
  *  @retval #PLAYER_API_STATUS_PENDING if the operation will be completed asynchronously
  *  @retval #PLAYER_API_STATUS_NOT_INITIALISED if the function is called
  *          before the module has been initialised
  *  @retval #PLAYER_API_STATUS_FAILURE for any failure condition.
  *
  *  If the return status is PLAYER_API_STATUS_PENDING, on return from this method
  *  the session status is set to PLAYER_API_Session_Status_Request_Pending,
  *  the operation executes asynchronously and its completion will be notified by
  *  either #PLAYER_EVENT_SESSION_START, #PLAYER_EVENT_SESSION_STOP,
  *  #PLAYER_EVENT_SESSION_FAIL or #PLAYER_EVENT_SESSION_DISCARD.
  */
SYSTEM_STATUS PLAYER_API_Session_StartLiveReservation(  PLAYER_API_SessionHandle sessionId,
                                                        PLAYER_API_TAG sourceUserTag);


/**  @brief Stops a live reservation job.
  *  @param[in] sessionId The handle for this object.
  *  @retval #PLAYER_API_STATUS_OK on success,
  *  @retval #PLAYER_API_STATUS_FAILURE for any failure condition.
 */
SYSTEM_STATUS PLAYER_API_Session_StopLiveReservation(PLAYER_API_SessionHandle sessionId);

<player-event>

>>> hex(-2145386464+ 2**32)
'0x88000001'
-

#define PLAYER_EVENT_LIVE_RESERVATION_START         0x88000001      /**< Notification that a Play request has started. @see #PLAYER_EVENT_Live_Reservation_Start_PropId */
>>> hex(-2013265919+ 2**32)
'0x88000001'

>>> -(2**32-0x88000001)
-2013265919

!MIL    -EPG_PLAY > T:PooledExecutor#3:PlayerEvent > oP@5a8d508 ID > -2013265919
>
(iapp) FSION-DSN-1642-WP108_Interactive_Application_Conflicts.doc

Player provides an API to the EPG to allow it to Start Interactive Live Play.
When the Application requests to Start Interactive Live Play, Player shall
create an Live Reservation Job and check for conflicts.  If two non-shared
recordings (recordings on different services) are running, then a conflict
will be detected and resolved automatically by cancelling the Live Reservation
Job.  Player notifies the EPG whether it was able to Start Live Reservation or
if there was a conflict.  In the latter case, the EPG is then able to display
an appropriate message to the user.  In the future, this functionality could
be extended to allow an interactive conflict resolution session with the user
as per other tuner conflict scenarios.  When the Live Reservation Job is
started the Review Buffer Recording shall be destroyed.


!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2e142520 T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:PooledExecutor#4:Starting live reservation

// ../STB_SW/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/mediaengine/FreeTunerReserver.java

	public ReservedTuner reserveFreeTuner() throws TunerReservationFailedException
	{
		if (isTunerReserved())
		{
			throw new TunerReservationFailedException();
		}

		status = factory.getReservationStatus(idGenerator.generateId(), this, iStampTheTime);

		Loggers.EPG_ALM.logMilestone("Starting live reservation");
		playerSession.startLiveReservation(status.getSessionId());

		currentReservation = status.getReservation();

		return currentReservation;
	}

//../STB_SW/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion/player/PlayerSession.java
    /** Asynchronous request to start a live reservation job.
     *  A live reservation job cannot run concurrently with two recording jobs.
     *  The user will be notified of the completion of the action by 
     *  {@link PlayerEventSessionStart} if the live reservation starts successfully, or
     *  {@link PlayerEventSessionDiscard} if the live reservation has been discarded for another
     *  request, or {@link PlayerEventSessionFail} if the live reservation fails for any 
     *  other reason.     
     *  @param sourceUserTag Client-specific private data
     */
    void startLiveReservation(int sourceUserTag);

// ../STB_SW/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/playerimpl/PlayerSessionImpl.java
    @Override public void startLiveReservation(int sourceUserTag)
    {
        assertValid();

        natStartLiveReservation(nativeHandle, sourceUserTag);
    }


<comp-iapp-yellow>
okay case

egrep -an "KEY_PRESS|currentscreen|EPG_ALM|EPG_FS|\-LAE"

!MIL    -aem          		< p:0x000001fd P:APP t:0x01583520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(YELLOW)e202 
!MIL    -EPG_MISC     		< p:0x000001fd P:APP t:0x2c157520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "YELLOW","title": "Key Press YELLOW","label": "","currentscreen": "/tv/live/501"}
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:YellowButtonAppLaunchDecider F:doYellow L:30 > T:CEE-J EventQueue Reader 0:IAPP: Launching My Sky application
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:MySkyAppLauncher F:launch L:67 > T:CEE-J EventQueue Reader 0:IAPP: Launching My Sky
!MIL    -EPG_MISC     		< p:0x000001fd P:APP t:0x2c157520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveApplication","action": "launch","title": "My Sky","label": "channel=501;bannerVisible=false;launchTimeMs=946685672990;yellow=DEFAULT","currentscreen": "/tv/live/501"}
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2e142520 T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:PooledExecutor#4:Starting live reservation
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ci@5a6bff6, event=1 CREATED
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:InteractiveApplicationModel F:onCreated L:989 > T:CEE-J EventQueue Reader 0:AEM app created with type 8
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2e142520 T:no name M:ClientApplication F:writeTransferFile L:28 > T:PooledExecutor#4:IAPP: App My Sky : additional_info = yellow=DEFAULT
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2e142520 T:no name M:MySkyAppLauncher F:onLaunching L:87 > T:PooledExecutor#4:IAPP: onLaunching My Sky
!MIL    -EPG_FS       		< p:0x000001fd P:APP t:0x2c157520 T:no name M:VisibilityController F:setVisibility L:341 > T:CEE-J EventQueue Reader 0:Component=LOADING_INDICATOR makeVisible=true cause=REPLACE, notHideableReasons=0x0
!MIL    -EPG_FS       		< p:0x000001fd P:APP t:0x2c157520 T:no name M:VisibilityController F:externalComponentStateIs L:1245 > T:CEE-J EventQueue Reader 0:externalComponentState = -1
!MIL    -EPG_FS       		< p:0x000001fd P:APP t:0x2c157520 T:no name M:VisibilityController F:show L:689 > T:CEE-J EventQueue Reader 0:VisibilityController.show LOADING_INDICATOR
!WARN   -LAE          		< p:0x000001fd P:APP t:0x015b7520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:86 > [W] ServiceSm initial state message type = 0
!WARN   -LAE          		< p:0x000001fd P:APP t:0x01760520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:86 > [W] fileSys Warning: OFS_RAMFS_ChDir(/Sky Active) returned The directory path supplied is not valid
!WARN   -LAE          		< p:0x000001fd P:APP t:0x01760520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:86 > [W] fileSys Warning: OFS_RAMFS_ChDir(/Sky Active/micro_cdn) returned The directory path supplied is not valid
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ci@5a6bff6, event=2 RUNNING
!MIL    -EPG_ALM      		< p:0x000001fd P:APP t:0x2c157520 T:no name M:MySkyAppLauncher F:onRunning L:93 > T:CEE-J EventQueue Reader 0:IAPP: onRunning My Sky


<comp-iapp-interactive>
!MIL    -aem          		< P:APP t:0x0149a520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(INTERACTIVE)e008 
!MIL    -EPG_SCR      		< P:APP t:0x2c12f520 T:no name M:Screens F:doOpenScreen L:1140 > T:CEE-J EventQueue Reader 0:SCREEN INTERACTIVE_MENU layer=4, id=23 opened

!MIL    -aem          		< P:APP t:0x0149a520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SELECT)e001 
!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:CEE-J EventQueue Reader 0:Starting live reservation
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveMenuApplicationLaunch","action": "Application=Help and Support;description=Get help with Sky's products and services","label": "InteractiveApplication=Help and Support","currentscreen": "Entering grid:\
!MIL    -EPG_ME       		< P:APP t:0x2c161520 T:no name M:MediaEngine F:playService L:1509 > T:PooledExecutor#1:TUNING TO Help and Support, 2050 locator:5:3:208A
!MIL    -EPG_DLG      		< P:APP t:0x2c12f520 T:no name M:DialogManager F:showDialog L:1407 > T:CEE-J EventQueue Reader 0:Showing dialog 1219
!ERROR  -EPG_DEV1     		< P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /interactive_applications/launching_interactive_app
!MIL    -P_Api        		< P:APP t:0x2c193520 T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1172 > VIDEO IS HIDDEN 

!MIL    -EPG_ME       		< P:APP t:0x2c17a520 T:no name M:MediaEngine F:channelChanged L:2092 > T:PooledExecutor#2:CHANNEL CHANGED TO Help and Support, 2050
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","label": "PlayingStatus changed to: LIVE","currentscreen": "/tv/2050"}

// AEM -> EPG, notify EPG wich iapp handle 
// pListener->listener(applicationHandle, applicationEvent, pListener->usertag);

!INFO   -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_common.c F:AEM_NotifyEventListeners L:639 > Notify listener for appHandle <3>, appEvent <0x00000001> 

!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5abde49, event=1 CREATED
!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel F:onCreated L:946 > T:CEE-J EventQueue Reader 0:AEM app created with type 3
!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5abde49, event=2 RUNNING
!MIL    -AMS          		< P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:307 > APP_START event 
!MIL    -AMS          		< P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:327 > Application params: app_id=2997, provider_id=256 

!ERROR  -EPG_DEV1     		< P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to Entering grid: All
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "MenuNavigation","changed to": "/tv/2050/Entering grid: All"}
!ERROR  -EPG_DEV1     		< P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /interactive_applications
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_applications"}
!ERROR  -EPG_DEV1     		< P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /interactive_background
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_background"}
!MIL    -EPG_SCR      		< P:APP t:0x2c12f520 T:no name M:Screens F:doOpenScreen L:1140 > T:CEE-J EventQueue Reader 0:SCREEN INTERACT BKGND layer=6, id=20 opened
!MIL    -P_Api        		< P:APP t:0x2c193520 T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1168 > VIDEO IS SHOWN 


typedef enum AEM_API_ApplicationStateTag
{
  AEM_API_ApplicationStateUNDEF     = 0,
  AEM_API_ApplicationStateStopped   = 1,              /*!< @brief Application is created,
                                                           this state can also be set when application
                                                           is going from stopping to stopped without destroying the application  */
  AEM_API_ApplicationStateLoading   = 2,              /*!< @brief Application is loading */
  AEM_API_ApplicationStateRunning   = 3,              /*!< @brief Application is running */
  AEM_API_ApplicationStatePausing   = 4,              /*!< @brief Application is pausing */
  AEM_API_ApplicationStatePaused    = 5,              /*!< @brief Application is paused */
  AEM_API_ApplicationStateResuming  = 6,              /*!< @brief Application is resuming */
  AEM_API_ApplicationStateStopping  = 7,              /*!< @brief Application is closing down */
  AEM_API_ApplicationStateError     = 8,              /*!< @brief Application is in an error state */
  AEM_API_ApplicationStatePending   = 9,                /*!< @brief Remote Trigger Application is in pending state and is waiting for MH Carousel Mount*/
  AEM_API_ApplicationStateLastValue = 10
} AEM_API_ApplicationState;

!MIL    -aem          		< P:APP t:0x0149a520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SKY)ef01 
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressMagicEye","action": "SKY","label": "Key Press SKY","currentscreen": "/interactive_background"}

3.8 Exit An Interactive Application

4. EPG requests AEM to terminate the application

!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:BaseApplication F:terminate L:75 > T:CEE-J EventQueue Reader 0:Terminating application=DV@5a3e947, name=Help and Support, AemApplication=ck@5abde49
!ENTER  -aem          		< p:0x000001d9 P:APP t:0x2c12f520 T:no name M:aem_api_xsi.c F:AEM_API_Application_Terminate L:1453 > |-> AEM_API_Application_Terminate
!PARAM  -aem          		< p:0x00000217 P:APP t:0x2c12f520 T:no name M:aem_api_xsi.c F:AEM_API_Application_Terminate L:1454 > application_handle=3 
!ENTER  -aem          		< p:0x000001d9 P:APP t:0x2c12f520 T:no name M:aem_internal_xsi.c F:AEM_Application_Terminate L:49 > |-> AEM_Application_Terminate

5. AEM requests LAE to terminate the application using a pre-registered
   callback.
6. LAE unloads the application.
7. LAE notifies AEM that the application is terminated.

// these are custom logging
!ERROR  -aem          		< P:APP t:0x2c12f520 T:no name M:aem_api_xsi.c F:AEM_API_Application_Terminate L:1455 > AEM_API_Application_Terminate called 
!ERROR  -aem          		< P:APP t:0x2c12f520 T:no name M:aem_internal_xsi.c F:AEM_Application_Terminate L:50 > AEM_Application_Terminate 
!ERROR  -aem          		< P:APP t:0x2c12f520 T:no name M:aem_internal_xsi.c F:AEM_Application_Terminate L:85 > 2 Calling AEM_TerminateApp 
!ERROR  -aem          		< P:APP t:0x2c12f520 T:no name M:aem_sys.c F:AEM_TerminateApp L:266 > app->applicationInfo.state 7 

// How LAE notifies AEM?

// AEM_API_ApplicationEventStopping       = 4,         /*!< @brief Application event is stopping */
!PARAM  -aem          		< p:0x000001d9 P:APP t:0x014e7520 T:LAE_THREAD M:aem_state.c F:AEM_ApplicationStateEventListener L:168 > application_handle = 0x00000003 application_event = 4 

// CMS_PLATFORM_SERVICES/AEM/src/aem_api.c

/**  @brief Registers an application engine with the AEM.  Each application engine must call this function to inform
     the AEM of it's services. An application engine should register once
     only with the AEM by invoking this function during initilisation.
     The AEM_API_ApplicationEngineCallback structure passed by this function specifies a number of content types
     that are supported by the application engine (for example, HTML,
     JAR).  The AEM maintains a list of registered application engines and their content types, and uses this list
     to determine which application engine shall be invoked when launching an application.
     If an application engine registers a content type which is already registered by another engine, then this
     registration shall take precedence and the previous registration of the content type by another application engine shall
     be removed.
     This AEM_API_ApplicationEngineCallback structure also specifies a number of callback functions which must be
     implemented by the application engine.
     When the AEM wants to perform an action on the application engine (for instance, terminating an application), it
     invokes the registered callback function for that application engine and passes the necessary parameters.

     @param[in] application_engine - a pointer to a AEM_API_ApplicationEngineCallback structure.  This specifies
     the application engine name, callbacks, also specifies the supported content types.
     @return
     AEM_API_STATUS_OK if the call was successful.
     AEM_API_STATUS_ERROR if an error occurred during the call.
 */
SYSTEM_STATUS AEM_API_RegisterApplicationEngine (AEM_API_ApplicationEngineCallback application_engine)
{
  p_app->applicationInfo.state = AEM_API_ApplicationStateLoading;
  status = engine->application_engine_info.launch_fn(g_aem_defaultApplicationHandle, (uint8_t *)g_aem_defaultAppUri, AEM_ApplicationStateEventListener);
}


// CMS_PLATFORM_SERVICES/AEM/src/inc/aem_state.h

/** @brief callback function that is called by application engine `to notify aem`
  * the application reached one of the events enumerated in #aem_api_applicationevent.
  * also this callback is used internally by aem to notify the application created
  * and deleted when receiving player event and sai object from player

  * @param[in] app_event  - the current event of the application.
  * @param[in] app_eventparams  - a point to a structure including application handle
  * and event parameters for special application event. for example, when event
  * #aem_api_applicationeventrunning is reported by application engine, the event parameters
  * - provider_id and application_id should be reported as well.
 *
 *  @retval none.
 */
void AEM_ApplicationStateEventListener(AEM_API_ApplicationEvent app_event,
                                       AEM_API_EventParams *app_eventparams)
{
  if (!SYSTEM_STATUS_IS_OK(AEM_RunAsync(&appEvent, sizeof(AEM_StateAppEvent))))
}


8. AEM notifies EPG that the application is terminated.

// AEM_API_ApplicationEventStopping       = 4,         /*!< @brief Application event is stopping */

!ENTER  -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling.c F:AEM_FireAppEvent L:840 > |-> AEM_FireAppEvent
!INFO   -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling.c F:AEM_FireAppEvent L:845 > app_event=4, app_handle = 0x00000003 
!INFO   -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_common.c F:AEM_NotifyEventListeners L:639 > Notify listener for appHandle <3>, appEvent <0x00000004> 

!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5abde49, event=4 STOPPING
!MIL    -P_Api        		< P:APP t:0x016a7520 T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1168 > VIDEO IS SHOWN 


// AEM_API_ApplicationEventTerminated     = 6,         /*!< @brief Application event is closing down */
//
!ERROR  -aem          		< p:0x000001be P:APP t:0x014cf520 T:LAE_THREAD M:aem_state.c F:AEM_ApplicationStateEventListener L:169 > KT: AEM_ApplicationStateEventListener 
!ERROR  -aem          		< p:0x000001be P:APP t:0x014cf520 T:LAE_THREAD M:aem_state.c F:AEM_ApplicationStateEventListener L:170 > KT: application_handle = 0x00000172 application_event = 6 
!INFO   -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_signalling.c F:AEM_FireAppEvent L:845 > app_event=6, app_handle = 0x00000003 
!INFO   -aem          		< p:0x000001d9 P:APP t:0x0145f520 T:AEM_STATE_MONITOR_THREAD M:aem_common.c F:AEM_NotifyEventListeners L:639 > Notify listener for appHandle <3>, appEvent <0x00000006> 

!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5abde49, event=6 TERMINATED
!MIL    -AMS          		< P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:313 > APP_END event 
!MIL    -AMS          		< P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleAppEvents L:327 > Application params: app_id=2997, provider_id=256 
!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ck@5abde49, event=7 DELETED
!MIL    -EPG_MISC     		< P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/2050/banner"}
!MIL    -EPG_ALM      		< P:APP t:0x2c12f520 T:no name M:LastViewedServiceTuner F:tune L:195 > T:CEE-J EventQueue Reader 0:### tune to BBC NEWS HD
!MIL    -EPG_ME       		< P:APP t:0x2c1ac520 T:no name M:MediaEngine F:playService L:1509 > T:PooledExecutor#4:TUNING TO BBC NEWS HD, 503 locator:5:3:825


// src/AemSm.cpp
m_aemEventListener(AEM_API_ApplicationEventStopping, &eventParams);

// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:113 > application_engine.attributes.name = JavaEngine 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:114 > application_engine.attributes.content_types = .class 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:115 > application_engine.attributes.num_content_types = 1 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:116 > application_engine.attributes.single_instance = 1 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:117 > application_engine.attributes.single_application = 0 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:118 > application_engine.attributes.single_application = v1.0 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:120 > application_engine.launch_fn = 0x55f928 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:121 > application_engine.terminate_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:122 > application_engine.resume_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:123 > application_engine.show_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:124 > application_engine.hide_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:125 > application_engine.pause_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:126 > application_engine.user_input_fn = 0x55f738 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:127 > application_engine.message_received_fn = 0x55f72c 
// !PARAM  -aem          		< T:IPC_WRAPPER_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:128 > application_engine.user_multi_input_fn = (nil) 
// 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:113 > application_engine.attributes.name = LAE 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:114 > application_engine.attributes.content_types = .otv 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:115 > application_engine.attributes.num_content_types = 1 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:116 > application_engine.attributes.single_instance = 1 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:117 > application_engine.attributes.single_application = 0 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:118 > application_engine.attributes.single_application = v1.0 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:120 > application_engine.launch_fn = 0xa350ec 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:121 > application_engine.terminate_fn = 0xa3511c 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:122 > application_engine.resume_fn = 0xa3510c 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:123 > application_engine.show_fn = 0xa35144 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:124 > application_engine.hide_fn = 0xa3512c 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:125 > application_engine.pause_fn = 0xa34058 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:126 > application_engine.user_input_fn = 0xa350ac 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:127 > application_engine.message_received_fn = 0xa36c24 
// !PARAM  -aem          		< T:LAE_THREAD M:aem_api.c F:AEM_API_RegisterApplicationEngine L:128 > application_engine.user_multi_input_fn = 0xf00000 


// See this affirm when termination timeout happens.
//
// BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/almmgr/InteractiveApplicationModel.java
static final int APPLICATION_TERMINATION_TIMEOUT_MS    = 20000;

 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > T:CEE-J EventQueue Reader 0:HALT!!!  IAPP: Application termination timeout!
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > java.lang.Throwable
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at picasso.almmgr.InteractiveApplicationModel$ApplicationTerminationTimeoutTask.onTimeout (Unknown Source, bco=9)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at picasso.utils.timer.ScheduleTaskDelegate.onTimeout (Unknown Source, bco=4)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at picasso.utils.timer.ScheduleTask$1.run (Unknown Source, bco=4)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at picasso.utils.concurrent.task.RunnableWrapper.call (Unknown Source, bco=4)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at picasso.utils.concurrent.task.Task.run (Unknown Source, bco=40)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at java.awt.event.InvocationEvent.dispatch (Unknown Source, bco=32)
 !  /!\  -EPG_AFRM     		< p:0x000001be P:APP t:0x2c12f520 T:no name M:InteractiveApplicationModel$ApplicationTerminati F:onTimeout L:1417 > 	at ceej.awt.EventDispatchThread.run (Unknown Source, bco=66)


={============================================================================
|kt_dev_si_0001| comp-lae

FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/engines

// From: Rune Petersen [mailto:rune.petersen@craftwork.dk] 
AppEngineSm.cpp
	LAE_RunLevelRequest:

void Globals::DarwinInit()

void IframeSm::idleHandler(Message &msg)
	PLAYER_API_VideoFrame_Open(m_iframeHandle, PLAYER_VIDEO_FRAME_STREAM_FORMAT_ES|PLAYER_VIDEO_FRAME_TYPE_MPEG2_VIDEO);
		MPM_PRES_OpenVideoFrame(l_mpm_info, PLAYER_VIDEO_FRAME_MPM_EventHandler))


// THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/src/AemSm.cpp

void AemSm::registerAemCallbacks()
{
    AEM_API_ApplicationEngineCallback callback;
    DIAG_DECLARE_FUNCTION("initAEMCallbacks");

    strcpy((char *)callback.attributes.name, "LAE");
    strcpy((char *)callback.attributes.content_types, ".otv");
    callback.attributes.num_content_types = 1;
    callback.attributes.single_application = false; // TODO: should we have single_application set to true? ... we dont accept multiple launch commands...
    callback.attributes.single_instance = true;
    strcpy((char *)callback.attributes.version, "v1.0");
    callback.launch_fn = sAemLaunchFunctionCB;
    callback.terminate_fn = sAemTerminateFunctionCB;
    callback.show_fn = sAemShowFunctionCB;
    callback.hide_fn = sAemHideFunctionCB;
    callback.pause_fn = sAemPauseFunctionCB;
    callback.resume_fn = sAemResumeFunctionCB;
    callback.message_received_fn = sAemMessageReceiveFunctionCB;
    callback.user_input_fn = sAemUserInputFunctionCB;

    SYSTEM_STATUS status = AEM_API_RegisterApplicationEngine(callback); // before returning this function can call the callbacks
    if( status!=AEM_API_STATUS_OK )
    {
        FATAL("failed to register the Legacy App Engine with the AEM");
        exit(1);
    }
}


SYSTEM_STATUS AemSm::sAemTerminateFunctionCB(AEM_API_ApplicationHandle handle)
{
    return Globals::getAemSm()->aemTerminate(handle);
}

<debug>
// 41.80 shows LAE logging by default but 41.85 not. However, both files are
// the same. WHAT?
//
// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk
// THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/config/stbe.ini
//
// + makes LAE logging off
// /home/kyoupark/STB_SW/THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/makefile

diff --git a/lae/makefile b/lae/makefile
index 4d1a631..2bb43a1 100755
--- a/lae/makefile
+++ b/lae/makefile
@@ -1,4 +1,4 @@
-CW_USE_PRINTF=1
+#CW_USE_PRINTF=1


 #copy_to_build_location:
@@ -6,7 +6,7 @@ CW_USE_PRINTF=1
 #      cp lib/$(NDS_PLATFORM_ENDIAN)/*.a ../../$(NDS_PROJECT)/$(NDS_PLATFORM)/$(NDS_PLATFORM_ENDIAN)/engines/lae/$(NDS_BUILD_TYPE)

 #ifeq ($(NDS_BUILD_TYPE_DEFAULT), debug)
-       COMPONENT_CPP_OPTIONS_ADD+=-DCW_USE_PRINTF
+#      COMPONENT_CPP_OPTIONS_ADD+=-DCW_USE_PRINTF
 #endif


git diff BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_41.85.00_BSKYB_GM_Integration BSKYB_GM_Integration/BSKYB_INTEGRATION_BLD_41.80.00_BSKYB_GM_Integration -- THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/config/stbe.ini

NDS_BUILD_TYPE_lae = debug

THIRD_PARTY_LIBRARIES/CRAFTWORK_LAE/lae/config/stbe.ini

12809:NDS: ^[2018:01:30 14:39:28]0946685348.802348 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Stopping STBE
12810:NDS: ^[2018:01:30 14:39:28]0946685348.802468 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Setting ReturnPath core to NULL
12811:NDS: ^[2018:01:30 14:39:28]0946685348.802599 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Stopping input
12812:NDS: ^[2018:01:30 14:39:28]0946685348.802758 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Powering off core
12815:NDS: ^[2018:01:30 14:39:28]0946685348.811262 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Stopping client
12816:NDS: ^[2018:01:30 14:39:28]0946685348.811816 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [T] AemSm Checking if client has stopped
12817:NDS: ^[2018:01:30 14:39:28]0946685348.811935 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Client stopped
12818:NDS: ^[2018:01:30 14:39:28]0946685348.812088 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x01509520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] AemSm Stopping Render
12831:NDS: ^[2018:01:30 14:39:29]0946685349.008236 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x016ea520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] Render renderOsd()
12832:NDS: ^[2018:01:30 14:39:29]0946685349.008418 !INFO   -LAE                         < p:0x000001c8 P:APP t:0x016ea520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [T] Render videoColor(0x00000000) OVER m_videoFillColor(0x00000000) -> 0x00000000

7748:NDS: ^[2018:02:08 11:45:33]0946685422.513489 !INFO   -LAE                          < p:0x00000207 P:APP t:0x01721520 T:LAE_THREAD M:AppEngineSm.cpp F:LAE L:89 > [I] ServiceSm ServiceSm::getServiceByChannelKey (channelKey=2085) returning (rval=1):

<comp-iapp-output-control>
SI-10968 R13 - Black screen displayed for approx 4 secs after exiting some Interactive apps

When exercise this scenario on video channel:

exit -> background still image from EPG (LAE set output control) -> blue on whole screen (LAE) -> black and banner (LAE) -> blue and banner (EPG) -> video (player)

The problem here is that output control during transition seems not well
defined and so see bumpy output to a user. EPG or EPG and LAE together has to
manage this as far as I see. Please note that "background still image" is
shown on audio channel as well and see “video-case.nds” for the summarized
log.  

black background on audio channel

exit -> background still image from EPG (LAE set output control) -> blue on whole screen (LAE) -> black and banner (LAE) -> blue and banner (EPG)

the issue: 
a blue screen is displayed for a second, followed by a black screen for
approximately 4 seconds before normal audio and video resume. 


<video-case>
NDS: ^[2017:03:31 12:30:56]0946685435.697956 !MIL    -P_Api        		< p:0x0000024e P:APP t:0x013a5520 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1170 > VIDEO IS SHOWN 

// start iapp and off video. -> BLUE
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SELECT)e001 
!MIL    -EPG_ALM      		< P:APP T:no name M:FreeTunerReserver F:reserveFreeTuner L:62 > T:CEE-J EventQueue Reader 0:Starting live reservation
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "InteractiveMenuApplicationLaunch","action": "Application=Help and Support;description=Get help with Sky's products and services","title": "InteractiveApplication=Help and Support","label": "","currentscreen": "En\
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_applications/launching_interactive_app"}
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetBackgroundColour L:1814 > avcontrol=3, format=0x2, colour=0xff0a1a3b 
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=0 
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO NO 
!MIL    -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1174 > VIDEO IS HIDDEN 

// run iapp and shows background
13721:[2017:03:31 12:31:15] !MIL    -EPG_ALM      		< P:APP T:no name M:EventListener$1 F:run L:79 > T:CEE-J EventQueue Reader 0:IAPP: AEM event: app=ci@5a7face, event=2 RUNNING
13781:[2017:03:31 12:31:15] !MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_applications"}
13783:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=1 
13784:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
13791:[2017:03:31 12:31:15] !MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/interactive_background"}
13854:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=3, visible=1 
13855:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1098 > SetVisibility GRAPHICS TRUE 
13856:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=1, visible=1 
13857:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
13863:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=2, visible=0 
13864:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL NO 

// to black, ARGB, 0x000000
13865:[2017:03:31 12:31:15] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetBackgroundColour L:1814 > avcontrol=2, format=0x2, colour=0xff000000 
13869:[2017:03:31 12:31:15] !MIL    -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1170 > VIDEO IS SHOWN 

// lae uses graphic
14222:[2017:03:31 12:31:27] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=1, visible=0 
14223:[2017:03:31 12:31:27] !INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO NO 


// shows still background since LAE set still true when exiting iapp.
// exit key, SKY, press is logged later.
// PLAYER_API_AVControl_SourceType_Still      = 2U, /**< Still source type */
!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=2, visible=1 
!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL TRUE 

// video is blue
!MIL    -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1174 > VIDEO IS HIDDEN 

// only graphic plane on at this time

// exit iapp
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SKY)ef01 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "SKY","title": "Key Press SKY","label": "","currentscreen": "/interactive_background"}
!MIL    -EPG_ALM      		< P:APP T:no name M:BaseApplication F:terminate L:75 > T:CEE-J EventQueue Reader 0:Terminating application=Ck@5a41d82, name=Help and Support, AemApplication=ci@5a7face

// show blue video plane by LAE on whole screen since off still and shows a lower video plane
14650:[2017:03:31 12:31:46]!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=1, visible=1 
14651:[2017:03:31 12:31:46]!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
14652:[2017:03:31 12:31:46]!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=2, visible=0 
14653:[2017:03:31 12:31:46]!INFO   -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL NO 

// shows black video by LAE doing off still plane
14686:[2017:03:31 12:31:46]!MIL    -P_Api        		< P:APP T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1170 > VIDEO IS SHOWN 
14699:[2017:03:31 12:31:46]!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "SKY","title": "Key Press SKY","label": "","currentscreen": "/interactive_background"}
14702:[2017:03:31 12:31:46]!MIL    -EPG_ALM      		< P:APP T:no name M:InteractiveApplicationModel F:terminateLaunchedOrRunningApplication L:893 > T:CEE-J EventQueue Reader 0:Already terminating application=Ck@5a41d82, name=Help and Support
14810:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=2, visible=0 
14811:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL NO 

// shows blue video and epg bannear.
14853:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP t:0x2c157520 T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1320 > Can't unblank the video because the video is not running 
14929:[2017:03:31 12:31:48]!MIL    -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1174 > VIDEO IS HIDDEN 
14934:[2017:03:31 12:31:48] !INFO   -P_Api        		< p:0x0000024e P:APP t:0x2c157520 T:no name M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1435 > Set Visibility to [0] 
14941:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=1 
14942:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
15015:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=2, visible=0 
15016:[2017:03:31 12:31:48]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL NO 

15084:[2017:03:31 12:31:48] !MIL    -EPG_SCR      		< P:APP T:no name M:Screens F:doOpenScreen L:1099 > T:CEE-J EventQueue Reader 0:SCREEN BANNER layer=1, id=1 opened
15092:[2017:03:31 12:31:48] !MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/2050/banner"}

15135:[2017:03:31 12:31:48]!MIL    -EPG_ALM      		< P:APP T:no name M:LastViewedServiceTuner F:tune L:137 > T:CEE-J EventQueue Reader 0:### tune to Sky News HD

15633:[2017:03:31 12:31:50]!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","title": "PlayingStatus changed to: LIVE","label": "","currentscreen": "/tv/live/2050/banner"}
16704:[2017:03:31 12:31:52]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=1 
16705:[2017:03:31 12:31:52]!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
17147:[2017:03:31 12:31:53]!MIL    -MPM          		< P:MW  T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1376 > FRAME_PRESENTED: hMC=0x8 

// video
17182:[2017:03:31 12:31:53]!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1170 > VIDEO IS SHOWN 
17200:[2017:03:31 12:31:53]!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9410 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000006, status=RUNNING 


={============================================================================
|kt_dev_si_0001| comp-uam comp-ams

can choose ams in manatee

#-----------------------------------------------------------
# status
#-----------------------------------------------------------
# UAM_COMP_ID         	(81)
# UAM_IF_UNDEF			(0)
# SEVERITY_SEVERE		(2)
# SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMALARM_COMP_ID, SYSTEMALARM_COMP_ID, SEVERITY_NONE,    0)            

(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((81 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )

UAM_STATUS_OK 		0x14400000

static SYSTEM_STATUS DplPlayCheckPassedBoundaries(DPL_PLAY *pThis)
{
  DIAG_LOG_MIL (VRM_diag_segment_id, ("send DPLTI to anchor. hPlay = 0x%x", pThis -> hDplPlay));

  dpltiMsg.dpl_play_handle = pThis->hDplPlay;
  dpltiMsg.dpl_play_data.asset_transition_data.dplti = dplti;

  pThis->notifyCallback (DPL_PLAY_EVENT_ASSET_TRANSITION, &dpltiMsg);
  pThis->prevDirection = pThis->playDirection;
}

void BookingPlayNotifyServerDplEvent(DPL_PLAY_EVENT dpl_play_event, const DPL_PLAY_EVENT_DATA *p_event_data)
{
  case(DPL_PLAY_EVENT_ASSET_TRANSITION):
    event = E_VRM_SRV_EVENT_JOB_PLAY_MSO_CHANGED;
    event_data.job_mso_data.origin = MSO_ORIGIN_DPL;
    event_data.job_mso_data.mso_status = VRM_STATUS_OK;
    event_data.job_mso_data.job_handle = VRM_SRV_GetJobHandleFromCookie (pThis->job_man_cookie);
    event_data.job_mso_data.mso_handle = p_event_data->dpl_play_data.asset_transition_data.dplti;
    break;
}


// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_uam.c
void PLAYER_UAM_SignalPlaybackUpdate()
{
  if (UAM_API_STATUS_OK != UAM_API_ParamDataProcessEvent(l_uam_handle));
}

!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalSpeedInfo L:2562 > Succeed to send param bag to UAM with properties speed=12000 and time=59793098 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalSpeedChange L:1411 > Speed  = 12000 - Last Speed Notified = 6000  
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_GetPlaybackPosition L:256 > position = 30 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SetBookingType L:593 > UAM Booking Type [0x81] 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalPlaybackUpdate L:632 > event type = SPEED, recorded time = 30, service key = 0x0, speed = 12000,booking_type 81 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:Get_UAM_EventSource L:1923 > Event Source = [ 0x2 ] - PDL 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalPlaybackUpdate L:793 > Set CA status = CA_STATUS_ENABLED -  0x1 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalPlaybackUpdate L:815 > Set EXT_ASSET_ID = 0xFFFE0012 
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalPlaybackUpdate L:825 > Program id  = 0 


^[2017:09:11 06:46:11] !MIL    -VRM_SERVER   		< T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x200 
^[2017:09:27 06:17:42] !INFO   -P_Api        		< T:PLAYER_MAIN M:player_common.c F:MessageThread L:3977 > *** Message received (event = PLAYER_EVT_ASSET_TRANSITION) *** 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > KT: In PLAYER_UAM_SignalAssetTransition, l_evt_type = 77 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2456 > KT: get PLAYLIST_INDEX(3) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2457 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_REPORTING_THRESHOLD(75) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2458 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_EVENT_TYPE, vrm event(2) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2459 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_PART_DURATION(1120) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2460 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_START_OFFSET(0) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2461 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_END_OFFSET(1120) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2462 > KT: get SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME(22662047) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2463 > KT: set UAM_API_DESC_DPL_EVENT_TYPE(1) 
^[2017:09:27 06:17:42] !INFO   -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2485 > Succeed to send param bag to UAM 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > KT: In PLAYER_UAM_SignalAssetTransition, l_evt_type = 78 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2456 > KT: get PLAYLIST_INDEX(4) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2457 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_REPORTING_THRESHOLD(75) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2458 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_EVENT_TYPE, vrm event(2) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2459 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_PART_DURATION(30080) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2460 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_START_OFFSET(0) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2461 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_END_OFFSET(30080) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2462 > KT: get SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME(22662047) 
^[2017:09:27 06:17:42] !ERROR  -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2463 > KT: set UAM_API_DESC_DPL_EVENT_TYPE(1) 
^[2017:09:27 06:17:42] !INFO   -P_Api        		< T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2485 > Succeed to send param bag to UAM 

^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:AMSMain L:481 > ProcessEvent 

// XTV_High_Level_VOB/EGEN/EventGenerator/framework/inc/ams_generic_API.h
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:translate.cpp F:Translate2AMS::AMSEvent L:60 > Got generic event AMS_API_EVENT_TYPE_DPL_ASSET_FROM [0x4D], len = 462 

^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x71 , name=AMS_API_PARAM_ADM_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x70 , name=AMS_API_PARAM_PLAYLIST_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x72 , name=AMS_API_PARAM_PLAYLIST_INDEX 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x77 , name=AMS_API_PARAM_PLAYLIST_DOWNLOAD_TIME 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x78 , name=AMS_API_PARAM_PLAYLIST_DOWNLOAD_TIME_MS 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x80 , name=AMS_API_PARAM_DPL_REPORTING_THRESHOLD 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7f , name=AMS_API_PARAM_DPL_EVENT_TYPE 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7e , name=AMS_API_PARAM_PART_DURATION 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x73 , name=AMS_API_PARAM_PRIMARY_PROVIDER_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x74 , name=AMS_API_PARAM_SECONDARY_PROVIDER_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x75 , name=AMS_API_PARAM_PRIMARY_ASSET_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x76 , name=AMS_API_PARAM_SECONDARY_ASSET_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7d , name=AMS_API_PARAM_REPORTING_DESTINATIONS 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7a , name=AMS_API_PARAM_ASSET_START_OFFSET 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7b , name=AMS_API_PARAM_ASSET_END_OFFSET 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x79 , name=AMS_API_PARAM_DPL_EVENT_TIME 

^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:ProcessEvent L:292 > event DPL_ANYTIME_FROM [0x75]\n 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::IsRTREvent L:332 > RTR event = 117, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::HandleDataClientEvent L:278 > RTRdata_ rec is = 212, data_ rec is = 212 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRData.cpp F:RTRData::updateState L:458 > DPL_ANYTIME_FROM, isInPlayMode 1, viewInNormalPlay_ = 1211, part_duration_ =1120,inNormalPlay_ =108, dpl_event_time_ =22662047 ! 


// CMS_MEDIA_SERVICES/CTM/src/server/ctm_svr_json.c
// (void)SYSTEMUTIL_JSON_Object_AddItem(l_json_subscriber_obj, "subscriberId", l_json_item);


^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::StoreJsonBuffer L:163 > buff size = 914 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::StoreJsonBuffer L:164 > buff {
	"immediateReport":	[{
			"subscriberId":	22844813,
			"playlistId":	718013459,
			"admId":	3,
			"playlistIndex":	3,
			"primaryProviderId":	"bsky_atlantic_hd",
			"secondaryProviderId":	"bsky_secpresevent_hd",
			"primaryAssetId":	"MAIN00000[2017:09:28 00:27:13]0000065867 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::StoreJsonBuffer L:181 > free_loc =0, isQueueFree 1 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::HandleDataClientEvent L:290 > Set timer RTR_TIMERTICK 2 seconds 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:Scheduler::StartTimer L:126 > event RTR_TIMERTICK [0x78], second 2 curr time 0x59CB4286\n 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:213 > === Timers Info: ================================ 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:221 > tag). event[0xID] [param] 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:227 > 0x00DC0002). RESTART_TIMER [0x26] [0x00000000] 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:227 > 0x047B0008). HEARTBEAT_TIMERTICK [0x5F] [0x00000000] 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:227 > 0x004F000F). PLAY_VIEW_TIMERTICK [0x5E] [0x00000000] 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:227 > 0x0060001B). RTR_TIMERTICK [0x78] [0x00000000] 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:scheduler.cpp F:&&& L:230 > ===  4 timer[s] is ON =========================== 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:GenericDataClient.cpp F:DataClient::IsAGFEvent L:527 > This is not Generic event = 117, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:BARBDataClient.cpp F:BARBDataClient::IsBARBEvent L:514 > This is not BARB event = 117, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:209 > HandleDataClientEvent event = 117 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:332 > SSFDataClient::IsSSFEvent ev = 117  
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:445 > This is not SSF event = 117, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:213 > HandleDataClientEvent NOT SSF event = 117 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:AMSMain L:481 > ProcessEvent 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:translate.cpp F:Translate2AMS::AMSEvent L:60 > Got generic event AMS_API_EVENT_TYPE_DPL_ASSET_TO [0x4E], len = 488 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x71 , name=AMS_API_PARAM_ADM_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x70 , name=AMS_API_PARAM_PLAYLIST_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x72 , name=AMS_API_PARAM_PLAYLIST_INDEX 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x77 , name=AMS_API_PARAM_PLAYLIST_DOWNLOAD_TIME 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x78 , name=AMS_API_PARAM_PLAYLIST_DOWNLOAD_TIME_MS 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x80 , name=AMS_API_PARAM_DPL_REPORTING_THRESHOLD 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7f , name=AMS_API_PARAM_DPL_EVENT_TYPE 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7e , name=AMS_API_PARAM_PART_DURATION 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x73 , name=AMS_API_PARAM_PRIMARY_PROVIDER_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x74 , name=AMS_API_PARAM_SECONDARY_PROVIDER_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x75 , name=AMS_API_PARAM_PRIMARY_ASSET_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x76 , name=AMS_API_PARAM_SECONDARY_ASSET_ID 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7d , name=AMS_API_PARAM_REPORTING_DESTINATIONS 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7a , name=AMS_API_PARAM_ASSET_START_OFFSET 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x7b , name=AMS_API_PARAM_ASSET_END_OFFSET 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:es_translator.cpp F:ES_Translator::ExtractData L:199 > Extract data, descriptor type = 0x79 , name=AMS_API_PARAM_DPL_EVENT_TIME 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:ProcessEvent L:292 > event DPL_ANYTIME_TO [0x76]\n 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::IsRTREvent L:332 > RTR event = 118, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::HandleDataClientEvent L:278 > RTRdata_ rec is = 212, data_ rec is = 212 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRData.cpp F:RTRData::updateState L:445 > DPL_ANYTIME_TO, isInPlayMode 1, viewInNormalPlay_ = 0, dpl_event_time_ =22662047, speed_=1000 ! 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:GenericDataClient.cpp F:DataClient::IsAGFEvent L:527 > This is not Generic event = 118, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:BARBDataClient.cpp F:BARBDataClient::IsBARBEvent L:514 > This is not BARB event = 118, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:209 > HandleDataClientEvent event = 118 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:332 > SSFDataClient::IsSSFEvent ev = 118  
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:445 > This is not SSF event = 118, 
^[2017:09:27 06:17:42] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:213 > HandleDataClientEvent NOT SSF event = 118 

^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:AMSMain L:481 > ProcessEvent 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:ams.cpp F:ProcessEvent L:292 > event RTR_TIMERTICK [0x78]\n 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::IsRTREvent L:332 > RTR event = 120, 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:DataClient::HandleDataClientEvent L:278 > RTRdata_ rec is = 212, data_ rec is = 212 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::SendToDataClient L:135 > Is RTR Init = 1 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::SendToDataClient L:139 > Before UploadData /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:206 > buffNum=1, is_free=1, priority=0, tempPriority=0 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:206 > buffNum=2, is_free=1, priority=0, tempPriority=0 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:206 > buffNum=3, is_free=1, priority=0, tempPriority=0 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:206 > buffNum=4, is_free=1, priority=0, tempPriority=0 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_API_UploadFile L:176 > size = 914, user_tag = 0 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:374 > Setting option HTTP_API_OPT_HTTP_VERSION to version 1.1 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:383 > Setting option HTTP_API_OPT_USERAGENT to NDS_MHF 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:392 > Setting option HTTP_API_OPT_TIMEOUT to 3 seconds 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:401 > Setting option HTTP_API_OPT_CONNECTTIMEOUT to 3 seconds 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:410 > Setting option HTTP_API_OPT_URL to default url /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:419 > Setting option HTTP_API_OPT_POST  
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:428 > Setting option HTTP_API_OPT_MAXFILESIZE to size 2700 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:448 > Setting option HTTP_API_OPT_HTTPHEADER to size 2700 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:453 > Setting option HTTP_API_OPT_SECURITY_MODE to DRM_SCHEME  
^[2017:09:27 06:17:44] !MIL    -AMS          		< T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=914,isLastSent=1 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:GenericDataClient.cpp F:DataClient::IsAGFEvent L:527 > This is not Generic event = 120, 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:BARBDataClient.cpp F:BARBDataClient::IsBARBEvent L:514 > This is not BARB event = 120, 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::DataClientCallBackFunc L:57 > DC get data 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:209 > HandleDataClientEvent event = 120 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:332 > SSFDataClient::IsSSFEvent ev = 120  
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::IsSSFEvent L:445 > This is not SSF event = 120, 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:UAM_HP_THREAD M:SsfFilesDataClient.cpp F:SSFDataClient::HandleDataClientEvent L:213 > HandleDataClientEvent NOT SSF event = 120 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_Thread_HttpRequestHandler L:326 > AMS_FTM_EVENT_UPLOAD received. calling AMS_FTM_HttpPost 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_Thread_HttpRequestHandler L:336 > AMS_FTM_HttpPost url=/ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy,size =111 timeout=3 connection_timeout=3 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:473 > Setting option HTTP_API_OPT_POSTFIELDSIZE to size 914 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:482 > Performing Http POST request -- setting HTTP_API_OPT_POSTFIELDS to the buffer received from the client 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:491 > KT: {
	"immediateReport":	[{
			"subscriberId":	22844813,
			"playlistId":	718013459,
			"admId":	3,
			"playlistIndex":	3,
			"primaryProviderId":	"bsky_atlantic_hd",
			"secondaryProviderId":	"bsky_secpresevent_hd",
			"primaryAssetId":	"MAIN00000[2017:09:28 00:27:13]0000065867 
^[2017:09:27 06:17:44] !ERROR  -AMS          		< T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:501 > Performing Http POST request -- calling the synchronous call to HTTP_API_Perform() 


void PLAYER_UAM_SignalAssetTransition( SYSTEMOBJECT_HANDLE l_obj_handle )
{
                        // { KT
                        else if ( SYSTEMOBJECT_STATUS_OK == SYSTEMOBJECT_GetInteger(l_child_handle,SYSTEMOBJECT_DPLAI_PROPID_I_PL_INDEX,&l_pl_index))
                        {
                            PLAYER_DIAG_LOG_ERROR(("KT: get PLAYLIST_INDEX(%ld)", l_pl_index));
                        }
                        // } KT
                        //
                                                    else if (UAM_API_STATUS_OK != UAM_API_ParamDataProcessEvent( l_uam_handle ))
}


 .text.UAM_API_ParamDataProcessEvent
/components/darwin_system_platform_components/darwin_uam/src/libdarwin_uam.a(uam_api.o)
                0x00000000006c2148                UAM_API_ParamDataProcessEvent

/components/darwin_system_platform_components/darwin_uam/src/dcm/src/uam_api.o uam_api.c -o


// UAM_API_ParamDataProcessEvent  345 DARWIN_PLATFORM/DARWIN_UAM/src/dcm/src/darwin/uam_api.c SYSTEM_STATUS UAM_API_ParamDataProcessEvent(UAM_API_PARAM_DATA_HANDLE sourceHandle)
UAM_API_ParamDataProcessEvent  552 DARWIN_PLATFORM/DARWIN_UAM/src/dcm/src/uam_api.c SYSTEM_STATUS UAM_API_ParamDataProcessEvent(UAM_API_PARAM_DATA_HANDLE sourceHandle)

SYSTEM_STATUS UAM_API_Event( UAM_API_REPORTING_COMP		reporting_comp,
								  UAM_API_EVENT_TYPE			event_type,
								  unsigned short				payload_length,
								  unsigned char				*event_payload)

{
	SYSTEM_STATUS uam_status;
	AMS_API_STATUS ams_status;

	DIAG_DECLARE_FUNCTION("SERVER: UAM_API_Event");
	DIAG_LOG_FN_ENTRY(UamDiagSegmentId);

	DIAG_LOG_INFO(UamDiagSegmentId,("called with params: reporting_comp = %d, event_type = %d payload_length = %d",reporting_comp, event_type, payload_length) );

	
	ams_status = AMS_API_Event(reporting_comp,
							  	  event_mapping_table[event_type],
							  	  payload_length,
							   	  event_payload );
}


//../processes/mw_process_main.o (UAM_RunLevelRequest)

//DARWIN_PLATFORM/DARWIN_UAM/src/main/src/uam_main.c
{
  stat = UamInitialize(); /* all is OK - we call in this context because we don't have a thread yet.*/
}

static SYSTEM_STATUS UamInitialize (void)
{
	if (AMS_API_STATUS_OK != AMS_API_Init(ams_priority))
}

// XTV_High_Level_VOB/EGEN/EventGenerator/framework/src/generic_API/generic_API.cpp:77:            stat = ( 0 == AmsQueue::GetInstance()->CreateTask( AMSMain, task_priority ) )
AMS_API_STATUS AMS_API_Init(unsigned long task_priority)
{
  stat = ( 0 == AmsQueue::GetInstance()->CreateTask( AMSMain, task_priority ) )
}

AMS_API_STATUS AMS_API_Event(AMS_API_REPORTING_COMP	reporting_comp)
{
  static AMS_API_STATUS PostEventToAmsQueue(unsigned char *payload, unsigned short len)
  {
    AMS_DEBUG_DEFINE_FUNC_INFO("PostEventToAmsQueue");

    AMS_API_STATUS stat =
      (0 == AmsQueue::GetInstance()->PostPayload(payload, len)) ?
      AMS_API_STATUS_OK : AMS_API_QUEUE_FULL;

    AMS_DEBUG_ERROR_IF_NOT_OK(stat,("Error post Event to Ams Queue:0x%x",stat));

    return stat;
  }
}


//XTV_High_Level_VOB/EGEN/EventGenerator/generic_linux/src/ams.cpp
void AMSMain(void *)
{
		RTRDataClient rtrClient;
}

RTRDataClient::RTRDataClient()    
{
    AMS_DEBUG_DEFINE_FUNC_INFO("RTRDataClient::RTRDataClient");
    AMS_DEBUG_DEFINE_FUNC_ENTRY    

    DataClient::Init();
}

// HandleDataClientEvent   58 ../../../../../XTV_High_Level_VOB/EGEN/DataClient/framework/src/dataClient.cpp     THIS->HandleDataClientEvent(de, descriptor, timeStamp, type, timeStampMS);
void DataClient::Init()
{
  (void)EGEN_RegisterDataClient( (DataClientCallback)(DataClientCallBackFunc), (void*)this, &dc_id );
}

void DataClient::DataClientCallBackFunc(void* userData, EGEN_DELIVER_EVENTS de, const char* descriptor, long timeStamp, DC_TYPE type, long timeStampMS)
{
    AMS_DEBUG_DEFINE_FUNC_INFO("DataClient::DataClientCallBackFunc");

    DataClient*    THIS = (DataClient*)userData;
    AMS_DEBUG_TRACE(("DC get data"));
    THIS->HandleDataClientEvent(de, descriptor, timeStamp, type, timeStampMS);
}

// XTV_High_Level_VOB/EGEN/DataClient/RTR/src/RTRDataClient.cpp
//
// 12.4.1	UAM DPL Playback State Machine
//
// XTV_High_Level_VOB/EGEN/DataClient/RTR/src/RTRData.cpp
// to create report json file and the calculation of inNormalPlay
void RTRData::updateState(AmsEvent ev)
{
  inNormalPlay_ = viewInNormalPlay_ * 100 / part_duration_;
}

void RTRDataClient::HandleDataClientEvent(EGEN_DELIVER_EVENTS de) 
{
  RTRdata_.updateState(ev);

  (RTRdata_.dpl_reporting_thr_ <= RTRdata_.inNormalPlay_)){
    //Storing the json buffer before sending. If the storage is full - ignore this json, and loose this data
    stat = StoreJsonBuffer();
  }

  SendToDataClient();
}

void RTRDataClient::SendToDataClient()
{
  UploadData();
}


1486618:NDS: ^[2017:09:11 06:46:28]0946916728.301981 !MIL    -AMS          		< p:0x00000209 P:MW t:0x0210b520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=918,isLastSent=1 
1486619:NDS: ^[2017:09:11 06:46:28]0946916728.302140 !ERROR  -AMS          		< p:0x00000209 P:MW t:0x0212a520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:491 > KT: {
1486620:	"immediateReport":	[{
1486621:			"subscriberId":	22844813,
1486622:			"playlistId":	692491100,
1486623:			"admId":	3,
1486624:			"playlistIndex":	8,
1486625:			"primaryProviderId":	"bsky_skyatlanprev_hd",
1486626:			"secondaryProviderId":	"bsky_seccomcmpgn_hd",
1486627:			"primaryAssetId":	"MAIN00[2017:09:08 14:25:51]0000000291 


// XTV_High_Level_VOB/EGEN/DataClient/framework/src/dataClient.cpp
// void   DataClient::handlePlaybackEvents(AmsEvent  ev, const char* buff)
//
// EventGenerator/framework/inc/amsEvents.h
//
//	/* Playback events */\
//	PLAY_OPEN,\
//	PLAY_CHANGE,\
//	OFFSET,\
//	SPEED,\            // 15
//	PLAY_OFF,\
//	PLAY_TIMERTICK,\
//	PLAY_EOF,\

!MIL    -AMS          		< P:MW  T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handlePlaybackEvents L:348 > PLAYBACK event= 15 
!MIL    -AMS          		< P:MW  T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handlePlaybackEvents L:354 > Parameters = offset 30, speed 12000, eventSource 2, bookingType 129 


NDS: ^1489061802.438809 !MIL   -AMS          < p:00000470 t:02170520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:00228 > 
Post the report to server http://10.10.200.142:12960/ADMReportingServerProxy, buffNum=0, buffer size=623,isLastSent=1

// void RTRDataClient::UploadData()
// {
//        if (AMS_FTM_API_UploadFile(s_buff[buffNum].buff, file_size, buffNum, ip_address_)!= AMS_FTM_STATUS_OK);
//        {
//            AMS_DEBUG_MIL(("Post the report to server %s, buffNum=%d, buffer size=%d,isLastSent=%d",ip_address_, buffNum,file_size,isLastSent));
//        }
// }
//
// XTV_High_Level_VOB/EGEN/DataClient/FileTransMngr/src/fusionfs/AMS_ftm.cpp
//
// AMS_FTM_STATUS AMS_FTM_API_UploadFile(const char* buffer, uint32_t size, uint32_t user_tag, const char * ip_address)
// {
//        if (SYSTEMITC_API_PostEvent( &AMS_FTM_Ctxt.reqQueue, (uint32_t)AMS_FTM_EVENT_UPLOAD, &message, sizeof(message) ) != SYSTEMITC_OK)
// }
//
// static void* AMS_FTM_Thread_HttpRequestHandler(void *p)
// {
//         switch (event)
//         {
//             case AMS_FTM_EVENT_UPLOAD: /*request to upload information using http */
//                 AMS_DEBUG_TRACE(("AMS_FTM_EVENT_UPLOAD received. calling AMS_FTM_HttpPost"));
//                 if(message.url_size > 0)
//                 {
//                     system_status = HTTP_API_Setopt(AMS_FTM_Ctxt.httpHandle, HTTP_API_OPT_URL, message.url);
//                     if (!SYSTEM_STATUS_IS_OK(system_status))
//                     {
//                         AMS_DEBUG_ERROR(("Set option HTTP_API_OPT_URL FAILURE:error  [%s]", HTTP_API_Strerror(system_status)));
//                     }
//                     else
//                     {
//                         AMS_DEBUG_TRACE(("AMS_FTM_HttpPost url=%s,size =%d timeout=%d connection_timeout=%d", message.url, message.url_size, AMS_FTM_Ctxt.timeout,AMS_FTM_Ctxt.connecttimeout));
//                         (void) `AMS_FTM_HttpPost`(message.buffer, message.buffer_size, message.user_tag);
//                     }
//                 }
//                 break;
//          }
// }

// <onw-debug-logging>
// XTV_High_Level_VOB/EGEN/DataClient/FileTransMngr/src/fusionfs/AMS_ftm.cpp
// 
// /** @brief perform Http POST request */
// static AMS_FTM_STATUS `AMS_FTM_HttpPost`(char * buffer, uint32_t size, uint32_t user_tag);
//     AMS_DEBUG_ERROR(("KT: %s", buffer));

NDS: ^1489061802.439050 !ERROR -AMS          < p:00000470 t:0217e520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:00491 > KT: {
	"immediateReport":	[{
			"subscriberId":	360235568,
			"playlistId":	1,
			"admId":	1,
			"playlistIndex":	2,
			"primaryProviderId":	"bskyb.com",
			"secondaryProviderId":	"bskyb.com",
			"primaryAssetId":	"Primary_Asset_Plist1",
			"secondaryAssetId":	"Secondary_Asset_num1",
			"currentTime":	"09:02:53.430",
			"assetPlaybackStartTime":	"09:02:23.102",
			


XTV_High_Level_VOB/EGEN/EventGenerator/portinglayer/inc/log_output/diag/egen_dbg.h:49:#define AMS_DEBUG_ERROR(X)                                        DIAG_LOG_ERROR(amsDbgOut.GetID(), X )
#define AMS_DEBUG_DEFINE_FUNC_INFO(FUNCTION_NAME_STR)		DIAG_DECLARE_FUNCTION(FUNCTION_NAME_STR)
#define AMS_DEBUG_TRACE(X)					DIAG_LOG_INFO(amsDbgOut.GetID(), X )
#define AMS_DEBUG_WARN(X)					DIAG_LOG_WARN(amsDbgOut.GetID(), X )
#define AMS_DEBUG_ERROR(X)					DIAG_LOG_ERROR(amsDbgOut.GetID(), X )
#define AMS_DEBUG_MIL(X)					DIAG_LOG_MIL(amsDbgOut.GetID(), X )
#define AMS_DEBUG_CR						DIAG_LOG_INFO(amsDbgOut.GetID(),("\n"))

// NOTE to get ams log out, change to
// #define AMS_DEBUG_TRACE(X)					DIAG_LOG_INFO(amsDbgOut.GetID(), X )
#define AMS_DEBUG_TRACE(X)					DIAG_LOG_ERROR(amsDbgOut.GetID(), X )


={============================================================================
|kt_dev_si_0001| comp-gfx comp-gfx-image

<gfx-image>
kyoupark@st-castor-03:~/STB_SW$ grep GFX_IMAGE FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/SI_config.xml

164:        <key name="POOL_SIZE_GFX_IMAGE" type="INTEGER" value="2000000">

P1	70	27586	2017:08:28 14:28:34	Out of memory in " "GFX_IMAGE" pool.
APP_GFX_IMAGE

GfxImageCreate
gfx_image_library.c:880
Java_com_nds_fusion_gfximpl_GfxImageImpl_natCreateImage
natGfxImageImpl.c:56

note: there is no diag segment for J_GFX
modules/jpa-impl/src/c/src/natGfxImageImpl.c

JNIEXPORT jint JNICALL Java_com_nds_fusion_gfximpl_GfxImageImpl_natCreateImage
  (JNIEnv *env, jclass jClass, jbyteArray jData, jint jOffset, jint jLength)
{
    GFX_IMAGE_Image image = NULL;
    SYSTEM_STATUS status = GFX_IMAGE_GfxCreateFromContinuousMemory(GFX_PIXEL_FORMAT_ALL, GFX_CLUT_HANDLE_INVALID, &image);
    if (SYSTEM_STATUS_IS_OK(status)) {
        status = GFX_IMAGE_SetPixelFormatAll(image, PREFERRED_GFX_PIXEL_FORMAT);
        if (SYSTEM_STATUS_IS_OK(status)) {
            status = JPA_GFX_IMAGE_Decode(env, image, jData, jOffset, jLength);
        }
    }
    JPA_GFX_MaybeThrowException(env, status);
    return (jint)image;
}

JNIEXPORT void JNICALL Java_com_nds_fusion_gfximpl_GfxImageImpl_natDestroyGfxImage
  (JNIEnv *env, jclass jClass, jint jImageHandle)
{
    // Flush hardware blitter
    JPA_GFX_BLITTER_CHAIN_Execute(JPA_GFX_BLITTER_CHAIN_DESTROY_SURFACE);

    GFX_IMAGE_Destroy((GFX_IMAGE_Image)jImageHandle);
}

SYSTEM_STATUS GFX_IMAGE_Destroy (GFX_IMAGE_Image anImage) {
  status = anImage->api->destroyDecomp (anImage, GFX_IMAGE_ALL_IMAGES);
}

// uses function tables
static GFX_IMAGE_DecoderAPI   jpeg_interface_DecoderAPI = {
  GFX_IMAGE_API_ID_JPEG,            /* id */
  JPEG_HEADER_SIZE,                 /* signNbByte */
  JPEG_INTERFACE_IsOfType,          /* isOfType */
  JPEG_INTERFACE_DestroyDecomp,     /* destroyDecomp */
  JPEG_INTERFACE_ReadImageSize,     /* readImageSize */
  JPEG_INTERFACE_LaunchDecomp,      /* launchDecomp */
  JPEG_INTERFACE_ResumeDecomp,      /* resumeDecomp */
  JPEG_INTERFACE_StopDecomp,        /* stopDecomp */
};


Q: It shows 11 allocations when hit OOM. Each requested allocation is 176904
bytes and the total: size=1945944 / pool size=2000000

A: 176904 bytes is the memory required for a single cover art image (182x243 *
    4 bytes per pixel). R15 introduces wall of cover art in Cinema and Store,
  which displays up to 15 cover art images.

The EPG should be copying each decoded image to its own GFX surface and then
immediately freeing it, but there are some threading issues with the way it
does this in some places. 


<if>
CMS_PLATFORM_SERVICES/GFX/inc/gfx_image.h


<gfx-region>
POOL_SIZE_GFX_REGION=125000


={============================================================================
|kt_dev_si_0001| comp-atm comp-adsmart comp-asm

<adlog>
~/bin/log_analysis_scripts/adlog.py > adlog.txt

http://hetty.cisco.com/fusionmadesimple/index.php/BSkyB_AdSmart_SI_Helpers

<asm-playlist>
// asmlib.cfg
[ASMLIB_PLAYLIST]
ASMLIB_PLAYLIST_MAX_SO=5

#define ASMLIB_PLAYLIST_MAX_SUBSTITUTION_OBJECTS "ASMLIB_PLAYLIST_MAX_SO"

	status = SYSTEMCONFIG_GetIntegerValue(hConfigFile, ASMLIB_SECTION_PLAYLIST, 
		ASMLIB_PLAYLIST_MAX_SUBSTITUTION_OBJECTS, &nMaxSOObjects);


<ams-comp-status>

COMMON_MIDDLEWARE/ASMlib/inc/asm_common.h

/** @brief ASM status different values */
typedef enum ASM_COMMON_STAT_VAL_TAG
{
	E_ASM_COMMON_STATUS_VAL_OK = 0,
	E_ASM_COMMON_STATUS_VAL_FAILURE,
	E_ASM_COMMON_STATUS_VAL_NOT_READY,
	E_ASM_COMMON_STATUS_VAL_PARAM_ERROR,
	E_ASM_COMMON_STATUS_VAL_NOT_SUPPORTED,
	E_ASM_COMMON_STATUS_VAL_NOT_FOUND,
	E_ASM_COMMON_STATUS_VAL_LIST_IS_FULL,
	E_ASM_COMMON_STATUS_VAL_ALREADY_EXISTS,
	E_ASM_COMMON_STATUS_VAL_RANGE_VIOLATION,
	E_ASM_COMMON_STATUS_VAL_ASYNCHRONOUS,
	E_ASM_COMMON_STATUS_VAL_MEMORY_ALLOCATION_FAIL,
	E_ASM_COMMON_STATUS_VAL_MISSING_DATA,

	E_ASM_COMMON_STATUS_VAL_LAST
} ASM_COMMON_STAT_VAL;

F:RecordActionFsmOnExit L:4661 > input = PANEL_CONFIGURE, new state = CONFIGURING, last_status = [ASM:interface(3):SEVERE:status(6)(0x6)][(243412998)(0x0E823006)] 

// get comp id
(0x0E823006 >> 22) & 0x3FF

// get if id
(0x0E823006 >> 12) & 0xF

// get severity
(0x0E823006 >> 16) & 0x3

// get status
(0x0E823006) & 0xFFF

>>> (0x0E823006) & 0xFFF
6
// E_ASM_COMMON_STATUS_VAL_LIST_IS_FULL,
// ASM_COMMON_SESSION_STATUS_LIST_IS_FULL
// #define ASM_MAX_SESSIONS_NUMBER (30U)

2949607:NDS: ^[2018:05:02 01:16:18]0946731371.678646 !MIL    -ASM          		< p:0x0000032c P:MW t:0x01cf9520 T:ASMLIB_MAIN_THREAD M:asmlib_so.c F:ASMLIB_SO_DestroySubstitutionObject L:4714 > status=
>>> (0xe803000) & 0xFFF
0

>>> (0x0E821001) & 0xFFF
1

// get severity
(0x0E821001 >> 16) & 0x3
2


<bdl-job>
// seems it do not have shrec
!MIL    -VRM_SERVER   P:MW T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=`jb-jb-bdl-record`, jhVRM=0x2000051 
!MIL    -VRM_SERVER   P:MW T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `bdl:0x50`,0x2907286b: E_BDL_INT_STATE_NONE -> (E_BDL_INPUT_START) -> E_BDL_INT_STATE_WAIT_MCON_STARTED 
!MIL    -VRM_SERVER   P:MW T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6353 > Initiaizing Record FSM: rec_handle:0x53001f, item_ID:0x2907286b 

<log>
This parsed log attached may help you save time. It is parsed for the following strings -
keyPressed", "splicer", "failed to find index", "no streaming for 3000 ms", “HandleInjectionCompleteEvent"

<ple-to-asm>
!INFO   -VRM_SERVER   		< T:VRM_SRV M:vrm_ple.c F:VrmPleSessionCreate L:5458 > [API_CALL::""ASM""] " "ASM_SESSION_Create returned [SYSTEM_STATUS_OK 0x0E802000] hPle(0x315f0003) asm_handle (0x315e)  
!INFO   -VRM_SERVER   		< T:VRM_SRV M:vrm_ple.c F:VrmPleSessionCreate L:5509 > Ended. hPle=(0x315f0003) stat [VRM:STATUS_OK 0x0B400000] 
!INFO   -VRM_SERVER   		< T:VRM_SRV M:vrm_ple.c F:VRM_PLE_CreateRBPlaySession L:988 > Ended.stat [VRM:STATUS_OK 0x0B400000] hPle (0x315f0003) 
!INFO   -VRM_SERVER   		< T:VRM_SRV M:vflist_play.c F:VflistPlayCreatePLESession L:1585 > Call::VRM_PLE_CreateRBPlaySession returned [VRM:STATUS_OK 0x0B400000] hPle 0x315f0003 starting speed -2000 

<mc-to-asm>
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > 
@@PMON@@,trace,mediacon,mc-create,65366,mc-create-mcid=,65366,mc_create-str=,mc-playback,fsnfmt=,hMC=0xff56 

!MIL    -MSM_MS       		< T:EVENT_MGR_THREAD M:transition_controller.cpp F:(ResolveTrickplayStrategy) L:1500 > 
< splicer=0xff56 hMC=0xff56 >" "-MS_STREAM- xcon 65366, has_video XTRUE, encoding E_ITEM_VIDEO_ENCODING_TYPE_MPEG4, bitrate 8000, " "strategy E_PB_MODE_I_FRAMES_REVERSE, speed -2000, iframe display interval=250ms 

// #define MCM_MEDIACONN_TYPE_SUBSTITUTION   `0x700000c`
!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:947 > 
MCM_MEDIACONN_STATE_OPENED hMC=0xff57 `replace` hMC=0xff56 type=0x0700000c 

// back to the start mc?
!MIL    -MSM          		< T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > 
h_media_connection  [hMC=0xff56],from_mcon [hMC=0xff57],to_mcon [hMC=0xff56] 

!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:947 > 
MCM_MEDIACONN_STATE_OPENED hMC=0xff58 replace hMC=0xff56 type=0x0700000c 

// asm-mc is destoryed as normal mc
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > 
@@PMON@@,trace,mediacon,mc-destroyed,65367,fsnfmt=,hMC=0xff57 

// differnt mc
!WARN   -MSM_MS       		< T:EVENT_MGR_THREAD M:security.cpp F:(PushMaximumAllowed) L:1965 > 
< splicer=0xff56 hMC=0xff57 >" "Read needed has to be" " stalled because not in range." " active range=[([2055:01:24 16:51:31]2147483647, 4294967295)->([2055:01:24 16:51:31]2147483647, 4294967295)]. 

// same mc
!WARN   -MSM_MS       		< T:EVENT_MGR_THREAD M:security.cpp F:(PushMaximumAllowed) L:1965 > < 
splicer=0x8a8d hMC=0x8a8d >" "Read needed has to be" " stalled because not in range." " active range=[([2055:01:24 16:51:29]2147483647, 4294967295)->([2055:01:24 16:51:29]2147483647, 4294967295)]. 

mediascon|splicing|splicer|


<sub>
Substitution starting:
!MIL    -MSM          		< T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SubstitutionStart) L:96 > MCM main_asset_mcon [hMC=0x7], mc_type = 117440514 Ends with status = 0x5802000 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: pleLive:0x50000: E_PLE_STATE_SESSION_CREATED -> (E_PLE_INPUT_SUBST_START) -> E_PLE_STATE_SUBST_ONGOING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: play:0x100: E_PLAY_INT_STATE_NONE -> (E_PLAY_INPUT_START) -> E_PLAY_INT_STATE_STARTING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: play:0x100: E_PLAY_INT_STATE_STARTING -> (E_PLAY_INPUT_RMF_ACQUIRE_RESOURCE) -> E_PLAY_INT_STATE_ALLOCATING_RESOURCES 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: play:0x100: E_PLAY_INT_STATE_ALLOCATING_RESOURCES -> (E_PLAY_INPUT_RMF_RESOURCES_ALLOCATED) -> E_PLAY_INT_STATE_RESOURCES_ALLOCATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: play:0x100: E_PLAY_INT_STATE_RESOURCES_ALLOCATED -> (E_PLAY_INPUT_PANEL_CONFIGURE) -> E_PLAY_INT_STATE_CONFIGURING 

// substution keeps happening on the same PA. this is snippet from single
// playback.

!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,6,mc-create-mcid=,6,mc_create-str=,mc-playback,fsnfmt=,hMC=0x6 

// playback to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,7,mc-create-mcid=,7,mc_create-str=,mc-substitution,fsnfmt=,hMC=0x7 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x6],to_mcon [hMC=0x7] 

// subst to subst then the prev subst will be destroyed.
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,8,mc-create-mcid=,8,mc_create-str=,mc-substitution,fsnfmt=,hMC=0x8 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x7],to_mcon [hMC=0x8] 

// subst to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,9,mc-create-mcid=,9,mc_create-str=,mc-substitution,fsnfmt=,hMC=0x9 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x8],to_mcon [hMC=0x9] 

// subst to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,10,mc-create-mcid=,10,mc_create-str=,mc-substitution,fsnfmt=,hMC=0xa 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x9],to_mcon [hMC=0xa] 

// subst to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,11,mc-create-mcid=,11,mc_create-str=,mc-substitution,fsnfmt=,hMC=0xb 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0xa],to_mcon [hMC=0xb] 

// subst to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,12,mc-create-mcid=,12,mc_create-str=,mc-substitution,fsnfmt=,hMC=0xc 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0xb],to_mcon [hMC=0xc] 

// subst to playback
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0xc],to_mcon [hMC=0x6] 

// playback to subst
!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,13,mc-create-mcid=,13,mc_create-str=,mc-substitution,fsnfmt=,hMC=0xd 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x6],to_mcon [hMC=0xd] 

// subst to playback
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0xd],to_mcon [hMC=0x6] 

!MIL    -MCM          		< P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,14,mc-create-mcid=,14,mc_create-str=,mc-substitution,fsnfmt=,hMC=0xe 
!MIL    -MSM          		< P:MW T:VRM_SRV M:msm_splicer.c F:(MSM_SPLICER_SwitchPointDef) L:140 > h_media_connection  [hMC=0x6],from_mcon [hMC=0x6],to_mcon [hMC=0xe] 


={============================================================================
|kt_dev_si_0001| comp-bem

COMPONENT_NAME:=ms_bem_server_src
COMPONENT_NAME:=ms_bem_client_src

<bem-thread>
BEM thread "BEM_INTERNAL_EVENT_THREAD"
BEM_PRIVATE void* BEM_InternalEvent_ThreadEntry(void * arg)


<poll-interval>
// NDS: ^[2016:08:22 04:50:42]0946737989.393631 !WARN   -BEM          		< p:0x000001df P:MW t:0x0177e520 
// T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdcpStatus L:2419 > HDMI_HDCP_GET_BSTATUS failed, errno 145 

void BEM_InternalEvent_CheckHdcpStatus(BEM_DB_PRIMITIVE_DEVICE_ROW *hdmi_row)
{
  if (BEM_IOCTL(hdmi_row->device_fd, HDMI_HDCP_GET_BSTATUS, &status) == BEM_POSIX_OK)
  {
  }
  else
  {
    hdcp_state = BEM_OC_HDMI_HDCP_STATE_UNAVAILABLE;
    DIAG_LOG_WARN(g_BEM_ServerDiagSegId, ("HDMI_HDCP_GET_BSTATUS failed, errno %i", errno));
  }
}


void BEM_InternalEvent_StartHDMIAlarm(void)
{
  f_BEM_HdmiAlarmInfo.alarm_data.rel_info.callback = BEM_InternalEvent_PostHdmiStatusAlarm;
  post BEM_INTERNAL_EV_`HDMI_STATUS`_ALARM which leas to 
  calls BEM_InternalEvent_Do`HdmiStatus`Alarm()
  calls BEM_InternalEvent_`CheckHdmiAndStatus`()
}


bem.cfg:24:HDCP_STATUS=1000

    else if (SYSTEMCONFIG_GetIntegerValue(cfg_handle,
                                          BEM_CONFIG_HDMI_CONFIG_SECTION,
                                          BEM_CONFIG_`HDCP_STATUS`,
                                          &`g_BEM_HdmiHdcpStatusPollDelay`) != SYSTEMCONFIG_STATUS_OK)

bem.cfg:37:HDMI_CONNECTION_STATUS=1000

    else if (SYSTEMCONFIG_GetIntegerValue(cfg_handle,
                                          BEM_CONFIG_HDMI_CONFIG_SECTION,
                                          BEM_CONFIG_HDMI_CONNECTION_STATUS,
                                          &g_BEM_HdmiConnStatusPollDelay) != SYSTEMCONFIG_STATUS_OK)

BEM_InternalEvent_CheckHdmiAndStatus()
{
  // when auth is failed
  DIAG_LOG_INFO(g_BEM_ServerDiagSegId, ("Authentication/encryption failed"));

  BEM_InternalEvent_StartPollingBstatus();
  {
    // `relative`
    f_BEM_HdcpStatusAlarmInfo.is_absolute = false;
    f_BEM_HdcpStatusAlarmInfo.alarm_data.rel_info.callback = BEM_InternalEvent_PostHdcpStatusAlarm;
    f_BEM_HdcpStatusAlarmInfo.alarm_data.rel_info.is_repeating = true;

    // post BEM_INTERNAL_EV_HDMI_`BSTATUS`_ALARM 
    // calls BEM_InternalEvent_Do`HdcpStatus`Alarm
    // calls BEM_InternalEvent_CheckHdcpStatus()

    f_BEM_HdcpStatusAlarmInfo.alarm_data.rel_info.callback = BEM_InternalEvent_Post`HdcpStatus`Alarm;
    f_BEM_HdcpStatusAlarmInfo.alarm_data.rel_info.is_repeating = true;
    f_BEM_HdcpStatusAlarmInfo.alarm_data.rel_info.timeout = g_BEM_HdmiHdcpStatusPollDelay;

    // typedef struct SYSTEMALARM_ALARM_REL_INFO_TAG
    // {
    // 	uint32_t  timeout; /*!< @brief Relative timeout value in `msecs` (for relative alarm). */
    // 	bool is_repeating;/*!< @brief Determines if the alarm should reset itself after timeout. The new timeout it calculated before the callback is called. */
    // } SYSTEMALARM_ALARM_REL_INFO;
  }
}

// BEM_InternalEvent_TerminateAlarms 1305 CMS_MEDIA_SERVICES/BEM/src/server/bem_path_attach.c     if (BEM_InternalEvent_TerminateAlarms() != BEM_STATUS_OK)
// BEM_InternalEvent_TerminateAlarms 1224 CMS_MEDIA_SERVICES/BEM/src/server/bem_server.c     if (BEM_InternalEvent_TerminateAlarms() != BEM_STATUS_OK)
SYSTEM_STATUS BEM_InternalEvent_TerminateAlarms(void)
{
  DIAG_LOG_INFO(g_BEM_ServerDiagSegId,("Stopping HDMI connection alarm"));
  if (SYSTEMALARM_Cancel(f_BEM_HdmiConnAlarmHandle) != SYSTEMALARM_STATUS_OK)
  {
    status = BEM_STATUS_NOT_OK;
  }

  /* Stop polling the HDCP connection status */
  DIAG_LOG_INFO(g_BEM_ServerDiagSegId, ("Stopping HDCP bstatus polling %08x",f_BEM_HdcpStatusAlarmHandle));
  if (SYSTEMALARM_Cancel(f_BEM_HdcpStatusAlarmHandle) == SYSTEMALARM_STATUS_OK)
  {
    f_BEM_HdcpStatusAlarmHandle = SYSTEMALARM_HANDLE_ILLEGAL;
  }
}

^[2016:07:30 06:01:42]0946685045.717415 !WARN   -BEM          		< T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdcpStatus L:2419 > HDMI_HDCP_GET_BSTATUS failed, errno 145 
^[2016:07:30 06:01:43]0946685046.880410 !WARN   -BEM          		< T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdcpStatus L:2419 > HDMI_HDCP_GET_BSTATUS failed, errno 145 
^[2016:07:30 06:01:45]0946685048.043415 !WARN   -BEM          		< T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdcpStatus L:2419 > HDMI_HDCP_GET_BSTATUS failed, errno 145 
^[2016:07:30 06:01:46]0946685049.207411 !WARN   -BEM          		< T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdcpStatus L:2419 > HDMI_HDCP_GET_BSTATUS failed, errno 145 

<normal-sequence>
NDS: ^0946740354.061941 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_server.c F:BEM_Util_Ioctl L:01911 > BEM IOCTL f=bem_internal_event.c l=1668 rv=0 fd=297 req=`HDMI_GET_EVENTS`
NDS: ^0946740354.062079 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdmiAndStatus L:01672 > HDMI events 0x0
NDS: ^0946740354.062192 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdmiAndStatus L:01686 > calling HDMI_GET_CONNECTION_STATUS
NDS: ^0946740354.062365 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_server.c F:BEM_Util_Ioctl L:01911 > BEM IOCTL f=bem_internal_event.c l=1688 rv=0 fd=297 req=`HDMI_GET_CONNECTION_STATUS`
NDS: ^0946740354.062488 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdmiAndStatus L:01694 > display attached:1 powered:1
NDS: ^0946740354.062605 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_device_configure.c F:BEM_DevConfig_UpdateHdmiState L:02012 > HDMI state unchanged
NDS: ^0946740354.062770 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_eedid.c F:BEM_EEDID_AcquireEdid L:00679 > EEDID hash not required
NDS: ^0946740354.079490 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_server.c F:BEM_Util_Ioctl L:01911 > BEM IOCTL f=bem_eedid.c l=702 rv=0 fd=297 req=`HDMI_GET_EEDID_BLOCK_EX`
NDS: ^0946740354.079691 !INFO  -BEM          < T:BEM_INTERNAL_EVENT_THREAD M:bem_eedid.c F:BEM_EEDID_AcquireEdid L:00733 > Got EEDID Block 0


<comp-bem-resolution-change>
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_shareddevice.c F:MPM_SHAREDDEVICE_DebugIoctlCall L:1117 > ioctl VIDEO_DECODER_GET_PARAMETERS_EX posted OK on /dev/nds/videodecoder0  
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:724 > video param V EX  infoPresent=0x2d 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:836 > video cumulative infoPresent=0x125 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:837 > video videoResolution.width=0x780 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:838 > video videoResolution.height=0x438 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:839 > video displayResolution.width=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:840 > video displayResolution.height=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:842 > video frameRate=0x3 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:843 > video frameRateNR=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:844 > video frameRateDR=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:845 > video frameRateExp=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:847 > video aspectRatio=0x3 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:848 > video extendedSampleAspectRatioHeight=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:849 > video extendedSampleAspectRatioWidth=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:851 > video scanType=0x2 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:852 > video overscanAppropriate=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:853 > video framePackingArrangementType=0x0 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:854 > video ar_nominator=0x10 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:855 > video ar_denominator=0x9 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_ActionDecoderEvent L:856 > video calculated aspectRatio=0x3 

!ENTER  -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_server_oc.c F:BEM_OC_Source_SetVideoParameters L:5319 > |-> BEM_OC_Source_SetVideoParameters
!ENTER  -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:369 > |-> BEM_Source_SetVideoParameters
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:402 > source 0x64 received new video aspect ratio 3 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:409 > source 0x64 received new video aspect ratio numerator16 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:416 > source 0x64 received new video aspect ratio denominator 9 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:423 > source 0x64 received new video frame rate 3 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:430 > source 0x64 received new video scan type 2 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:437 > source 0x64 received new video source width 1920 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x01a2f520 T:MPM_ITCMAIN_THREAD M:bem_source.c F:BEM_Source_SetVideoParameters L:444 > source 0x64 received new video source height 1080 

!MIL    -MPM          		< p:0x00000218 P:MW t:0x01a3c520 T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1376 > FRAME_PRESENTED: hMC=0x8 
!INFO   -MPM          		< p:0x00000218 P:MW t:0x01a3c520 T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1393 > hMC=0x8 MPM_ITC_EV_FRAME_PRESENTED_EVENT Event posted 


NDS: ^[2018:01:24 11:33:57]0946685141.186433 !ENTER  -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8841 > |-> PLAYER_SM_VRM_ProcessVSI
NDS: ^[2018:01:24 11:33:57]0946685141.186461 !INFO   -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8843 > job handle 0x03000009 Context : MAIN_TARGET Type 1 State 8  
NDS: ^[2018:01:24 11:33:57]0946685141.186527 !INFO   -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8864 > Job handle 0x03000009 - Context : MAIN_TARGET - Job slot : ACTIVE - Received VSI object - Status : RUNNING 
NDS: ^[2018:01:24 11:33:57]0946685141.186547 !INFO   -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8959 > Got video component track tag 4294967295 
NDS: ^[2018:01:24 11:33:57]0946685141.186563 !INFO   -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8962 > Got video component selected PID 0x901 

NDS: ^[2018:01:24 11:33:57]0946685141.188820 !ENTER  -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_sm_vrm.c F:UpdateVideoRunningStatus L:8499 > |-> UpdateVideoRunningStatus

NDS: ^[2018:01:24 11:33:57]0946685141.188891 !ENTER  -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1260 > |-> PLAYER_AVControl_SetVideoVisibility
NDS: ^[2018:01:24 11:33:57]0946685141.188925 !INFO   -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1278 > Try to set the video visibility to TRUE of the context MAIN_TARGET and current visibility is FALSE 

NDS: ^[2018:01:24 11:33:57]0946685141.200560 !ENTER  -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1130 > |-> PLAYER_AVControl_UpdateVisibility

NDS: ^[2018:01:24 11:33:57]0946685141.200819 !ENTER  -P_Api        		< p:0x0000021a P:APP t:0x013d9520 T:PLAYER_MAIN M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5938 > |-> PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible

NDS: ^[2018:01:24 11:33:57]0946685141.201016 !ENTER  -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_composition.c F:BEM_Composition_MakePlaneVisible L:2707 > |-> BEM_Composition_MakePlaneVisible

NDS: ^[2018:01:24 11:33:57]0946685141.201141 !ENTER  -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1802 > |-> BEM_DevConfig_HandleHdPotentialResolutionChange
NDS: ^[2018:01:24 11:33:57]0946685141.201158 !INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1815 > Client has windows control, composition 80 
NDS: ^[2018:01:24 11:33:57]0946685141.201171 !INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1836 > do nothing 
NDS: ^[2018:01:24 11:33:57]0946685141.201186 !EXIT   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2368 > <-| BEM_DevConfig_HandleHdPotentialResolutionChange : return_status = 0xc01000



!ENTER  -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1802 > |-> BEM_DevConfig_HandleHdPotentialResolutionChange
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1848 > We've got 1 channels in composition_id 80 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1857 > primary channel initially set to 81 (use 2) 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1869 > hdmi channel set to 81 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1889 > primary channel now set to 81 (use HD) 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1890 > video mode 0 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1925 > working out new hdmi resolution (mode & code) 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2022 > color_mode=0x1, color_depth=0x1, force_hdmi_restart=0 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2026 > res change needed 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2033 > Stopping HDMI for res change 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2041 > Flagging restart of HDMI 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2048 > Flagging restart of HDCP after HDMI_START is done 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2113 > working out new blender resolution 

// #define BEM_DB_COMPOSITION_BLENDER_RES_1920_1080  (5U)
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2115 > new blender res code 5 old res code 3 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2199 > Configuring blender and notifying clients of res change 
!MIL    -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2212 > Reconfigured the blender resolution. 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2357 > Set alarm to start HDMI after res change 100ms 
!EXIT   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2368 > <-| BEM_DevConfig_HandleHdPotentialResolutionChange : return_status = 0xc01000
!ENTER  -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1802 > |-> BEM_DevConfig_HandleHdPotentialResolutionChange
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1848 > We've got 1 channels in composition_id 76 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:1903 > no primary channel 
!INFO   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2246 > no change to resolution on blender required 
!EXIT   -BEM          		< p:0x00000218 P:MW t:0x019c1520 T:BEM_ITCMAIN_THREAD M:bem_device_configure.c F:BEM_DevConfig_HandleHdPotentialResolutionChange L:2368 > <-| BEM_DevConfig_HandleHdPotentialResolutionChange : return_status = 0xc21002


={============================================================================
|kt_dev_si_0001| comp-guide

#-----------------------------------------------------------
# contacts
#-----------------------------------------------------------
Bunce, Stewart <SBunce@nds.com>; Edwards, Lee <LEdwards@nds.com>

# NOTE: make sure if it's guide_ not quide. otherwise, will waste time to get debugs
#
COMPONENT_NAME := darwin_guide_src
TRACE_LEVEL_G_Sess="AFEWMI"

#
# DARWIN_PLATFORM\DARWIN_GUIDE_JAVA
#
COMPONENT_NAME:= darwin_guide_native
DARWIN_PLATFORM\DARWIN_GUIDE_JAVA\src\inc\natGuideCommon.h(274): #define GUIDE_JAVA_DIAGNAME "J_GUIDE"

#
# JPA MEM
#
(java_adapters.cfg)
[GUIDE_MEM_CONFIG]
POOL_FLAGS=123
POOL_NAME="ADPT_GUIDE"
POOL_SIZE=4000

g_guide_native_mem_pool
DARWIN_ADAPTOR_GUIDE_InitVTables
	vtables:
	g_guide_adaptor_vtable_list
	g_guide_adaptor_vtable_objects
	g_guide_adaptor_vtable_schedule
	g_guide_adaptor_vtable_iterator
	g_guide_adaptor_vtable_short_list


# guide.cfg
[MEMORY_CONFIGURATION]
POOL_FLAGS=0
POOL_NAME="GUIDE"
POOL_SIZE=590248
# 
ConfigureMemory
	MEMMAN_API_MemoryPoolCreateP(&g_guide_mem_pool,)

CreateGuideComponentObject
/* Schedule table */
else if(VTABLE_STATUS_SUCCESS!=GUIDE_VTABLE_InitTable(&((*l_component_object_data)->schedule_table),
                                                g_guide_mem_pool, g_guide_diag_detailed_segment_id,
                                                &(g_guide_component->sched_mutex), 100))


#-----------------------------------------------------------
# internals
#-----------------------------------------------------------
1)	Due to the way Relative Iterators are implemented in GUIDE (Using SIM relative lists) we have no way of knowing exactly which position the iterator is using at a particular time (only SIM does). Thus we cannot know we are at the beginning of the Iterator without attempting to move beyond it.

3)	When using GUIDE Relative Iterators it is expected that if a Client receives GUIDE_API_STATUS_FAILED_BEYOND_BEGINNING when attempting to move the Iterator that the client should handle this situation and call GUIDE_API_IteratorMoveByRelative() with parameters origin=GUIDE_API_ITERATOR_ORIGIN_BEGINNING and offset=0U. This will safely move the Iterator back to the beginning of the list. 


Container objects

An object can contain other objects, for instance most objects contain strings. Some objects such as Simple List are explicitly intended as containers of other objects. In both cases a user of the object can get from it a reference to a contained object.

It is to be noted that the life span of contained object is not dependent on the life span of the container. The contained object may continue to live even if the containers has been deleted. It is the responsibility of the client to explicitly set an object to NULL once it has been used. 

List

A ShortList object is used for any list that can be retrieved in a single asynchronous operation. After the list is retrieved the application can get references to objects in the list and access their properties immediately. A ShortList is unchangeable once it is retrieved, and is unaffected by events on the SI streams feeding data to the STB.

A LongList object is intended to be used for lists that may be too large for being retrieved in one operation, or that need to be monitored for changes. The application creates one such list with an asynchronous operation, and then requests segments of the total list with further asynchronous operations. Each retrieved segment is accessed as a ShortList and is unchangeable once retrieved. The application can operate on multiple segments at the same time, but is advised to set each segment to NULL as soon as possible to conserve memory.

The application can optionally register a listener method to be notified whenever a change happens in a LongList. If the application retrieves further segments after it has been notified of a change, these segments will contain data from the new version of the LongList. The segments obtained before the notification of change and not yet released are still available but contain data from the old version of the LongList, which may be inconsistent with the new version. 


Program or Program Instance?

A programme is an editorially coherent item of content, considered independently from the time and channel it is broadcast. A programme broadcast at a specific time on a specific channel is programme instance. There is a one to many correspondence between programmes and programme instances.

When a programme is broadcast multiple times, the programme object represents the attributes that are common to all instances of broadcast, while the programme instance objects represent the attributes that are specific to each broadcast, such as the start time.


#-----------------------------------------------------------
# status
#-----------------------------------------------------------
#define GUIDE_COMP_ID         ((uint32_t)(15))
#define SEVERITY_SEVERE  ((uint32_t)(0x2))
#define GUIDE_API_ID        (0)
            
(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((15 & 0x3FF) << 22) | ((0x2 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )
hex(((15 & 0x3FF) << 22) | ((0x2 & 0x3) << 16) | ((0 & 0xF) << 12) | (11 & 0xFFF) )

GUIDE_API_STATUS_OK							0x3c00000
GUIDE_API_STATUS_FAILED 					0x3c20000
GUIDE_API_STATUS_FAILED_BEYOND_BEGINNING	0x3c2000b
GUIDE_API_STATUS_ATTRIBUTE_NOT_RETRIEVED_YET 0x3c20006

#-----------------------------------------------------------
# GuideServiceIteratorImpl::moveToLocator(SystemLocator locator) -> JAVA -> GUIDE_API_ITERATOR_H
# so this 'locator' should be a the list of service?. SYSTEMLOCATOR_TYPE_SERVICE.
#-----------------------------------------------------------
GUIDE_API_Iterator_MoveToLocator -> GuideIteratorMoveToLocator -> SIM_SI_List_MoveCursor(GuideIteratorMoveCursorListener) 
-> GuideWaitForAsyncCallback -> SYSTEMUTIL_THR_CondTimedWait(callback_cond)

SIM_SI_List_MoveCursor(SIM_SI_MOVE_LISTENER listener) -> SIM_ListMoveCursor() -> SIM_IPC_COMMS_SendCommand 
-> SIM_sc_cmd_ListenerHandlerThread:SIM_sc_cmd_ListenerEventHandler (SIM_SC_IPC_SERVER_THREAD) -> SIM_SC_SI_ListMoveCursor -> 

GuideIteratorMoveCursorListener -> GuideSignalCallbackReceived -> SYSTEMUTIL_THR_CondSignal(callback_cond)


#-----------------------------------------------------------
# GuideSessionImpl::retrieveLogicalChannelNumberServiceLocator( Sting logicalChannelNumber )
# natGuideApiSessionRetrieveLogicalChannelNumberServiceLocator -> JAVA -> 
# Retrieve the service system locator of a Logical Channel Number. Initiates the asynchronous retrieval of the locator of a service locator.
#-----------------------------------------------------------

GuideSessionImpl.java (\darwin_platform\darwin_guide_java\impl):363:        
retrieveLogicalChannelNumberServiceLocator()
{
	return new GuideRequestImpl(natGuideApiSessionRetrieveLogicalChannelNumberServiceLocator()) 
}

-> GUIDE_JAVA_SessionRetrieveLogicalChannelNumberServiceLocator


#-----------------------------------------------------------
# GuideSessionImpl:: Create a filtered iterator of programme instances. Note it's plural.
# createProgrammeInstanceIteratorEx()
# natGuideApiSessionRetreiveProgrammeInstanceIteratorEx -> JAVA : 
# -> GUIDE_JAVA_FilterCreateArray : alloc filter objects and can see various filter types MW supports.
# -> GUIDE_API_Session_RetrieveProgrammeInstanceIteratorEx -> SIM_SI_Dbase_CreateRelativeProgrammeInstanceList
# 
# (later) SIM calls GUIDE_Iterator_CreateListener: post GUIDE_EVENT_ITERATOR_CREATED.
#-----------------------------------------------------------

#-----------------------------------------------------------
# natGuideApiProgrammeInstanceGetLocator -> JAVA -> 
#-----------------------------------------------------------

GuideProgrammeInstanceImpl.java (\darwin_platform\darwin_guide_java\impl):191:
public synchronized SystemLocator getLocator()
{
    return new SystemLocatorImpl(natGuideApiProgrammeInstanceGetLocator(nativeHandle));      
}

-> GUIDE_API_ProgrammeInstance_CreateLocator


# Service
class GuideServiceImpl::getLocator
	natGuideApiServiceGetLocator(nativeHandle)
		GUIDE_JAVA_ServiceGetLocator(&env);

#-----------------------------------------------------------
# GuideProgrammeInstanceIteratorImpl.java::moveRelative -> natGuideIteratorMoveByRelative -> GUIDE_JAVA_IteratorMoveByRelative -> 
#-----------------------------------------------------------
public int moveRelative(int origin, int offset) throws SystemException
{
    assertValid();
    return GuideIteratorImpl.natGuideIteratorMoveByRelative(nativeHandle,origin,offset);
}

#-----------------------------------------------------------
# Iterator can be one for ProgramInstance, Service and otehrs
#
# hasPrevious -> GuideIteratorImpl.natGuideIteratorHasPrevious -> GUIDE_API_Iterator_HasPreviousElement 
# hasNext -> GuideIteratorImpl.natGuideIteratorHasPrevious -> GUIDE_API_Iterator_HasNextElement 
# next -> GuideIteratorImpl.natGuideIteratorNext -> GUIDE_JAVA_IteratorNext -> GUIDE_API_Iterator_CreateNextElement 
# previous -> GuideIteratorImpl.natGuideIteratorNext -> GUIDE_JAVA_IteratorPrevious -> GUIDE_API_Iterator_CreatePreviousElement 
#-----------------------------------------------------------

GuideSessionImpl.java
----------------------
public GuideRequest createProgrammeInstanceIteratorEx(
    GuideProgrammeFilter[] filters,
    int order,
    GuideProgrammeInstanceIteratorCreationListener creationListener,
    GuideProgrammeInstanceIteratorChangeListener changeListener,
    Object userTag)
{
    assertValid();

    GuideProgrammeInstanceIterator programmeInstanceIterator = 
        new GuideProgrammeInstanceIteratorImpl(creationListener,changeListener, userTag);

		# programmeInstanceIterator An empty service iterator object to be populated on the native side of JNI
		#
    GuideRequest guideReq = (GuideRequest)new GuideRequestImpl(
            natGuideApiSessionRetreiveProgrammeInstanceIteratorEx(
                nativeHandle, 
                ((null == filters) ? 0 : filters.length),
                filters,
                order,
                programmeInstanceIterator));

    return guideReq;
}

# returns 'requestId' to app
# 
GUIDE_JAVA_SessionRetrieveProgrammeInstanceIteratorEx
{
	# Retrieve an iterator of filtered programmes. When the iterator is ready, the listener method the user has provided will be
	# called back and given a handle of the iterator.
	# When the user has finished with the iterator, it must release it by calling GUIDE_API_Iterator_Delete.
	#
	GUIDE_API_Session_RetrieveProgrammeInstanceIteratorEx('GUIDE_JAVA_IteratorRetrievalListener', /* out */ &requestId )
	{
		GUIDE_VTABLE_Create( &iterator_request_data, &request_handle);

		SIM_SI_Dbase_CreateRelativeProgrammeInstanceList('GUIDE_Iterator_CreateListener', request_handle )

		*request = (GUIDE_API_REQUEST_HANDLE)request_handle;
	}	
	env->returnVal = (uint32_t)requestId;
}

# call from SIM
# it's the only place to post this event
GUIDE_Iterator_CreateListener

	l_guide_msg_payload.request_handle = (uint32_t)l_user_tag;

	SYSTEMITC_API_PostEvent(GUIDE_EVENT_ITERATOR_CREATED)

MessageThread: 
	GUIDE_Iterator_CreatedHandler( requset_handle )
		# alloc for list object in GUIDE
		CreateGuideListObject
			GUIDE_ALLOC
		CreateGuideIteratorObject(&l_iterator_object_data)
			GUIDE_ALLOC

		GUIDE_VTABLE_Create(&l_iterator_object_data, &l_iterator_handle);

		# Start acquisition of iterator blocks
		GuideIteratorAcquire(l_iterator_handle);
			GuideIteratorMoveToIndex
				GuideRelativeIteratorRetrieveBlock

					# register to SIM
					GUIDE_Int_List_RetrieveElementsFromCursor:SIM_SI_List_RetrieveElementsFromCursor
					SIM_SI_List_RetrieveCollapsedElementsFromCursor('GuideIteratorSimpleListRetrievalListener')
						GuideIteratorSimpleListRetrievalListener( post 'GUIDE_EVENT_ITERATOR_SIMPLELIST_CREATED' )


		l_callback_message.payload.list_created.list_handle = (GUIDE_API_HANDLE)l_iterator_handle;	

		GuidePostCallbackMessage(GUIDE_CALLBACK_LIST_CREATED)

			
GuideProcessCallbackMessage:
	call 'GUIDE_JAVA_IteratorRetrievalListener'(GUIDE_API_ITERATOR_HANDLE iteratorHandle)	
	{
		"nativeHandle" = &iteratorHandle;
	}


# SIM calls
GuideIteratorSimpleListRetrievalListener
	SYSTEMITC_API_PostEvent(GUIDE_EVENT_ITERATOR_SIMPLELIST_CREATED)


MessageThread: GUIDE_EVENT_ITERATOR_SIMPLELIST_CREATED
	'GUIDE_Iterator_SimpleListRetrievalHandler'
	{
		CreateGuideSimpleListObject

		create l_simple_list_handle from vtable

		# to get count of simple list
		SIM_SI_SimpleList_GetCount
		SYSTEMUTIL_THR_MutexLock(&l_iterator_object_data->block_ready_mutex);
	   	SYSTEMUTIL_THR_CondSignal('&l_iterator_object_data->block_ready_cond)'
		SYSTEMUTIL_THR_MutexUnlock(&l_iterator_object_data->block_ready_mutex);
	}



GUIDE_JAVA_IteratorNext
	# return item_handle from the iterator handle
	GUIDE_API_Iterator_CreateNextElement(GUIDE_API_ITERATOR_HANDLE)jNativeHandle, &(env->returnVal))
		# get GUIDE_ITERATOR_OBJECT_DATA from iterator handle
		GuideIteratorCommonApiEntry(l_handle, &l_iterator_object_data);
		# Retrieve the handle of the next element to the iterator
		GuideIteratorGetNextElementHandle(l_handle, l_item_handle)


GUIDE_JAVA_IteratorMoveByRelative
	GUIDE_API_Iterator_MoveByRelative(GUIDE_API_ITERATOR_ORIGIN_CURRENT: 0x2)
		GuideIteratorMoveToIndex
			GuideIteratorOrganiseSingleBlockMode
				GuideRelativeIteratorRetrieveBlock
					SIM_SI_List_RetrieveElementsFromCursor(GuideIteratorSimpleListRetrievalListener)

		# ONLY place to wait a condition
		GuideIteratorGetCurrentBlockAccess
			SYSTEMUTIL_THR_MutexLock(&l_iterator_object_data->block_ready_mutex)
			'SYSTEMUTIL_THR_CondTimedWait(&l_iterator_object_data->block_ready_cond, &l_iterator_object_data->block_ready_mutex, 30 secs)'
			# unlock when it's not okay
			SYSTEMUTIL_THR_MutexUnlock(&l_iterator_object_data->block_ready_mutex);
					
#
# so if you see belows, then that maybe mean SIM got stuck or gone dead so failed to do callback to GUIDE?
!ERROR  -G_Sess       < p:0x00000000 P:APP t:0x2c402520 T:no name M:guide_api_iterator.c F:GuideIteratorGetCurrentBlockAccess L:1077 > Call to SYSTEMUTIL_THR_CondTimedWait failed 
!ERROR  -G_Sess       < p:0x00000000 P:APP t:0x2c402520 T:no name M:guide_api_iterator.c F:GUIDE_API_Iterator_CreatePreviousElement L:4420 > Call to GuideIteratorGetCurrentBlockAccess failed 
!ERROR  -J_GUIDE      < p:0x00000000 P:APP t:0x2c402520 T:no name M:natGuideIteratorImpl.c F:GUIDE_JAVA_IteratorPrevious L:281 > Failed to create previous element 


#-----------------------------------------------------------
# calls when do search from the epg. PR#23566: relative iterator
#
# Limitations of hasPrevious from GUIDE team:
# As currently implemented the GUIDE relative Iterators have the limitation that they cannot detect the start of the list 
# if it occurs on a block boundary, this was raised as a limitation when they were first implemented.
# 
#-----------------------------------------------------------
!MIL   -aem          < M:aem_userinput.c F:AEM_InputMonitorThread L:00430 > KEY_PRESS: SELECT, 57345

!ENTER -J_GUIDE      < t:2c46a520 T:no name M:natGuideSessionImpl.c F:GUIDE_JAVA_SessionRetrieveProgrammeInstanceIteratorEx L:01492 > 

!INFO  -J_GUIDE      < M:natGuideServiceImpl.c F:GUIDE_JAVA_ProgrammeFilterServiceFlags L:00386 > Service filter type: SIM_SI_PROGRAMME_FILTER_SERVICE_FLAG_MATCH
!INFO  -J_GUIDE      < M:natGuideServiceImpl.c F:GUIDE_JAVA_ProgrammeFilterServiceFlags L:00386 > Service filter type: SIM_SI_PROGRAMME_FILTER_SERVICE_FLAG_MATCH
!INFO  -J_GUIDE      < M:natGuideServiceImpl.c F:GUIDE_JAVA_ProgrammeFilterTimePeriod L:00173 > Programme filter type: SIM_SI_PROGRAMME_FILTER_TIME_PERIOD

MessageThread: case GUIDE_EVENT_ITERATOR_SIMPLELIST_CREATED:
!INFO  -G_Sess       < M:guide_api_iterator.c F:GUIDE_Iterator_SimpleListRetrievalHandler L:02978 > 7 elements in block

!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasNextElement L:04511 > *l_next 1

!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasPreviousElement L:04554 > KT: relative_list(1), next_element_index(0), relative_block_position(0), num_elements_in_block(7)

# this is error since we're on the first item of the list.
#
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasPreviousElement L:04584 > *l_previous 1 

# create 6 items for the first page
#
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_CreateNextElement L:04284 > next_element_index 0
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasNextElement L:04511 > *l_next 1
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_CreateNextElement L:04284 > next_element_index 1
...
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasNextElement L:04511 > *l_next 1
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_CreateNextElement L:04284 > next_element_index 5

# when pressing up key on the first item on the list. GUIDE_API_ITERATOR_ORIGIN_CURRENT(0x02)
#
!MIL   -aem          < M:aem_userinput.c F:AEM_InputMonitorThread L:00430 > KEY_PRESS: UP, 57600

# app tries to see if there is next page since it has already one page(6 items) and if it can move -12 back then means there is a previous page
# this page means a block in GUIDE/SIM terms.
#
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05187 > handle 0xd000006, origin 0x2, offset -12
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05199 > KT: relative_list(1), next_element_index(6), relative_block_position(0), num_elements_in_block(7)
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05241 > KT: GuideIteratorMoveToIndex: next_element_index(6), offset(-12), origin(2)

!ERROR -G_Sess       < M:guide_api_iterator.c F:GuideIteratorGetCurrentBlockAccess L:01105 > KT: moved_out_of_bounds(1), relative_list(1)

!ERROR -G_Sess       < t:2c46a520 T:no name M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05262 > Call to GuideIteratorGetCurrentBlockAccess failed


# try to set GUIDE_API_ITERATOR_ORIGIN_BEGINNING.
# 
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05187 > handle 0xd000006, origin 0x1, offset 0
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05199 > KT: relative_list(1), next_element_index(0), relative_block_position(0), num_elements_in_block(7)
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05241 > KT: GuideIteratorMoveToIndex: next_element_index(0), offset(0), origin(1)


!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasNextElement L:04511 > *l_next 1

# this is error
# --
# It essentially boils down to the fact that block_position can be one of either GUIDE_ITERATOR_BLOCK_POS_END(2),
# GUIDE_ITERATOR_BLOCK_POS_BEGINNING(1) or GUIDE_ITERTOR_BLOCK_POS_UNKNOWN for relative iterators. In the case you have described
# technically the block is both the beginning and end block, but it is set to be GUIDE_ITERATOR_BLOCK_POS_END, due to
# logic elsewhere in the GUIDE code.
# 
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasPreviousElement L:04554 > KT: relative_list(1), next_element_index(0), relative_block_position(0), num_elements_in_block(7)
!ERROR -G_Sess       < M:guide_api_iterator.c F:GUIDE_API_Iterator_HasPreviousElement L:04584 > *l_previous 1


# when backing out of the collapsed app changes iterator to the previous
#
NDS: ^0946689802.716996 !MIL   -aem          < t:01257940 T:AEM_INPUT_MONITOR_THREAD M:aem_userinput.c F:AEM_InputMonitorThread L:00430 > KEY_PRESS: BACK, 57346

NDS: ^0946689803.154069 !ENTER -J_GUIDE      < t:2c46a520 T:no name M:natGuideIteratorImpl.c F:GUIDE_JAVA_IteratorMoveToLocator L:00202 > |-> GUIDE_JAVA_IteratorMoveToLocator
NDS: ^0946689803.154342 !PARAM -G_Sess       < t:2c46a520 T:no name M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveToLocator L:04187 > l_handle 0xd000026, l_locator 0xfd20002a


# !NOTE:
# this is not an error since it can happen when use 'relative iterator' and offest beyond possible move. In that case, guide returns 'out of bound'
# error code
#
NDS: ^0946689820.407034 !ERROR -G_Sess       < t:2c46a520 T:no name M:guide_api_iterator.c F:GUIDE_API_Iterator_MoveByRelative L:05262 > Call to GuideIteratorGetCurrentBlockAccess failed

#-----------------------------------------------------------
# schedule
#-----------------------------------------------------------
g_guide_adaptor_vtable_schedule:

GUIDE_JAVA_SessionCreateSchedule
GUIDE_JAVA_ScheduleDelete
GUIDE_JAVA_ScheduleListener


class GuideSessionImpl::createSchedule
{
	natGuideApiSessionCreateSchedule(this.nativeHandle, 
	        serviceList, windowStartTime, windowDuration, firstRowIndex,
	        windowRowCount,  guideSchedule);
	        
	/* Return the schedule object */
	return guideSchedule;	        
}

# createSchedule
(GuideServiceLongList serviceList,
SystemTime windowStartTime,
int windowDuration,
int firstRowIndex,
int windowRowCount,
GuideScheduleListener scheduleListener,
Object userTag)
# 
# Create a schedule. Creates a GuideSchedule object based on an existing list of services. The schedule will contain all and only those services that are part of the service list. The schedule object is created synchronously and a handle to it is available immediately. However the schedule data will become available asynchronously, and may become available row by row. It may also change while the schedule is in existence, either because the user moves the window through the schedule, or because the set top box receives new service information. All such changes in the status of the data are notified through a GuideScheduleListener. When the user has finished with the Schedule, it must be set to NULL. This is to prevent the resources from being unnecessarily tied up and to enable garbage collection. 
#

# SetTimeWindow
# public void SetTimeWindow(SystemTime windowStartTime, int windowDuration)


# SetServiceWindow
# public void SetServiceWindow(int firstRowIndex,
#                             int windowRowCount)
# GUIDE_JAVA_ScheduleSetServiceWindow

GUIDE_JAVA_SessionCreateSchedule
{
	GUIDE_API_SCHEDULE_HANDLE scheduleHandle;
	
	# create a req.
	JPA_VTABLE_Create(&g_guide_adaptor_vtable_schedule, &genPtr,
	
	GUIDE_API_Session_CreateSchedule( , GUIDE_JAVA_ScheduleListener, &scheduleHandle );
	
	NDSJNI_CallMethodSetNativeHandle(env, jSchedule, "nativeHandle", "I", &scheduleHandle);
	
	currentScheduleRequest->scheduleHandle = scheduleHandle;
}

#
# GUIDE_JAVA_ScheduleListener
#
# Listener for schedule changes from native GUIDE component. This function is called by the GUIDE component to indicate
# that a row within the schedule object has changed
void GUIDE_JAVA_ScheduleListener(GUIDE_API_TAG userTag, SYSTEM_STATUS completionStatus, uint32_t readyRowIndex)
{
	# Obtain the schedule request corresponding to this value of user_tag
	JPA_VTABLE_GetElement(&g_guide_adaptor_vtable_schedule, userTag, &genPtr);
	
	#
	only pass readyRowIndex to an app. ??
}	

# retrieveSynopsis
# public GuideRequest retrieveSynopsis(int rowIndex,
# Retrieve the synopsis of programme based on row index and programme instance index. 

# run seq
#
GUIDE_JAVA_ScheduleRetrieveSynopsis
GUIDE_JAVA_RetrievalListener # this is used for various objects such as program instance, schedule and etc.
GUIDE_JAVA_ScheduleSetTimeWindow
GUIDE_JAVA_ScheduleListener
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 1, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 2, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 3, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 4, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 5, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 6, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 7, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03817 > num_complete_rows 8, requested_rows 8, row_count 8 num_services 629
!INFO  -G_Sess       < M:guide_api_schedule.c F:GuideScheduleFinishSimpleProgrammeInstanceListRetrieval L:03823 > SCHEDULE_COMPLETE
GUIDE_JAVA_ScheduleGetIntegerProperty
GUIDE_JAVA_ScheduleGetRowStringProperty
GUIDE_JAVA_ScheduleGetRowIntegerProperty
GUIDE_JAVA_ScheduleGetLocator
GUIDE_JAVA_ScheduleSetServiceWindow
...


#
# GUIDE_JAVA_ScheduleListener
#
class GuideRequestImpl implements GuideRequest 
    public synchronized void abort() throws GuideTooLateToAbortException
    {
    	natGuideAPIRequestAbort(requestId);
    }

natGuideAPIRequestAbort
	GUIDE_JAVA_RequestAbort
		GUIDE_API_Request_Abort
		{
			# data->tag
			GUIDE_REQUEST_TAG_GENERAL:
			GUIDE_REQUEST_TAG_ITERATOR:
			GUIDE_REQUEST_TAG_SESSION:
			GUIDE_REQUEST_TAG_PROG_INST_SIMPLE_LIST:
		}

# and it basically means that SIM (or GUIDE) is about to send the response so it cant be cancelled now. So its expected really.
#
!ERROR  -G_Sess       	< p:0x00000000 P: t:0x2c0a8520 T:no name M:guide_api_schedule.c F:GUIDE_API_Schedule_CreateRowStringProperty L:1089 > No service data available 
!ERROR  -J_GUIDE      	< p:0x00000000 P: t:0x2c0a8520 T:no name M:natGuideScheduleImpl.c F:GUIDE_JAVA_ScheduleGetRowStringProperty L:600 > GUIDE_API_Schedule_CreateRowStringProperty failed: 0x3c20006 

#
# (from James C. architect)
# Failure to abort just means that you should expect the callback for the previous request.  
# As such, it needs to be handled gracefully by the EPG, so the associated memory is freed up when the response is eventually received.
# Good point about JPAs, but its still the case that we need to be efficient with memory, so if Picasso can reduce the number of requests, 
# then it will be better.
# 
WARN  -G_Sess       < M:guide_api_request.c F:GUIDE_API_Request_Abort L:00351 > Too late to perform SIM abort
WARN  -J_GUIDE      < M:natGuideRequestImpl.c F:GUIDE_JAVA_RequestAbort L:00202 > JPA_GUIDE: GUIDE_API_Request_Abort failed 


={============================================================================
|kt_dev_si_0001| comp-fem

COMPONENT_NAME := ms_fem_src

T:FEM_WORKER_THREAD M:fem_device.c F:FEM_DEVICE_IOCTL L:00753 > FD: 293 (0x1001), request 0x80044108, argp 0x1e3b020

KT: TUNER_SUBSCRIBE_EVENTS(0x20044200), CDI_FE_ID(0x42), CDI_DEV_TUNER_BASE(0x0)
#define TUNER_SUBSCRIBE_EVENTS             (int)CDI_IOW_I(CDI_FE_ID, (CDI_DEV_TUNER_BASE+0U))
#define CDI_FE_ID			('B') 66. 0x42

# LNB_TONE_CONTROL
F:FEM_DEVICE_IOCTL L:00753 > FD: 212 (0x1001), request 0x80044109, argp 0x1ee5ddc
# LNB_VOLTAGE_CONTROL
F:FEM_DEVICE_IOCTL L:00753 > FD: 212 (0x1001), request 0x80044108, argp 0x1ed19e8

#define MDM_DEVICE_FE_BASE                   ((MDM_DEVICE_TYPE)0x1000)
#define MDM_DEVICE_FE_LNB                    ((MDM_DEVICE_TYPE)0x0001 | MDM_DEVICE_FE_BASE)      /* LNB controller device. Replaced by #MDM_DEVICE_FE_INPUT_CONNECTION */
#define MDM_DEVICE_FE_TUNER                  ((MDM_DEVICE_TYPE)0x0002 | MDM_DEVICE_FE_BASE)      /*!< @brief Tuner */

#-----------------------------------------------------------
# internal
#-----------------------------------------------------------

FEM_PLUGIN_Satellite_ConfigureInputPath
	# FEM_DEVICE_Configure(front_end, TUNER_TUNE)


<locked-unlocked>
egrep -an "KEY_PRESS|FEM_WORKER_THREAD|FRONT END|TUNING TO|CHANNEL CHANGED\
|ScreenSeen|Showing dialog|VIDEO IS|TUNER_LOCKED|FRAME_PRESENTED|RUNNING_STATUS\
|MCM_MEDIACONN_CreateEx|MDM_TunerStatusPrint|LOCKED|mediacon"

# to see how many tuners are locked
!MIL    -EPG_ME       		< p:0x0000022d P:APP t:0x2bf89520 T:no name M:SatelliteSignalGainedLostHandler F:
  allSatSignalInputsAreLocked L:334 > T:PooledExecutor#3:AT LEAST ONE AVAILABLE TUNER NOT LOCKED

# seems that it shows locked peried; it not see UNLOCKED then still LOCKED.

DRV: KERN_WARNING  TUNER1 LOCKED

note: tuner #

!MIL    -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:1655 > 
  Locked f=11778000 fo=10600000 fs=27500000 fec=64 `tuner=1` LNB=1 hMC=0x2 

!MIL    -MCM          < T:FEM_WORKER_THREAD M:mcm_dev_notifications.c F:MCM_DEV_MAN_ListenerMSO L:134 > hMC=0x6  TUNER_LOCKED:
!MIL    -EPG_ME       < M:SatelliteSignalGainedLostHandler F:allSatSignalInputsAreLocked L:331 > T:CEE-J EventQueue Reader 0:TWO AVAILABLE TUNERS (LOCKED)
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSSI L:4224 > FRONT END SIGNAL LOCKED 

DRV: KERN_WARNING  TUNER0 UNLOCKED

!MIL    -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:1691 >
  *WARN* not locked f=12460500 fo=10600000 fs=29500000 fec=4096 tuner=0 LNB=0 hMC=0x4 
!MIL    -MCM          < T:FEM_WORKER_THREAD M:mcm_dev_notifications.c F:MCM_DEV_MAN_ListenerMSO L:134 > hMC=0x2  TUNER_UNLOCKED: 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSSI L:4260 > FRONT END SIGNAL NOT LOCKED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1174 > VIDEO IS HIDDEN 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9325 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000002, status=NOT_RUNNING 

!MIL    -MCM          < T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,4,mc-create-mcid=,4,mc_create-str=,mc-live,fsnfmt=,hMC=0x4 
!MIL    -MDM          < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3234 > mdm_handle =0x3 hMC=0x3 tuner_id =0 and job_type =LIVE_VIEWING 
!MIL    -MDM          < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3234 > mdm_handle =0x2 hMC=0x2 tuner_id =1 and job_type =CAPTURE 
!MIL    -MDM          < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3234 > mdm_handle =0x5 hMC=0x4 tuner_id =0 and job_type =LIVE_VIEWING 


// M:fem_plugin_satellite_scr.c

# TUNER_EVENT_SYNC_UNLOCKED (0x20)
!INFO  -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:01126 > 
Device event: 0x20, Tuner Lock 1
# 
FEM_DS_DeviceEvent(FEM_IC_INPUT_PATH * input_path, uint32_t event)
	FEM_PLUGIN_CALL(fem_delivery_system, GetTunerModes, (tuner_modes));
	# g_fem_plugin_functions_satellite
		FEM_PLUGIN_Satellite_DeviceEvent(FEM_IC_INPUT_PATH * input_path, uint32_t event)
		{
			FEM_DEVICE * front_end = &fem_devices[input_path->u.satellite.front_end->device_index];

			else if (event & TUNER_EVENT_SYNC_LOCKED)
				DIAG_LOG_MIL(FEM_Logging_ID, ("Locked  f=%d fo=%d fs=%d fec=%p",
			else if (event & TUNER_EVENT_SYNC_UNLOCKED)
				DIAG_LOG_MIL(FEM_Logging_ID, ("*WARN* not locked  f=%d fo=%d fs=%d fec=%p",
		}

# uint32_t FEM_TUNER_TIMEOUT = 2000U;
# FEM_INTERNAL_SetConnSignalTimeout
FEM_INTERNAL_Prepare_ConfigureFrontEnd
FEM_INTERNAL_SetConnSignalTimeout
	# cancel alarm and set alarm WHEN 
	# lock_status = fem_devices[front_end_index].details.tuner.locked;
	# is false
	SYSTEMALARM_Cancel(conn->alarm_handle);

	bool lock_status = false;
	alarmInfo.alarm_data.rel_info.timeout = FEM_CONFIG_GetConfig()->tuner_timeout;

    alarmInfo.alarm_data.rel_info.is_repeating = false;
    alarmInfo.alarm_data.rel_info.callback = 'FEM_INTERNAL_PREPARE_tune_timeout';
	
FEM_INTERNAL_PREPARE_tune_timeout
	SYSTEMITC_API_PostEvent(FEM_DEVMON_EV_LOCK_TIMEOUT)

# FEM thread: alram was fired. Before timeout alarm fired, there should be event from a driver.
#
FEM_DEVMON_QueueEvent
case FEM_DEVMON_EV_LOCK_TIMEOUT :
	FEM_SS_HandleTuneTimeoutAlarm
		# Connection is hMC
		# !WARN  -FEM          
		# < p:000000d2 t:01648140 T:FEM_WORKER_THREAD M:fem_signalstatus.c F:FEM_SS_HandleTuneTimeoutAlarm L:00387 > Connection 428 has failed to lock
		# if conn->lock_status is false, send SSI
		# FEM_SS_NotifySSIListeners
	tmp_event = (conn->lock_status) ? TUNER_EVENT_SYNC_LOCKED : TUNER_EVENT_SYNC_UNLOCKED;

	'FEM_DS_DeviceEvent'(&(conn->input_path), tmp_event))

details.tuner.debounce_timer


<signal-quality>
typedef struct TunerStatusDVBS2_cdi
{
	...
  uint32_t         berWindow;
  uint32_t         berCount;
} TunerStatusDVBS2;

static SYSTEM_STATUS FEM_PLUGIN_Satellite_GetTunerStatusInfo
(const FEM_DEVICE *tuner, uint32_t *sig_locked, uint32_t *sig_strength, uint32_t *sig_max_strength, uint32_t *sig_min_strength, uint32_t *berWindow, uint32_t *berCount)
{
	*berCount = tuner_status.u.DVBS2.berCount;
	*berWindow = tuner_status.u.DVBS2.berWindow;
}

# where GET_TUNER_STATUS ioctl is called
FEM_PLUGIN_Satellite_GetTunerStatusInfo

# where do some math. here simple math is: 'berCount:berWin = x : billion
# bits' so x = (berCount*billion)/berWindow.
# #define `FEM_WORST_SIGNAL_QUALITY` (1.000.000.000) 0x3b9aca00
# CMS_MEDIA_SERVICES/FEM/src/fem_delivery_system.c

# FEM_DEVICE_Open
# 	else if (device->device_type == MDM_DEVICE_FE_TUNER)
#
#	FEM_WORKER_IntAddMonitor(device->current_fd, FEM_DevMonHandleDeviceEvent);
#		worker_fd_callback_list[worker_num_fds] = callback_fn;
#
# FEM_InitThreads
# 	FEM_ThreadCreate("FEM_WORKER_THREAD", FEM_WORKER_ThreadEntry)
#
# FEM_WORKER_ThreadEntry
#
# 	poll(worker_fd_watch_list, (nfds_t) worker_num_fds, SYSTEMITC_API_PEND_FOREVER);
#
# 	worker_fd_callback_list[poll_index](worker_fd_watch_list[poll_index].fd);
#
FEM_DevMonHandleDeviceEvent
{
  // only place to call GET_EVENT
  status = FEM_DEVICE_IOCTL(&fem_devices[device_index], (int) TUNER_GET_EVENTS, &events);

  FEM_DS_GetTunerStatusInfo()
  {
    // fem_plugin_satellite_scr.c for BSKYB
    // FEM_PLUGIN_CALL: this maps to FEM_PLUGIN_Satellite_GetTunerStatusInfo

    // debug mesg
    // fprintf(stderr, "KT: mode(%d), ss max-min-cur (%d,%d,%d), ber c-win (%d, %d)\n", 
    //	tuner_status.mode, *sig_max_strength, *sig_min_strength, *sig_strength, *berCount, *berWindow  );
    //
    // For 890 case:
    // TUNER_MODE_SAT_DVB_S(1)
    // KT: mode(1), ss max-min-cur (245,125,167), ber c-win (0, 20000000)

    *sig_locked = (uint32_t)tuner_status.u.DVBS.signalStatus;      /* bitfield indicating the 3 levels of lock */

    // #define TUNER_SIGNAL_NO_CARRIER (0x00)
    // The tuner has detected a carrier. This can be reported only in Tuning mode.
    // #define TUNER_SIGNAL_CARRIER (0x01)
    // The tuner is demodulating the signal. This can be reported only in Tuning
    // mode.
    // #define TUNER_SIGNAL_DEMOD (0x02)
    // The tuner has successfully acquired the signal. This can be reported only in
    // Tuning mode.
    // #define TUNER_SIGNAL_SYNC (0x04)
    // The tuner has completed acquisition of the signal while in Scanning 

    // 0xb9 = 185
    *sig_strength = (uint32_t)tuner_status.u.DVBS.signalStrength;  /* 255 = 0dBm, 0 = -127.5 dBm */
    *berCount = tuner_status.u.DVBS.berCount;
    *berWindow = tuner_status.u.DVBS.berWindow;

    *sig_quality = xuint64_t_low(&sig_quality64); or
      *sig_quality = FEM_WORST_SIGNAL_QUALITY;

    DIAG_LOG_MIL(FEM_Logging_ID, ("sig_locked 0x%x sig_strength 0x%x sig_quality 0x%x", *sig_locked, *sig_strength, *sig_quality));
    // MIL    -FEM          	< M:fem_delivery_system.c F:FEM_DS_GetTunerStatusInfo L:512 > sig_locked 0x7 sig_strength 0xb2 sig_quality 0x186a
  }

  // when it was not locked before and is locked now
  if (fem_devices[device_index].details.tuner.locked == true) and if (events & (uint32_t)TUNER_EVENT_SYNC_LOCKED)
  {
    FEM_DevMon_HandleSignalTransition
    {
      fem_devices[device_index].details.tuner.locked = true;
      or
        fem_devices[device_index].details.tuner.locked = false;
    }
  }

  FEM_DevMon_NotifyPlugins
  {
    FEM_DS_DeviceEvent'(&(saved_input_path), events)
  }
}

# where do math for bar % (/spm/src/server/spm_mcm_module): not use this in Picasso.
SPM_MCM_ComputeBaragrahQuality

# For Picasso, refer to WP811.
UI value displayed	Error count/billion samples
0	>100000000
1	100000000 - 80000001
2	80000000 - 65000001
3	65000000 - 50000001
4	50,000,000 - 25000001
5	25000000 - 10000001
6	10,000,000 - 6000001
7	6000000 - 2000001
8	2000000 - 500001
9	<=500000

>>> 0x7a1200
8000000


#-----------------------------------------------------------
# freq
#-----------------------------------------------------------
fprintf(stderr, "KT:S: Locked  rf=%d f=%d fo=%d fs=%d fec=%p",
			input_path->u.satellite.front_end_configuration.u.DVBS.frequency,
			input_path->u.satellite.front_end_configuration.u.DVBS.frequency + *(input_path->u.satellite.lnb->current_lo),
			*(input_path->u.satellite.lnb->current_lo),
			input_path->u.satellite.front_end_configuration.u.DVBS.symbolRate,
			input_path->u.satellite.front_end_configuration.u.DVBS.fec);

(BOOT)   KT:S: Locked  rf=1178000 f=11778000 fo=10600000 fs=27500000 fec=0x40
(CH 908) KT:S: Locked  rf=1334000 f=11934000 fo=10600000 fs=27500000 fec=0x40
(CH 503) KT:S: Locked  rf=1052750 f=10802750 fo=9750000 fs=22000000 fec=0x200


# lnb is simple constant from
#
[spm.cfg]
HI_BAND_LO=10600
LOW_BAND_LO=9750

# LOW. lnb->lo0 = value;
fem_status |= FEM_IC_Lnb_SetInteger(f_SPM_FEM_instances[instanceIdx].lnbObject[new_idx],
								   FEM_IC_LNB_PROPID_LO0,
								   1000U * spmConfigPtr->lnb_defaults[SPM_API_LNB_PROPID_LOW_BAND_LO_FREQ_MHZ]);

# HIGH. lnb->lo0 = value;
fem_status |= FEM_IC_Lnb_SetInteger(f_SPM_FEM_instances[instanceIdx].lnbObject[new_idx],
								   FEM_IC_LNB_PROPID_LO1,
								   1000U * spmConfigPtr->lnb_defaults[SPM_API_LNB_PROPID_HI_BAND_LO_FREQ_MHZ]);

# 
# Freq: where f = freq + lnb lo/high, fo = lnb lo/high, fs = sym rate, fec so in this case, actuall freq is f-fo.
NDS: ^0946685438.909545 !MIL   -FEM          < M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:01234 > Locked  f=11778000 fo=10600000 fs=27500000 fec=0x40
NDS: ^0946686263.219451 !MIL   -FEM          < M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_ConfigureInputPath L:00607 > DVBS0 Tuning Param Freq[1178000] SymRate[27500000] FEC[64] Inv[255] RollOff[0]

# for BSKYB
S has 2 SD channels and S2 has three HD channels.

#
!MIL   -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_ConfigureInputPath L:00545 > DVBS0 Tuning Param Freq[1038000] SymRate[22000000] FEC[512] Inv[255] RollOff[0]
!MIL   -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_ConfigureInputPath L:00552 > DVBS0 Mod Param QAM[0] PSK[0] ALOG[0] VSB[0]
!MIL   -FEM          < T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:01236 > *WARN* not locked  f=10788000 fo=9750000 fs=22000000 fec=0x200

10788000-9750000 = 1,038,000


*player-event-locked*
// #define PLAYER_EVENT_CONNECTION_FRONTEND            0x80800001      
// /**< Notification that the front end signal state has changed. @see #PLAYER_EVENT_Connection_FrontEnd_PropId */

!MIL    -EPG_PLAY     		< M:PlayerEventPump F:processEvent L:105 > T:PooledExecutor#3:PlayerEvent > oC@5a25213 ID > -2139095039
!MIL    -EPG_ME       		< M:ConnectionEventHandler$SignalStateChangeTask F:notifySignalState L:176 > T:PooledExecutor#3:#NSS# ignoring already locked=true

!MIL    -EPG_PLAY     		< M:PlayerEventPump F:processEvent L:105 > T:PooledExecutor#1:PlayerEvent > oC@5a208fa ID > -2139095039
!MIL    -EPG_ME       		< M:ConnectionEventHandler$SignalStateChangeTask F:notifySignalState L:176 > T:PooledExecutor#1:#NSS# ignoring already locked=false
!MIL    -AMS          		< P:MW M:dataClient.cpp F:DataClient::handleSignalEvents L:848 > SIGNAL_LOSS event arrived 

egrep -an "|FEM_DS_GetTunerStatusInfo|FEM_PLUGIN_Satellite_DeviceEvent|notifySignalState"

// Q
!MIL    -FEM          		< p:0x0000063b P:MW t:0x75944450 T:FEM_WORKER_THREAD M:fem_plugin_satellite_common.c F:FEM_PLUGIN_SatelliteCommon_LogLockEventStatus L:1185 > Locked f=12460500 fo=0 fs=29500000 fec=4096 tuner=0 LNB=0 hMC=0x3 
!MIL    -FEM          		< p:0x0000063b P:MW t:0x75944450 T:FEM_WORKER_THREAD M:fem_plugin_satellite_common.c F:FEM_PLUGIN_SatelliteCommon_LogLockEventStatus L:1185 > Locked f=12460500 fo=0 fs=29500000 fec=4096 tuner=0 LNB=0 hMC=0x4 


={============================================================================
|kt_dev_si_0001| comp-drv

DRV: ^[23:07:50]0946768070.432141 KERN_WARNING <<< Remote Key >>> key 0xe307 ( USER_INPUT_KEY_NUMERIC_SEVEN ) is DOWN 

DRV: ^[00:10:43]0946685443.806142 KERN_WARNING SPLICE_DBG:F:ioctl_VIDEO_DECODER_STOP L:4440   
DRV: ^[00:10:43]0946685443.831142 KERN_WARNING SPLICE_DBG:F:ioctl_VIDEO_DECODER_FLUSH_RATE_BUFFER L:4569   

<driver-delivery>
note:
This is not a source delivery.

~/STB_SW/deps/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball$ ls -al
total 24764
drwxr-xr-x 2 kyoupark ccusers    4096 May 18  2010 .
drwxr-xr-x 6 kyoupark ccusers    4096 Oct 26  2009 ..
-r-xr--r-- 1 kyoupark ccusers 3328721 May 20 13:33 cdi-drivers-ams-drx890-debug.tar.bz2
-r-xr--r-- 1 kyoupark ccusers 2289139 May 20 13:33 cdi-drivers-ams-drx890-preprod.tar.bz2
-r-xr--r-- 1 kyoupark ccusers 2275247 May 20 13:33 cdi-drivers-ams-drx890-prod.tar.bz2
-r--r--r-- 1 kyoupark ccusers 5497731 May 20 13:33 kernel-headers-ams-drx890-debug.tar.gz
-r--r--r-- 1 kyoupark ccusers 5495679 May 20 13:33 kernel-headers-ams-drx890-preprod.tar.gz
-r--r--r-- 1 kyoupark ccusers 5495446 May 20 13:33 kernel-headers-ams-drx890-prod.tar.gz
-r--r--r-- 1 kyoupark ccusers  281610 May 20 13:33 nds-drv-ams-drx890-debug.tar.bz2
-r--r--r-- 1 kyoupark ccusers  281583 May 20 13:33 nds-drv-ams-drx890-preprod.tar.bz2
-r--r--r-- 1 kyoupark ccusers  268582 May 20 13:33 nds-drv-ams-drx890-prod.tar.bz2
-r-xr--r-- 1 kyoupark ccusers   40110 Jun  7  2012 service-centre-ams-drx890-debug.tar.bz2
-r--r--r-- 1 kyoupark ccusers   40110 Jun  7  2012 service-centre-ams-drx890-preprod.tar.bz2
-r--r--r-- 1 kyoupark ccusers   40110 Jun  7  2012 service-centre-ams-drx890-prod.tar.bz2


={============================================================================
|kt_dev_si_0001| comp-mcm comp-mpm

COMPONENT_NAME := ms_mcm_src
NDS_BUILD_TYPE_ms_mcm_src = debug

<mcm-error>
#define MCM_COMP_ID           ((uint32_t)(17)) /*!< @brief Media Connection Management */
#define MCM_COMMON_ID   (1)

#define SEVERITY_SEVERE  ((uint32_t)(0x2))   /*!< @brief Severe return status - for use with #SYSTEM_MAKE_COMPONENT_STATUS and #SYSTEM_STATUS_GET_SEVERITY */

// (((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )

`0x04401000`
hex((((17 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((1 & 0xF) << 12) | (0 & 0xFFF) ))
#define MCM_MEDIACONN_STATUS_OK                         (SYSTEM_MAKE_COMPONENT_STATUS(MCM_COMP_ID, MCM_COMMON_ID, SEVERITY_NONE,   0)) /*!< @brief Success status for MCM_MEDIACONN API */

#define MCM_MEDIACONN_STATUS_NOT_SUPPORTED              (SYSTEM_MAKE_COMPONENT_STATUS(MCM_COMP_ID, MCM_COMMON_ID, SEVERITY_SEVERE, 2)) /*!< @brief Not Supported status for MCM_MEDIACONN API*/


<vrm-error>
#define MCM_MEDIACONN_STATUS_ERROR                      (SYSTEM_MAKE_COMPONENT_STATUS(MCM_COMP_ID, MCM_COMMON_ID, SEVERITY_SEVERE, 1)) /*!< @brief Failure status for MCM_MEDIACONN API */

`0x04421001`
>>> hex((((17 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (1 & 0xFFF) ))
'0x4421001'

note: is it really error?
!INFO   -MCM          		< T:VRM_SRV M:mcm_media_connection.c F:MCRemoveMediaConnection L:265 > hMC=0x383f Removing 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > @@PMON@@,trace,mediacon,mc-destroyed,14399,fsnfmt=,hMC=0x383f 
!INFO   -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_DestroyCon L:502 > [API_CALL::""MCM""] " "MCM_MEDIACONN_Destroy returned [MCM:interface(1):SEVERE:status(1)(0x1)][(71438337)(0x04421001)] on ""hMC=0x383f 
!INFO   -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_DestroyCon L:509 > [API_CALL_ERR::""MCM""] " "on MCM_MEDIACONN_Destroy, [MCM:interface(1):SEVERE:status(1)(0x1)][(71438337)(0x04421001)] ""hMC=0x383f 
!FATAL  -VRM_COMMON   		< T:VRM_SRV M:vrm_diag.c F:VRM_DIAG_Abort L:327 > ~~~~~~~~~~~~ VRM_DIAG_Abort at file=<pvp_fsm.c>, line=870, PANEL_FsmDisconnectingState, failed on: "PANEL_DestroyCon failed. The mconnection may be stuck" 


note:
one tuner can have three jobs(live, rb, and rec) and two MC(live and recordings)


<mc-state-debug>
#-----------------------------------------------------------
# MCM_Mediaconn_StateDebug when debug ON
#-----------------------------------------------------------

#define MCM_STATE_DEBUG_LOG_FORMAT                                                                                                                                      \
    "%d 
hMC=0x%x 
%s 
(0x%x) 
%s 
%s 
(0x%x : 0x%x) 
%s 
(0x%x) 
%s 
(0x%x) 
retry_count %u is_retrying %d event_flag 0x%08x mcm_wait_flags 0x%08x",                              \


F:MCM_Mediaconn_StateDebug L:1632 > 
1678                                            // line
hMC=0xa0e                                       // p_media_connection->h_media_connection
MCM_MEDIACONN_TYPE_LIVE                         // mc_type_str
(0x7000002)                                     // ->mc_type *mc-type*
STATE_FREEING                                   // state_str
SYSTEM_EXCEPTION_TYPE_NO_EXCEPTION              // exception_str
(0x10000105 : 0x64)                             // ->state, ->status
PREPARING_SIM_MONI_SEI [SIM]                    // activity_str
(0x11)                                          // -> sequence_index
ITC_EV_??? (00000000) (DM ??? (00) Activity 0)  // event_buf 
(0x0)                                           // event
retry_count 3 is_retrying 0 event_flag 0x00000003 mcm_wait_flags 0x00000000 


CMS_MEDIA_SERVICES/MCM/src/mcm_mediaconn_event.c

        // state and state_str are the same
        switch (p_media_connection->state)
            case MCM_MEDIACONN_STATE_BASE:                          state_str = "STATE_BASE"; break;

        // status and exception_str are the same
        switch (p_media_connection->status)
            case SYSTEM_EXCEPTION_TYPE_NO_EXCEPTION:                    exception_str = "SYSTEM_EXCEPTION_TYPE_NO_EXCEPTION"; break;

            // *comp-sei* SEI(Service Event Information)
        if (IS_MEDIACONN_ACTIVE_SUPERSTATE_MATCH(p_media_connection->state, MCM_MEDIACONN_STATE_PREPARE) ||
            IS_MEDIACONN_ACTIVE_SUPERSTATE_MATCH(p_media_connection->state, MCM_MEDIACONN_STATE_FREE) ||
            IS_MEDIACONN_PENDING_STATE(p_media_connection->state) )
        {
            switch (`CURRENT_ACTIVITY`(p_media_connection))
                case MCM_MEDIACONN_PREPARING_SIM_MONI_SEI:                      activity_str = "PREPARING_SIM_MONI_SEI [SIM]"; break;
        }

<mc-type>
p_media_connection->mc_type

#define MCM_MEDIACONN_TYPE_LIVEVIEWING    `0x7000002`
//  (MCM_MEDIACONN_TYPE_TUNER + MCM_MEDIACONN_TYPE_SCI +  MCM_MEDIACONN_TYPE_CASI + (uint32_t)0x00000002)
//  /*!< @brief Live: frontend to display */
// MCM_MEDIACONN_TYPE_LIVEVIEWING   (0x01000000 + 0x02000000 +  0x04000000 + 0x00000002) = 0x7000002

#define MCM_MEDIACONN_TYPE_RECORDING      `0x7000003`
(MCM_MEDIACONN_TYPE_TUNER + MCM_MEDIACONN_TYPE_SCI +  MCM_MEDIACONN_TYPE_CASI + (uint32_t)0x00000003)           /*!< @brief Record: frontend to disk */

#define MCM_MEDIACONN_TYPE_SUBSTITUTION   `0x700000c`
// (MCM_MEDIACONN_TYPE_TUNER + MCM_MEDIACONN_TYPE_SCI +  MCM_MEDIACONN_TYPE_CASI + (uint32_t)0x0000000c)  
// /*!< @brief Substitution: disk to display  */

MCM_MEDIACONN_TYPE_SCAN          (MCM_MEDIACONN_TYPE_TUNER + (uint32_t)0x00000001) = 0x1000001
MCM_MEDIACONN_TYPE_CAPTURE       (MCM_MEDIACONN_TYPE_TUNER + MCM_MEDIACONN_TYPE_SCI + (uint32_t)0x00000006) = 0x3000006

#define MCM_MEDIACONN_TYPE_PLAYBACK   `0x6000004`
// (MCM_MEDIACONN_TYPE_SCI + MCM_MEDIACONN_TYPE_CASI + (uint32_t)0x00000004)           
// /*!< @brief Playback: disk to display */


#
= SEQ #01
create and start live job to main display
create live MC 0x55

STOP RB PLAY MC ( NOT DELETE? )
STOP RB MC 
RELESE RB MC

OR

STOP and RELEASE RB
STOP and RELEASE LIVE

locked live 0x55
run live MC 0x55

create and start RB job
create RB MC 0x56

PAUSE KEY

run RB MC 0x56
create RB play job and to main display

STOP Live decoder
start RB play job and crate MC 0x57

RELEASE Live MC.
run RB play MC.

PLAY KEY

= SEQ #02
create and start live job to main display

STOP RB PLAY MC ( NOT DELETE? )
STOP RB MC 
RELESE RB MC


<mc-states>
70499:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > 
  @@PMON@@,trace,mediacon,mc-create7,mc-create-mcid=,12237,mc_create-str=,mc-live,fsnfmt=,hMC=0x2fcd 

70501:!MIL    -MDM          		< T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > 
  mdm_handle =0x11a9f hMC=0x2fcd tud =1 and job_type =LIVE_VIEWING 

70503:!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:947 > 
  MCM_MEDIACONN_STATE_OPENED hMC=0x2fcd replace hMC=0x2fcc type=0x07000002 

  note: replace MC

70505:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:340 > 
  @@PMON@@,trace,mediacon,mc-create37,fsnfmt=,hMC=0x2fcd 

70506:!MIL    -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_CreateCon L:333 > 
  [API_CALL::""MCM""] " "MCM_MEDIACreateEx type: 0x7000002 returned [SYSTEM_STATUS_OK 0x04401000] ""hMC=0x2fcd 

70508:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Prepare L:404 > 
  @@PMON@@,trace,mediacon,mc-prepar37,fsnfmt=,hMC=0x2fcd 

70541:!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_PrepareOpenConfigureTSChannel L:2152 > 
  MCM_MEDIACONN_STATE_OPENCONFIGURENNEL hMC=0x2fcd tschannel1 

70542:!WARN   -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_HandleInternalMcmMconStateChangedMsg L:1669 > 
  got MCM_MEDIACONN_STATE_PENDING oMC=0x2fcd"" PANEL_MCON_TYPE_LIVE NO_EXCEPTION 

70591:!MIL    -FEM          		< T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_ConfigureInputPath L:646 > 
  DVBS2 Tuning Param Freq[1097000] te[23000000] FEC[64] Inv[255] RollOff[2] tuner=1 hMC=0x2fcd 

70592:!MIL    -FEM          		< T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_ConfigureInputPath L:656 > 
  DVBS2 Mod Param QAM[0] PSK[2] ALOVSB[0] tuner=1 hMC=0x2fcd 

70593:!MIL    -FEM          		< T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:1562 > 
  *WARN* not locked f=10847000 fo=90 fs=23000000 fec=0x40 tuner=1 LNB=1 hMC=0x2fcd 

70670:!WARN   -FEM          		< T:FEM_WORKER_THREAD M:fem_signalstatus.c F:FEM_SS_HandleTuneTimeoutAlarm L:410 > 
  Connection hMC=0x2fcd has failed ck 

70671:!MIL    -FEM          		< T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:1562 > 
  *WARN* not locked f=10847000 fo=90 fs=23000000 fec=0x40 tuner=1 LNB=1 hMC=0x2fcd 

70673:!WARN   -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_HandleInternalMcmMconStateChangedMsg L:1669 > 
  got MCM_MEDIACONN_STATE_PENDING oMC=0x2fcd"" PANEL_MCON_TYPE_LIVE SIGNAL_LOSS 

70867:!MIL    -MDM          		< T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > 
  mdm_handle =0x11a9f hMC=0x2fcd tuner_id =1 and job_type =LIVE_VIEWING 

70869:!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:947 > 
  MCM_MEDIACONN_STATE_OPENED hMC=0x2fce replace hMC=0x2fcd type=0x07000002 

// to close
:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Free L:593 > 
  @@PMON@@,trace,mediacon,`mc-free`,12237,fsnfmt=,hMC=0x2fcd 

:!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Free L:1989 > 
  `MCM_MEDIACONN_STATE_FREETSCHANNEL` hMC=0x2fcd 

:!MIL    -MCM          		< T:MCM_ITCMAIN_THREAD M:mcm_mediaconn_event.c F:MCM_Mediaconn_ActionFreeing L:5201 > 
  @@PMON@@,trace,mediacon,`mc-freed`,12237,fsnfmt=,hMC=0x2fcd 

:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:660 > 
  @@PMON@@,trace,mediacon,`mc-destroy`,12237,fsnfmt=,hMC=0x2fcd 

:!WARN   -FDM_SVR      		< T:MCM_ITCMAIN_THREAD M:fdm_svr_deviceman.c F:releaseConnection L:441 > 
  deleting hMC=0x2fcd 

:!MIL    -MPM          		< T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Close L:2107 > 
  `MCM_MEDIACONN_STATE_CLOSED` hMC=0x2fcd 

:!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > 
  @@PMON@@,trace,`mediacon,mc-destroyed`,12237,fsnfmt=,hMC=0x2fcd 


<mc-playback>
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > 
@@PMON@@,trace,mediacon,mc-create,65366,mc-create-mcid=,65366,mc_create-str=,mc-playback,fsnfmt=,hMC=0xff56 


<mc-handle>
typedef     uint32_t    MCM_MEDIACONN_HANDLE;           /*!< @brief Media Connection handle. @sa MCM_MEDIACONN_HANDLE_INVALID */

#define MCM_MEDIACONN_HANDLE_INVALID                    ((uint32_t)0x00000000)                                     /*!< @brief Invalid Media Connection handle */


240602:NDS: ^[2017:10:20 20:31:12]0946973648.873072 !MIL    -MDM                        < p:0x00000318 P:MW t:0x020d8520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3241 > 
mdm_handle =0x3d77e hMC=0x0 tuner_id =1 and job_type =RECORD

240780:NDS: ^[2017:10:20 20:31:13]0946973649.171794 !MIL    -MPM                        < p:0x00000318 P:MW t:0x01c09520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:951 > 
MCM_MEDIACON N_STATE_OPENED hMC=0xa1e1 `replace hMC=0x0` type=0x0300000a


={============================================================================
|kt_dev_si_0001| comp-memman

note:
No master config xml.

$ grep MEMMAN dms_master_config.xml
99:    <key name="TRACE_LEVEL_MEMMAN" type="STRING" value="AFEWM">

Making mem pool growable has been forbidden, even if the MEMMAN API propose it !

// sample memcheck shot
// ONLY WHEN #if (!defined(DIAG_RELEASE) && !defined(__DIAG_RELEASE)), means
// it'll be seen only in debug


<to-enable-memcheck>

COMPONENT_NAME:=memman

// CMS_SYSTEM_INFRASTRUCTURE/MEMMAN/src/makefile
ifeq ($(NDS_BUILD_TYPE_memman), release)
    COMPONENT_CC_DEFINES+=MODE_RELEASE
endif

// CMS_SYSTEM_INFRASTRUCTURE/MEMMAN/src/memman_config.h
#if defined(MODE_RELEASE)
#undef DEBUG_MEMORY_CORRUPTION
#undef DEBUG_MEMORY_BLOCK_OWNER
#undef DEBUG_MEMORY_FILL
#undef DUMP_WHEN_FULL
#define MEMMAN_NDEBUG
#else
#define DEBUG_MEMORY_CORRUPTION
#define DEBUG_MEMORY_BLOCK_OWNER
#undef DEBUG_MEMORY_FILL
`#define DUMP_WHEN_FULL`
#undef MEMMAN_NDEBUG
#endif

// CMS_SYSTEM_INFRASTRUCTURE/MEMMAN/src/mem_internals.h
#ifdef DUMP_WHEN_FULL
#ifndef MEMMAN_DUMP_FULL_ONCE
#define DUMP_USED_BLOCKS(POOL) \
	(void) membuster_plus_pool_oom(POOL); \
	(void) MemCheckMemory(POOL, MEMSTATUS_LOGLEVEL(MEMMAN_API_MEMSTATUS_ALL, MEMSTATUS_LOGLEVEL_WARN))
#else /* MEMMAN_DUMP_FULL_ONCE */


// CMS_SYSTEM_INFRASTRUCTURE/MEMMAN/src/mem_info.c
#ifndef  MODE_RELEASE
SYSTEM_STATUS MemCheckMemory(MEMMAN_API_MemoryPoolHandle * pool, uint32_t aMcmFlags)
{
}


MHWMemAllocStatic
  MEMORY_PRINT_W(("Cannot allocate %d bytes in pool " POOLNAME_FMT ", not
        enough memory", size, PNAME(pool)));
  if (smax <= size)
  {
     MEMORY_PRINT_W(("   Biggest block is %d bytes", smax));
  }
  DUMP_USED_BLOCKS(pool);

// DUMP_USED_BLOCKS(g_planner_native_mem_pool);
// MemCheckMemory(g_planner_native_mem_pool,
//  MEMSTATUS_LOGLEVEL(MEMMAN_API_MEMSTATUS_ALL, MEMSTATUS_LOGLEVEL_WARN));

M:mem_static.c F:MHWMemAllocStatic L:00065 > Cannot allocate 132 bytes in pool ADPT_PLANNER, not enough memory
M:mem_static.c F:MHWMemAllocStatic L:00068 >    Biggest block is 0 bytes
M:mem_info.c F:MemCheckMemory L:00333 > MEMCHECK: BEGIN Check Pool: ADPT_PLANNER
M:mem_info.c F:MemCheckMemory L:00343 > MEMCHECK: Chunk 0 addresses: [[ 0x1306ee8 ]] -> [[ 0x1307e87 ]]
M:mem_info.c F:MemCheckMemory L:00350 > MEMCHECK: Offset range in chunk:  0      +0 ->  0   +3999[    4000]
M:mem_info.c F:MemCheckMemory L:00466 > MEMCHECK: Checking block pool
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      0 : used block  0      +0[     136] S------ [0x01306efc]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      1 : used block  0    +136[      44] S------ [0x01306f84]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      2 : used block  0    +180[     132] S------ [0x01306fb0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      3 : used block  0    +312[      44] S------ [0x01307034]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      4 : used block  0    +356[     132] S------ [0x01307060]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      5 : used block  0    +488[      44] S------ [0x013070e4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      6 : used block  0    +532[     132] S------ [0x01307110]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      7 : used block  0    +664[      44] S------ [0x01307194]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      8 : used block  0    +708[     132] S------ [0x013071c0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:      9 : used block  0    +840[      44] S------ [0x01307244]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     10 : used block  0    +884[     132] S------ [0x01307270]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     11 : used block  0   +1016[      44] S------ [0x013072f4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     12 : used block  0   +1060[     132] S------ [0x01307320]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     13 : used block  0   +1192[      44] S------ [0x013073a4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     14 : used block  0   +1236[     132] S------ [0x013073d0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     15 : used block  0   +1368[      44] S------ [0x01307454]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     16 : used block  0   +1412[     132] S------ [0x01307480]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     17 : used block  0   +1544[      44] S------ [0x01307504]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     18 : used block  0   +1588[     132] S------ [0x01307530]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     19 : used block  0   +1720[      44] S------ [0x013075b4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     20 : used block  0   +1764[     132] S------ [0x013075e0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     21 : used block  0   +1896[      44] S------ [0x01307664]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     22 : used block  0   +1940[     132] S------ [0x01307690]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     23 : used block  0   +2072[      44] S------ [0x01307714]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     24 : used block  0   +2116[     132] S------ [0x01307740]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     25 : used block  0   +2248[      44] S------ [0x013077c4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     26 : used block  0   +2292[     132] S------ [0x013077f0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     27 : used block  0   +2424[      44] S------ [0x01307874]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     28 : used block  0   +2468[     132] S------ [0x013078a0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     29 : used block  0   +2600[      44] S------ [0x01307924]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     30 : used block  0   +2644[     132] S------ [0x01307950]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     31 : used block  0   +2776[      44] S------ [0x013079d4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     32 : used block  0   +2820[     132] S------ [0x01307a00]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     33 : used block  0   +2952[      44] S------ [0x01307a84]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     34 : used block  0   +2996[     132] S------ [0x01307ab0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     35 : used block  0   +3128[      44] S------ [0x01307b34]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     36 : used block  0   +3172[     132] S------ [0x01307b60]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     37 : used block  0   +3304[      44] S------ [0x01307be4]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     38 : used block  0   +3348[     132] S------ [0x01307c10]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     39 : used block  0   +3480[      44] S------ [0x01307c94]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     40 : used block  0   +3524[     128] S------ [0x01307cc0]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     41 : used block  0   +3652[      44] S------ [0x01307d40]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     42 : used block  0   +3696[     128] S------ [0x01307d6c]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     43 : used block  0   +3824[      44] S------ [0x01307dec]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00565 > MEMCHECK:     44 : used block  0   +3868[     132] S------ [0x01307e18]  <no-owner> 0
M:mem_info.c F:MemCheckMemory L:00575 > MEMCHECK: Checking free block lists
M:mem_info.c F:MemCheckMemory L:00692 > MEMCHECK: Pool size summary:
M:mem_info.c F:MemCheckMemory L:00694 > MEMCHECK:  free     |      0 blocks [       0]
M:mem_info.c F:MemCheckMemory L:00696 > MEMCHECK:  static   |     45 blocks [    4000]
M:mem_info.c F:MemCheckMemory L:00698 > MEMCHECK:  moveable |      0 blocks [       0]
M:mem_info.c F:MemCheckMemory L:00762 > MEMCHECK: END Check Pool: ADPT_PLANNER

note: that there is 20 bytes overhead for each block. For example, if you
allock 24 bytes and it will 44 bytes memman block like above.

http://hetty.cisco.com/fusionmadesimple/index.php/Debugging_memory_issues#Double_free

<double-free>
If you see a core dump with a crash in MHWMemFreeStatic or MHWMemElementIsFree
then you are probably dealing with memory that has been freed twice.

MHWMemFreeStatic checks MEMBLOCK_IS_HANDLED. The first time you call it, it
returns false, which means the memory was allocated with malloc and MEMMAN
does not have to do anything, but when it is freed all the MEMMAN flags get
reset. This means that if you erroneously call MHWMemFreeStatic a second time
on the same memory, MEMBLOCK_IS_HANDLED erroneously returns true, which causes
IS_HANDLE and MHWMemElementIsFree to be called, which try to dereference some
pointer that never pointed anywhere. In previous cases I've found it is caused
by the same thing being freed from two different threads. 


Use `MEMMAN_FORCE_USE_MALLOC_DIRECTLY` to force it to use calloc.


={============================================================================
|kt_dev_si_0001| comp-membuster

<membuster-config> <check-interval>

http://hetty.cisco.com/fusionmadesimple/index.php/Membuster_plus_v2

// STB_SW_o/DARWIN_PLATFORM/dms/public/config/config.misc/MBUSTER.CFG

# This is a comment
300		# Time in seconds before we start checking allocations (default: 300)
1		# Output: 0=stdout, 1=file (default: 1)
# Output path (default: /flash0/fs/NDS)
/flash0/fs/NDS
300		# Time in seconds that allocations must span to be flagged as suspicious (default: 300)
150 		# Time in seconds before we start logging allocations (default: 150)
180		# Time in seconds between successive allocation checks  (default: 180)
# Comma separated list of processes to exclude. A maximum of 5 processes may be excluded.  (default: <None>)
PWM_Process
# Pool to monitor. Use an asterisk (*) to monitor all pools. (default: *)
VGC_MEMORY_POOL
10		# Call depth (default: 24) (maximum: 24)

                MEMBUSTER_PRINT_M(("membuster default config: %u, %u, %s, %u, %u, %u",
                                   mb_init_sleep, mb_output, mb_file_path, mb_span,
                                   mb_ignore, mb_check_sleep));

!MIL    -MEMBUSTER              < P:PWM t:0x2aab2450 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180
!MIL    -MEMBUSTER              < P:STM t:0x2aab2310 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180
!MIL    -MEMBUSTER              < P:SCD t:0x2aab2000 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180
!MIL    -MEMBUSTER              < P:UNKNOWN5 t:0x2aab2000 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180
!MIL    -MEMBUSTER              < P:MW t:0x2aab34f0 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180
!MIL    -MEMBUSTER              < P:CA t:0x2aab2310 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > 
membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180

801    sleep(mb_init_sleep); /* wait 5 minutes before checking allocations */

836                                 mb_ignore);    /* ignore: time in seconds to ignore since  */
837                                                /* startup of the process this helps you    */
838                                                /* ignore the allocations done at startup   */

300+150 = 450 = 7.5 minutes


<to-exclude-other-processes>
// this do not seem to work
# excluded processes - list of space separated names of processes to ignore (membuster will not run on these) ex: 
CA_Process SCD_Process STM_Process STBID_Process

membuster thread for STM_Process started
membuster thread for PWM_Process started
membuster thread for SCD_Process started
membuster thread for APP_Process started

Use instead:

void membuster_plus_init(void)
{
        if( strncmp("APP_Process", mb_process_name, MAX_PROC_NAME) != 0 )
        {
            printf("KT: return since not APP_Process(%s)\n", mb_process_name);
            return;
        }

        stacktrace_init(0);
}



<membuster-output>
MEM_AP.TXT  MEM_CA.TXT  MEM_MW.TXT  MEM_PW.TXT  MEM_SC.TXT  MEM_ST.TXT

<ex>
218996:start check at: 013:20:10.348
219890:OOM Detected at: 013:32:09.086

// first OOM in MEM_xx.TXT
size=25032 (7f4f64 7dcff4 7eefa0 7a15a4 7a2adc 7a3b54 7a5028 7a53c0 79dfd4 79a950 51038c 50ae0c ef52d4 ) [f688c2a7]
allocs:`447`
size=12963 (7c63bc 7dfab8 7dd838 7eefa0 7a15a4 7a2adc 7a3b54 7a5028 7a53c0 79dfd4 79a950 51038c 50ae0c ef52d4 ) [0225da76]
allocs:447


// first OOM in the log
// note: MEMBUSTER log is available for membuster build

269075:NDS: ^[2016:08:21 20:14:30]0946879384.632875 !`WARN`   -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mem_static.c F:MHWMemAllocStatic L:75 > Cannot allocate 2580 bytes in pool " "MW_HTTP_POOL"  
269076:NDS: ^[2016:08:21 20:14:30]0946879384.632891 !WARN   -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mem_static.c F:MHWMemAllocStatic L:78 > Biggest block is 712 bytes 
269077:NDS: ^[2016:08:21 20:14:30]0946879384.635031 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 1 size 520, bt(007aff90 00ef5c30 007afe08 00795b3c 006e1a60 00ef52d4 ) 
...
269217:NDS: ^[2016:08:21 20:14:30]0946879384.903082 !`ERROR`  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, 
  count `504 size 28224`, bt(007f4f64 007dcff4 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 
269218:NDS: ^[2016:08:21 20:14:30]0946879384.929905 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 504 size 14616, bt(007c63bc 007dfab8 007dd838 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 
269219:NDS: ^[2016:08:21 20:14:30]0946879384.951279 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 504 size 86482, bt(007c63bc 007dfab8 007dd864 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 
269220:NDS: ^[2016:08:21 20:14:30]0946879384.992061 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 504 size 2520, bt(007c63bc 007dfab8 007dcf4c 007dd670 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 
269221:NDS: ^[2016:08:21 20:14:31]0946879385.016120 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 504 size 45248, bt(007c63bc 007dfab8 007dcf4c 007dd3f4 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 
269222:NDS: ^[2016:08:21 20:14:31]0946879385.040478 !ERROR  -MEMMAN       		< p:0x000001bb P:MW t:0x01e19520 T:CTM_SVR_DL_CONTENT M:mbuster_pinit.c F:membuster_plus_check_pool L:755 > MEMBUSTER: pool MW_HTTP_POOL, count 504 size 6048, bt(007c63bc 007dfab8 007dcf4c 007dd57c 007eefa0 007a15a4 007a2adc 007a3b54 007a5028 007a53c0 0079dfd4 0079a950 0051038c 0050ae0c 00ef52d4 ) 


WHY not match between 447 and 504?

1462439:OOM Detected at: 032:02:23.066

// this `matches`. this is from normal periodic check but not from OOM check.
size=`28224` (7f4f64 7dcff4 7eefa0 7a15a4 7a2adc 7a3b54 7a5028 7a53c0 79dfd4 79a950 51038c 50ae0c ef52d4 ) [f688c2a7]
allocs:`504`

// next OOM
1700024:OOM Detected at: 043:55:06.053


note: 
* #ifndef MEMBUSTER_OOM_ONLY in the code
* For one alloc, size is start and allocs is end
* `size` is the sum of all allocs in the bt

start check at: 013:47:02.091
OOM Detected at: 013:48:22.102
pool MW_HTTP_POOL size=388036:

allocs:2
size=3216 (bfdc34 118ccb0 bfe4f0 bffd6c 4fd500 4f3714 4e2c38 4e3b20 ef52d4 ) [3e785703]
allocs:268
size=720 (bfdc34 119013c bfe4f0 bffd6c fba6c0 faaff0 fab198 f11544 f2df94 f09cec f15f7c fb4590 5d0f9c 5d1158 5e5498 5dd504 5ad648 ef52d4 ) [061d805b]
allocs:60

`size`=25032 (7f4f64 7dcff4 7eefa0 7a15a4 7a2adc 7a3b54 7a5028 7a53c0 79dfd4 79a950 51038c 50ae0c ef52d4 ) [f688c2a7]
# bt idx, alloc address, `alloc size`, alloc time
252 02542cf8     56 013:16:29.236
...
allocs:447

note:
25032 = 447*56

...
estimated pool usage 6292/8000	# here 'usuage' is the sum of all bt.


$ grep "size=|allocs:447" MEM_MW_1.TXT


<ex>
size=2609 (9a8d70 9af8bc 6045ac 61c638 61cab8 6020f0 9cd48c ) [05d5559a]
020 01251644     23 000:02:30.272
020 01251674     20 000:02:31.084
020 01251ae4     25 000:02:59.060
020 01251b1c     23 000:03:05.768
020 01250294     22 000:03:07.428
allocs:120


// to find out max allocs in OOM section
sed -n '382030,386153p' MEM_MW.TXT | egrep -an 'allocs' | sort -n -t : -k 3

size=10817 (7c8db8 7a6c54 7b1a78 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [616dbc3c]
1270:allocs:373

size=63522 (7c8db8 7a6c54 7b1a98 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [638dbc5c]
1645:allocs:373

size=1865 (7c8db8 7a6c54 7b0fa4 7b19bc 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [7dc0cb9f]
2020:allocs:373

size=32943 (7c8db8 7a6c54 7b0fa4 7b1880 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [68c4ca63]
2395:allocs:373

size=4476 (7c8db8 7a6c54 7b0fa4 7b1934 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [74b8cb17]
2770:allocs:373

size=20888 (7a059c 7b16a0 7b64b8 7c3670 7c4850 7a7524 7986e0 5101d8 50abe8 e91518 ) [d599c377]
893:allocs:373


<between-log-memprofile-membuster>
example analysis between LOG, MEMP and MEMB

(MPROF) # it's the same as MEM uses for its main output
                      # name, peak, used, total, g_count
                      ADPT_GUIDE,    7960,    7448,    8000,     114
                      ADPT_GUIDE,    7960,    7448,    8000,     115
                      
(LOG)                      
NDS: ^[00:58:34]0946688314.070912 !WARN  -MEMMAN       < M:mem_static.c F:MHWMemAllocStatic L:00065 > 
Cannot allocate 44 bytes in pool ADPT_GUIDE, not enough memory
...
F:MemCheckMemory L:00765 > MEMCHECK: Pool size summary:
F:MemCheckMemory L:00767 > MEMCHECK:  free     |      1 blocks [      40]
F:MemCheckMemory L:00769 > MEMCHECK:  static   |     83 blocks [    7960]
F:MemCheckMemory L:00771 > MEMCHECK:  moveable |      0 blocks [       0]

(MEM:changed)
#                 used(free): checksun: alloc: size (back trace) 
BT: ADPT_PLANNER: 1452(4548): 7fe1aa50: 3: 72 (46f570 438ef8 43a210 552c30 551fec 8c35b8 )

# membuster_plus_check_all()
#
# p->initialSize : is pool size
# fprintf(of, "BT: %s: %d(%d): %.8x: %d: %d (", p->name, (p->initialSize - p->s_WholeMem[0].blockPool.totalFreeSize),
#	p->s_WholeMem[0].blockPool.totalFreeSize, b[j].checksum, alloc_count, b[j].size);
#
# changed to print alloc size than bt size itself as alloc size means the size of each allocation in this bt.
#
# fprintf(of, "BT: %s: %d(%d): %.8x: %d: %d (", p->name, (p->initialSize - p->s_WholeMem[0].blockPool.totalFreeSize),
#	p->s_WholeMem[0].blockPool.totalFreeSize, b[j].checksum, alloc_count, `alloc_size`);
#

pool ADPT_PLANNER size=6000: 000:22:44.854
-------
BT: ADPT_PLANNER: 1452(4548): 79dda9c4: 3: 36 (46f4e4 438ef8 43a210 552c30 551fec 8c35b8 )
-------
BT: ADPT_PLANNER: 1452(4548): 7fe1aa50: 3: 72 (46f570 438ef8 43a210 552c30 551fec 8c35b8 )
pool usage: 1452/6000 peak: 1452

# to get data for plot
egrep '7fe1aa50' MEM325.TXT | cut -d':' -f2-3 | sed 's/[\:\(\)]/ /g' | more
echo "set terminal jpeg; set title 'ADPT_PLANNER-1st'; set grid; set output 'ADPT_PLANNER-1st.jpg'; set xlabel 'time'; set ylabel 'memory'; plot \"1stcall.out\" using 3 title 'used', \"1stcall.out\" using 2 title 'free' with lines;" | gnuplot

egrep -an "pool PCAT_VIEW_CLNT_POOL" MEM121.TXT 
egrep -an -B 1 "pool usage" MEM121.TXT | egrep -A 1 "PCAT_VIEW_CLNT_POOL"


membuster_thread
membuster_plus_check_all(, ignore) # time in seconds to ignore since startup of the process. this helps you ignore the allocations done at startup
{
	for(gPoolList[i])
	{
		# for each bt
		for(p->bt_list_idx; bt++)
		{
			#
			set time;

			for(p->alloc_list_idx; al++)
			{
				# find the alloc that matches this bt
				# when this alloc is valid(alloc_list[al].addr != 0) and alloc_list[al].bt_idx == bt and its alloc time > igore then
				get alloc time and list allocs from low to high in time

				/* capture from a run
				al[80].time = 0x3df3b < tlo = 0xffffffff
				al[80].time = 0x3df3b > thi = 0x0
				span 138 3df3b 3df3b 0
				# set hi and lo with the first
				al[84].time = 0x3df94 < tlo = 0xffffffff
				al[84].time = 0x3df94 > thi = 0x0
				# set hi with others
				al[86].time = 0x3dffa > thi = 0x3df94
				al[88].time = 0x3e060 > thi = 0x3dffa
				# so get hi and lo between alloc lists
				span 139 3e060 3df94 204
				al[85].time = 0x3dfaf < tlo = 0xffffffff
				al[85].time = 0x3dfaf > thi = 0x0
				al[87].time = 0x3e00a > thi = 0x3dfaf
				span 140 3e00a 3dfaf 91				
				*/
			}

			# so get time span for allocs and means that want to see allocs that lasts for more than span time. 
			tspan = thi - tlo;

			if((tspan / 1000) >= span)
			{
				# print pool name and size
				# print selected bt data
				# loop alloc list and print alloc lists that belongs(matches) to this bt. note that it prints out in no order in time.
			}
		} # end of bt loop

		# print pool usuage and peak
		usage = (p->initialSize - p->s_WholeMem[0].blockPool.totalFreeSize)

	} # end of pool loop
}

# run on one pool that OOM happens.
#
membuster_plus_check_pool(*p)
{
	# loop through all bt_list in this pool
	for(j=0; j < p->bt_list_idx; j++)
		# loop throuth alloc list and print out allocs belongs to this bt_list if there are.
		# so there are bt_lists that don't have allocs.
		for(x=0; x < p->alloc_list_idx; x++)	
		   if(a[x].bt_index == j)
		
		pool_usage +=  bt_list[j].size;

	# print out usage and initial size
	pool_usage, p->initialSize
}


<comp-diag>
static void membuster_plus_check_all(char* filename);
KIT(/mnt/nds/dev_6/part_0/FSN_DATA/MEM_MW.TXT), start check at: 000:12:10.097

NDS: ^[2016:08:30 09:12:44]0946685156.922346 !MIL    -MEMBUSTER                 < p:0x0000019c P:PWM t:0x2aab2450 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /
flash0/fs/NDS, 300, 150, 180

note:
 201:NDS: ^[2016:08:30 11:19:56]!MIL    -MEMBUSTER    		< P:CA t:0x2aab2310 T:no name M:mbuster_pinit.c F:membuster_plus_init L:224 > membuster default config: 300, 1, /flash0/fs/NDS, 300, 150, 180 
 202:NDS: ^[2016:08:30 11:19:56]!MIL    -MEMBUSTER    		< P:CA t:0x2aab2310 T:no name M:mbuster_pinit.c F:membuster_plus_init L:267 > membuster opening process /NDS/bin/CA_Process for analysis 

From start, default file path is /flash0/fs/NDS/ and suddenly changes to
/mnt/nds/dev_6/part_0/FSN_DATA/ when starts a thread from each process. HOW?

3952:NDS: ^[2016:08:30 11:24:54]!MIL    -MEMBUSTER    		< P:STM t:0x2ad9b530 T:no name M:mbuster_pinit.c F:membuster_thread L:809 > membuster thread for STM_Process started 
3953:NDS: ^[2016:08:30 11:24:54]!MIL    -MEMBUSTER    		< P:STM t:0x2ad9b530 T:no name M:mbuster_pinit.c F:membuster_thread L:824 > Path used for membuster logs : /mnt/nds/dev_6/part_0/FSN_DATA 

This works since

-sh-3.2# cat /tmp/diag
/mnt/nds/dev_6/part_0/FSN_DATA

    if( config_read == 0 )
    {
        fh = fopen("/tmp/diag", "r");
        if ( fh == NULL )
        {
            MEMBUSTER_PRINT_W(("Path for membuster logs doesn't found in /tmp/diag! Using default path %s", mb_file_path));
        }
        else
        {
            memset(&mb_file_path[0], 0U, MAX_PATH_NAME);
            fscanf(fh, "%s", mb_file_path);
            MEMBUSTER_PRINT_M(("Path used for membuster logs : %s", mb_file_path));
            fclose(fh);
        }
    }

CMS_SYSTEM_INFRASTRUCTURE/DIAG/src/common/src/diag_cmn_log_management.c
	/* in the config file, for the data partition, the user can either use the exact path or the string "data partition".
	 * in that case, check in /tmp/diag what is the mount point of the data partition
	 */

CMS_SYSTEM_RESOURCE/PDM/src/server/inc/pdm_srv_fs_support.h
#define PDM_FS_DIAG_LINK "/tmp/diag"

PDM_FS_DIAG_LINK 1727 CMS_SYSTEM_RESOURCE/PDM/src/server/fs/pdm_srv_fs_support.c                     
PDM_FS_WriteMntPointToFile((const uint8_t *)g_pdm_fs_diagDir, PDM_FS_DIAG_LINK,false);


<comp-membuster-script>

http://theyard.cisco.com/si_logs/translation/darwin_0019fb44075d_13341d2a2d8eaaea9b2c6fd3b7955fd5/membuster_report/APP_systemstring.html

note: some cases, it tops the call trace at top which keeps increasing but not
always. script issue?

To decode all traces please run from within the log directory and reload this page
/home/si_logs/bin/log_analysis_scripts/mem_leak_check.py ethan

scp si_logs@theyard:/home/si_logs/translation/darwin_0019fb1a2bde_af0149021502c80a7abe76520d14efd1/unstripped_processes/APP_* .

// on the yard
mips-uclibc-addr2line -C -f -s -e ./unstripped_processes/APP_Process 

// brcm-gcc, on the build
~/STB_SW/FUSIONOS_2/BLD_AMS_BCM_MIPS4K_LNUX_DARWIN_01/platform_cfg/linux/compiler/mips4k_gcc_x86_linux_hound_2/bin/mips-uclibc-addr2line -C -f -s -e


<comp-membuster-from-user>
SYSTEM_STATUS MEMMAN_API_MemoryPoolCreateP(MEMMAN_API_MemoryPoolHandle **pool,
                                           char *name, uint32_t flags, void *baseAddr,
                                           uint32_t initialSize, uint32_t chunkSize,
                                           uint32_t `maxSize`)
{

  status = PoolCreate(&poolHandle, poolName, flags, baseAddr, initialSize, chunkSize, `maxSize`);
  *pool = poolHandle;
}


static SYSTEM_STATUS PoolCreate(MEMMAN_API_MemoryPoolHandle **handle, char *name, uint32_t flags,
                          void *baseAddr, uint32_t initialSize, uint32_t chunkSize, uint32_t maxSize)
{
  // poolHandle has housekeeping structure about a pool
  poolHandle = (MEMMAN_API_MemoryPoolHandle *) `malloc`(sizeof(MEMMAN_API_MemoryPoolHandle));

#ifdef MEMMAN_MEMBUSTER
  // alloc membuster structures
  poolHandle->alloc_list = `malloc`(sizeof(ALLOC_LIST) * ALLOC_LIST_INIT_SIZE);
  // ... 
#endif /* MEMBUSTER */
}


// instrumented memman ifs

MEMMAN_API_Handle *MEMMAN_API_AllocP(MEMMAN_API_MemoryPoolHandle *pool, uint32_t size, int32_t gcollect)
void   *MEMMAN_API_AllocStaticP(MEMMAN_API_MemoryPoolHandle * pool, uint32_t size)        
void   *MEMMAN_API_CallocStaticP(MEMMAN_API_MemoryPoolHandle * pool, uint32_t nbelem, uint32_t size)
void   *MEMMAN_API_AllocStaticAlignP(MEMMAN_API_MemoryPoolHandle * pool, uint32_t size, uint32_t align)
void   *MEMMAN_API_AllocMaxStaticP(MEMMAN_API_MemoryPoolHandle * pool, uint32_t * paramsize)
void   *MEMMAN_API_ReallocStaticP(MEMMAN_API_MemoryPoolHandle * pool, void *ptr, uint32_t askedSize)
void   *MEMMAN_API_ReallocStaticAlignP(MEMMAN_API_MemoryPoolHandle * pool, void *ptr, uint32_t askedSize, uint32_t align)
{
  //  alloc calls
  ptr = (void *) MHWMemAllocStatic(pool, size);

  // CMS_SYSTEM_INFRASTRUCTURE/MEMMAN/src/mbuster_pinit.c
  // add list
  // alloc_list_add(MEMMAN_API_MemoryPoolHandle *pool, uint32_t addr, uint32_t size, uint32_t type)
  alloc_list_add(pool, (uint32_t)ptr, size, ALLOC_TYPE_MV);
  {
    // struct stacktrace_frame f;
    // 	struct stacktrace_frame
    // 	{
    // 	  int             size;       /* Frame size */
    // 	  uint32_t *      fp;         /* Frame pointer */
    // 	  uint32_t *      pc;         /* Program counter */
    // 	  uint32_t *      func;       /* Start of current function */
    // 	  uint32_t *      caller;     /* Address of caller */
    // 	};

    // this is the very first function
    // as it's already in the called frame, sp was moved and ra has return addr.
    //
    // *nolinine*
    // int __attribute__ ((noinline)) stacktrace_start(struct stacktrace_frame *f)

    // starts from 0 which means i represent num of calls in bt_temp
    i = 0;

    stacktrace_start(&f);
    {
      // set f for current function frame
      {
        // run asm code to get sp and ra to the caller
        /* __builtin_frame_address(0) doesn't appear work with -fomit-frame-pointer */
        /* so we get the stack pointer and hope it's not been trashed */
        f->fp     = $sp;
        f->caller = $ra;
        f->func   = stacktrace_start;

        // note: use 25 bits address and 4K page in the jump table. Starts from
        // the -1 from the jump table due to how jump table is constructed and
        // get the symbol index.
        //
        // >>> bin(0x1FFF000) '0b1111111111111000000000000'

        // note: -1 again
        i = jump_table[(((uint32_t)(f->func) & 0x1FFF000) >> 12)-1];

        // to get a nearest addres in the sym table
        while((uint32_t)(f->func) >= symbols[i])
        {
          i++;
        }

        // to get a frame size but use -1 since use estimation.
        f->size = frame_info[info_index[i-1]] & 0xFFFF;
      }

      // get the caller from the current
      {
        /* Unwind frame - below if statement is on purpose, as it prevents 
           a nasty optimization that breaks unwinding*/
        i = stacktrace_unwind(f);
      }

      if(i == -1)return -1;
      else return 0;
    }

    // note: now current f->caller is `alloc_list_add`

    // build a backtrace(bt) of this call from a user into bt_temp array
    while(stacktrace_unwind(&f) != -1)
    {
      pool->bt_temp[i++] = f.caller;
    }

    // calculate a checksum of bt_temp, that is a whole bt
    checksum = fletcher32(pool->bt_temp, i);

    // get a idx of next free alloc slot from the alloc list array
    `idx` = get_alloc_index(pool);

    // get a idx of bt which matches to checksum from the bt list and if not
    // found one and which means new one, call bt_add
    `bt_idx` = bt_find(pool, checksum);
    if(bt_idx==-1)
    {
      // note: i is number of calls in the bt_temp
      bt_idx = bt_add(pool, pool->bt_temp, i, checksum);
      { 
        // get a next free index of bt_list
        idx = pool->bt_list_idx++; 

        // set bt_list
        pool->bt_list[idx].len      = len;
        pool->bt_list[idx].checksum = checksum;
        pool->bt_list[idx].pos      = pool->bt_data_idx;

        // bt_data[] = bt_temp
        memcpy(&(pool->bt_data[pool->bt_data_idx]), bt, len * sizeof(uint32_t));
        pool->bt_data_idx += len;

        return idx;
      }

      pool->bt_list[bt_idx].size = 0;
    }

    //
    pool->alloc_list[idx].addr = ptr;                  // allocated ptr from memman	
    pool->alloc_list[idx].size = size;                 // allocated size
    pool->alloc_list[idx].bt_index = (uint16_t)bt_idx; // idx of this bt
    pool->alloc_list[idx].type = type;                 // allocated type
    pool->alloc_list[idx].time = time_get();
    pool->bt_list[bt_idx].size += size;                // accumulated size for this bt
  } // end alloc_list_add
}


={============================================================================
|kt_dev_si_0001| comp-memprof

in si_devel, didn't worked well even if used --memprof in build command. worked well with trial build.

sits on \build\processes\common\ and each process add this thread depending on MEMPROF comp flag.

for example, app_process_main.c has:

int main()
{

#ifdef MEMPROF
            memprof_init(); # sleep(60)
#endif
}	

	/* output filename*/
	sprintf(memprof_fname, "/mnt/nds/dev_5/part_0/FSN_DATA/MPROF%d.TXT", mb_pid);


this has only two files which create one thread to call MEMMAM api to print out all pools for every sleep(60).

(MPROF*.txt)
                        poolname,    peak, current,    size
               ALARM_MEMORY_POOL,   28016,   28016,   30720
                 BEM_SERVER_POOL,   48708,   48508,   52000
(*.map)
ADPT_GUIDE 928 736 8000

so 4 is size, 3 is current, and 2 is peak


plotmemprof.sh

# no need to run the below as can plot using a raw text
grep " ${eachpool}," ${filesinmprof} | sed 's/ //g' | sed 's/,/ /g' > ${mapfile}
grep "PCAT_VIEW_CLNT_POOL," MPROF336.TXT | sed 's/ //g' | sed 's/,/ /g' > out.txt

# out.txt
ADPT_PLANNER 872 696 6000
ADPT_PLANNER 1300 1300 6000
ADPT_PLANNER 1300 696 6000


# set range
echo "set terminal jpeg; set title 'PCAT'; set grid; set output 'PCAT.jpg'; set xlabel 'time'; set ylabel 'memory'; set xrange [1071:1100]; plot \"out-pcat.txt\" using 4 title 'size', \"out-pcat.txt\" using 3 title 'current', \"out-pcat.txt\" using 2 title 'peak' with lines;" | gnuplot

echo "set terminal jpeg; set title 'ADPT_GUIDE 8K'; set grid; set output 'ADPT_GUIDE.jpg'; set xlabel 'time'; set ylabel 'memory'; plot \"out.txt\" using 4 title 'size', \"out.txt\" using 3 title 'current', \"out.txt\" using 2 title 'peak' with lines;" | gnuplot


# MPROFMWS.CSV
# See FSI_UA_CMD_PoolsUsage_Callback and FSI_UA_ServerCommand_PoolsUsage_Client: FSI_UA_POOLSUSAGE_CSVFILE_HEADER
#
#1               #2(free)           #3                  #4                         #5 (peek)
Memory_pool_name free_size_in_bytes total_size_in_bytes block_header_size_in_bytes max_allocated_in_bytes
systemobject     24464              51200               20                         51140


={============================================================================
|kt_dev_si_0001| comp-time


/**
 * @brief Gets the UTC time from the RTC device.
 * @param[out] utc_time UTC date/time retrieved from the RTC device.
 *
 * @retval #SYSTEMTIME_STATUS_OK on success.
 * @retval #SYSTEMTIME_STATUS_TIME_NOT_AVAILABLE if there is no RTC device.
 * @retval #SYSTEMTIME_STATUS_IO_ERROR if there was an internal IO error.
 */
static SYSTEM_STATUS SYSTEMTIME_RTCGetClock(uint32_t *utc_time)
{
  (ioctl(fd, RTC_GET_CLOCK, &rtc_value) == -1)

    /* Check if the UTC time is in a valid range (year 1970-2100).
       This is already checked by the following function. */
    status = SYSTEMTIME_ConvertRTCValueToTimeDate(rtc_value, utc_time);
}


/**
 * @brief Gets the time values for use by SYSTEMTIME_GetTime and SYSTEMTIME_GetTimeMillis
 * @param[out] systemtime The current date/time without time zone or daylight saving offsets.
 * @param[out] milliseconds The associated milliseconds value.
 */
SYSTEM_STATUS SYSTEMTIME_GetTimeVals(SYSTEMTIME_TIMEDATE *systemtime, uint32_t *milliseconds)
{
    SYSTEMTIME_TIME_OFFSETS offsets;
    struct timespec         ts;
    int                     res;
    SYSTEM_STATUS           gettime_status = SYSTEMTIME_STATUS_OK;
    uint32_t                utc;

    ST_LOG_FN_ENTRY("SYSTEMTIME_GetTimeVals");

    gettime_status = SYSTEMTIME_GetTimeOffsets(&offsets);
    if (gettime_status != SYSTEMTIME_STATUS_OK)
    {
            status = SYSTEMTIME_RTCGetClock(&utc);

            {
                *systemtime = (SYSTEMTIME_TIMEDATE)utc;
                *milliseconds = 0U;
            }
    }
    else
    {
        res = clock_gettime(CLOCK_REALTIME, &ts);
        {
            *systemtime = (SYSTEMTIME_TIMEDATE)ts.tv_sec;
            *systemtime += (SYSTEMTIME_TIMEDATE)offsets.offset;
            *milliseconds = (uint32_t)ts.tv_nsec / SYSTEMTIME_NSEC_PER_MILLISEC; /* Convert to milliseconds */
        }
    }

    return status;
}


={============================================================================
|kt_dev_si_0001| comp-timedoctor

-sh-3.2# cat /proc/timedoctor-status
TD state: running
wrap    : on
task log: on
ioctl filter : off
buf count: 131072

-sh-3.2# ls /proc/timedoctor*
/proc/timedoctor             /proc/timedoctor-data        /proc/timedoctor-helper      /proc/timedoctor-irq-filter  /proc/timedoctor-status


<on-off>
To `start` the timedoctor logging:
echo "on" > /proc/timedoctor

To stop the timedoctor logging
echo "off" > /proc/timedoctor

Enable 'wrapping' of the memory pool
echo wrapon > /proc/timedoctor

Disable 'wrapping'
echo wrapoff > /proc/timedoctor


<enable-from-source>
http://ndpedia.uk.nds.com/index.php/TimeDoctor_STB_Operational_Instructions
Calling the TimeDoctor process via Test Code

One of the simpilest methods of instigating TimeDoctor is through the use of
the following macros, either directly in the file you wish to monitor or in a
file common file (e.g. System_common.h) Prerequisite

The following includes are recomended (if not already included):

#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>

Note: Currently these do not need to be added to System_common.c (and will
    most likley cause problems if you do)

Macros
#define SYSCOM_START_TD() do{int tfd; tfd = open("/proc/timedoctor",O_RDWR); write(tfd, "reset\n",strlen("reset\n")); usleep(250); write(tfd, "wrapoff\n",strlen("wrapoff\n")); write(tfd, "on\n",strlen("on\n")); close(tfd); }while(0)

#define SYSCOM_STOP_TD()  do{int tfd; tfd = open("/proc/timedoctor",O_RDWR); write(tfd, "off\n",strlen("off\n")); close(tfd); }while(0)

Usage

Turn Timedoctor on
SYSCOM_START_TD();

Note: "wrapoff" can be replaced with "wrapon" to turn wrapping on

Turn Timedoctor off
SYSCOM_STOP_TD();

Note: 
Starting timedoctor from the source code for recent baselines will not work
  because of timedoctor control files ownership/permissions.  Timedoctor
  should be started under root, but the middleware is running as a NDS_MW
  user, therefore it is not able to open these files in "write" mode. When
  timedoctor is enabled in kernel, a new device is created: -rw-r--r-- 1 root
  root 0 Jan 1 01:40 /dev/timedoctor Since NDS MW runs not in root mode, it
  can not write to this device or to the: -rw-r--r-- 1 root root 0 Jan 1 01:40
  /proc/timedoctor

The workaround is to make this files “group-writable” from NDS build_mw_epg.sh
after bootlog UPLOAD section the following commands should be inserted:

   echo 'mknod /dev/timedoctor c 10 63'
   echo 'sleep 5'
   echo 'chmod 0666 /dev/timedoctor'
   echo 'echo "reset" > /proc/timedoctor'
   echo 'sleep 1'
   echo 'echo "wrapon" > /proc/timedoctor'
   echo 'sleep 1'
   echo 'echo "on" > /proc/timedoctor'
   echo 'sleep 1'
   echo 'chmod 0666 /proc/timedoctor'
   echo 'sleep 1'

This will make the timedoctor control files “writable” from NDS_MW processes
and kick-off the timedoctor. 


<flag>
http://ndpedia.uk.nds.com/index.php/TimeDoctor_Flags
TimeDoctor Flags
To track individual code points TimeDoctor Flags can be used. 

Prerequisite

You will need to include the TimeDoctor header file:

FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/timedoctor/timedoctor.h

Initialisation

Before you call code to access the flag functionality in TimeDoctor you will
need to enable the driver node. This should called in the SCD Process thus:

system("mknod /dev/timedoctor c 10 63");

This will need to be placed in your source at the appropriate place before you
  code attempts to open the TimeDoctor device, for example after
  DIAG_DECLARE_FUNCTION in Main.c.  
  
Setting a Flag

An example of how to place flags into your code is shown below where:

    "flag_group" is the name of the group of flags (4 characters max). All
    flags of the same group will be displayed on the same line

    "flag_number" is the number of the flag that will appear when you move
    over with the mouse on the flag 

#include <sys/types.h>
#include <sys/ioctl.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>

#include
    "../../../FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/SPK/ams-drx890-debug/project_build_mips/ams-drx890/linux-2.6.18.8/include/linux/timedoctor.h"

static void TDFlag(char* flag_group /* max 4 chars*/, uint32_t flag_number)
{
   int timeDoctor = -1;
   unsigned int tddata[TIMEDOCTOR_INFO_DATASIZE];
  
   timeDoctor = open("/dev/timedoctor", O_RDWR);
   if(timeDoctor == -1) {
       printf("Error: Can't open /dev/timedoctor\n");
   }
   else
   {
      tddata[0] = TDI_COMMAND(TD_CMD_GENERIC, TD_TYPE_EVENT);
      tddata[1] = CHAR_ARRAY_TO_U32(flag_group);
      tddata[2] = flag_number;
      ioctl(timeDoctor, TIMEDOCTOR_IOCTL_INFO, tddata);
      close(timeDoctor);
   }
}

At the point the above function is called in your code a execution point flag will be generated in the TimeDoctor log.

You can also use the following convenience macros:

TD_START_EVENT(id, nam)      //Where id is a 16 bit unique value & nam is up to 8 char human readable name
TD_STOP_EVENT(id, nam)       //Where id is a 16 bit unique value & nam is up to 8 char human readable name
TD_GENERIC(id, nam)          //Where id is a 16 bit unique value & nam is up to 8 char human readable name
TD_VALUE_COUNT(id, nam, val) //Where id is a 16 bit unique value, nam is up to
  4 char human readable name and val is a 32 bit integer value which will be
  displayed when you mouse hover over the flag in the visualiser tool


note:
This "id" means "interrupts"?

http://hetty.cisco.com/fusionmadesimple/index.php/TimeDoctor

Timedoctor flags are the markers in the functions to be monitored. If a flag
is added to a function, the timedoctor trace will show the duration for which
the function was executed.

On BSKYB, timedoctor macros are implemented in the following file:
vobs\FUSION_SYSTEM_INTEGRATION\BSKYB_INTEGRATION\build\tools\nds\si\timedoctor\timedoctor.h

Add following macro to timedoctor.h:

#define TD_EVENT(id, nam)			\
 do { \
   uint32_t data[TIMEDOCTOR_INFO_DATASIZE]; \
   if (g_timeDoctor_fd != -1) { \
     data[0] = TDI_COMMAND(TDI_GENERIC, TDI_EVENT) | ((unsigned int)(id) & 0xffff); \
     data[2] = CHAR_ARRAY_TO_U32(nam); \
     data[1] = CHAR2_ARRAY_TO_U32(nam); \
     ioctl(g_timeDoctor_fd, TIMEDOCTOR_IOCTL_INFO, data); \
   } \
 } while(0)

To add the timedoctor flags, following code changes need to be made to each
\<source\>.c :

    #include "../../../FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/timedoctor/timedoctor.h"

    In the init function in that source file, call TD_INIT macro (to open the
        timedoctor device)

    In the function to monitor, add following macro call:

TD_EVENT(<id>, <name>);

The id should be unique per flag (If driver team is adding flags in CDI,
    please make sure they are not using same range of ids) The name should be
unique per flag. The name should be max 8 characters long. 


<interrupts>
TimeDoctor Interrupts

To view intrupt names, whilst the STB is still running enter the following
command: cat /proc/interrupts

-sh-3.2# cat /proc/interrupts
           CPU0
  1:          0          <NULL>  hif_cpu_int
  2:        408          <NULL>  dmx_status_int
  3:          0          <NULL>  dmx_overflow_int
  4:     754489          <NULL>  dmx_message_int
  5:   14477032          <NULL>  dmx_icam_int
  6:         65          <NULL>  cpu_bsp_int
  7:          0          <NULL>  cpu_aio_int
  8:    1829948          <NULL>  video_gfx_int
  9:      33607          <NULL>  video_hdmi_int
 10:        317          <NULL>  cpu_rptd_int
 11:    7618915          <NULL>  video_vec_int
 12:          0          <NULL>  disp_bvnb_int
 13:   15282353          <NULL>  disp_bvnf0_int
 14:          0          <NULL>  disp_bvnf1_int
 15:          0          <NULL>  disp_bvnf2_int
 16:    3258249          <NULL>  eth0
 18:         25          <NULL>  upg_timer_int
 19:      19423          <NULL>  upg_main_int, lnb, serial
 20:     867496          <NULL>  upg_bsc_int
 21:          0          <NULL>  upg_spi_int
 23:          0          <NULL>  upg_sc_int
 25:          0          <NULL>  upg_uhf1_int
 26:        148          <NULL>  7335_sds0_1
 31:    7641463          <NULL>  cpu_ethernet_int
 32:        463          <NULL>  xpt_rav_int
 36:    1568126          <NULL>  7335_sds1_0
 42:    1302158          <NULL>  libata
 55:    1519956          <NULL>  7335_sds0_0
 57:          0          <NULL>  ehci_hcd:usb2
 59:         23          <NULL>  xpt_pcr_int
 60:          0          <NULL>  xpt_fe_int
 61:          0          <NULL>  msg_stat_int
 62:          0          <NULL>  ehci_hcd:usb1
 68:      34159          <NULL>  7335_sds1_1
 69:          0          <NULL>  7335_qpsk_0
 70:          0          <NULL>  7335_qpsk_1
 71:         26          <NULL>  7335_fec
 72:         32          <NULL>  7335_fec
 97:  152855411          <NULL>  timer
102:          0   BCM MIPS PERF  Perfcounter

ERR:          0
-sh-3.2#


<capture>
Capture TimeDoctor logs

When you have completed your test and turned logging off you should capture
timedoctor data to a file. There are two ways of doing this:

1) cat /proc/timedoctor > my_td_log.td 

# You can then copy this file my_td_log.td to you host machine where it can be
# converted to an analysis file.

2) cat /proc/timedoctor-data > my_td_log.tdi 

# You can then copy this file to your host and view it directly in the Time
# Doctor visualiser

The `second option` seems to be quicker and render better for BSKYB builds.

<process>
Process the Timedoctor log

This is required if you used option 1 above and is done on the host using the
perl script log2tdi to convert the timedoctor log (td) file to a tdi file
acceptable to the Timedoctor Analysis

perl log2tdi my_td_log.td > my_td_log.tdi
https://sourceforge.net/p/timedoctor/tdlogger/ci/master/tree/log2tdi

TimeDoctor Analyser for Windows

The GUI analayser (Microsoft Windows) is avaiable for viewing TimeDoctor
(.tdi) files and can be downloaded from the Timedoctor Source Forge site:
http://sourceforge.net/projects/timedoctor/ 


<code>
// note: not used since $TIMEDOCTOR is not set for any builds
//
// // from FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/build_mw_epg.sh
//   #------------------------------------------------------------------------------------
//   # copy timedoctor script
//   #------------------------------------------------------------------------------------
//   if [ -n "$TIMEDOCTOR" ]; then
//     mkdir -p nds-mw/usr/bin
//     cp tools/nds/si/timedoctor/timedoctor_monitor.sh nds-mw/usr/bin/
//     chmod +x nds-mw/usr/bin/timedoctor_monitor.sh
//   fi
//
//   // when makes a starup script /etc/start-mw.sh
//       if [ -n "$TIMEDOCTOR" ]; then
//         # Enable timedoctor and timedoctor monitor
//         echo 'echo "wrapon" > /proc/timedoctor'
//         echo 'echo "on" > /proc/timedoctor'
//         echo '/usr/bin/timedoctor_monitor.sh &'
//       fi

//FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/bootlog/bootlog-kernel-config.sh

if [ "${DEBUG_BUILD}" == "drx890" ]; then
    # Enable 'save last kernel log to HDD on kernel panic' feature
    if [ -e /proc/kpanic_log ] ; then
        echo "on ${FSN_DATAPATH}" > /proc/kpanic_log
    fi
    # Enable 'save TD log to HDD on special remote key press [444] events' feature
    if [ -e /proc/td_log ] && [ -e /proc/timedoctor ] ; then
        echo "on" > /proc/timedoctor
        echo "on ${FSN_DATAPATH}" > /proc/td_log
    fi
fi


// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/tools/nds/si/timedoctor/timedoctor_monitor.sh
while true ;
do
  sleep 5
  if [ -f $HELP_KEY_FILE -o -f $TRIGGER_FILE ] ;    # note:
  then
    echo "off" > /proc/timedoctor
    echo `date +%s` ": trigger detected" >> $TRIGGER_LOG


    # TD01.LOG. WHY?
    # OUTPUT_FILE_BASE=${FSN_DATAPATH}/TDOC
    # OUTPUT_FILE_EXT=.LOG
    # let OUTPUT_FILE_NUMBER=0
    
    OUTPUT_FILE=${OUTPUT_FILE_BASE}${OUTPUT_FILE_NUMBER}${OUTPUT_FILE_EXT}
    
    rm -f $OUTPUT_FILE
    cat /proc/timedoctor-data > $OUTPUT_FILE
    echo `date +%s` ": $OUTPUT_FILE created" >> $TRIGGER_LOG

    echo "on" > /proc/timedoctor

    # limit how often we can copy to allow the box to recover
    sleep 30

    rm -f $HELP_KEY_FILE
    rm -f $TRIGGER_FILE

    let OUTPUT_FILE_NUMBER++

    echo `date +%s` ": waiting for next trigger" >> $TRIGGER_LOG
  fi
done


// FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/processes/APP_Process/app_process_main.c

#define USER_INPUT_KEY_HELP                  (0xE009U)

#ifdef TIMEDOCTOR
/* We are using a feature of AEM in a way it was not originally intended to call
   a function whenever the HELP key is pressed. This writes the file /tmp/help_key_pressed.
   A Bash script on the system called timedoctor_monitor.sh can detect this file and
   then trigger timedoctor. */

void timedoctor_init(void)
{
    AEM_API_SetDebugKeyCode(USER_INPUT_KEY_HELP);
    AEM_API_SetDebugAction(timedoctor_function);
}

void timedoctor_function(GFX_INPUT_Event* event)
{
    int fd = -1;
    fd = open("/tmp/help_key_pressed", O_RDWR | O_CREAT);
    close(fd);
}
#endif /* TIMEDOCTOR */


<444>
444 TD trace dump is done from the drivers when the particular key pattern is met. 

<4>[0946728276.692273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is DOWN
<4>[0946728275.861274]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is UP
<4>[0946728277.357273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is DOWN
<4>[0946728277.525273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is UP
<4>[0946728276.806274]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is DOWN
<5>[0946728276.809274][`TimeDoctor`] stopped
<4>[0946728276.850274]
<4>[0946728276.850274][TimeDoctor] logging /mnt/nds/dev_6/part_0/FSN_DATA/TD01.LOG
<4>[0946728278.121273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is UP
<4>[0946728278.625273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is DOWN
<4>[0946728277.938274]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is UP
<4>[0946728279.259273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is DOWN
<4>[0946728279.574273]<<< Remote Key >>> key 0xe304 ( USER_INPUT_KEY_NUMERIC_FOUR ) is UP
<4>[0946728281.783274]
<4>[0946728281.783274][TimeDoctor] logged:3122988
<3>[0946728281.783274]VFS: Close: file count is 0
<5>[0946728281.783274][TimeDoctor] running


<trace-ioctl>
Yes, It will turn on all the ioctl calls. 

echo ioctl A,a > /proc/timedoctor

<td_log>
whenever run this, driver creates TD0?.LOG where starting from 0 and keeps
this numbering even if deletes files.

Once we trigger it using the proc/td_log”, then it will just dump the current
active timedoctor buffer to the disks and stop dumping after that. 

echo log > /proc/td_log


={============================================================================
|kt_dev_si_0001| comp-ofs

COMPONENT_NAME := OFS

OFS, which acts as NCM proxy for the Legacy Application Engine in WP 655. In WP 547, the LAE calls NCM directly.
OFS provides a RAM based file system which clients can use for data storage and retrieval.

# appears that APP and LAE are users of this comp.
# dir name is given by the app so if see these errors then may suggest something wrong in the app?
#
natRamfsApiOpenDir
	OFS_RAMFS_JAVA_OpenDir
		if(!OFSRamFSPathIsValid())
		# !ERROR -OFS M:ofs_ramfs.c F:OFS_RAMFS_OpenDir L:01786 > Directory invalid


={============================================================================
|kt_dev_si_0001| comp-mfs

## comp-MFS (vfile, pfile, shrec) : CMS_MEDIA_SERVICES

MFS is the component that implements the TFS abstraction.

shrec(shared recording) si the object that binds a set of vifiles to a pfile.

#define MFS_LOW_SESSION_HANDLE_ILLEGAL (0xFFFFFFFF)

#(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((22 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((4 & 0xF) << 12) | (1 & 0xFFF) ) = 0x2010013

# MSM_MFS_STATUS_ERROR 	0x5824001(92422145)


={============================================================================
|kt_dev_si_0001| comp-msm

Media Streamer Support - Fusion <MediaStreamerSupport-Fusion@nds.com>

<status>
#define MSM_COMP_ID         ((uint32_t)(22)) /*!< @brief Media Streaming Management */
#define MSM_INDEXER_IF_ID   (3)
#define SEVERITY_SEVERE     ((uint32_t)(0x2))

#(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )


0x5802000 (92282880) `MSM_DEVICEMAN_STATUS_OK`
hex(((22 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((2 & 0xF) << 12) | (0 & 0xFFF) )


#define `MSM_INDEXER_STATUS_OK`
0x5803000 (92286976) `MSM_IND_STAT_VAL_OK`
hex(((22 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((3 & 0xF) << 12) | (0 & 0xFFF) )


<msm-handle>
#define `MSM_INDEXER_STATUS_INVALID_INDEX_HANDLE`
  (SYSTEM_MAKE_COMPONENT_STATUS(MSM_COMP_ID, MSM_INDEXER_IF_ID, SEVERITY_SEVERE, `MSM_IND_STAT_VAL_INVALID_INDEX_HANDLE`))
MSM_IND_STAT_VAL_INVALID_INDEX_HANDLE(10)
hex(((22 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((3 & 0xF) << 12) | (10 & 0xFFF) )
'0x582300a'

/** @brief MSM_INDEXER_HANDLE Defines a handle to an index */
typedef uint32_t MSM_INDEXER_HANDLE;

#define MSM_INDEXER_ILLEGAL_HANDLE  (0XFFFFFFFF)  /*!< @brief Illegal handle value for MSM_INDEXER_HANDLE */


0x582300b (92418059) `MSM_IND_STAT_VAL_INDEX_DOES_NOT_EXIST`
hex(((22 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((3 & 0xF) << 12) | (11 & 0xFFF) )

!FATAL -VGV          < T:no name M:p_posix.c F:VGV_VER L:01030 > VGV_StreamDataRead. MSM_INDEXER_OpenIndexByMCMHandleIPC returned ERROR expected  92286976(0x5803000) actual 92418059 (0x582300B)


# MSM_DEVICEMAN
Open -> Create -> Prepare [-> Run -> Stop] -> Free -> Close. Means that Run and Stop can be skipped. 


<msm-pts>
UseVideoDecoderPTS value in MS.CFG
UseVideoDecoderPTS=True

MSCPP::DISPLAY_FILTER::PrepareVideoDecoderCallback
{
  if (UseVideoDecoderPTS == XTRUE)
  { 
    p_display->m_is_video_decoder_support_pts = 
      p_data->data.video_decoder_prepared_data.is_video_decoder_support_pts;
  }
  else
  {
    p_display->m_is_video_decoder_support_pts = XFALSE;
  }
}

// CMS_MEDIA_SERVICES/Media_Streamer/proj_specific/fusion2/src/mediastreamer/src/display_chunk.cpp
void DISPLAY_FILTER::HandleChunkInputTPIDMonitorData(const CDISERVER_TPID_DATA *p_tpid_data)
{
  // note: see "FIRST_PTS=true, DISCONTINUITY=false" untils play ends and no
  // discontinuity.
  //
  // FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 967, PTS (0,109018798) 
 
  for (i = 0; i < (int)read_data.numDataBlocksReturned; i++)
  {
    /* st compiler does like macros with more than 10 lines */
    XDEBUG_TRACE1_6("-MS_CDI_CONTROL- FIRST_PTS=%s, DISCONTINUITY=%s pid %d, chunklist ID %d, PTS (%ld,%lu)",
        (((unsigned) p_tpid_data->data_blocks_array[i].eventDescriptor & 
          DEMUX_CHUNKINPUT_CHUNK_FIRST_PTS_INDICATOR) ? "true" : "false"),
        (((unsigned) p_tpid_data->data_blocks_array[i].eventDescriptor & 
          DEMUX_CHUNKINPUT_CHUNK_PTS_DISCONTINUITY_INDICATOR) ? "true" : "false"),
        p_tpid_data->data_blocks_array[i].tpid,
        p_tpid_data->data_blocks_array[i].chunkListID,
        p_tpid_data->data_blocks_array[i].data[0],
        p_tpid_data->data_blocks_array[i].data[1]);
  }

  CheckPTSFromDrivers();
}


void MSCPP::DISPLAY_FILTER::GetPosition (_in_ GET_POSITION_METHOD method,
  _in_ FILTER_GET_POSITION_CALLBACK  	callback)
{
  XDEBUG_DEFINE_FUNC_INFO("GetPosition");

  PTS_SOURCE    pts_source = GetPTSSource(); 

  XDEBUG_TRACE3_0("IN");

  /* remember the callback */
  m_get_pos_callback = callback;

  XDEBUG_TRACE1_1("get position using method %d", method);
  switch (method)
  {
    case E_GET_POS_METHOD_DISPLAYED_PTS:
      /* get pos by pts only */
      CDISERVER_GetPts(ITEM_GetXconnection(m_p_item),
          m_clock_sync_fd,
          m_video_decoder_fd,
          pts_source,
          GetPtsCallbackForUserPosByPts,
          this);
      break;
  }
}

inline PTS_SOURCE MSCPP::DISPLAY_FILTER::GetPTSSource()const 
{
  PTS_SOURCE    pts_source;
  /* pts from the audio decoder is not supported yet, in future when it will be supported it should be added here */
  if ((m_is_video_decoder_support_pts == XTRUE) && (m_is_video_enabled))
  {
    pts_source = E_CDISERVER_PTS_SOURCE_VIDEO_DECODER;
  }
  else
  {
    pts_source = E_CDISERVER_PTS_SOURCE_CLOCK_SYNC;
  }
  return  pts_source;
}


<ms-watchdog>
CDISERVER_GetPts(cdi_server.c)
	send E_REQUEST_TYPE_GET_PTS

// CMS_MEDIA_SERVICES/MSM/src/mediastreamer/src/watchdog.cpp
//
// /** 
//  * @brief Event manager callback. This function is called periodically
//  * it runs over the array, and searches for unfinished operations. An unfinished
//  * operation can be identified by looking at the right-most bit of the
//  * op_start_time field. If this bit is 1, the operation has started and the time
//  * in op_start_time is valid. It then calculates the time that has elapsed
//  * since the operation start time, if the elapsed time is longer than
//  * op_timeout_warning a warning will be printed, if time is longer than
//  * op_timeout_assert an Assert is raised.
//  * 
//  * @param data event manager notification data. Used to decide if this is a
//  * regular timeout, or a registeration cancellation.
//  */
// void WATCHDOG::WatchdogEventMgrCb(EVENTMGR_NFY_DATA data)
//
// note: that there are two types of message. `warn` and `halt`.
// note: ms unit.
// note: it clears timer in EndOp.
//
// !WARN  -MSM_MS < T:EVENT_MGR_THREAD M:watchdog.cpp F:(WatchdogEventMgrCb) L:469 > < no-ctx >" 
// "-MS_WATCHDOG- thread E_MS_PORT_THREAD_TYPE_CDI_WT, " "pid = 488,tid = 26162464, " 
// "called E_REQUEST_TYPE_GET_PTS at time [2045:10:27 04:49:32]1859065371, " "time diff = 136, " "`warn` value 100
//
// ERROR  -MSM_MS < T:EVENT_MGR_THREAD M:watchdog.c F:WatchdogEventMgrCb L:432 > 
// -MS_WATCHDOG- thread E_MS_PORT_THREAD_TYPE_CDI_WT, " "pid = 301, tid = 18155024, " 
// "called E_REQUEST_TYPE_GET_DEMUX_OUTPUT_STATUS at time [2027:09:26 09:55:37]1821952537, " "time diff = 706, " "`halt` value 500 

CdiServerThread(cdi_server.c, 'E_MS_PORT_THREAD_TYPE_CDI_WT' thread name )
{
  /* register the new thread with the watchdog, this needs to be called
     before calling INITERM_ThreadIsUp, because we are relying on the 
     INITERM semaphore to synchronize the calls to WATCHDOG_Register */

  watchdog_handle = WATCHDOG_RegisterThread(
      E_MS_PORT_THREAD_TYPE_CDI_WT,
      WATCHDOG_WARN_TIME_FOR_CDI_SERVER_OP,
      WATCHDOG_ASSERT_TIME_FOR_CDI_SERVER_OP);  // 500

  /* report begin of operation to watchdog */
  WATCHDOG_BeginOp(watchdog_handle, CdiServerRequestToString(req.type));

  case E_REQUEST_TYPE_GET_PTS:

  MS_STATUS HandleGetPts
  {
    switch(pts_source)
    {
      // E_CDISERVER_PTS_SOURCE_VIDEO_DECODER: MS_CDI_PROXY_VideoDecoderGetPts:
      // E_CDISERVER_PTS_SOURCE_CLOCK_SYNC: MS_CDI_PROXY_ClockSyncGetValue:

      XDEBUG_TRACE1_2("-MS_CDI_CONTROL- returning PTS [%u,%u]", pts.high, pts.low);

      // lead to the below

      SYSTEM_STATUS MPM_DEVICE_GetVideoDecoderPTS(MCM_MEDIACONN_HANDLE h_media_connection, PTS * pts)
      {
        MPM_STATUS status = MPM_STATUS_NOT_OK;
        MPM_MEDIA_CONNECTION * p_media_connection;

        DIAG_DECLARE_FUNCTION("MPM_DEVICE_GetVideoDecoderPTS");
        DIAG_LOG_FN_ENTRY(g_MPM_Logging_ID);

        p_media_connection = MPM_MCGetMediaConnection(h_media_connection);

        if (NULL != p_media_connection)
        {
          if (NULL != p_media_connection->p_video_decoder)
          {
            if (p_media_connection->p_video_decoder->supported_formats.decoder_features & VIDEO_DECODER_FEATURE_PTS_AVAILABLE)
            {
              status = MPM_DEVICE_LockDevice(h_media_connection, MPM_DEVICE_DECODE_VIDEO_DECODER);
              if (status == MPM_STATUS_OK)
              {
                /*lint -save -e923    Authorised by S Taylor. See email attached to CQ196440 */

                // CMS_MEDIA_SERVICES/MPM/src/interfaces/mpm_device.c
                //
                // int mpm_ioctl_debug_ioctl_ptr();

                status = `MPM_DEVICE_DoIoctl`(h_media_connection, MPM_DEVICE_DECODE_VIDEO_DECODER, VIDEO_DECODER_GET_PTS, (void *)pts);
                /*lint -restore */

                MPM_DEVICE_UnlockDevice(h_media_connection, MPM_DEVICE_DECODE_VIDEO_DECODER);
              }
            }
            else
            {
              status = MPM_STATUS_NOT_SUPPORTED;
              DIAG_LOG_WARN(g_MPM_Logging_ID, ("hMC=0x%x - video decoder doesn't support getting PTS",h_media_connection));
            }
          }
          else
          {
            status = MPM_STATUS_NO_DEVICE;
            DIAG_LOG_WARN(g_MPM_Logging_ID, ("hMC=0x%x - No video decoder assigned",h_media_connection));
          }
        }

        DIAG_LOG_FN_EXIT(g_MPM_Logging_ID,status);
        return status;
      }
    }
  }

  /* report end of operation to watchdog */
  WATCHDOG_EndOp(watchdog_handle);
}


# print out when playing back
#
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1458528462]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1458528462]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1458532062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1458928062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1459828062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1460728062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1460810862]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1460818062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1461628062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1462528062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1463431662]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1463510862]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1463518062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1464331662]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1465231662]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1466131662]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1466210862]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1466218062]
KT: psrc(1) -MS_CDI_CONTROL- returning PTS [1,1467035262]


# DEST_FINISHED_CONSUMING_DATA
#
NDS: ^[00:05:02]0946685102.219069 !WARN  -MSM_MS       < p:0000023c t:01256dd0 T:EVENT_MGR_THREAD M:display_chunk.cpp F:DecoderMonitorFsm_HandleTimerTicked L:03716 > -MS_DISPLAY- Timer ticked ! Raise DEST_FINISHED_CONSUMING_DATA.

StartDecoderMonitoring
{
  if (MSFeatureUseEofDecodersEvents == XTRUE)
  {
    VIDEO_DECODER_EVENT_NO_FRAME_TO_PRESENT
      AUDIO_DECODER_EVENT_NO_SAMPLES_TO_PLAY
  }
  else
  {
    VIDEO_DECODER_GET_RATE_BUFFER_STATE
  }
}

VIDEO_DECODER_EVENT_NO_FRAME_TO_PRESENT -> E_DISPLAY_DECODER_MONITOR_EV_EVENT_ARRIVED
DecoderMonitorFsm_HandleDecoderEventArrived

DecoderMonitorFsm_SetState

void MSCPP::DISPLAY_FILTER::StepFsm_HandleFrameDecodedEvent()
{
	/*
	  cleanup after frame decoded -
	  decrement num_i_frames_released, report to read FSM...
	*/
	FinishStep(XTRUE);
}

void MSCPP::DISPLAY_FILTER::ContinueToNextStep()
{
	XDEBUG_WARN1_0("-MS_DISPLAY- Missing I-frame in trick modes. "
	   "Raise DEST_FINISHED_CONSUMING_DATA.");
}


#
# write error
#
MSCPP::DISKDEST_FILTER::ReadNeeded

MSCPP::DISKDEST_FILTER::HandleWrite(*p_read_needed_info)
	# no return check on the below call
	PrepareWriteParams
	
	# fs_server.c, thread E_MS_PORT_THREAD_TYPE_FS_WT,
	FS_SERVER_ExtendedWrite(, p_read_needed_info->header.p_src, )
	(thread msg passing)
	HandleExtendedWrite
		PerformWrite(, p_ext_write_params->p_src_buf "write data source buffer", )
		# misleading?
	    # case XTVFS_E_ARGUMENT:
        #        *p_write_stat = E_FSSERVER_STATUS_INVALID_ALIGNMENT;
        #        XDEBUG_ERR1_1("XTVFS_WriteEx failed,returned value:"
	    #	      " E_FSSERVER_STATUS_INVALID_ALIGNMENT\n"
	    #	      ", File handle = %d\n",
	    #		      handle);
        #        break;
		
			XTVFSSTATUS XTVFS_WriteEx(xtvfsFile handle, const char *buffer, int numbytes, int *pNumBytes)
				  bytesWritten = fs_fos_write((int)handle, buffer, numbytes); 
					xdirect_write((int)handle, buffer, (size_t) numbytes))
						DBUG_RETURN(write(fd, (char *)buf, nbyte ) );
			
FileWriteCallback
	E_FSM_EVENT_DISK_WRITE_COMPLETE
	FsmWaitingDiskWriteCompleteState
		HandleWriteDone(p_data->p_fs_response);

PrepareWriteParams:			
NDS: ^[07:46:05]0946712765.356992 !FATAL -MSM_MS       < p:000000bf t:0129dbf0 T:EVENT_MGR_THREAD M:xdebug2diag.c F:PrepareWriteParams L:00148 > ~~~~~~~~~~~~~~~~~~~~ XDEBUG_ASSERT at file=<diskdest.cpp>, func=PrepareWriteParams, line=1274, failed on:(((((uint32_t)(p_read_needed_info->header.p_src))) & (((unsigned)m_disk_required_alignment)-1)) == 0)

#
# this write buffer should be aligned as to XTVFS alignment requiremet. % 511. 
#
PerformWrite::
330080:NDS: ^[07:46:05]0946712765.358190 !ERROR -MSM          < p:000000bf t:01273520 T:FS_WT_THREAD1 M:xtvfspc.c F:XTVFS_WriteEx L:01092 >  XTVFS: 42-To-POSIX: XTVFS_WriteEx: write failed for handle = 429 (buffer = 0x2BE693A4, numbytes = 24064), errno = 22 (Invalid argument), XTVFS status = 33057 !!!!!
330081:NDS: ^[07:46:05]0946712765.358585 !FATAL -MSM_MS       < p:000000bf t:01273520 T:FS_WT_THREAD1 M:fs_server.c F:PerformWrite L:01943 > XTVFS_WriteEx failed,returned value: E_FSSERVER_STATUS_INVALID_ALIGNMENT

HandleWriteDone::
330083:NDS: ^[07:46:05]0946712765.358999 !FATAL -MSM_MS       < p:000000bf t:0129dbf0 T:EVENT_MGR_THREAD M:diskdest.cpp F:HandleWriteDone L:01650 > MS_STATUS_FILE_WRITE_ERROR occured in Diskdest Filter 0x2b01c728
330084:NDS: ^[07:46:05]0946712765.358999 !ERROR -MSM_MS       < p:000000bf t:0129dbf0 T:EVENT_MGR_THREAD M:xdebug2diag.c F:HandleWriteDone L:00164 > ~~~~~~~~~~~~~~~~~~~~ XERR_RAISE at file-<diskdest.cpp>, func=HandleWriteDone, line=1651: err=MS_STATUS_FILE_WRITE_ERROR

void MSCPP::REMUX_FILTER::FsmWaitDataWasReadState
330085:NDS: ^[07:46:05]0946712765.358999 !FATAL -MSM_MS       < p:000000bf t:0129dbf0 T:EVENT_MGR_THREAD M:xdebug2diag.c F:FsmWaitDataWasReadState L:00148 > ~~~~~~~~~~~~~~~~~~~~ XDEBUG_ASSERT_ZERO at file=<remux.cpp>, func=FsmWaitDataWasReadState, line=730, msg=Error in 'Data Was Read'!


# this alignment requirement comes from xtvfs
#
XTVFSSTATUS XTVFS_RequiredAlignment(XULONG *pReqAlign, XULONG *pSectorSize)
{
    XDEBUG_DEFINE_FUNC_INFO("XTVFS_RequiredAlignment");
    CHECK_INIT("XTVFS_RequiredAlignment")

    /* Check function parameters */
    if ( !pReqAlign && !pSectorSize ) {
        XTVFS_POS_DEBUG_ERR_0("XTVFS_RequiredAlignment : wrong parameters: both pReqAlign and pSectorSize are NULL !!!!!\n");
        return XTVFS_E_ARGUMENT;
    }

    if (pSectorSize)
    {
        *pSectorSize = 512U;
    }
    if (pReqAlign)
    {
        *pReqAlign = 511U;
    }

    XTVFS_POS_DEBUG_FULL_4("XTVFS_RequiredAlignment: pSectorSize = %d%s, pReqAlign = %d%s (hardcoded data)\n",
                           pSectorSize ? *pSectorSize : 0, pSectorSize ? "" : " (pSectorSize is NULL)",
                           pReqAlign ? *pReqAlign : 0, pReqAlign ? "" : " (pReqAlign is NULL)");
    return XTVFS_SUCCEED;
}


# when change channels. WriteEx fail.
# 
# (mcm_common.h) MCM_MEDIACONN_TYPE
#define MCM_MEDIACONN_TYPE_RECORDING  0x7000003 (117440515)

MSM_DEVICEMAN_Open(mcm_handle,
		   0,
		   MCM_MEDIACONN_TYPE_PLAYBACK,
		   MslSrvInteractiveCatalog[catalogIdx].playVfileLocator,
		   0);

egrep -an "(VRM_JOB_START:|playService|MSM_DEVICEMAN_Open|MSM_DEVICEMAN_Stop|MS_DEVICEMAN_)"

# more compact
egrep -an "(VRM_JOB_START:|playService|MS_DEVICEMAN_Run|MS_DEVICEMAN_Stop)"

239998:NDS: !MIL   -EPG_ME       < T:no name M:MediaEngine F:playService L:01316 > TUNING TO BBC 1 London, 101
240047:NDS: !MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=3, jhVRM=0x30003f1
240065:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Stop L:01074 > Milestone : MSM_DEVICEMAN_Stop hMC=0x3f9, Starts... 
240068:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Stop L:01955 > Milestone : -MS_API- hMC=0x3f9
240267:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Free L:01975 > Milestone : -MS_API- hMC=0x3f9 activity=MSM_MC_ACT_OPEN_CONFIGURE_DEMUX_OUTPUT
240557:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Free L:01975 > Milestone : -MS_API- hMC=0x3f9 activity=MSM_MC_ACT_OPEN_INDEX_FILES
240571:NDS: !INFO  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Close L:01992 > -MS_API- hMC=0x3f9
241275:NDS: !MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=5, jhVRM=0x30003f2
241418:NDS: !INFO  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00374 > hMC=0x3fb, mc_type= 117440515, source_locator=0xc5a08060, destination_locator=0xc6e08013 
241419:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00382 > Milestone : MSM_DEVICEMAN_Open hMC=0x3fb, mc_type=0x7000003, source_locator=0xc5a08060, destination_locator=0xc6e08013 Starts... 
241420:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00415 > Milestone : MSM_DEVICEMAN_Open for record: hMC=0x3fb, shrec=s504 Starts...
241428:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Open L:01874 > Milestone : -MS_API- open hMC=0x3fb for recording, source=unknown source, destination=s504
241695:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00881 > Milestone : MSM_DEVICEMAN_Open hMC=0x3fb, mc_type=0x7000003, Ends with status[0x5802000] 
241704:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Prepare L:01910 > Milestone : -MS_API- hMC=0x3fb activity=MSM_MC_ACT_OPEN_INDEX_FILES
241712:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Prepare L:01910 > Milestone : -MS_API- hMC=0x3fb activity=MSM_MC_ACT_OPEN_CONFIGURE_DEMUX_OUTPUT
241887:NDS: !INFO  -MSM_MS       < T:MCM_ITCMAIN_THREAD M:ms_fusion.c F:MS_DEVICEMAN_UpdateMediaSelectionObject L:02109 > -MS_API-hMC=0x3fb mso_handle=-909099001
242078:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Run L:01933 > Milestone : -MS_API- hMC=0x3fb


243464:NDS: !MIL   -EPG_ME       < T:no name M:MediaEngine F:playService L:01316 > TUNING TO Sky Living HD, 107
243493:NDS: !MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=3, jhVRM=0x30003f3
243505:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Stop L:01074 > Milestone : MSM_DEVICEMAN_Stop hMC=0x3fb, Starts... 
243508:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Stop L:01955 > Milestone : -MS_API- hMC=0x3fb
(***)
243539:NDS: !ERROR -MSM          < T:FS_WT_THREAD1 M:xtvfspc.c F:XTVFS_WriteEx L:01092 >  XTVFS: 42-To-POSIX: XTVFS_WriteEx: write failed for handle = 417 (buffer = 0x2BE2AD1C, numbytes = 48128), errno = 22 (Invalid argument), XTVFS status = 33057 !!!!!

243676:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Free L:01975 > Milestone : -MS_API- hMC=0x3fb activity=MSM_MC_ACT_OPEN_CONFIGURE_DEMUX_OUTPUT
243958:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Free L:01975 > Milestone : -MS_API- hMC=0x3fb activity=MSM_MC_ACT_OPEN_INDEX_FILES
243972:NDS: !INFO  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Close L:01992 > -MS_API- hMC=0x3fb
244676:NDS: !MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=5, jhVRM=0x30003f4
244819:NDS: !INFO  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00374 > hMC=0x3fd, mc_type= 117440515, source_locator=0xdde08012, destination_locator=0xdf2080ab 
244820:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00382 > Milestone : MSM_DEVICEMAN_Open hMC=0x3fd, mc_type=0x7000003, source_locator=0xdde08012, destination_locator=0xdf2080ab Starts... 
244821:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00415 > Milestone : MSM_DEVICEMAN_Open for record: hMC=0x3fd, shrec=s505 Starts...
244829:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Open L:01874 > Milestone : -MS_API- open hMC=0x3fd for recording, source=unknown source, destination=s505
245096:NDS: !WARN  -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00881 > Milestone : MSM_DEVICEMAN_Open hMC=0x3fd, mc_type=0x7000003, Ends with status[0x5802000] 
245105:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Prepare L:01910 > Milestone : -MS_API- hMC=0x3fd activity=MSM_MC_ACT_OPEN_INDEX_FILES
245113:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Prepare L:01910 > Milestone : -MS_API- hMC=0x3fd activity=MSM_MC_ACT_OPEN_CONFIGURE_DEMUX_OUTPUT
245281:NDS: !INFO  -MSM_MS       < T:MCM_ITCMAIN_THREAD M:ms_fusion.c F:MS_DEVICEMAN_UpdateMediaSelectionObject L:02109 > -MS_API-hMC=0x3fd mso_handle=-510640125
245573:NDS: !WARN  -MSM_MS       < T:MSMDispatcher M:ms_fusion.c F:MS_DEVICEMAN_Run L:01933 > Milestone : -MS_API- hMC=0x3fd


#define MCM_MEDIACONN_ACTIVITY_TYPE_BASE                ((uint32_t)0x00000000)
#define MCM_MEDIACONN_ACTIVITY_TYPE_PREPARE             (MCM_MEDIACONN_ACTIVITY_TYPE_BASE + (uint32_t)0x00000001U) /*!< @brief Prepare activity */
#define MCM_MEDIACONN_ACTIVITY_TYPE_RUN                 (MCM_MEDIACONN_ACTIVITY_TYPE_BASE + (uint32_t)0x00000002U) /*!< @brief Run activity */
#define MCM_MEDIACONN_ACTIVITY_TYPE_STOP                (MCM_MEDIACONN_ACTIVITY_TYPE_BASE + (uint32_t)0x00000003U) /*!< @brief Stop activity */
#define MCM_MEDIACONN_ACTIVITY_TYPE_FREE                (MCM_MEDIACONN_ACTIVITY_TYPE_BASE + (uint32_t)0x00000004U) /*!< @brief Free activity */

typedef enum MSM_DEVICEMAN_ActivityTag
{
    MSM_MC_ACT_UNDEF=0,                     /*!< @brief Undefined */
    MSM_MC_ACT_OPEN_CONFIGURE_CHUNK_INPUT,  /*!< @brief Opens and configures chunk input and starts buffering (requires free) */
    MSM_MC_ACT_BUFFER_STREAM,               /*!< @brief Waits until sufficient data is buffered in the chunk input for playback to start */
    MSM_MC_ACT_OPEN_INDEX_FILES,            /*!< @brief (Requires free) */
    MSM_MC_ACT_OPEN_CONFIGURE_DEMUX_OUTPUT, /*!< @brief Opens and configures the demux output(requires free) */
    MSM_MC_ACT_OPEN_CONFIGURE_RASP,         /*!< @brief (requires free) */
    MSM_MC_ACT_PLAY_STREAM,                 /*!< @brief Starts streaming from IP to demux for SI parsing requires free) */
	MSM_MC_ACT_OPEN_CONTENT_FILE,			/*!< @brief Open GHN content file ,parse its content, and create MESI object(requires free) */
    MSM_MC_ACT_LastValue                    /*!< @brief Last Value */
} MSM_DEVICEMAN_Activity;

#
!WARN   -MSM_MDI      		< p:0x00000000 P: t:0x01213f80 T:MCM_ITCMAIN_THREAD M:meta_mem.c F:MetaMemAllocateContext L:906 > Milestone : context 5, was allocated for META_CONTEXT 0x8000000e, memoryConnectionType META_MEMORY_CONNECTION_TYPE_PLAY_OF_PLAYBACK [11] 

typedef enum _META_MEMORY_CONNECTION_TYPE
{
	META_MEMORY_CONNECTION_TYPE_INVALID = 0,
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_RECORD,
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_GC,		/* real gc (but not gc that is part of record) */
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_IMPORT,	/* PDL */
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_GENERAL,	/* master of minimal play for conversion (time to byte)*/
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_PLAYBACK,
	META_MEMORY_CONNECTION_TYPE_MASTER_OF_CLEAR_PLAYBACK,
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_RECORD, '7'
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_GC,
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_IMPORT,
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_GENERAL,  	/* minimal play for conversion (time to byte)*/
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_PLAYBACK, '11'
	META_MEMORY_CONNECTION_TYPE_PLAY_OF_CLEAR_PLAYBACK,
	META_MEMORY_CONNECTION_TYPE_SHARED, 			/* shared memory, memory that is used for more than one connection 
													   e.g. refresh resources that shared between all the recordings */
	META_MEMORY_CONNECTION_TYPE_NO_MEMORY_USED, 	/* e.g bdl */
	META_MEMORY_CONNECTION_TYPE_LAST,
} META_MEMORY_CONNECTION_TYPE;



# used only to check stop and start of video decoder
!ERROR  -MSM_MS       		< p:0x00000000 P: t:0x01150610 T:EVENT_MGR_THREAD M:watchdog.c F:WatchdogEventMgrCb L:432 > -MS_WATCHDOG- thread E_MS_PORT_THREAD_TYPE_CDI_WT, " "pid = 301, tid = 18155024, " "called E_REQUEST_TYPE_UPDATE_VIDEO_DECODER_MONITOR at time [2027:08:08 12:36:51]1817728611, " "time diff = 538, " "halt value 500 

# DEMUX OUTPUT BUFFER OVERFLOW
After the output buffer overflow, the MSM goes through a stop->free->prepare->run cycle so as to be able to align the indexing data from RASP with the stream data.


<xcon-mc>
NDS: ^[2016:09:25 16:26:29]0946861585.839292 !MIL    -MSM_MS                     < p:0x000001f6 P:MW t:0x018d9520 T:EVENT_MGR_THREAD M:disksrc.cpp F:(HandleReadDoneEvent) L:900 > 
< splicer=0xef `hMC=0xf2` >" "-MS_EOF- Source Filter of `xcon=0xf2` Reached EOF. Total number of bytes in header is 0


<ms-chunkinput-flow>
CMS_MEDIA_SERVICES/Media_Streamer/generic/src/cdi_server.c

        *p_chunk_input_max_queue_size = caps_v3.numChunkQueueEntriesMax;
        *p_chunk_input_required_alignment = caps_v3.chunkStartAlignment;

uses pull-mode and max chunk num from a driver

!INFO   -MSM_MS       < M:display_chunk.cpp F:(SendDataWasRead) L:8087 > < splicer=0x13 hMC=0x13 >" "last_completed_chunk_id=964, discard_uncompleted_chunks=XFALSE " "consider_all_data_completed XFALSE, next_release_index=67, " 
  "num_chunks_in_q=5


<comp-chunkinput>
// driver has the discontinuity threadhold.
#define TPID_MONITOR_PTS_DISC_THRES (90 * 2500) /* 2500 ms GOP. The longest GOP NDS ever saw */


// push-to-driver. what does triggers this?

// ID is chunk_id
// int ioctl (int fd, int request == DEMUX_CHUNKINPUT_GET_STATUS, uint32_t *chunkID);
!INFO   -MSM_MS       < M:display_chunk.cpp F:(AddChunksToChunkInput) L:8711 > < splicer=0x2f hMC=0x2f >" "Added chunk to chunk input queue of size 192512, ID 443 

starts from 

DISPLAY_FILTER::ReadFsm_HandleReadNeededEvent(_in_ const DEST_PUSH_READ_NEEDED_INFO *p_info)
case E_DISPLAY_ST_WAIT_READ_Q_EMPTY:
case E_DISPLAY_ST_WAIT_READ_CHUNKS_IN_Q:
    ProcessReadNeeded(p_info);

void DISPLAY_FILTER::ProcessReadNeeded(_in_ const DEST_PUSH_READ_NEEDED_INFO  *p_info)
{
  /* chunk input can only receive packet aligned data */
  MS_ASSERT((p_info->header.packet_bytes_data % DEMUX_PACKET_SIZE) == 0);

  /* add the chunks to the chunk input */
  AddChunksToChunkInput(p_info);
  {
    CDISERVER_AddChunkToChunkInput();
      MS_STATUS HandleAddChunkToChunkInput()
      {
        if ( MS_ioctl(chunk_input_fd,
              DEMUX_CHUNKINPUT_CHUNK_LIST_READY_EX,
              &chunks_ex) != 0)
      }
  }
}

!INFO   -MSM_MS       < T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6663 > < no-ctx >" "-MS_CDI_CONTROL- 
  Adding chunk to chunk input queue. " "chunk input fd = 398, p_address = 0x2c41dd28, num bytes = 344792 " "chunk_id = `967`

!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(CdiServerThread) L:4802 > < no-ctx >" 
"Request done. request=E_REQUEST_TYPE_ADD_CHUNK_TO_CHUNK_INPUT Result=MS_STATUS_OK, time=[2045:08:12 22:29:19]1844045224 

// get-last-completed event

\Description: Gets the events of the chunk input and the id of the last
completed chunk.

starts from CDISERVER_GetChunkInputEvents,
DEMUX_EVENT_CHUNKINPUT_GET_STATUS

!INFO   -MSM_MS       < T:`CDI_WT_THREAD` M:cdi_server.c F:(HandleGetChunkInputEvents) L:7007 > < no-ctx >" "-MS_CDI_CONTROL- 
  `Last completed chunk is 967` 


!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7004 > < no-ctx >" "-MS_CDI_CONTROL- Last completed chunk is 956 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7024 > < no-ctx >" "Got events:  chunk id 956\n 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:7119 > < no-ctx >" "-MS_CDI_CONTROL- TPIDMONITOR_READ array length 8, " "returned 1 entries 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:7135 > < no-ctx >" "-MS_CDI_CONTROL- FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 957, PTS (0,107841598) 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7064 > < no-ctx >" "Time now is [2045:08:12 20:59:52]1844039857, events=100, queue empty=XFALSE, chunk list completed=XFALSE, chunk_id=956 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(CdiServerThread) L:4802 > < no-ctx >" "Request done. request=E_REQUEST_TYPE_GET_CHUNK_INPUT_EVENTS Result=MS_STATUS_OK, time=[2045:08:12 20:59:52]1844039857 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:cdi_server.c F:(CDIServerEventMgrCallback) L:4962 > < no-ctx >" "IN 

*chunk-input-event* tpid-monitoring
uses events from CDI sepc.

#define DEMUX_EVENT_CHUNK_QUEUE_EMPTY                (0x00000020U)
#define DEMUX_EVENT_CHUNK_LIST_COMPLETED             (0x00000080U)
#define DEMUX_EVENT_TPIDMONITOR_THRESHOLD_REACHED    (0x00000100U)

"events=a0, queue empty=XTRUE, chunk list completed=XTRUE, " "TPID monitor threshold=XFALSE, TPID monitor overflow=XFALSE " "last completed chunk id 961 

!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetChunkInputEventsCallback) L:5862 > < no-ctx >" 
"events=100, queue empty=XFALSE, chunk list completed=XFALSE, " "TPID monitor threshold=XTRUE, TPID monitor overflow=XFALSE " "last completed chunk id 956 

!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetChunkInputEventsCallback) L:5891 > < no-ctx >" "going to retrieve TPID monitor data 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5927 > < splicer=0x13 hMC=0x13 >" "num blocks read 1 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5946 > < splicer=0x13 hMC=0x13 >" "FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 957, PTS (0,107841598) 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6084 > < splicer=0x13 hMC=0x13 >" "Check PTS [0,107841598] at index=56). 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6125 > < splicer=0x13 hMC=0x13 >" "found prev_pts (pts=[0,107643598],chunk_id=956, index=55). 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6136 > < splicer=0x13 hMC=0x13 >" "found prev_prev_pts (pts=[0,107503198],chunk_id=955, index=54). 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:6036 > < splicer=0x13 hMC=0x13 >" "Saving PTS at index 56, chunkID 957 PTS [0,107841598] 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(CdiServerThread) L:3815 > < no-ctx >" "Reading message 
KERN_EMERG --| Vid-lvl 1412813  | Pts(H)0 (L)106732798  |
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:cdi_server.c F:(CDISERVER_PrintDeviceDebug) L:3708 > < no-ctx >" "IN\n 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:cdi_server.c F:(SendMsgToBgThread) L:12471 > < no-ctx >" "Sending message to background thread 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(PrintProcfsDebug) L:12695 > < no-ctx >" "IN\n 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(PrintProcfsDebug) L:12707 > < no-ctx >" "-MS_PROCFS- 	 PTS(high):0 (low):106844398
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(PrintProcfsDebug) L:12695 > < no-ctx >" "IN\n 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(PrintProcfsDebug) L:12707 > < no-ctx >" "-MS_PROCFS- Read Mode: Default
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(PrintProcfsDebug) L:12707 > < no-ctx >" "-MS_PROCFS- CDI Audio decoder information
KERN_EMERG --| Vid-lvl 1439874  | Pts(H)0 (L)106775998  |
KERN_EMERG  --| Aud-lvl:259367  | pts 106786078 | pts2stc 4294967278   |
KERN_EMERG MIL tpidmonitor_process_event:440:Raising first PTS event (481 957)
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:cdi_server.c F:(CDISERVER_GetChunkInputEvents) L:2076 > < no-ctx >" "IN 
!INFO   -MSM_MS       		< T:EVENT_MGR_THREAD M:cdi_server.c F:(SendMsgToBgThread) L:12471 > < no-ctx >" "Sending message to background thread 
!INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7004 > < no-ctx >" "-MS_CDI_CONTROL- Last completed chunk is 957 


note:
tpid-monitoring-pair and tpid monitor uses to get first PTS. TPID monitoring
returns the first PTS for every injected chunk

!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01b06520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6663 > < no-ctx >" "-MS_CDI_CONTROL- 
  Adding chunk to chunk input queue. " "chunk input fd = 370, p_address = 0x2c0f4000, num bytes = 385024 " "chunk_id = 725 

!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01b06520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:7124 > < no-ctx >" "-MS_CDI_CONTROL- TPIDMONITOR_READ array length 8, " "returned 1 entries 
!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01b06520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:7140 > < no-ctx >" "-MS_CDI_CONTROL- FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 725, PTS (0,81878398) 
!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01aec520 T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5929 > < splicer=0x9 hMC=0x9 >" "num blocks read 1 
!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01aec520 T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5948 > < splicer=0x9 hMC=0x9 >" "FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 725, PTS (0,81878398) 
!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01aec520 T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:6038 > < splicer=0x9 hMC=0x9 >" "Saving PTS at index 24, chunkID 725 PTS [0,81878398] 
!INFO   -MSM_MS       		< p:0x000001e2 P:MW t:0x01b06520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7007 > < no-ctx >" "-MS_CDI_CONTROL- Last completed chunk is 725 


<chunkinput-buffer-rotate>
egrep -an "KEY_PRESS|ScreenSeen|Showing dialog|VIDEO IS|FRAME_PRESENTED|RUNNING_STATUS|Peep Show|Adding chunk to chunk|PTS Discontinuity|Last completed chunk|GetChunkInputEventsCallback"

5005473:NDS: ^[2017:04:19 08:09:16]0946750701.244782 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c1b9d28, num bytes = 344792 " "chunk_id = 962 
5005475:NDS: ^[2017:04:19 08:09:16]0946750701.245166 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputEvents) L:7017 > < no-ctx >" "-MS_CDI_CONTROL- Last completed chunk is 962 

>>> hex(0x2c1b9d28+344792)
'0x2c20e000'

5005477:NDS: ^[2017:04:19 08:09:16]0946750701.245292 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01af1520 T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetChunkInputEventsCallback) L:5862 > < no-ctx >" "events=80, queue empty=XFALSE, chunk list completed=XTRUE, " "TPID monitor threshold=XFALSE, TPID monitor overflow=XFALSE " "last completed chunk id 962 
5005595:NDS: ^[2017:04:19 08:09:16]0946750701.273445 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c20e000, num bytes = 192512 " "chunk_id = 963 

>>> hex(0x2c20e000+192512)
'0x2c23d000'

>>> here goes back!

5005597:NDS: ^[2017:04:19 08:09:16]0946750701.273706 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c0f4000, num bytes = 192512 " "chunk_id = 964 

hex(0x2c0f4000+192512)
'0x2c123000'

5005599:NDS: ^[2017:04:19 08:09:16]0946750701.273934 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c123000, num bytes = 385024 " "chunk_id = 965 

hex(0x2c123000+385024)
'0x2c181000'

5005601:NDS: ^[2017:04:19 08:09:16]0946750701.274189 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c181000, num bytes = 216576 " "chunk_id = 966 

hex(0x2c181000+216576)
'0x2c1b5e00'

5005603:NDS: ^[2017:04:19 08:09:16]0946750701.274427 !INFO   -MSM_MS       		< p:0x00000222 P:MW t:0x01b0b520 T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6675 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 336, 
  p_address = 0x2c1b5e00, num bytes = 360960 " "chunk_id = 967 

hex(0x2c1b5e00+360960)
0x2c20e000


<ms-packet>

typedef XI64                    MS_PACKET_NUMBER;

PRVFUNC void printRangeBounderies(_in_ RANGE_BOUNDRIES *range)
{
    XDEBUG_DEFINE_FUNC_INFO("printRangeBounderies");    
    MS_ASSERT(range != NULL) ; 

    XDEBUG_TRACE1_0("-------------------- RANGE --------------------"); 
    XDEBUG_TRACE1_4("[(%ld, %#lu)->(%#ld, %#lu)]",
		    XI64Hi(&range->low) , 
		    XI64Low(&range->low ),
		    XI64Hi(&range->high ),
		    XI64Low(&range->high )) ;                  
    XDEBUG_TRACE1_0("----------------------------------------------- ") ; 
}

typedef struct _RANGE_BOUNDRIES
{
    MS_PACKET_NUMBER     low;
    MS_PACKET_NUMBER     high;
}RANGE_BOUNDRIES;


550438:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:649 > < no-ctx >" "---------------- INDEX  2 -----------------  
550439:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:652 > < no-ctx >" " HANDLE --- 0x80011020  
550440:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:655 > < no-ctx >" " STATE  --- ACTIVATED  
550441:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:656 > < no-ctx >" " RANGE Packet---- 
550442:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:662 > < no-ctx >" "[(0, 1605666)->(0, 1713006)] 
550443:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:663 > < no-ctx >" " RANGE Time---- 
550444:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:669 > < no-ctx >" "[(0, 1311129)->(0, 1398777)] 
550445:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:671 > < no-ctx >" "-----------------------------------------------  

550446:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:649 > < no-ctx >" "---------------- INDEX  3 -----------------  
550447:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:652 > < no-ctx >" " HANDLE --- 0x80012030  
550448:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:655 > < no-ctx >" " STATE  --- REQUESTED  
550449:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:656 > < no-ctx >" " RANGE Packet---- 
550450:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:662 > < no-ctx >" "[(0, 1713007)->(0, 1819792)] 
550451:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:663 > < no-ctx >" " RANGE Time---- 
550452:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:669 > < no-ctx >" "[(0, 1398778)->(0, 1486033)] 
550453:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:671 > < no-ctx >" "-----------------------------------------------  


550478:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangesArray) L:673 > < no-ctx >" "active index = 2  

550503:NDS: !INFO   -MSM_MS       		< T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6663 > < no-ctx >" "-MS_CDI_CONTROL- Adding chunk to chunk input queue. " "chunk input fd = 357, p_address = 0x2c0f58f8, num bytes = 378632 " 
"chunk_id = 1054 

// range in time
550526:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(GetNumOfRangesToPrepare) L:2557 > < no-ctx >" "current played requested time : [(0- 1311093)]  
550527:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(GetNumOfRangesToPrepare) L:2593 > < no-ctx >" "found first candidata to prepare at index 3  

// range in packet
550544:NDS: !INFO   -MSM_MS       		< T:RANGE_MGR_THREAD M:range_mgr_server.c F:(printRangeBounderies) L:632 > < no-ctx >" "[(0, 1605666)->(0, 1713006)] 


={============================================================================
|kt_dev_si_0001| comp-rmf

Anna Silberman	Component Owner	Israel

When a job wants to perform a task that requires resources, it must request
permission from the RMF.  The RMF is responsible for the 'logical' aspect of
granting permissions to use resources. It is not involved in allocating them
physically. 

The `job manager`, prior to requesting resources (or performing tasks that
    require resources) from the `physical resource managers`, must call the
RMF and get permissions to do so.

RMF manages resources that are mapped to certain permissions according to the
specific project requirements and characteristics of the STB. For example, in
one project permission to perform playback may require a disk bandwidth
resource and in another project it would not. (Actually, in all projects disk
    bandwidth is required, but in some projects the disk bandwidth is not a
    bottleneck and the RMF does not need to be aware of it.)

Supporting a waiting `queue` (A physical resource manager)
For instance, the MCM allows requesting a media connection and the request
will be valid even if there are no free devices for the media connection. In
such a case, the request shall be granted once the devices become available.
On the other hand, the physical resource manager of the disk space (the file
    system) does not support such a mechanism. 


// from RMF ppt

A conflict can be characterized by: 
Which resources are involved:
	Tuner
	Quota
Time: 
	Immediate 
	Imminent (immediate conflict is expected shortly) 
	Future (booking) 
Trigger of conflict:
	Solicited  - requested by EPG
	Unsolicited - notified by RMF
How it is resolved:
	Automatically 
	Involving the user 

// channel change conflict
if there's no response within the timeout, the platform cancels the
channel-change request.


The MCM supports the following types of media connections:

1) LIVEVIEWING 
Used for viewing live streams from a tuner front end. This media connection
type requires the following device managers: FEM, 'MPM', CAMM, SIM, FDM, SDM.

2)	RECORDING 
Used for recording streams from a tuner front end to files on disk. This media
connection type requires the following device managers: FEM, MPM, MSM, CAMM,
SIM, SDM.

3)	PLAYBACK 
Used for playing streams from disk. This media connection type requires the
following device managers: MPM, MSM, CAMM, SIM.

4)	CAPTURE 
Used for capturing service information data. This media connection type
requires the following device managers: FEM, MPM, CAMM, SIM, FDM, SDM.

5)	SCAN 
Used for determining what transponder frequencies contain valid streams. This
media connection type requires the following device managers: FEM, MPM, SIM.


COMPONENT_NAME := rmfplugin

<job-type> see *vrm-job-type*
// 146746:!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c 
// F:RMF_ALLOCATE_ControlPermissions L:1012 > 
// job=0x201072f(0)[L] request=0x10000020 released=0xf0000000 change request if fails. 

char* JobTypeToString(SYSTEMJOB_Type jobType)
{
    char *typeStr="Er";

    switch(jobType)
    {
    case SYSTEMJOB_TYPE_SCAN:
        typeStr = "S";
        break;
    case SYSTEMJOB_TYPE_CAPTURE:
        typeStr = "C";
        break;
    case SYSTEMJOB_TYPE_LIVE_VIEWING:
        typeStr = "L";
        break;
    case SYSTEMJOB_TYPE_RECORD:
        typeStr = "R";
        break;
    case SYSTEMJOB_TYPE_REMINDER:
        typeStr = "Rm";
        break;
    case SYSTEMJOB_TYPE_PLAYBACK:
        typeStr = "P";
        break;
    case SYSTEMJOB_TYPE_`DOWNLOAD`:   *pdl-download*
        typeStr = "D";
        break;
        ...
    }

    return typeStr;
}


<conflict-qic>
// see QIC
// CMS_SYSTEM_RESOURCE/RMF/src/plugins/quota_immediate_conflict.c

// this is only place to register QIC_Listener
    /* register to ControlPermission listener */
    stat = RMF_SRV_Listener_Register(QIC_Listener, NULL,
                &QICListenerHandle);

    stat = RMF_SRV_Listener_SetEventsMask(QICListenerHandle,
      RMF_SRV_LISTENER_EVENT_CONTROL_PERMISSIONS);

// to check permission
RMF_ALLOCATE_ControlPermissions()
{
  //  fire up to notify permission result to client
  stat = RMF_SRV_TriggerListeners(RMF_SRV_LISTENER_EVENT_CONTROL_PERMISSIONS, cookieJar);

  SYSTEM_STATUS RMF_SRV_TriggerListeners(uint32_t event, RMF_COOKIE_JarHandle cookieJar)
    listenersTable[i].trigger(event, cookieJar, listenersTable[i].data);
}

PRVFUNC void QIC_Listener(uint32_t event, RMF_COOKIE_JarHandle	cookieJar, void *data)
{
  bool						handleConflict = true;

  // read the field from cookie and if it is set then "handleConflict = false"

  stat = RMF_COOKIE_Jar_ReadCookie(cookieJar,
      RMF_COOKIE_TYPE_CTRL_PERM_FAILED_REQUEST_TYPE,
      (uint16_t)(sizeof(RMF_ALLOCATE_REQUEST_FLAGS)), &flags);

  if ( flags & RMF_ALLOCATE_REQUEST_FLAGS_RETRY)
  {
    DIAG_LOG_INFO(gRmfSegmentId, ("deny request with no conflict resolution!"));
    handleConflict = false;
  }

  // RMF_ALLOCATE_REQUEST_FLAGS_RETRY  (0x01U)  /*!< @brief No conflict
  // resolution required, request is called to insure job retry */

  // note: This is not set and means that conclict is required

  if (handleConflict == true)
  {
    stat = QIC_Construct(QIC_Type_FailAssign, jobInJar, quota_part_id, cookieJar, successInAutoResolution, strategy);
    STATUS_CHECK_AB(stat);
  }
}


<conflict-raise-type>
// /* conflict due to fail assign */
// QIC_Type_FailAssign,
//
// /* conflict due to trigger of `quota resource` */
// QIC_Type_TriggerWarning,

// raise quota conflict
stat = QIC_Construct(QIC_Type_FailAssign, 
    jobInJar, quota_part_id, cookieJar, successInAutoResolution, strategy)
{

  /* Find a resolution to the conflict */
  stat = QIC_Resolve(pConf, &uiRequired, cookieJar, successInAutoResolution, strategy);

  DIAG_LOG_MIL(gRmfSegmentId, ("Conflict on %s UI %s required",
    RMF_JOB_Instance_ToString(subject),
    (uiRequired ? "" : "NOT ")));
}


<state-code>
# STATE (COMP, SEV, IF, STA)
hex(((30 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((2 & 0xF) << 12) | (1 & 0xFFF) )
hex(((30 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((2 & 0xF) << 12) | (1 & 0xFFF) )

#define RMF_COMP_ID         ((uint32_t)(30)) 
#define SEVERITY_SEVERE     ((uint32_t)(0x2))
#define RMF_ALLOCATE_IF_ID  (2)

#define RMF_ALLOCATE_STATUS_OK 
(SYSTEM_MAKE_COMPONENT_STATUS(RMF_COMP_ID, RMF_ALLOCATE_IF_ID, SEVERITY_NONE,   0)) /*!< @brief Status for RMF_ALLOCATE */
  0x07802000

#define RMF_ALLOCATE_STATUS_FAILURE (SYSTEM_MAKE_COMPONENT_STATUS(RMF_COMP_ID, RMF_ALLOCATE_IF_ID, SEVERITY_SEVERE, 1)) /*!< @brief General failure status for RMF_ALLOCATE. */
  0x07822001

RMF_CONFLICT_STATUS_OK        (0x7800000)
RMF_CONFLICT_STATUS_FAILURE   (0x7802001)

#define RMF_QUOTA_IF_ID		(5) /*!< @brief File id for rmf_quota.h for creating specific statuses */
#define RMF_QUOTA_STATUS_UNKNOWN_QUOTA	 RMF_COMP_ID, RMF_QUOTA_IF_ID, SEVERITY_SEVERE, 2	(0x07825002)


<conflict-permission>
/*
   (perm1 & perm2), 
   (perm1 | perm2): 
   
   Check if both operands are in the same permissions group. If yes, execute
   the operator regularly. If not, return PERMISSION_NONE (because they are
   not included in each other and they are not allowed to be added to each
   other).  PERMISSION_BITWISE_AND special cases: 1. When 2 operands are from
   the same group, but are not overlapping, the result might be 0x10000000
   which means nothing and can cause errors on further bitwise operations. So
   we identify this case and return PERMISSION_NONE instead.  2. When one of
   the operands is 0xffffffff (this can come from ~(PERMISSION_NONE) ), then
   perm1,perm2 are not from the same group, but we want to return the actual
   bitwise AND operation on them.  PERMISSION_BITWISE_OR special case: when
   one of the operands is NONE (so the "group bits" is 11111111), we don't
   want the OR operation to return all the group bits of the result as 1, but
   to return the real group of the other operand.
*/


#define PERMISSION_BITWISE_AND(perm1, perm2) RMF_ALLOCATE_permissionBitwiseAnd((perm1), (perm2))
#define PERMISSION_BITWISE_OR(perm1, perm2)  RMF_ALLOCATE_permissionBitwiseOr((perm1), (perm2))

RMF_ALLOCATE_REQUEST_STATUS_SUCCESS(1)

<rmf-request>
RMF_ALLOCATE_PERMISSION_NONE    (0xf0000000U) /*!< @brief `no permission` */	
RMF_ALLOCATE_PERMISSION_STORE   (0x10000004U) /*!< @brief Store recording on disk */	
RMF_ALLOCATE_PERMISSION_RECORD  (0x10000008U) /*!< @brief Recording to disk */	
RMF_ALLOCATE_PERMISSION_LIVE    (0x10000020U) /*!< @brief Live streaming */	
RMF_ALLOCATE_PERMISSION_EXTEND  (0x10001000U) /*!< @brief Extend quota storage  */	

#define	RMF_ALLOCATE_PERMISSION_DATA_CAPTURE			(0x10000200U)		/*!< @brief data capturing - SI tables, carousel, software downloads */	
#define	RMF_ALLOCATE_PERMISSION_SCAN					(0x10000400U)		/*!< @brief Using a 'tuner' to set frequency manually in order to make first tune, add channels etc. */	


note: result and status returns okay but released permission is not.
!MIL    -RMF < T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x20107b0(0)[R] request=0x10000008 released=`0xf0000000` change request if fails. 
!MIL    -RMF < T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1022 > result=1 " " status: OK[0x07802000] 



#
# ERRORS
#
NDS: ^0946699796.092852 !ERROR  -RMF      < T:VRM_SRV M:rmf_job.c F:RMF_JOB_SRV_GetJobByHandle L:917 > **** RMF_ET in rmf_job.c 917\n 

RMF_JOB_SRV_GetJobByHandle
{
	# if cond is false(0), then print out mesg but if there's no more errors after that, it should be ignored.
	CONDITION_CHECK_GO(RMF_JOB_HANDLE_ILLEGAL != handle);
}

#define CONDITION_CHECK_GO(cond) CONDITION_CHECK_GO_SET_ERROR(cond, stat, RMF_STATUS_FAILURE)
#define CONDITION_CHECK_GO_SET_ERROR(cond, variable, status) \
	if((cond)==0) {(variable) = (status); THROW_EXCEPTION}(void)0
#define THROW_EXCEPTION {DIAG_LOG_ERROR( COMP_SGMNT_ID, ("**** RMF_ET in %s %d\n",__FILE__, __LINE__) ); goto exception_handler_label;}

NDS: ^0946684997.681695 !ERROR  -RMF < T:SBM_UB_MAIN M:rmf_conflict.c F:RMF_CONFLICT_ReleaseConflictHandle L:805 > **** RMF_ET in rmf_conflict.c 805\n 
#define CONDITION_CHECK_AB(cond) CONDITION_CHECK_AB_SET_ERROR(cond, stat, RMF_STATUS_FAILURE)
#define CONDITION_CHECK_GO_SET_ERROR(cond, variable, status)

RMF_STATUS_FAILURE(0x7821001)


<conflict-type-resoultion>

typedef enum RMF_CONFLICT_NOTIFICATION_TYPE_TAG
{
  RMF_CONFLICT_NOTIFICATION_TYPE_UNDEF = 0,
  RMF_CONFLICT_NOTIFICATION_TYPE_CREATED, /*!< Conflict was created. This value also means the conflict is ready. */
  RMF_CONFLICT_NOTIFICATION_TYPE_UPDATED, /*!< Conflict was updated */
  RMF_CONFLICT_NOTIFICATION_TYPE_RESOLVED, /*!< Conflict was resolved without resolver intervention */
  RMF_CONFLICT_NOTIFICATION_TYPE_LAST
} RMF_CONFLICT_NOTIFICATION_TYPE;


// notifyConflict@picasso/bookingmgr/conflicts/ConflictResolver.java

typedef enum PLANNER_API_ConflictResolutionTag
{
  PLANNER_API_CONFLICT_RESOLUTION_UNDEF = 0U,
  PLANNER_API_CONFLICT_RESOLUTION_CANCEL  (1)     /**< Cancel the cause of the conflict. */
  PLANNER_API_CONFLICT_RESOLUTION_BASIC,          /**< Accept the automatic suggestion to resolve the conflict. */
  PLANNER_API_CONFLICT_RESOLUTION_ADVANCED,       /**< Manual selection to resolve the conflict. */
  PLANNER_API_CONFLICT_RESOLUTION_ACCEPT, `4`         /**< Accept the conflict situation with no resolution. */
  PLANNER_API_CONFLICT_RESOLUTION_CONTINUE,       /**< Continue with the original action that caused the conflict if it is automatically resolved */
  PLANNER_API_CONFLICT_RESOLUTION_AUTO_RESOLVE    /**< Resolve the conflict automatically means without user interaction */
} PLANNER_API_ConflictResolution;


typedef enum PLANNER_API_ConflictTypeTag
{
    PLANNER_API_CONFLICTTYPE_UNDEF = 0U,
    PLANNER_API_CONFLICTTYPE_BOOKING_TIME,      /**< Caused by insufficent resources at record time when adding a new booking */
    PLANNER_API_CONFLICTTYPE_CHANNEL_CHANGE,    /**< Caused by insufficent resources when changing the Live play. */
    PLANNER_API_CONFLICTTYPE_IMMINENT_TUNER,    /**< Caused by insufficent resources for an imminent recording. i.e clash with Live */

    PLANNER_API_CONFLICTTYPE_IMMINENT_DISK, `4`     
      /**< Caused by imminent insufficent disk resources for current recordings */

    PLANNER_API_CONFLICTTYPE_BOOKING_DISK_FAIL  (5), /**< Caused by insufficent disk resources at booking time */
    PLANNER_API_CONFLICTTYPE_PDL_REPLACEMENT_DISK, /**< Caused by imminent insufficient disk resources for PDL recording replacement with PVOD asset */
    PLANNER_API_CONFLICTTYPE_REMINDER_BOOKING,  /**< Caused by clashing reminders. */
    PLANNER_API_CONFLICTTYPE_LIVE_RESERVATION,  /**< Caused by insufficient resources when reserving resources for an interactive application */
    PLANNER_API_CONFLICTTYPE_IMMINENT_LIVE_RESERVATION, /**< Caused by insufficient resources for an imminent recording, when an interactive application is running. */
    PLANNER_API_CONFLICTTYPE_UPDATED,            /* Caused by automatic conflict update */
    PLANNER_API_CONFLICTTYPE_RESOLVED, (11, 0xb)            /* Caused by automatic conflict resolve, ie) without the resolver intervention */
    PLANNER_API_CONFLICTTYPE_IMMEDIATE_RECORDING, /* Caused by booking a second child event while watching an interactive application and recording the current child event.*/

    PLANNER_API_CONFLICTTYPE_QUOTA_CHANGE, `13` 
      /**< Caused by imminent insufficient disk resources `when moving an asset to the user disk quota` */

    PLANNER_API_CONFLICTTYPE_EXTEND_DISK_QUOTA, /**< Caused by when the viewer performs SFRB for a past event, and the user disk quota does not contain enough space for the new booking  */
    PLANNER_API_CONFLICTTYPE_LASTVALUE
} PLANNER_API_ConflictType;


// imminent
!MIL    -EPG_CONF     		< T:PLANNER_CB4 M:ConflictResolver F:notifyConflict L:284 > T:threadtracker:ConflictResolver.notifyConflict - kN@5a024bc `type - 4` - status 1 existing conflicts - 0
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver$1 F:doHandleConflict L:112 > T:CEE-J EventQueue Reader 0:USER_RESOLVE_CONFLICT
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:newEpgConflict L:736 > T:CEE-J EventQueue Reader 0:ConflictResolver > new ImminentDiskConflict
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:queueConflictAndMaybeStartResolutionOrDebounce L:542 > T:CEE-J EventQueue Reader 0:Starting Conflict Debounce


// move to user-quota
!ERROR  -J_GC         		< T:PLANNER_CB4 M: F: L:0 > T:threadtracker:Conflict callback for conflictCallbackId 0, (maybe) booking id 123, ConflictHandle 2, `Conflict Type 13`
!MIL    -EPG_CONF     		< T:PLANNER_CB4 M:ConflictResolver F:notifyConflict L:284 > T:threadtracker:ConflictResolver.notifyConflict - kJ@5a685c3 `type - 13` - status 1 existing conflicts - 0
!MIL    -EPG_PLAY     		< T:no name M:DownloadTracker F:isSuppressingDiskConflicts L:98 > T:CEE-J EventQueue Reader 0:isSuppressingDiskConflicts > false
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver$1 F:doHandleConflict L:112 > T:CEE-J EventQueue Reader 0:USER_RESOLVE_CONFLICT
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:newEpgConflict L:752 > T:CEE-J EventQueue Reader 0:ConflictResolver > new OtherDiskConflict
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:startResolution L:585 > T:CEE-J EventQueue Reader 0:startResolution - currentConflict = null
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:startResolution L:589 > T:CEE-J EventQueue Reader 0:startResolution - priorityConflict = Wl@5a6e07e
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:resolve L:649 > T:CEE-J EventQueue Reader 0:resolve
!MIL    -EPG_CONF     		< T:no name M:ConflictResolver F:setCurrentConflict L:557 > T:CEE-J EventQueue Reader 0:Set current conflict Wl@5a6e07e
!MIL    -EPG_CONF     		< T:no name M:EpgConflict F:commitResolution L:205 > T:CEE-J EventQueue Reader 0:Committing `resolution type 1`

// errors when no space
!ERROR  -SBMS_USERBOOKING		< T:SBM_UB_MAIN M:sbm_server_ub_movebooking.c F:SBM_SERVER_UB_MOVEBOOKING_QuotaChangeResultCallback_Handler L:1709 > Failed to change quota for a booking - possibly not enough space in the target quota. 
!ERROR  -SBMS_USERBOOKING		< T:SBM_UB_MAIN M:sbm_server_ub_movebooking.c F:SBM_SERVER_UB_MOVEBOOKING_Handler L:1765 > Unable to find the Move Booking payload 
!ERROR  -SBMS_USERBOOKING		< T:SBM_UB_MAIN M:sbm_server_ub_common.c F:SBMUserBookingThread L:1389 > Failed in running callback message function [event_id 21] [event_name SBM_USERBOOKING_EV_MOVE_BOOKING] 
!ERROR  -PLANNER_COMMON		< T:PLANNER_MAIN M:planner_common.c F:PlannerThread L:1555 > Failed in running event message [event_id 37][event_name PLANNER_EV_SBM_MOVE_BOOKING_FINISHED] 
!ERROR  -EPG_MISC     		< T:PLANNER_CB4 M:SystemListenerLatch F:doNotify L:87 > T:threadtracker:MW notified failure
!ERROR  -EPG_BOOK     		< T:no name M:BookingAgent F:doBookingFailure L:1378 > T:PooledExecutor#0:Planner Action Failed (UNDEFINED): UNKNOWN(104996876)
!MIL    -EPG_DLG      		< T:no name M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1124
!ERROR  -EPG_DEV1     		< T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /playback/diskspace_booking_disk_fail_id

// auto-resolution
// note: job=0x20107b0(0)[R] where 0x?? is rmj job instance
// snprintf(str, (size_t)STR_LEN, "0x%x(%d)[%s]", RMF_JOB_Instance_GetHandle(original), generation, typeStr);

!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x20107b0(0)[R] request=0x10001008 released=0xf0000000 change request if fails. 
!MIL    -RMF          		< T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type FailAssign on 0x20107b0(0)[R] 


// 0x2010094 comes from candidateList[i].jobInstance and means candidates to
// delete? Looks like to delete it and marks it with a reason.
//
//  case QIC_JobDeletionMode_Auto:
//
//    DIAG_LOG_MIL(gRmfSegmentId, ("Adding job 0x%x to Auto resolution",
//      RMF_JOB_Instance_GetHandle(candidateList[i].jobInstance)));
//
//    stat = AddDeleteInstruction(candidateList[i].jobInstance, 
//    SYSTEM_EXCEPTION_TYPE_INSUFFICIENT_DISK_SPACE);

!MIL    -RMF          		< T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Resolve L:2233 > Adding job 0x2010094 to Auto resolution 
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_SRV_CommitResolution L:2756 > Instruction job=0x2010094 toRelease=0x10000004 

!MIL    -RMF          		< T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20107b0(0)[R] UI NOT  required 
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1022 > result=1 " " status: OK[0x07802000] 

!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x20107b0(0)[R] request=0x10000008 released=0x10001000 change request if fails. 
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1022 > result=1 " " status: OK[0x07802000] 

!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x2010094(0)[R] request=0xf0000000 released=0x10000004 change request if fails. 
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1022 > result=1 " " status: OK[0x07802000] 


<conflict-if>
// public interface PlannerSession

checkForServiceConflict

// Checks whether tuning to a given service will result in a channel change
// conflict. 
//
// The result of the conflict check is returned as the status in the notify #
// method of the callback. If there is no conflict or if the conflict was
// resolved in favour of the existing booking then the status will be OK,
// otherwise the status will be CONFLICT. 
//
// If resolveConflict is TRUE, the conflict resolver will be called to allow
// resolution of the conflict.  If FALSE, the callback returns immediately
// with notify. 

	natPlannerApiSessionCheckForServiceConflict


checkForBookingConflict

// Check if adding a new booking will result in a conflict. Currently, this
// function can only be used to check whether changing the type of an EXISTING
// scheduled event (e.g. from a reminder to a recording) will result in a
// conflict. The result of the conflict check is returned as the status in the
// callback as notify method.  If there is no conflict or if the conflict was
// resolved in favour of the existing booking then the status will be OK,
// otherwise the status will be CONFLICT.  If resolveConflict is TRUE, the
// conflict resolver will be called to allow resolution of the conflict.  If
// FALSE, the callback returns immediately with notify. 

	natPlannerApiSessionCheckForBookingConflict
		PLANNER_JAVA_ApiSessionCheckForServiceConflict


void PLANNER_JAVA_ApiSessionCheckForServiceConflict(NDSJNI_ENV *env)
{
  // size(112) + 20 = 132
  JPA_VTABLE_Create('&g_planner_adaptor_ABPRequest', &genPtr, &vtable_handle, sizeof(PLANNER_JAVA_ADD_BOOKED_PROGRAMME_REQUEST))

    PLANNER_API_Session_CheckForServiceConflict( /* callback */ PLANNER_API_CheckForConflictCb 'PLANNER_JAVA_CheckForConflictListener' )
    {
      l_payload->payload_type = PLANNER_MSG_PAYLOAD_TYPE_CHECK_FOR_CONFLICT;
      l_payload->data.check_for_conflict.callback = callback;
      l_payload->data.check_for_conflict.conflict_resolution_required = call_resolver;

      SBM_USERBOOKING_CheckForServiceConflict( (SBM_USERBOOKING_CheckForConflictCb) 'PLANNER_NotifySBMCheckForServiceConflictFinished' )
        ipc_message.payload.userbooking_CheckForServiceConflict_request.callback = callback;
    }

  SBM_SERVER_USERBOOKING_HandleExternalMessage	
  {
    case SBM_IPC_EVENT_USERBOOKING_CheckForServiceConflict_Request:
      SBM_SERVER_USERBOOKING_CheckForServiceConflict

        l_payload->data.check_channel_change_conflict.callback = callback;

      SBM_USERBOOKING_PostMessage(SBM_USERBOOKING_EV_CHECK_SERVICE_CONFLICT)

        // sbm_server_ub_common.c
        static const SBMUserBookingEventCallback_t f_function_table[] = {

          SBM_SERVER_USERBOOKING_CheckForServiceConflict_Handler(RMF_CONFLICT_TYPE_LIVE_TUNE)
            SBM_SERVER_USERBOOKING_Conflict_CheckChannelChangeConflict(l_payload->data.check_channel_change_conflict.callback)
            {
              RMF_CONFLICT_CreateConflictParams
                RMF_CONFLICT_SetJobHandle
                RMF_CONFLICT_SetConflictType

                l_conflict->conflict_user_tag          = callback_user_tag;
              l_conflict->callback_user_tag          = callback_user_tag;

              RMF_CONFLICT_GetConflictHandle(&(l_conflict->conflict_handle))
            }
        }				
  }
}


PLANNER_NotifySBMCheckForServiceConflictFinished
{
  else if(status == SBM_USERBOOKING_STATUS_OK)
  {
    l_status = PLANNER_API_STATUS_OK;
  }
  else if(status == SBM_USERBOOKING_STATUS_CONFLICT)
  {
    l_status = PLANNER_API_STATUS_CONFLICT;
  }

  PLANNER_Callback_Post(PLANNER_EV_CB_CHECK_CONFLICT)
}	

void 'PLANNER_JAVA_CheckForConflictListener'(PLANNER_API_UserTag l_user_tag, # this vtable handle
                                           SYSTEM_STATUS l_completion_status)
{
  if (JPA_VTABLE_GetElement(&g_planner_adaptor_ABPRequest, l_user_tag, &genPtr) != JPA_VTABLE_STATUS_SUCCESS)
    ;

  if (!NDSJNI_CallJavaMethod2(&env, currentABPListenerObject,
        "notify", "(Ljava/lang/Object;I)V",
        currentUserTag, l_completion_status))
}


// natDeleteConflict

void PLANNER_JAVA_ConflictDeleteConflict(const NDSJNI_ENV *env)
{
  PLANNER_API_Conflict_Delete();

  if (JPA_VTABLE_FindElement(&g_planner_adaptor_ABPRequest,
        &PLANNER_JAVA_FindConflictElement,
        (void *)jConflictHandle, &genPtr, &vtable_handle) != JPA_VTABLE_STATUS_SUCCESS)
  {
    DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("Failed to find conflict data: 0x%x", jConflictHandle));
  }
  else
  {
    conflict_data = genPtr;

    /* Twice to destroy this item */
    (void)JPA_VTABLE_ReleaseElement(&g_planner_adaptor_ABPRequest, vtable_handle);
    (void)JPA_VTABLE_ReleaseElement(&g_planner_adaptor_ABPRequest, vtable_handle);
  }
}


// RESOLVE CH from app and RELEASE 

commitConflictResolution(int resolutionType)
	natCommitConflictResolution
		PLANNER_JAVA_ConflictCommitConflictResolution
			PLANNER_API_Conflict_CommitConflictResolution
				PLANNER_Conflict_CommitResolution
					SBM_CONFLICT_ReleaseConflictHandle

					SBM_CONFLICT_ReleaseConflictHandle
					SBM_SERVER_CONFLICT_ReleaseConflictHandle(conflictHandle)
						RMF_CONFLICT_ReleaseConflictHandle((RMF_CONFLICT_Handle)conflictHandle)
						# release SBM conflict structure
						VTABLE_ReleaseElement(&g_sbm_userbooking_conflicts)



// NOTY from RMF -> APP

RMF_CONFLICT_SRV_NotifyConfUpdated
	RMF_CONFLICT_CLT_HandleIPCMsg
		RMF_CONFLICT_CLT_NotifyConfStatus


SBM_SERVER_CONFLICT_NotifyListener(RMF_CONFLICT_NOTIFICATION_TYPE notifyType, RMF_CONFLICT_Handle conflictHandle)
	PostMessage(SBM_USERBOOKING_EV_CONFLICT_NOTIFICATION);

/* SBM_USERBOOKING_EV_CONFLICT_NOTIFICATION,*/
SBM_USERBOOKING_ConflictNotificationHandler
{
	notifyType == RMF_CONFLICT_NOTIFICATION_TYPE_CREATED
	SBM_SERVER_CONFLICT_Call_NotifyListener(notifyType, conflictHandle, l_userData);
}

PLANNER_ConflictNotificationHandler
{
	PLANNER_PRV_NotifyConflictListenersInAllSessions
		PLANNER_PRV_NotifyConflictListeners
			PLANNER_ExecuteUserCallback: PLANNER_EV_CB_CONFLICT
				PLANNER_JAVA_Conflict_ResolverCb
				{
					PLANNER_JAVA_Conflict_ResolverCb_NewConflict # matches to PLANNER_JAVA_Conflict_ResolverCb_ResolvedConflict
						JPA_VTABLE_Create

					PLANNER_JAVA_Conflict_ResolverCb_ResolvedConflict
				}
}

// from app to regieter a resolver callback
PLANNER_JAVA_ApiSessionRegisterConflictResolver
	# size(108) + 20 = 128 g_planner_adaptor_ConflictResolverListener
	PLANNER_API_Session_RegisterConflictResolver(PLANNER_JAVA_Conflict_ResolverCb)


//
PLANNER_JAVA_Conflict_ResolverCb_NewBookingConflict L:02669 > JPA_VTABLE_Create failed (44bytes)

// from SBM, register listeners.
else if (RMF_CONFLICT_STATUS_OK != RMF_CONFLICT_RegisterResolver(
            SBM_SERVER_CONFLICT_NotifyListener,
            SBM_SERVER_CONFLICT_ConflictControlListener,
            SBM_SERVER_CONFLICT_QueryControlListener,
            SBM_SERVER_CONFLICT_RequestResultListener,
            &g_sbm_userbooking_conflict_resolver_handle))


<conflict-log>
// PLANNER_API_CONFLICTTYPE_CHANNEL_CHANGE
-P_Planner    	< T:PLANNER_CB4 M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0xcd, 0x44, 0x2 
-J_PLANNER    	< T:PLANNER_CB4 M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0xcd, ConflictHandle: 0x0x44, ConflictType: 0x0x2 
PLANNER_JAVA_Conflict_ResolverCb:PLANNER_JAVA_Conflict_ResolverCb_NewConflict

// PLANNER_API_CONFLICTTYPE_RESOLVED
-P_Planner    	< T:PLANNER_CB4 M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0xcd, 0x44, 0xb 
-J_PLANNER    	< T:PLANNER_CB4 M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0xcd, ConflictHandle: 0x0x44, ConflictType: 0x0xb 
PLANNER_JAVA_Conflict_ResolverCb:PLANNER_JAVA_Conflict_ResolverCb_ResolvedConflict

// PLANNER_JAVA_ConflictDeleteConflict
// as below, called when there's no interest on it and in that case, there's no resolved event.

-P_Planner  M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0x158, 0x78, 0x1 
-J_PLANNER  M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0x158, ConflictHandle: 0x0x78, ConflictType: 0x0x1 
-EPG_CONF   > T:threadtracker:PlannerConflictType=1 Booking Time, ConflictStatus=TO-RESOLVE, conflict=com.nds.fusion.plannerimpl.PlannerBookedProgrammeConflictImpl
-EPG_CONF   > T:CEE-J EventQueue Reader 0:>>> [CONFLICT=com.nds.fusion.plannerimpl.PlannerBookedProgrammeConflictImpl@59aa3bb] commitConflictResolution(resolutionType=2) <<<
-J_PLANNER  M:natPlannerConflictImpl.c F:PLANNER_JAVA_ConflictDeleteConflict L:187 > KT: Delete: vtable_handle=0x159 


-P_Planner  M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0x0, 0x79, 0x3 
-J_PLANNER  M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0, ConflictHandle: 0x0x79, ConflictType: 0x0x3 
-EPG_CONF   > T:threadtracker:PlannerConflictType=3 Imminent Tuner, ConflictStatus=TO-RESOLVE, conflict=com.nds.fusion.plannerimpl.PlannerImminentTunerConflictImpl
-EPG_CONF   > T:CEE-J EventQueue Reader 0:>>> [CONFLICT=com.nds.fusion.plannerimpl.PlannerImminentTunerConflictImpl@59cee23] commitConflictResolution(resolutionType=3) <<<
-J_PLANNER  M:natPlannerConflictImpl.c F:PLANNER_JAVA_ConflictDeleteConflict L:187 > KT: Delete: vtable_handle=0x15d 


# usual case, there's notification and delete
 -P_Planner  PLANNER_CB4 M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0x162, 0x7b, 0x1 
 -J_PLANNER  PLANNER_CB4 M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0x162, ConflictHandle: 0x0x7b, ConflictType: 0x0x1 
-EPG_CONF    ct L:00154 > T:threadtracker:PlannerConflictType=1 Booking Time, ConflictStatus=TO-RESOLVE, conflict=com.nds.fusion.plannerimpl.PlannerBookedProgrammeConflictImpl
-EPG_CONF    137 > T:CEE-J EventQueue Reader 0:>>> [CONFLICT=com.nds.fusion.plannerimpl.PlannerBookedProgrammeConflictImpl@59a70a7] commitConflictResolution(resolutionType=1) <<<
 -J_PLANNER  no name M:natPlannerConflictImpl.c F:PLANNER_JAVA_ConflictDeleteConflict L:187 > KT: Delete: vtable_handle=0x163 

 -P_Planner  PLANNER_CB4 M:planner_callback.c F:PLANNER_ExecuteUserCallback L:240 > KT: 0x1, 0x169, 0x7f, 0xb 
 -J_PLANNER  PLANNER_CB4 M:natPlannerCommon.c F:'PLANNER_JAVA_Conflict_ResolverCb' L:3014 > ResolverUserTag: 0x0x1, BookingUserTag: 0x0x169, ConflictHandle: 0x0x7f, ConflictType: 0x0xb 
-EPG_CONF    ct L:00154 > T:threadtracker:PlannerConflictType=2 Channel Change, ConflictStatus=RESOLVED, conflict=com.nds.fusion.plannerimpl.PlannerChannelChangeConflictImpl
 -J_PLANNER  no name M:natPlannerConflictImpl.c F:PLANNER_JAVA_ConflictDeleteConflict L:187 > KT: Delete: vtable_handle=0x16a 

# sequence logs
#
!INFO  -P_Planner    < M:planner_callback.c F:PLANNER_ExecuteUserCallback L:00209 > Executing the callback of type 13. (PLANNER_EV_CB_CHECK_CONFLICT)
!ENTER -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_CheckForConflictListener L:03136 > |-> PLANNER_JAVA_CheckForConflictListener

# PLANNER_API_STATUS_OK in case there's no conflict
#
!ERROR -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_CheckForConflictListener L:03162 > KT: Listener: l_user_tag=0xe, l_comp_status=0x642200c (PLANNER_API_STATUS_CONFLICT)

!INFO  -P_Planner    < M:planner_callback.c F:PLANNER_ExecuteUserCallback L:00209 > Executing the callback of type 13. (PLANNER_EV_CB_CHECK_CONFLICT)
!ENTER -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_CheckForConflictListener L:03136 > |-> PLANNER_JAVA_CheckForConflictListener
!ERROR -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_CheckForConflictListener L:03141 > JPA_VTABLE_GetElement could not find usertag: 0xe
!ERROR -SBMS_USERBOOKING < M:sbm_server_ub_conflict.c F:SBM_SERVER_CONFLICT_ReleaseConflictHandle L:01028 > KT: rmf_status(0x7804000), RMF_STATUS_FAILURE(0x7821001)


!INFO  -P_Planner    < M:planner_callback.c F:PLANNER_ExecuteUserCallback L:00209 > Executing the callback of type 8. (PLANNER_EV_CB_CONFLICT)
!ENTER -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:03010 > |-> PLANNER_JAVA_Conflict_ResolverCb
!WARN  -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:03032 > Could not find booking usertag in ABP  Vtable :0xe
!WARN  -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb L:03042 > Could not find booking usertag in RBP  Vtable :0xe

# PLANNER_API_CONFLICTTYPE_RESOLVED
#
!ENTER -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb_ResolvedConflict L:02861 > |-> PLANNER_JAVA_Conflict_ResolverCb_ResolvedConflict
!ENTER -J_PLANNER    < M:natPlannerCommon.c F:PLANNER_JAVA_Conflict_ResolverCb_GetConflictObject L:02905 > |-> PLANNER_JAVA_Conflict_ResolverCb_GetConflictObject
!MIL   -EPG_CONF     < M:ConflictResolver F:notifyConflict L:00154 > T:threadtracker:PlannerConflictType=2 Channel Change, ConflictStatus=RESOLVED, conflict=com.nds.fusion.plannerimpl.PlannerChannelChangeConflictImpl


// EPG LOG
!MIL   -EPG_CONF     < M:ConflictResolver F:notifyConflict L:00154 > T:threadtracker:PlannerConflictType=2 Channel Change, ConflictStatus=RESOLVED, conflict=com.nds.fusion.plannerimpl.PlannerChannelChangeConflictImpl
!MIL   -EPG_CONF     < M:ConflictResolver F:notifyConflict L:00154 > T:threadtracker:PlannerConflictType=2 Channel Change, ConflictStatus=TO-RESOLVE, conflict=com.nds.fusion.plannerimpl.PlannerChannelChangeConflictImpl
!MIL   -EPG_CONF     < M:BaseConflict F:trackStatic L:00137 > T:CEE-J EventQueue Reader 0:>>> [CONFLICT=com.nds.fusion.plannerimpl.PlannerChannelChangeConflictImpl@59aa83d] commitConflictResolution(resolutionType=3) <<<


$ sed -n '1,69926p' LOGlast | egrep 'T:threadtracker:PlannerConflictType' | egrep 'RESOLVED' | wc -l
120
$ sed -n '1,69926p' LOGlast | egrep 'T:threadtracker:PlannerConflictType' | egrep 'TO-RESOLVE' | wc -l        
180 (180-120=60, from MEMMAN log, there's about 64 items so it's about match)
$ sed -n '1,69926p' LOGlast | egrep 'commitConflictResolution' | wc -l                                         
179


={============================================================================
|kt_dev_si_0001| comp-rmf-conclict-disk-quota

<check-disk-size>
-sh-3.2# fdisk -lu

Disk /dev/sda: 2000.3 GB, 2000398934016 bytes
255 heads, 63 sectors/track, 243201 cylinders, total 3907029168 sectors
Units = sectors of 1 * 512 = 512 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1              64  3907007999  1953503968   1 FAT12


<disk-quotas>

WP 41
* User Quota: for Viewer-initiated recordings
* System Quota: for Push VOD recordings (to be supported in a later Iteration)


!INFO  -SBMS_USERBOOKING < T:SBM_UB_MAIN M:sbm_server_ub_bookedprogramme_properties.c F:SBM_SERVER_USERBOOKING_GetQuotaStatus L:00435 > 
  Quota (user): MaxSize 0x00000000,5c868d3e, UsedSize 0x00000000,001dc5fe, usedPct 0x0
!INFO  -RMF          < T:SBM_UB_MAIN M:rmf_quota.c F:RMF_QUOTA_GetQuotaStatus L:00590 > maxSize =  0,[2019:03:11 16:30:54]1552321854(high,low)
!INFO  -RMF          < T:SBM_UB_MAIN M:rmf_quota.c F:RMF_QUOTA_GetQuotaStatus L:00591 > usedSize =  0,1951230(high,low)
!INFO  -RMF          < T:SBM_UB_MAIN M:rmf_quota.c F:RMF_QUOTA_GetQuotaStatus L:00592 > UsedPercents = 0


Usual size:
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04427 > remaining size: 370,439679563(high,low)
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04443 > remaining quota[0]: <user> max_size: 370,439679563(high,low)
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04457 > quota user: size: 370,439679563(high,low)
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04457 > quota system: size: 83,3526103040(high,low)
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04457 > quota NDS_Dynamic: size: 9,1345294336(high,low)
M:quota_resource.c F:QuotasOnDevice_SetSizes L:04457 > quota recycle: size: 0,0(high,low)

>>> ((370<<32) | (439679563))
1589577579083L
>>> (1589577579083L)/(1024*1024*1024)
1480L
1.4 TB


			DIAG_PMON_DISK_QUOTA_INITIAL(gRmfSegmentId,
					0U /* standart parameter */,
					temp_quota->creationInfo.name,
					xint64_t_low(&temp_max_size),
					xint64_t_low(&temp_staticUsedSize) );

NDS: ^[2017:12:03 00:55:12]0946685068.993551 !MIL    -RMF          		< p:0x000001e5 P:MW t:0x01d72520 T:VRM_SRV M:quota_resource.c F:QUOTA_RESOURCE_ActionsAfterRestoration L:1258 > 
  @@PMON@@,scenario,d-asset,d-quota-disk-init,0,quota-dsk-name=,user,d-quota-max-MB=,233614,d-quota-cur-MB=,26878 
  @@PMON@@,scenario,d-asset,d-quota-disk-init,0,quota-dsk-name=,system,d-quota-max-MB=,195510,d-quota-cur-MB=,194981 
  @@PMON@@,scenario,d-asset,d-quota-disk-init,0,quota-dsk-name=,NDS_Dynamic,d-quota-max-MB=,38146,d-quota-cur-MB=,15462 
  @@PMON@@,scenario,d-asset,d-quota-disk-init,0,quota-dsk-name=,recycle,d-quota-max-MB=,0,d-quota-cur-MB=,196440 


<pcat-item-txt> note: so do not show quota size and free space.

// Adds up space used for each recording with `booking_source` catagory.
SPACE USED (Gb): USER :6.90 PVOD :186.12 SLINK:208.91 DYNAM:1.49 

// Adds up space used for each recording with `booking_disk_quota_name`
// catagory.
Disk usage in quota "NDS_Dynamic": 1.49 Gb
Disk usage in quota "system": 186.12 Gb
Disk usage in quota "user": 215.81 Gb


<conflit-change-quota-size> *user-quota*
HOWTO artificially reduce the size of the user quota of the planner

Edit `flash0/fs/NDS/config/rmf.cfg` and change max_size in section.

[quota1_internal]
conflictCriticalLimitInMinutes=3
conflictThresholdLimitInMinutes=7
max_size_units="MB"
max_size=4000
partition_name="RECORDING"
quota_name="user"
quota_type="user_type"
statistics_required=1
strategy="Fixed"


note: The user quota do not use size_unit to set size since set it with all
remaining size. Have to use max_size with real size or do have calc in code.

max_size_units="MB"
max_size=4000

104857600     100(1024*1024)

Do two things:

1.
QuotasOnDevice_Add: 
        /* max_size entry should be present for all strategies expect for
         * units: Remaining, system limitation, system quota per model,
         * Recycle */
        if ((info.strategy != RMF_QUOTA_STRATEGY_REMAINING) &&
                (info.strategy != RMF_QUOTA_STRATEGY_SYSTEM_QUOTA_LIMITATION) &&
                (info.strategy != RMF_QUOTA_STRATEGY_NO_SIZE_SET))
        {
        }
        else
        {
            info.max_size = i64zero;

            // KIT
            if (strcmp(info.type, "user_type") == 0) 
            {
                raw_size = 1000;
                info.max_size = i32_to_xint64_t(0, raw_size);
                DIAG_LOG_ERROR(gRmfSegmentId, ("KIT: <%s> raw_size: %u, max_size: %u,%u(high,low) ",
                            info.name,
                            raw_size,
                            xint64_t_high(&info.max_size),
                            xint64_t_low(&info.max_size)));

            }
        }

2. QuotasOnDevice_SetSizes()
comment out this in QuotasOnDevice_SetSizes() since this do calc and set
user quota with the remaining size
// KIT: DO NOT SET WITH REMAINING SIZE
// quotas[Idx]->creationInfo.max_size = remainingSize;


// CMS_SYSTEM_RESOURCE/RMF/src/plugins/quota_resource.c
// reads rmf.cfg and set values for all quotas
QuotasOnDevice_Add(SYSTEMCOMMON_DEVICE_HANDLE device_handle)

// reads from pdm but not uses model configuraton. use stragegy.
PRVFUNC SYSTEM_STATUS QuotasOnDevice_SetSizes(SYSTEMCOMMON_DEVICE_HANDLE device_handle)

    /* get the size of recording partition on disk  */
    stat = QuotasOnDevice_GetPartitionSize(device_handle,
            quotas[quotas_count-1U]->creationInfo.partition_name,
            &partitionSize);

!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_Add L:03773 > quota[3] name recycle device_handle: 0x6, disk_uid  part_id 0x50003
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_GetPartitionSize L:04557 > PDM partition size  465,3228270592(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_GetPartitionSize L:04568 > 1TB is in bytes: 256,0(high, low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_GetPartitionSize L:04614 > DATA part size in bytes: 2,2212160949(high, low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_GetPartitionSize L:04620 > Final stream partition size in bytes: 463,1016109643(high, low)

!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04159 > manufactured HDD size in GiB 1500
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04167 > device size in GB (10^9 bytes) 2000
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04238 > The current model is not part of the exception.

!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_LimitQuotaSize L:04052 > quota: <user> max_size is 0,1000(high,low)

!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04466 > quota user: size: 0,1000(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04466 > quota system: size: 83,3526103040(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04466 > quota NDS_Dynamic: size: 9,1345294336(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04466 > quota recycle: size: 0,0(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04481 > partitionSize: 463,1016109643(high,low), all quotas size: 93,576431080(high,low)
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04497 > quota[0]: <user> max size = 0,1000(high,low) on device handle 0x6
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04497 > quota[1]: <system> max size = 83,3526103040(high,low) on device handle 0x6
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04497 > quota[2]: <NDS_Dynamic> max size = 9,1345294336(high,low) on device handle 0x6
!INFO  -RMF < T:RMF_Server M:quota_resource.c F:QuotasOnDevice_SetSizes L:04497 > quota[3]: <recycle> max size = 0,0(high,low) on device handle 0x6


={============================================================================
|kt_dev_si_0001| comp-rmf-conclict-disk-full

https://www.stb.bskyb.com/jira/browse/SI-10688

Here two problem:
  * live pause unavailable when disk is full
  * recording from review buffer failed when disk is full

<live-pause>

"Live pause is not available.
There is currently insufficient disk space.
Press BACK UP to cancel."

Shows the dialog when disk is near full. Log shows that when a pause key is
pressed for a long time and live pause is going on while other recording is
going on. Log shows there are conflicts which keeps deleting or stoping
recordins to make a space and eventually stop a RB.

// tune first
 65143:!MIL    -EPG_ME < T:no name M:MediaEngine F:playService L:1498 > T:PooledExecutor#4:TUNING TO Eurosport 1 HD, 410 locator:5:3:FA4

 70234:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x2010256(0)[Rb] UI NOT  required 
 71604:!MIL    -aem    < T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(PAUSE)e401 
 77329:!MIL    -aem    < T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(PAUSE)e401 
208922:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x2010271(0)[R] 
208950:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x2010271(0)[R] UI NOT  required 
209463:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x2010272(0)[R] 
209491:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x2010272(0)[R] UI NOT  required 
327749:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x2010285(0)[R] 
327777:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x2010285(0)[R] UI NOT  required 
329001:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x2010286(0)[R] 
329029:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x2010286(0)[R] UI NOT  required 
441291:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x201029b(0)[R] 
441319:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x201029b(0)[R] UI NOT  required 
445309:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x201029b(0)[R] 
445337:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x201029b(0)[R] UI NOT  required 
446251:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x201029b(0)[R] 
446279:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x201029b(0)[R] UI NOT  required 
448462:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type `TriggerWarning` on 0x201029b(0)[R] 
448490:!MIL    -RMF    < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x201029b(0)[R] UI NOT  required 

// tune second
564660:!MIL    -EPG_ME < T:no name M:MediaEngine F:playService L:1498 > T:PooledExecutor#2:TUNING TO Eurosport 1 HD, 410 locator:5:3:FA4

// start rb
565347:!MIL    -VRM_SERVER < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4947 > VRM_JOB_START: jtVRM=jb-rbrec, jhVRM=0x3000014 
565350:!MIL    -RMF        < T:VRM_SRV M:shrec_group_manager.c F:RMP_SHREC_GROUP_MANAGER_TriggerGetShrec L:381 > Job `0x20102c1`(0)[Rb] - shrec found: 0x0 

// note: did not get premissions
565355:!MIL    -RMF     < T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x20102c1(0)[Rb] request=0x10000008 released=`0xf0000000` change request if fails. 
565503:!MIL    -RMF     < T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x20102c1(0)[Rb] request=0x10000008 released=0xf0000000 change request if fails. 

571468:!MIL    -MDM     < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x469 hMC=0x8e tuner_id =0 and job_type =LIVE_VIEWING 
571469:!MIL    -MDM     < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x46c hMC=0x8f tuner_id =0 and job_type =RECORD 
571470:!MIL    -MDM     < T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x4db hMC=0x91 tuner_id =1 and job_type =RECORD 

577323:!MIL    -RMF     < T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Construct L:994 > Building conflict of type `FailAssign` on 0x20102c4(0)[R] 
577349:!MIL    -RMF     < T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Resolve L:2234 > Adding job 0x20101da to `Auto resolution` 
577351:!MIL    -RMF     < T:VRM_SRV M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20102c4(0)[R] UI NOT  required 

// conflict on rb
580427:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x20102c1(0)[Rb] 

// delete rb
580453:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Resolve L:2333 > Stopping subject 0x20102c1(0)[Rb] because there are no candidates 

580455:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20102c1(0)[Rb] UI NOT  required 
580946:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x20102c4(0)[R] 
580972:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Resolve L:2233 > Adding job 0x20101dc to Auto resolution 
580974:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20102c4(0)[R] UI NOT  required 
586603:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:994 > Building conflict of type TriggerWarning on 0x20102c4(0)[R] 
586629:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Resolve L:2233 > Adding job 0x20101e5 to Auto resolution 
586631:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20102c4(0)[R] UI NOT  required 
588826:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:993 > Building conflict of type TriggerWarning on 0x20102c4(0)[R] 
588852:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Resolve L:2233 > Adding job 0x20101e6 to Auto resolution 
588854:!MIL    -RMF     < T:RMF_Server M:quota_immediate_conflict.c F:QIC_Construct L:1027 > Conflict on 0x20102c4(0)[R] UI NOT  required 

599193:!MIL    -VRM_SERVER < T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Destroy L:1601 > @@PMON@@,mark,job,job-destroy,50331668,job-destroy-type=,jb-rbrec 

593555:!ERROR  -EPG_DEV1 < T:no name M:NotificationConverter F:setLastScreenSeen L:11 > 
  T:CEE-J EventQueue Reader 0:setting last screen seen to /tv/live/410/live_pause_not_available_insufficient_disk_space_id
593556:!MIL    -EPG_MISC < T:no name M:MilestoneNotifier F:send L:21 > 
  T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/410/live_pause_not_available_insufficient_disk_space_id"}
593576:!MIL    -EPG_MISC < T:no name M:MilestoneNotifier F:send L:21 > 
  T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "REWIND","title": "Key Press REWIND","label": "","currentscreen": "/tv/live/410/live_pause_not_available_insufficient_disk_space_id"}
594132:!MIL    -aem      < T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(PAUSE)e401 


From docs:

1. Live pause failure

!MIL    -EPG_DLG      		< p:0x00000330 P:APP t:0x2ec53520 T:no name M:DialogManager F:showDialog L:1415 > T:CEE-J EventQueue Reader 0:Showing dialog 1030
!MIL    -EPG_DEV1     		< p:0x00000330 P:APP t:0x2ec53520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /tv/live/106/live_pause_not_available_id

!MIL    -EPG_DEV1     		< p:0x0000032e P:APP t:0x2ec53520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /tv/live/107/live_pause_not_available_insufficient_disk_space_id
!MIL    -EPG_DEV1     		< p:0x0000032e P:APP t:0x2ec53520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /tv/live/107/live_pause_not_available_insufficient_disk_space_id

This scenario happens when disk space is near full and there are multiple
recording on including live pause. Disk conflicts happens continually while
`deleting low priority recording from user quota` according to the defined
priority and eventually stops RB to make space available when there are no
other recordings to delete. These all done by rule which is defined for Darwin
profile and the important snippet reads:

    When an active Review Buffer or Live Pause recording encounters a disk
    conflict, the PVR always stops the Review Buffer recording, unless the
    resolution mode is set to Auto.  

    If the resolution mode is "Auto," the PVR deletes viewed non-PPV
    recordings which are not set to Keep or Copy, to make way for the Review
    Buffer. If no such recordings exist, then the review buffer recording is
    stopped. The Review Buffer will not be automatically resumed until a
    subsequent channel change occurs.

See 

1.	XT-T314	8.0	Conflict Rules for Multiple Simultaneous Recordings
Table 5	Primary Priorities for Recording Retention


This matches to the RMF code:

            /* MSCQ494756 - do not stop ongoing recording when threshold limit is reached */
            SYSTEMJOB_Type jobType = RMF_JOB_Instance_GetType(subjectJob);
            if ( (jobType == SYSTEMJOB_TYPE_RB_RECORD) || (jobType == SYSTEMJOB_TYPE_IPTV_RB_RECORD)
                    || (jobType == SYSTEMJOB_TYPE_TRANSCODING_RECORDING))

            {
                stat = AddStopInstruction(subjectJob, SYSTEM_EXCEPTION_TYPE_INSUFFICIENT_DISK_SPACE);
                STATUS_CHECK_AB(stat);
                resolutionSet = true;
            }


<recording-fail-when-disk-space-auto>
This is a recording from review buffer which showed as failed when:

[Paul] Go to the planner, select the failed recording and press the i button.
It gives the reason for the failure as lack of disk space. For the daily
  report we get the information from the UPnP data

However, no PCAT entry and hence no errors in PCAT.

WP775 - Extend Recording with Full Disk

The issue to slove:

"In some circumstances, after tuning to a channel which is already being
recorded, it is not possible to rewind back into the recording from the
current live viewing point. This happens when the disk is full and a review
buffer exists. The issue arises when VRM requests RMF for permission to extend
a recording and it is refused."

Here "extend" means that "extend" RB to make it possible to "rewind back"

This occurs because of the following:

* When the user tunes to a channel, it a Record RB is created..

* If that channel is recording, the review buffer’s vfile shares the pfile
  being used for that recording.

* It is possible for the user to use reverse play trick modes to move to the
  beginning of the recording (as opposed to selecting the recording in
  Planner). This is implemented by updating its shrec to extend the RB’s
  vfile back to the beginning of the recording.

* During this extension, RMF checks for a disk quota conflict. In computing
  the disk requirements, RMP does not take into account that the ongoing
  recording and the review buffer share a pfile . Therefore, if the disk is
  close to being full, the request for the extension may result in a conflict.

* Although RMF can resolve quota conflicts by deleting recordings [7], the
  current VRM/RMF implementation does not support this for extension requests.
  Consequently, the review buffer fails, requiring the user to retune to a
  different channel for it to be re-established.

Although it was considered to apply the current conflict rules [7] to resolve
quota extension conflicts, this could result in rewinding within the review
buffer to delete, say, 8 hours of partially viewed recordings without any
warning to the user. Therefore, this WP will only delete recordings from the
recycle quota to resolve quota extension conflicts. This eliminates the impact
that the introduction of the “undelete” feature has on the RB.

7.	XT-T314	8.0	Conflict Rules for Multiple Simultaneous Recordings

note:
My understanding is that when disk management is auto, it uses [7] to delete
recordings to make a space. However, this may delete a recording that RB uses
to extend since it's marked "viewed". This WP ensures that this RB extension
uses only "recycled quota" which seems to be kind of virtual quota. 

If this is physical quota, deletion moves a recording from user to recycled
then user already has a space!

From:
WP1965 - Planner Undelete - Disk Quota Management

RMF implementation of Recycle disk quota includes fully `overlapping` with user
disk quota, and ensure disk usage is apportioned correctly to these quotas.

RMF extends the priority rules for Disk Space conflicts to prioritise deletion
of jobs in the Recycle disk quota `above` jobs in the User disk quota.  RMF
should always exhaust the Recycle disk quota before considering jobs for
deletion in the User disk quota.

RMF disk conflict rules for RB recording are changed to auto-resolve disk
space conflicts by removing jobs from the Recycle disk quota.

note:
This WP is applied HR015.


<nvram-txt>

 ~~~ Record Properties
Start Guard Time          = 0x0000 (0) 
End Guard Time            = 0x0000 (0) 
Auto Start Guard Time     = 0x0002 (On) 
Auto End Guard Time       = 0x0002 (On) 
Deletion Mode             = 0x0001 (Automatic) 


={============================================================================
|kt_dev_si_0001| comp-rmf-conclict-tune

*si-jira* SI-10601

"The reason of failure is No tuner Available and Technical fault - 10 (28)"

To resolve the imminent tuner conflict in favor of going ahead with both
recordings, picasso needs to tune away from the event it is currently tuned
to.

In order to determine what to tune to Picasso :

1: Prioritizes the event it wishes to tune to (picks one of the recordings
    channels according to business rules).

2: Makes a call to middleware to retrieve a list of "Tuning Options", checks
if the prioritized event is contained in the TuningOptions result set, and
  tunes to it if it is.

3: If the prioritized event is not contained in the result set then it tunes
to the first event in the tuning options list.

In the failure scenario, what we are seeing is that picasso fails to find it's
`prioritized event` (one of the two recordings) in the `tuning options` result
set. We then pick the `first event` from the tuning options and tune to that.
In this failure scenario, It appears that this event is also not one of the
recordings. This is what causes the failed recording.

If the assumption is incorrect - then how can we ensure that both recordings
are made ?

the assumption made by EPG is `correct` i.e. TuningOptions will contain the
recording event that `caused` the conflict. 


<case>
This is okay case when there is right options.

???, UEFA           |
136, records        | 
                    | 133, failed record
                    | 164, okay

Seen|Rec |2016:06:16 22:28:00|2016:06:16 23:00:36|The Big Bang Theory                     | s1221|  136| 100|E4 HD        | rec x
Book|Rec |2016:06:16 22:57:00|                   |Rick Stein's Food Heroes:...            |      |  133| 15 |Good Food HD | rec 1
Seen|Rec |2016:06:16 23:00:04|2016:06:16 23:31:59|Bullseye                                | s1222|  164| 100|Challenge+1  | rec 0

 15: NO_TUNER_AVAILABLE
 28: UNKNOWN_ERROR

// On ??? which is live. Gets conflict between 136 against 133 and 164.
// "MOTD: UEFA Euro 2016 Highlights" is on and see conflict with 133 and 164

^[2016:06:16 22:58:53]
-EPG_CONF < M:ImminentTunerConflict F:retrieveSuccess L:243 > T:CEE-J EventQueue Reader 0:Subject created `for` -  MOTD: UEFA Euro 2016 Highlights
-EPG_CONF < M:EpgConflict F:getConflictEvent L:193 > T:CEE-J EventQueue Reader 0:Created ConflictEvent Bullseye
-EPG_CONF < M:EpgConflict F:getConflictEvent L:193 > T:CEE-J EventQueue Reader 0:Created ConflictEvent Rick Stein's Food Heroes:...
 
// `first-conflict` from ???
// EPG shows conflict dialog, choose 133, prioritizedEvent, and get tuning
// options from MW 

*rmf-conflict-dialog*
-EPG_DLG < F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1004

^[2016:06:16 22:59:03]
-EPG_CONF < M:ConflictTuner$1$1 F:run L:125 > T:PooledExecutor#2:prioritizedEvent guide service is Good Food HD, 133
-EPG_CONF < M:ConflictResolver F:instructionEventReceived L:426 > T:PooledExecutor#1:*** INSTRUCTION EVENT ***

-P_Api    < F:PLAYER_API_Session_CreateLiveTuningOptionsList L:8774 > SI_BUILD_TEST: i = 0, tuning options service locator(URI) = locator:5:3:10EC 
-P_Api    < F:PLAYER_API_Session_CreateLiveTuningOptionsList L:8774 > SI_BUILD_TEST: i = 1, tuning options service locator(URI) = locator:5:3:FE3 
-EPG_CONF < M:TuningOptions F:containsEvent L:30 > T:PooledExecutor#1:Found cached serviceLocator in tuning options list at (index = 1)

// <rec-1> 133
^[2016:06:16 22:59:54]
-EPG_ME   < F:playService L:1485 > T:PooledExecutor#1:TUNING TO Good Food HD, 133 locator:5:3:FE3

// <second-conflict> for 133 against 164 and 136

-EPG_CONF < M:ChannelChangeConflict F:retrieveSuccess L:175 > T:CEE-J EventQueue Reader 0:Subject created for -  Rick Stein's Food Heroes:...
-EPG_CONF < M:EpgConflict F:getConflictEvent L:193 > T:CEE-J EventQueue Reader 0:Created ConflictEvent Bullseye
-EPG_CONF < M:EpgConflict F:getConflictEvent L:193 > T:CEE-J EventQueue Reader 0:Created ConflictEvent The Big Bang Theory
-EPG_CONF < M:ChannelChangeConflict F:displayDialogOrAutoTune L:240 > T:CEE-J EventQueue Reader 0:Auto tuning

// EPG gets options list returns one of the recording events. But one of them
// is not a recording event(locator:5:3:FEC)

-P_Api    < F:PLAYER_API_Session_CreateLiveTuningOptionsList L:8774 > SI_BUILD_TEST: i = 0, tuning options service locator(URI) = locator:5:3:10EC 
-P_Api    < F:PLAYER_API_Session_CreateLiveTuningOptionsList L:8774 > SI_BUILD_TEST: i = 1, tuning options service locator(URI) = locator:5:3:FEC

// <136>
-EPG_ME   < M:MediaEngine F:playService L:1485 > T:PooledExecutor#4:TUNING TO E4 HD, 136 locator:5:3:FEC
-EPG_ME   < M:MediaEngine F:channelChanged L:2027 > T:PooledExecutor#0:CHANNEL CHANGED TO E4 HD, 136

-EPG_CONF < M:ConflictResolver F:instructionEventReceived L:426 > T:PooledExecutor#3:*** INSTRUCTION EVENT ***
-EPG_CONF < M:ConflictAuthorizer F:mapInterestingStatusValues L:237 > T:PooledExecutor#2:Conflict check complete - CONFLICT STATUS = OK


<rmf-conflict-resolve-log>
!MIL    -EPG_CONF     < M:EpgConflict F:commitResolution L:205 > 
  T:PooledExecutor#0:Committing resolution type 3


We have analysed the logs so far. The current understanding is as follows

LIVE      |
REC0      | overrun by 8 seconds..
          | REC1 | REC3
          | REC2 | REC4

    `get-first-conflit`

    1. We have LIVE and recording (REC0) till the time of conflict, and 2 more
    recordings set to start at the same time (REC1 and REC2)

    2. Just before the new recordings start and imminent conflict is raised
    with REC1 and REC2 in suggestion list

    3. No action is taken as we do not have any user here, which means that
    displayed OSD times out when REC0 is scheduled to end and REC1/REC2 are
    scheduled to start

    4. As OSD timeout, there is general strategy in EPG to set the conflict as
    `resolved` with no recordings marked for deletion since the idea is that
    LIVE would be one of the recordings. Therefore, protection removed from MW
    RMF.

    5. EPG decides to tune to one of the recording channels (REC1) from the
    list of recordings available from conflict and queries MW for tuning
    options. The idea is to `double-check` that channel we are trying to tune is
    in the options. 

    6. However, in this instance tuning options returns REC0 and REC2 (because
        REC0 has overrun), which means that EPG would now have to choose one
    of these two. 

    7. EPG makes choice to tune to REC0

    "EPG resolve the first conflict (imminent tuner) in favor of making the
     two new recordings by attempting to tune to one of them."

    "The epg prioritizes the event to tune to here and we end up tuning to the
    event which has overrun - which means one of the other recordings will
    correctly not go ahead.
    
    When there is no user intervention via the conflict dialog, the default
    behavior in R-11 is now to continue to record the over-run recording."

    `get-second-conflict`

    8. Right at that time REC0 finishes, i.e. just before EPG would attempt to
    tune to REC0

    9. Since REC0 has finished tuner is allocated for REC1 so we get a
    channel-change conflict as REC1 and REC2 are about to start, tuning to
    REC0 channel would cause conflict

    10. The new channel change conflict is notified to EPG

    `no channel change from EPG`

    11.There is no apparent action taken on this new conflict, as LIVE channel
    never changes. This is because the general strategy for channel change
    conflict is to cancel conflict (calling Commit API with CANCEL parameter)
    and remain on the same channel

    "This is standard behavior for the EPG perspective when a dialog times out
    on a channel change conflict."

    note:
    Due to overrun event, no live changes from EPG and therefore record
    failing is expected under current EPG design.

    This results in REC1 failure and REC2 continues. 
    
    note:
    Difference on R11.

    "As stated at the beginning of this comment, in R-10, prior to the EPG
    changes to retrieve/check against the tuning options - we would have
    `blindly` tuned to REC1 in this scenario.  This would have resulted in the
    recordings being successful on REC1 and REC2 - but we would have lost the
    over-run portion of the recording. These changes were introduced to
    address an issue whereby the EPG ended up locked out of one tuner
    completely so the changes are necessary.

    For more why EPG can lockup the tuner from R10:
    https://www.stb.bskyb.com/jira/browse/SCR-12659
    

    note:
    Up to this this explains NO_TUNER_AVAILABLE on failed records and
    contiunes on "28: UNKNOWN_ERROR"

    REC3 and REC4 are set to
    start when REC2 finishes and should cause a conflict with LIVE. However,
    there is no raised conflict

    note:
    Question is why MW not raise conflict on REC3 and REC4?

    It appears that since channel-change conflict was never resolved MW is not
    going to raise another conflict.


On why MW not raise conflict?

RMF state machine maintains a `protector state` variable, only when this is
set to `enable`, it raises a conflict.

By default, on a channel change this is set to Enable, but this will be set to
Disable when an Imminent tuner conflict is resolved.

In most of the cases the recordings are successful because on an imminent
tuner conflict, EPG tunes away from the current Live channel.

In the failure case, although it initiates a Tune to GOLD, but the tune
request is not completed as RMF raises a channel change conflict. EPG resolves
the channel change conflict by staying back on the same channel. This means
protector state variable is Disable and no conflict will be raised until a
channel change is performed. 

EPG:
The current behaviour for a channel-change conflict dialog time-out is to "to
cancel the new channel change to resolve the conflict". 
 
When the channel-change dialog times out, Picasso calls mw to resolve the
conflict by:
PLANNER_API_Conflict_CommitConflictResolution(PLANNER_API_CONFLICT_RESOLUTION_CANCEL);

PLANNER_API_CONFLICT_RESOLUTION_CANCEL

means "cancel the new channel change to resolve the conflict." according to
the planner header file.


What is actually happening?

No conflict is raised at step 13 for REC3 and REC4 to start

Why is Middleware not raising conflict? 

This is because on step 3 LIVE is marked as not-protected. As a result of this
MW has the impression that it has lower priority so it can’t be causing any
conflict for recordings to start

How did it work earlier?

The reason this used to work is that we used to tune to one of the recordings.
It was felt that this was a blind tune and I think we could lose some of the
end of REC0.  So we were asked to request the tuning options. That is why
behaviour has changed.


Where is the crux of the problem?

The main step that is causing problem here is that when EPG tries channel
change we get a channel-change conflict, which means EPG backs out and remain
on the channel where it is now.  This is the first time we have run into this
scenario because prior to asking for tuning options since EPG would always
tune to one of the recording channels there would be no channel change
conflict.  When resolution for imminent conflict was committed at step 4, with
advanced option and no recordings is marked for deletion. This is an
indication that Middleware does not need to do anything and EPG would be
moving LIVE to channel that does not cause any tuner conflicts. Without this
successful movement of LIVE to non-conflicting channel the resolution would
not be complete.  

What can be done now?  

The simplest way to handle this situation is to make sure that channel-change
conflict is handled in a slightly better way.


={============================================================================
|kt_dev_si_0001| comp-vrm

// Dan Toubiana
COMPONENT_NAME := vrm_server

// try this to get detailed MILs
#ifdef MW_DETAILED_MILESTONE_DEBUG

<vrm-job-type>
typedef enum SYSTEMJOB_TYPE_TAG
{
    SYSTEMJOB_TYPE_UNDEF = 0,
    SYSTEMJOB_TYPE_SCAN,               /*!< @brief manual or frequential scan to acquire SI */
    SYSTEMJOB_TYPE_CAPTURE,            /*!< @brief generic job for SI, carousel, software downloads */
    SYSTEMJOB_TYPE_LIVE_VIEWING,       /*!< @brief live viewing job "3" */
    SYSTEMJOB_TYPE_IP_VOD_PLAYBACK,    /*!< @brief IP VOD playback job */
    SYSTEMJOB_TYPE_RB_RECORD,          /*!< brief review buffer record job. "5" */
    SYSTEMJOB_TYPE_RB_PLAY,            /*!< brief review buffer play job "6" */
    SYSTEMJOB_TYPE_RECORD,             /*!< @brief record job. "7" */
    SYSTEMJOB_TYPE_REMINDER,           /*!< @brief reminder job */
    SYSTEMJOB_TYPE_PLAYBACK,           /*!< @brief playback job "9" */
    SYSTEMJOB_TYPE_LIVE_RESERVATION,   /*!< @brief live reservation job type "10" */
    SYSTEMJOB_TYPE_DOWNLOAD,           /*!< @brief download job */
    SYSTEMJOB_TYPE_DOWNLOAD_RESET_JOB, /*!<@brief sw download reset job */
    SYSTEMJOB_TYPE_PASSIVE_STANDBY,    /*!<@brief Passive Standby job */
    SYSTEMJOB_TYPE_AUTOMATIC_SYSTEM_MAINTAINANCE_TASK,    /*!<@brief scheduled system maintenance job */
    SYSTEMJOB_TYPE_MANUAL_SYSTEM_MAINTAINANCE_TASK,    /*!<@brief scheduled system maintenance job */
    SYSTEMJOB_TYPE_SW_UPDATE_SCAN,     /*!<@brief sw download scan job  */
    SYSTEMJOB_TYPE_BDL_RECORD,         /*!< @brief BDL (Broadcast Download) record job */
    SYSTEMJOB_TYPE_LIVE_TO_HTTP,       /*!< @brief destination of this job will be a Network Destination Locator */
    SYSTEMJOB_TYPE_PLAY_TO_HTTP,       /*!< @brief destination of this job will be a Network Destination Locator */
    SYSTEMJOB_TYPE_STREAM_FROM_HTTP,   /*!< @brief destination of this job will be an Output Device Locator*/
    SYSTEMJOB_TYPE_PLAY_FROM_HORIZONTAL_FILE,     /*!< @brief play from horizontal file */    
    SYSTEMJOB_TYPE_OTT_ABR_LIVE,                  /*!< @brief OTT(Over the Top) adaptive bitrate live job */
    SYSTEMJOB_TYPE_PLAY_NFF_TO_HTTP,              /*!< @brief play NFF to HTTP */
    SYSTEMJOB_TYPE_LAST
} SYSTEMJOB_Type;


<comp-vrm-status> *comp-status*
F:RecordActionFsmOnExit L:4661 > input = PANEL_CONFIGURE, new state = CONFIGURING, last_status = [ASM:interface(3):SEVERE:status(6)(0x6)][(243412998)(0x0E823006)] 

// get comp id
(0x0E823006 >> 22) & 0x3FF

// get if id
(0x0E823006 >> 12) & 0xF

// get severity
(0x0E823006 >> 16) & 0x3

// get status
(0x0E823006) & 0xFFF


<vrm-job-handle>
/** @brief The VRM job handle.
 @note VRM jobs differ from RMF jobs. A VRM job will typically create an RMF job.
 @note The VRM jobs have a number of properties, One of them is an RMF job handle that the caller receives via the VRM job Media Status object.
 */
typedef uint32_t VRM_JOB_HANDLE;
#define VRM_JOB_HANDLE_ILLEGAL  (0xFFFFFFFFU) /*!< @brief An illegal value for a VRM job handle. */


// CMS_MEDIA_SERVICES/VRM/src/common/interface/job_man_clnt.c
VRM_JOB_Create(SYSTEMJOB_TYPE_RB_RECORD, l_vrm_params, PLAYER_RB_EventListener, &l_rb_data->vrm_handle)

// client_id
// CMS_MEDIA_SERVICES/VRM/src/server/manager/client_man.c
VRM_SERVER_CLIENT_ID VRM_SERVER_AllocateClientID(void) 
{
	VRM_SERVER_CLIENT_ID new_client_id	= 0U;

	DIAG_DECLARE_FUNCTION("VRM_SERVER_AllocateClientID");
	DIAG_LOG_FN_ENTRY(VRM_diag_segment_id);

	/* ClientManCounter initialized to 0, which is legal as the first client_id */
	new_client_id = ClientManCounter++;

	DIAG_LOG_INFO( VRM_diag_segment_id,("ended. allocated client_id = 0x%x", new_client_id) );

	return new_client_id;
}

NDS: ^[2017:06:23 11:12:20]0946684904.115200 !INFO   -VRM_SERVER   		< p:0x000001f0 P:MW t:0x01ec8520 T:VRM_SRV M:client_man.c F:VRM_SERVER_AllocateClientID L:218 > ended. allocated client_id = 0x0 
NDS: ^[2017:06:23 11:12:20]0946684904.122206 !INFO   -VRM_SERVER   		< p:0x000001f0 P:MW t:0x01ec8520 T:VRM_SRV M:client_man.c F:VRM_SERVER_AllocateClientID L:218 > ended. allocated client_id = 0x1 
NDS: ^[2017:06:23 11:12:20]0946684904.122225 !INFO   -VRM_SERVER   		< p:0x000001f0 P:MW t:0x01ec8520 T:VRM_SRV M:job_man_srv.c F:JOB_MAN_SRV_Init L:3383 > client id that will be used for jobs restoration is: 1 

SYSTEM_STATUS VRM_JOB_Create(SYSTEMJOB_Type job_type,
							 VRM_JOB_PARAM_DATA_HANDLE paramDataHandle,
							 VRM_JOB_EVENT_LISTENER job_event_listener,
							 VRM_JOB_HANDLE * pJob_handle)
{
	/* Create new job handle for the job. */
	if (SYSTEM_STATUS_IS_OK(stat)) {
		stat = JobManClntCreateJobHandle (&new_job_handle)
      {
        // >>> hex(2 << 24|1)
        // '0x2000001'
        /* set MSB to be client id to ensure job handle is unique */
        new_job_handle = job_handle_counter | ((uint32_t)client_id << 24);
        *job_handle = new_job_handle;
      }
	}

  stat = VRM_JOB_SERVER_Create (client_id, job_type, paramDataHandle, 
      new_job_handle, client_listening);

	/* set return value */
	if (SYSTEM_STATUS_IS_OK(stat)) {
		*pJob_handle = new_job_handle;
	}
}

// matches to
!MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=3, jhVRM=0x30003f3

// client_id matches to job_handle
!INFO   -VRM_SERVER T:SBM_UB_MAIN M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x2000001, client_id = 0x2, job_type = SYSTEMJOB_TYPE_LIVE_VIEWING, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x3000001, client_id = 0x3, job_type = SYSTEMJOB_TYPE_LIVE_VIEWING, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x3000002, client_id = 0x3, job_type = SYSTEMJOB_TYPE_RB_RECORD, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:SBM_UB_MAIN M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x2000002, client_id = 0x2, job_type = SYSTEMJOB_TYPE_LIVE_VIEWING, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x3000003, client_id = 0x3, job_type = SYSTEMJOB_TYPE_LIVE_VIEWING, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:SBM_UB_MAIN M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x2000003, client_id = 0x2, job_type = SYSTEMJOB_TYPE_LIVE_VIEWING, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x3000004, client_id = 0x3, job_type = SYSTEMJOB_TYPE_RB_RECORD, [VRM:STATUS_OK 0x0B400000]
!INFO   -VRM_SERVER T:SBM_UB_MAIN M:job_man_srv.c F:VRM_JOB_SERVER_Create L:1589 > ended. job_handle = 0x2000004, client_id = 0x2, job_type = SYSTEMJOB_TYPE_RECORD, [VRM:STATUS_OK 0x0B400000]


// CMS_MEDIA_SERVICES/VRM/src/server/manager/job_man_srv.c
SYSTEM_STATUS VRM_JOB_SERVER_Create(VRM_SERVER_CLIENT_ID client_id,
        SYSTEMJOB_Type job_type,
        VRM_JOB_PARAM_DATA_HANDLE paramDataHandle,
        VRM_JOB_HANDLE  job_handle,
        bool client_listening)
{
}

NDS: ^[2017:06:23 13:15:52]0946692316.631392 !MIL    -VRM_SERVER   		< p:0x000001f0 P:MW t:0x0210b520 T:SBM_UB_MAIN M:fsm.c F:FSMRun L:917 > VRM-FSM: job_man:0x200000d: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
*booking-source*
NDS: ^[2017:06:23 13:15:52]0946692316.631504 !INFO   -VRM_SERVER   		< p:0x000001f0 P:MW t:0x0210b520 T:SBM_UB_MAIN M:booking_record.c F:BOOKING_RECORD_Create L:2036 > got booking source = 1 for record & BDL jobs, stat [VRM:STATUS_OK 0x0B401000] 


16649:NDS: ^[2017:06:23 16:58:19]0946685201.690820 !INFO   -VRM_SERVER   		< p:0x00000251 P:MW t:0x01f1b520 T:VRM_SRV M:job_man_srv.c F:JobManSrvGetRmfJobHandle L:11970 > jtVRM=7, jhVRM=0x1000076 Rmf job handle = 0x2010079, stat = 0xb400000\n 


<vrm-tune-to-live> <player-tune-to-live>
grep -an "PLAYER_API_Session_Play|PLAYER_PRV_Session_Play|PLAYER_AVControl_UpdateVisibility|VIDEO_RUNNING_STATUS"

// Now it shows job-type as string
// #define DIAG_PMON_SYSTEMJOB_TYPE_RB_RECORD          "jb-rbrec" 				/*!< brief review buffer record job */


*vrm-job-handle*
// `live` uses `vrm-job-handle` across components
// maps `VRM-FSM: job_man:0x300009a` -> `pleLive and hMC`
//
// SYSTEMJOB_TYPE_LIVE_VIEWING,  3

*tune-request* comp-locator

// source locator is the saem for a channel
// 5020793:NDS: ^[2018:03:26 11:44:36]0000005657.302006 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "101"   "BBC One Lon"
// 5021225:NDS: ^[2018:03:26 11:44:36]0000005657.382459 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live, jhVRM=0x3000003 
// 5021226:NDS: ^[2018:03:26 11:44:36]0000005657.383315 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:7D2,job-destloc=,locator:3:2E:92:0 
// 5021596:NDS: ^[2018:03:26 11:44:36]0000005657.458720 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "101"   "BBC One Lon"
// 5026856:NDS: ^[2018:03:26 11:44:41]0000005662.285039 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(5)e305('5') sent to 'com.bskyb.epgui'
// 5027013:NDS: ^[2018:03:26 11:44:41]0000005662.933794 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(0)e300('0') sent to 'com.bskyb.epgui'
// 5027199:NDS: ^[2018:03:26 11:44:42]0000005663.587824 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(3)e303('3') sent to 'com.bskyb.epgui'
// 5027218:NDS: ^[2018:03:26 11:44:42]0000005663.599248 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "503"   "BBC NEWS HD"
// 5027672:NDS: ^[2018:03:26 11:44:42]0000005663.683266 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live, jhVRM=0x3000004 
// 5027673:NDS: ^[2018:03:26 11:44:42]0000005663.684207 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:825,job-destloc=,locator:3:2E:92:0 
// 5027676:NDS: ^[2018:03:26 11:44:42]0000005663.684368 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4878 > After LIVE_Create call. live_handle LIVE(0x300), [VRM:STATUS_OK 0x0B400000], jhVRM=0x3000004 
// 5027810:NDS: ^[2018:03:26 11:44:42]0000005663.720280 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "503"   "BBC NEWS HD"
// 5032298:NDS: ^[2018:03:26 11:44:47]0000005668.184945 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(1)e301('1') sent to 'com.bskyb.epgui'
// 5032454:NDS: ^[2018:03:26 11:44:47]0000005668.798845 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(0)e300('0') sent to 'com.bskyb.epgui'
// 5032637:NDS: ^[2018:03:26 11:44:48]0000005669.321715 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(1)e301('1') sent to 'com.bskyb.epgui'
// 5032658:NDS: ^[2018:03:26 11:44:48]0000005669.339168 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "101"   "BBC One Lon"
// 5032957:NDS: ^[2018:03:26 11:44:48]0000005669.393082 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live, jhVRM=0x3000005 
// 5032958:NDS: ^[2018:03:26 11:44:48]0000005669.394053 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:7D2,job-destloc=,locator:3:2E:92:0 
// 5032961:NDS: ^[2018:03:26 11:44:48]0000005669.394258 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4878 > After LIVE_Create call. live_handle LIVE(0x401), [VRM:STATUS_OK 0x0B400000], jhVRM=0x3000005 
// 5033094:NDS: ^[2018:03:26 11:44:48]0000005669.438079 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "101"   "BBC One Lon"
// 5038099:NDS: ^[2018:03:26 11:44:53]0000005674.125723 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(5)e305('5') sent to 'com.bskyb.epgui'
// 5038144:NDS: ^[2018:03:26 11:44:53]0000005674.632503 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(0)e300('0') sent to 'com.bskyb.epgui'
// 5038445:NDS: ^[2018:03:26 11:44:54]0000005675.281986 !MIL    -HAM          		< p:0x00000a2f P:APP t:0xa4eff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(3)e303('3') sent to 'com.bskyb.epgui'
// 5038464:NDS: ^[2018:03:26 11:44:54]0000005675.302313 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "503"   "BBC NEWS HD"
// 5038915:NDS: ^[2018:03:26 11:44:54]0000005675.373353 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live, jhVRM=0x3000006 
// 5038916:NDS: ^[2018:03:26 11:44:54]0000005675.375132 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:825,job-destloc=,locator:3:2E:92:0 
// 5038919:NDS: ^[2018:03:26 11:44:54]0000005675.375437 !MIL    -VRM_SERVER   		< p:0x00000a2e P:MW t:0xaad48450 T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:4878 > After LIVE_Create call. live_handle LIVE(0x500), [VRM:STATUS_OK 0x0B400000], jhVRM=0x3000006 
// 5039053:NDS: ^[2018:03:26 11:44:54]0000005675.419160 !INFO   -com.bskyb.epgui		< p:0x00000a2f P:APP t:0xa453b1d0 T:no name M:ChannelChangeGadget.cpp F:virtual void ChannelChangeGadget::setCurrentChannelInformation(c L:257 > Setting channel info to   "503"   "BBC NEWS HD"

!MIL    -EPG_ME       		< T:no name M:MediaEngine F:playService L:1485 > T:PooledExecutor#2:TUNING TO Sky News HD, 501 locator:5:3:FD2
or 
!MIL    -EPG_ME       		< T:no name M:MediaEngine$HotswapRetuneTask F:retune L:2972 > T:PooledExecutor#4:Retuning current live service

// when rejoin on the same channel
// PLAYER_API_Session_RejoinLive()                      
// : Stop playing the review buffer and rejoin the live broadcast

!MIL    -EPG_KEY      < T:no name M:Activity F:start L:45 > T:CEE-J EventQueue Reader 0:start activity (NamedActivity(REJOIN_LIVE)@5944a20)
!MIL    -EPG_KEY      < T:no name M:KeyEventValve F:activate L:145 > T:CEE-J EventQueue Reader 0:Added NamedActivity(REJOIN_LIVE)@5944a20 to live activities
!MIL    -P_Api        < T:no name M:player_api_session.c F:PLAYER_API_Session_RejoinLive L:2604 > Rejoin live on target MAIN_TARGET 
!MIL    -P_Api        < T:no name M:player_api_session.c F:PLAYER_PRV_Session_Play L:6157 > PLAY on target MAIN_TARGET 

// when live
!MIL    -P_Api        		< T:no name M:player_api_session.c F:PLAYER_API_Session_Play L:4106 > PLAY 
!MIL    -P_Api        		< T:no name M:player_api_session.c F:PLAYER_PRV_Session_Play L:6157 > PLAY on target MAIN_TARGET 

!MIL    -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:`PLAYER_AVControl_UpdateVisibility` L:1109 > VIDEO IS HIDDEN 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8959 > VIDEO_`RUNNING_STATUS`: jtVRM=3, jhVRM=0x3000001, status=NOT_RUNNING 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9182 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001 [PROCESSED_ASI (524952) NOT_RUNNING] [SELECTION_ASI (524952) NOT_RUNNING] 

// stop previous
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStopped L:9849 > Job 0x03000001 STOPPED on Display Target MAIN_TARGET 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobDestroyed L:10102 > Job 0x03000001 DESTROYED on Display Target MAIN_TARGET 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSSI L:4224 > FRONT END SIGNAL LOCKED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessSCI L:4668 > PMT RECEIVED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1932 > CA STREAM STATUS : ACCESS GRANTED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1932 > CA STREAM STATUS : ACCESS GRANTED 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1906 > CA STREAM STATUS : FREE TO AIR 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1906 > CA STREAM STATUS : FREE TO AIR 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9182 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003 [PROCESSED_ASI (524948) RUNNING] [SELECTION_ASI (524948) RUNNING] 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStarted L:5829 > Job 0x03000003 STARTED on Display Target MAIN_TARGET 

*vrm-jobtype*
// CMS_MEDIA_SERVICES/VRM/src/server/manager/fsm.c

!MIL    -P_Api        		< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_CreateVRMJob L:1805 > Job `0x0300009a` *vrm-job-handle* Created on Display Target MAIN_TARGET `type=3` 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > `VRM-FSM: job_man:0x300009a`: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:live.c F:`LIVE_Create` L:1361 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:FD2,job-destloc=,locator:3:2E:47:0 

*vrm-job-handle* alternating between Live 0 and Live 1 when change channels.
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: Live(  0): E_LIVE_STATE_NONE -> (E_LIVE_INPUT_NEW_REQUEST) -> E_LIVE_STATE_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: Live(  0): E_LIVE_STATE_CREATING -> (E_LIVE_INPUT_CREATED) -> E_LIVE_STATE_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300009a: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4947 > VRM_JOB_START: `jtVRM=jb-live`, jhVRM=0x300009a 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: pleLive:0xa80002: E_PLE_STATE_NONE -> (E_PLE_INPUT_SESSION_CREATED) -> E_PLE_STATE_SESSION_CREATED 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,`mc-create`,234,mc-create-mcid=,234,mc_create-str=,mc-live,fsnfmt=,`hMC=0xea` 
!MIL    -P_Api        		< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStarted L:5829 > Job `0x0300009a` STARTED on Display Target MAIN_TARGET 

// this is always a pair to see
!MIL    -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1105 > VIDEO IS SHOWN 
!MIL    -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8959 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003, status=RUNNING 
!MIL    -EPG_ME       < T:no name M:MediaEngine F:tuningIsFinished L:4717 > T:PooledExecutor#4:SYSTEMTEST tuning complete
!MIL    -EPG_ME       < T:no name M:MediaEngine F:channelChanged L:2027 > T:PooledExecutor#4:CHANNEL CHANGED TO Sky1 HD, 106


*vrm-rb-job*
// `rb-rec` which seems to get created automatically
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `job_man:0x300009b`: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:rb_record.c F:`RB_RECORD_Create` L:3828 > @@PMON@@,mark,job,job-create,5,job-create-type=,jb-rbrec,job-srcloc=,locator:5:3:FD2,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: RB Record h:0x3c: E_RB_RECORD_STATE_CREATING -> (E_RB_RECORD_INPUT_CREATED) -> E_RB_RECORD_STATE_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:`VRM_JOB_SERVER_Start` L:1808 > @@PMON@@,mark,job,job-start,`50331803`,job-start-type=,jb-rbrec 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:`JobManSrvStart` L:4947 > VRM_JOB_START: `jtVRM=jb-rbrec`, jhVRM=0x300009b 

// *map-vrm-to-rmf*
// `VRM-FSM: job_man:0x300009b(50331803)` -> `rmf job instance=0x20107af, rec_handle, item_ID:0x2c0934bc`

!MIL    -RMF          		< T:VRM_SRV M:shrec_group_manager.c F:RMP_SHREC_GROUP_MANAGER_FindShrecSharing L:980 > No sharing found, create new shrec group. Job new assigned quota instance: 0x10000 
!MIL    -RMF          		< T:VRM_SRV M:shrec_group_manager.c F:RMP_SHREC_GROUP_MANAGER_TriggerGetShrec L:381 > Job `0x20107af(0)[Rb]` - shrec found: 0x0 
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_GetShrecSharingInfo L:1106 > job=0x20107af - shrecLocator=0x0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6264 > Initiaizing Record FSM: `rec_handle:0xb9001e, item_ID:0x2c0934bc` 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > `VRM-FSM: rec:0xb9001e,0x2c0934bc`: E_RECORD_INT_STATE_NONE -> (E_RECORD_INPUT_START) -> E_RECORD_INT_STATE_STARTING 

!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=`0x20107af(0)[Rb]` request=0x10000008 released=0xf0000000 change request if fails. 

// note: rb-rec has the same type as record as to mc-type and job_type
// there is no direct map between MC and VRM but fairly konws where nears to
// VRM creation and tuner-status.
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,82,mc-create-mcid=,82,mc_create-str=,`mc-record`,fsnfmt=,`hMC=0x52` 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_CreateCon L:342 > [API_CALL::""MCM""] " "MCM_MEDIACONN_CreateEx type: 0x7000003 returned [SYSTEM_STATUS_OK 0x04401000] ""hMC=0x934 

// *tuner-status*
!MIL    -MDM          		< T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x52e hMC=0x81 tuner_id =1 and job_type =RECORD 
!MIL    -MDM          		< T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x4b0 hMC=0x6e tuner_id =0 and job_type =RECORD 
!MIL    -MDM          		< T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x529 hMC=0x80 tuner_id =1 and job_type =LIVE_VIEWING 

// *rb-play*
!MIL    -P_Api        		< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_CreateVRMJob L:1806 > Job `0x03000029` Created on Display Target MAIN_TARGET type=6 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x3000029: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:rb_play.c F:RB_PLAY_Create L:4059 > @@PMON@@,mark,job,job-create,6,job-create-type=,jb-rbplay,job-srcloc=,,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: RB Play h:0x4: E_RB_PLAY_STATE_NULL -> (E_RB_PLAY_INPUT_CREATE) -> E_RB_PLAY_STATE_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: RB Play h:0x4: E_RB_PLAY_STATE_CREATING -> (E_RB_PLAY_INPUT_CREATED) -> E_RB_PLAY_STATE_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x3000029: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED 

!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-rbplay, jhVRM=`0x3000029`
!MIL    -RMF          		< T:VRM_SRV M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x2010272(0)[Rp] request=0x10000080 released=0xf0000000 restore request if fails. 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:rb_play.c F:RBPlayOnStarting L:3024 > Start. RB play hdl:0x4, newPlayback:1 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: play:0x700: E_PLAY_INT_STATE_NONE -> (E_PLAY_INPUT_START) -> E_PLAY_INT_STATE_STARTING 

NDS: ^[2017:01:24 20:27:00]0946867341.469900 !MIL    -VRM_SERVER   		< p:0x000001e0 P:MW t:0x01e40520 T:SRM_HP_THREAD M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,33554456,job-start-type=,jb-record 
NDS: ^[2017:01:24 20:27:00]0946867341.469960 !MIL    -VRM_SERVER   		< p:0x000001e0 P:MW t:0x01e40520 T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-record, jhVRM=0x2000018 
NDS: ^[2017:01:24 20:27:00]0946867341.473793 !MIL    -SPM_SERVER   		< p:0x000001e0 P:MW t:0x01dd6520 T:SPM_DISPATCHER M:spm_vgc_xsi_sc.c F:SPM_VGC_HandleDataConfigurationEMM L:2340 > EMM received for data configuration 
NDS: ^[2017:01:24 20:27:00]0946867341.527260 !WARN   -PLANNER_ITERATOR		< p:0x000001e2 P:APP t:0x2e203520 T:no name M:planner_request.c F:PLANNER_API_Request_Abort L:47 > Missing request: Operation may have been completed or the handle is invalid 
NDS: ^[2017:01:24 20:27:00]0946867341.561354 !MIL    -VRM_SERVER   		< p:0x000001e0 P:MW t:0x01cbc520 T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6353 > Initiaizing Record FSM: rec_handle:0x35001e, item_ID:0x29061d98 


<vrm-back-to-live-from-pause> <back-to-live>
// create live
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,50331659,job-start-type=,jb-live 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-live, jhVRM=0x300000b 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,20,mc-create-mcid=,20,mc_create-str=,mc-live,fsnfmt=,hMC=0x14 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:340 > @@PMON@@,trace,mediacon,mc-created,20,fsnfmt=,hMC=0x14 

// create rbrec
!MIL    -VRM_SERVER   		< T:VRM_SRV M:rb_record.c F:RB_RECORD_Create L:3828 > @@PMON@@,mark,job,job-create,5,job-create-type=,jb-rbrec,job-srcloc=,locator:5:3:A29,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000c: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000c: E_JOB_MAN_SRV_INT_ST_CREATED -> (E_JOB_MAN_SRV_INP_COMMIT_CALLED) -> E_JOB_MAN_SRV_INT_ST_COMMITTING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,50331660,job-start-type=,jb-rbrec 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-rbrec, jhVRM=0x300000c 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6353 > Initiaizing Record FSM: rec_handle:0xb001e, item_ID:0x2c061d23 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,21,mc-create-mcid=,21,mc_create-str=,mc-record,fsnfmt=,hMC=0x15 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:340 > @@PMON@@,trace,mediacon,mc-created,21,fsnfmt=,hMC=0x15 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: rec:0xb001e,0x2c061d23: E_RECORD_INT_STATE_WAIT_PANEL_CONFIG -> (E_RECORD_INPUT_MCONN_CONFIGURED) -> E_RECORD_INT_STATE_CONFIGURED 

// create rbplay
!MIL    -aem          		< T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(PAUSE)e401 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000d: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:rb_play.c F:RB_PLAY_Create L:4059 > @@PMON@@,mark,job,job-create,6,job-create-type=,jb-rbplay,job-srcloc=,,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,50331661,job-start-type=,jb-rbplay 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-rbplay, jhVRM=0x300000d 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: play:0x300: E_PLAY_INT_STATE_RESOURCES_ALLOCATED -> (E_PLAY_INPUT_PANEL_CONFIGURE) -> E_PLAY_INT_STATE_CONFIGURING 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,22,mc-create-mcid=,22,mc_create-str=,mc-playback,fsnfmt=,hMC=0x16 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:340 > @@PMON@@,trace,mediacon,mc-created,22,fsnfmt=,hMC=0x16 

// delete previous live
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: Live(  0): E_LIVE_STATE_RUNNING -> (E_LIVE_INPUT_STOP) -> E_LIVE_STATE_WAIT_PLE_SESSION_STOP 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: Live(  0): E_LIVE_STATE_WAIT_PLE_SESSION_STOP -> (E_LIVE_INPUT_PLE_SESSION_STOPPED) -> E_LIVE_STATE_WAIT_STOP 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Stop L:531 > @@PMON@@,trace,mediacon,mc-stop,20,fsnfmt=,hMC=0x14 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:pvp_gen.c F:PANEL_StopCon L:426 > [API_CALL::""MCM""] " "MCM_MEDIACONN_Stop returned [SYSTEM_STATUS_OK 0x04401000] on ""hMC=0x14 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: Live(  0): E_LIVE_STATE_WAIT_STOP -> (E_LIVE_INPUT_STOPPED) -> E_LIVE_STATE_STOPPED 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Free L:593 > @@PMON@@,trace,mediacon,mc-free,20,fsnfmt=,hMC=0x14 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:660 > @@PMON@@,trace,mediacon,mc-destroy,20,fsnfmt=,hMC=0x14 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > @@PMON@@,trace,mediacon,mc-destroyed,20,fsnfmt=,hMC=0x14 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Destroy L:1601 > @@PMON@@,mark,job,job-destroy,50331659,job-destroy-type=,jb-live 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000b: E_JOB_MAN_SRV_INT_ST_STOPPED -> (E_JOB_MAN_SRV_INP_DESTROY_CALLED) -> E_JOB_MAN_SRV_INT_ST_DESTROYING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000b: E_JOB_MAN_SRV_INT_ST_DESTROYING -> (E_JOB_MAN_SRV_INP_DESTROYED) -> E_JOB_MAN_SRV_INT_ST_NULL 

// create live
!MIL    -aem          		< T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(SKY)ef01 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000e: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:live.c F:`LIVE_Create` L:1381 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:A29,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,50331662,job-start-type=,jb-live 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-live, jhVRM=0x300000e 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: pleLive:0x130000: E_PLE_STATE_NONE -> (E_PLE_INPUT_SESSION_CREATED) -> E_PLE_STATE_SESSION_CREATED 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,24,mc-create-mcid=,24,mc_create-str=,mc-live,fsnfmt=,hMC=0x18 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:340 > @@PMON@@,trace,mediacon,mc-created,24,fsnfmt=,hMC=0x18 

// delete rbplay
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: play:0x300: E_PLAY_INT_STATE_RUNNING -> (E_PLAY_INPUT_STOP) -> E_PLAY_INT_STATE_WAIT_STOP 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Stop L:531 > @@PMON@@,trace,mediacon,mc-stop,22,fsnfmt=,hMC=0x16 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > @@PMON@@,trace,mediacon,mc-destroyed,22,fsnfmt=,hMC=0x16 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Destroy L:1601 > @@PMON@@,mark,job,job-destroy,`50331661`,job-destroy-type=,jb-rbplay 

// delete rbrec. seems that keeps rbrec as long as on the same channel. In
// this case, there are other rbplay and live before this and it closed this
// when goes to standby.
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000c: E_JOB_MAN_SRV_INT_ST_DESTROYING -> (E_JOB_MAN_SRV_INP_DESTROYED) -> E_JOB_MAN_SRV_INT_ST_NULL 
!MIL    -MCM          		< T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Stop L:531 > @@PMON@@,trace,mediacon,mc-stop,21,fsnfmt=,hMC=0x15 


<play-job-ids>
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `job_man:0x300000e`: E_JOB_MAN_SRV_INT_ST_CREATING -> (E_JOB_MAN_SRV_INP_CREATED) -> E_JOB_MAN_SRV_INT_ST_CREATED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Start L:1808 > @@PMON@@,mark,job,job-start,50331662,job-start-type=,jb-playback 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: job_man:0x300000e: E_JOB_MAN_SRV_INT_ST_COMMITTED -> (E_JOB_MAN_SRV_INP_START_CALLED) -> E_JOB_MAN_SRV_INT_ST_STARTING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-playback, jhVRM=0x300000e 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `play:0x300`: E_PLAY_INT_STATE_NONE -> (E_PLAY_INPUT_START) -> E_PLAY_INT_STATE_STARTING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `plePlay:0x120002`: E_PLE_STATE_NONE -> (E_PLE_INPUT_SESSION_CREATED) -> E_PLE_STATE_SESSION_CREATED 

!MIL    -P_Api        		< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8968 > VIDEO_RUNNING_STATUS: jtVRM=9, jhVRM=0x300000e, status=NOT_RUNNING 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `plePlay:0x120002`: E_PLE_STATE_WAIT_ASM_SESSION_DESTROYED -> (E_PLE_INPUT_ASM_SESSION_DESTROYED) -> E_PLE_STATE_NONE 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `play:0x300`: E_PLAY_INT_STATE_WAIT_DESTROY -> (E_PLAY_INPUT_FREE_FSM) -> E_PLAY_INT_STATE_NONE 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: `job_man:0x300000e`: E_JOB_MAN_SRV_INT_ST_STARTED -> (E_JOB_MAN_SRV_INP_STOPPED) -> E_JOB_MAN_SRV_INT_ST_STOPPED 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Destroy L:1601 > @@PMON@@,mark,job,job-destroy,50331662,job-destroy-type=,jb-playback 


<to-live-but-no-run>
When boot up CA channel such as "TUNING TO Sky Action HD, 307"

LIVE runs fine:

!MIL    -MCM          		< p:0x00000222 P:MW t:0x01d4a520 T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Run L:466 > @@PMON@@,trace,mediacon,mc-run,6,fsnfmt=,hMC=0x6 
!MIL    -MCM          		< p:0x00000222 P:MW t:0x01d19520 T:MCM_ITCMAIN_THREAD M:mcm_mediaconn_event.c F:MCM_Mediaconn_ActionStarting L:4288 > @@PMON@@,trace,mediacon,mc-running,6,fsnfmt=,hMC=0x6 
!MIL    -VRM_SERVER   		< p:0x00000222 P:MW t:0x01d4a520 T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: job_man:0x3000001: E_JOB_MAN_SRV_INT_ST_STARTING -> (E_JOB_MAN_SRV_INP_STARTED) -> E_JOB_MAN_SRV_INT_ST_STARTED 
!MIL    -VRM_SERVER   		< p:0x00000222 P:MW t:0x01d4a520 T:VRM_SRV M:ple_strtgy.c F:PLE_STRTGY_WhatNext L:502 > @@PMON@@,trace,d-splicing,d-subst-strategy,2,d-strategy=,1 
!MIL    -P_Api        		< p:0x00000224 P:APP t:0x01232520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_JobStarted L:5862 > Job 0x03000001 STARTED on Display Target MAIN_TARGET 

However, see *blue-screen* , no logs showing running like these:

!MIL    -MPM          		< p:0x0000019d P:MW t:0x01845520 T:MPM_ITCMAIN_THREAD M:mpm_component_video.c F:MPMComponentVideoStartDecodingReal L:920 > VIDEO_DECODER_START@videodecoder0 
!MIL    -MPM          		< p:0x0000019d P:MW t:0x01845520 T:MPM_ITCMAIN_THREAD M:mpm_component_video.c F:MPMComponentVideoStartDecodingReal L:952 > DECODER_STARTED: [Comp: 0x40926 EF: 0x2 ST: 0x4010] hMC=0x3 
!MIL    -MPM          		< p:0x0000019d P:MW t:0x01845520 T:MPM_ITCMAIN_THREAD M:mpm_component_video.c F:MPMComponentVideoStartDecodingReal L:955 > @@PMON@@,mark,hw,start-video-decoder,3,v-decoder_id=,0 

!MIL    -MPM          		< p:0x0000019d P:MW t:0x01852520 T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1376 > FRAME_PRESENTED: hMC=0x3 
!MIL    -P_Api        		< p:0x0000019f P:APP t:0x0122f520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9325 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=NOT_RUNNING 
!MIL    -P_Api        		< p:0x0000019f P:APP t:0x0122f520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9325 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=RUNNING 

WHY? see these after run and which means no right to see.

*comp-ca*

!MIL    -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1900 > CA STREAM STATUS : ACCESS DENIED OTHER 
!WARN   -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!MIL    -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1900 > CA STREAM STATUS : ACCESS DENIED OTHER 
!WARN   -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!MIL    -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1929 > CA STREAM STATUS : FREE TO AIR 
!WARN   -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!WARN   -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!MIL    -P_Api        		< P:APP t:0x01232520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1929 > CA STREAM STATUS : FREE TO AIR 

when see further up in the log, see these:

!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammSetPmtDrmResponse msg.IntermediateError = 0
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammParseSendMessage handles message CAMM_MCI_CA_PMT_NOTIFICATION_TAG
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > session [0x3], request [1], NbES [4] DRM stat[0]
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_REFUSED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_SCRAMBLED
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x200
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_DESCRAMBLING_NOT_POSSIBLE_OTHER
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_REFUSED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_SCRAMBLED
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x294
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_DESCRAMBLING_NOT_POSSIBLE_OTHER
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_STARTED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_CLEAR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x240
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_FREE_TO_AIR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_STARTED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_CLEAR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x406
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_FREE_TO_AIR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammSendMessage, called for tag 10453053

OKAY case:

!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammSetPmtDrmResponse msg.IntermediateError = 0
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammParseSendMessage handles message CAMM_MCI_CA_PMT_NOTIFICATION_TAG
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > session [0x2], request [1], NbES [3] DRM stat[0]
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_STARTED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_CLEAR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x926
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_FREE_TO_AIR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_STARTED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_CLEAR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x927
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_FREE_TO_AIR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_type: CAMM_MCI_EVENT_TYPE_STARTED 
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 event_mode: CAMM_MCI_EVENT_MODE_CLEAR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 stream_pid: 0x928
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > 	 mci_status: CAMM_MCI_FREE_TO_AIR
!MIL    -VGV          		< P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:VGV_CAMM L:162 > CammSendMessage, called for tag 10453053

!MIL    -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1905 > CA STREAM STATUS : FREE TO AIR 
!WARN   -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!MIL    -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1905 > CA STREAM STATUS : FREE TO AIR 
!WARN   -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 
!MIL    -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_PRV_CheckCAEI L:1905 > CA STREAM STATUS : FREE TO AIR 
!WARN   -P_Api        		< P:APP t:0x0122f520 T:PLAYER_MAIN M:player_api_events.c F:PlayerEventCloneEvent L:465 > License token is NULL 


<when-record-from-rb>
// create a recording from review buffer
// map `RB rmf job instance 0x20107af` to `rmf job instance 0x20107b0(0)[R]`

!MIL    -aem          		< T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(RECORD)e403 
!MIL    -EPG_BOOK     		< T:no name M:ScheduledBookingAgent F:proceedWithBooking L:453 > T:PooledExecutor#4:Making booking with middleware - addScheduledBookedProgramme

!MIL    -VRM_SERVER   		< T:`SBM_UB_MAIN` M:fsm.c F:FSMRun L:921 > VRM-FSM: `job_man:0x2000082`: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -RMF          		< T:RMF_Server M:shrec_group_manager.c F:isSharingInActiveJob L:677 > shared active RB `0x20107af`, shrec locator 0x2e01808f 
!MIL    -RMF          		< T:RMF_Server M:shrec_group_manager.c F:RMP_SHREC_GROUP_MANAGER_FindShrecSharing L:1004 > Shared shrec locator 0x2e01808f, job `0x20107b0(0)[R]` final shrec quota instance: 0x10000 
!MIL    -RMF          		< T:RMF_Server M:shrec_group_manager.c F:isSharingInActiveJob L:677 > shared active RB 0x20107af, shrec locator 0x2e01808f 

!MIL    -RMF          		< T:RMF_Server M:quota_booking_conflict.c F:QuotaBookConf_GetConflictHandle L:299 > Quota booking conflict not found for job 0x20107b0 

!MIL    -EPG_BOOK     		< T:no name M:ScheduledBookingAgent F:completeBooking L:477 > T:PooledExecutor#4:futurelistener booking completed: completionStatus = 104865794

note:
bookingJobID = `0x290934c2` and item_ID:`0x290934c2` are the same and this
is the *booking-job-id* in PCAT db.

!MIL    -PCATS        		< T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:3077 > client id = 0x5,bookingJobID = `0x290934c2`
!MIL    -VRM_SERVER   		< T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:4947 > VRM_JOB_START: jtVRM=`jb-record`, `jhVRM=0x2000082` 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6264 > Initiaizing Record FSM: rec_handle:`0xbc001d`, item_ID:`0x290934c2` 
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: rec:0xbc001d,0x290934c2: E_RECORD_INT_STATE_NONE -> (E_RECORD_INPUT_START) -> E_RECORD_INT_STATE_STARTING 

// `Sxxx`
!MIL    -VRM_SERVER   		< T:VRM_SRV M:fsm.c F:FSMRun L:921 > VRM-FSM: rec:0xbc001d,0x290934c2: E_RECORD_INT_STATE_ALLOCATING_DISK -> (E_RECORD_INPUT_DISK_ALLOCATED) -> E_RECORD_INT_STATE_DISK_ALLOCATED 
!WARN   -MSM_MDI      		< T:VRM_SRV M:meta_mfs.c F:(MetaMfsGetCurrentRecordPosition) L:978 > Milestone : MetaMfsGetCurrentRecordPosition: bNeedAccuracy=true dir (/mnt/nds/dev_4/part_0/S79696) return time 0_000baf03 and" " packet 0_004edfe6 


*job-destory*
!MIL    -VRM_SERVER   		< T:VRM_SRV M:job_man_srv.c F:VRM_JOB_SERVER_Destroy L:1601 > @@PMON@@,mark,job,job-destroy,50331668,job-destroy-type=,jb-rbrec 


<when-record-from-start-to-end>
:!MIL   -aem          < T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:00245 > KEY_PRESS: code=0x(RECORD)e403
:!MIL   -PCATS        < T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:03077 > client id = 0x5,bookingJobID = 0x290000dd *booking-job-id*
:!INFO  -PCATS        < T:PCAT_SRV_THREAD M:pcat_prepare.c F:PrepareRunSelectNotificationOnCommitJob L:03911 > Add a new row for view 0x5000067 id 0x290000dd inserted ( will be sent if the view is registered on insertion)
:!INFO  -VRM_SERVER   < T:VRM_SRV M:booking_record.c F:BookingRecordPcatObjInit L:03042 > item_ID: 0x290000dd, start_time: 08:00:00, duration: 7200000
:!MIL   -VRM_SERVER   < T:VRM_SRV M:record_state.c F:RecordStateCalculateBySkevt L:01604 > RecordState for itemId 0x290000dd (by SKEVT): RECORD_STATE_BODY
:!MIL   -VRM_SERVER   < T:VRM_SRV M:record_state.c F:RecordStateCalculateRecordState L:01477 > RECORD: 'VRM' RecordStateCalculateRecordState - PCAT update
:!INFO  -SRM          < T:SRM_HP_THREAD M:srm_job_starter.c F:JobStarterHandleJobTriggered L:01162 > Before calling project specific action before start for booking 0x290000dd
:!INFO  -VRM_SERVER   < T:SRM_HP_THREAD M:find_jobs_man_srv.c F:FindJobsManSrvActualSearch L:00565 > job_type: 7,[VRM:STATUS_OK 0x0B401000]
:!INFO  -VRM_SERVER   < T:SRM_HP_THREAD M:job_man_srv.c F:###1 L:03421 > ===================== job manager srv debug start =====================
:!INFO  -SRM          < T:SRM_HP_THREAD M:srm_utils_fsm.c F:FSM_Run L:00858 > --------- [SRMj:0x00000001] ---------
:!INFO  -SRM          < T:SRM_HP_THREAD M:srm_utils_fsm.c F:FSM_Run L:00861 > state:     E_JOB_STARTER_STATE_IS_RECORDABLE_CHECK
:!INFO  -SRM          < T:SRM_HP_THREAD M:srm_utils_fsm.c F:FSM_Run L:00864 > input:     E_JOB_STARTER_INP_IS_RECORDABLE_CHECK_PASSED
:!INFO  -SRM          < T:SRM_HP_THREAD M:srm_utils_fsm.c F:FSM_Run L:00867 > new state: E_JOB_STARTER_STATE_STARTING_JOB
:!MIL   -VRM_SERVER   < T:SRM_HP_THREAD M:job_man_srv.c F:VRM_JOB_SERVER_Start L:01808 > @@PMON@@,mark,job,job-start,33554436,job-start-type=,jb-record
:!MIL   -VRM_SERVER   < T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:04947 > VRM_JOB_START: jtVRM=jb-record, jhVRM=0x2000004
:!MIL   -VRM_SERVER   < T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:06264 > Initiaizing Record FSM: rec_handle:0x3001e, item_ID:0x290000dd
:!MIL   -VRM_SERVER   < T:VRM_SRV M:fsm.c F:FSMRun L:00921 > VRM-FSM: rec:0x3001e,0x290000dd: E_RECORD_INT_STATE_NONE -> (E_RECORD_INPUT_START) -> E_RECORD_INT_STATE_STARTING
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:ContentInfoPrintDebug L:01045 > ----------------begin--09:45:02----------------
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:ContentInfoPrintDebug L:01056 >
:basicParams.objectIdBookingJob: 0x290000dd
:                                                                               basicParams.objectIdBooking: 0x210000dd
:                                                                               basicParams.recordStatus: RECORD_STATUS_RECORDING
:                                                                               basicParams.isFailed: 0
:                                                                               isLegacyContent: 0
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:ContentInfoPrintDebug L:01063 >
:basicParams.vFileInfo.isAVContentExist: 1
:                                                                               basicParams.objectIdAVContent: 0x250000df
:                                                                               basicParams.vFileInfo.vFileSegment: [09:14:37,09:45:00]
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:ContentInfoPrintDebug L:01072 >
:vlExceptionInfo: 0xb5d
:                                                                               vlShrecExtent: 0xb5f
:                                                                               vlBookingInfo: 0xb5c
:                                                                               vlShrecItems: 0x0
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:ContentInfoPrintDebug L:01077 > ----------------end------------------
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:JobContent_RecordContentHandler L:00387 > 09:45:02 bookingJob: 0x290000dd PCAT_CAT_CONTENT_STATUS_PARTIAL, SYSTEM_EXCEPTION_TYPE_VIEWER_BOOKED_TOO_LATE, stat:0x11400000
:!MIL   -VRM_SERVER   < T:VRM_SRV M:fsm.c F:FSMRun L:00921 > VRM-FSM: rec:0x3001e,0x290000dd: E_RECORD_INT_STATE_WAIT_PLE_SESSION_DESTROY -> (E_RECORD_INPUT_VRM_PLE_SESSION_DESTROYED) -> E_RECORD_INT_STATE_WAIT_DESTROY
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:JobContent_RecordContentHandler L:00380 > 10:02:00 End processing bookingJob: 0x290000dd
:!INFO  -SRM          < T:VRM_SRV M:srm_job_content_status.c F:JobContent_RecordContentHandler L:00387 > 10:02:00 bookingJob: 0x290000dd PCAT_CAT_CONTENT_STATUS_PARTIAL, SYSTEM_EXCEPTION_TYPE_VIEWER_BOOKED_TOO_LATE, stat:0x11400000

// updates PCAT
:!INFO  -VRM_SERVER   < T:VRM_SRV M:booking_record.c F:BookingRecordHandleStopped L:06363 > ended record handle:0xb, item_ID: 0x290000dd, is_failed: 0, content status:PARTIAL, exception_type:VIEWER_BOOKED_TOO_LATE, av_content_id: 0x250000df, reschedule: 0, keep_history: 1, stop_to_destroy: 0, stat:0x5c01000


<vrm-event>

// E_VRM_SUBCOMP_ID_JOB_MAN_SRV,			/*20*/
// #define VRM_GET_SUBCOMP_INITIAL_VALUE(VRM_SUBCOMP_ID) ((((uint32_t)VRM_SUBCOMP_ID) & 0x000000FFU)<< 24)

    E_JOB_MAN_SRV_MSG_TYPE_FSM = VRM_GET_SUBCOMP_INITIAL_VALUE(E_VRM_SUBCOMP_ID_JOB_MAN_SRV),/* message containing FSM input. playload: VRM_SRV_MSG_INFO */
// (((20) & 0x000000FF)<< 24)
// >>> 335544320
    E_JOB_MAN_SRV_MSG_TYPE_SET_SPEED,        /* payload: JOB_MAN_SRV_SET_SPEED_REQUEST_DATA        */
// >>> 335544321


# 
# Job_man_srv.c
static VRM_FSM_ENTRY JobManSrvEntries[] = {

    VRM_FSM_E(  E_JOB_MAN_SRV_INT_ST_CREATED,   			/* state */
        E_JOB_MAN_SRV_INP_START_CALLED,  			/* input */
        E_JOB_MAN_SRV_INT_ST_COMMITTING,			/* new state */
        (VRM_FSM_ACTION)JobManSrvCommittingState ),     /* action */

    VRM_FSM_E(  E_JOB_MAN_SRV_INT_ST_COMMITTED,   			/* state */
        E_JOB_MAN_SRV_INP_START_CALLED,  			/* input */
        E_JOB_MAN_SRV_INT_ST_STARTING,				/* new state */
        (VRM_FSM_ACTION)JobManSrvStartingState ),       /* action */
}

# VRM_JOB_STATE_COMMITTED
#
JobManSrvCommittedState
	JobManSrvStateNotify (this, VRM_JOB_STATE_COMMITTED);

	E_JOB_MAN_SRV_INP_START_CALLED

JobManSrvStartingState
JobManSrvStart
	BOOKING_PLAY_Start
		PLAY_Start
			PlayAllocateNew (p_play_params, &pPlaySession);
			{
				PlayInitializeEntry (&(BasicPlay[new_index]), p_play_params);
					PlaySetPosition
						PlaySendPositionRequest
							PANEL_PlaySetPosition
			}
			PlaySendFSMInput (pPlaySession, E_PLAY_INPUT_START, ASYNCHRONOUS);
		
		
/* Possible Play state machine states */
typedef enum E_PLAY_INTERNAL_STATE_
{
	E_PLAY_INT_STATE_NONE = 0,
	E_PLAY_INT_STATE_STARTING,				/*	play is starting process					*/
	E_PLAY_INT_STATE_ALLOCATING_RESOURCES,  /*	play is allocating RMF resources			*/
	E_PLAY_INT_STATE_WAIT_RMF_RETRY,		/*	play is waitng for retry instruction from RMF  */
	E_PLAY_INT_STATE_RESOURCES_ALLOCATED,	/*	play RMF resources were allocated			*/
	E_PLAY_INT_STATE_CONFIGURING,			/*	play is configuring connection				*/
    E_PLAY_INT_STATE_WAIT_PANEL_CONFIG,		/*	play is waitng for connection to be configured */
	E_PLAY_INT_STATE_CONFIGURED,			/*	play connection is configured				*/
    E_PLAY_INT_STATE_WAIT_RUN,				/*	play is waitng for connection to be running	*/
    E_PLAY_INT_STATE_RUNNING,				/*	play connection is running					*/
	E_PLAY_INT_STATE_WAIT_STOP,				/*	play is waitng for connection to be stopped	*/
	E_PLAY_INT_STATE_STOPPED_MEDIACONN,		/*	play connection was stopped					*/
	E_PLAY_INT_STATE_WAIT_FULL_STOP,		/*  play is waiting for request to stop fully   */
	E_PLAY_INT_STATE_RELEASE_MEDIACONN,		/*  play is waiting for connection to be released */
	E_PLAY_INT_STATE_RELEASED_MEDIACONN,	/*	play connection was released				*/
	E_PLAY_INT_STATE_WAIT_DESTROY,			/*	play is waiting to be destroyed				*/
	E_PLAY_INT_STATE_LAST
} E_PLAY_INTERNAL_STATE;

static VRM_FSM_ENTRY PlayEntries[] = {

    VRM_FSM_E(  E_PLAY_INT_STATE_NONE,        	/* state */
        E_PLAY_INPUT_START,   				/* input */
        E_PLAY_INT_STATE_STARTING,        	/* new state */
		(VRM_FSM_ACTION) PlayActionStartingState ),	/* action */	# MSM_MFS_Vfile_Open, MSM_MFS_Vfile_GetStart
		
	VRM_FSM_E(  E_PLAY_INT_STATE_RESOURCES_ALLOCATED,/* state */
        E_PLAY_INPUT_PANEL_CONFIGURE,   	/* input */
        E_PLAY_INT_STATE_CONFIGURING,       /* new state */
		(VRM_FSM_ACTION) PlayActionConfiguringState ), /* action */
}
		
(\CMS_MEDIA_SERVICES\VRM\src\server\engine\basic_play.c)
PlayActionConfiguringState

PANEL_PlaySetPosition
	MSM_SP_SetPosition(mcon, units, pPosition);
	

(basic_rec.c)
static VRM_FSM_ENTRY RecordEntries[] = {

	VRM_FSM_E(  VRM_FSM_ALL_STATES,				/* state */
		E_RECORD_INPUT_STOP, 					/* input */
		E_RECORD_INT_STATE_WAIT_DESTROY,	/* new state */
		(VRM_FSM_ACTION)RecordActionGeneralTrap ),	/* action */
}

# debug
#
NDS: ^[00:29:47]0946686587.795399 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02605 > ===================== job manager srv debug start =====================
NDS: ^[00:29:47]0946686587.795527 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02621 > [0]: h=0x2000001, STARTED, RECORD, request_mask = 0x3
NDS: ^[00:29:47]0946686587.795647 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02621 > [1]: h=0x2000002, COMMITTED, RECORD, request_mask = 0x3
NDS: ^[00:29:47]0946686587.795768 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02621 > [2]: h=0x2000003, COMMITTED, RECORD, request_mask = 0x3
NDS: ^[00:29:47]0946686587.795886 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02621 > [3]: h=0x3000006, STARTED, LIVE_VIEWING, request_mask = 0x1
NDS: ^[00:29:47]0946686587.796015 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02621 > [4]: h=0x2000006, STARTED, RECORD, request_mask = 0x3
NDS: ^[00:29:47]0946686587.796339 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02627 > valid jobs: 5
NDS: ^[00:29:47]0946686587.796440 !INFO  -VRMS         < M:job_man_srv.c F:###1 L:02629 > ======================= job manager debug end =======================


# PCAT_VIEW_OBJECT_ID itemId(BJOBID)
# search a pair of jhVRM and Jobid

NDS: ^[2013:03:15 09:49:05]0946700258.060668 !MIL    -VRMS         		< p:0x00000000 P:MW t:0x01793fa0 T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:4376 > VRM_JOB_START: jtVRM=jb-record, jhVRM='0x2000007' 

NDS: ^[2013:03:15 09:49:04]0946700257.295691 !MIL    -PCATS        		< p:0x00000000 P:MW t:0x017fd1c0 T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:2869 > client id = 0x5,bookingJobID = '0x290005bf' 

NDS: ^0946685069.386406 !MIL    -VRMS         		< T:VRM_SRV M:record_state.c F:RecordStateCalculateBySkevt L:1556 > MILESTONES: timeline: itemId: '0x290005bf', curr: [2012:03:28 19:21:14]1332962474; PT:[2012:03:28 18:57:00]1332961020, SGT:[2012:03:28 18:58:00]1332961080, SREX:[2012:03:28 19:00:00]1332961200, BODY:[2012:03:28 19:00:00]1332961200, EREX: [2012:03:28 20:00:00]1332964800, EGT:[2012:03:28 20:00:00]1332964800, ENDED:[2012:03:28 20:02:00]1332964920

# item_ID is BJOBID. Need to search itemid as non-case
NDS: ^0946685070.695400 !MIL    -VRMS         		< T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:5279 > MILESTONES: Initiaizing Record FSM: rec_handle:0x10009, item_ID:'0x290005bf'

NDS: ^[2013:03:15 09:49:05]0946700258.116921 !MIL    -VRMS         		< p:0x00000000 P:MW t:0x016b8b60 T:VRM_SRV M:fsm.c F:FSMRun L:904 > VRM-FSM: rec:0xa0008,'0x290005bf': E_RECORD_INT_STATE_ALLOCATING_TUNER -> (E_RECORD_INPUT_TUNER_ALLOCATED) -> E_RECORD_INT_STATE_TUNER_ALLOCATED 

# jhVRM=0x300014a
90339:NDS: ^[00:58:22]0946688302.009422 !MIL   -VRMS         < p:000000d2 t:01790ec0 T:VRM_SRV M:fsm.c F:FSMRun L:00904 > VRM-FSM: job_man:0x300014a: E_JOB_MAN_SRV_INT_ST_COMMITTING -> (E_JOB_MAN_SRV_INP_COMMITTED) -> E_JOB_MAN_SRV_INT_ST_COMMITTED
90340:NDS: ^[00:58:22]0946688302.025429 !MIL   -VRMS         < p:000000d2 t:01790ec0 T:VRM_SRV M:fsm.c F:FSMRun L:00904 > VRM-FSM: job_man:0x300014a: E_JOB_MAN_SRV_INT_ST_COMMITTED -> (E_JOB_MAN_SRV_INP_START_CALLED) -> E_JOB_MAN_SRV_INT_ST_STARTING
90342:NDS: ^[00:58:22]0946688302.027753 !MIL   -VRMS         < p:000000d2 t:01790ec0 T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:04169 > VRM_JOB_START: jtVRM=jb-live, jhVRM=0x300014a


# query using job id and get event id
#
sqlite3 PCAT.DB 'select j.booking_job_id, b.booking_id, b.event_id from booking_jobs j, booking_info b where b.booking_id = j.booking_id and j.booking_job_id =  687866053'

# get event name from event id
sqlite3 PCAT.DB 'select i.event_name from item i where i.event_id = 570426813' | tostr


<vrm-playback-record> *playback-to-shrec-record-file*
note: both do create shrec for nomal records but not for bdl

!MIL    -VRM_SERVER   P:MW t:0x01cae520 T:VRM_SRV M:booking_play.c F:BOOKING_PLAY_Create L:853 > @@PMON@@,mark,job,job-create,9,
  job-create-type=,`jb-playback`,job-srcloc=,locator:3:11:`2907220A`:0,job-destloc=,locator:3:2E:47:0 
!MIL    -VRM_SERVER   P:MW t:0x01cae520 T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-playback, jhVRM=0x3000003 

!MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvCreate L:03799 > 
  @@PMON@@,mark,job,job-create,50331651,job-create-type=,`jb-playback`,job-srcloc=,locator:3:11:290000C5:0,job-destloc=,locator:3:1F:4B:19:54:0

locator:3:11:`2907220A`:0   // 0x2907220A *booking-job-id* note: do not match!

MIL   -MSM          < T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:MSM_DEVICEMAN_Open L:00502 > Milestone : MSM_DEVICEMAN_Open for playback: hMC=0x5, shrec=s1, vfile=0x50000006 Starts... 

!MIL    -MSM          P:MW T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:(getParamBagValue) L:4410 > MSM_DEVICEMAN_Open `for playback`: " "hMC=0x2c, `shrec=s69677`, vfile=0x500142b0 Starts...  

(BOOKING_JOBS) BOOKING JOB ID: 687866053, BOOKING ID -> (BOOKING_INFO) BOOKING ID: 553648325 -> EVT ID: 570425541 -> (ITEM) EVT ID: , EVT NAME: 110013ffa4194361736820696e20746865204174746963 (Cash in the Attic)
                                                                                             -> AV CON: 620757195 -> (AV_CONTENT) SH LOC: locator:3:14:1:s1

!MIL    -VRM_SERVER   P:MW T:SRM_HP_THREAD M:job_man_srv.c F:JobManSrvStart L:4948 > VRM_JOB_START: jtVRM=jb-record, jhVRM=0x2000001 
!MIL    -VRM_SERVER   P:MW T:VRM_SRV M:basic_rec.c F:RecordActiveInitialize L:6353 > Initiaizing Record FSM: rec_handle:0x13001e, item_ID:0x29072735 
!MIL    -MCM          P:MW T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,21,mc-create-mcid=,21,mc_create-str=,mc-record,fsnfmt=,hMC=0x15 
!MIL    -MDM          P:MW T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x1b hMC=0x15 tuner_id =1 and job_type =RECORD 
!MIL    -MSM          P:MW T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:(MSM_DEVICEMAN_Open) L:466 > MSM_DEVICEMAN_Open " "hMC=0x15, mc_type=0x7000003, source_locator=0xffe18144, " "destination_locator=0x721801e Starts...  
*shrec-name*
!MIL    -MSM          P:MW T:MCM_ITCMAIN_THREAD M:msm_deviceman.c F:(getParamBagValue) L:4336 > MSM_DEVICEMAN_Open `for record`: " "hMC=0x15, `shrec=s69897` Starts... 

<vrm-to-mc-free>

// to stop MC
!INFO   -VRM_SERVER   		< p:0x000001e5 P:MW t:0x01e17520 T:VRM_SRV M:pvp_fsm.c F:PANEL_SetState L:1176 > 
hMC=0x11cd2"" changing state from PANEL_STATE_STOPPING to PANEL_STATE_WAIT_USER_RELEASE 

// to free, close and destory MC
!INFO   -VRM_SERVER   		< p:0x000001d6 P:MW t:0x01e17520 T:VRM_SRV M:pvp_fsm.c F:PANEL_SetState L:1176 > 
hMC=0xff4c"" changing state from PANEL_STATE_WAIT_USER_RELEASE to PANEL_STATE_DISCONNECTING 


={============================================================================
|kt_dev_si_0001| comp-diag

Rochkind, Michael <MRochkind@nds.com>; Yakirevich, Yonatan <YYakirevich@nds.com>

<default>
The following trace levels are always available for Fusion Debug output:

   A: AssertAssertion in the code has been violated (usually a serious error).
   F: FatalFatal error
   E: ErrorAll recoverable errors
   W: Warning something that should not have happened but may allow the
   operation to continue.
   M: MilestonesUsed for significant information.

Collectively these traces are referred to as AFEWM, and comprise the default
trace level for all components segments.


# FUSION_SYSTEM_INTEGRATION\BSKYB_INTEGRATION\build\projects\picasso\makefile

# preprod. BUILD_TYPE=release_dbg
-DDIAG_RELEASE_DBG -DDIAG_BINARY_MODE -DDIAG_PERFORMANCE_MODE -DDIAG_FILE_ID=10 
-DDIAG_LOG_NDEBUG -DDIAG_JAVA_DEBUG 

# prod case. BUILD_TYPE=release
-DDIAG_RELEASE 
-DDIAG_LOG_NDEBUG -DDIAG_JAVA_DEBUG 

# debug. BUILD_TYPE=release_dbg
-DDIAG_RELEASE_DBG
-DDIAG_LOG_NDEBUG -DDIAG_JAVA_DEBUG


\CMS_SYSTEM_INFRASTRUCTURE\DIAG\src\helpers\src\debug\
diag_hlp_debug.c

*diag-debug*
/* Define at compile time */
#ifndef	__DIAG_DEBUG_LEVEL
#if (defined(DIAG_DEBUG) || defined(__DIAG_DEBUG) || defined(DIAG_RELEASE_DBG) || defined(__DIAG_RELEASE_DBG))
/* #define __DIAG_DEBUG_LEVEL	DIAG_HLP_DBGLEVEL_WARN | DIAG_HLP_DBGLEVEL_ERROR|DIAG_HLP_DBGLEVEL_FATAL */
#define __DIAG_DEBUG_LEVEL	DIAG_HLP_DBGLEVEL_ALL
#else

use DIAG_HLP_DBGLEVEL_ALL for more debugs

# to get enter/exit diag debug, define the following
# Note that the __DIAG_HLP_DEBUG_ENABLE_FN_ENTER_EXIT needs to be defined at the top of diag_hlp_debug.h file 
# (as opposed to the other define that is defined in the diag_hlp_debug.c file).
diag_hlp_debug.h
#define __DIAG_HLP_DEBUG_ENABLE_FN_ENTER_EXIT


<diag-format>

// 10-6  1 `microsecond`  us

__DIAG_LOG_FormatAndLogTraceBuffer
	DIAG_LOG_GetFormattedTraceBuffer
	{
		clock_gettime(CLOCK_REALTIME, &tTimeStamp);	
		#define DIAG_LOG_TRACE_TIMESTAMP    		"%.010lu.%.06lu "
		sprintf(pOutputString, DIAG_LOG_TRACE_TIMESTAMP,(unsigned long) tTimeStamp.tv_sec, (unsigned long) (tTimeStamp.tv_nsec / 1000));
	}


<diag-macro>

CURL_DBG_PRINT_E(("KIT: %d, co = calloc(%d)", count_alloc, sizeof(struct Cookie)));

#if defined _USE_DIAG && (defined (DEBUG) || defined (RELEASE_DBG)) OR
#if (!defined(DIAG_RELEASE) && !defined(__DIAG_RELEASE))

#define CURL_DBG_PRINT_I(MESSAGE)    DIAG_LOG_INFO(libcurlDiagHandlerId, MESSAGE)
#define CURL_DBG_PRINT_W(MESSAGE)    DIAG_LOG_WARN(libcurlDiagHandlerId, MESSAGE)
#define CURL_DBG_PRINT_E(MESSAGE)    DIAG_LOG_ERROR(libcurlDiagHandlerId, MESSAGE)
#define CURL_DBG_PRINT_F(MESSAGE)    DIAG_LOG_FATAL(libcurlDiagHandlerId, MESSAGE)
#define CURL_DBG_PRINT_EV(MESSAGE)   DIAG_LOG_EVENT(libcurlDiagHandlerId,MESSAGE)

#else

  #if !defined (DEBUG) && !defined (RELEASE_DBG) /* RELEASE */
  #define CURL_DBG_PRINT_I(MESSAGE)
  #define CURL_DBG_PRINT_W(MESSAGE)
  #define CURL_DBG_PRINT_E(MESSAGE)
  #define CURL_DBG_PRINT_F(MESSAGE)
  #define CURL_DBG_PRINT_EV(MESSAGE)
  #endif

#endif

#define CURL_DBG_DECLARE(MESSAGE)        DIAG_DECLARE_FUNCTION(MESSAGE)
#define CURL_DBG_ENTER(MESSAGE)          DIAG_DECLARE_FUNCTION(MESSAGE); DIAG_LOG_FN_ENTRY(libcurlDiagHandlerId)
#define CURL_DBG_RETURN(MESSAGE, ret)    do { DIAG_LOG_RETURN(libcurlDiagHandlerId, MESSAGE); DIAG_LOG_FN_EXIT(libcurlDiagHandlerId, ret); return(ret); } while (0)
#define CURL_DBG_VOID_RETURN(MESSAGE)    do { DIAG_LOG_RETURN(libcurlDiagHandlerId, MESSAGE); DIAG_LOG_FN_EXIT(libcurlDiagHandlerId, 0); return; } while (0)
#define CURL_DBG_PRINT_PARAMS(MESSAGE)   DIAG_LOG_PARAMS(libcurlDiagHandlerId, MESSAGE);


CMS_SYSTEM_INFRASTRUCTURE/DIAG/inc/diag_common.h

    /**
     * @def DIAG_DECLARE_FUNCTION
     * 
     * Declare the function name to the DIAG component.
     *
     * `Must` be declared just after variable declaration block:
     * @code
     * void fn(int arg)
     * {
     *	int ivar;
     *      short svar;
     *	DIAG_DECLARE_FUNCTION("fn");
     *	[...]
     * }
     * @endcode
     * and, avoid:
     * @code
     * void fn(int arg)
     * {
     *	DIAG_DECLARE_FUNCTION("fn");
     *	int ivar;
     *      short svar;
     *	[...]
     * }
     * @endcode 
     */
#define DIAG_DECLARE_FUNCTION(fcn)	__DIAG_DECLARE_FUNCTION(fcn)


<comp-diag-segments>

#define MEMBUSTER_SEGMENT_NAME "MEMBUSTER"
DIAG_LOG_uiSegmentId_t MEMBUSTER_segId;

        (void) DIAG_LOG_RegisterTraceSegment((const char *)MEMBUSTER_SEGMENT_NAME , 
                                             (uint32_t) strlen(MEMBUSTER_SEGMENT_NAME), 
                                             ptRPCTable, 
                                             &MEMBUSTER_segId);
        (void) DIAG_LOG_FormatTraceSegment(MEMBUSTER_segId, "", "", "%p %t %f@%l");

CMS_SYSTEM_INFRASTRUCTURE/DIAG/inc/diag_log.h

/**
 * @brief	Format trace string to print optional informations (thread identifier, source line number...) about a component.
 *		The expanded string is in the trace header fragment.
 * 
 * @param[in] uiSegmentId	Identifier of the segment being examined obtained by DIAG_LOG_RegisterTraceSegment() call.
 * @param[in] pProcessName	Name of the current process (used to distinguish traces from a same component in several processes : i.e. "MW", "SCD", "SC"...).
 * @param[in] pModuleName	Module/class of a component (i.e : API, SYS, MGR...).
 * @param[in] pFormat		String format
 * 
 * @retval  #DIAG_LOG_STATUS_SUCCESS		The string pattern is valid and will be used to format traces.
 * @retval  #DIAG_LOG_STATUS_PARAM_FAILURE        One or more parameter(s) is(are) invalid (e.g. NULL-pointer).
 * 
 * @par About the trace format
 *
 * The string format uses the following key to (optionally) display component information:
 *	- %m	: file name 			(string is truncated after 32 characters),
 *	- %f	: function name			(string is truncated after 32 characters),
 *	- %p	: process identifier	(hexadecimal format),
 *	- %P	: print process name	(string is truncated to 16 chars)   
 *	- %t	: thread identifier		(hexadecimal format),
 *	- %T	: thread name		    (string, available only when thread is created using SYSTEMUTIL),
 *	- %l	: source line number	(decimal number),
 *	- %%	: print '%' character.
 *
 * The following string format :
 *	- "%P %p" becomes "P:SCD P:0x12345678",
 *	- "%P,%p" becomes "P:SCD,P:0x12345678",
 *	- "%P %p %t %f@%m@%l" becomes "P:SCD p:0x12345678 t:0xDEADBEEF F:foobar.c@M:COMP_API_MyFunc@L:124".
 * 
 * @code
 * DIAG_LOG_uiSegmentId_t mySegmentId;
 * [...]
 * DIAG_LOG_RegisterTraceSegment("COMP", 4, , NULL, &mySegmentId);
 * DIAG_LOG_FormatTraceSegment(mySegmentId, "SCD", "API", "%p %t %m %f@%l"); // Full debug
 * DIAG_LOG_FormatTraceSegment(mySegmentId, "SCD", "API", ""); // No extra information, only segment name & timestamp will be displayed
 * [...]
 * @endcode
 *
 * @par Overriding trace format for all segments
 *
 * It is possible to override trace format for all components and thus have a more coherent trace output.
 * To override it, put this section in the configuration file <b>diag.cfg</b> :
 *
 * @code
 * [OVERRIDDEN_VALUES]
 * TRACE_FORMAT_FOR_ALL=" %p %t %P %T %m %f %l "
 * @endcode
 *
 * @return DIAG_LOG_STATUS_SUCCESS	Optional header trace format successfully set.
 */

extern SYSTEM_STATUS	__DIAG_LOG_FormatTraceSegment(DIAG_LOG_uiSegmentId_t uiSegmentId, const char * pProcessName, const char * pModuleName, const char * pFormat);


registered diag segments as of 12th Sep 2011

DIAG: - I - DIAG_LOG_RegisterTraceSegment : registering segment 'MEMMAN'
...
DIAG: - I - ] DIAG_LOG_RegisterTraceSegment : registering segment 'VGC_JAVA'


<error-on-si-devel-profile>
However, works on UT profile.

static void CTM_SVR_FTM_CleanUpRequest( const CTM_Download_Request_t* request )
{
    /* IRH: HIJACK: */
    CTM_SVR_DBG_ERROR(("** KIT: SI-10728: IRH: HIJACK { **"));
}


#define CTM_SVR_DBG_ERROR(a)            DIAG_LOG_ERROR(g_ctm_svr_diag_id, a)

#ifdef DIAG_BINARY_MODE
#define DIAG_LOG_ERROR(id, msg)		DIAG_LOG_F2B_WRITE((id), DIAG_CMN_TRACE_ERROR, msg)
#else
#define DIAG_LOG_ERROR(id, msg)		DIAG_LOG_F2S_PRINT((id), DIAG_CMN_TRACE_ERROR, DIAG_CMN_TRACE_DETAIL_DEFAULT, msg)
#endif


<diag-thread-id> *comp-systemthread*
void __DIAG_LOG_FormatAndLogTraceBuffer()
{
  // CMS_SYSTEM_INFRASTRUCTURE/DIAG/src/log/src/diag_log.c
  uiLen = DIAG_LOG_GetFormattedTraceBuffer(acFormattedLogBuffer,
      `SYSTEMUTIL_THR_GetTid()`)
  {
    uint32_t DIAG_LOG_GetFormattedTraceBuffer()
    {
      /* Thread ID */                                        
      case 't':
        /* Increment size counter */
        uiSrcSz+=12;    /* 2 for "T:" + 8 for hex output */ 

        /* Check if we have enough space */
        if(uiSrcSz >= DIAG_LOG_TRACE_SOURCE_SZ_MAX)                    
          goto too_big_source_string;  

        /* Copy string */
        (void) sprintf(pOutputString,"t:%08x",uiThreadId);   
        pOutputString+=10;
        break;
    }
  }
}


// CMS_SYSTEM_INFRASTRUCTURE/SYSTEMUTIL/src/thread/systemutil_thread.c
/**
 * @brief Return an identifier corresponding to the calling process.
 */
uint32_t SYSTEMUTIL_THR_GetTid(void)
{
#ifdef SU_THR_STBS
  /* If we are running STBS, get the Win32 thread ID (the one in the debugger) */
  return (uint32_t) __pthread_win32threadid(pthread_self());
#else
  return (uint32_t) pthread_self();
#endif
}


={============================================================================
|kt_dev_si_0001| comp-diag-cli

<diag-level>

diag-level (refer to diag_log_formatter.c, DIAG_LOG_GetFormattedTraceBuffer)

Please note that release debug will not give you any more debug than FEW.


<diag-config>
// diagctl.cfg
/BSKYB_INTEGRATION/build/projects/picasso/fs/NDS/config/diagctl.cfg
asterisk, dot, asterisk
{
        file
    {
        path = /DATA_PARTITION/LOG;
        size = 209715200;
        format = 3/3;
        zlevel = 0;
    };

    stdout
    {
        buffersz = 1024;
    };

}

// starts from *dms-master-config*
//
// diag.cfg which defines format and level
// CMS_SYSTEM_INFRASTRUCTURE/DIAG/inc/config/diag_master_config.xml

[DEFAULT_VALUES]
TRACE_FORMAT=" %p %t %f @ %l"
TRACE_LEVEL="AFEWM"
[LOGGING]
[OVERRIDDEN_VALUES]
TRACE_FORMAT_FOR_ALL=" %p %t %T %m %f %l "
TRACE_LEVEL_AMS="AFEWM"
TRACE_LEVEL_ASM="AFEWM"
TRACE_LEVEL_ATG_API="AFEWM"
TRACE_LEVEL_ATG_LOCK="AFEWM"
...

// each component has a config file
CMS_INFORMATION_SERVICES/DBENGINE/inc/config/dbengine_master_config.xml
CMS_SYSTEM_INFRASTRUCTURE/HTTP/inc/config/http_master_config.xml
11:    <key name="TRACE_LEVEL_LIBCURL" type="STRING" value="AFEWM">


<diag-cli>
get table SYS

possible trace levels: assert fatal error warn mil info fn_entry fn_exit event p
arams return none all

set level P_Api  assert fatal error warn mil info fn_entry event params
get level P_Api

set level SYSINIT_S info


={============================================================================
|kt_dev_si_0001| comp-config

<config>
// config overrides
// make.sh

mkdir -p ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config

// run 'FusionConfigExport' which creates most cfg files.

STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/FusionConfig/FusionConfigExport 
  --ignore_missing_inc AUTO /STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/si/config/ 
  projects/picasso/SI_config.xml BASESET BSKYB_HD_PVR ams0201 si_bskyb ams-drx890 release_dbg pdl_sky_production  sky_trials  si_filldisk_inactive

// echo "${OUTPUT}/FusionConfig/FusionConfigExport AUTO 
// ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config/ 
// projects/${PROJECT}/"SI_config.xml" BASESET ${BSKYB_CONFIG_PROFILE} ${DMS_PLATFORM_CONFIG} si_bskyb ${PLATFORM} ${BUILD_TYPE} pdl_${PDL_SERVER} ${SERIALISATION}"

// Copy across Fusion formatted Platform config files for CFG2BIN conversion.
cp -f ../../../${FUSIONOS}/BLD_${PLATFORM_DIR}/platform_cfg/linux/${ENDIAN}Endian/${OS_BUILD_TYPE}/config/fusion_os_cdi_labels.cfg ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config/
cp -f ../../../${FUSIONOS}/BLD_${PLATFORM_DIR}/platform_cfg/linux/${ENDIAN}Endian/${OS_BUILD_TYPE}/config/fusion_os_storage_labels.cfg ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config/

// Copy project config files that override DMS
cp projects/${PROJECT}/fs/NDS/config/overrides/* ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config/


# run dms config

${OUTPUT}/FusionConfig/FusionConfigExport AUTO
${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/dms/config/
projects/${PROJECT}/SI_config.xml BASESET ${BSKYB_CONFIG_PROFILE}
${DMS_PLATFORM_CONFIG} ${PLATFORM} ${BUILD_TYPE}

/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/FusionConfig/FusionConfigExport
AUTO
/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/dms/config/
projects/picasso/SI_config.xml BASESET BSKYB_HD_PVR ams0201 ams_bcm
release_dbg


<bin-to-cfg>
~/STB_SW/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/picasso/FusionConfig/FusionConfigImport BIN2XML x.xml `bsysconfig.bin`


<cfg-to-bin>
// this will create bin from cfgs and keep cfgs once done.
${OUTPUT}/FusionConfig/FusionConfigImport CFG2BIN ./ *

# copy configs across to output
cp -f ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/si/config/* ${OUTPUT}/${PLATFORM_DIR}/${ENDIAN}Endian/fs/NDS/config


<si-config-xml>

<fusion_config_database>
 <include name="../dms/dms_master_config.xml" />
 ...

# SI_config.xml which defines 'si_bskyb' profile
 <include name="projects/dms/fs/NDS/dms_master_config.xml" />

// Exporting profile BASESET...
// Exporting profile BSKYB_HD_PVR...
// Overriding key ConnectionEstablishmentTimeout with same value in section
// MS_SYSTEMCONFIG_SECTION in file MS.CFG in profile BSKYB_HD_PVR
// ...
//
// Exporting profile ams0201...
// Exporting profile si_bskyb...
// Exporting profile ams-drx890...
// Exporting profile release_dbg...
// Exporting profile sky_trials...
//

<dms-master-config>
// STB_SW/DARWIN_PLATFORM/dms/public/config/dms_master_config.xml
`dms_master_config.xml` which includes each comp's config and defines BASESET,
and BSKYB_HD_PVR profile.

// <fusion_config_database>
//  <include_path name="../../" />
//  <include name="components/comms_services/ncm/inc/config/ncm_master_config.xml" />
//  <include name="components/darwin_platform_components/darwin_atg/inc/config/darwin_atg_master_config.xml" />
//  <include name="components/darwin_platform_components/darwin_ofs/inc/config/darwin_ofs_master_config.xml" />
//  <include name="components/darwin_platform_components/darwin_planner/inc/config/darwin_planner_master_config.xml" />
//  <include name="components/darwin_platform_components/darwin_search/inc/config/search_master_config.xml" />
//  <include name="components/comms_services/ncm/inc/config/ncm_master_config.xml" />
//  ...


<ex-rmf>
// STB_SW/CMS_SYSTEM_RESOURCE/RMF/inc/config/rmf_master_config.xml

   <section name="quota1_internal">
    <key name="quota_name" type="STRING" value="user">
    </key>
    <key name="quota_type" type="STRING" value="user_type">
    </key>
    <key name="statistics_required" type="INTEGER" value="1">
    </key>
    <key name="partition_name" type="STRING" value="RECORDING">
    </key>
    <key name="max_size" type="INTEGER" value="80000">

// also SI_config.xml can override default values from the comp's xml.


<outputs>
Once build is done, can see outputs:

drwxr-xr-x  3 kyoupark ccusers    4096 Jul 18 13:37 fs/
drwxr-xr-x  3 kyoupark ccusers    4096 Jul 18 13:58 FusionConfigCommon/
drwxr-xr-x  3 kyoupark ccusers    4096 Jul 18 13:59 si/

note:
Only can see cfg files in the output when cfg changes are right. If cfg
changes is wrong then build goes okay but not give you an error. However, a
box cannot boot up with that image. 

// build/projects/picasso/fs/NDS/config
diagctl.cfg          guide_cms_cde_3.cfg  guide_cms_cde.cfg  guide_cms_num.cfg  siege_def.cfg  version.cfg
guide_cms_cde_2.cfg  guide_cms_cde_4.cfg  guide_cms_dsc.cfg  lae.cfg            stbe.ini

// build/projects/picasso/fs/NDS/etc
sysinit.cfg


={============================================================================
|kt_dev_si_0001| comp-mil

#
# STANDBY MIL
# egrep -an "(KEY_PRESS:|PLAYER_API_Session_Play|STANDBY|MOVING TO)" LOGlast
NDS: ^[23:46:23]0946770383.725609 !MIL    -UAM          	< p:0x00000000 P:MW t:0x0125a120 T:UAM_HP_THREAD M:internal_pbag.c F:Internal_Pbag_Print L:420 > UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_OUT 

NDS: ^[20:07:23]0946757243.169361 !MIL   -EPG_INIT     < p:00000168 t:2c0da520 T:no name M:InitialisationManager F:moveToAc
tive L:00633 > MOVING TO ACTIVE

NDS: ^[03:19:17]0946696757.277312 !MIL    -UAM          	< p:0x00000000 P:MW t:0x0125a120 T:UAM_HP_THREAD M:internal_pbag.c F:Internal_Pbag_Print L:415 > UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_IN 

NDS: ^[03:31:52]0946697512.320800 !MIL   -EPG_INIT     < p:00000168 t:2c08f520 T:no name M:InitialisationManager F:moveToSt
andby L:00668 > MOVING TO STANDBY

#
#
#
NDS: ^0946932953.403753 !MIL   -P_Api        < p:00000079 t:010df920 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:01230 > VIDEO IS HIDDEN
NDS: ^0946932953.404077 !MIL   -P_Api        < p:00000079 t:010df920 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:06274 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000027, status=NOT_RUNNING

# this is pair to play a service
# LOGGER.logMilestone("TUNING TO " + data.getGuideService().getName() + ", "
# + data.getGuideService().getNumber());
# 
NDS: ^0946932968.608922 !MIL   -EPG_ME       < p:00000079 t:2be76520 T:no name M:MediaEngine F:playService L:01314 > TUNING TO BBC 1 London, 101
NDS: ^0946932968.609234 !MIL   -P_Api        < p:00000079 t:2be76520 T:no name M:player_api_session.c F:PLAYER_API_Session_Play L:03151 > PLAY

NDS: ^0946932970.592436 !MIL   -P_Api        < p:00000079 t:010df920 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:01226 > VIDEO IS SHOWN
NDS: ^0946932970.592873 !MIL   -P_Api        < p:00000079 t:010df920 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:06274 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000029, status=RUNNING


# IP Address
NDS: ^0946932953.045506 !WARN  -EPG_INIT     < p:00000079 t:2be8f520 T:no name M:InitialisationManager F:printVersionDebugAndStandbyMessage L:00573 > THE REAL IPADDRESS: , ipaddr 172.18.201.47, mask  THE REAL IPADDRESS:


={============================================================================
|kt_dev_si_0001| comp-ncm comp-network

NDS_BUILD_TYPE_ncm_server = debug

# to DHCP
# !ERROR -NCM_SERVER   < M:ncm_server_main.c F:NCM_DHCP_CallBack L:01469 > DHCP fails on the interface eth0 and returns the following error:
# !ERROR -NCM_SERVER   < M:ncm_server_main.c F:NCM_DHCP_CallBack L:01474 > Server Timeout.
# 
ncm_server_dhcp_start_unprotected
	s_dhcp_reg->start(NCM_DHCP_CallBack)

NCM_DHCP_CallBack
	DHCPEvent.eventType
	DHCPEvent.errorStatus


#
# logs
#
275:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03411 > Sending SPM_API_NETWORK_MAIN_CONFIG_UNSET event
581:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03394 > Sending SPM_API_NETWORK_MAIN_CONFIG_SET event

# switch wired to wireless
#
3839:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03373 > Ethernet cable unplugged in interface "eth0"
3860:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03411 > Sending SPM_API_NETWORK_MAIN_CONFIG_UNSET event

# wireless on
#
4114:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03358 > Ethernet cable plugged in interface "eth0"

4125:!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00325 > Starting the DHCP on the interface "eth0"...
4131:!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00432 > DHCP has been started on eth0.

7459:!ERROR -NCM_SERVER   < M:ncm_server_main.c F:NCM_DHCP_CallBack L:01469 > DHCP fails on the interface eth0 and returns the following error:
7460:!ERROR -NCM_SERVER   < M:ncm_server_main.c F:NCM_DHCP_CallBack L:01474 > Server Timeout.

7481:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03411 > Sending SPM_API_NETWORK_MAIN_CONFIG_UNSET event

8243-8322: App called SPM api to get a main config and failed to get as below errors were shown:

# !ERROR -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_get_options L:00778 > DHCP has not yet started or failure.
# !ERROR -NCM_SERVER   < M:ncm_server_interface.c F:ncm_server_interface_get_lease L:02949 > Failed to get DHCP options values: 0x12421003.

# switch wireless to wired
#
8475:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03373 > Ethernet cable unplugged in interface "eth0"
8496:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03411 > Sending SPM_API_NETWORK_MAIN_CONFIG_UNSET event

8567:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03358 > Ethernet cable plugged in interface "eth0"

8578:!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00325 > Starting the DHCP on the interface "eth0"...
8587:!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00432 > DHCP has been started on eth0.

8630:!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03394 > Sending SPM_API_NETWORK_MAIN_CONFIG_SET event


<network-on-off>

4419621:DRV: ^[2016:11:10 13:10:56]0949092866.931536 KERN_CRIT eth0 Link UP.

!WARN   -SPM_CLIENT   		< P:MW t:0x01f2c520 T:DLM_HANDLEEVENTS M:spm_client_network.c F:SPM_API_Network_GetEthernetStatus L:3126 > Network ready didn't arrived. Returning default Ethernet status SPM_API_NETWORK_ETHERNET_PLUGGED 
!MIL    -NCM_SERVER   		< P:SCD t:0x0067f530 T:NCM_SERVER_MAIN M:ncm_server_event.c F:ncm_server_event_global_status_check_and_notify L:1520 > The NCM_SESSION_EVENT_TYPE_GLOBAL_NET_SET (v4) event has been notified. 

*comp-network*
!MIL    -DSAM         		< P:CA t:0x00a01530 T:DSAM M:../../../../..//src/extensions/dsam/src/dsam_ctr F:DSAM_ProcessNetworkUp L:3054 > !DSAM_MIL_NETWORK! Network UP

!MIL    -SSM_UPNP     		< P:MW t:0x01e04520 T:SSM_UPNP_CLIENT M:ssm_upnp_client.c F:SSM_UPNP_Client_DoUpnpStart L:1370 > Upnp library initialised on '192.168.1.65' port 0 (0 == port initialisation left to UPnP) 
!MIL    -SPM_COMMON   		< P:MW t:0x01dd6520 T:SPM_DISPATCHER M:spm_hsm.c F:SPM_HSM_EventHandledToNewState L:394 > [HSM] New State[26] SPM_NETWORK_State_NETWORK_APPLIED_OK_STATE 
!MIL    -SPM_NETWORK  		< P:MW t:0x01dd6520 T:SPM_DISPATCHER M:spm_network.c F:SPM_Network_InitDone L:726 > NCM initial configuration set (Network ready) 
!MIL    -SPM_COMMON   		< P:MW t:0x01dd6520 T:SPM_DISPATCHER M:spm_hsm.c F:SPM_HSM_EventHandledToNewState L:394 > [HSM] New State[28] SPM_NETWORK_State_CONFIG_CLOSED 

!MIL    -EPG_NET      		< M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 50ms: pdlAvailable=true


={============================================================================
|kt_dev_si_0001| comp-dhcp

# status code
# (COMP, COMPIF, SEVERITY, STATUS) -> (COMP, SEVERITY, COMPIF, STATUS)
# DHCP: (54, 1, 1, 2)
# hex(((COMP & 0x3FF) << 22) | ((SER & 0x3) << 16) | ((IF & 0xF) << 12) | (STATUS & 0xFFF) )
# hex(((54 & 0x3FF) << 22) | ((1 & 0x3) << 16) | ((1 & 0xF) << 12) | (2 & 0xFFF) )
DHCP_STATUS_ERR_UNKNOWN_OPTION 			0xd811002

#
Without retry statement, DHCP wait 5 minutes before retry to get the release.
But DHCP never stop request.

#
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk
NDS_BUILD_TYPE_dhcp= debug
NDS_BUILD_TYPE_dhcp_client= debug



!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00432 > DHCP has been started on eth0.
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292904, value ÿÿü
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292936, value ¬Ëþ
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292984, value ¬ýdÀ¨d
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01675 > DHCPOFFER from 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:send_request L:02208 > DHCPREQUEST on eth0 to 255.255.255.255 port 67
!INFO  -DHCP         < M:dhclient.c F:dhcpack L:01071 > DHCPACK from 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03168 > Enter update_network_config, action = 4
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03364 > Set IP address, netmask and broadcast address :
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   IP address 172.18.201.245
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   NetMask 255.255.252.0
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03378 >   NetMask length : 22
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   Broadcast address 172.18.203.255
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > Add gateway obtained through dhcp server to routing table : 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03545 > 2 DNS servers set :
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > DNS server 1 : 172.18.253.100
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > DNS server 2 : 192.168.5.100
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03757 > Flags after update_network_config(action = 4) : 0x8043
!INFO  -DHCP         < M:dhclient.c F:bind_lease L:01352 > bound to 172.18.201.245 -- renewal in 112750 seconds.
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_start L:01875 > Receive event on at least one fd 48
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_compare_with_given_fds_cb L:01434 > searched fd = 48
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_itc_callback L:05632 > received msg 4
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_itc_callback L:05695 > received ITC_DHCP_CALLBACK on "eth0".
!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_get_conf L:01244 > A DHCP conf for interface eth0 has been found.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04888 > DHCP is bound on eth0. The stack should be ready.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04889 > NCM and co are glad to have set the configuration.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04890 > Enjoy IP.
!INFO  -NCM_SERVER   < M:ncm_server_event.c F:ncm_server_event_send_notification_to_subscriber L:00427 > Sending event 0x7d7744 to external subscriber ipc 0x9 sess 0x14f2018.
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Listener L:00189 > |-> SPM_NCM_Listener
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04913 > Sending event NCM_SESSION_EVENT_TYPE_LINK_LOCAL_NET_SET.
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_Network_MessageHandler L:03787 > |-> SPM_Network_MessageHandler
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03345 > |-> SPM_NCM_Event
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03594 > <-| SPM_NCM_Event : return_status = 0x00000000 (duration = 0"000.116)
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_Network_MessageHandler L:03816 > <-| SPM_Network_MessageHandler : return_status = 0x00000000 (duration = 0"000.399)
!INFO  -NCM_SERVER   < M:ncm_server_event.c F:ncm_server_event_send_notification_to_subscriber L:00427 > Sending event 0x7d7744 to external subscriber ipc 0x9 sess 0x14f2018.
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Listener L:00204 > <-| SPM_NCM_Listener : return_status = 0x00000000 (duration = 0"001.034)
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04944 > Sending event NCM_SESSION_EVENT_TYPE_GLOBAL_NET_SET.
!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_start_unprotected L:00432 > DHCP has been started on eth0.
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_process_and_remove_alarm_nodes L:02085 > re-inserted alarm node 0x7d0754
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_compute_alarms L:00304 > timeout to be launched in 992 milli sec!
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_start L:01820 > l_nb_fd_to_check: 2, l_msec_timeout: 992
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292904, value ÿÿü
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292936, value ¬Ëþ
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01592 > Option found in dhcp offer, option 6292984, value ¬ýdÀ¨d
!INFO  -DHCP         < M:dhclient.c F:dhcpoffer L:01675 > DHCPOFFER from 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:send_request L:02208 > DHCPREQUEST on eth0 to 255.255.255.255 port 67
!INFO  -DHCP         < M:dhclient.c F:dhcpack L:01071 > DHCPACK from 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03168 > Enter update_network_config, action = 4
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03364 > Set IP address, netmask and broadcast address :
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   IP address 172.18.201.245
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   NetMask 255.255.252.0
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03378 >   NetMask length : 22
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 >   Broadcast address 172.18.203.255
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > Add gateway obtained through dhcp server to routing table : 172.18.203.254
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03545 > 2 DNS servers set :
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > DNS server 1 : 172.18.253.100
!INFO  -DHCP         < M:dhclient.c F:display_addr L:00152 > DNS server 2 : 192.168.5.100
!INFO  -DHCP         < M:dhclient.c F:update_network_config L:03757 > Flags after update_network_config(action = 4) : 0x8043
!INFO  -DHCP         < M:dhclient.c F:bind_lease L:01352 > bound to 172.18.201.245 -- renewal in 112750 seconds.
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_start L:01875 > Receive event on at least one fd 48
!INFO  -NCM_SERVER   < M:ncm_server_scheduler.c F:ncm_server_scheduler_compare_with_given_fds_cb L:01434 > searched fd = 48
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_itc_callback L:05632 > received msg 4
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_itc_callback L:05695 > received ITC_DHCP_CALLBACK on "eth0".
!INFO  -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_get_conf L:01244 > A DHCP conf for interface eth0 has been found.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04888 > DHCP is bound on eth0. The stack should be ready.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04889 > NCM and co are glad to have set the configuration.
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04890 > Enjoy IP.
!INFO  -NCM_SERVER   < M:ncm_server_event.c F:ncm_server_event_send_notification_to_subscriber L:00427 > Sending event 0x7d7744 to external subscriber ipc 0x9 sess 0x14f2018.
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Listener L:00189 > |-> SPM_NCM_Listener
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04913 > Sending event NCM_SESSION_EVENT_TYPE_LINK_LOCAL_NET_SET.
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_Network_MessageHandler L:03787 > |-> SPM_Network_MessageHandler
!ENTER -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03345 > |-> SPM_NCM_Event
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03594 > <-| SPM_NCM_Event : return_status = 0x00000000 (duration = 0"000.116)
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_Network_MessageHandler L:03816 > <-| SPM_Network_MessageHandler : return_status = 0x00000000 (duration = 0"000.399)
!INFO  -NCM_SERVER   < M:ncm_server_event.c F:ncm_server_event_send_notification_to_subscriber L:00427 > Sending event 0x7d7744 to external subscriber ipc 0x9 sess 0x14f2018.
!EXIT  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Listener L:00204 > <-| SPM_NCM_Listener : return_status = 0x00000000 (duration = 0"001.034)
!INFO  -NCM_SERVER   < M:ncm_server_main.c F:ncm_server_main_dhcp_callback L:04944 > Sending event NCM_SESSION_EVENT_TYPE_GLOBAL_NET_SET.


={============================================================================
|kt_dev_si_0001| comp-sbm

Pasquali, Yuri 
Ian Henderson for SBM

# System Booking Management manages those bookings that are made automatically, without user intervention  for example on behalf of a 
# Movie of the Day or Push VOD PVR service.
# Push Video on Demand.  A mechanism by which a broadcaster can ensure content is automatically recorded to a users set top box. 
# The content selected for recording may be based on user genre preferences, but the individual programmes are not specifically selected by the user.
# 
# User recordings take priority over PVOD recordings in conflict resolution.  
# This will happen automatically under the new RMF design for PVOD recording job priorities.
#
# However, because PVOD recordings are hidden from the user, it is not necessary to resolve the conflict at booking time. 
# Instead the conflict will be resolved at recording time (see Start Recording a PVOD event (WP 84.2)).
#
# When the STB exits standby, active PVOD recordings must be stopped as necessary to allow live TV and user recordings. 
# This will happen automatically under the new RMF design for PVOD recording job priorities 
#
# The VOD asset is moved to the users disk quota from the PVOD quota
# Assets have a given visibility window, which is controlled by the publish and expiry start dates. 
# The expiry date is used to force the deletion of the asset from the STBs hard disc.#
#
COMPONENT_NAME := darwin_sbm_server
COMPONENT_NAME := darwin_sbm_client

# to create VRM job
SBM_SERVER_VRM_CreateJobCommon

# to book PVOD
SBM_SERVER_SIM_INTERFACE_PVODResolved
	SBM_SERVER_PCAT_InsertBooking
		SBM_SERVER_PCAT_CreateSchedItemVList # see pcat prop ids to set

# cfg
# is it a value to make downloading fast?
MIN_CACHE_DEPTH_HOURS=24

#
# SBM_SERVER_CONFLICT_GetSBMConflictStatusfromRMFStatus
!ERROR -SBMS_USERBOOKING < T:SBM_UB_MAIN M:sbm_server_ub_conflict.c F:SBM_SERVER_CONFLICT_mapRmfStatus L:00822 > Unexpected RMF staus code 7821001
!ERROR -SBMS_USERBOOKING < T:SBM_UB_MAIN M:sbm_server_ub_conflict.c F:SBM_SERVER_CONFLICT_mapRmfStatus L:00829 > BAD staus code RMF: 7821001, SBM: 8826001


={============================================================================
|kt_dev_si_0001| comp-scm

# Power, Duncan <DPower@nds.com>; Charrett, Adam <ACharrett@nds.com>; Thomas, Neil <NThomas@nds.com>
#
TRACE_LEVEL_SCM="AFEWM"

COMPONENT_NAME:=darwin_scm_server


NDS: ^0946693619.433615 !MIL   -SCM          < p:0000007e t:01601310 T:SSM_UPNP_CLIENT M:ssm_wrapper.c F:CDSC_RecvServiceDesc_cb L:00683 > Adding server 444D5376-3253-6B79-5365-0019fb35a651/363500535

NDS: ^0946685040.217500 !MIL   -SCM          < p:00000095 t:015ff0d0 T:SSM_UPNP_CLIENT M:ssm_wrapper.c F:CDSC_RecvServiceDesc_cb L:00683 > Adding server 444D5376-3253-6B79-5365-00101800122e/383999006
# from comp-SCM
# 00101800122e is mac
# 383999006 is serial and friendly name


# for wireshark
eth.src == 00:19:fb:0b:ad:0c

# UPNP Agent ID comparison
# CMS_SYSTEM_INFRASTRUCTURE\UPNP\src\upnp\src\webserver.c
# CMS_SYSTEM_INFRASTRUCTURE\UPNP\src\common\src\osport.c


# libupnp.cfg
[PRODUCTNAME_FILTERING]
FILTERING_ENABLED=TRUE
PRODUCTNAME="SKY"
PRODUCTNAME_FILTER="SKY" # use only


NDS: ^0946684945.554820 !ERROR -UPNP         < p:0000007e t:0168b7b0 T:UPNP_MINISERVER_THREAD_8 M:webserver.c F:NDS_CheckProductName L:01130 > [KT_HIJACK] headerLine = Linux/2.6.18.8 UPnP/1.0 KTPARK DLNADOC/1.50

# header line matches to the filter name
NDS: ^0946684945.554994 !ERROR -UPNP         < p:0000007e t:0168b7b0 T:UPNP_MINISERVER_THREAD_8 M:webserver.c F:NDS_CheckProductName L:01160 > [KT_HIJACK] l_ret == 0. ProductName KTPARK DLNADOC/1.50 match expected KTPARK

# once matched, it is showed as connected. it matches Adding log


={============================================================================
|kt_dev_si_0001| comp-ssm

# Bassett, Chris. van der Beek, Wouter(CO)
#
# MAX_SERVICES_PER_CLIENT
# Yes, it controls how many services (and hence how many UPnP devices) a client within the middleware can discover.
#


={============================================================================
|kt_dev_si_0001| comp-upnp

Dumaine, Alexandre 
Madre, Guillaume (prestataire) 
Elghazzaoui, Makram (prestataire)

!MIL   -SSM_UPNP     < T:SSM_UPNP_CLIENT M:ssm_upnp_client.c F:SSM_UPNP_Client_DoUpnpStop L:01211 > UPnP Library stopped successfully
!MIL   -SSM_UPNP     < T:SSM_UPNP_CLIENT M:ssm_upnp_client.c F:SSM_UPNP_Client_DoUpnpStart L:01133 > Upnp library initialised


<comp-upnp-comp-player>
!MIL    -P_Api        		< T:PLAYER_MAIN M:player_api_remoterequests.c F:PLAYER_RemoteRequest_Queue_QueueRequest L:658 > Queued \"SetAVTransportURI\" remote request. RemoteHdl: 0x0000008D 
!MIL    -EPG_PLAY     		< T:no name M:PlayerEventPump F:processEvent L:110 > T:PooledExecutor#1:PlayerEvent > pg@5ab2d90 ID > 301989889
!MIL    -EPG_ME       		< T:no name M:CompanionDeviceManager F:handleEvent L:71 > T:PooledExecutor#1:Got UPnP event of type pg
!MIL    -EPG_ME       		< T:no name M:CompanionDeviceManager F:checkIfRemotePlayOfLiveEventAllowed L:212 > T:PooledExecutor#1:checkIfRemotePlayOfLiveEventAllowed
!MIL    -EPG_MISC     		< T:no name M:EpgStateTracker F:isEpgInStandbyForUPnP L:59 > T:PooledExecutor#1:epgInStandbyForUPnP = false
!MIL    -EPG_ME       		< T:no name M:CompanionDeviceManager F:checkIfRemotePlayOfLiveEventAllowed L:215 > T:PooledExecutor#1:epgStateChecker says YES
!MIL    -EPG_MISC     		< T:no name M:RemoteEventAuthorizer F:authorizeRemoteChannelChange L:69 > T:PooledExecutor#1:authorizeRemoteChannelChange
!MIL    -EPG_TVVM     		< T:no name M:TVViewingManager F:existsInChannelLineup L:1932 > T:PooledExecutor#1:existsInChannelLineup > construct Promise
!MIL    -EPG_TVVM     		< T:no name M:TVViewingManager$15 F:run L:1940 > T:PooledExecutor#1:existsInChannelLineup > true
!MIL    -EPG_ME       		< T:no name M:CompanionDeviceManager F:prepareRequest L:536 > T:PooledExecutor#1:UPnP YES: requestHandle=pg@5ab2d90
!MIL    -EPG_TVVM     		< T:no name M:TVViewingManager F:tune L:1304 > T:PooledExecutor#1:TUNING [1]
!MIL    -EPG_TVVM     		< T:no name M:Tuner F:doExternalTune L:913 > T:PooledExecutor#1:doExternalTune - TUNING - service = Sky One HD context = 8 performConflictCheck > true
!MIL    -EPG_CONF     		< T:no name M:ConflictAuthorizer F:pvrTuneAuthorized L:184 > T:PooledExecutor#1:Perform conflict check- call resolver true
!MIL    -VRM_SERVER   		< T:SBM_UB_MAIN M:fsm.c F:FSMRun L:917 > VRM-FSM: job_man:0x2000053: E_JOB_MAN_SRV_INT_ST_NULL -> (E_JOB_MAN_SRV_INP_RUN) -> E_JOB_MAN_SRV_INT_ST_CREATING 
!MIL    -VRM_SERVER   		< T:SBM_UB_MAIN M:job_man_srv.c F:JobManSrvCreate L:4843 > VRM_JOB_CREATE: jtVRM=jb-live, jhVRM=0x2000053 
!MIL    -VRM_SERVER   		< T:SBM_UB_MAIN M:live.c F:LIVE_Create L:1395 > @@PMON@@,mark,job,job-create,3,job-create-type=,jb-live,job-srcloc=,locator:5:3:FDD,job-destloc=,locator:3:2E:4B:0 


={============================================================================
|kt_dev_si_0001| comp-sfm

# contacts
Steven Williams, Component Owner 

# internal

# there are only three clients (SDM, FDM and SIM) so adding some debug in each
# to print the session_handle obtained from SFM_API_SESSION_CreateSession()
# will allow us to see who needs to do a further investigation.

SIM -> SFM -> MDM


# status code
# (COMP, COMPIF, SEVERITY, STATUS) -> (COMP, SEVERITY, COMPIF, STATUS)
# SFM: (38, 1, 1, 4)
# hex(((COMP & 0x3FF) << 22) | ((SER & 0x3) << 16) | ((IF & 0xF) << 12) | (STATUS & 0xFFF) )
# hex(((38 & 0x3FF) << 22) | ((1 & 0x3) << 16) | ((1 & 0xF) << 12) | (4 & 0xFFF) )
SFM_API_STATUS_FAILURE 			0x0982100A
SFM_API_STATUS_VERSION_CHANGED	0x09811004
SFM_API_STATUS_TIMEOUT			0x09811005

# mem pools
section_memory_pool : section size from config file, 'MEMORY_SIZE_SESSION=1792,000'. 1.7M
g_SFM_mempool : session size from config file, 'MEMORY_SIZE_ADMIN=741376'

# open section filter device
selectConfigureSectionFilter calls openSectionFilter and closeTPIDSectionFilters


#-----------------------------------------------------------
# Interaction diagram
#-----------------------------------------------------------

# 00
# register client's listener. create 'session' from the pool.
"SFM_API_SESSION_CreateSession" (SIM_pi_xsi_gap_filler_SectionListener)

# 01
SIM_pi_xsi_gap_filler_AddRequest:
	tmp_ptr = SIM_PI_MALLOC (sizeof(SKEVT_SECTION_REQUEST));
	
	# fill tmp_ptr
    status = "SFM_API_MPEG_PrivateSectionRequest" ("p_handler->session_handle", &tmp_ptr->filter, p_request_handle);

# 02
SFM_API_MPEG_PrivateSectionRequest( , SFM_API_MPEG_PrivateSectionFilter *filter_params, ) # this filter_params has TPID
	(** check if tpid is vaild **)
	SFM_USER_REQUEST_Create_Request(&request)
		*request = MEMMAN_API_AllocElementP(g_SFM_mempool, f_request_allocator)
	request->private_section_params = filter_params;
	SFM_SCHEDULER_AddRequest(request)

	SFM_SCHEDULER_CommandQueueThread
		addRequest
		  SFM_SCHEDULER_PreemptOrDefer(SFM_Request *request)
		  	demux = SFM_SCHEDULER_FindDemux # find one from demux_list which is global list and is used alloc from a pool
			tpid_filter = findTPIDFilter(demux, request) # find TPID from the requst and fill demux struct

			SFM_SCHEDULER_PreemptorTPID(request, demux, tpid_filter);
			{
				SFM_SCHEDULER_ActivateRequest(SFM_Request *requesti, , SFM_TPIDFilter *tpid_filter)
				{
					selectConfigureSectionFilter # open and configure SF and TPIDF
					SFM_ActiveRequest *active_request = MEMMAN_API_AllocElementP(g_SFM_mempool, g_SFM_active_request_allocator);
					active_request->tpid_filter = tpid_filter

					SFM_GetRawFilterParameters(prepare DemuxSectionfilter from SFM_Request )
					SFM_AddRequest(SFM_ActiveRequest *request)
						SFM_AddFilter(SFM_ActiveRequest* activeRequest) (** write fifo, SFM_CDI_FilterMonitor_Message **)
						{
							message.activeRequest = activeRequest;
							write(fifo_w_fd, &message)
						}

					MEMMAN_API_FreeElementP(g_SFM_mempool, g_SFM_active_request_allocator, active_request); ** "???" ***
				}
				SFM_SCHEDULER_RescheduleFreeResources(demux)
					claimTPIDFilter(demux, request)
					{
						openAttachTPIDFilter
						tpid = getTPIDFromRequest(request);
						SFM_ioctl_TPIDFILTER_SET_TPID(demux->tpid_filters[i].fd, &tpid) # set TPID
					}
			}


# 03
						CDI_FilterMonitorThread:
						(** read fifo, SFM_CDI_FilterMonitor_Message **)
							addFilter ( using cmd fifo from 'Scheduler' to 'CDI Filter Monitor'. call DEMUX ioctl )
								SFM_ioctl_SECTIONFILTER_SET_FILTER(, &activeRequest->raw_params. this only has filter settings )
								SFM_ioctl_DEMUX_START(activeRequest->section_filter->fd)


# 04
# alloc section mem, read data from cdi device, call a listener with data
# buffer ptr.  if SFM cannot allocate Section in SFM memory, then read data
# from a device and discard it in order to empty SF device.  SFM allocs a pool
# for SFM sections which is about 1.7 MB and this pools is used for each
# clients.  Each client has config values for its SFM section and this config
# values is used to max limit for each SFM session. 

<sfm-error>
# Expected error in SFM_SessionMgr_AllocateSection
WARN(SFM_SERVER, "Client buffer full - Client is not reading data fast enough"));
WARN(SFM_SERVER, "Session ID %d size : %d, in use: %d, requested : %d", session->handle, session->memory_limit, session->memory_used, section_size));


CDI
	SFM_SectionReceived
		readSection: SFM_SessionMgr_AllocateSection and FILE_READ() to SFM_Section.data
        call client listner


# 05
# callback proto
# request->details->session->section_listener
# ( request->details->handle, SFM_API_STATUS_OK, request->details->user_defined_params->usertag, mySection->handle);
send a mesg to SIM_pi_xsi_mc_EventListenerThread, SIM_pi_xsi_mc_EventHandler
immediately and in this thread, call SFM_API_MPEG_GetSection(&data)

static void SIM_pi_xsi_gap_filler_SectionListener (SFM_API_REQUEST_HANDLE request_handle,
                                                   SYSTEM_STATUS status,
                                                   uint32_t usertag,
                                                   SFM_API_SECTION_HANDLE section_handle)
{
	# get p_handler
	SYSTEMUTIL_HDL_GetObject((SYSTEMUTIL_HDL_Handle_t)usertag, (void **)&p_handler);

	# get section length and data ptr 	
	"SFM_API_MPEG_GetSection" (section_handle,&section_length,"&p_section_data");
	
	# save section handle into p_handler
	SIM_pi_xsi_gap_filler_AddSection(p_handler, section_handle);
	
	#
	SIM_PI_XSI_SKTHREAD_PostEvent(SIM_PI_XSI_SKTHREAD_SECTIONS_AVAILABLE_EVENT)
}

# pass a pointer to caller and caller simply use this buffer in SFM.
# Eventually, client should call SFM_API_MPEG_DeleteSection otherwise SFM
# section mem become full.

SIM_pi_xsi_skthread_EventHandler
{
	SIM_pi_xsi_skthread_ProcessSections
		"SFM_API_MPEG_DeleteSection"
			SFM_SessionMgr_FreeSection
}

# 06
# cancel request

<error>
EBUSY

!FATAL  -SFM_SERVER   		< P:MW T:SFM_SCHEDULER M:sfm_scheduler_preemptor.c
F:selectConfigureSectionFilter L:431 > Failed to open section filter (filter
    /dev/nds/demux0/sectionfilter, errno 16) 

<sfm-dump> <sfm-setcion>
!ERROR  -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:cancelFilter L:804 > Failed to stop DEMUX for request 0x00000040 
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:935 > Total active requests 32 
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:939 > ----------------------------------1---------------------------------- 
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:940 > Active request 0x177e1bc  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:941 > Timed Out 0x00000000  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:942 > Drop detect section count 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:943 > State 0x00000002  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:944 > Tpid filter 0x1f32054  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:947 > device id 17  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:948 > fd 262  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:949 > highest priority 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:950 > preemptible 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:951 > tpid 2305  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:952 > ts_channel 0x1  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:953 > usage_count 1  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:956 > Section filter 0x1f32734  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:959 > Buffer Size 8192  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:960 > fd 293  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:961 > used 0x1  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:962 > bank_data 0x1eeefec  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:965 > bank 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:966 > bank_start_index 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:967 > bank_end_index 31  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:968 > free_filters 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:969 > num_filters 32  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:970 > real_bank_mode 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:972 > tpid_filter 0x1f32054  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:975 > device id 17  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:976 > fd 262  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:977 > highest priority 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:978 > preemptible 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:979 > tpid 0x901  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:980 > ts_channel 0x1  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:981 > usage_count 1  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:982 > bank_index 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:985 > Raw Parameters 
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:986 > control 0x082  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:993 > value FC 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1000 > mask FF 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1007 > mode 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1010 > Original Parameters 
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1011 > control 0x00000000  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1018 > value 00 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1025 > mask 00 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1032 > mode 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1034 > Request 0x000029c4  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1035 > Session 0x000001ea  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1036 > Session state 0x00000002  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1037 > Session scheduler state 0x00000002  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1038 > Demux ID 0x00000000  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1039 > TsChannel ID 0x00000001  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1040 > New Demux ID 0x00000000  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1041 > New TsChannel ID 0x00000001  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1042 > Buffer Size 8192  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1043 > Memory Limit 16384  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1044 > Memory Used 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1045 > Section Listener 0x443ddc  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1046 > State Listener 0x443d54  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1047 > Cancel Count 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1048 > Full Count 0  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1049 > Flags 0x00000000  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1050 > Type 0x00000002  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1051 > Filter Mode 0x00000003  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1052 > Persistent Request 0x00000001  
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1054 > ---------------------------------------------------------------------- 

// from CDI
Table 4.11 MPEG Section Filter Coverage
Section Filter Byte MPEG Section Byte
0                   0

!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:993 > value FC 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1000 > mask FF 00 00 00 00 00 00 00 00 00 00 00   
!WARN   -SFM_SERVER   		< p:0x00000206 P:MW t:0x017c9520 T:SFM_FILTER_MONITOR M:sfm_cdi_filter_monitor.c F:dumpFilterConfiguration L:1007 > mode 00 00 00 00 00 00 00 00   

So first byte is table id(tid) which is 8 bits.


={============================================================================
|kt_dev_si_0001| comp-sim

#-----------------------------------------------------------
# contacts
#-----------------------------------------------------------
Beale, Edward(TL); Norman, Isaac(TL for BSKYB project). 
Whitehouse, Jim
Mardell, Alan

Parry, Rhys <RParry@nds.com>

# Mar. 2012
+ Juan for BSkyB
(Neither Isaac nor Parry, Rhys work on BSkyB at present)

#-----------------------------------------------------------
# diag
#-----------------------------------------------------------
COMPONENT_NAME := sim

# diag
(sim_toolbox_diag.h)
#define SIM_ODECODER_DIAG_NAME                  ("SS0A")    /*!< @brief SIM_ODECODER segment name */
#define SIM_RRP_SERVER_DIAG_NAME                ("SS0B")    /*!< @brief SIM_RRP_SERVER segment name */
#define SIM_SFM_MOCK_DIAG_NAME                  ("SM00")    /*!< @brief SIMs SFM_MOCK segment name */
#define SIM_MSM_MOCK_DIAG_NAME                  ("SM01")    /*!< @brief SIMs SFM_MOCK segment name */
#define SIM_SI_CLIENT_DIAG_NAME                 ("SC00")    /*!< @brief SIM_SI interface segment name */
#define SIM_RRP_CLIENT_DIAG_NAME                ("SC01")    /*!< @brief SIM_RRP_CLIENT segment name */
#define SIM_FECM_CLIENT_DIAG_NAME               ("SC02")    /*!< @brief SIM_FECM interface segment name */
#define SIM_IPC_COMMS_DEBUG                     ("SU01")    /*!< @brief SIM_IPC_COMMS segment name */
#define SIM_THREAD_CREATE_DEBUG                 ("SU02")    /*!< @brief SIM_THREAD_CREATE segment name */
#define SIM_MSO_DIAG_NAME                       ("SU03")    /*!< @brief Segment name for SIM MSO util interface */
#define SIM_SYSTEMOBJECT_DIAG_NAME              ("SU04")    /*!< @brief Segment name for SIM SYSTEMOBJECT util interface */
#define SIM_CATEGORY_CONV_DIAG_NAME             ("SU05")    /*!< @brief Segment name for SIM Category Conversion util interface */
#define SIM_LCC_INIT_DIAG_NAME                  ("SQ00")    /*!< @brief Segment name for SIM Lifecycle Controller */
#define SIM_CMC_DIAG_NAME                       ("SQ01")    /*!< @brief Segment name for SIM Cache Mode Controller */
#define SIM_MHSI_CTRL_DIAG_NAME                 ("SQ02")    /*!< @brief Segment name for SIM MHSI Controller */
#define SIM_DBC_INIT_DIAG_NAME                  ("SQ10")    /*!< @brief Segment name for SIM Database Client */
#define SIM_DBC_SCHEMA_DIAG_NAME                ("SQ11")    /*!< @brief Segment name for SIM DBC SCHEMA segment */
#define SIM_DBC_POP_DIAG_NAME                   ("SQ12")    /*!< @brief Segment name for SIM_DBC_POPULATION interface */
#define SIM_DBC_QUERY_DIAG_NAME                 ("SQ13")    /*!< @brief Segment name for SIM_DBC_QUERY interface */
#define SIM_DBC_GC_DIAG_NAME                    ("SQ14")    /*!< @brief Segment name for SIM_DBC_GC interface */
#define SIM_DBC_MOVER_DIAG_NAME                 ("SQ15")    /*!< @brief Segment name for SIM_DBC_MOVER interface */
#define SIM_DBC_UTIL_DIAG_NAME                  ("SQ16")    /*!< @brief Segment name for SIM_DBC_UTIL interface */
#define SIM_DBC_CHNUM_DIAG_NAME                 ("SQ17")    /*!< @brief Segment name for SIM_DBC_CHNUM interface */
#define SIM_DBC_STORAGE_DIAG_NAME               ("SQ18")    /*!< @brief Segment name for SIM_DBC_STORAGE interface */
#define SIM_DBC_LL_DIAG_NAME                    ("SQ19")    /*!< @brief Segment name for SIM_DBC_LL interface */
#define SIM_QH_INIT_DIAG_NAME                   ("SQ20")    /*!< @brief Segment name for SIM Query Handler */
#define SIM_QH_SIENQ_DIAG_NAME                  ("SQ21")    /*!< @brief Segment name for SIM Query Handler SI Enquiries */
#define SIM_QH_HTMON_DIAG_NAME                  ("SQ22")    /*!< @brief Segment name for SIM Query Handler monitors */
#define SIM_SC_INIT_DIAG_NAME                   ("SQ30")    /*!< @brief Segment name for SIM Session Controller */
#define SIM_SC_CONFIG_DIAG_NAME                 ("SQ31")    /*!< @brief Segment name for SIM_CONFIG interface */
#define SIM_SC_DEVICEMAN_DIAG_NAME              ("SQ32")    /*!< @brief Segment name for SIM DEVICEMAN interface */
#define SIM_SC_CMD_LISTENER_DIAG_NAME           ("SQ33")    /*!< @brief Segment name for SIM CMS LISTENER interface */
#define SIM_SC_DELIVERY_DIAG_NAME               ("SQ34")    /*!< @brief Segment name for SIM DELIVERY interface */
#define SIM_SC_SI_DIAG_NAME                     ("SQ35")    /*!< @brief Segment name for SIM SC SI interface */
#define SIM_SC_FECM_DIAG_NAME                   ("SQ36")    /*!< @brief Segment name for SIM SC FECM interface */
#define SIM_PI_INIT_DIAG_NAME                   ("SQ40")    /*!< @brief Segment name for SIM PI INIT interface */
#define SIM_PI_MC_DIAG_NAME                     ("SQ41")    /*!< @brief Segment name for SIM PI MediaConnection code */
#define SIM_PI_CONFIG_DIAG_NAME                 ("SQ42")    /*!< @brief Segment name for SIM PI Config code */
#define SIM_PI_MC_LIST_DIAG_NAME                ("SQ43")    /*!< @brief Segment name for SIM PI MediaConnection list */
#define SIM_PI_XSI_SSL_DIAG_NAME                ("SQ44")    /*!< @brief Segment name for SIM PI SSL */
#define SIM_PI_XSI_SKTHREAD_DIAG_NAME           ("SQ45")    /*!< @brief Segment name for SIM PI SKEVT thread */
#define SIM_PI_XSI_REQUEST_DIAG_NAME            ("SQ46")    /*!< @brief Segment name for SIM PI REQUEST Interface */
#define SIM_PI_XSI_FECM_DIAG_NAME               ("SQ47")    /*!< @brief Segment name for SIM PI FECM Interface */
#define SIM_PI_XSI_SKEVTMD_DIAG_NAME            ("SQ48")    /*!< @brief Segment name for SIM PI SKEVT metadata code */
#define SIM_PI_XSI_TSM_DIAG_NAME                ("SQ49")    /*!< @brief Segment name for SIM PI TS Monitor code */
#define SIM_PI_SERVICE_MCMON_DIAG_NAME          ("SQ50")    /*!< @brief Segment name for SIM PI Mediaconn monitor code */
#define SIM_PI_XSI_UTILS                        ("SQ51")    /*!< @brief Segment name for SIM PI Utils code */
#define SIM_PI_SERVICE_FILE_DIAG_NAME           ("SQ52")    /*!< @brief Segment name for SIM PI File operations code */
#define SIM_PI_SERVICE_S2F_DIAG_NAME            ("SQ53")    /*!< @brief Segment name for SIM PI sections to file code */
#define SIM_PI_SERVICE_CAND_DIAG_NAME           ("SQ54")    /*!< @brief Segment name for SIM PI Candidates service */
#define SIM_PI_XSI_SKEVT_S2F_DIAG_NAME          ("SQ55")    /*!< @brief Segment name for SIM PI skevt sections to file code */
#define SIM_PI_XSI_SKEVT_REF_DIAG_NAME          ("SQ56")    /*!< @brief Segment name for SIM PI reference section processing */
#define SIM_PI_XSI_SKEVT_SECTIONS_DIAG_NAME     ("SQ57")    /*!< @brief Segment name for SIM PI section processing */
#define SIM_PI_SDT_ACQUISITION_DIAG_NAME        ("SQ58")    /*!< @brief Segment name for SIM PI SDT Acquisition code */
#define SIM_PI_XSI_SEI_DIAG_NAME                ("SQ59")    /*!< @brief Segment name for SIM PI SEI creation code */
#define SIM_PI_SERVICE_TABLE_CACHE_DIAG_NAME    ("SQ60")    /*!< @brief Segment name for SIM PI Table Cache Interface */
#define SIM_PI_SERVICE_PSI_CACHE_DIAG_NAME      ("SQ61")    /*!< @brief Segment name for SIM PI PSI CACHE interface */

/* DVB  Plug-In */
#define SIM_PI_DVB_SCHEDULETHREAD_DIAG_NAME     ("SQ70")    /*!< @brief Segment name for SIM PI SCHEDULE THREAD interface */
#define SIM_PI_DVB_EITZIP_DIAG_NAME             ("SQ71")    /*!< @brief Segment name for SIM PI EIT ZIP interface */
#define SIM_PI_DVB_CACHE_FILLER_DIAG_NAME       ("SQ72")    /*!< @brief Segment name for SIM PI CACHE FILLER interface */
#define SIM_PI_DVB_GAPFILLER_DIAG_NAME          ("SQ73")    /*!< @brief Segment name for SIM PI GAP FILLER interface */
#define SIM_PROTOCOL_XSI_DIAG_NAME              ("SQ80")    /*!< @brief Segment name for SIM XSI Protocol library functions */
#define SIM_TB_TOOLBOX_MEM_DIAG_NAME            ("SQ81")    /*!< @brief Segment name for SIM Toolbox Mem Initialise Function */
#define SIM_G_ACQUISITION_STRATEGIES            ("SG00")    /*!< @brief Segment name for acquisition strategy tracing, used across the server and plug-in */


# tips for quick diag mesg
Please could you capture a log with the INFO logs from sim_dbc_query_list.c enabled. Unless youre running a full debug build, the easiest way I know to do this is to put a line such as the following just below the other #defines in that file:
#define SIM_TB_LOG_INFO SIM_TB_LOG_WARN

// use in c file
CMS_INFORMATION_SERVICES/SIM/src/plug-in/xsi/sql/src/sim_pi_xsi_ssl.c
#define SIM_TB_DIAG_ID              g_sim_pi_ssl_seg_id

    SIM_TB_SetupDiagSegment(SIM_PI_SSL_DIAG_NAME,                       &g_sim_pi_ssl_seg_id);

#define SIM_PI_SSL_DIAG_NAME                        ("SQ44")    /*!< @brief Segment name for SIM PI SSL */


CMS_INFORMATION_SERVICES/SIM/src/plug-in/xsi/sql/src/sim_pi_xsi_skevt_sections.c
#define SIM_TB_DIAG_ID                              g_sim_pi_skevt_sections_seg_id

    SIM_TB_SetupDiagSegment(SIM_PI_SKEVT_SECTIONS_DIAG_NAME,            &g_sim_pi_skevt_sections_seg_id);

#define SIM_PI_SKEVT_SECTIONS_DIAG_NAME             ("SQ57")    /*!< @brief Segment name for SIM PI section processing */

#define SIM_TB_DIAG_ID      g_sim_pi_skevt_s2f_seg_id
CMS_INFORMATION_SERVICES/SIM/src/plug-in/xsi/sql/src/sim_pi_xsi_init.c:1060:    SIM_TB_SetupDiagSegment(SIM_PI_SKEVT_S2F_DIAG_NAME,                 &g_sim_pi_skevt_s2f_seg_id);
CMS_INFORMATION_SERVICES/SIM/src/utils/inc/sim_toolbox_diag.h:125:#define SIM_PI_SKEVT_S2F_DIAG_NAME                  ("SQ55")    /*!< @brief Segment name for SIM PI skevt sections to file code */

<ex> when SQ42 on from manatee
FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk

NDS_BUILD_TYPE_sim_sql_lifecycle_controller=debug
NDS_BUILD_TYPE_sim_utils_profile_library=debug
NDS_BUILD_TYPE_sim_thread_create_library=debug
NDS_BUILD_TYPE_vrm_server=debug
NDS_BUILD_TYPE_sim=debug
NDS_BUILD_TYPE_sim_rrp_src=debug
NDS_BUILD_TYPE_sim_client_si=debug
NDS_BUILD_TYPE_sim_toolbox_src=debug
NDS_BUILD_TYPE_binxml=debug
NDS_BUILD_TYPE_sim_ipc_comms=debug


# status code
# (COMP, COMPIF, SEVERITY, STATUS) -> (COMP, SEVERITY, COMPIF, STATUS)
# hex(((COMP & 0x3FF) << 22) | ((SER & 0x3) << 16) | ((IF & 0xF) << 12) | (STATUS & 0xFFF) )
# hex(((39 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )

#SIM_COMP_ID           (39) 
#SEVERITY_WARNING	   (1)

(sim\src\inc\sim_internal_system_status_types.h)
#define SIM_MAKE_STATUS_OK(status)              (SYSTEM_MAKE_COMPONENT_STATUS(SIM_COMP_ID_NONE, SIM_ID_NONE, SEVERITY_NONE, status)) /**< Return codes for success */
#define SIM_MAKE_STATUS_FAIL(status)            (SYSTEM_MAKE_COMPONENT_STATUS(SIM_COMP_ID_NONE, SIM_ID_NONE, SEVERITY_WARNING, status)) /**< Return codes for failure */

SIM_STATUS_NOT_FOUND	0x10002 FAILED
SIM_STATUS_FAILED		0x00010006


<sim-table-id>
64 - 127    0x40 - 0x7F Used by DVB.
128 - 143   0x80 - 0x8F DVB-CSA and DigiCipher II/ATSC CA message sections used in EMM and ECM streams.
144 - 191   0x90 - 0xBF May be assigned as needed to other data tables.
192 - 254   0xC0 - 0xFE Used by DigiCipher II/ATSC/SCTE.

SIM_TABLE_ID       59 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_mpeg_numbers.h #define SIM_TABLE_ID_PAT    (0x00U)      /**< PAT Table ID */
SIM_TABLE_ID       60 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_mpeg_numbers.h #define SIM_TABLE_ID_CAT    (0x01U)      /**< Conditional Access Table ID */
SIM_TABLE_ID       61 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_mpeg_numbers.h #define SIM_TABLE_ID_PMT    (0x02U)      /**< PMT Table ID */

SIM_TABLE_ID       40 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_nds_numbers.h #define SIM_TABLE_ID_TMS        (0xBBU)      /**< TMS Table ID */

SIM_TABLE_ID       32 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_opentv_numbers.h #define SIM_TABLE_ID_OPENTV_V2    (0x0000001BU) /**< PMT Table ID for OpenTV version 2.x format */
SIM_TABLE_ID       58 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_SKEVT_M                (0xA0U) /**< SKEVT-M base Table ID for non-NVOD services (A0-A3) */
SIM_TABLE_ID       59 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_NVOD_SHIFTED_SKEVT_M   (0xA4U) /**< SKEVT-M base Table ID for NVOD time shifted services (A4-A7) */
SIM_TABLE_ID       60 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_SKEVT_A                (0xA8U) /**< SKEVT-A base Table ID for non-NVOD services (A8-AB) */
SIM_TABLE_ID       61 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_NVOD_REF_SKEVT_M       (0xB0U) /**< SKEVT-M Table ID for NVOD reference services */
SIM_TABLE_ID       62 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_NVOD_REF_SKEVT_A       (0xB1U) /**< SKEVT-A Table ID for NVOD reference services */
SIM_TABLE_ID       63 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_SKEVT_B                (0xA0U) /**< SKEVT-B base Table ID for BDL information (A0-A3)
SIM_TABLE_ID       66 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_OPENTV_TU              (0xC0U) /**< OpenTV TU section table id */
SIM_TABLE_ID       67 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_SKFBT                  (0xC2U) /**< SKY_FECM_bundle_section Table ID */
SIM_TABLE_ID       77 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_RANGE_SKEVT_M_MIN_TABLE_ID         (SIM_TABLE_ID_SKEVT_M)      /**< The minimum SKEVT-M table ID */
SIM_TABLE_ID       78 CMS_INFORMATION_SERVICES/SIM/src/protocols/inc/sim_xsi_numbers.h #define SIM_TABLE_ID_RANGE_SKEVT_M_MAX_TABLE_ID         (SIM_TABLE_ID_SKEVT_M + 7u) /**< The maximum SKEVT-M table ID */

SIM_TABLE_ID       51 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_SDT_A          (0x42U)          /*!< @brief SDT (Actual) Table ID */
SIM_TABLE_ID       52 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_SDT_O          (0x46U)          /*!< @brief SDT (Other) Table ID */
SIM_TABLE_ID       53 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_BAT            (0x4AU)          /*!< @brief BAT Table ID */
SIM_TABLE_ID       54 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_PF_A       (0x4EU)          /*!< @brief EIT-PF (Actual) Table ID */
SIM_TABLE_ID       55 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_PF_O       (0x4FU)          /*!< @brief EIT-PF (Other) Table ID */
SIM_TABLE_ID       56 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_A        (0x50U)          /*!< @brief EIT-S (Actual) Table ID */
SIM_TABLE_ID       57 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_A_EXT_1  (0x51U)          /*!< @brief EIT-S Ext (Actual) Table ID */
SIM_TABLE_ID       58 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_A_EXT_2  (0x52U)          /*!< @brief EIT-S Ext (Actual) Table ID */
SIM_TABLE_ID       59 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_A_EXT_3  (0x53U)          /*!< @brief EIT-S Ext (Actual) Table ID */
SIM_TABLE_ID       60 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_O        (0x60U)          /*!< @brief EIT-S (Other) Table ID */
SIM_TABLE_ID       61 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_O_EXT_1  (0x61U)          /*!< @brief EIT-S Ext (Other) Table ID */
SIM_TABLE_ID       62 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_O_EXT_2  (0x62U)          /*!< @brief EIT-S Ext (Other) Table ID */
SIM_TABLE_ID       63 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_EIT_S_O_EXT_3  (0x63U)          /*!< @brief EIT-S Ext (Other) Table ID */
SIM_TABLE_ID       64 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_TDT            (0x70U)          /*!< @brief Time and Date Table ID */
SIM_TABLE_ID       65 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/dvb.h #define SIM_TABLE_ID_TOT            (0x73U)          /*!< @brief Time Offset Table ID */
SIM_TABLE_ID       47 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_PAT                    (0x00U)      /*!< @brief PAT Table ID */
SIM_TABLE_ID       48 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_CAT                    (0x01U)      /*!< @brief Conditional Access Table ID */
SIM_TABLE_ID       49 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_PMT                    (0x02U)      /*!< @brief PMT Table ID */
SIM_TABLE_ID       50 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_NIT_A                  (0x40U)      /*!< @brief NIT (Actual) Table ID */
SIM_TABLE_ID       51 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_NIT_O                  (0x41U)      /*!< @brief NIT (Other) Table ID */
SIM_TABLE_ID       54 CMS_INFORMATION_SERVICES/SIM_CO/src/plug-in/dvbsi/engine/inc/psi_utils.h #define SIM_TABLE_ID_IOT                      (0x9AU)      /*!< @brief IOT Table ID */


<sim-property-id>
#define SIM_MAKE_PROPID(obj_class, type, attrib)    ((obj_class) | (type) | (attrib)) /**< Generates a property ID from object Class, Type and Attribute values */

#define SIM_PROPID_CLASS_SERVICE                    (0x06000000u) /**< Indicates a property ID belongs to the Service class */
#define SIM_PROPID_TYPE_INTEGER                     (0x00010000u) /**< Indicates that the property ID is of type Integer */
#define SIM_PROPID_TYPE_BYTE_ARRAY                  (0x000C0000u) /**< Indicates that the property ID is of type Byte Array */

#define SIM_SI_SERVICE_PROPID_I_SERVICE_KEY_1               SIM_MAKE_PROPID(SIM_PROPID_CLASS_SERVICE, SIM_PROPID_TYPE_INTEGER,         1u) /**< protocol dependant service key 1. */

!WARN   -SC00         		< p:0x0000019a P:MW t:0x01f14520 T:SBM_UB_MAIN M:sim_si_service.c F:SIM_SI_Service_GetByteArrayProperty L:98 > 
SIM_ODECODER_ObjectGetByteArrayAttribute(propid=0x60c001e) FAILED 

hex(0x06000000u|0x00010000u)

note: cannot able to find propid=0x60c001e from sources


<sim-config>
/home/NDS-UK/kyoupark/STB_SW/CMS_INFORMATION_SERVICES/SIM/inc/config/baseset.xml

      <section name="SI_MERGE_CONFIG">
        <key name="NUM_MERGE_PROFILES"       type="INTEGER" value="1">          <comment date="2014/06/27 09:00:00" text="Number of profiles used to merge properties of programme instances from different sources."/></key>
      </section>
      <section name="MERGE_PROFILE_1">
        <key name="NUM_APPLICABLE_SERVICES"  type="INTEGER"  value="1">         <comment date="2014/06/27 09:00:00" text="Number of service types for which this profile applies to."/></key>
        <key name="SERVICE_TYPE_0"           type="INTEGER"  value="0">         <comment date="2014/06/27 09:00:00" text="Service type for which this profile applies (0 means default profile)."/></key>
        <key name="PRIMARY_SOURCE"           type="STRING"   value="SIM_DB">    <comment date="2014/06/27 09:00:00" text="Which primary source to use. Either SIM_DB or MHSI."/></key>
        <key name="PROPID_TITLE"             type="STRING"   value="PRIMARY">   <comment date="2014/06/27 09:00:00" text="Merge behaviour to apply to the property (can be PRIMARY, SECONDARY or SECONDARY_OVER_PRIMARY)."/></key>
        <key name="PROPID_SYNOPSIS"          type="STRING"   value="PRIMARY">   <comment date="2014/06/27 09:00:00" text="Merge behaviour to apply to the property (can be PRIMARY, SECONDARY or SECONDARY_OVER_PRIMARY)."/></key>
      </section>

SIM_DBC_MERGE_CFG_MAIN_SECTION 1214 CMS_INFORMATION_SERVICES/SIM/src/server/sql/db-client/src/sim_dbc_merged_query.c                                                                SIM_DBC_MERGE_CFG_MAIN_SECTION,
SIM_DBC_MERGE_CFG_MAIN_SECTION 1218 CMS_INFORMATION_SERVICES/SIM/src/server/sql/db-client/src/sim_dbc_merged_query.c         SIM_TB_LOG_FATAL(("SYSTEMCONFIG_GetIntegerValue(%s,%s) FAILED", SIM_DBC_MERGE_CFG_MAIN_SECTION, SIM_DBC_MERGE_CFG_NUM_PROFILES_KEY));
SIM_DBC_MERGE_CFG_MAIN_SECTION  272 CMS_INFORMATION_SERVICES/SIM/src/utils/inc/sim_config_file.h #define SIM_DBC_MERGE_CFG_MAIN_SECTION                              ("SI_MERGE_CONFIG")


#-----------------------------------------------------------
# internal
#-----------------------------------------------------------

SIM generates the SCI object for the acquired PMT.

SIM generates an SEI(Service Event Information) object for the acquired
EIT-PF-A. Event Information Table-PresentFollowing-Actual (EIT-PF-A) 

SIM generates the CATI object for the acquired CAT

EPG->SPM->SIM

SIM uses the disk for:
Garbage Collection
Vacuuming
Service Plan updates
Persisting SKEVT metadata to disk.


SIM:101ServicePlan Acquisition VS Update
(http://marvin.uk.nds.com/wiki/SIM:101ServicePlan_Acquisition_VS_Update)
----------------------------------------
XSI System
  Triggers 
    * Service Plan Acquisition is triggered on startup and on a 'new install'.
    * Service Plan Update is triggered by receiving and updated NIT or BAT
          o SIM is responsible for filtering for these updated tables and informing SPM, which then triggers the update.
          o If a new NIT is received, the BAT will be acquired and processed, but a receiving a new BAT will not cause the NIT to be reprocessed. 
          
	SDT Acquisition
    * SDT flood fill is used for both acquisition and update, but SDT gap fill is only used during an update. 
	  This is clearly shown in the Service Plan State Machine
    
	Failure and Rollback    
    * Service Plan Acquisition starts by clearing the SIM DBs. As such a failure does not need a roll back, but must be retried.
    * Service Plan Update occurs during normal running of the box and a failure resulting in loss of all data would not be acceptable. 
    So instead, no changes are made to the DB until all SI tables required to complete the update have been successfully acquired. 
    It is for this reason updates make use of the SDT gap fill mechanism to ensure the SDT flood fill file is complete. 	

    
(http://marvin.uk.nds.com/wiki/SIM:101Concepts_section_acquisition)

(SDT) Flood Fill 

Some sections occur in such large numbers it would take a long time to get
them filtering for them one at a time. 

** In these cases we flood fill the sections `into files.` 
Currently this is done for SKEVT, and SDT sections. **

A generic filter is created, for example to flood fill SKEVTs for a day we
just need to have a filter set on the PID, and part table id (not including
    the 6 hour period) all sections matching this will then be written to the
specified file in the context of the SFM callback function. The flood fill
will be considered complete when any of the first 3 sections repeat them
selves. This can cause problems if the drivers are dropping sections. 

// uses own logging at all open in this function
@@ -1165,18 +1165,22 @@ void SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles(uint32_t  mjd,
         {
             if(NULL != skevt_m_fd)
             {
+^M
+                SIM_TB_LOG_ERROR(("KT: f_sim_pi_xsi_skevt_s2f_file_name(%s)", f_sim_pi_xsi_skevt_s2f_file_name));^M
                 SIM_pi_xsi_skevt_s2f_GetFileNameDayAtATime(g_sim_pi_xsi_config.sim_tpid_skevt_m_base + (mjd % 8u));
                 *skevt_m_fd = open(f_sim_pi_xsi_skevt_s2f_file_name, O_RDONLY);
             }

-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_54)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1183 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/A_70)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1169 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/B_101)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_55)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1183 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/A_71)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1169 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/B_101)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_48)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1183 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/A_64)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1169 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/B_101)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_49)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1183 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/A_65)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1169 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/B_101)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_50)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1183 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/A_66)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1169 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/B_101)
-SQ55                      < T:SIM_PI_XSI_SKEVT_THREAD M:sim_pi_xsi_skevt_s2f.c F:SIM_PI_XSI_SKEVT_S2F_OpenSKEVTFiles L:1176 > KT: f_sim_pi_xsi_skevt_s2f_file_name(/mnt/nds/dev_6/part_0/FSN_DATA/M_51)


Gap Fill

When a flood fill has completed it is possible that odd sections may have been dropped leaving gaps. 
For this we implement a gap fill mechanism to make targeted request for the missing information. 

#-----------------------------------------------------------
# milestones for svc
#-----------------------------------------------------------
!MIL   -SQ42         < M:sim_pi_xsi_config_svcplan.c F:SIM_PI_CONFIG_StartServiceInformationAcquisition L:07887 > Service line up acquisition start
!MIL   -SQ42         < M:sim_pi_xsi_config_svcplan.c F:SIM_PI_xsi_config_svcplan_BatSectionEvent L:06601 > Complete BAT table received.
!MIL   -SQ42         < M:sim_pi_xsi_config_svcplan.c F:SIM_PI_xsi_config_svcplan_NitSectionEvent L:06515 > Complete NIT table received.

#-----------------------------------------------------------
# SIM_SDT_ACQUISITION_Start, SIM_sdt_acquisition_ProcessSection
#-----------------------------------------------------------
1. open file in memory for sdt acq.
2. alloc mem for sdt acq.
3. but never free fd and mem when failed.
4. note that MC is NULL in this case,SIM_SDT_ACQUISITION_Start(0x00000000), and that's because failed to get demux id.

NDS: ^0946758810.297358 !ERROR -SFM_SERVER   < p:00000064 t:2aeb4490 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:sfm_sessionmgr.c F:SFM_SessionMgr_ActivateSession L:00864 > Failed to retrieve Demux ID from MDM
NDS: ^0946758810.297500 !ERROR -SFM_API      < p:00000064 t:2aeb4490 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:sfm_api.c F:SFM_API_AssignConnection L:00183 > Cannot activate session
NDS: ^0946758810.297638 !ERROR -SQ53         < p:00000064 t:2aeb4490 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:sim_sections_to_file.c F:SIM_S2F_CreateSession L:00623 > SFM_API_SESSION_AssignConnection()=0x982100A FAILED
NDS: ^0946758810.297825 !ERROR -SQ58         < p:00000064 t:2aeb4490 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:sim_sdt_acquisition.c F:SIM_SDT_ACQUISITION_Start L:00649 > SIM_S2F_CreateSession()=0x10006 FAILED
NDS: ^0946758810.297955 !WARN  -SQ42         < p:00000064 t:2aeb4490 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:sim_pi_xsi_config_svcplan.c F:SIM_PI_XSI_CONFIG_SVCPLAN_EventHandler L:07773 > SIM_SDT_ACQUISITION_Start(0x00000000)=0x00010006, FAILED


#-----------------------------------------------------------
# SIM_PI_xsi_pf_ProcessEitPf
#-----------------------------------------------------------

<comp-sim-mem> `SIM_PLUGIN_MEMORY`
: 610000 bytes from sim.cfg. since SDT failed 2453 times before saw first mem alloc error. 
# this should (1024+10000)*2453 = 27,041,872 bytes and sometimes more than than. why?


#ifdef SIM_MEMCHECKER_ENABLED

#define SIM_PI_MALLOC(a)       SIM_TOOLBOX_Memchecker_AllocStaticP  
  (__FILE__, __LINE__, SIM_TOOLBOX_MEMCHECKER_POOLS_PLUGIN, g_sim_plugin_memory_pool_handle, (a))


SIM_lcc_GoToInitialised:
	SIM_PI_INIT_Initialise
		SYSTEMUTIL_THR_CreateMemoryPool(g_sim_plugin_memory_pool_handle "SIM_PLUGIN_MEMORY")

SIM_ENGINE_XSI_MC_Open
	SFM_API_SESSION_CreateSession(SIM_engine_xsi_mc_MpegSectionCallback)

SIM_ENGINE_XSI_MC_Prepare
	SIM_PI_XSI_TsMonitor_StartMonitoring(SIM_TABLE_ID_CAT)
		SIM_pi_xsi_TsMonitor_RequestTable
			SFM_API_MPEG_PrivateSectionRequest

SIM_engine_xsi_mc_MpegSectionCallback
	SIM_PI_XSI_MC_PostEvent

# SIM_lcc_GoToPrepared:
#		SIM_PI_INIT_Prepare
# 		SIM_PI_XSI_MC_Init
#				SIM_pi_xsi_mc_EventListenerThread("SIM_PLUGIN_XSI_MC_ENGINE_THREAD")
SIM_pi_xsi_mc_EventHandler
	case SIM_PI_XSI_MC_EVENT_SVCPLAN_EVENT:
		SIM_PI_XSI_CONFIG_SVCPLAN_EventHandler
	case SIM_TABLE_ID_SDT_A:
		SIM_engine_xsi_mc_HandleSectionEvent
			case SIM_TABLE_ID_CAT:
				SIM_PI_XSI_TsMonitor_NewEvent
					SIM_pi_xsi_TsMonitor_NewSection
					{
						SIM_PI_SERVICE_MCTSD_AddSection
							SIM_pi_service_mctsd_AddSectionToList
							{
								SIM_PI_MALLOC: g_sim_plugin_memory_pool_handle (*)
							}
						SIM_pi_xsi_TsMonitor_ReturnTable
							SIM_engine_xsi_mc_ProcessCat
								SIM_engine_xsi_mc_CreateCatiCamiMso
								{
									SIM_MSO_CreateCATI: SYSTEMOBJECT_Create
									
									OR
									
									SIM_MSO_CreateCAMI: SYSTEMOBJECT_Create
									
									SIM_engine_xsi_mc_MsoListner
								}
					}		


<sim-benign-logs>
(from Issac) This can just mean that a request for something was made that was
not found in the DB.  

!WARN  -SQ35         < p:00000064 t:0105f3b0 T:SIM_SC_IPC_SERVER_THREAD M:sim_sc_si.c
F:SIM_SC_SI_RetrieveLocatorByObjectProperties L:02328 > Could not find the element requested

!WARN  -SQ35         < p:00000064 t:0105f3b0 T:SIM_SC_IPC_SERVER_THREAD M:sim_sc_si.c 
F:SIM_SC_SI_RetrieveLocatorByObjectProperties L:02348 > SIM_QH_SIENQ_ListGetServiceElements()=0x10002 FAILED. request_handle=0x4002A50 nfilters=3


#-----------------------------------------------------------
# TOT
#-----------------------------------------------------------
#/vobs/CMS_INFORMATION_SERVICES/SIM/src/plug-in/xsi/sql/src/sim_pi_xsi_time.c 
SIM_pi_xsi_time_ProcessTot
	SIM_DVB_ParseTotSection
	SYSTEMTIME_SetTime(&utc_time_date, local_offset)


<capture-job>
https://www.stb.bskyb.com/jira/browse/SI-9834
Issue: When the YELLOW key is pressed to view future listings of 7th day(last
day), there are no results shown by EPG_TVG

On investigating the logs and discussing with component team, it looks like
CAPTURE job priority is lesser than the priority of PVOD.  When the user is
watching LIVE TV, and if there is a PVOD scheduled during the SKEVT update
interval then PVOD will occupy remaining tuner and capture job will be delayed
until PVODs are finished. This means even when there is no user scheduled
recordings, EPG listings might not be updated as capture job is delayed.

Following can be done to avoid this issue,

1. CAPTURE Job priority should be more than priority of PVOD Job. (As
    discussed with component team, this may not be possible).

2. Heandend should avoid broadcasting PVOD content during the SKEVT update
interval time. Or HE should make sure there is some gap (atleast 10-15 mins)
between PVOD's.

a. Go to EPG and turn off PVOD. (This should release the tuner held by PVOD).

b. Or release the Live Viewing tuner by taking the box IN and OUT of standby
or watching a downloaded content.

I think this issue can now be closed as NOT A DEFECT as we have enough
evidence, that EPG is displaying "no listings" when there is no schedule data
for 7th Day (ideally for few hours on 7th day). This happened because the box
  was busy downloading PVOD during schedule update time. If the box was left
    for few more hours it would have resolved the issue on its own.

Going forward, if similar issue is found, please release one of the tuner (By
    putting the box to standby or moving from a Live viewing to recorded
    content) and check if the issue is reproducible again. If not, then it
  might not be an issue.


!MIL    -MCM                    < T:SPM_DISPATCHER M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > 
  @@PMON@@,trace,mediacon,mc-create,51,mc-create-mcid=,51,mc_create-str=,mc-capture,fsnfmt=,hMC=0x33

// this is capture freq?
!MIL    -FEM                          < p:0x000001db P:MW t:0x01978520 T:FEM_WORKER_THREAD M:fem_plugin_satellite_scr.c F:FEM_PLUGIN_Satellite_DeviceEvent L:
1533 > Locked f=11778000 fo=10600000 fs=27500000 fec=0x40 tuner=1 LNB=1 hMC=0x2

<tuner-status>
!MIL    -MDM          		< p:0x000001ec P:MW t:0x01c8c520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x43e7 hMC=0xe11 tuner_id =1 and job_type =RECORD 
!MIL    -MDM          		< p:0x000001ec P:MW t:0x01c8c520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x43e6 hMC=0xe10 tuner_id =1 and job_type =LIVE_VIEWING 
!MIL    -MDM          		< p:0x000001ec P:MW t:0x01c8c520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x43f0 hMC=0xe14 tuner_id =0 and job_type =RECORD 
!MIL    -MDM          		< p:0x000001ec P:MW t:0x01c8c520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3223 > mdm_handle =0x4413 hMC=0xe1e tuner_id =1 and job_type =LIVE_VIEWING 


<comp-sim-error>
//
We have got hold of the Schedule DB from box and I can confirm that SCVKEY2
and CNID are correct but INSTKEY 426 does not exist in schedule

//
Thanks to Kit for reproducing the problem. We can see that EPG is querying
GUIDE for some information which it cannot find in SIM database.

 
NDS: ^0946686568.333174 !WARN  -SQ13         < p:000000f1 t:01a04520 T:SIM_SC_IPC_SERVER_THREAD M:sim_dbc_sched_query.c F:
  SIM_DBC_QUERY_GetProgrammeInstanceByXsiLocator L:00648 > SIM_DBC_UTIL_GetProgInstObjectFromQuery()=NOT FOUND by XSI locator: INSTKEY=426 SVCK2=0x0FA4 CNID=0x0020
 
We are trying to get hold of SCHED.DB from disk

//
!WARN   -SQ13                             < p:0x0000020f P:MW t:0x019b7520 T:SIM_SC_IPC_SERVER_THREAD M:sim_dbc_sched_query.c 
  F:SIM_DBC_QUERY_GetProgrammeInstanceByXsiLocator L:648 > SIM_DBC_UTIL_GetProgInstObjectFromQuery()=NOT FOUND by XSI locator: ""INSTKEY=439"" ""SVCK2=0x0FA9"" ""CNID=0x0020 
!ERROR  -SQ08                             < p:0x0000020f P:MW t:0x019b7520 T:SIM_SC_IPC_SERVER_THREAD M:sim_dbc_merged_query.c 
  F:SIM_DBC_MERGED_QUERY_GetProgrammeInstanceByXsiLocator L:2412 > SIM_dbc_merged_query_ProcessAndMergeRetrievedPI() FAILED 

// Q
/tmp/sim_ram
-sh-3.2# ls -al SCHEDDSK.DB

// Darwin
FSN_DATA/


={============================================================================
|kt_dev_si_0001| comp-spm

#-----------------------------------------------------------
# general
#-----------------------------------------------------------


Today SPM covers very large functionality range:
LNB management
DISK management
FRONTEND management
MODEM management 
SCANNING 
INSTALLATION/UPDATE 
SYS_INFO 
SYSTEM_STATE (inc power management)
Network Config

The Service Plan Management component is responsible for discovery of broadcast services from the various network sources, 
initiating and controlling scanning operations on behalf of the system, e.g. during STB initialisation, in standby, 
according to user request etc.

Service Plan Management controls the creation of Service Information databases (managed by the SIM) and builds 
the channel lists available from the various network interfaces. SPM applies the business rules that govern the creation of the service plan, 
determining which services are available to the user and whether programme information is available for these services.  
SPM ensures that the service plan is kept up-to-date.

#-----------------------------------------------------------
# diag and debug build
#-----------------------------------------------------------
TRACE_LEVEL_SPM_CLIENT="AFEWM"
TRACE_LEVEL_SPM_FEM="AFEWM"
TRACE_LEVEL_SPM_FRONTEND="AFEWM"
TRACE_LEVEL_SPM_JOB="AFEWM"
TRACE_LEVEL_SPM_MCM="AFEWM"
TRACE_LEVEL_SPM_MODEM="AFEWM"
TRACE_LEVEL_SPM_NETWORK="AFEWM"
TRACE_LEVEL_SPM_NVRAM="AFEWM"
TRACE_LEVEL_SPM_RMF="AFEWM"
TRACE_LEVEL_SPM_SERVER="AFEWM"
TRACE_LEVEL_SPM_SIM="AFEWM"
TRACE_LEVEL_SPM_STATEMACHINE="AFEWM"
TRACE_LEVEL_SPM_SUM="AFEWM"
TRACE_LEVEL_SPM_SYSINFO="AFEWM"
TRACE_LEVEL_SPM_VGC="AFEWM"

# picasso
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk

# COMPONENT_NAME:=spm_server
# COMPONENT_NAME:=spm_server_rmf_module
# COMPONENT_NAME:=spm_server_sim_module

NDS_BUILD_TYPE_spm_server = debug
NDS_BUILD_TYPE_spm_server_rmf_module = debug
NDS_BUILD_TYPE_spm_server_sim_module = debug

# where
/darwin_platform_components/darwin_spm/src/makefile


#
# JPA
#
COMPONENT_NAME:= darwin_spm_native  #define SPM_JAVA_DIAGNAME "J_SPM"


#-----------------------------------------------------------
# JAVA: SpmFrontEnd:getInputSignalQuality:natSpmFrontEndGetStatusProp
#-----------------------------------------------------------
BaseSpmFrontEndSettings::actualSignalQuality
vobs/THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/PreferenceManager/src/java/picasso/preference/workers/BaseSpmFrontEndSettings.java

    interface PropertyID
    {
        public static final int SIGNAL_STRENGTH  = 1;
        public static final int SIGNAL_STATUS    = 2;
        public static final int SIGNAL_QUALITY   = 3;
        public static final int NETWORK_ID       = 4;
        public static final int TRANSPORT_STREAM = 5;
    }

public class SpmFrontEndImpl::getInputSignalQuality
	natSpmFrontEndGetStatusProp(PropertyID.SIGNAL_QUALITY)
		SPM_JAVA_FrontEndGetStatusProp
			[+]SPM_API_FrontEnd_GetStatus
				send SPM_CLIENT_EVENT_INTERNAL_TYPE mesg

				SPM_CLIENT_FrontEnd_message_handler
					SPM_CLIENT_FRONTEND_ProcessMessageGetStatus
						send SPM_CLIENT2SERVER_EVENT_FRONTEND_GET_STATUS mesg

					SPM_CLIINT_EventHandler(spm_server.c)
						case SPM_CLIENT2SERVER_EVENT_FRONTEND_GET_STATUS
							send SPM_FRONTEND_INTERNAL_MESSAGE_GET_STATUS mesg

							SPM_SVR_FrontEnd_MessageHandler
								case SPM_FRONTEND_INTERNAL_MESSAGE_GET_STATUS:
									SPM_SVR_FrontEnd_GetStatusHandler
									{
										SPM_SVR_FrontEnd_GetStatus
											FEM_IC_FrontEnd_CreateStatus

											FEM_IC_QueueEvent
												case FEM_IC_EV_CREATE_STATUS
													FEM_SS_GenerateSSIForFrontEnd
														FEM_DS_GetTunerStatusInfo
															FEM_PLUGIN_CALL # get actual value

										send SPM_SERVER2CLIENT_EVENT_FRONTEND_GET_STATUS mesg
											SPM_CLIENT_FRONTEND_ProcessMessageServerResponse
												# update f_frontend_status[idx] structure
									}

						        case SPM_FRONTEND_INTERNAL_MESSAGE_GET_PROP:
            						SPM_SVR_FrontEnd_GetPropHandler(msg_data);
										SPM_SVR_FrontEnd_GetProp # get actual value
								

			[+]SPM_API_FrontEnd_GetStatusProp
				# get f_frontend_status[idx] depending on property id
				case SPM_API_FRONTEND_STATUS_PROPID_SIGNAL_QUALITY_PERCENTAGE(7): /* not use in SKY case */
				case SPM_API_FRONTEND_STATUS_PROPID_SIGNAL_QUALITY:

#######################
# network
#######################
SPM seems to be processing events from NCM correctly, and returning the correct status in the API used below. From the log it seems that we get a SET event from NCM, after which we return that the main config is set, but later on in the test around line 8106, we get an UNSET event. After this, when the API is called, we correctly report that the config is unset (line 8145). We never receive another SET event from NCM so return UNSET for the remainder of the log.

SPM_NCM_Event: SET evnet means that there's vaild net conf after doing whole process like DHCP.

!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03411 > Sending SPM_API_NETWORK_MAIN_CONFIG_UNSET event
!INFO  -SPM_NETWORK  < M:spm_network.c F:SPM_NCM_Event L:03394 > Sending SPM_API_NETWORK_MAIN_CONFIG_SET event
	

#
int localConnectionStatus = getMainStatus();

SPM_JAVA_NetworkGetMainStatus
	SPM_API_Network_GetMainStatus
	

#
networkMainConfig = getNetworkMainConfig();

SPM_JAVA_GetSpmNetworkMainConfig
	SPM_API_Network_GetNetworkMainConnConf
		SPM_CLIENT_INTERNAL_EVENT_NETWORK_GET_MAIN_CONFIG
			SPM_CLIENT2SERVER_EVENT_NETWORK_GET_MAIN_CONFIG
			SPM_NETWORK_MESSAGE_GET_MAIN_CONFIG
			
		memcpy(network_conf, &f_main_config, sizeof(SPM_API_Network_MainConnConf));
		
	...
	SPM_Network_GetMainConf
		SPM_Network_GetDhcpLease
		{
		
			#
			# when failed, set OK status and return INVALID sets. WHY??
			#
			if ((ncm_status = NCM_IF_DHCP_GetLease(f_SPM_Network_Session_Handle, f_SPM_Network_Interface_Name, &flags, &addr, gateway, dns)) != NCM_STATUS_OK)
			{
				/* A DHCP configuration, with DHCP set to true and the rest of the fields set to invalid values, is retrieved. */
				SPM_NETWORK_DIAG_LOG_WARN(("NCM_IF_DHCP_GetLease failed, status = 0x%X", ncm_status));
				f_last_message.network_payload.status = SPM_API_STATUS_OK;
			}

			#
			#	!ERROR -NCM_SERVER   < M:ncm_server_dhcp.c F:ncm_server_dhcp_get_options L:00778 > DHCP has not yet started or failure.
			# !ERROR -NCM_SERVER   < M:ncm_server_interface.c F:ncm_server_interface_get_lease L:02949 > Failed to get DHCP options values: 0x12421003.
			# !WARN  -SPM_NETWORK  < M:spm_network.c F:SPM_Network_GetDhcpLease L:01209 > NCM_IF_DHCP_GetLease failed, status = 0x12421003
			
			SPM_Network_GetResponseEventFromMessageType
        case SPM_NETWORK_MESSAGE_GET_MAIN_CONFIG:
            event = SPM_SERVER2CLIENT_EVENT_NETWORK_GET_MAIN_CONFIG;
            break;			
		}
		
		SPM_CLIENT_Network_ProcessSynchronousExternalMessage
		        case SPM_SERVER2CLIENT_EVENT_NETWORK_GET_MAIN_CONFIG:
		        
		            memcpy(&f_main_config, &pMessage->externalMessage.payload.network_payload.data.main_config, sizeof(f_main_config));
		            
		            SPM_CLIENT_DIAG_LOG_INFO(("main config: dhcp_on = %d, ip_address = 0x%X, subnet_mask = 0x%X, gateway = 0x%X, primary_dns = 0x%X, secondary_dns = 0x%X",
		                                    f_main_config.dhcp_on,
		                                    f_main_config.ip_address,
		                                    f_main_config.subnet_mask,
		                                    f_main_config.gateway,
		                                    f_main_config.primary_dns,
		                                    f_main_config.secondary_dns));
		            break;


#######################
# system health check
#######################
# /PreferenceManager/src/java/picasso/preference/model/HealthCheckModel.java: run()
#		logger.logFatal("Undefined health check status " + completionStatus);
#		onFailure();
#
#		private void onFailure()
#		{
#			int[][] results = { { 15, 15, 15, 15, 15, 15, 15, 15 }, { 15, 15, 15, 15, 15, 15, 15, 15 } };
#			spmHealthCheck.release();
#			spmHealthCheck = null;
#			autoHealthListener.notifyHealthCheckResults(results);
#		}
# 
# on screen: 4WWW-WWWA (15).

#
# Initiates a health check. As the the health check proceeds the system state changes as follows: ACTIVE -> PENDING_HEALTHCHECK -> HEALTHCHECK. 
# If a SpmSystemListener has been registered then the listener will be triggered for each change of state. After being notified of changes 
# to PENDING_HEALTHCHECK and to HEALTHCHECK the change to the new state should be acknowledged by calling 
# notifyStateChange(SpmListenerID listenerId, int state) with the state set to the new state. If the changes of state are not acknowledged 
# then the health check will proceed after a timeout. If no listener has been registered then the health check proceeds 
# without the need for any acknowledgement. 

# /* health check pending */
# public static final int PENDING_HEALTHCHECK     = 2;
# 
# /** health check */
# public static final int HEALTHCHECK             = 3;

setStateHealthCheck (spmsystem.java)
	natSpmSetSystemState(State.HEALTHCHECK);
		SPM_JAVA_SystemSetState
			SPM_API_System_SetState

registerSystemStateListener
	natSpmRegisterSystemListener
		SPM_JAVA_SystemRegisterStateListener
			SPM_API_System_RegisterStateListener(SPM_JAVA_SystemStateListener)

SpmHealthCheck runAutomaticHealthCheck
# Starts a multi-transponder system health check. Only one health check can run at any one time. 
	SPM_JAVA_ApiRunAutomaticHealthCheck
		SPM_API_FrontEnd_RunAutomaticHealthCheck(SPM_JAVA_HealthCheckListener, l_vtable_handle # becomes usertag in listener, )


SPM_JAVA_HealthCheckListener(userTag)
	VTableGet(userTag)

# SHC for disk
SPM_SystemState_NotifyAllComponentsActive
	PDM_FS_SetSystemState(PDM_FS_SystemStateHealthCheck # action)
	...
	PDM_FS_PartitionUnmount

# this api use the timedwait from this cfg. it varies from hdd size.
SPM_API_Disk_RunSMARTShortTest
(spm.cfg)
DISK_TEST_TIMEOUT_SEC=30


={============================================================================
|kt_dev_si_0001| comp-power comp-standby comp-pwm

# passive standby
# config
static SPM_COMMON_CONFIG_DESC f_spm_config_desc[] =
# const char* sectionName;    const char* keyword;    void* outputPtr;    SPM_COMMON_CONFIG_ENTRY_TYPE type;    union    {..} data;
    {"DEEP_STANDBY",           "OFF_MODE",                         &f_spm_config.deep_standby_off_mode,                                                     SPM_COMMON_CONFIG_ENTRY_TYPE_INT},


# passive stby
F:SPM_SystemState_DeepStandbyReturnAlarmExpired L:2051 > Passive Standby alarm expired! Start enter passive standby procedure: 1 

Prefs_defaults.cfg:
POWER_SAVE_END_PERIOD1_HOURS=5
POWER_SAVE_END_PERIOD1_MINUTES=30
POWER_SAVE_MODE=3
POWER_SAVE_START_PERIOD1_HOURS=3
POWER_SAVE_START_PERIOD1_MINUTES=30

Prefs_user_profile.cfg:
POWER_SAVE_END_PERIOD1_HOURS=1
POWER_SAVE_END_PERIOD1_MINUTES=1
POWER_SAVE_MODE=1
POWER_SAVE_START_PERIOD1_HOURS=1
POWER_SAVE_START_PERIOD1_MINUTES=1


<passive-deep-standby>
During passive standby, the STB front panel is running. The STB front end and
Fusion Product are not running. EMMs are not filtered. Alarms can be triggered
in order to switch the STB to active stand-by so that the Fusion Product can
process scheduled tasks.

<active>
During active stand-by, the STB front end is running. The Fusion Product is
also running and can process update tasks and recordings. EMMs are filtered
during update tasks.

<boot-up>
// bootup okay
!MIL    -SYSINIT_S    		< p:0x000001fe P:SCD t:0x00646530 T:STATE_MACHINE_THREAD M:state_machine.c F:switchRingLevelRunLevel L:460 > ENDING   Moving ring level 19 to runlevel PVR. 
!MIL    -SYSINIT_S    		< p:0x000001fe P:SCD t:0x00646530 T:STATE_MACHINE_THREAD M:state_machine.c F:stateMachineThread L:1416 > ENDING   Moving system to runlevel PVR. 

!MIL    -EPG_INIT     		< p:0x00000203 P:APP t:0x2dfef520 T:no name M:PlannerStarter$2 F:run L:140 > T:IM#0:PLANNER READY

<shutdown>
!MIL    -SYSINIT_S    		< p:0x000001fe P:SCD t:0x00646530 T:STATE_MACHINE_THREAD M:server_msghandling.c F:sendRunLevelRequest L:965 > STARTING Moving component FEM to runlevel SHUTDOWN 

<dialog-id>
	int INSTALLER_SYSTEM_RESET_START_ID                                  = 1141;
	int INSTALLER_PLANNER_REBUILD_START_ID                               = 1143;
	int INSTALLER_NEW_INSTALL_START_ID                                   = 1146;

<one-touch>
HDMI One Touch Play
https://www.stb.bskyb.com/confluence/display/STB/HDMI+One+Touch+Play

<eco-mode>
I have a patch somewhere that makes eco mode happen in a fast loop
https://www.stb.bskyb.com/jira/browse/NGDEV-71879?focusedCommentId=868741&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-868741


<pwm>
POWER SUBSYSTEM

The Power SubSystem contains the following logically related and closely
coupled set of Fusion Components:
 
SYSINIT, STM, PWM (also known as HGH).


={============================================================================
|kt_dev_si_0001| comp-vgc

The error means that VGC hasnt managed to read the data from the card at the time of SPM initialisation, but usually this is not a problem. SPM should receive a notification from VGC later, when its ready (SPM_VGC_SubscriberConfigChangedListener) and then SPM tries to read the HD subscription again (in SPM_VGC_InternalEventEntitlementInfoChanged).

330:NDS: ^[00:00:55]0946684855.296713 !ERROR  -SPM_SERVER                < p:0x00000000 P: t:0x01275700 T:SPM_THREAD M:spm_vgc_module.c F:SPM_VGC_CheckHDSubscription L:707 > Card not in VGC_API_CARD_STATUS_READY yet! (3) 
331:NDS: ^[00:00:55]0946684855.296726 !ERROR  -SPM_SERVER                < p:0x00000000 P: t:0x01275700 T:SPM_THREAD M:spm_vgc_module.c F:SPM_VGC_InitialiseSubscriptionBitmap L:1208 > Error in checking HD subscription! 
332:NDS: ^[00:00:55]0946684855.296737 !ERROR  -SPM_SERVER                < p:0x00000000 P: t:0x01275700 T:SPM_THREAD M:spm_vgc_module.c F:SPM_VGC_Activate L:2116 > SPM_VGC_InitialiseSubscriptionBitmap failed 
347:NDS: ^[00:00:56]0946684856.985392 !ERROR  -SPM_SERVER                < p:0x00000000 P: t:0x01275700 T:SPM_THREAD M:spm_vgc_module.c F:SPM_VGC_InternalEventSubscriberInfoChanged L:416 > SPM_SM_GetDefaultInstanceHandle failed

<comp-vgc-purchase>
So it is the same call path but different handles for VG client and server side.

see that client api matches up with CA server call:

53183:NDS: ^[2018:03:22 16:28:44]0000048690.444978 !INFO   -VGC          		< p:0x00000684 P:MW t:0x6ce54450 T:SRM_LP_THREAD M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:VGC_PPV L:173 > VGC_API_PpvAction_CreateObject ENTER
53185:NDS: ^[2018:03:22 16:28:44]0000048690.445031 !INFO   -VGC          		< p:0x00000684 P:MW t:0x6ce54450 T:SRM_LP_THREAD M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:VGC_PPV L:173 > VGC_API_PpvAction_CreateObject EXIT. obj_handle 0x1919
53213:NDS: ^[2018:03:22 16:28:44]0000048690.447053 !MIL    -VGV          		< p:0x00000687 P:CA t:0x76626a50 T:no name M:ETHAN_SKYH412_XWING_LNUX_01/LittleEndian/debug/p F:IPPV L:162 > NDS.PPV IPPV_CreatePurchaseObject Enter
53218:NDS: ^[2018:03:22 16:28:44]0000048690.447188 !MIL    -VGV          		< p:0x00000687 P:CA t:0x76626a50 T:no name M:ETHAN_SKYH412_XWING_LNUX_01/LittleEndian/debug/p F:IPPV L:162 > NDS.PPV IPPV_CreatePurchaseObject EXIT handle = 0x227

53396:NDS: ^[2018:03:22 16:28:44]0000048690.454040 !INFO   -VGC          		< p:0x00000684 P:MW t:0x6ce54450 T:SRM_LP_THREAD M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:VGC_PPV L:173 > VGC_API_PpvAction_DestroyObject ENTER obj_handle 0x1919
53425:NDS: ^[2018:03:22 16:28:44]0000048690.454719 !MIL    -VGV          		< p:0x00000687 P:CA t:0x76626a50 T:no name M:ETHAN_SKYH412_XWING_LNUX_01/LittleEndian/debug/p F:IPPV L:162 > NDS.PPV IPPV_DestroyPurchaseObject Enter handle = 0x227
53426:NDS: ^[2018:03:22 16:28:44]0000048690.454809 !MIL    -VGV          		< p:0x00000687 P:CA t:0x76626a50 T:no name M:ETHAN_SKYH412_XWING_LNUX_01/LittleEndian/debug/p F:IPPV L:162 > NDS.PPV IPPV_DestroyPurchaseObject EXIT handle = 0x227


={============================================================================
|kt_dev_si_0001| comp-srm comp-pvod

Schechter, Ruti

SRM manages the PVOD recordings.  

SRM uses PCAT to update the schedule information (such as start time,
    duration, or locator) when a schedule change occurs, to manage the
lifetimes of PCAT entries (including deleting PCAT entries when record/remind
    jobs are destroyed), and to clean out old history items and disappeared
events. SRM also gets event information from broadcast metadata (via SIM) and
saves it for later use.

COMPONENT_NAME := darwin_srm
TRACE_LEVEL_SRM="AFEWMIPR<>!"

# PCAT_CAT_PROP_ITEM_NAME
EIProcessing_GetAndSetProgInstanceItemProperties
	EIProcessing_GetAndSetStringProperty

# PCAT_CAT_PROP_DELETION_REASON 
"DELETION_REASON",	/*PCAT_CAT_PROP_DELETION_REASON*/
SYSTEM_EXCEPTION_TYPE_BOOKING_EXPIRED (37)


# content status handler to VRM
/* register the content handler record callback*/
stat = VRM_JOBEXTINFO_RegisterContentStatusHandler(SYSTEMJOB_TYPE_RECORD,
	JobContent_RecordContentHandler);

# PSCHED register
stat = PSCHED_SCHEDULING_SchedulerRegister(&psched_info, 
	SrmJobPschedSchedulerCallback, 0u, pPschedJobId);

# updates from CA
#
stat = VGC_API_PpvAction_SetClientNotify (obj_handle, 
										  SRM_ExpiryCA_cbOptionsByPurchasePacketRetrieval);

										  case E_SRM_EXPIRY_MGR_MSG_TYPE_OPTIONS_BY_PURCHASE_PACKET_READY:
	stat = SRM_ExpiryCA_OptionsByPurchasePacketReady((VGC_API_Handle*) pPayload);	
	{
		stat = VGC_API_PpvAction_GetContentExpirationDate (*obj_handle, &caExpirationDate);
		
		stat = SRM_ExpiryMgr_UpdateBookingJobDeletionTime(*pBookingJobID, true, caExpirationDate, SYSTEMTIME_TIMEDATE_INVALID);	
	}
	break;

SRM_ExpiryMgr_UpdateBookingJobDeletionTime(SYSTEMTIME_TIMEDATE caExpirationDate,)
	stat = SRM_ExpiryCA_FindMinEED(bookingJobID, &isEed, &minEed, &minPurchaseDate, &isCaViewed);
	SRM_ExpiryMgr_CheckAndHandlePastDeletionTime
				stat = SRM_UTILS_JOB_FindVrmJobHandle(bookingJobID,jobType,
					SRM_ExpiryMgr_cbDeletionTimeExpiredFindJob);
						SRM_SendMessage((uint32_t)E_SRM_EXPIRY_MGR_MSG_TYPE_EXPIRED_VRM_JOB_FOUND

SRM_ExpiryMgr_ReceiveMessage
{
	case E_SRM_EXPIRY_MGR_MSG_TYPE_EXPIRED_VRM_JOB_FOUND:
		stat = SRM_UTILS_JOB_DestroyVrmJob((VRM_JOB_HANDLE*) pPayload, SYSTEM_EXCEPTION_TYPE_BOOKING_EXPIRED);
			# VRM_JOB_Destroy
		break;
}

=
NDS: ^[00:01:54]0946684914.690710 !MIL   -VRMS         < p:00000077 t:2b933100 T:VRM_SRV M:record_state.c F:RecordStateCalculateBySkevt L:01556 > MILESTONES: timeline: itemId: 0x29000010, curr: [2012:03:19 18:26:46]1332181606; PT:[2012:03:19 18:27:00]1332181620, SGT:[2012:03:19 18:28:00]1332181680, SREX:[2012:03:19 18:30:00]1332181800, BODY:[2012:03:19 18:30:00]1332181800, EREX: [2012:03:19 20:15:56]1332188156, EGT:[2012:03:19 20:15:56]1332188156, ENDED:[2012:03:19 20:17:56]1332188276

NDS: ^[00:01:56]0946684916.143779 !INFO  -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_expiry_ca.c F:SRM_ExpiryCA_FindMinEED L:00259 > eed = [2012:03:25 23:59:58]1332719998, purchaseDate = [2012:03:19 18:22:02]1332181322, minDeletionTime= [2012:03:25 23:59:58]1332719998, minPurchaseDate = [2012:03:19 18:22:02]1332181322, isCaViewed = 0

NDS: ^[00:01:56]0946684916.221937 !INFO  -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_expiry_mgr.c F:SRM_ExpiryMgr_UpdateBookingJobDeletionTime L:00388 > isEed = true.  minEed = [2012:03:25 23:59:58]1332719998
NDS: ^[00:01:56]0946684916.222120 !INFO  -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_expiry_mgr.c F:SRM_ExpiryMgr_UpdateBookingJobDeletionTime L:00393 > isCA = true.  minCA = [2011:00:28 23:59:58]1293580798
NDS: ^[00:01:56]0946684916.222246 !INFO  -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_expiry_mgr.c F:SRM_ExpiryMgr_UpdateBookingJobDeletionTime L:00430 > bookingDeletionTime = [2011:00:28 23:59:58]1293580798


NDS: ^0946684916.233829 !ERROR -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_expiry_mgr.c 
F:SRM_ExpiryMgr_ReceiveMessage L:00166 > KT: event=612

NDS: ^0946684916.233955 !ERROR -SRM          < p:00000077 t:01655a20 T:SRM_LP_THREAD M:srm_utils_job.c 
F:SRM_UTILS_JOB_DestroyVrmJob L:00154 > KT: VRM job handle is 0x1000002, ext 37
37 means TYPE_BOOKING_EXPIRED.

# also can get VRM INFO
#
NDS: ^[00:01:56]0946684916.278964 !INFO  -VRMS         < p:00000077 t:2b933100 T:VRM_SRV M:booking_record.c F:BOOKING_RECORD_Destroy L:02259 > record handle:0x2, item_ID:0x29000010, deletion reason:BOOKING_EXPIRED

#
# PCAT_CAT_PROP_ENTITLEMENT_IS_CA_VIEWED set
#
SRM_PurchaseMonitor_Activate
    vgcApiStat = VGC_API_IppvSlot_SetClientNotify (receiptNode->receiptHandle,cb_SRM_PurchaseMonitor_Notify);
	
cb_SRM_PurchaseMonitor_Notify
	E_SRM_PURCHASE_MONITOR_MSG_SLOT_UPDATED
	
SRM_PurchaseMgr_ReceiveMessage
	case E_SRM_PURCHASE_MONITOR_MSG_SLOT_UPDATED:
		SRM_PurchaseMgr_Update
			stat = PCAT_VIEW_VLIST_SetBoolean(valueList,1u,PCAT_CAT_PROP_ENTITLEMENT_IS_CA_VIEWED,purchaseInfo.isViewed);


{pvod-user-quota}
https://www.stb.bskyb.com/jira/browse/PICASSODEV-20724

Actual Results:
Box hung for a short period then affirm BookingManager.purchase:958 error

Chris Danson added a comment - 05/Oct/16 3:04 PM

Have taken another look at the log commented on above by Kyoungtaek.

The Map file identifies that at line(1335903) Picasso starts a
PvodAssetBookingActivity in order to purchase a Pvod asset. Shortly after we
can see logging that identifies the call to `move the content` to the user
quota.

Once the quota move has completed the EPG the works out if a purchase is
required or not. However the problem is that more than 5 seconds have gone by
and the user has pressed keys. This results in triggering the Activty failsafe
(ie the Activity is discarded). However the BookingAgent still opens the
purchase screen (eventually) but we then get the Affirm because the Activity
was discarded which had called dispose on the Agent.

This problem appears to be down to a timing problem. The time it takes for the
content to transfer to the user quota is unfortunately in this instance longer
than the default Activity timeout of 5 seconds. Why it has taken so long I do
not know. Perhaps the MW was particularly busy at that moment. Maybe SI can
comment on that.

Possibly in this case we can override that Activity timeout to be 10 seconds
instead. We have done this in other cases where interactions with the MW have
taken some time to complete.  I think this will fix it. Would be good to know
how reproducible the problem is.


!MIL    -EPG_BOOK     		< p:0x00000233 P:APP t:0x2df72520 T:no name M:PvodBookingAgent$1 F:run L:96 > T:PooledExecutor#0:Moving to quota=user from quota=system


={============================================================================
|kt_dev_si_0001| comp-pcat

Dan Toubiana (CO), Reuven Nimrod (MGR), Uzan, Galit (eng)

SELECT
Statement for extracting data from a database table

*pcat-view*
Virtual table based on the result-set of a SELECT statement
A view is a cheap resource. The database doesn't store the `view data` 

It recreates it, every time a user queries a view.  A view allows a read-only
access to the database.

*pcat-value-list*
View specification (view spec)
The filter, sort, and properties list used to build a view Properties list.
List of properties to be retrieved on a SELECT operation from a view. The
properties retrieved are the property list (and seems actual values of these
    properties are called `value list`) 

PCAT Server library is responsible for the following :
Initiating an interface with DBENGINE, the component which manages the
physical database Retrieving up-to-date data from the database on SELECT
requests from the client


<comp-pcat-debug>
COMPONENT_NAME := pcat_server
COMPONENT_NAME := pcat_client


<comp-pcat-status>
#define PCAT_COMP_ID     (23)
#define SEVERITY_SEVERE  (0x2))
#define SEVERITY_NONE    (0)
#define PCAT_VIEW_IF     (1)
            
(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((23 & 0x3FF) << 22) | ((1 & 0x3) << 16) | ((1 & 0xF) << 12) | (57 & 0xFFF) )
hex(((23 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (41 & 0xFFF) )

PCAT_VIEW_STATUS_OK                     0x5c01000
PCAT_VIEW_STATUS_VALUE_IS_NULL          0x5c01002
# the status 0x5c01002 in PCAT is not an error code, it's a right return
# status that indicates that the property planner try to get is NULL.  It
# means that the property you want to read was never set (it is equal to NULL
# in the PCAT.DB field).

PCAT_VIEW_STATUS_FAILURE                0x5c21001
  (PCAT_VIEW_MAKE_STATUS(SEVERITY_SEVERE, 1))
PCAT_VIEW_STATUS_PROP_NOT_IN_VALUE_LIST 0x5c2103f
PCAT_VIEW_STATUS_ITEM_ID_NOT_FOUND      0x5c11039 /* seems the same as END_OF_VIEW */
PCAT_VIEW_STATUS_INVALID_PARAMSi        0x5c21029
PCAT_VIEW_STATUS_END_OF_VIEW            0x5c21036 /*!< @brief  Last rows are returned by select action */i
PCAT_VIEW_STATUS_NOT_ENOUGH_MEMORY      0x5c21037


<query>
one can query a view using the APIs :

PCAT_VIEW_Select
PCAT_VIEW_SelectByItemID 
PCAT_VIEW_SelectManyItemIDS

Both APIs retrieve data from the database in a data structure of type
'PCAT_VIEW_VALUE_LIST'.

// typedef uint32_t PCAT_VIEW_VALUE_LIST; // Handle to the *pcat-value-list* 


*pcat-value-list*

value list is a simple array(table) using index. 

typedef struct DBVIEW_ValueListTag{
  `PCAT_VIEW_OBJECT_TYPE` object_type;
  uint32_t num_rows;
  uint32_t total_size;
  PCAT_VIEW_VALUE_LIST value_list_hdl;
  P_PropValue* 'prop_values_list' /* \XRPC GLOBAL SIZEPARAM(num_rows)*/ ;
}DBVIEW_ValueListStruct;


{pcat-property}
For each property the relevant API (PCAT_VIEW_VLIST_GetInt/String/etc) should
be called in order to retrieve it.

// pcat_view.h
typedef union PCAT_PROP_VAL_TAG
{
    char *ptr /* \XRPC SIZENULL SIZECONST(PCAT_VIEW_MAX_VALUE_LENGTH)*/; 
    int32_t iVal;
} PCAT_PROP_VAL;

#define PCAT_PROP_VAL_TYPE_UNDEF    0U /* UNDEFINED */
#define PCAT_PROP_VAL_TYPE_NULL     1U /* NULL */
#define PCAT_PROP_VAL_TYPE_INTEGER  2U /* INTEGER */
#define PCAT_PROP_VAL_TYPE_STRING   3U /* STRING */

typedef struct PropValueTag{
    PCAT_PROP_VAL value;
    uint16_t  property_num;
    uint8_t valueType;   // 1 - NULL, 2 INTEGER, 3 - STRING */
}PropValue;

typedef struct P_PropValueTag{
    uint32_t num_prop;
    PropValue *prop_list // \XRPC GLOBAL SIZEPARAM(num_prop)*/ ;
}P_PropValue;


<pcat-object-pcat-property>
// `pcat_cat.h`, pcat_cat_ext.h

#define PCAT_CAT_OBJECT_TYPE_UNDEF			0 /**< @brief First value (UNDEF)	*/
#define PCAT_CAT_OBJECT_TYPE_BOOKING		1 /**< @brief  Booking Object */
#define PCAT_CAT_OBJECT_TYPE_SCHED_EVENT	2 /**< @brief  Scheduled Events object */
#define PCAT_CAT_OBJECT_TYPE_TIMEBASE_EVENT 3 /**< @brief  Time base booking object */
#define PCAT_CAT_OBJECT_TYPE_SHREC_ITEM		4	/**< @brief  Shrec Item object */
#define PCAT_CAT_OBJECT_TYPE_AV_CONTENT		5 /**< @brief  AV Content object */
#define PCAT_CAT_OBJECT_TYPE_PLAY_JOB		6	/**< @brief  Play job object */
#define PCAT_CAT_OBJECT_TYPE_SHREC_EXTENT	7  /**< @brief  Shrec Extent object */
#define PCAT_CAT_OBJECT_TYPE_EXCEPTION      8   // Exception Object
#define PCAT_CAT_OBJECT_TYPE_BOOKING_JOB	9	/**< @brief  Booking job Object*/
#define PCAT_CAT_OBJECT_TYPE_USERPREFS     10   /**< @brief  user preferences */ 
#define PCAT_CAT_OBJECT_TYPE_SIGNUP_JOB    11   /**< @brief Signup Job object */ 
#define PCAT_CAT_OBJECT_TYPE_RB_RECORDING_JOB		12	 /**< @brief  RB recording object */ 
#define PCAT_CAT_OBJECT_TYPE_RB_PLAYBACK_JOB		13	 /**< @brief  RB playback object */ 
#define PCAT_CAT_OBJECT_TYPE_REMOTE_SERVER			14	 /**< @WP961:brief  Remote Server object */ 
#define PCAT_CAT_OBJECT_TYPE_VOD_PRODUCT			15	 /**< @brief  WP1222  VOD rentals management */ 
#define PCAT_CAT_OBJECT_TYPE_VOD_ASSET				16	 /**< @brief  WP1222  VOD rentals management */ 


PCAT_CAT_PROP_TRIGGER_TIME			5			
# Trigger time of program (seconds in UTC).  No update notification will be received for this property.

# pcatp_api.c for db object model


<comp-pcat-cfg>
# on app process since planner is in app.
# (for picasso build)
# MEM121.TXT:pool PCAT_VIEW_CLNT_POOL size=409600: 015:44:39.636

[PCAT_MEMMAN_CONFIGURATION]
CLIENT_POOL_FLAG=0
CLIENT_POOL_NAME="`PCAT_VIEW_CLNT_POOL`"
CLIENT_POOL_SIZE=400

# used in PCATSrvCreateMemoryPool(PcatServerPool)
SERVER_POOL_FLAG=0
SERVER_POOL_NAME="PCAT_VIEW_SRV_POOL"
SERVER_POOL_SIZE=580

MAX_BOOKINGS=1000


<comp-pcat-items>
See items.c

Vued            (BkKp, Book, Keep, Recd, Seen)
Type
Start Time         
End Time           
Event Name                              
Loc  
Chan#
Err
Channel Name       
Series
SizeG
Expiry  
SLStat
#Rem
BookJobId

FYI, items -f now has the BookingJobDeletionTime as its final element, so
anyone can find this information out of a PCAT.DB using the text-based pcat
viewer.

Vued|Type |Start Time         |End Time           |Event Name                          |Loc  |Chan# |Err |Channel Name        |Series |SizeG |Expiry  |SLStat |#Rem |BookJobId
====|==== |===================|===================|====================================|=====|===== |=== |====================|======|=====|========|======|====|=========
Seen|PDL |2016:09:26 06:12:24|2016:09:26 06:12:59|Anna Scher: In Confidence            |s66709 |    0|  1|Sky Arts            |     0| 0.25|        |UNDF  |    |688316759 *booking-job-id*
Seen|PDL |2016:09:26 06:13:02|2016:09:26 06:14:01|Fish Town                            |s66714 |    0|  1|Sky Atlantic        |     0| 0.04|        |UNDF  |    |688316799


*booking-job-id*

>>> hex(688316799)
'0x2906e17f'

!MIL    -PCATS                      < p:0x000001f4 P:MW t:0x01ff8520 T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:3077 > 
  client id = 0x5, `bookingJobID = 0x2906e17f` 


sqlite3 PCAT.DB 'select is_viewed, keep, booking_type, actual_start_time,\
          actual_end_time, event_name, shrec_locator, logical_channel,\
          `booking_exception`, channel_name,series_id,push_locator,trigger_time,\
          program_size, push_expiryend, is_disappeared, is_active, start_time,\
          duration, is_linked, b.event_id, j.booking_job_id,\
          booking_disk_quota_name, booking_source,\
          booking_job_deletion_time\
          from item i, booking_jobs j, booking_info b left outer \
          join av_content a on a.av_content_id = b.av_content_id \
          where b.event_id = i.event_id and b.booking_id = j.booking_id \
          order by ifnull(actual_start_time,trigger_time)'

1|                      // is_viewed, *prop-is-viewed*
0|                      // keep 
2|                      // booking_type, *prop-booking-type*

                        // 0| 0| 2| : Recd| PVOD|
                        //  | 0| 1| : Book| Rmd |
                        // 1| 0| 2| : Seen| Rec |
1330618680| 
1330624918| 
180013ffa4195265736964656e74204576696c3a2041667465726c696665| 
locator:3:14:1203:s4611| 
305|
33                      // *prop-booking-exception* *record-error*
0d0013ffa419536b7920416374696f6e204844|
0| 0| 1330618620| 1:880150252| | 0| 1| 1330618800| 6000000| 0
|570449496              // EVNET ID
|687890008              // 22 BOOKING JOB ID
| 050005ffa4197573657200 | 1|0

2 keep, 
4 actual_start_time, 
5 actual_end_time, 
6 event_name, 
7 shrec_locator,            // *shrec-name*
8 logical_channel, 
10 channel_name,
11 `series_id`,               // f[10] in items.c
12 push_locator,
13 trigger_time, 
14 program_size, 
15 push_expiryend, 
16 is_disappeared,		# f[15] 
17 is_active, 
18 start_time, 
19 duration, 
20 is_linked, 
21 b.event_id, 
22 j.booking_job_id, #
23 booking_disk_quota_name, 
booking_source, 
booking_job_deletion_time from item i, 
booking_jobs j, 
booking_info b left outer join av_content a on a.av_content_id = b.av_content_id where b.event_id = i.event_id and b.booking_id = j.booking_id order by ifnull(actual_start_time,trigger_time)'


#
sqlite3 PCAT.DB 'select server_id from item i' | egrep ^[0-9] | wc -l

#
sqlite3 -list PCAT.DB 'select partial_content_status, booking_type, event_name, booking_exception, channel_name, j.booking_job_id, booking_source, record_status from item i, booking_jobs j, booking_info b left outer join av_content a on a.av_content_id = b.av_content_id where b.event_id = i.event_id and b.booking_id = j.booking_id order by ifnull(actual_start_time,trigger_time)'
sqlite3 -list PCAT.DB 'select shrec_locator, j.booking_job_id from item i, booking_jobs j, booking_info b left outer join av_content a on a.av_content_id = b.av_content_id where b.event_id = i.event_id and b.booking_id = j.booking_id order by ifnull(actual_start_time,trigger_time)'

# 47504 is 'Series' from items.txt
#
sqlite3 PCAT.DB 'select is_viewed, keep, booking_type, actual_start_time, actual_end_time, event_name, shrec_locator, logical_channel, booking_exception, channel_name,series_id,push_locator,trigger_time, program_size, push_expiryend, is_disappeared, is_active, start_time, duration, is_linked, b.event_id, j.booking_job_id, booking_disk_quota_name, booking_source, booking_job_deletion_time 

from item i, booking_jobs j, booking_info b left outer join av_content a on a.av_content_id = b.av_content_id i

where b.event_id = i.event_id and b.booking_id = j.booking_id order by ifnull(actual_start_time,trigger_time)' | grep 47504 | cut -d'|' -f 21,22

echo "|0|2|||0a0013ffa419466f757220526f6f6d73||140|15|0c0013ffa4194368616e6e656c2034204844|47504|0|1332961020|||0|1|1332961200|3600000|1|570461760|687902272|050005ffa4197573657200|5|0" | cut -d'|' -f 22

# This query shows a table of recordings ordered by start time and their failure reasons and whether or not they are PVOD recordings:  
sqlite3 PCAT.DB 'SELECT BOOKING_INFO.AV_CONTENT_ID, LED_IS_ON, BOOKING_EXCEPTION, PARTIAL_CONTENT_STATUS, AV_CONTENT.ACTUAL_START_TIME, AV_CONTENT.ACTUAL_DURATION FROM BOOKING_INFO JOIN AV_CONTENT ON (BOOKING_INFO.AV_CONTENT_ID = AV_CONTENT.AV_CONTENT_ID) ORDER BY AV_CONTENT.ACTUAL_START_TIME'

# query for del info
#
sqlite3 PCAT.DB 'select booking_job_id, booking_time, booking_job_deletion_time, job_is_failed, booking_exception, deletion_reason from del_booking_jobs join del_booking_info on del_booking_jobs.booking_id = del_booking_info.booking_id' | cut -d'|' -f 5-6
sqlite3 PCAT.DB 'select booking_job_id, booking_time, booking_job_deletion_time, job_is_failed, booking_exception, deletion_reason 
from del_booking_jobs join del_booking_info on del_booking_jobs.booking_id = del_booking_info.booking_id' | cut -d'|' -f 5-6

# query using job id
#
sqlite3 PCAT.DB 'select j.booking_job_id, b.booking_id, b.event_id from booking_jobs j, booking_info b where b.booking_id = j.booking_id and j.booking_job_id =  687866053'
sqlite3 PCAT.DB 'select i.event_name from item i where i.event_id = 570426813' | tostr
# 
# PCAT.db
# I use the SQLite Database Browser from http://sqlitebrowser.sourceforge.net
#


<comp-pcat-items>
(BOOKING_JOBS) BOOKING JOB ID: 687866053 *booking-job-id* , BOOKING ID 
  -> (BOOKING_INFO) BOOKING ID: 553648325 -> EVT ID: 570425541 -> (ITEM) EVT ID: , EVT NAME: 110013ffa4194361736820696e20746865204174746963 (Cash in the Attic)
                                          -> AV CON: 620757195 -> (AV_CONTENT) SH LOC: locator:3:14:1:s1

<booking-jobs>
BOOKING_JOB_ID,
BOOKING_ID,           // maps to *booking-info*
REMINDER_STATUS, 
`RECORD_STATUS`, *pact-record-status*
// @brief Values describing the status of an event that was scheduled for a
// record booking.  Theses values are used for the
// #PCAT_CAT_PROP_RECORD_STATUS property
//
// typedef enum PCAT_CAT_RECORD_STATUS_{
//    PCAT_CAT_RECORD_STATUS_UNDEF=0				,			/**< @brief  No available status */
//    PCAT_CAT_RECORD_STATUS_TO_RECORD			,			/**< @brief  The program is scheduled to be recorded*/
//    PCAT_CAT_RECORD_STATUS_START_RECORDING		,			/**< @brief  The program is starting recording*/
//    PCAT_CAT_RECORD_STATUS_RECORDING			,			/**< @brief  The program is currently recording*/
//    PCAT_CAT_RECORD_STATUS_STOPPING				,           /**< @brief  The program is stopping*/
//    PCAT_CAT_RECORD_STATUS_ENDED  (5),  //  The program is ended*/
//    PCAT_CAT_RECORD_STATUS_PENDING				,			/**< @brief  The program status is not determined yet */
//    PCAT_CAT_RECORD_STATUS_LAST								/**< @brief  dummy - last enum value */
// } PCAT_CAT_RECORD_STATUS;

`RECORD_STATE`,
// @brief  Recording event states
// Theses values are used for the #PCAT_CAT_PROP_RECORD_STATE property */
//
// typedef enum PCAT_CAT_RECORD_STATE_{
//     PCAT_CAT_RECORD_STATE_UNDEF = 0 ,       /**< @brief  No available status */
//     PCAT_CAT_RECORD_STATE_PRETUNE   ,       /**< @brief  The recording is in pretune state*/
//     PCAT_CAT_RECORD_STATE_SGT       ,       /**< @brief  The recording is in start guard time state*/
//     PCAT_CAT_RECORD_STATE_SREX      ,       /**< @brief  The recording is in start recording extension state*/
//     PCAT_CAT_RECORD_STATE_BODY      ,       /**< @brief  The recording is in body state*/
//     PCAT_CAT_RECORD_STATE_EREX      ,       /**< @brief  The recording is in end recording extension state*/
//     PCAT_CAT_RECORD_STATE_EGT       ,       /**< @brief  The recording is in end guard time state*/
//     PCAT_CAT_RECORD_STATE_PAST_EGT   (7),  // The recording is in past end guard time state*/
//     PCAT_CAT_RECORD_STATE_LAST              /**< @brief  dummy - last enum value */
// 
// } PCAT_CAT_RECORD_STATE;


VRM_STATUS,		     // PCAT_CAT_VRM_RECORD_STATUS 
IS_DESTROYED, 
IS_SCHEDULED, 
RMF_JOB_HANDLE, 
JOB_IS_FAILED, 	# 0 or 1
BOOKING_TIME,
BOOKING_JOB_DELETION_TIME,
TRIGGER_TIME, 
BOOKING_JOBS_IS_TEMP, 
IS_SERIES_TRIGGERED, 
BOOKING_TYPE_REPLACEMENT_ID INTEGER , 
IS_DELETION_TIME_ARRIVED,
QUEUE_POSITION INTEGER DEFAULT '0' , DOWNLOAD_STATUS INTEGER DEFAULT '0',   IS_ACTIVE INTEGER DEFAULT 1, PUSH_IS_EXPIRY_START_TRIGGERED INTEGER DEFAULT 0, PUSH_IS_EXPIRY_END_TRIGGERED INTEGER DEFAULT 0, IS_TEMPORARY BOOLEAN DEFAULT 0, IS_IMMEDIATE BOOLEAN DEFAULT 0 ,PARTIAL_CHUNK_POLICY INTEGER DEFAULT 0, GROUP_ID INTEGER DEFAULT '0'  ,FTS3_SEARCH BOOLEAN DEFAULT 0 ,

`BOOKING_SOURCE`       // *booking-source* 
// Different booking source values for property #PCAT_CAT_PROP_BOOKING_SOURCE */
// typedef enum PCAT_CAT_BOOKING_SOURCE_
// {
//   PCAT_CAT_BOOKING_SOURCE_UNDEF = 0,  /**< @brief  No available source */
//   PCAT_CAT_BOOKING_SOURCE_USER,
//   PCAT_CAT_BOOKING_SOURCE_REMOTE,
//   PCAT_CAT_BOOKING_SOURCE_BOOKABLE_PROMOS,
//   PCAT_CAT_BOOKING_SOURCE_PUSH_SIGNUP,     // 4
//   PCAT_CAT_BOOKING_SOURCE_SERIES_SIGNUP,
//   PCAT_CAT_BOOKING_SOURCE_TIMEBASE_SIGNUP,
//   PCAT_CAT_BOOKING_SOURCE_DYNAMIC,
//   PCAT_CAT_BOOKING_SOURCE_ARR,        /**< @brief new booking source type for WP1367 - automatic recordings*/
//   PCAT_CAT_BOOKING_SOURCE_RECOMMENDED,/**< @brief new booking source for WP2185 */
//   PCAT_CAT_BOOKING_SOURCE_SIDELOAD_USER,  /**< @brief new booking source for WP3078 */
//   PCAT_CAT_BOOKING_SOURCE_SIDELOAD_AUTO,  /**< @brief new booking source for WP3078 */
//   PCAT_CAT_BOOKING_SOURCE_EPG,            /**< @brief new booking source for WP3284 */
//   PCAT_CAT_BOOKING_SOURCE_LAST  /**< @brief  dummy - last enum value */
// } PCAT_CAT_BOOKING_SOURCE;


SUB_GROUP_ID INTEGER DEFAULT 0 )


// INSERT INTO "BOOKING_JOBS" VALUES(687865990,553648262,1,0,0,1,0,0,33619991,0,1331025193,0,NULL,0,0,NULL,0,0,
// 5,	# DOWNLOAD STATUS (see Planner)
// 1,0,0,0,0,0,687865990,0,
// 1,	# PCAT_CAT_PROP_BOOKING_SOURCE. PCAT_CAT_BOOKING_SOURCE_USER(1). PCAT_CAT_BOOKING_SOURCE. (this is not an PDL indication)
// 0);


<booking-info>
BOOKING_ID,           // maps to *booking-info*
`BOOKING_TYPE`,
// @brief  Booking type enum
// Theses values are used for the #PCAT_CAT_PROP_BOOKING_TYPE property
//
// typedef enum PCAT_CAT_BOOKING_TYPE_TAG{
//     PCAT_CAT_BOOKING_TYPE_UNDEF = 0         ,   /**< @brief  No available status */
//     PCAT_CAT_BOOKING_TYPE_REMINDER          ,   /**< @brief  The booking type is Reminder*/
//     PCAT_CAT_BOOKING_TYPE_RECORD     (2),  // The booking type is Record
//     PCAT_CAT_BOOKING_TYPE_SWDL              ,   /**< @brief  The booking type is SWDL*/
//     PCAT_CAT_BOOKING_TYPE_PDL               ,   /*!< The booking type is Download.*/
//     PCAT_CAT_BOOKING_TYPE_BDL               ,   /*!< The booking type is BDL.*/
//     PCAT_CAT_BOOKING_TYPE_WISH_LIST         ,   /*!< The booking type is Wish List (WP3284)*/
//     PCAT_CAT_BOOKING_TYPE_LAST                  /**< @brief  dummy - last enum value */
// }PCAT_CAT_BOOKING_TYPE;


BASE_TYPE,			# PCAT_CAT_BASE_TYPE 
EVENT_ID
BOOKING_AUTO_SGT_MODE, 
BOOKING_AUTO_EGT_MODE, 
BOOKING_SGT, 
BOOKING_EGT, 
START_TIME_EXTENSION, 
END_TIME_EXTENSION, 
AV_CONTENT_ID,    *av-content*
IS_COMMITED, 
LED_IS_ON, 
LOCK, 
KEEP,				# PCAT_CAT_PROP_KEEP_STATUS 

`BOOKING_EXCEPTION`       // *booking-exception* `SYSTEM_EXCEPTIONS_TYPE_TAG`
                        // 100: NO_EXCEPTION

`PARTIAL_CONTENT_STATUS`,   *pcat-content-status* *booking-state*

// "PARTIAL_CONTENT_STATUS",                                   /*PCAT_CAT_PROP_CONTENT_STATUS*/
// typedef enum PCAT_CAT_CONTENT_STATUS_TAG{
//     PCAT_CAT_CONTENT_STATUS_UNDEF = 0,  /**< @brief  No available status */
//     PCAT_CAT_CONTENT_STATUS_NO_CONTENT,
//     PCAT_CAT_CONTENT_STATUS_PARTIAL,
//     PCAT_CAT_CONTENT_STATUS_ALL,         3
//     PCAT_CAT_CONTENT_STATUS_PENDING ,    4
//     PCAT_CAT_CONTENT_STATUS_SUSPENDED , /**< @brief  added for BDL content : only part of the A/V content was recorded , not ready for playback */
//     PCAT_CAT_CONTENT_STATUS_LAST        /**< @brief  dummy - last enum value */
// }PCAT_CAT_CONTENT_STATUS;

DELETION_REASON, 
`BOOKING_DISK_QUOTA_NAME`, 
SIGNUP_JOB_ID,        *signup-jobs* 
COPY_EXTERNAL, 
COPY_FLAG_TIME_SET, 
PPC_PLAYBACK_AVAILABLE, 
BOOKED_AS_OPPV, 
BOOKING_FAVOURITE_CHANNEL, 
IS_CURRENT_SERIES, 
IS_VCR_TIMER, 
IS_PARENTAL_CONTROL_CHECKED, 
SYSTEM_SIGNUP_JOB_ID, 
BOOKING_EXCEPTION_CA_REC_PROBLEMS, 
INCOMPLETE_RECORDING_ATTEMPTS, 
COUNTER

# 	"PPC_PLAYBACK_AVAILABLE",/*PCAT_CAT_PROP_PPC_PLAYBACK_AVAILABLE*/
INSERT INTO "BOOKING_INFO" VALUES(553648262,
4,	# BOOKING TYPE: PCAT_CAT_BOOKING_TYPE_PDL
3, 	# BASE TYPE: PCAT_CAT_BASE_TYPE_DOWNLOAD_ITEM
'1056964742',NULL,NULL,NULL,NULL,0,0,'620757127i',0,2,0,0,100,3,0,'050005ffa4197573657200',0,0,0,'1',0,NULL,0,0,0,0,NULL,0,1);


<exception>
EXCEPTION_ID
BOOKING_ID,           // maps to *booking-info*
EXCEPTION_TIME
EXCEPTION_CODE


<item>
# has details about events
CREATE TABLE ITEM(EVENT_ID INTEGER PRIMARY KEY,EVENT_LOCATOR VARCHAR DEFAULT NULL,SERVICE_LOCATOR VARCHAR DEFAULT NULL,
START_TIME INTEGER,EVENT_NAME BLOB,PARENTAL_RATING INTEGER DEFAULT 0,FLAG_LANGUAGE_SUBTITLE INTEGER DEFAULT 0,ALLOW_COPY_TO_PLANNER BOOLEAN DEFAULT 1,EXPIRE_FROM_PLANNER BOOLEAN DEFAULT 0,FLAG_HIGH_DEFINITION INTEGER DEFAULT 0,FLAG_AUDIO_DESCRIPTION INTEGER DEFAULT 0,FLAG_COPY_PROTECTED INTEGER DEFAULT 0,MARKETING_MESSAGE VARCHAR,FLAG_WIDESCREEN INTEGER DEFAULT 0,AUDIO_TYPE INTEGER DEFAULT 0,LOCAL_START_TIME INTEGER DEFAULT 0,
// 17th 
DURATION INTEGER DEFAULT '0',
CHANNEL_NAME VARCHAR DEFAULT NULL,LOGICAL_CHANNEL INTEGER DEFAULT 0,IS_SCHEDULE_CHANGED INTEGER DEFAULT 0,

// PCAT_CAT_PROP_DISAPPEARED. Whether the program has disappeared from the schedule
IS_DISAPPEARED INTEGER DEFAULT 0,SYNOPSIS BLOB,GENRE INTEGER DEFAULT 0,SUBGENRE INTEGER DEFAULT 0,IS_IPPV INTEGER DEFAULT 0,IS_OPPV INTEGER DEFAULT 0,EVENT_NAME_SORT VARCHAR,ENTITLEMENT_ID INTEGER DEFAULT 0,COUNTER NUMERIC DEFAULT '0',IS_LINKED INTEGER DEFAULT '0',SERIES_ID INTEGER DEFAULT '0',ESTIMATED_BIT_RATE INTEGER,IS_ANALOG_TAPING_ALLOWED INTEGER DEFAULT '1',PURCHASE_PACKETS_INFO_ID INTEGER DEFAULT '0',IS_MONITORING_STOPPED INTEGER DEFAULT 0,STOP_MONITOR_TIME INTEGER,IS_EIT_ARRIVED INTEGER DEFAULT '0',PUSH_PUBLISHTIME INTEGER DEFAULT NULL,PUSH_EXPIRY_START INTEGER DEFAULT NULL,PUSH_EXPIRYEND INTEGER DEFAULT NULL,PUSH_EXPIRYTIME INTEGER DEFAULT NULL,PUSH_LOCATOR VARCHAR DEFAULT 0,PUSH_HASVALIDTRAILER BOOLEAN DEFAULT 1,PUSH_TRAILERDURATION INTEGER DEFAULT 0,PUSH_TRAILEROFFSET INTEGER DEFAULT 0,OIG_PROGRAMME_ID INTEGER DEFAULT 0,PDL_PROGRAMME_LOCATOR VARCHAR DEFAULT NULL,ASSET_URI VARCHAR,CGMS_A INTEGER DEFAULT 0,IS_FREE_OF_CA INTEGER DEFAULT 0,IS_SUB INTEGER DEFAULT 0,ASSET_TYPE INTEGER DEFAULT 0,EXHIBITION_DATE_TIME INTEGER DEFAULT '0',NFF_SIZE VARCHAR,IS_PDL_TRAILER INTEGER DEFAULT 0,REFERER_DATA VARCHAR,PDL_RELATED_PVOD_LOCATOR VARCHAR DEFAULT 0,PARENT_SERVICE_LOCATOR VARCHAR,TRACKING_LOCATOR VARCHAR,SERVICE_TYPE INTEGER DEFAULT '0',PROVIDER_CLASS_MEMBERSHIP INTEGER DEFAULT '0', EXTENDED_SYNOPSIS VARCHAR DEFAULT NULL,SERVER_ID INTEGER,CE_POSITION_IN_TE INTEGER DEFAULT 0,EXPECTED_FILE_SIZE VARCHAR,LAST_TRANSMISSION_TIME INTEGER DEFAULT 0,DATA_CONTENT INTEGER DEFAULT 0,DIGITAL_RIGHTS INTEGER DEFAULT 0,EXPIRY_TIME INTEGER DEFAULT 0,THUMBNAIL_URI VARCHAR DEFAULT NULL,ACTORS_LIST VARCHAR DEFAULT NULL,DIRECTORS_LIST VARCHAR DEFAULT NULL,IS_DTT BOOLEAN DEFAULT '0',DEFAULT_EXPIRY_TIME DEFAULT 0,PARENTAL_RATING_DEFAULT_NULL INTEGER DEFAULT NULL,CHANNEL_LOGO_URI VARCHAR,IS_ADULT BOOLEAN DEFAULT 0,SEASON_NUMBER INTEGER DEFAULT 0,EPISODE_NUMBER INTEGER DEFAULT 0,FIRST_SHOWING INTEGER DEFAULT 0,CRID VARCHAR,PARENTAL_RATING_SCHEMA INTEGER,THREED_VIDEO_FORMAT BOOLEAN DEFAULT 0,IN_PTS INTEGER DEFAULT NULL,OUT_PTS INTEGER DEFAULT NULL,GROUP_SYSTEM_LOCATOR VARCHAR DEFAULT NULL,MEMBER_NUMBER INTEGER DEFAULT 0,ITEM_IS_IPTV INTEGER DEFAULT 0,ARR_DELETION_TIME INTEGER DEFAULT 0,STAR_RATING INTEGER,FIRST_RUN BOOLEAN DEFAULT 0,RELEASE_YEAR INTEGER,EPISODE_TITLE VARCHAR,OFFER_END_TIME INTEGER,SHOW_ID INTEGER DEFAULT 0,QUALITY_LEVEL INTEGER DEFAULT 0,

<prop-content-type> <pdl-download>
CONTENT_TYPE INTEGER DEFAULT 0,

// See *booking-job-id* ctm, dlm, pcat, and EPG
// 
// > Transition : CTM job 0xca278008 (`Type = 2`) from 1 (STARTED) to 5 (STOPPED) 
// >
// typedef enum PCAT_CAT_CONTENT_TYPE_
// {
//     PCAT_CAT_CONTENT_TYPE_UNDEF = 0,         /**< @brief  No available data */
//     PCAT_CAT_CONTENT_TYPE_SMOOTH_STREAMING,  /**< @brief  smooth streaming */
//     PCAT_CAT_CONTENT_TYPE_DPL,            2 /**< @brief  download playlist */
//     PCAT_CAT_CONTENT_TYPE_SIDELOAD,         /**< @brief  sideloading */
//     PCAT_CAT_CONTENT_TYPE_LAST              /**< @brief  dummy - last enum value */
// } PCAT_CAT_CONTENT_TYPE;


BITRATE INTEGER DEFAULT 0,RESOLUTION INTEGER DEFAULT 0,SPLITEVENT_ID INTEGER DEFAULT 0,IS_BTO INTEGER DEFAULT 0,PHYSICAL_CONTENT_ID VARCHAR DEFAULT NULL,BOOKING_BTO_DOWNLOAD_INDEX_ONLY INTEGER DEFAULT 0,THUMBNAIL_HEIGHT INTEGER,THUMBNAIL_WIDTH INTEGER,RESTRICTED_MODE_PERIOD INTEGER,RESTART_TV INTEGER DEFAULT 0,PDL_RELATED_SERVICE_LOCATOR VARCHAR DEFAULT NULL,PDL_RELATED_START_TIME INTEGER DEFAULT 0,CONTENT_UUID VARCHAR,DISPLAY_RATING INTEGER DEFAULT 0,DISPLAY_RATING_SCHEME INTEGER DEFAULT 0,SHOW_UUID VARCHAR DEFAULT NULL,SEASON_UUID VARCHAR DEFAULT NULL,COPY_CONTROL_DESC INTEGER DEFAULT 0,LAST_AVAILABILITY_CHECK_TIME INTEGER DEFAULT 0,TRAILER_OFFER_EXPIRATION_TIME INTEGER DEFAULT 0,MODIFIED_TIME INTEGER DEFAULT 0,EPG_BLOB BLOB    DEFAULT NULL,KEEP_ON_EXPIRE BOOLEAN DEFAULT 0,BOX_SET_LOCATOR VARCHAR,SEASON_LOCATOR VARCHAR,BOX_SET_NAME VARCHAR,BOX_SET_NAME_SORT VARCHAR,BOX_SET_RATING INTEGER,SERIES_INFO VARCHAR,PIN_RATING INTEGER DEFAULT NULL,PIN_RATING_SCHEME INTEGER DEFAULT NULL,LINKED_LOCATOR_URIS VARCHAR DEFAULT NULL,IS_HELP_VIDEO BOOLEAN DEFAULT 0,IS_CATCHUP_TV BOOLEAN DEFAULT NULL,BOX_SET_SYNOPSIS VARCHAR,PRIMARY_ASSET_DURATION INTEGER DEFAULT NULL,ACTUAL_EVENT_START_TIME INTEGER DEFAULT NULL,ACTUAL_EVENT_END_TIME INTEGER DEFAULT NULL,IS_LAST_EPISODE BOOLEAN DEFAULT 0,IS_UHD_CONTENT BOOLEAN DEFAULT 0,DOWNLOAD_NEXT_PERMITTED INTEGER DEFAULT NULL, CONTENT_MARKERS VARCHAR)


INSERT INTO "ITEM" VALUES(1056964742,'locator:2:17:FFFC9472',NULL,NULL,'1c0413ffa4190000001b546f6d6f72726f772c205768656e205468652057617220426567616e',0,0,1,0,0,0,0,'000013ffa419',1,5,0,
5940000,	# DURATION
'0a0013ffa419536b79204d6f76696573',
0,	# LOGICAL CHANNEL
0,0,'bd0013ffa419412067726f7570206f6620417573736965207465656e732067657420686f6d652066726f6d20612063616d70696e6720686f6c6964617920746f2066696e642074686520636f756e74727920686173206265656e20696e766164656420627920616e20656e656d792061726d792e20546872696c6c696e6720616476656e74757265207769746820436169746c696e2053746173657920616e642052616368656c20487572642d576f6f642e2028323031302928313030206d696e7329',6,1537,0,0,'1c0013ffa419546f6d6f72726f772c205768656e205468652057617220426567616e',0,1,0,0,5767168,1,1006633093,0,NULL,0,NULL,NULL,NULL,NULL,'0',1,0,0,-224142,
'http://cdn.sky.com/60443/bsky_skymovies/MOVIE/bsky_skymovies-MAIN0000000000174170-201112310752010000.nff',	# ASSET URI
0,0,1,0,1329501600,'0:972440177',0,'070005ffa419434154414c4f47','locator:5:18:0',NULL,NULL,0,NULL,0,NULL,0,0,0,0,NULL,NULL,NULL,0,0,3,NULL,0,0,0,0,NULL,NULL,0,NULL,NULL,NULL,0);


<av-content>
// Holds information about content ( file, size, ..). Represent a vfile in MFS

AV_CONTENT_ID,    *av-content*
INTEGER PRIMARY KEY  UNIQUE, FILE_START_POSITION VARCHAR DEFAULT '0:0',  ACTUAL_START_TIME INTEGER DEFAULT '0',  
ACTUAL_DURATION,  
PROGRAM_SIZE VARCHAR DEFAULT '0:0',   VFILE_LOCATOR VARCHAR NOT NULL UNIQUE ,  
`SHREC_LOCATOR VARCHAR` , // *shrec* 
`IS_VIEWED`                 // *prop-is-viewed* `PCAT_CAT_PROP_IS_VIEWED` bool type
LAST_POSITION,
HEADEND_CONTENT_SIZE VARCHAR , INDEX_IMPORT_STATUS INTEGER DEFAULT '0',  CONTENT_IMPORT_STATUS INTEGER DEFAULT '0', IMPORT_SESSION_STATUS INTEGER DEFAULT '0',  IS_LEGACY_CONTENT INTEGER DEFAULT '0', ACTUAL_END_TIME INTEGER DEFAULT '0', LOCAL_ACTUAL_START_TIME INTEGER DEFAULT '0', LOCAL_ACTUAL_END_TIME INTEGER DEFAULT '0', 	 CONTENT_DISK_UID VARCHAR  , CA_COMP_INFO VARCHAR,VFILE_LOCATOR_TYPE INTEGER DEFAULT '21',  PMT_DATA VARCHAR ,CONTENT_DRM_EXP_TIME INTEGER DEFAULT 0, COUNTER INTEGER DEFAULT 0 );


INSERT INTO "AV_CONTENT" VALUES(620757127,'0:0',1331025198,6026423,'0:972284864','locator:3:15:5000000F:v1342177295s14','locator:3:14:E:s14',0,'0:0','0:972285052',3,3,3,0,1331025762,1331025198,1331025762,'00000000000000000000000000000000',NULL,21,NULL,0,1);


<signup-jobs> *series-link*
TABLE SIGNUP_JOBS 
(SIGNUP_JOB_ID INTEGER PRIMARY KEY , SIGNUP_URI VARCHAR ,  SIGNUP_TYPE INTEGER DEFAULT 0 ,SIGNUP_TIMEBASE_FREQUENCY INTEGER DEFAULT 0, SIGNUP_JOBS_IS_TEMP INTEGER DEFAULT 1, SIGNUP_EXPIRATION_TIME INTEGER, SIGNUP_IS_USER_DELETED INTEGER DEFAULT 0, SIGNUP_KEEP_STATUS INTEGER DEFAULT 0, SIGNUP_LOCK_STATUS INTEGER DEFAULT 0, SIGNUP_BOOKING_TYPE INTEGER DEFAULT 0, SIGNUP_DISK_QUOTA_NAME VARCHAR, SIGNUP_BOOKING_DELETION_CRITERIA INTEGER DEFAULT 0, SIGNUP_DONT_BOOK_CRITERIA INTEGER DEFAULT 0, SIGNUP_AUTO_SGT_MODE INTEGER DEFAULT 0, SIGNUP_AUTO_EGT_MODE INTEGER DEFAULT 0, SIGNUP_SGT_ON INTEGER DEFAULT 0, SIGNUP_EGT_ON INTEGER DEFAULT 0, SIGNUP_LEGACY_HANDLE_ID INTEGER DEFAULT '0', SIGNUP_RECORD_LED_POLICY INTEGER DEFAULT 0 , SIGNUP_START_TIME INTEGER , SIGNUP_PARTIAL_CHUNK_POLICY INTEGER DEFAULT 0, SIGNUP_IS_VCR_TIMER BOOLEAN DEFAULT 0 , SINGLE_CHANNEL INTEGER DEFAULT 0, SERIES_SERVICE VARCHAR, SERIES_BOOKING_TYPE INTEGER DEFAULT 0,  SIGNUP_ARR_LIST_ID INTEGER DEFAULT 0,SIGNUP_PROFILE_ID VARCHAR, SIGNUP_SHOW_ID INTEGER ,  SIGNUP_FILTER1 INTEGER DEFAULT 0, SIGNUP_FILTER2 INTEGER DEFAULT 0, SIGNUP_FILTER3 INTEGER DEFAULT 0, SIGNUP_FILTER4 INTEGER DEFAULT 0, SIGNUP_FILTER5 INTEGER DEFAULT 0, SIGNUP_FILTER_MODE INTEGER DEFAULT 0, SIGNUP_SUB_TYPE INTEGER DEFAULT 0, 
 SIGNUP_SERIES_ID INTEGER, *series-id* 
 SIGNUP_START_GUARD_TIME INTEGER, SIGNUP_END_GUARD_TIME INTEGER, SIGNUP_OVERRIDE_GT_SETTINGS BOOLEAN DEFAULT 0,  SIGNUP_PERMANENT_SERIES_ID INTEGER DEFAULT 0, SIGNUP_SHOW_TITLE VARCHAR, SIGNUP_SEASON_TITLE VARCHAR, SIGNUP_SEASON_SORT_TITLE VARCHAR, SIGNUP_NEXT_EPISODE_NUMBER INTEGER,  SIGNUP_LAST_BOOKED_EVENT_SERVICE_LOCATOR VARCHAR, SIGNUP_LAST_BOOKED_EVENT_CHANNEL_NAME VARCHAR, SIGNUP_LAST_BOOKED_EVENT_START_TIME INTEGER,  SIGNUP_LAST_BOOKED_EVENT_LOCAL_START_TIME INTEGER, SIGNUP_LAST_BOOKED_EVENT_NAME VARCHAR, SIGNUP_LAST_SERIES_EVENT_BOOKED BOOLEAN DEFAULT 0, SIGNUP_IS_PSL_TRIGGERED BOOLEAN DEFAULT 0, SIGNUP_PARENTAL_RATING INTEGER, SIGNUP_SYNOPSIS VARCHAR, SIGNUP_IS_BTO BOOLEAN DEFAULT 0, SIGNUP_SOURCE_LOCATOR VARCHAR, SIGNUP_TITLE VARCHAR, SIGNUP_SORT_TITLE VARCHAR, SIGNUP_CHANNEL_NAME VARCHAR, SIGNUP_IS_DOWNLOAD_ALL BOOLEAN DEFAULT 0, SIGNUP_PREFERRED_FORMAT INTEGER DEFAULT 0, SIGNUP_REFERER_DATA VARCHAR, SIGNUP_IS_HELP_VIDEO BOOLEAN DEFAULT 0, SIGNUP_RESOURCE_LOCATOR1 VARCHAR DEFAULT NULL, SIGNUP_RESOURCE_LOCATOR2 VARCHAR DEFAULT NULL, SIGNUP_RESOURCE_BLOB1 BLOB DEFAULT NULL)


// when books a series event, moves down and select "books series" option.
!MIL    -aem          		< p:0x00000255 P:APP t:0x013df520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(RECORD)e403 
!MIL    -EPG_MISC     		< p:0x00000255 P:APP t:0x2bfeb520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote",
  "action": "RECORD","title": "Key Press RECORD","label": "","currentscreen": "Entering grid: //TV Guide/All Channels"}

// no pause when no series link
!MIL    -EPG_BOOK     		< p:0x00000255 P:APP t:0x2bfeb520 T:no name M:BookingActivity F:`pause` L:475 > T:CEE-J EventQueue Reader 0:pause activity (aIv@59af2c6) by aLv@5aadfbf
!MIL    -aem          		< p:0x00000255 P:APP t:0x013df520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(DOWN)e101 
!MIL    -aem          		< p:0x00000255 P:APP t:0x013df520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(SELECT)e001 
!MIL    -EPG_BOOK     		< p:0x00000255 P:APP t:0x2bfeb520 T:no name M:BookingActivity F:`restart` L:253 > T:CEE-J EventQueue Reader 0:restart activity (aIv@59af2c6)
!MIL    -EPG_MISC     		< p:0x00000255 P:APP t:0x2bfeb520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "LinearAction",
  "action": "LINEAR_BOOK_RECORD_SERIES_LINK","title": "SeriesLink","label": "LINEAR_SERIES_LINK;title=CSI: Crime Scene Investigation;uuid=","currentscreen": "Entering grid: //TV Guide/All Channels"}

// jpa/modules/jpa-api/src/java/com/nds/fusion/planner/PlannerAddBookedProgrammeListener.java
// No prop id.  EPG calls PlannerSession.addScheduledBookedProgramme() and
// gets a callback if a series link option exists.  EPG must then respond
// saying whether to book single or series.
public interface PlannerAddBookedProgrammeListener
{
    /**
     * Notify the successful completion of operation.
     * @param object The reference of the {@link PlannerBookedProgramme} just retrieved.
     * The user must set the object to null when done with it. This is to prevent the
     * resources from being unnecessarily tied up and to enable garbage collection.
     * @param completionStatus {@link PlannerStatus} indicating success or failure. If the completion
     * status is {@link PlannerStatus#PLANNER_OK} then the booking has been made successfully. 
     *
     * If the status is {@link PlannerStatus#`SERIES_LINK`} then the booked
     * programme object passed back in is a {@link
     * PlannerScheduledBookedProgramme} and the user must call {@link
     * PlannerScheduledBookedProgramme#setSeriesLink} on this object to
     * complete the booking.  This will cause the listener to be triggered
     * again with the status {@link PlannerStatus#PLANNER_OK}.
     *
     * If the status is {@link PlannerStatus#PURCHASE_REQUIRED} then the user
     * must call either {@link PlannerBookedProgramme#storePurchase} to
     * purchase the programme now or {@link
     * PlannerBookedProgramme#continueBooking} to continue with the booking
     * without purchasing it (the booking will then need to be purchased
     * before viewing). The listener will then be triggered again with the
     * status {@link PlannerStatus#PLANNER_OK}.  For completion statuses of
     * {@link PlannerStatus#SERIES_LINK} or {@link
     * PlannerStatus#PURCHASE_REQUIRED} the booking can be cancelled by
     * calling {@link PlannerBookedProgramme#removeBookedProgramme}.  In this
     * case the {@link PlannerRemoveBookedProgrammeListener} passed to {@link
     * PlannerBookedProgramme#removeBookedProgramme} is not triggered (and it
     * is best just to pass in null), but the {@link #notifyFailure} method of
     * this listener is triggered, with completion status {@link
     * PlannerStatus#BOOKING_FAILED}.
     */
    void notifySuccess(PlannerBookedProgramme object, int completionStatus);

    /**
     * Notify completion of operation.
     * @param completionStatus {@link PlannerStatus} indicating success or failure.
     */
     void notifyFailure(int completionStatus);
}


<del-booking-jobs>
DEL_BOOKING_JOBS
(
BOOKING_JOB_ID INTEGER PRIMARY KEY,
BOOKING_ID INTEGER,  
REMINDER_STATUS INTEGER NOT NULL DEFAULT '1',
RECORD_STATUS INTEGER NOT NULL DEFAULT '0',
RECORD_STATE INTEGER  DEFAULT '0',  # typedef enum PCAT_CAT_RECORD_STATE_{
VRM_STATUS INTEGER  DEFAULT '1',    # typedef enum PCAT_CAT_VRM_RECORD_STATUS_{
IS_DESTROYED INTEGER DEFAULT '0',  IS_SCHEDULED INTEGER DEFAULT '0',  RMF_JOB_HANDLE INTEGER,  
JOB_IS_FAILED 		# PCAT_CAT_PROP_IS_FAILED. BOOL
BOOKING_TIME INTEGER DEFAULT '0',BOOKING_JOB_DELETION_TIME INTEGER DEFAULT '0' ,TRIGGER_TIME INTEGER ,  BOOKING_JOBS_IS_TEMP INTEGER DEFAULT 1, IS_SERIES_TRIGGERED INTEGER  NOT NULL DEFAULT '0', BOOKING_TYPE_REPLACEMENT_ID INTEGER , IS_DELETION_TIME_ARRIVED INTEGER NOT NULL DEFAULT '0' , QUEUE_POSITION INTEGER DEFAULT '0' , DOWNLOAD_STATUS INTEGER DEFAULT '0',    IS_ACTIVE INTEGER DEFAULT 1,  PUSH_IS_EXPIRY_START_TRIGGERED INTEGER DEFAULT 0, PUSH_IS_EXPIRY_END_TRIGGERED INTEGER DEFAULT 0, IS_TEMPORARY BOOLEAN DEFAULT 0, IS_IMMEDIATE BOOLEAN DEFAULT 0 ,PARTIAL_CHUNK_POLICY DEFAULT 0, GROUP_ID INTEGER DEFAULT '0'  ,FTS3_SEARCH BOOLEAN DEFAULT 0  ,
BOOKING_SOURCE INTEGER DEFAULT 0 ,  # typedef enum PCAT_CAT_BOOKING_SOURCE_ 
SUB_GROUP_ID INTEGER DEFAULT 0 );

INSERT INTO "DEL_BOOKING_JOBS" VALUES(687865875,553648147,1,5,4,2,1,0,0,0,1332167043,1332719998,1332167220,0,0,NULL,0,0,0,1,0,0,0,0,0,687865875,0,1,0);


################
# DEL_BOOKING_INFO #
################
(BOOKING_ID INTEGER PRIMARY KEY UNIQUE,  BOOKING_TYPE INTEGER NOT NULL DEFAULT '0',  BASE_TYPE INTEGER NOT NULL DEFAULT '0',  EVENT_ID INTEGER  NOT NULL DEFAULT '0', BOOKING_AUTO_SGT_MODE  INTEGER  ,  BOOKING_AUTO_EGT_MODE  INTEGER,BOOKING_SGT  INTEGER  ,BOOKING_EGT INTEGER , START_TIME_EXTENSION INTEGER  DEFAULT '0',  END_TIME_EXTENSION INTEGER  DEFAULT '0',AV_CONTENT_ID INTEGER DEFAULT '0',IS_COMMITED INTEGER DEFAULT '0' ,LED_IS_ON INTEGER DEFAULT '2', LOCK INTEGER DEFAULT '0',  KEEP INTEGER DEFAULT '0' ,
BOOKING_EXCEPTION,		# Note that there's the same in BOOKING_INFO 
PARTIAL_CONTENT_STATUS DEFAULT '1',  
DELETION_REASON
BOOKING_DISK_QUOTA_NAME VARCHAR  ,SIGNUP_JOB_ID INTEGER  NOT NULL DEFAULT '0', COPY_EXTERNAL INTEGER DEFAULT '0', COPY_FLAG_TIME_SET INTEGER DEFAULT '0',BOOKED_AS_OPPV BOOLEAN DEFAULT 0,  PPC_PLAYBACK_AVAILABLE INTEGER DEFAULT '0',  BOOKING_FAVOURITE_CHANNEL INTEGER,   IS_CURRENT_SERIES BOOLEAN DEFAULT 0 , IS_VCR_TIMER BOOLEAN DEFAULT 0, IS_PARENTAL_CONTROL_CHECKED BOOLEAN DEFAULT 0, SYSTEM_SIGNUP_JOB_ID INTEGER NOT NULL DEFAULT '0',  BOOKING_EXCEPTION_CA_REC_PROBLEMS BLOB DEFAULT NULL , INCOMPLETE_RECORDING_ATTEMPTS INTEGER DEFAULT 0,COUNTER INTEGER DEFAULT 1 );

INSERT INTO "DEL_BOOKING_INFO"
"DELETION_REASON",	/*PCAT_CAT_PROP_DELETION_REASON*/ SYSTEM_EXCEPTION_TYPE_BOOKING_EXPIRED (37) # SRM set
VIEWER_BOOKING_DELETED = 8;
INSUFFICIENT_DISK_SPACE = 11;
UNKNOWN_ERROR = 28;


################
# ENTITLEMENT #
################
ITEM_AND_ENTITLEMENT(EVENT_ID,ENTITLEMENT_ID);

ENTITLEMENT(
ENTITLEMENT_ID INTEGER PRIMARY KEY ,  
ENTITLEMENT_PURCHASE_RECEIPT VARCHAR  NOT NULL , 
ENTITLEMENT_PURCHASE_MODEL INTEGER,
ENTITLEMENT_RENTAL_DURATION INTEGER,  
ENTITLEMENT_EED INTEGER DEFAULT 0 ,
ENTITLEMENT_MED INTEGER DEFAULT 0,
ENTITLEMENT_IS_CA_VIEWED INTEGER , # BOOL 
ENTITLEMENT_IS_VALID INTEGER DEFAULT 1, 
ENTITLEMENT_IS_CANCELLED INTEGER DEFAULT 0, 
ENTITLEMENT_CARD_ID INTEGER DEFAULT 0,  
LEGACY_PPVMAN_ID INTEGER DEFAULT 0, 
EVENT_ID INTEGER DEFAULT 0, 
PURCHASE_PACKETS_INFO_ID INTEGER DEFAULT 0 , 
PURCHASE_DATE INTEGER DEFAULT NULL);


<db-and-pcat>
// pcatp_api.c
// to see a mapping between names in DB and PCAT_CAT_
static const char* pcat_cat_property_name[] =

all_obj_prop_array[] = 
{
	{		
		PCAT_CAT_OBJECT_TYPE_BOOKING,
			/*object_key*/
			"BOOKING_ID",
			/*table name*/
			"BOOKING_INFO",
		{/*key properties*/
			PCAT_CAT_PROP_BOOKING_TYPE,PCAT_CAT_PROP_ITEM_OBJECT_ID, PCAT_CAT_PROP_BASE_TYPE,PCAT_VIEW_PROP_UNDEF
		},
		{/*mandatory properties*/
			PCAT_CAT_PROP_BOOKING_TYPE,PCAT_CAT_PROP_ITEM_OBJECT_ID, PCAT_CAT_PROP_BASE_TYPE,PCAT_VIEW_PROP_UNDEF
			},
			{/*all prop*/
				PCAT_CAT_PROP_BASE_TYPE,PCAT_CAT_PROP_BOOKING_TYPE,
					PCAT_CAT_PROP_ITEM_OBJECT_ID,PCAT_CAT_PROP_TIMEBASE_OBJECT_ID,PCAT_CAT_PROP_AUTO_SGT_MODE,PCAT_CAT_PROP_AUTO_EGT_MODE,
					PCAT_CAT_PROP_BOOKING_START_GUARD_DURATION,PCAT_CAT_PROP_BOOKING_END_GUARD_DURATION,
					PCAT_CAT_PROP_START_EXTENSION_DURATION,PCAT_CAT_PROP_END_EXTENSION_DURATION,PCAT_CAT_PROP_AVCONTENT_OBJECT_ID,
					PCAT_CAT_PROP_KEEP_STATUS,PCAT_CAT_PROP_LOCK_STATUS,PCAT_CAT_PROP_RECORD_LED_POLICY,
					PCAT_CAT_PROP_EXCEPTION,PCAT_CAT_PROP_CONTENT_STATUS,PCAT_CAT_PROP_DELETION_REASON,PCAT_CAT_PROP_BOOKING_DISK_QUOTA_NAME,
					PCAT_CAT_PROP_USER_SIGNUP_JOB_OBJECT_ID,PCAT_CAT_PROP_SYSTEM_SIGNUP_JOB_OBJECT_ID,PCAT_CAT_PROP_COPY_EXTERNAL,
					PCAT_CAT_PROP_PPC_PLAYBACK_AVAILABLE,PCAT_CAT_PROP_DOWNLOAD_ITEM_OBJECT_ID,PCAT_CAT_PROP_BOOKED_AS_OPPV,
#ifdef PVR_PIN_ON_SERVICE_BLOCKED_AT_RECORD_TIME
					PCAT_CAT_PROP_SERVICE_LOCK_STATUS,
#endif
#ifdef PCAT_FAVOURITE_CHANNEL_PROPERTY
					PCAT_CAT_PROP_FAVOURITE_CHANNEL,
#endif /*PCAT_FAVOURITE_CHANNEL_PROPERTY*/
					PCAT_CAT_PROP_IS_CURRENT_SERIES, PCAT_CAT_PROP_IS_VCR_TIMER,PCAT_CAT_PROP_IS_PARENTAL_CONTROL_CHECKED,
					PCAT_CAT_PROP_BOOKING_EXCEPTION_CA_REC_PROBLEMS,PCAT_CAT_PROP_BDL_ITEM_OBJECT_ID,PCAT_CAT_PROP_CONTENT_INCOMPLETE_RECORDING_ATTEMPTS,
					PCAT_VIEW_PROP_UNDEF
			}

	},
}


PCAT_VIEW_SRV_InsertBookingJob
	DBVIEW_InsertBookingJob
		DBVIEW_Insert
			DbviewBuildInsertBookingStmt
				PCATP_ConvertProp
					PCATP_ConvertPropStr

(pcatp_api.c)
static const char* pcat_cat_pdl_property_name[] =

static const char* pcatp_property_name[] =
{
	UNDEFINED_PROP_STRING,
	"LOGICAL_CHANNEL",/*PCAT_CAT_PROP_LOGICAL_CHANNEL*/
	"CHANNEL_NAME",/*PCAT_CAT_PROP_CHANNEL_NAME*/
	"LED_IS_ON",/*PCAT_CAT_PROP_RECORD_LED_POLICY*/
	"IS_VIEWED",/*PCAT_CAT_PROP_IS_VIEWED*/
	"LAST_POSITION",								/*PCAT_CAT_PROP_LAST_PLAYBACK_POSITION*/
	"BOOKMARK_ABSOLUTE_POSITION",/*PCAT_CAT_PROP_BOOKMARK_ABSOLUTE_POSITION*/
	"SUB_64_BYTES( BOOKMARK_ABSOLUTE_POSITION, FILE_START_POSITION )",/*PCAT_CAT_PROP_BOOKMARK_RELATIVE_OFFSET*/
	"SUB1_64_BYTES( LAST_POSITION, FILE_START_POSITION )",/*PCAT_CAT_PROP_PLAYBACK_POSITION_RELATIVE_OFFSET*/
	"GENRE",/*PCAT_CAT_PROP_GENRE*/
	"SUBGENRE",/*PCAT_CAT_PROP_SUBGENRE*/
	"IS_IPPV",/*PCAT_CAT_PROP_IS_IPPV*/
	"IS_OPPV",/*PCAT_CAT_PROP_IS_OPPV*/
	"COPY_EXTERNAL",/*PCAT_CAT_PROP_COPY_EXTERNAL*/
	"EVENT_NAME_SORT",/*PCAT_CAT_PROP_EVENT_NAME_SORT*/
	UNDEFINED_PROP_STRING,/*PCAT_CAT_PROP_IS_COLLAPSED_LIST - virtual prop*/
	"ENTITLEMENT_PURCHASE_RECEIPT",/*PCAT_CAT_PROP_ENTITLEMENT_PURCHASE_RECEIPT*/
	"ENTITLEMENT_PURCHASE_MODEL",/*PCAT_CAT_PROP_ENTITLEMENT_PURCHASE_MODEL*/
	"ENTITLEMENT_RENTAL_DURATION",/*PCAT_CAT_PROP_ENTITLEMENT_RENTAL_DURATION*/
	"ENTITLEMENT_EED",/*PCAT_CAT_PROP_ENTITLEMENT_EED*/
	"ENTITLEMENT_MED",/*PCAT_CAT_PROP_ENTITLEMENT_MED*/
	"ENTITLEMENT_IS_CA_VIEWED",/*PCAT_CAT_PROP_ENTITLEMENT_IS_CA_VIEWED*/
	"ENTITLEMENT_IS_VALID",/*PCAT_CAT_PROP_ENTITLEMENT_IS_VALID*/
	"ENTITLEMENT_IS_CANCELLED",/*PCAT_CAT_PROP_ENTITLEMENT_IS_CANCELLED*/
	"ENTITLEMENT_CARD_ID",/*PCAT_CAT_PROP_ENTITLEMENT_CARD_ID*/
	"ENTITLEMENT_ID",/*PCAT_CAT_PROP_ENTITLEMENT_OBJECT_ID*/
	"SIGNUP_RECORD_LED_POLICY",/*PCAT_CAT_PROP_SIGNUP_RECORD_LED_POLICY*/
	"ESTIMATED_BIT_RATE",/*PCAT_CAT_PROP_ESTIMATED_BIT_RATE*/
	"PURCHASE_PACKETS_INFO_ID",/*PCAT_CAT_PROP_PURCHASE_PACKETS_INFO_OBJECT_ID*/
	"PURCHASE_PACKETS",/*PCAT_CAT_PROP_PURCHASE_PACKETS*/
	UNDEFINED_PROP_STRING,/*PCAT_CAT_PROP_PURCHASE_PACKETS_INFO_FED*/
	UNDEFINED_PROP_STRING,/*PCAT_CAT_PROP_PURCHASE_PACKETS_INFO_MED*/
	"PURCHASE_PACKETS_RENTAL_FLAG",/*PCAT_CAT_PROP_PURCHASE_PACKETS_INFO_RENTAL_FLAG*/
	"IS_DELETION_TIME_ARRIVED",/*PCAT_CAT_PROP_IS_DELETION_TIME_ARRIVED*/
	UNDEFINED_PROP_STRING, /*was PCAT_CAT_PROP_BOOKING_TYPE_REPLACEMENT_BOOKING_ID*/									 
	"PUSH_PUBLISHTIME", /*PCAT_CAT_PROP_PUSH_PUBLISHTIME*/
	"PUSH_EXPIRY_START", /*PCAT_CAT_PROP_PUSH_EXPIRYSTART*/
	"PUSH_EXPIRYEND", /*PCAT_CAT_PROP_PUSH_EXPIRYEND*/
	"PUSH_LOCATOR",	/*PCAT_CAT_PROP_PUSH_LOCATOR*/
	"PUSH_EXPIRYTIME", /*PCAT_CAT_PROP_PUSH_EXPIRYTIME*/
	"PUSH_HASVALIDTRAILER",/*PCAT_CAT_PROP_PUSH_HASVALIDTRAILER*/
	"PUSH_TRAILERDURATION",/*PCAT_CAT_PROP_PUSH_TRAILERDURATION*/
	"PUSH_TRAILEROFFSET",/*PCAT_CAT_PROP_PUSH_TRAILEROFFSET*/
	"BOOKED_AS_OPPV",/*PCAT_CAT_PROP_BOOKED_AS_OPPV*/
	"PURCHASE_PACKETS_CA_EXPIRATION_TIME",/*PCAT_CAT_PROP_PURCHASE_PACKETS_CA_EXPIRATION_TIME*/
	"PARENT_SERVICE_LOCATOR",/*PCAT_CAT_PROP_PARENT_SERVICE_LOCATOR*/
	"IS_ANALOG_TAPING_ALLOWED", /*PCAT_CAT_IS_ANALOG_TAPING_ALLOWED */
	"TRACKING_LOCATOR",/*PCAT_CAT_PROP_TRACKING_LOCATOR*/
	"PUSH_IS_EXPIRY_START_TRIGGERED",/*PCAT_CAT_PROP_PUSH_IS_EXPIRY_START_TRIGGERED*/
	"PUSH_IS_EXPIRY_END_TRIGGERED",/*PCAT_CAT_PROP_PUSH_IS_EXPIRY_END_TRIGGERED*/
	"SERVICE_TYPE",/*PCAT_CAT_PROP_SERVICE_TYPE*/
	UNDEFINED_PROP_STRING, /*PCAT_CAT_PROP_COLLAPSED_LIST_STATUS, virtual prop*/
	UNDEFINED_PROP_STRING, /*PCAT_CAT_PROP_COLLAPSED_LIST_ITEMS_IN_GROUP, virtual prop*/
	UNDEFINED_PROP_STRING, /*PCAT_CAT_PROP_COLLAPSED_LIST_VIEWED_ITEMS_IN_GROUP, virtual prop*/
	"ALLOW_COPY_TO_PLANNER", /*PCAT_CAT_PROP_ALLOW_COPY_TO_PLANNER*/
	"EXPIRE_FROM_PLANNER", /*PCAT_CAT_PROP_EXPIRE_FROM_PLANNER*/
#ifndef PVR_PIN_ON_SERVICE_BLOCKED_AT_RECORD_TIME
	UNDEFINED_PROP_STRING,
#else
	"SERVICE_LOCK_STATUS",/*PCAT_CAT_PROP_SERVICE_LOCK_STATUS*/
#endif
#if (defined(SRM_ELEMENTARY_STREAMS_SELECTION_B) || defined(SRM_ELEMENTARY_STREAMS_SELECTION_D ))
	"AUDIO_STREAMS_NUMBER",/*PCAT_CAT_PROP_AUDIO_STREAMS_NUMBER*/
	"IS_DOLBY_DIGITAL_EXISTS",/*PCAT_CAT_PROP_IS_DOLBY_DIGITAL_EXISTS*/
#else
	UNDEFINED_PROP_STRING, /*PCAT_CAT_PROP_AUDIO_STREAMS_NUMBER*/
	UNDEFINED_PROP_STRING, /*PCAT_CAT_PROP_IS_DOLBY_DIGITAL_EXISTS*/
#endif
	UNDEFINED_PROP_STRING, /* PCAT_CAT_PROP_COLLAPSED_LIST_DISK_USAGE, virtual prop */

	UNDEFINED_PROP_STRING /* PCAT DARWIN PROP */
};

static const char* pcat_cat_property_name[] =
{
		UNDEFINED_PROP_STRING,
		"EVENT_LOCATOR",/*PCAT_CAT_PROP_EVENT_LOCATOR*/
		"SERVICE_LOCATOR",/*PCAT_CAT_PROP_SERVICE_LOCATOR*/
		"START_TIME",/*PCAT_CAT_PROP_START_TIME*/
		"LOCAL_START_TIME",/*PCAT_CAT_PROP_LOCAL_START_TIME*/
		"TRIGGER_TIME",/*PCAT_CAT_PROP_TRIGGER_TIME*/
		"DURATION",/*PCAT_CAT_PROP_DURATION*/ # PLANNER_API_BOOKEDPROG_PROPID_UINT32_DURATION. Scheduled duration of program (in milsec)
		"ACTUAL_DURATION",/*PCAT_CAT_PROP_ACTUAL_DURATION*/
}

// *prop-booking-type*
typedef enum PCAT_CAT_BOOKING_TYPE_TAG{

	PCAT_CAT_BOOKING_TYPE_UNDEF = 0			,   /**< @brief  No available status */
	PCAT_CAT_BOOKING_TYPE_REMINDER			,	/**< @brief  The booking type is Reminder*/
	PCAT_CAT_BOOKING_TYPE_RECORD			,	/**< @brief  The booking type is Record*/ # this is for PVOD
	PCAT_CAT_BOOKING_TYPE_SWDL				,	/**< @brief  The booking type is SWDL*/				
	PCAT_CAT_BOOKING_TYPE_PDL				,	/*!< The booking type is Download.*/ 
	PCAT_CAT_BOOKING_TYPE_BDL				,	/*!< The booking type is BDL.*/ 
	PCAT_CAT_BOOKING_TYPE_LAST					/**< @brief  dummy - last enum value */

}PCAT_CAT_BOOKING_TYPE;

typedef enum PCAT_CAT_BASE_TYPE_TAG{

	PCAT_CAT_BASE_TYPE_UNDEF = 0		,	/**< @brief  No available status */
	PCAT_CAT_BASE_TYPE_TIME				,   /**< @brief  The base type of the booking is time-based*/
	PCAT_CAT_BASE_TYPE_SCHED_EVENT		,   /**< @brief  The base type of the booking is event-based*/
	PCAT_CAT_BASE_TYPE_DOWNLOAD_ITEM	,	/*!< The base type of the booking is download.*/
	PCAT_CAT_BASE_TYPE_LAST					/**< @brief  dummy - last enum value */

}PCAT_CAT_BASE_TYPE;


{pcat-debug}

note:
the majority of the value lists were allocated to send notification data.
Planner should be freeing the notification value lists. Often some value lists
are not freed due to Picasso holding on to Planner handles.

Planner will be deleting the PCAT value lists when planner have processed the
notifications. 


<where-to-define>
define in pcat/src/common/interface/makefile

ONLY use this makefile otherwise will get build errors saying there're
redefinitions.

`PCAT_ENABLE_EXTRA_VL_DEBUG` to get thread id and creation times of VL. 
`PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG` to show client view filter and sort types in logging.  
`PCAT_LOG_POSSIBLE_VL_LEAKS` to show VL allocations longer than 5 mins as possible leaks.

COMPONENT_CC_DEFINES :=PCAT_ENABLE_EXTRA_VLDEBUG
COMPONENT_CC_DEFINES +=PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
COMPONENT_CC_DEFINES +=PCAT_LOG_POSSIBLE_VL_LEAKS                             

CMS_INFORMATION_SERVICES/PCAT/src/common/interface/makefile:75:#COMPONENT_CC_DEFINES += PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/pcat_view_clnt.c:736:#ifdef PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/pcat_view_clnt.c:746:#endif /* PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG */
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/value_list_man_clnt.c:2657: define PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG to show client view filter and sort types in logging.
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/value_list_man_clnt.c:2796:#ifdef PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/value_list_man_clnt.c:2799:#endif /* PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG */
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.c:117:    #ifdef PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.c:120:    #endif /* PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG */
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.c:213:#ifdef PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.c:216:#endif /* PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG */
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.h:46:#ifdef PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG
CMS_INFORMATION_SERVICES/PCAT/src/common/interface/view_man_clnt.h:49:#endif /* PCAT_ENABLE_EXTRA_CLIENT_VIEW_DEBUG */


<pcat-config> pcat_db.cfg

[VIEWS_LIMITATION]
MAX_VIEWS=200
[VL_LIMITATION]
MAX_VL=100 # gMaxValueList


// 
PCAT_VIEW_VL_Create
  `PCAT_VIEW_VL_LOG_ALLOC_VL`
  PCAT_VIEW_VL_LogAllocVL

//
PCAT_AllocStaticP_DBG
  !ERROR  -PCATC < p:0x00000000 P: t:0x2b33f520 T:PCAT_PROXY_THREAD M:pcat_misc.c 
    F:PCAT_AllocStaticP_DBG L:420 > not enough memory: size=4, called from M=pcat_serialize_structs.c, F=PCAT_SERIALIZE_deserialize_PropValue, L=211 

  `PCAT_VIEW_VL_LOG_ALLOC_VL`(PCAT_VIEW_STATUS_NOT_ENOUGH_MEMORY);
  #define PCAT_VIEW_VL_LOG_ALLOC_VL(status) PCAT_VIEW_VL_LogAllocVL((status))


// CMS_INFORMATION_SERVICES/PCAT/src/common/interface/value_list_man_clnt.c
void `PCAT_VIEW_VL_LogAllocVL`(SYSTEM_STATUS result_status);

// start line of this list
!WARN   -PCATC        		< T:no name M:value_list_man_clnt.c 
  F:PCAT_VIEW_VL_LogAllocVL L:2774 > Number of allocated value lists=54 log_all=1 thread=0x2dfa4520 no name 

!WARN   -PCATC        		< T:PLANNER_MAIN M:value_list_man_clnt.c 
  F:`PCAT_VIEW_VL_LogAllocVL` L:2816 > VL hdl=0x15466 allocated but not freed 
  for `view` PLANNER17 hdl=0x7000014, " "flags=0, ObType=0, num_rows=1, total_size=905, curpos=0 

                    pName = pViewDef->view_name;

#ifdef `PCAT_ENABLE_EXTRA_VL_DEBUG`  /* for extra debugging */
  note:
  gives filter and sort type which maps to certain view.

                    DIAG_LOG_WARN(PCAT_diag_segment_id, ("VL hdl=%#x allocated but not freed for %s %s hdl=%#x, flt=%d, srt=%d, "
                        "thread=%x, time=%lu, flags=%u, ObType=%d, num_rows=%lu, total_size=%lu, curpos=%d, dur_mins=%d, possible_leak=%d",
                        vl_debug_info->value_list.value_list_hdl,
                        ((vl_debug_info->dbg_view_hdl > 0xFFU) ? "view" : "client"), ((NULL != pName) ? pName : ""), vl_debug_info->dbg_view_hdl, flt, srt,
                        vl_debug_info->dbge_thread_id, vl_debug_info->dbge_create_time, vl_debug_info->dbg_usage_flags,
                        vl_debug_info->value_list.object_type, vl_debug_info->value_list.num_rows, vl_debug_info->value_list.total_size,
                        vl_debug_info->current_position, dur_mins, ((dur_mins >= 5U) ? true:false) ));
#else
                    DIAG_LOG_WARN(PCAT_diag_segment_id, ("VL hdl=%#x allocated but not freed for %s %s hdl=%#x, "
                        "flags=%u, ObType=%d, num_rows=%lu, total_size=%lu, curpos=%d",
                        vl_debug_info->value_list.value_list_hdl,
                        ((vl_debug_info->dbg_view_hdl > 0xFFU) ? "view" : "client"), ((NULL != pName) ? pName : ""), vl_debug_info->dbg_view_hdl,
                        vl_debug_info->dbg_usage_flags, vl_debug_info->value_list.object_type, vl_debug_info->value_list.num_rows,
                        vl_debug_info->value_list.total_size, vl_debug_info->current_position));
#endif

ValueListClnt vl_debug_info = NULL;

typedef struct ValueListClntStructTag
{
    `DBVIEW_ValueListStruct`      value_list;
    uint32_t                    current_position;
    PCAT_PROP_HANDLE_UNION**    to_be_destroyed;

    PCAT_VIEW_HANDLE dbg_view_hdl; /* associated view for debugging */
    uint8_t dbg_usage_flags;       /* usage flags for debugging */

#ifdef PCAT_ENABLE_EXTRA_VL_DEBUG
    uint32_t dbge_thread_id;     /* id of thread used to create/allocate */
    uint32_t dbge_create_time;   /* time of creation */
#endif /* PCAT_ENABLE_EXTRA_VL_DEBUG */

}ValueListClntStruct;


# when hit PCAT_VIEW_CLNT_POOL and see below errors, add up all total_size and
# get 125696. That's much lower than total 400K
#
# hdl=0x5000038 is view handle


!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02660 > Number of allocated value lists=54 log_all=1 thread=0x2b1a1520 PLANNER_MAIN
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0xee allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=557, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x129 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=411, curpos=0
...
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x239 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=311, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x283 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=593, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x1fb allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=311, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x1fd allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=311, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x290 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=594, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x284 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=593, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x23d allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=311, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x27b allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=593, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x281 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=593, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x287 allocated but not freed for view PLANNER50 hdl=0x5000038, flags=0, ObType=0, num_rows=1, total_size=593, curpos=0
...
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x28e allocated but not freed for view PLANNER25 hdl=0x500001a, flags=0, ObType=0, num_rows=5, total_size=2696, curpos=0
!WARN  -PCATC        < T:PLANNER_MAIN F:PCAT_VIEW_VL_LogAllocVL L:02702 > VL hdl=0x293 allocated but not freed for client  hdl=0, flags=0, ObType=0, num_rows=0, total_size=0, curpos=0

!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_static.c F:MHWMemAllocStatic L:00065 > Cannot allocate 60 bytes in pool PCAT_VIEW_CLNT_POOL, not enough memory
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_static.c F:MHWMemAllocStatic L:00068 >    Biggest block is 0 bytes
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00353 > MEMCHECK: BEGIN Check Pool: PCAT_VIEW_CLNT_POOL
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00363 > MEMCHECK: Chunk 0 addresses: [[ 0x10f3b28 ]] -> [[ 0x1123327 ]]
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00370 > MEMCHECK: Offset range in chunk:  0      +0 ->  0 +194559[  194560]
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00501 > MEMCHECK: Checking block pool
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00637 > MEMCHECK:      0 : used block  0      +0[      28] S------ [0x010f3b3c]  <no-owner> 0
!WARN  -MEMMAN       < T:PCAT_PROXY_THREAD M:mem_info.c F:MemCheckMemory L:00637 > MEMCHECK:      6 : used block  0   +1088[      28] S------ [0x010f3f7c]  <no-owner> 0
...


<pcat-dirty-flag>
!WARN   -PCATS        		< p:0x000001dd P:MW t:0x01a9a520 T:PCAT_SRV_SYSINIT_THREAD M:dbview.c F:Dbview_PVR_InitDb L:1898 > num_external_disk=0,isDirtyShutdown = 1 ,dbview_conf = 2 


={============================================================================
|kt_dev_si_0001| comp-pcat-dbengine

Uzan, Galit <GUzan@nds.com>

COMPONENT_NAME := dbengine

src/Interface/dbe_interface/makefile
52:COMPONENT_NAME := dbe_interface

// segment name
char f_segment_name_debug_backup[] = "DBENGINE_BACKUP";
char f_segment_name_debug_mirror[] = "DBENGINE_MIRROR";

status = DIAG_LOG_SetTraceSettings(DBENGINE_BACKUP_diag_segment_id, DBENGINE_DIAG_TRACE_BIT_PATTERN_ERROR); 
status = DIAG_LOG_SetTraceSettings(DBENGINE_MIRROR_diag_segment_id, DBENGINE_DIAG_TRACE_BIT_PATTERN_ERROR); 


#define DBENGINE_SRV_DIAG_SEGMENT_NAME            "DBENGINE_SRV"
DBENGINE_XDEBUG_Init(DBENGINE_SRV_DIAG_SEGMENT_NAME); 
DBENGINE_diag_segment_id;

TRACE_LEVEL_DBENGINE_BACKUP="AFEWM"
TRACE_LEVEL_DBENGINE_MIRROR="AFEWM"
TRACE_LEVEL_DBENGINE_SRV="AFEWM"


<version>
SQLITE_VERSION     77 CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/common_h/sqlite3.h # undef SQLITE_VERSION
SQLITE_VERSION    110 CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/common_h/sqlite3.h #define SQLITE_VERSION        "3.7.9"
SQLITE_VERSION    506 CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/sqlite3/src/amalgation/sqlite3.c # undef SQLITE_VERSION
SQLITE_VERSION    542 CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/sqlite3/src/amalgation/sqlite3.c #define SQLITE_VERSION         "3.6.1"

DIAG_LOG_INFO(DBENGINE_diag_segment_id, ("SQLite version : %s", SQLITE_VERSION));


<dbengine-status>
# (((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((8 & 0x3FF) << 22) | ((1 & 0x3) << 16) | ((0 & 0xF) << 12) | (19 & 0xFFF) ) = 0x2010013


`0x2010013`
#define DBENGINE_API_STATUS_CONSTRAINT
DBENGINE_API_MAKE_STATUS(SEVERITY_WARNING,19)   
/*!< Abort due to constraint violation */ 

this error means that you try to insert an object that already exist in the
db. Because this error is return to SIM, you need to ask them if this an error
or not. For PCAT for example, this error can happen and it's not a failure,


#define DBENGINE_API_STATUS_DONE        DBENGINE_API_MAKE_STATUS(SEVERITY_NONE,101)  /*!< #DBENGINE_API_Step() has finished executing */

!ERROR -SQ13         < p:00000078 t:2af4e9e0 T:SIM_PI_XSI_SKEVT_THREAD M:sim_dbc_sched_query.c F:SIM_DBC_QUERY_GetPVODGroupsByProgInst L:00886 > DBENGINE_API_Step()='0x2000065' FAILED
!WARN  -SQ22         < p:00000078 t:2af4e9e0 T:SIM_PI_XSI_SKEVT_THREAD M:sim_qh_htmon.c F:SIM_qh_htmon_ProgInstPopulationListener L:01994 > SIM_DBC_QUERY_GetPVODGroupsByProgInst 0x10006 FAILED

(from Galit)
The status 0x2000065 (DBENGINE_API_STATUS_DONE) is not an error, it only means that there is no more row to select 
that the execution of the query is done.

When you execute a query, you first call once to DBENGINE_API_Prepare and while the db_status == DBENGINE_API_STATUS_ROW, 
you need to call to db_status=DBENGINE_API_Step() to get the last row return by the query.
when the db_status is DBENGINE_API_STATUS_DONE  (0x20000065) it means that you don't need to call again to DBENGINE_API_Step 
the query has been totally executed there is no more row to get.
If SIM print the error below it seems to be that the query (select) doesn't return the result they expect.

# 0x2020001
#define DBENGINE_API_STATUS_ERROR        DBENGINE_API_MAKE_STATUS(SEVERITY_SEVERE,1)   /*!< SQL error or missing database */

# 0x2020015
#define DBENGINE_API_STATUS_PROTOCOL    DBENGINE_API_MAKE_STATUS(SEVERITY_SEVERE,15)   /*!< Database lock protocol error */


<dbengine_backup>
CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/dbe_interface/dbengine_backup.c


<pcat-error>
`0x203000b`
#define DBENGINE_API_STATUS_CORRUPT     DBENGINE_API_MAKE_STATUS(SEVERITY_FATAL,11)   
/*!< The database disk image is malformed */

`0x202000a` SEVERITY_SEVERE(2)
#define DBENGINE_API_STATUS_IOERR       DBENGINE_API_MAKE_STATUS(SEVERITY_SEVERE,10)   
/*!< Some kind of disk I/O error occurred */

!ERROR  -DBENGINE_SRV 		T:VRM_SRV M:dbengine_api.c F:DBENGINE_API_ExecSQL L:1249 > 
  execution error on stmt = INSERT INTO BEFORE_NOTIF SELECT 167772199, A.BOOKING_JOB_ID, A.BOOKING_ID,B.EVENT_ID,B.AV_CONTENT_ID,0,0,0,BOOKING_JOB_ID,E.SHREC_ITEM_ID,0,0 FROM BOOKING_JOBS A LEFT OUTER JOIN BOOKING_INFO B ON A.BOOKING_ID = B.BOOKING_ID LEFT OUTER JOIN ITEM C ON B.EVE\n 
!ERROR  -DBENGINE_SRV 		T:VRM_SRV M:dbengine_api.c F:DBENGINE_API_ExecSQL L:1250 > 
  status = 0x203000b\n 
!ERROR  -DBENGINE_SRV 		T:VRM_SRV M:dbengine_api.c F:DBENGINE_API_ExecSQL L:1253 > 
  errmsg = database disk image is malformed\n 

NDS: ^0947462201.382190 !ERROR  -DBENGINE_SRV 		< p:0x00000403 P:MW t:0x01aae520 T:PCAT_SRV_THREAD M:dbengine_api.c F:DBENGINE_API_ExecSQL L:1253 > errmsg = database disk image is malformed\n 

SYSTEM_STATUS DBENGINE_API_ExecSQL()
{
  status_sql=sqlite3_exec((sqlite3 *)dbContext,sql,callback,arg,&local_errmsg);

  DIAG_LOG_ERROR(DBENGINE_diag_segment_id, ("execution error on stmt = %s\n",sql));
  DIAG_LOG_ERROR(DBENGINE_diag_segment_id, ("status = 0x%x\n",status));
  if (local_errmsg != NULL)
  {
    DIAG_LOG_ERROR(DBENGINE_diag_segment_id, ("errmsg = %s\n",local_errmsg));
  }
}

This means that "database disk image is malformed" comes from sqlite.


// CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/sqlite3/src/amalgation/sqlite3.c
# define SQLITE_CORRUPT_BKPT SQLITE_CORRUPT

78570 CMS_INFORMATION_SERVICES/DBENGINE/src/Interface/sqlite3/src/amalgation/sqlite3.c     
  case SQLITE_CORRUPT:    z = "database disk image is malformed";      break;


<pcat-check>
https://sqlite.org/download.html
sqlite-tools-linux-x86-3140200.zip
(1.75 MiB) 		A bundle of command-line tools for managing SQLite database
files, including the command-line shell program, the sqldiff program, and the
sqlite3_analyzer program.  (sha1: 296d4b1f419a544b2e7c7cf29792d5074dad9cc6)

https://www.sqlite.org/pragma.html#pragma_integrity_check
PRAGMA schema.integrity_check;
PRAGMA schema.integrity_check(N)

This pragma does an `integrity check of the entire database` 

The integrity_check pragma looks for out-of-order records, missing pages,
    malformed records, missing index entries, and UNIQUE and NOT NULL
    constraint errors. If the integrity_check pragma finds problems, strings
    are returned (as multiple rows with a single column per row) which
    describe the problems. Pragma integrity_check will return at most N errors
    before the analysis quits, with N defaulting to 100. If pragma
    integrity_check finds no errors, a single row with the value 'ok' is
    returned.

PRAGMA integrity_check does not find FOREIGN KEY errors. Use the PRAGMA
foreign_key_check command for to find errors in FOREIGN KEY constraints.

See also the PRAGMA quick_check command which does most of the checking of
PRAGMA integrity_check but runs much faster.

sqlite-tools-linux-x86-3140200/sqlite3 PCAT.DB.courrpted 'PRAGMA integrity_check'
wrong # of entries in index sqlite_autoindex_BOOKING_INFO_2
wrong # of entries in index I_BJ_BS
wrong # of entries in index I_BJ_RS

sqlite-tools-linux-x86-3140200/sqlite3 PCAT.DB.clean 'PRAGMA integrity_check'
ok

note:
Do not use sqlite3 PCAT.DB 'PRAGMA quick_check'


<pcat-recovery>
/**  @brief Get the dirty flag.
  *  @param[out] isDirty If true, a data cleanup operation is required.
  *  @retval #PDM_FS_STATUS_OK
  *  @retval #PDM_FS_STATUS_FAILURE
  *  @pre PDM_FS Interface must be initialised.
  *  This method is blocking.
  */
SYSTEM_STATUS PDM_FS_GetDirtyFlag(bool *isDirty);

// use stat = PDM_FS_GetDirtyFlag(&isDirty);
!MIL    -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_BootingUp) L:387 > PDM_FS_GetDirtyFlag: pdm_status = 0x12c02000  
!MIL    -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_BootingUp) L:391 > Performing MSM Reboot Recovery (MFS) 
!FATAL  -DBENGINE_SRV 		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:dbengine_api.c F:DBENGINE_API_GetErrcode__ L:1612 > status = 0x203000b 
!ERROR  -DBENGINE_SRV 		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:dbengine_api.c F:DBENGINE_API_Step_ L:1922 > execution error: status =0x203000b\n 
!FATAL  -DBENGINE_SRV 		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:dbengine_api.c F:DBENGINE_API_GetErrcode__ L:1612 > status = 0x203000b 
!ERROR  -DBENGINE_SRV 		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:dbengine_api.c F:DBENGINE_API_Reset_ L:2227 > execution error: status =0x203000b\n 
!ERROR  -MSM_MFS      		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:mfs_storage_wrapper.c F:(CheckForNotOkSystemStatus) L:6657 > DBENGINE_API_Reset returned 0x203000b: database disk image is malformed 
!ERROR  -MSM_MFS      		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:mfs_storage_wrapper.c F:(CheckForNotOkSystemStatus) L:6657 > MFSDBWRAP_ResetFinalize MFS_GET_VFILE_DATA_OF_SHREC returned 0x203000b: database disk image is malformed 
!WARN   -MSM_MFS      		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:mfs_storage.c F:(MFS_STORAGE_GetShrecVfiles) L:2170 > MFS_STORAGE_WRAPPER_GetShrecVfiles failed for shrecId=0xbfbb 
!ERROR  -MSM_MFS      		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:mfs_reboot.c F:(MFSREBOOT_CheckShrec) L:1047 > MFS_STORAGE_GetShrecVfiles failed: dbConId=0, shrecId=0xbfbb, numVfiles=0 ! 
!MIL    -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_BootingUp) L:399 > Performing MSM Reboot Recovery (MDI) 
!WARN   -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_RunLevelRequest2) L:252 > Completed MSM shutdown/bootup status=5801000 
!MIL    -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_RunLevelRequest2) L:259 > MSM Is Ready 
!MIL    -MSM          		< p:0x000001ef P:MW t:0x0188a520 T:MSMDispatcher M:msm_init.c F:(MSM_RunLevelRequest2) L:264 > MSM succeeded to move to the new run level 4, going to notify SYSINIT_RunLevelRequest 4 

// use stat = PDM_FS_GetDirtyFlag(&isDirty);
2733:NDS: ^[2016:08:15 20:06:25]0946684974.805983 !WARN   -PCATS                        < p:0x000001ef P:MW t:0x01a9c520 T:PCAT_SRV_SYSINIT_THREAD M:dbview.c F:Dbview_PVR_InitDb L:1898 > num_external_disk=0,isDirtyShutdown = 1 ,dbview_conf = 2
2752:NDS: ^[2016:08:15 20:06:26]0946684975.351336 !WARN   -PCATS                        < p:0x000001ef P:MW t:0x01a9c520 T:PCAT_SRV_SYSINIT_THREAD M:dbview.c F:Dbview_PVR_InitDb L:1930 > isDirtyShutdown = 1, p_is_empty_db = 0

// use stat = PDM_FS_GetDirtyFlag(&isDirty);
// if it fails, SBM fails to boot up

2795:NDS: ^[2016:08:15 20:06:28]0946684977.460730 !MIL    -VRM_SERVER                   < p:0x000001ef P:MW t:0x01cb8520 T:VRM_SRV M:vrm_recoverer.c F:VRM_RECOVERER_Init L:720 > Dirty flag [1]
2767 NDS: ^[2016:10:11 12:11:36]0946684971.317275 !ERROR  -VRM_SERVER                < p:0x000001e3 P:MW t:0x01cae520 T:VRM_SRV M:vrm_pcat.c F:VRM_PCAT_Cleanup L:916 > error was encountered during VRM_PCAT cleanup process, stat=0xb420001\n

// stat = VRMRecovererCleanup();
// SYSTEM_STATUS VRM_PCAT_Cleanup(void);


{pcat-journal}
SQLite will attempt to recover if the box was rebooted while a transaction was
in progress.  It's *really* important we know whether this has happened or
not. Basically if the first few bytes of the DBJ file is zeroes, then there's
no transaction to be rolled back.  If they're non-zero, then there was likely
a hard reboot, and it will attempt a rollback that may or may not be
successful. 

https://www.sqlite.org/howtocorrupt.html
1.3. Deleting a hot journal

SQLite normally stores all content in a single disk file. However, while
performing a transaction, information necessary to roll back that transaction
following a crash or power failure is stored in auxiliary journal files. These
journal files have the same name as the original database file with the
addition of -journal or -wal suffix.

SQLite must see the journal files in order to recover from a crash or power
failure. If the journal files are moved, deleted, or renamed after a crash or
power failure, then automatic recovery will not work and the database may go
corrupt.


<rollback-mode>

// <dbengine.cfg>

[DBENGINE_JOURNAL]
DBENGINE_JOURNAL_MODE="PERSIST"

// https://www.sqlite.org/isolation.html

SQLite implements isolation and concurrency control (and atomicity) using
transient journal files that appear in the same directory in as the database
file. There are two major "journal modes". The older "rollback mode"
corresponds to using the "DELETE", "PERSIST", or "TRUNCATE" options to the
journal_mode pragma. In rollback mode, changes are written directly into the
database file, while simultaneously a separate rollback journal file is
constructed that is able to restore the database to its original state if the
transaction rolls back. Rollback mode (specifically DELETE mode, meaning that
    the rollback journal is deleted from disk at the conclusion of each
    transaction) is the current default behavior. 

// dbe_interface/dbengine_api.c
//
// static SYSTEM_STATUS ApplyDefaultPragmas(DBENGINE_API_DbContext *pDbContext)
//		(void)snprintf(temp_buf, sizeof(temp_buf), "PRAGMA journal_mode = %s", g_DBENGINE_Conf.DbenginejournalMode);


<pcat-check>

1.

sqlite3 PCAT.DB.courrpted "pragma integrity_check"
*** in database main ***
On page 55 at right child: invalid page number 712
Error: database disk image is malformed

boots up, get TF when goes to planner. no DBJ made.

		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(NONE)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(false)
						.actions(BACKUP_IGNORE)));

		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_MODAL_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(BACKUP_TO_CANCEL)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(true)
						.actions(BACKUP_BACKUP)));

2.  

sqlite3 PCAT.DB.courrpted "pragma integrity_check"

wrong # of entries in index sqlite_autoindex_BOOKING_INFO_2
wrong # of entries in index sqlite_autoindex_BOOKING_INFO_1
wrong # of entries in index I_BJ_BS
wrong # of entries in index I_BJ_TT_BT
wrong # of entries in index I_DEL_BJ
wrong # of entries in index I_BJ_RS
wrong # of entries in index I_BJ_BI

boot up, DBJ made, init diaglog when goes to planner


3. R.Tinter
kyoupark@ukstbuild2:~/si_logs$ sqlite3 PCAT.DB.RTiner "pragma integrity_check"
wrong # of entries in index I_SI_EVENT
wrong # of entries in index sqlite_autoindex_SHREC_ITEMS_2
wrong # of entries in index sqlite_autoindex_SHREC_ITEMS_1
rowid 570948264 missing from index I_IT_CU
rowid 570948264 missing from index I_IT_PP
rowid 570948264 missing from index I_IT_SERIES
rowid 570948264 missing from index I_IT_EN
rowid 570948264 missing from index I_IT_DU
rowid 570948264 missing from index I_IT_SL
rowid 570948264 missing from index I_IT_ST
rowid 570948271 missing from index I_IT_CU
rowid 570948271 missing from index I_IT_PP
rowid 570948271 missing from index I_IT_SERIES
rowid 570948271 missing from index I_IT_EN
rowid 570948271 missing from index I_IT_DU
rowid 570948271 missing from index I_IT_SL
rowid 570948271 missing from index I_IT_ST

boot up, DBJ made, okay when goes to planner


={============================================================================
|kt_dev_si_0001| comp-fdm

mock/makefile
28:ORIG_COMPONENT_NAME :=fdm

https://cisco.jiveon.com/groups/fusion-carousel-subsystem-guild

// CMS_INFORMATION_SERVICES/FDM/src/fdm_api/fdm_api_optv/src/fdm_api_optv.c

#define FDM_API_OPTV_SEGNAME		"FDM_API_OPTV"

    /* Register DIAG trace segment */
    if (!SYSTEM_STATUS_IS_OK
            (DIAG_LOG_RegisterTraceSegment
             (FDM_API_OPTV_SEGNAME, FDM_API_OPTV_SEGNAME_LEN, NULL, &g_optv_segid)))


FDM_SVR is the FDM server module which is responsible for managing the mount
point of the broadcast file system

Note that DSM-CC carousels are packaged such that more than one file may be
resident in a module, and so acquiring a single file actually entails
acquiring a module.

// seems benign since calls these all jobs created. no seen on live since optv
// runs on only live so no warning for that.
!WARN   -FDM_CMN_CLT  		< p:0x0000026a P:MW t:0x01d95520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Run L:427 > media connection type is not supported 
!WARN   -FDM_CMN_CLT  		< p:0x0000026a P:MW t:0x01d95520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_mhc.c F:FDM_MHC_Run L:863 > FDM_MHC_Run hMC=0x6 type:[117440515] 


#define MAX_L_MEDIA_CONNECTIONS     (10)  /* For all type of media connections for GW and MR boxes */

NDS: ^[2017:10:19 09:20:02]0946759746.727261 !ERROR  -FDM_SVR      		< p:0x000001ed P:MW t:0x01d42520 T:MCM_ITCMAIN_THREAD M:fdm_svr_sfm.c F:FDM_SVR_SetSfMediaConnection L:183 > No free slot to store media connection; 
NDS: ^[2017:10:19 09:20:02]0946759746.727277 !ERROR  -FDM_CMN_CLT  		< p:0x000001ed P:MW t:0x01d42520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Run L:461 > FDM_SVR_SetSfMediaConnection failed 
NDS: ^[2017:10:19 09:20:02]0946759746.727295 !WARN   -FDM_CMN_CLT  		< p:0x000001ed P:MW t:0x01d42520 T:MCM_ITCMAIN_THREAD M:fdm_plugin.c F:FDM_PLUGIN_Run L:595 > Run_cb() has failed for plugin Open TV\n 
NDS: ^[2017:10:19 09:20:02]0946759746.727313 !WARN   -FDM_CMN_CLT  		< p:0x000001ed P:MW t:0x01d42520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_mhc.c F:FDM_MHC_Run L:863 > FDM_MHC_Run hMC=0x3806 type:[117440514] 

CMS_MEDIA_SERVICES/MCM/src/mcm_mediaconn_event.c

/* @brief Array of function pointers to DEVICEMAN open interfaces for each component */
static COMP_DEVICEMAN_Open f_mcm_comp_deviceman_open[] =
{
    FEM_DEVICEMAN_Open,
    MPM_DEVICEMAN_Open,
    SIM_DEVICEMAN_Open,
    NULL,
    NULL,
    FDM_DEVICEMAN_Open,
    SDM_DEVICEMAN_Open,
#ifdef FUSION_DYNAMIC_TSA_SUPPORTED
    ASM_DEVICEMAN_Open,
#else
    NULL,
#endif
    /* Last entry in array is always NULL... */
    NULL
};

SYSTEM_STATUS FDM_DEVICEMAN_Open(MCM_MEDIACONN_HANDLE h_media_connection,

FDM_PLUGIN_Open

SYSTEM_STATUS FDM_OPTV_Run(FDM_MC *pMc)
{
  if((FDM_SVR_SetSfMediaConnection(pMc->handle) != FDM_STATUS_OK));

  /* SFM SESSION creation */
  DBUG_PRINT("FDM_OPTV_Run",
      ("new SFM session created handle = %#x", pMc->sfm_handle));

}

!MIL    -MCM          		< p:0x000001f9 P:MW t:0x01dcd520 T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_CreateEx L:275 > @@PMON@@,trace,mediacon,mc-create,4,mc-create-mcid=,4,mc_create-str=,mc-live,fsnfmt=,hMC=0x4 
!MIL    -MDM          		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3241 > mdm_handle =0x3 hMC=0x3 tuner_id =0 and job_type =LIVE_VIEWING 
!MIL    -MDM          		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3241 > mdm_handle =0x2 hMC=0x2 tuner_id =1 and job_type =CAPTURE 
!MIL    -MDM          		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:mdm_connection.c F:MDM_TunerStatusPrint L:3241 > mdm_handle =0x5 hMC=0x4 tuner_id =0 and job_type =LIVE_VIEWING 
!MIL    -MPM          		< p:0x000001f9 P:MW t:0x018ce520 T:MPM_ITCMAIN_THREAD M:mpm_mediaconn_event.c F:MPM_Mediaconn_Open L:951 > MCM_MEDIACONN_STATE_OPENED hMC=0x4 replace hMC=0x3 type=0x07000002 
!INFO   -FDM_SVR      		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_svr_deviceman.c F:FDM_DEVICEMAN_Open L:904 > mediaconn 0x4, mc_type = MCM_MEDIACONN_TYPE_LIVEVIEWING, locator_type = SYSTEMLOCATOR_TYPE_SERVICE 
!INFO   -FDM_SVR      		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_svr_deviceman.c F:FDM_DEVICEMAN_Open L:944 > Reset num_plugin_stopped to 0, mc_type=117440514(LIVEVIEWING) 
!INFO   -FDM_SVR      		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_svr_deviceman.c F:FDM_DEVICEMAN_Open L:950 > mediaconn = 0x4 (state = FDM_MC_INITIAL_S) 
!INFO   -FDM_CMN_CLT  		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Open L:388 > hMC=0x4 type:[0x7000002] 
!INFO   -FDM_CMN_CLT  		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Open L:405 > source locator - 0x8c18061 (0x4018017), dest locator = 0x8e1801f (0x42180ec) 

SYSTEM_STATUS FDM_OPTV_Close(FDM_MC *pMc)
{
  FDM_SVR_ResetSfSessionInfoByMcHandle(MCM_MEDIACONN_HANDLE mc_handle);
}

!MIL    -MCM          		< p:0x000001f9 P:MW t:0x01dcd520 T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:660 > @@PMON@@,trace,mediacon,mc-destroy,3,fsnfmt=,hMC=0x3 
!INFO   -FDM_SVR      		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_svr_deviceman.c F:FDM_DEVICEMAN_Close L:1201 > mediaconn = 0x3 (state = FDM_MC_STOPPED_S) 
!INFO   -FDM_CMN_CLT  		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Close L:940 > Mark for unmount comp_id 0xd0401 (hMC=0x3) 
!INFO   -FDM_CMN_CLT  		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_ProcessESI L:1426 > Trying to unmount OPTV carousel with component id = 0xd0401 (hMC=0x3) 
!INFO   -FDM_CMN_CLT  		< p:0x000001f9 P:MW t:0x01d9d520 T:MCM_ITCMAIN_THREAD M:fdm_plugin_optv.c F:FDM_OPTV_Close L:1008 > ESI List is not Empty; dont reset now! 
!MIL    -MCM          		< p:0x000001f9 P:MW t:0x01dcd520 T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:729 > @@PMON@@,trace,mediacon,mc-destroyed,3,fsnfmt=,hMC=0x3 


={============================================================================
|kt_dev_si_0001| comp-pshed

#-----------------------------------------------------------
# diag and debug build
#-----------------------------------------------------------
NDS_BUILD_TYPE_psched = debug
TRACE_LEVEL_PSCHED="AFEWM"


#
# REMINDER BOOKING
#

# !MIL   -PCATS        < M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:02814 > client id = 0x4,bookingJobID = 0x29000096
# PLANNER_DBINTERFACE_Notify_ViewChange:
# !INFO  -P_Planner    < M:planner_job.c F:PLANNER_JOB_CheckForEndOfJob L:00205 > Insert of current reminder booking: end of job

SrmJobRegisterScheduler
{
        psched_info.view_spec = view_spec;
        psched_info.update_prop_list=psched_prop_list;
        psched_info.update_prop_list_size = LIST_PROP_NUM(psched_prop_list);
        psched_info.schedule_time_prop=(PCAT_VIEW_PROP)PCAT_CAT_PROP_TRIGGER_TIME;
        psched_info.flag_to_set_on_schedule= (PCAT_VIEW_PROP)PCAT_CAT_PROP_IS_SCHEDULED;
        psched_info.schedule_flag_object_type = (PCAT_VIEW_OBJECT_TYPE)PCAT_CAT_OBJECT_TYPE_BOOKING_JOB;

        stat = PSCHED_SCHEDULING_SchedulerRegister(&psched_info, SrmJobPschedSchedulerCallback, 0u, pPschedJobId);
}


PSCHED_SCHEDULING_SchedulerRegister(const PSCHED_SCHEDULING_PCAT_INFO *pcat_info, PSCHED_SCHEDULING_CALLBACK callback, user_data, *jobid )
{
  PSCHED_SCHED_InitPCAT
  {
    # set 'prop id' to use as a triggering event.
    # define        PCAT_CAT_PROP_TRIGGER_TIME(5)
    gPschedInfo[idx].schedule_time_prop = pcat_info->schedule_time_prop;

    # flag prop id to use when it's triggered or set.
    gPschedInfo[idx].schedule_flag_prop = pcat_info->flag_to_set_on_schedule.
  }

  # check this mesg
  # DIAG_LOG_INFO(PschedDiagSegmentId,("successful initialization: jobID=0x%x, pcat_info->schedule_time_prop = %d,stat=0x%x", *jobID,pcat_info->schedule_time_prop,stat));
  send E_PSCHED_MSG_SCHEDULER_HANDLE_NEXT_EVENT
}


#
# !ENTER -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleNextEvent L:00311 > |-> PSCHED_SCHED_HandleNextEvent
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleNextEvent L:00319 > PCAT_VIEW_Select job id 0x80006,pcat_view 0x2000066,rows = 1,select_stat = 0x5c01000
# timeout is pschedGetTimeStr(sched_time)
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleNextEvent L:00365 > Top event for job id 0x80006: booking id 0x29000096, now:09:49:57, timeout:18:35:00
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleNextEvent L:00383 > Set new alarm for job id 0x80006, booking id 0x29000096, alarm handle 0x30016, returned stat = 0x10802000
#
PSCHED_SCHED_HandleNextEvent
{
  # get value of that 'prop id' and it's trigger time in this case.
  PCAT_VIEW_VLIST_GetSystemTime(value_list,1U,gPschedInfo[idx].schedule_time_prop,&sched_time);

  # set alarm
  gPschedInfo[idx].alarm_data.alarm_data.abs_info.timeout = sched_time;
  stat = SYSTEMALARM_Set(&gPschedInfo[idx].alarm_data,&gPschedInfo[idx].alarm_handle);
}


# !ENTER -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_ALARM_Callback L:00592 > |-> PSCHED_SCHED_ALARM_Callback
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_ALARM_Callback L:00596 > Alarm 0x30016 arrived, job id = 0x80006,stat = 0x7000000
PSCHED_SCHED_ALARM_Callback
  send E_PSCHED_MSG_SCHEDULER_ALARM_TIMEOUT


# !ENTER -PSCHED       < M:psched_main.c F:PschedMainMessageDispatcher L:00880 > |-> PschedMainMessageDispatcher
# !ENTER -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleAlarmTimeout L:00609 > |-> PSCHED_SCHED_HandleAlarmTimeout
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleAlarmTimeout L:00615 > PCAT_VIEW_SelectByItemID object 0x29000096,job id 0x80006, returned pcat_stat = 0x5c01000,1 rows
# !INFO  -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_HandleAlarmTimeout L:00625 > Calling callback for job id 0x80006,object 0x29000096(687866006),time now:09:49:57
# !ENTER -PSCHED       < M:psched_sched.c F:PSCHED_SCHED_UpdateIsScheduledFlag L:00727 > |-> PSCHED_SCHED_UpdateIsScheduledFlag
PSCHED_SCHED_HandleAlarmTimeout
  # call it back which was used when registered. user_data comes from a client when regiesterd.
  gPschedInfo[idx].callback(jid,vlist,gPschedInfo[idx].user_data);

  PSCHED_SCHED_UpdateIsScheduledFlag
    PCAT_VIEW_VLIST_SetBoolean(gPschedInfo[idx].schedule_flag_prop,true);
  

#  
# !MIL   -VRMS         < M:job_man_srv.c F:JobManSrvStart L:03843 > VRM_JOB_START: jtVRM=8, jhVRM=0x2000005    
#


={============================================================================
|kt_dev_si_0001| comp-pdm comp-storage

COMPONENT_NAME := pdm_srv

CO: Conduit, Patrick

<full-system-reset>
// refer WP560: full system reset
# PDM_ServerThread:PDM_SRV_EV_SHUTDOWN:
!ERROR -PDM          < M:pdm_srv_common.c F:PDM_ServerThread L:00780 > ** KT: PDM_ServerThread: Got PDM_SRV_EV_SHUT: l_data.doMarkShutdown(1)
!ERROR -PDM          < M:pdm_srv_fs_support.c F:PDM_FS_MarkCleanUnmount L:01378 > KT: PDM_FS_MarkCleanUnmount: failed flag: false exception:00000029 prev_act: 00000001
!WARN  -PDM          < M:pdm_srv_fs_support.c F:PDM_FS_MarkCleanUnmount L:01387 > not clean shutdown: failed flag: false exception:00000029 prev_act: 00000001

false exception:00000029 is: 
SYSTEM_EXCEPTION_TYPE_RESTARTED_LOCALLY,                         /*!< @brief Restarted by the EPG */

so looks like that this code block has no real use since PDM is always ended up with 'uncleaned shotdown'. do we need it?


# it don't supports run level and simply do everything at the first stage.
# Instead, use PDM_FS_NotifyStateEvent to get client notified.  therefore, if
# it failed to mount fs(xtvfs), no effect on sysint level but on functional
# level for a system.

PDM_FS_RegisterStateListener 	# for app to register state listener

# from planner_pdm.c

/* We are not interested in getting state notifications */
if (PDM_FS_STATUS_OK != PDM_FS_RegisterStateListener ((uint8_t*)PLANNER_PDM_MOUNT_POINT_PARTITION, NULL, &notify_handle))

# two clients

ERROR -SQ01         < M:sim_cache_mode_ctrl.c F:SIM_cmc_RegisterPartition L:01045 > KT: PDM_FS_RegisterStateListener(DATA): src/sim_cache_mode_ctrl.c
INFO  -PDM          < M:pdm_srv_fs.c F:PDM_FS_RegisterStateListener L:00430 > partition:DATA, listener:0xa33bd8, handle:00000004

ERROR -SPM_SERVER   < M:spm_disk.c F:SPM_DISK_Init L:00658 > KT: PDM_FS_RegisterStateListener(RECORDING): spm_disk.c
INFO  -PDM          < M:pdm_srv_fs.c F:PDM_FS_RegisterStateListener L:00430 > partition:RECORDING, listener:0xb561e8, handle:00000007


PDM_FS_PartitionMount			# for app to mount

// FUSIONOS/FOS_INC/nds/xstore.h
/*
FOS Helper Issue 18
*/

/*
FOS header file for the storage helper.
This file is immutable. Do not edit.
*/
// FUSIONOS/STORAGE_HELPER/src/storage_helper/src/storage_partition_format_usage_lnx.c
int32_t xstore_mount_partition(const XStoreMountPoint mountPoint,
                               const XStorePartitionInfo * const partitionInfo,
                               const uint32_t mountFlags,
                               const void * const mountData);


# PDM_ORIGINAL_PARTITION_TABLE_SECTOR (0)
# PDM_BACKUP_PARTITION_TABLE_SECTOR (32)
PDM_FS_BackupPartitionTable


PDM_FS_InitAllowedDiskSizes


<log>
To mound /dev/sda

!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_thread.c F:PDM_FS_ThreadDeviceStateAction L:3049 > device: /dev/sda  mounting 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_support.c F:PDM_FS_NotifyDeviceEvent L:1452 > notifyHandle 0x000c0000 listener 0x0x412678 devicehandle 00000007 event PDM_FS_DeviceEventMountingStart(4) isPrimary: true 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_support.c F:PDM_CLIINT_FSDiskEventCb L:2792 > Send: event=PDM_IPC_EV_FS_DISK_EVENT_NFY func=PDM_CLIINT_FSDiskEventCb 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevMatchAllPartitions L:1380 > /dev/sda1 numSectors=0x0e8e035c0 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevCalculateSectors L:448 > usable sectors of device is 00000000e8e03600 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevCalculateSectors L:454 > percentage 08.00 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevCalculateSectors L:455 > desired part size is thus [2016:08:30 13:32:36]0000000012a14c00 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevCalculateSectors L:462 > usable part size is thus [2016:08:30 13:32:36]0000000012a14c00 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevMatchAllPartitions L:1419 > matching part RECORDING  type 01 XSTORE_FS_XTV numsectors 0x[2016:08:30 13:32:36]0000000012a14bc0 to shDeviceName /dev/sda 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevMatchAllPartitions L:1426 > pctMinSize 0x[2016:08:30 13:32:36]0000000012a14bc0 absMinSize 0x0000000000000000 absMaxSize 0x0000000000000000 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevMatchAllPartitions L:1439 > try to match with existing part /dev/sda1 on dev /dev/sda type 01 XSTORE_FS_XTV numsectors 0x00000000e8e035c0 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_DevMatchAllPartitions L:1490 > physical partition /dev/sda1 matched to expected partition RECORDING 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_CreateDirectory L:1899 > dir_path=/mnt/nds/dev_7 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_CreateDirectory L:1899 > dir_path=/mnt/nds/dev_7/part_0 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_support.c F:PDM_FS_PartitionMountWithRecovery L:2517 > tryMount=1 recoveryStep=4 features=0 
!INFO   -PDM_FS       		< P:STM T:PDM_FS M:pdm_srv_fs_support.c F:PDM_FS_PartitionMount L:2382 > mounting /dev/sda1 (flags: READWRITE) g_pdm_fs_shFeatures=0x1d875600 extVersion=2 features=0x0 md=0x0 


<comp-frontpanel> <comp-led> <comp-standby>

// CMS_SYSTEM_RESOURCE/PDM/src/server/mw/pdm_srv_fp_support.c

/**  @brief      Set the state and luminosity of a simple indicator.
  *  @param[in]  handle Handle to the indicator.
  *  @param[in]  state The state to set.
  *  @param[in]  luminosity Luminosity value, in the range 0 to 100.
  *  @retval     returns #PDM_FP_STATUS_OK if successful, otherwise an error
  *              status.
  *
  *  This can be used to set the basic states of all supported indicators, with
  *  the #PDM_FD_ALL_INDICATORS handle.
  *
  *  Pattern inidciators should use #PDM_FP_StartPattern.
  */
SYSTEM_STATUS PDM_FP_SetState(PDM_FP_HANDLE handle, PDM_FP_STATE state, uint32_t luminosity);


// DIAG_LOG_MIL(g_pdm_diag_segment_id, ("PDM_FP_SetState handle=0x%x state=0x%x",handle, state));


/** @brief An enumeration used to indicate which state of the current indicator. In the start-up,
  * all indicators shall be set to #PDM_FP_STATE_OFF. Note that some values are only valid for
  * certain indicators.
  */
typedef enum PDM_FP_STATE_Tag
{
    PDM_FP_STATE_UNDEF = 0U,
    PDM_FP_STATE_ON,
    PDM_FP_STATE_OFF,     // 2
    PDM_FP_STATE_RED,
    PDM_FP_STATE_GREEN,   // 4
    PDM_FP_STATE_ORANGE,
    PDM_FP_STATE_BLUE,
    PDM_FP_STATE_AMBER,   // 7
    PDM_FP_STATE_YELLOW,
    PDM_FP_STATE_WHITE,
    PDM_FP_STATE_LASTVALUE
} PDM_FP_STATE;


// *TN* handle is important.
// PDM_FP_STATE_AMBER,   // 7
300:NDS: ^[2018:03:19 05:47:47]0000000069.619526 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x4 state=0x7 
301:NDS: ^[2018:03:19 05:47:47]0000000069.619548 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x6 state=0x2 

// out of standby
20709:NDS: ^[2018:03:19 07:49:55]0000007397.181230 !MIL    -HAM          		< p:0x000009ab P:APP t:0xa57ff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(STANDBY)e000('standby') sent to 'com.bskyb.epgui'
// PDM_FP_STATE_GREEN,   // 4
20796:NDS: ^[2018:03:19 07:49:55]0000007397.508592 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x4 state=0x4 

20797:NDS: ^[2018:03:19 07:49:55]0000007397.508623 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x6 state=0x2 
22090:NDS: ^[2018:03:19 07:49:59]0000007401.151872 !MIL    -MPM          		< p:0x000009aa P:MW t:0xb6429450 T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1376 > FRAME_PRESENTED: hMC=0x6 
22092:NDS: ^[2018:03:19 07:49:59]0000007401.162111 !MIL    -P_Api        		< p:0x000009ab P:APP t:0xb5cd11d0 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1176 > VIDEO IS SHOWN 
22093:NDS: ^[2018:03:19 07:49:59]0000007401.162194 !MIL    -P_Api        		< p:0x000009ab P:APP t:0xb5cd11d0 T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9010 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=RUNNING 

// to standby
54706:NDS: ^[2018:03:19 11:31:49]0000020711.670177 !MIL    -HAM          		< p:0x000009ab P:APP t:0xa57ff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(STANDBY)e000('standby') sent to 'com.bskyb.epgui'
// PDM_FP_STATE_AMBER,   // 7
54739:NDS: ^[2018:03:19 11:31:49]0000020711.739087 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x4 state=0x7 
54740:NDS: ^[2018:03:19 11:31:49]0000020711.739113 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x6 state=0x2 
54741:NDS: ^[2018:03:19 11:31:49]0000020711.739278 !MIL    -AMS          		< p:0x000009aa P:MW t:0xb61e0450 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleLiveEvents L:79 > STANDBY_IN event 

55059:NDS: ^[2018:03:19 11:31:50]0000020712.893781 !MIL    -P_Api        		< p:0x000009ab P:APP t:0xb5cd11d0 T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1180 > VIDEO IS HIDDEN 

// out of standby
55297:NDS: ^[2018:03:19 11:32:17]0000020739.108609 !MIL    -HAM          		< p:0x000009ab P:APP t:0xa57ff1d0 T:no name M:hamiltron-client.c F:hamiltron_client_send_key_event L:859 > KEY_PRESS: code=0x(STANDBY)e000('standby') sent to 'com.bskyb.epgui'
// PDM_FP_STATE_GREEN,   // 4
55353:NDS: ^[2018:03:19 11:32:17]0000020739.319866 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x4 state=0x4 
55354:NDS: ^[2018:03:19 11:32:17]0000020739.319898 !MIL    -PDM_MW       		< p:0x000009aa P:MW t:0xb6308450 T:PREFS_PTHREAD M:pdm_srv_fp_support.c F:PDM_FP_SetState L:1084 > PDM_FP_SetState handle=0x6 state=0x2 
55356:NDS: ^[2018:03:19 11:32:17]0000020739.321815 !MIL    -AMS          		< p:0x000009aa P:MW t:0xb61e0450 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleLiveEvents L:83 > STANDBY_OUT event 


={============================================================================
|kt_dev_si_0001| comp-disk-check

2. badblocks -nsv /dev/sda

-sh-3.2# badblocks -h
badblocks: option requires an argument -- h
Usage: badblocks [-b block_size] [-i input_file] [-o output_file] [-svwnf]
 [-c blocks_at_once] [-p num_passes] [-t test_pattern [-t test_pattern [...]]]
 device [last_block [start_block]]

https://wiki.archlinux.org/index.php/badblocks

NOTE: Do not select write in case of badblocks testing ... it may overwrite
the HDD contents.

<comp-smartctl>


={============================================================================
|kt_dev_si_0001| comp-player

# contacts
Tony Palmer, David Gilson, Laurent, Rémi; Lengronne, Fabien  

# diag and debug build
"P_Api"
"P_ApiD"

# COMPONENT_NAME := darwin_player_src
NDS_BUILD_TYPE_darwin_player_src = debug

# where
/darwin_platform_components/darwin_player/src/makefile


<vtable>
// user uses
PLAYER_VTABLE_Create(&(g_player_component.contexts), (void**)&l_sc_data,
  &l_sc_id,
  sizeof(PLAYER_SERVICE_CONTEXT_DATA));

// mapping. create `node` and `element` as well.
#define PLAYER_VTABLE_Create(w,x,y,z) PLAYER_VTABLE_CreateNode(w,x,y,z,__FILE__,__LINE__)
#define PLAYER_VTABLE_Create(w,x,y,z) PLAYER_VTABLE_CreateNode(w,x,y,z)

// no mapping and delete node using ref count. inc ref
PLAYER_VTABLE_ReleaseElement

// only where increase ref count. dec ref.
PLAYER_VTABLE_GetElement

// no mapping and delete node w/o using ref count
PLAYER_VTABLE_DeleteElement


<vtable-client>
The client is responsible to match up Release/GetElement pair.

PLAYER_Context_GetContextFromSession() do GetElement(context vtable) inside so
have to ReleaseElement after this call.


<vtable-dump>
note:
1. not defined by default
2. not useful to pair up where it's created and released.

#ifdef PLAYER_VTABLE_LEAK_DETECTION
#ifdef PLAYER_DUMP_VTABLES

static void PLAYER_DumpVtables(void)
{
  // uses vtable pointer for each vtable
  // static void PLAYER_VTABLE_DumpTable(const PLAYER_VTable_t* vtable)

  PLAYER_VTABLE_DumpTable(&(g_player_component.list_array));
  {
    PLAYER_VTNode_t     *curNode = NULL;
    DIAG_DECLARE_FUNCTION("PLAYER_VTABLE_DumpTable");

    DIAG_LOG_WARN(g_player_api_diag_segment_id, ("vtable 0x%x",vtable ));

    while ((curNode = GetNextNode(vtable, curNode)) != NULL )
    {
      DIAG_LOG_WARN(g_player_api_diag_segment_id, 
          ("thread %s file:%s L:%i, handle 0x%x, el 0x%x, refCount %i",
            curNode->thread,
            curNode->file,
            curNode->line,
            curNode->handle,
            curNode->elPointer,
            curNode->refCount));
    }
  }
  ...
}

This prints out all nodes in the vtable with filename where it's created:
where CreateNode() is called.

For session, there can be as many as sessions which APP can create.

F:PLAYER_DumpVtables L:1428 > sessions 
F:PLAYER_VTABLE_DumpTable L:1399 > vtable 0x1070d04 
F:PLAYER_VTABLE_DumpTable L:1409 > thread no name file:player_api.c L:169, handle 0x4, el 0x15b2c1c, refCount 1 
F:PLAYER_VTABLE_DumpTable L:1409 > thread no name file:player_api.c L:169, handle 0x3, el 0x15a0d34, refCount 1 
F:PLAYER_VTABLE_DumpTable L:1409 > thread LAE_THREAD file:player_api.c L:169, handle 0x2, el 0x1500954, refCount 1 
F:PLAYER_VTABLE_DumpTable L:1409 > thread AEM_INPUT_MONITOR_THREAD file:player_api.c L:169, handle 0x1, el 0x1467fec, refCount 1 

F:PLAYER_DumpVtables L:1419 > ** SI-10654 : KIT: dump vt contexts ** 
F:PLAYER_VTABLE_DumpTable L:1399 > vtable 0x1070d58 
F:PLAYER_VTABLE_DumpTable L:1409 > thread PLAYER_MAIN file:player_api_context.c L:113, handle 0x2, el 0x12af01c, refCount 1 
F:PLAYER_VTABLE_DumpTable L:1409 > thread PLAYER_MAIN file:player_api_context.c L:113, handle 0x1, el 0x128d024, refCount 5 


note:
Upon component initialization, the vtable gets initialized using unique id and
then use PLAYER_VTABLE_Create to create a node.

Therefore, when see the log like these, can figure out which vtable which is
talking about.

DIAG_LOG_FATAL(vtable->diagSegment, ("Leak detected in ref for VTable %u (ref count %u)",
  vtable->id, node->refCount));


// global which has lots of vtables
PLAYER_COMPONENT_OBJECT_DATA g_player_component;
{
  PLAYER_VTable_t         list_array;     /** Array of client requested lists */
  PLAYER_VTable_t         ca_listeners;   /** Linked list of CA listeners */

  // #define PLAYER_VTABLE_ID_CONTEXTS (25U)
  PLAYER_VTable_t         contexts;                   /** List of service contexts */
  ...
}


// uses `vtable ids`

PLAYER_VTABLE_InitTable(&(g_player_component.list_array),
  g_player_mem_pool,
  g_player_diag_detailed_segment_id,
  NULL,
  100,
  PLAYER_VTABLE_ID_LISTS));
...

// defines `vtable ids`
//
// src/inc/player_vtable.h
/* Identifiers of the vtables used in Player.  These are used for diagnostic
 * output */
#define PLAYER_VTABLE_ID_LISTS (1U)
#define PLAYER_VTABLE_ID_CA_LNRS (2U)
...


<comp-player-status>
0x6801001   // PLAYER_API_STATUS_PENDING
              (PLAYER_COMP_ID, PLAYER_API_ID,SEVERITY_NONE,1)

0x6821001   // PLAYER_API_STATUS_FAILURE 
              ((PLAYER_COMP_ID, PLAYER_API_ID, SEVERITY_SEVERE,1))


#define PLAYER_COMP_ID        (26)
#define SEVERITY_NONE         (0)
#define SEVERITY_SEVERE       (0x2))
#define PLAYER_API_ID         (1)
            
(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )

#define PLAYER_API_STATUS_PENDING (SYSTEM_MAKE_COMPONENT_STATUS(PLAYER_COMP_ID, PLAYER_API_ID,SEVERITY_NONE,1))

0x6801001
  hex(((26 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((1 & 0xF) << 12) | (1 & 0xFFF) )

0x6821001
  hex(((26 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (1 & 0xFFF) )


<fsm> state machine

# player_statetable.c
# g_PLAYER_VRM_State_Table, PLAYER_FindStateFunction in MessageThread

const char* PLAYER_JOB_STATE _STR[] =
{
  "PLAYER_STATE_IDLE",                        // 0
    "PLAYER_STATE_AWAITING_READY",            // 1
    "PLAYER_STATE_AWAITING_PIN",              // 2
    "PLAYER_STATE_AWAITING_CREATE",           // 3
    "PLAYER_STATE_AWAITING_CONFLICT_CHECK",   // 4
    "PLAYER_STATE_AWAITING_COMMIT",           // 5
    "PLAYER_STATE_AWAITING_SCI",              // 6
    "PLAYER_STATE_AWAITING_START",            // 7
    "PLAYER_STATE_RUNNING",                   // 8
    "PLAYER_STATE_AWAITING_STOP",             // 9
    "LAYER_STATE_AWAITING_DESTROY",           // 10
};


# file:///C:/ktpark/NDSUK/kb/fusion/component/javadoc/com/nds/fusion/playerimpl/PlayerEventImpl.html
#
# in case of successful tune (after receiving PlayerEventSessionStart) 
# Based on the fact that player sends PLAYER_EVENT_SESSION_FAIL for certain
# cases where the tune request fails, I would recommend that Picasso treats

const char* PLAYER_EVENT_MSG _STR[] =
{
    "PLAYER_EVT_IDLE",
    "PLAYER_EVT_SLOT_READY",
    "PLAYER_EVT_PIN_REEVALUATE",
    "PLAYER_EVT_JOB_CREATED",
    "PLAYER_EVT_JOB_COMMITTED",
    "PLAYER_EVT_JOB_STARTED",                 // 5
    "PLAYER_EVT_JOB_STOPPED",
    "PLAYER_EVT_JOB_DESTROYED",
    "PLAYER_EVT_JOB_FAILED",
    "PLAYER_EVT_SSI",
    "PLAYER_EVT_NSI",                         // 10
    "PLAYER_EVT_SCI",
    "PLAYER_EVT_SEI",
    "PLAYER_EVT_SAI",
    "PLAYER_EVT_CASI",
    "PLAYER_EVT_VSI",                         // 15
    "PLAYER_EVT_ASI",
    "PLAYER_EVT_MSSI",
    "PLAYER_EVT_NEW_SPEED",
    "PLAYER_EVT_NEW_POSITION",
    "PLAYER_EVT_NEW_EIT",                     // 20
    "PLAYER_EVT_NEW_SERVICE",
    "PLAYER_EVT_NEW_CGMSA",
    "PLAYER_EVT_EOCI",
    "PLAYER_EVT_MEDIA_SELECTED",
    "PLAYER_EVT_DEFAULT_MEDIA_SELECTED",      // 25
    "PLAYER_EVT_NEW_LIVE",
    "PLAYER_EVT_TTSI",
    "PLAYER_EVT_STSI",
    "PLAYER_EVT_TERMINATE",
    "PLAYER_EVT_ASYNC_ACTIVE",                // 30
    "PLAYER_EVT_OTVCSI",
    "PLAYER_EVT_MHCSI",
    "PLAYER_EVT_CONFLICT_CHECK",
    "PLAYER_EVT_RB",
    "PLAYER_EVT_IL",                          // 35
    "PLAYER_EVT_REC_RB_ALARM",
    "PLAYER_EVT_INSTRUCTION",
    "PLAYER_EVT_UI_PREFS_UPDATE",
    "PLAYER_EVT_CONTEXT_UI_PREFS_UPDATE",
    "PLAYER_EVT_PLAYBACK_INTERRUPTED",        // 40
    "PLAYER_EVT_RESET_THRESHOLD_ALARM",
    "PLAYER_EVT_OPTV_CAROUSEL",
    "PLAYER_EVT_PREFS_UPDATE",
    "PLAYER_EVT_PREFS_HDMI_STATE_UPDATE",
    "PLAYER_EVT_SYSTEMALARM_HDMI_BLANK",      // 45
    "PLAYER_EVT_SYSTEMTIME_CALLBACK",
    "PLAYER_EVT_MOVE_TO_NEXT_CA_COND",
    "PLAYER_EVT_AUDIO_LOCAL_SETTINGS_UPDATE",
    "PLAYER_EVT_SUBTITLES_LOCAL_SETTINGS_UPDATE",
    "PLAYER_EVT_SYSTEM_STATE",                // 50
    "PLAYER_EVT_PREFS_SYSTEM_STATE",
    "PLAYER_EVT_SERVICE_OBJECT",
    "PLAYER_EVT_PIN_RESTRICTIONS_UPDATED",
    "PLAYER_EVT_PVR_OPERTATIONS_ALLOWED",
    "PLAYER_EVT_RUNLEVELREQUEST_SHUTDOWN_TO_INIT",  // 55
    "PLAYER_EVT_RUNLEVELREQUEST_INIT_TO_PREPARE",
    "PLAYER_EVT_RUNLEVELREQUEST_PREPARE_TO_ACTIVE",
    "PLAYER_EVT_RUNLEVELREQUEST_PREPARE_TO_STANDBY",
    "PLAYER_EVT_RUNLEVELREQUEST_ACTIVE_TO_PVR",
    "PLAYER_EVT_RUNLEVELREQUEST_ACTIVE_TO_STANDBY", // 60
    "PLAYER_EVT_RUNLEVELREQUEST_PVR_TO_ACTIVE",
    "PLAYER_EVT_RUNLEVELREQUEST_PVR_TO_STANDBY",
    "PLAYER_EVT_RUNLEVELREQUEST_STANDBY_TO_ACTIVE",
    "PLAYER_EVT_LIVE_CA_EVENT_TRANSITION",
    "PLAYER_EVT_RB_PLAYBACK_ALARM",
    "PLAYER_EVT_IL_RB_STOPPED",
#ifdef PVR_SIMPLE_REVIEW_BUFFER
    "PLAYER_EVT_NO_TRIM_PLAY_POSITION_TOO_CLOSE",
#endif
#ifdef PVR_CLASSIC_REVIEW_BUFFER
    "PLAYER_EVT_REVIEW_BUFFER_NOTIFY_SPLIT",
#endif /** PVR_SIMPLE_REVIEW_BUFFER */
    "PLAYER_EVT_RB_RECORD_NOT_STARTING",
    "PLAYER_EVT_COMPONENT_FAIL_TIMEOUT",
    "PLAYER_EVT_CURRENT_EVENT_RETRIEVED",
    "PLAYER_EVT_CURRENT_EVENT_CHANGED",
    "PLAYER_EVT_PLAY_FROM_CONTEXT",
    "PLAYER_EVT_SUBSCRIBER_CONFIG_UPDATED",
    "PLAYER_EVT_VRM_SUBSTITUTION",
    "PLAYER_EVT_OVERT_FINGER_PRINT_UPDATED",
    "PLAYER_EVT_SKIP_TO_NEXT_DRM_ACCESS",
    "PLAYER_EVT_VOD_CONNECTION_CLOSED",
    "PLAYER_EVT_VOD_ANNOUNCE",
    "PLAYER_EVT_VOD_RESPONSE",
    "PLAYER_EVT_AUDIO_SUB_OFFSET_CHANGE",
    "PLAYER_EVT_NULL"
};

# player_object.h
typedef enum
{
  PLAYER_EVT_JOB_DESTROYED,   // 7
  PLAYER_EVT_CONFLICT_CHECK,  // 35
  PLAYER_EVT_XXX,
} PLAYER_EVENT_MSG;


<player-threads>
two threads

// player_common.c
1. MessageThread(g_player_component.queue_id)
{
  l_event = (PLAYER_EVENT_MSG)l_event_id;
  else if(PLAYER_EVT_SERVICE_OBJECT == l_event)
  {
  }
  else
  {
    PLAYER_DIAG_LOG_WARN(("Unexpected event : %d", l_event));
  }
}

// STB_SW/DARWIN_PLATFORM/DARWIN_PLAYER/src/inc/player_object.h
typedef enum
{
    PLAYER_EVT_IDLE = 0U,
    PLAYER_EVT_SLOT_READY,
} PLAYER_EVENT_MSG;


#ifdef PLAYER_DEBUG_STRINGS
{
  char* l_event_name = getDebugEventName(l_event);
  l_event_name = l_event_name;
  DIAG_LOG_INFO(g_player_api_diag_segment_id, ("*** Message received (event = %s) ***", l_event_name));
}
#else
  DIAG_LOG_INFO(g_player_api_diag_segment_id, ("*** Message received (event = %d) ***", l_event));
#endif


// player_api_event.c
2. PlayerEventThread(g_player_component.event_thread.queue_id)


PlayerEventThread:

// !INFO  -P_Api        < M:player_api_events.c F:PlayerEventThread() L:01211 > *** Message received (event = 1101  : EVENT)  ***
//
// or
//
// this is self so as below, it goes to the player thread.
// !INFO  -P_Api        < M:player_api_promomodule.c F:PLAYER_PRV_PROMO_DoClientCallbacks() L:00087 > Sending event 1
// !INFO  -P_Api        < M:player_api_events.c F:PlayerEventThread() L:01194 > *** Message received (event 1104) ***

PLAYER_SM_VRM_JobStarted
{
  // *player-events* which defines events for both and app.
  //  
  // DARWIN_PLATFORM/DARWIN_PLAYER/inc/player_api_events.h
  //  
  // #define PLAYER_EVENT                                0x80000000      
  // /**< Represents all events notified by PLAYER */
  //  
  // #define PLAYER_EVENT_SESSION                        0x80100000      
  // /**< Represents all Session events notified by PLAYER */
  //
  // >>> hex(-2130706431+2**32)
  // '0x81000001'
  //
  // #define PLAYER_EVENT_SESSION_START                  0x80100001      
  // /**< Notification that a Play request has started. @see #PLAYER_EVENT_Session_Start_PropId */
  
  #define PLAYER_EVENT_RB_START                       0x84000001      /**< Notification of a new Review Buffer starting. @see #PLAYER_EVENT_RB_Start_PropId */
  >>> -2080374783+2**32
  2214592513L
  '0x84000001L'

  // ...
  //  
  // #define PLAYER_EVENT_CONNECTION                     0x80800000      
  // /**< Represents all Connection events notified by PLAYER */
  //
  // /** This is the base class for event messages generated by {@link PlayerSession} and retrieved by {@link PlayerEventListener}
  //   */
  // public interface PlayerEvent extends SystemCommonObject
  // {
  //     /**  Represents all events notified by PLAYER */
  //     int EVENT = 0x80000000;
  // 
  //     /**
  //      * Provides a convenient way of determining the type of the event and switching on it.
  //      */
  //     int getEventID();
  // }
  //
  // public class PlayerEventImpl extends SystemCommonObjectImpl implements PlayerEvent
  // {
  //    @Override public int getEventID()
  //    {
  //        assertValid();
  //        return eventId;
  //    }
  // }
  //
  // jpa/modules/jpa-api/src/java/com/nds/fusion/player/PlayerEventConnectionFrontend.java
  // public interface PlayerEventConnectionFrontend extends PlayerEventConnection
  // {
  //     /**  Notification that the front end signal state has changed. */
  //     int EVENT = 0x80800001;
  // 
  //     /**
  //      * Get signal status
  //      * @return Signal status
  //      */
  //     int getSignalStatus()
  //             throws PlayerDataUnavailableException;
  // }

  l_event_msg.event.type = PLAYER_EVENT_SESSION_START;

  PostPlayerEvent
}

// player_api_events.c

PostPlayerEvent
  PostingEventListenerIterator
  {
    // To `PlayerEventThread`
    SYSTEMITC_API_PostEvent(PLAYER_MESSAGE_EVENT_EVENT)

    OR

    ProcessPlayerEvent
  }

case PLAYER_MESSAGE_EVENT_EVENT(1101)
  ProcessPlayerEvent
  {

    void PlayerListenerCallbackExecution(const PLAYER_EVENT_LISTENER_OBJECT_DATA * listener, uint32_t event_handle)
    {
        listener->listener( listener->sessionUserTag, listener->session, (PLAYER_API_Event_Handle)event_handle );
    }

    <player-events-to-app>
    // define PLAYER_DEBUG_STRINGS. when debug build, it's on by default.
    //   PLAYER_EVENT_DebugGetEventNameString
    //
    // !INFO  -P_Api        < M:player_api_events.c F:ProcessPlayerEvent() L:00625 > event handle = 0x0000000f, 
  }

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/mediaengine/PlayerEventPump.java
public interface PlayerEvent extends SystemCommonObject
{
	/**  Represents all events notified by PLAYER */
	public static final int	EVENT	= 0x80000000;
}

// jpa/modules/jpa-api/src/java/com/nds/fusion/player/PlayerEventSession.java
public interface PlayerEventSession extends PlayerEventMediaEvent
{
    /**  Represents all Session events notified by PLAYER */
    int EVENT = 0x80100000;

}

public interface PlayerEventComponentFail extends PlayerEventMediaEvent
{
    *player-events* which defines events for both and app.
    /** Notification of a failure of the elementary components. */
    int EVENT = 0x80200100;

    interface Failure
    {
        int NO_PROGRAM_ASSOCIATIONS        = 1;
        int NO_SERVICE_PROGRAM_ASSOCIATION = 2;
        int NO_SERVICE_MAP                 = 3;
        int FAIL_NULL                      = 4;
        int TIMEOUT                        = 5;
    }
}


*player-events-from-mw*
typedef enum
{
    PLAYER_API_COMPONENT_FAIL_TIMEOUT                        = 5U,  /**< Timeout on getting service component information */
} PLAYER_API_Component_Fail;


/**
 * @brief Callback for component fail alarms. This will trigger our message thread to
 *        check whether we have received `an SCI object for the active job` and signal a
 *        PLAYER_API_COMPONENT_FAIL_TIMEOUT if we haven't.
 *
 * @param[in] handle Alarm handle
 * @param[in] user_data_handle VRM job handle for the corresponding play job
 */


/** Component fail timeout in ms */
player.cfg
406:COMPONENT_FAIL_TIMEOUT_MS=10000


<player-event>
WHY? Is this "-2139095039"? Since EPG use signed so need to translate it to
unsigned.

>>> -2146435070 + 2**32
2148532226L

// #define PLAYER_EVENT_SESSION_STOP                   0x80100002      
// /**< Notification that a Stop request has stopped. @see #PLAYER_EVENT_Session_Stop_PropId */

>>> 0x80100002
2148532226

!MIL    -EPG_PLAY     		< M:PlayerEventPump F:processEvent L:105 > T:PooledExecutor#2:PlayerEvent > pl@5a21e9f ID > -2146435070
!MIL    -EPG_ME       		< M:MediaEngine F:onPlayerSessionEvent L:3510 > T:PooledExecutor#2:MediaEngine:onPlayerSessionEvent PlayerEventSessionStop

!MIL    -EPG_PLAY     		< M:PlayerEventPump F:processEvent L:105 > T:PooledExecutor#4:PlayerEvent > oU@5a7deeb ID > -2143289336 

// 2151677960
// >>> hex(2151677960)
// '0x80400008'
// #define PLAYER_EVENT_PLAYBACK_POSITIONEND           0x80400008      /**< Notification that the playback has reached the end of the recoriding. @see #PLAYER_EVENT_Playback_PositionEnd_PropId */

#define PLAYER_EVENT_RB_STOP                        0x84000002      /**< Notification of a Review Buffer stopping. @see #PLAYER_EVENT_RB_Stop_PropId */
>>> hex(-2080374782 + 2**32)
'0x84000002'
> T:PooledExecutor#3:PlayerEvent > pb@5a8d4ee ID > -[2053:10:03 20:51:50]2080374782
  >
#define PLAYER_EVENT_LIVE_RESERVATION_START         0x88000001      /**< Notification that a Play request has started. @see #PLAYER_EVENT_Live_Reservation_Start_PropId */
>>> hex(-2013265919+ 2**32)
'0x88000001'

>>> -(2**32-0x88000001)
-2013265919

> T:PooledExecutor#3:PlayerEvent > oP@5a8d508 ID > -2013265919
  >

#define PLAYER_EVENT_COMPONENT_AUDIO_UPDATE         0x80200020      /**< Notification of update of a Audio elementary component. @see #PLAYER_EVENT_Component_Audio_PropId */
>>> hex(-2145386464+ 2**32)
'0x80200020'

<player-event-pin>

>>> hex(-2146434816+2**32)
'0x80100100'
>>> hex(-2146435040+2**32)
'0x80100020'

#define PLAYER_EVENT_SESSION_BLOCKED                0x80100100      /*!< @brief Notification that a Service was blocked because a valid PIN check is required. @see #PLAYER_EVENT_Session_Blocked_PropId */
#define PLAYER_EVENT_SESSION_PIN_NOT_REQUIRED       0x80100200      /*!< @brief Notification that a PIN is no longer required and the session can proceed @see #PLAYER_EVENT_Session_Pin_Not_Required_PropId */


*app-register-listener* *player-event*

// /Picasso/src/java/picasso/mediaengine/PlayerEventPump.java
public void registerWithMiddleware(PlayerSession playerSession)
{
  note: means only register `pump` with MW?
  listenerId = playerSession.registerPlayerEventListener(PlayerEvent.EVENT, `this`);
}

// modules/jpa-impl/src/java/com/nds/fusion/playerimpl/PlayerSessionImpl.java
public class PlayerSessionImpl extends SystemCommonObjectImpl implements PlayerSession
{
  public synchronized PlayerListenerID registerPlayerEventListener(int eventTypes, `PlayerEventListener listener`)
  {
    return new PlayerListenerIDImpl(`natPlayerApiSessionRegisterPlayerEventListener`(nativeHandle, eventTypes, listener));
  }

  public void storePin(int pin )
  {
    natPlayerApiSessionStorePIN(nativeHandle, pin);
  }
}

// jpa/modules/jpa-impl/src/c/src/natPlayerSessionImpl.c
JNIEXPORT jint JNICALL Java_com_nds_fusion_playerimpl_PlayerSessionImpl_`natPlayerApiSessionRegisterPlayerEventListener`
  (JNIEnv *env, jclass jClass, jint native_handle, jint event_types, jobject jEventListener)
{
  /* make the native call */
  status = PLAYER_API_Session_RegisterEventListener(jSessionHandle, jEventTypes,
      &`PLAYER_JAVA_PlayerEventListener`,
      (PLAYER_API_TAG)currentRegistrationRequest,
      &listenerHandle);
}


*app-get-event*
void PLAYER_JAVA_PlayerEventListener(PLAYER_API_TAG user_tag, /* This user tag corresponds with the tag provided on event listener registration */
                                     PLAYER_API_SessionHandle session_handle,
                                     PLAYER_API_Event_Handle event_handle )
{
  Java_com_nds_fusion_player_PlayerEventListener_onEvent(env, currentEventListenerObject, event_object);
}

// MediaEngine/src/java/picasso/mediaengine/MediaEngine.java:
public void onEvent(PlayerEventMediaEvent event)
{
  switch (event.getEventID())
  {
    case PlayerEventComponentUpdate.EVENT:
      onComponentUpdate((PlayerEventComponentUpdate) event);
      dealWithComponentUpdate(event);
      break;

    *player-something-timeout*
    case PlayerEventComponentFail.EVENT:
      `componentFailed`(((PlayerEventComponentFail) event));
      break;
  }
}


// MediaEngine/src/java/picasso/mediaengine/PlayerEventPump.java:
protected void processEvent(PlayerEvent event)
{
  Loggers.EPG_PLAY.logMilestone("PlayerEvent > " + event + " ID > " + event.getEventID());

  note: How maps between pump.processEvent and ME.onEvent? This seems to be
  where ME gets a chance to handle evevnt.

  // see if there is a latch waiting for events
  boolean storedInLatch = mediaEngine.addPlayerEventToLatch(event); 

  if (event instanceof PlayerEventSession)
  {
    // MediaEngine/src/java/picasso/mediaengine/MediaEngine.java:
    // public void onPlayerSessionEvent(PlayerEventSession event)
    //   PlayerListenerCallbackExecution
    //
    mediaEngine.onPlayerSessionEvent((PlayerEventSession) event);
  }
  else if (event instanceof PlayerEventRB)
  {
    reviewBufferPlayerEventListener.onEvent((PlayerEventRB) event);
  }
  else if (event instanceof PlayerEventConnection)
  {
    signalGainedLostHandler.onConnectionEvent((PlayerEventConnection) event);
  }
  ...
}


*app-handle-event*
// MediaEngine/src/java/picasso/mediaengine/MediaEngine.java:
private void componentFailed(PlayerEventComponentFail event)
{
  try
  {
    MediaEngineData data = getSessionDataForEventIfCurrent(event);

    if (data != MediaEngineData.SESSION_EXPIRED)
    {
      doStuffForOffAirService(event, data);
      satelliteSignalHandler.handlePlayerEventComponentFail(event);
    }
  }
}

// Picasso/src/java/picasso/mediaengine/SatelliteSignalGainedLostHandler.java
void handlePlayerEventComponentFail(PlayerEventComponentFail event) throws PlayerDataUnavailableException
{
  int failureCode = event.getFailure();

  switch (failureCode)
  {
     case NO_SERVICE_PROGRAM_ASSOCIATION:
        channelOffAirMonitor.noServiceProgramAssociation();
        break;

     case TIMEOUT:
        LOGGER.logError("SOMETHING TIMEDOUT in middleware (PLAYER_EVT_COMPONENT_FAIL_TIMEOUT)");
        setTechnicalFaultCondition(technicalFaultWithCodes(failureCode, PLAYER_COMPONENT_TIMEOUT));
        break;
  }
}

typedef enum
{
    PLAYER_RECORDING_BASE_EVENT= 0,
    PLAYER_RECORDING_BASE_MANUAL,
    PLAYER_RECORDING_BASE_MAX_VALUE
} PLAYER_RECORDING_BASE;

typedef enum
{
    PLAYER_RECORDING_TYPE_COMPLETE= 0,
    PLAYER_RECORDING_TYPE_INPROGRESS,
    PLAYER_RECORDING_TYPE_MAX_VALUE
} PLAYER_RECORDING_TYPE;


<player-fsm>
PLAYER_STATE_ACTION g_PLAYER_VRM_State_ACreate[] =
{ PLAYER_EVT_JOB_CREATED,   PLAYER_SM_VRM_JobCreated },
 
PLAYER_SM_VRM_JobCreated
{
  PLANNER_API_Session_CheckForConflict( PLAYER_CheckForConflictListener );

  PLAYER_SM_VRM_StartJob
    VRM_JOB_Start
}


<player-live-call-flow>
1. EPG calls a function to create a session and get a handle.

APP: session.play(playLoc, true, data.getSessionUserTag());

If selectDefaults is set to TRUE the new source starts playing immediately.

public void play(SystemLocator sourceLocator,
  boolean selectDefaults,
  int locatorUserTag)
  throws PlayerHealthCheckException, PlayerActiveStandbyException
{
  natPlayerApiSessionPlayLive
    (nativeHandle,sourceLocator,selectDefaults,locatorUserTag);
}

PLAYER_JAVA_SessionPlayLive
{
  jobject jSourceLocator                  = *(jobject*)env->params[1];
  NDSJNI_GetField(env, jSourceLocator, "nativeHandle", "I", &sourceLocatorHandle,);

  /* create a parameter bag */
  PLAYER_API_Session_CreatePlayParameters(PLAYER_API_PlayParameterType_LIVE)
  {
    l_param_struct->type = type;
  }

  /* set source locator in parameter bag */
  PLAYER_API_Session_SetSystemLocatorPlayParameter(parameterBagHandle, \
      PLAYER_API_PlayParameterProp_Locator_SourceLocator, sourceLocatorHandle)
  {
    SYSTEMLOCATOR_Clone(sourceLocatorHandle, &(l_param_struct->source));
  }

  /* set speed in parameter bag */
  /* set origin type for play position */
  /* set play position */
  PLAYER_API_Session_Play(parameterBagHandle)
  {
    `PLAYER_PRV_Session_Play`(l_param_struct->source)
    {
      /* Starting NEW job */
      PLAYER_JOB_SetJob
      {
        job->job_type = PLAYER_JOB_TYPE_LIVE;
        job->src_locator = param_struct->source;
      }

      PLAYER_PRV_Session_UpdateJob

      (void)sem_post(&(g_player_component.handle_protection_sem));

      /* MessageThread. */
      PLAYER_IdentifyScAndJob

      /* from a state machine. PLAYER_FindStateFunction in MessageThread. */
      PLAYER_SM_VRM_GetSessionFlagsValue
      {
        PLAYER_PIN_SendReEvaluate
      }

      /* from a state machine. PLAYER_FindStateFunction in MessageThread. */
      PLAYER_SM_VRM_PinReEvaluatePrePlay(PLAYER_JOB_DATA *job_data,)
      {
        PLAYER_SM_VRM_CreateVRMJob(PLAYER_JOB_DATA *job_data)
        {
          switch(job_data->job_type)
          {
            case PLAYER_JOB_TYPE_LIVE:
              l_job_type = SYSTEMJOB_TYPE_LIVE_VIEWING;
              l_src_locator = job_data->src_locator;

            case PLAYER_JOB_TYPE_PLAYBACK:
              l_job_type = SYSTEMJOB_TYPE_PLAYBACK;
          }

          SYSTEMLOCATOR_CreateEmpty(SYSTEMLOCATOR_PROTOCOL_URI, 
              SYSTEMLOCATOR_TYPE_SERVICE, &l_src_locator);
          SYSTEMLOCATOR_SetStringProperty(l_src_locator, 
              SYSTEMLOCATOR_PROPID_S_URI, l_uri_data);

          // get VRM JOB handle when return from this call.
          `VRM_JOB_Create`(l_job_type, l_pbag, PLAYER_VRM_EventDispatcher, 
              &(job_data->vrm_job_handle)))
            VRM_JOB_SERVER_Create

          // so this MIL means VRM JOB created
          // !MIL   -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c \
          // F:PLAYER_SM_VRM_CreateVRMJob L:1805 > 
          // Job 0x03000003 Created on Display Target MAIN_TARGET type=3 
        }
      }
    }
  }
}


<player-playback-call-flow>
!INFO  -P_Api        < M:player_uam.c F:PLAYER_UAM_SetBookingTypeForJob L:00872 > Booking Type = [ 0x11 ]  - RECORD - MANUAL

PLAYER_JAVA_SessionPlayRecording
{
	PLAYER_API_Session_CreatePlayParameters(PLAYER_API_PlayParameterType_PLAYBACK
	PLAYER_API_Session_Play
}

#
# playback
#
Interface PlayerSession.OriginType

BEGINNING (1)    Beginning of file 
CURRENT_POSITION (3)    Current position 
END (2)    End of file 

typedef enum MSM_REF_POINT_TAG
{
    MSM_REF_POINT_UNDEF = 0,		/*!< @brief uninitialized relative value */
    MSM_REF_POINT_VSTART, 			/*!< @brief relative to the vstart */
    MSM_REF_POINT_VEND,				/*!< @brief relative to the vend */
    MSM_REF_POINT_VORIGIN,			/*!< @brief relative to the vorigin */
    MSM_REF_POINT_LIVE,				/*!< @brief relative to the live recording. This value can only be negative */
    MSM_REF_POINT_POSITION,		    /*!< @brief absolute position */
    MSM_REF_POINT_CURRENT,  	    /*!< @brief current playback position */
    MSM_REF_POINT_VFLIST_START,     /*!< @brief relative to the v-file list start */
    MSM_REF_POINT_VFLIST_END,       /*!< @brief relative to the v-file list end */
    MSM_REF_POINT_LAST				/*!< @brief Last value (don't use it)*/
} MSM_REF_POINT;

#define     MSM_UNIT_INVALID				0x00000000U	/*!< @brief invalid value (don't use it) */
#define     MSM_UNIT_V_OFFSET				0x00000001U  /*!< @brief Offset from v-file in milliseconds (according to reference point) */
#define     MSM_UNIT_ABS_POSITION			0x00000002U  /*!< @brief Absolute position in milliseconds */
#define     MSM_UNIT_UTC					0x00000004U  /*!< @brief Absolute time in UTC */
#define 	MSM_UNIT_ABS_BYTES				0x00000008U  /*!< @brief Absolute position in bytes */
#define		MSM_UNIT_VFLIST_OFFSET          0x00000010U  /*!< @brief Offset from v-file list in milliseconds (according to reference point) */
#define		MSM_UNIT_VFLIST_ABS_POSITION    0x00000020U  /*!< @brief v-file list absolute position in milliseconds */
#define		MSM_UNIT_VFLIST_ABS_BYTES		0x00000040U  /*!< @brief v-file list absolute position in bytes */
#define     MSM_UNIT_LAST					0x000000FFU  /*!< @brief Last value (don't use it)*/


#
# BEGIN
#
343:!ERROR -J_PLAYER   < T:no name M:natPlayerSessionImpl.c F:PLAYER_JAVA_SessionPlayRecording L:00479 > KT: jSpeed=1000, jOriginType=1, jPosition=0
643:!ERROR -P_Api      < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_StartJob L:08200 > KT: relative=1 ; position=0, 
669:!MIL   -VRMS       < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=9, jhVRM=0x3000003
679:!WARN  -MSM_MDI    < T:MCM_ITCMAIN_THREAD M:meta_mem.c F:MetaMemAllocateContext L:00906 > Milestone : context 4, was allocated for META_CONTEXT 0x8000000f, memoryConnectionType META_MEMORY_CONNECTION_TYPE_PLAY_OF_PLAYBACK [11]
# MSM_UNIT_V_OFFSET(1)
802:!ERROR -VRMS       < T:VRM_SRV M:basic_play.c F:PlayActionConfiguringState L:01909 > KT: units = 0x1, refPoint=1, pos=(0, 0)
803:!WARN  -MSM        < T:VRM_SRV M:msm_sp.c F:MSM_SP_SetPosition L:00634 > Milestone : KT: MSM_SP_SetPosition hMC=0x5, MSM_UNIT_V_OFFSET, refPoint=1, pos=(0, 0)  Starts... 
2282:!MIL   -P_Api     < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:06277 > VIDEO_RUNNING_STATUS: jtVRM=9, jhVRM=0x3000003, status=RUNNING

#
# CURRENT
#
8524:!ERROR -J_PLAYER  < T:no name M:natPlayerSessionImpl.c F:PLAYER_JAVA_SessionPlayRecording L:00479 > KT: jSpeed=1000, jOriginType=3, jPosition=0
8824:!ERROR -P_Api     < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_StartJob L:08200 > KT: relative=1 ; position=0, 
8850:!MIL   -VRMS      < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=9, jhVRM=0x3000006
8860:!WARN  -MSM_MDI   < T:MCM_ITCMAIN_THREAD M:meta_mem.c F:MetaMemAllocateContext L:00906 > Milestone : context 4, was allocated for META_CONTEXT 0x80000011, memoryConnectionType META_MEMORY_CONNECTION_TYPE_PLAY_OF_PLAYBACK [11]
8949:!ERROR -VRMS      < T:VRM_SRV M:basic_play.c F:PlayActionConfiguringState L:01909 > KT: units = 0x1, refPoint=1, pos=(0, 13338)
8950:!WARN  -MSM       < T:VRM_SRV M:msm_sp.c F:MSM_SP_SetPosition L:00634 > Milestone : KT: MSM_SP_SetPosition hMC=0x8, MSM_UNIT_V_OFFSET, refPoint=1, pos=(0, 13338)  Starts... 
10464:!MIL   -P_Api    < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:06277 > VIDEO_RUNNING_STATUS: jtVRM=9, jhVRM=0x3000006, status=RUNNING

#
# END
#
16286:!ERROR -J_PLAYER < T:no name M:natPlayerSessionImpl.c F:PLAYER_JAVA_SessionPlayRecording L:00479 > KT: jSpeed=1000, jOriginType=2, jPosition=-10000
16635:!ERROR -P_Api    < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_StartJob L:08200 > KT: relative=2 ; position=-1, 
16661:!MIL   -VRMS     < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:03884 > VRM_JOB_START: jtVRM=9, jhVRM=0x3000009
16689:!WARN  -MSM_MDI  < T:MCM_ITCMAIN_THREAD M:meta_mem.c F:MetaMemAllocateContext L:00906 > Milestone : context 4, was allocated for META_CONTEXT 0x80000013, memoryConnectionType META_MEMORY_CONNECTION_TYPE_PLAY_OF_PLAYBACK [11]
16728:!ERROR -VRMS     < T:VRM_SRV M:basic_play.c F:PlayActionConfiguringState L:01909 > KT: units = 0x1, refPoint=2, pos=(-1, 4294957296)
16729:!WARN  -MSM      < T:VRM_SRV M:msm_sp.c F:MSM_SP_SetPosition L:00634 > Milestone : KT: MSM_SP_SetPosition hMC=0xb, MSM_UNIT_V_OFFSET, refPoint=2, pos=(-1, 4294957296)  Starts... 
18585:!MIL   -P_Api    < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:06277 > VIDEO_RUNNING_STATUS: jtVRM=9, jhVRM=0x3000009, status=RUNNING


// play for recording
//
public void play(SystemLocator sourceLocator, int speed, int originType, 
  int position,
  boolean selectDefaults, int locatorUserTag) 
  throws PlayerNoSkyPlusAuthorisationException, PlayerHealthCheckException, 
  PlayerActiveStandbyException
{
  assertValid();

  natPlayerApiSessionPlayRecording(nativeHandle,sourceLocator,speed,originType,position,
      selectDefaults,locatorUserTag);
}

PLAYER_JAVA_SessionPlayRecording
{
  /* Play this session!*/
  status = PLAYER_API_Session_Play(jSessionHandle, parameterBagHandle, selectDefaults, jLocatorUserTag);
}

`PLAYER_PRV_Session_Play`
{
   PLAYER_DIAG_LOG_INFO((" *** Starting new job but ACTIVE job exists"));
   PLAYER_DIAG_LOG_INFO((" ***  NOT MATCHING JOB New source is different from  active one queue it  "));

   PLAYER_JOB_SetJob

   PLAYER_PRV_Session_UpdateJob
   {
      PLAYER_PRV_Session_PlayRecording
      {
         /* Get the actual duration of the booked programme */
         if (PLANNER_API_STATUS_OK != PLANNER_API_BookedProgramme_GetPropertyUint32(l_bookedprogramme,
            PLANNER_API_BOOKEDPROG_PROPID_UINT32_ACTUAL_DURATION, &l_actual_duration))

         // update PLAYER_PLAY_PARAMETERS *l_param_struct->position with val from PLANNER.

         /* Get the last played position */
         if (PLANNER_API_STATUS_OK != PLANNER_API_BookedProgramme_GetPropertyUint32(l_bookedprogramme,
            PLANNER_API_BOOKEDPROG_PROPID_UINT32_LAST_VIEWED, &l_last_position))

         if( l_param_struct->origin == PLAYER_API_Origin_Current_Position )
         {
            // update l_param_struct->position
            l_param_struct->origin = PLAYER_API_Origin_Start;
            l_param_struct->position += (int32_t)l_last_position;
         }
         
         // check l_param_struct->position against l_actual_duration in case of PLAYER_API_Origin_Start.
         // in case ACTUAL_DURATION is NULL, the below doesn't get excuted.
         
         case PLAYER_API_Origin_Start:
         {
           if( l_actual_duration > 0U )
           {
             if ((l_param_struct->position) > ((int32_t)l_actual_duration))
             {
               l_status = PLAYER_API_STATUS_FAILURE;
               PLAYER_DIAG_LOG_ERROR(("Origin start: Play position greater than actual duration"));
             }
           }
           break;
         }
         
      }
      
      new_job->position_requested.vfile_offset_msec.offset = l_param_struct->position;
   }
   
   // only for PLAYER_JOB_TYPE_PLAYBACK
   PLAYER_Common_StoreLastViewedPosition(&l_sc_data->active_job);
   {
      if (PLANNER_API_STATUS_OK !=PLANNER_API_BookedProgramme_GetPropertyUint32(job_data->booked_programme_handle,
      	PLANNER_API_BOOKEDPROG_PROPID_UINT32_ACTUAL_DURATION,&l_booked_program_actual_duration))
      																	  
      /* faourik BEGIN MSCQ412942*/
      else if (PLANNER_API_STATUS_OK !=PLANNER_API_BookedProgramme_GetPropertyUint32(job_data->booked_programme_handle,
      	PLANNER_API_BOOKEDPROG_PROPID_UINT32_DURATION,&l_booked_program_duration))
      
      l_current_position = (uint32_t)PLAYER_PRV_GetStreamPosition(job_data, MSM_REF_POINT_VSTART, MSM_UNIT_V_OFFSET);		
      
      # only when 
      # if ( l_booked_program_duration <= l_booked_program_actual_duration )
      # calc diff between actual and current
      /* Save current position in the booked programme object */
      if (PLANNER_API_STATUS_OK != PLANNER_API_BookedProgramme_SetPropertyUint32(
      	   job_data->booked_programme_handle,
      	   PLANNER_API_BOOKEDPROG_PROPID_UINT32_LAST_VIEWED,
      	   l_current_position)) OR 0))
      	   
      # else
      PLAYER_DIAG_LOG_INFO(("Program Duration > Actual Program Duration"));
      /* Save current position in the booked programme object */
      if (PLANNER_API_STATUS_OK != PLANNER_API_BookedProgramme_SetPropertyUint32(
      	   job_data->booked_programme_handle,
      	   PLANNER_API_BOOKEDPROG_PROPID_UINT32_LAST_VIEWED,
      	   l_current_position))		
   }
}

# when swithing from playback to live, the above path executed and tried to
# save the viewed position. 

NDS: ^[00:29:38]0946686578.435795 !ERROR -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06328 > KT: PLANNER_API_BookedProgramme_GetPropertyUint32: the booked program actual duration is 417479 ms.
NDS: ^[00:29:38]0946686578.435916 !ERROR -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06329 > KT: PLANNER_API_BookedProgramme_GetPropertyUint32: the booked program duration is 1800000 ms.

NDS: ^[00:29:38]0946686578.443072 !INFO  -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06384 > Program Duration > Actual Program Duration
NDS: ^[00:29:38]0946686578.495156 !INFO  -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06393 > Set the position to [16842] .

# when playback next time

NDS: ^[00:29:51]0946686591.797667 !ERROR -P_Api        < M:player_api_session.c F:PLAYER_PRV_Session_PlayRecording L:03372 > KT: l_param_struct->origin(3), l_param_struct->position(0), l_last_position(16842) from PLN
NDS: ^[00:29:51]0946686591.797809 !ERROR -P_Api        < M:player_api_session.c F:PLAYER_PRV_Session_PlayRecording L:03377 > KT: l_param_struct->position(16842)

# when live

NDS: ^[00:30:05]0946686605.534106 !ERROR -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06328 > KT: PLANNER_API_BookedProgramme_GetPropertyUint32: the booked program actual duration is 444503 ms.
NDS: ^[00:30:05]0946686605.534228 !ERROR -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06329 > KT: PLANNER_API_BookedProgramme_GetPropertyUint32: the booked program duration is 1800000 ms.

NDS: ^[00:30:05]0946686605.541722 !INFO  -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06384 > Program Duration > Actual Program Duration
NDS: ^[00:30:05]0946686605.593245 !INFO  -P_Api        < M:player_common.c F:PLAYER_Common_StoreLastViewedPosition L:06393 > Set the position to [29608] .


<player-playback-last-position>
# use LAST_POSITION in "AV_CONTENT" of PCAT. See comp-PCAT

'0:4294967295', # LAST_POSITION. 4294967295(0xFFFF FFFF)


PLAYER_PRV_GetStreamPosition is called continously during playback.

# VRM listener. This is for each job and 'PLAYER_PRV_VRMAllJobListener' is for
# all jobs.

PLAYER_SM_VRM_CreateVRMJob
	"VRM_JOB_Create"(l_job_type, PLAYER_VRM_EventDispatcher)
		PLAYER_VRM_EventDispatcher
		{
			PLAYER_GetVRMEvent
				case VRM_JOB_EVENT_MEDIA_STATUS_UPDATED: # 0x1 
				# !INFO  -P_Api        < M:player_common.c F:PLAYER_VRM_EventDispatcher L:00548 > VRM Job 0x03000003, Event 0x1
				#
					PLAYER_GetEventFromObject: 
					# get object updated obj type and set evt type corresponding to obj type.
						case SYSTEMOBJECT_TYPE_CASI: PLAYER_EVT_CASI. 
						case SYSTEMOBJECT_TYPE_VRSI: call PLAYER_GetEventFromVRSI

			SYSTEMITC_API_PostEvent(&(g_player_component.queue_id) : to MessageThread
		}

MT: FSM
	PLAYER_SM_VRM_ProcessCASI
		PLAYER_SM_VRM_CrossReferenceCA # CA AUDIO, VIDEO, TXT, and SUBTITLE event
			PLAYER_SM_VRM_PostCAComponentEvent(PLAYER_API_Session_Component_Video, PLAYER_EVENT_CA_VIDEO)
				PostPlayerEvent


<player-rb-call> 
# RB. egrep -nr "(PLAYER_RB_ProcessCASI|KEY_PRESS|PLAYER_EVENT_RB_FAIL|PLAYER_VGC_GetViewingProblems)"
#
PLAYER_SM_VRM_CreateRecRB
	PLAYER_RB_CreateRecordBuffer(&job_data->rec_rb_handle, PLAYER_SM_VRM_RBHandler)
	{
		PLAYER_VTABLE_Create(&l_rb_data);
		l_rb_data->event_handler            = event_handler;

		VRM_JOB_Create('SYSTEMJOB_TYPE_RB_RECORD', PLAYER_RB_EventListener)
	}
	
PLAYER_RB_EventListener
	l_payload->event = PLAYER_EVT_RB
	
	case: job_event_notify->event == VRM_JOB_EVENT_MEDIA_STATUS_UPDATED
	case:
	else if(job_event_notify->event == VRM_JOB_EVENT_WARNING)
	{
	  if ( job_event_notify->payload.warning.warning_type == VRM_JOB_WARNING_TYPE_RB_RECORD_NOT_STARTING )
	  {
	      l_payload->data.review.event = PLAYER_EVT_RB_RECORD_NOT_STARTING;
	      l_payload->data.review.data = (uint32_t) job_event_notify->payload.warning.exception_type;
	  }
	SYSTEMITC_API_PostEvent(MT, PLAYER_EVT_RB)

MT:	
	# use PLAYER_RB_StateFunctions FSM
	# { PLAYER_EVT_CASI,                              PLAYER_RB_ProcessCASI },
	PLAYER_RB_ProcessCASI
	#
	# CAMM_MODULE_CAStreamStatusAccessDeniedOther = 0x7F # this comes from CAMM_INTERNAL_CreateAndSendCAStatusInfo
	# !INFO  -P_Api        < M:player_sm_rb.c F:PLAYER_RB_ProcessCASI L:01283 > Acces exception status is AccessDeniedOther 
	# this set 'rb_data->ca_problem_other = true' and lead to destroying the RB job

	
	#
	{ PLAYER_EVT_RB_RECORD_NOT_STARTING,            PLAYER_RB_HandleRBRecordNotStarting },	
	PLAYER_RB_HandleRBRecordNotStarting
		rb_data->event_handler(PLAYER_RB_EVENT_WARNING)
		
	PLAYER_SM_VRM_RBHandler
		case PLAYER_RB_EVENT_WARNING :
			l_event_msg.event.type = PLAYER_EVENT_RB_FAIL;
			PostPlayerEvent
			# app log for this is:
			# [  EPG_ME:INFO]: PlayerEventPump.processEvent: event --> com.nds.fusion.playerimpl.PlayerEventRBFailImpl


# seems that app should delete a event once notified?
#
PLAYER_JAVA_EventCommonImplDeleteEvent
	PLAYER_API_Event_Delete


<player-ca>
# CA. When app get CA event from player, app uses VGC to get more infos. 

CASI	CA Status Information
CAEI	CA Entitlement Information

#define PLAYER_EVENT_CA                             0x82000000      
#/**< Represents all CA events notified by PLAYER */

#define PLAYER_EVENT_CA_VIDEO						0x82000001      
# /**< Notification of a Video elementry component CA exception. @see #PLAYER_EVENT_CA_Video_PropId */

#define PLAYER_EVENT_CA_AUDIO                       0x82000002      
#/**< Notification of a Audio elementry component CA exception. @see #PLAYER_EVENT_CA_Audio_PropId */

#define PLAYER_EVENT_CA_TELETEXT                    0x82000004      
#/**< Notification of a Teletext elementry component CA exception. @see #PLAYER_EVENT_CA_Teletext_PropId */

#define PLAYER_EVENT_CA_SUBTITLE                    0x82000008      
#/**< Notification of a Subtitle elementry component CA exception. @see #PLAYER_EVENT_CA_Subtitle_PropId */

PLAYER_VGC_GetViewingProblems
PLAYER_PRV_CheckFreeToAirStatus
	# CAMM_MODULE_CAStreamStatusAccessDeniedOther 0x7F. Picasso: PlayerEventCA.CAScrambledStatus

# app side
#
class PlayerEventCAVideoImpl
	getConditionID()
		PlayerEventCommonImpl.natGetUint32(nativeHandle, I_CA_COND_ID);
			# PLAYER_JAVA_EventCommonImplGetUint32 
			# 	PLAYER_API_Event_GetUint32
			# 		PLAYER_API_Video_PropId_Uint32_CACondId: from SYSTEMOBJECT_GetInteger(caei_handle, SYSTEMOBJECT_CAEI_PROPID_I_CA_CONDITION_ID )
 
946685486026: PooledExecutor#0: [  EPG_ME:INFO]: PlayerEventPump.processEvent: event --> com.nds.fusion.playerimpl.PlayerEventCAVideoImpl
946685486365: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.handlePlayerEventCA: 
946685486034: threadtracker: [  EPG_ME:INFO]: GuideRetrievalEventPump.notifySuccess: 
946685486369: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.contentCheck: contentCheck has condition: 48 handle: 50331657
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo: CAContentCaInfo:
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Operation status:                       1 (OPERATION_STATUS_SUCCESS)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   CA service ID:                          16
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Purchase information available:         false
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement type:                       1 (ENTITLEMENT_TYPE_SUBSCRIPTION)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot type:                  1 (SLOT_TYPE_SUBSCRIPTION)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot number:                0
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Promo ID:                               65535
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   SI sync token:                          -1
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Allowed taping modes:                   1 (ANALOG_TAPING_ALLOWED)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of viewing problems:             0
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of exceeded limits:              0
946685486389: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: 0 CONTENT PROBLEMS
946685486390: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.extractMWContentProblem: topMWProblem=-1

946685486391: PooledExecutor#0: [  EPG_ME:INFO]: PlayerEventPump.processEvent: event --> com.nds.fusion.playerimpl.PlayerEventCAAudioImpl
946685486395: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.handlePlayerEventCA: 
946685486399: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.contentCheck: contentCheck has condition: 48 handle: 50331657
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo: CAContentCaInfo:
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Operation status:                       1 (OPERATION_STATUS_SUCCESS)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   CA service ID:                          16
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Purchase information available:         false
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement type:                       1 (ENTITLEMENT_TYPE_SUBSCRIPTION)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot type:                  1 (SLOT_TYPE_SUBSCRIPTION)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot number:                0
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Promo ID:                               65535
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   SI sync token:                          -1
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Allowed taping modes:                   1 (ANALOG_TAPING_ALLOWED)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of viewing problems:             0
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of exceeded limits:              0
946685486753: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: 0 CONTENT PROBLEMS
946685486754: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.extractMWContentProblem: topMWProblem=-1


#-----------------------------------------------------------
# PLAYER_JAVA_AVControlImpl_MuteSubtitles: PLAYER_API_AVControl_SetSubtitleMute(bool mute)
#-----------------------------------------------------------
# use to on/off subtitle
# 
# end up with 'PLAYER_Subtitles_Update' call


#-----------------------------------------------------------
# PLAYER_JAVA_SessionSetSubtitlesLocalSetting: PLAYER_API_Session_SetSubtitlesLocalSetting(PLAYER_API_Session_LocalSetting_Type)
#-----------------------------------------------------------
# The override setting is used to determine whether subtitles are
# output, instead of the PREFS value.
#
# PLAYER_API_Session_LocalSetting_Type:
#    PLAYER_API_Session_LocalSetting_Enabled    = 1U,  /*!< Override setting is enabled */ -> On
#    PLAYER_API_Session_LocalSetting_Disabled   = 2U,  /*!< Override setting is disabled */ -> Off
#
# set:
#    active_job.subtitles_local_setting = st_local_setting
#
# g_PLAYER_VRM_State_Running: state machine
#  { PLAYER_EVT_SUBTITLES_LOCAL_SETTINGS_UPDATE, PLAYER_SM_VRM_ProcessSubtitlesLocalSettingsUpdate },
#
# PLAYER_SM_VRM_ProcessSubtitlesLocalSettingsUpdate -> PLAYER_Subtitles_Update -> PLAYER_Subtitles_Update_p
# -> PLAYER_Subtitles_Can_Start_DVB
#
# Eventually, use 'subtitles_local_setting' to decide on/off and not use any other vars and calls.

<player-set-windows>
// applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/playerimpl/PlayerAVControlImpl.java

    @Override public void setAVWindows(PlayerAVWindow input, PlayerAVWindow output, int source)
    {
	    {
		    outType = output.getType();
		    outX = output.getX();
		    outY = output.getY();
		    outW = output.getWidth();
		    outH = output.getHeight();
	    }
	    natSetAVWindows(nativeHandle, source, inType, inX, inY, inW, inH, outType, outX, outY, outW, outH);
    }

// applications/Picasso/picasso/jpa/modules/jpa-impl/src/c/src/natPlayerAVControlImpl.c
JNIEXPORT void JNICALL Java_com_nds_fusion_playerimpl_PlayerAVControlImpl_`natSetAVWindows`
  (JNIEnv *env, jclass jClass, jint jAVControlHandle, jint jSource,
        jint  jInType, jint  jInX, jint  jInY, jint  jInW, jint  jInH,
        jint jOutType, jint jOutX, jint jOutY, jint jOutW, jint jOutH)
{
    JPA_DIAG_DECLARE_FUNCTION;
    DIAG_LOG_FN_ENTRY(g_player_adaptor_api_diag_segment_id);

    /* Set the input and output viewports */
    PLAYER_API_AVControl_Window input = { .units_type = jInType, .x = jInX, .y = jInY, .width = jInW, .height = jInH };
    PLAYER_API_AVControl_Window output = { .units_type = jOutType, .x = jOutX, .y = jOutY, .width = jOutW, .height = jOutH };
    SYSTEM_STATUS return_status = PLAYER_API_AVControl_SetWindows((PLAYER_API_AVControl_Handle)jAVControlHandle,
                                                    (PLAYER_API_AVControl_SourceType)jSource,
                                                    jInType == PLAYER_API_AVControl_UnitsType_UNDEF ? NULL : &input,
                                                    jOutType == PLAYER_API_AVControl_UnitsType_UNDEF ? NULL : &output);
    if (!SYSTEM_STATUS_IS_OK(return_status))
    {
        DIAG_LOG_ERROR(g_player_adaptor_api_diag_segment_id, ("PLAYER_API_AVControl_SetWindows failed 0x%x", return_status));
    }

    (void)PLAYER_JAVA_ParseReturn(env, return_status);

    DIAG_LOG_FN_EXIT(g_player_adaptor_api_diag_segment_id, return_status);
}


<player-is-running>

isRunning -> PLAYER_JAVA_TeletextImplIsRunning: PLAYER_JAVA_GetBoolProperty(PLAYER_API_Session_Component_Teletext)

PlayerTeletextImpl.java (\darwin_platform\darwin_player_java\impl):
public boolean isRunning() throws PlayerDataUnavailableException
{
    if(!isValid)
        throw new SystemObjectReleasedException("operation performed on an invalid instance");
    
    return natIsRunning(nativeHandle);
}


#-----------------------------------------------------------
# registerPlayerEventListener -> natPlayerApiSessionRegisterPlayerEventListener -> PLAYER_JAVA_SessionRegisterPlayerEventListener ->
#   PLAYER_API_Session_RegisterEventListener(PLAYER_JAVA_PlayerEventListener)
#
#   MW PLAYER -> PLAYER_JAVA_PlayerEventListener -> JAVA Listener
#-----------------------------------------------------------


{player-pin}
# PR#18928: PIN wrongly displayed in banner on cancelling purchase. Player.
# Closed on 14 FEB 2011
# refer to WP587

// DARWIN_PLAYER_JAVA\api\PlayerEventSessionPinNotRequired.java)
/**
  * Player session PIN NOT required event.
  */
public interface PlayerEventSessionPinNotRequired extends PlayerEventSession
{
    /* Notification that a PIN is no longer required and the session can proceed.*/
    public static final int  EVENT =  0x80100200;

}

// 204789:NDS: ^[2018:05:17 13:54:18]0946717630.436736 !MIL    -P_Api        		< p:0x00000210 P:APP t:0x01328520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_Milestone 
  L:2930 > {PR} ""PREPLAY-PIN_REQUIRED, locator:null events_happened(SFLAGS ) job_type(PLAYER_JOB_TYPE_PLAYBACK) 
  reason(EVENT_RATING WATERSHED ) source(SOURCE_PLANNER) event_rating_state(STATE_PRESENT) event_rating(3) user_rating(5) 

== >>> hex(-2146434816+2**32)
== '0x80100100'
== >>> hex(-2146435040+2**32)
== '0x80100020'

#define PLAYER_EVENT_SESSION_BLOCKED                0x80100100      /*!< @brief Notification that a Service was blocked because a valid PIN check is required. @see #PLAYER_EVENT_Session_Blocked_PropId */
#define PLAYER_EVENT_SESSION_PIN_NOT_REQUIRED       0x80100200      /*!< @brief Notification that a PIN is no longer required and the session can proceed @see #PLAYER_EVENT_Session_Pin_Not_Required_PropId */


# source and log
// player_pin.c
PLAYER_PIN_IsPinRequired
PLAYER_PIN_RequestPin
-> PLAYER_EVENT_SESSION_PIN_REQUIRED

PLAYER_PIN_HandleNeedForPinChange
PLAYER_PIN_RestorePinSettings

(player_api_session.c)
PLAYER_API_Session_CheckPIN

This is because plyaer got confused to locators and thought these are
different ones so sent a pin req event again. this is a pin req for rating. 

From player_pin.c in HR001 branch

/* MSCQ417648 begin */
#ifdef PLAYER_PROFILE_A
/**
 * @brief For a given play request, check whether we are in the process of transitioning
 *        from a live or review buffer job to the EPG transponder and then back again.
 *        This transition is performed when purchasing a PPV event and should not cause
 *        us to lock VGC otherwise we may issue an unnecessary PIN request when tuning
 *        back to the original service.
 *
 *        If the play request indicates that we are about to tune to the EPG transponder
 *        this interface will store the locator of the current service and the locator of
 *        the current event. When tuning from the EPG transponder this interface will
 *        check the stored service locator to determine if we are returning to the
 *        original service. The stored event locator will be checked when handling the
 *        SEI object after returning to the original service; VGC should be locked if we
 *        are not returning to the same event.
 *
 * @param[in] request Parameters of play request
 * @return A Boolean flag that indicates whether we are in the process of transitioning
 *         to/from the EPG transponder
 */

(David G)
Player is comparing the locator of the current active job (EPG transponder)
  with the locator within the PLAYER_PLAY_PARAMETERS structure specified by
  the caller and in this case they do not match and therefore Player resets
  the PIN properties.

I am now thinking that Player is failing to store or removing the locator for
the previous service when moving to the EPG.


!INFO   -P_Api        		< T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:1941 > need_pin: true pin_requested false 

!INFO   -P_Api        		< T:PLAYER_EVENT M:player_api_events.c F:ProcessPlayerEvent L:628 > event handle = 0x00000109, event type = PLAYER_EVENT_SESSION_PIN_REQUIRED 
!MIL    -EPG_PLAY     		< T:no name M:PlayerEventPump F:processEvent L:105 > T:PooledExecutor#1:PlayerEvent > oC@59d9e14 ID > -2146435040

>>> hex(-2146435040+ 2**32)
'0x80100020L'

#define PLAYER_EVENT_SESSION_PIN_REQUIRED           0x80100020      
/*!< @brief Notification that a valid PIN check is required using #PLAYER_API_Session_CheckPIN. @see #PLAYER_EVENT_Session_Pin_Required_PropId */


*comp-pin*

Watershed rules
https://spvss-confluence.cisco.com/display/SE/Parental+Control#ParentalControl-Watershedrules


// src/server/ca/vgc/spm_vgc_xsi_sc.c
/*
 * BBFC ratings are represented by integers in this way:
 * Rating:   Integer:
 * unrated   0
 * U         1
 * PG        2
 * 12        3
 * 15        4
 * 18        5
 *
 * The bitmap for VGC is constructed by setting the i'th bit of byte 0, and setting all bits of bytes 1->3 to zero
 * Basically the 6 LSB of byte zero are used as:
 * -----------------------------------------------------
 * | 5(18) | 4(15) | 3(12) | 2(PG) | 1(U) | 0(unrated) |
 * -----------------------------------------------------
 * a value of 0x3F it means that the user can watch everything (PREFS value = 5).
 * a value of 0x1F it means that the user can watch all programmes but 18 rated programmes (PREFS value = 4)
 * a value of 0xF it means that the user can watch all programmes but 18 and 15 rated programmes (PREFS value = 3)
 * a value of 0x7 it means that the user can watch all programmes but 18 and 15 and 12 rated programmes (PREFS value = 2)
 * a value of 0x3 it means that the user can watch all programmes but 18 and 15 and 12 and PG rated programmes (`PREFS value = 1`)
 * a value of 0x1 it means that the user can watch all unrated programmes (PREFS value = 0)
 */

 ~~~ CA Properties
Pin On PreWaterShed Playback  = 0x03 (ERROR Value) 
Online Pin                    = 0x02 (On) 
Pin Needed                    = 0x01 (Off) 
User Rating                   = 0x01 (1) 
Pin Time 4H Callback          = 0x00 (0) 
Pin callback handle           = 0x05 (5) 
Pin Attempt                   = 0x03 (3) 
Pin Needed Callback           = 0x01 (Off) 
Pin Restrictions              = 0x02 (Enabled) 
Pin Code                      = 0x0000 
Pin at Startup                = 0x01 (Disabled) 
Purchase Pin                  = 0x02 (Enabled) 
User Settings Pin             = 0x01 (Disabled) 
STB Pin Code                  = 0x0000 


// when watershed is on
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_ConvertRatingValueToBitmap L:195 > PLAYER_PIN_ConvertRatingValueToBitmap, Rating: 3 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_VGCCheckRatingExceeded L:273 > Activity: 6 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_VGCCheckRatingExceeded L:286 > {PR} ""event rating[3], threshold[4] (source:PREFS), operator rating [255] 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_VGCCheckRatingExceeded L:304 > Rating exceeded watershed: true 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_PinRequiredForSIRating L:383 > Rating exceeded. Need pin 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2072 > {PR} ""Check PIN from Planner's rating 
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2111 > {PR} ""*need_pin_for_service:    false  
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2112 > {PR} ""*need_pin_for_event:      true  
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2113 > {PR} ""*need_pin_for_locked:     false  
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2114 > {PR} ""*need_pin_for_manual:     false  
== !INFO   -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_IsPinRequired L:2115 > {PR} ""pin_reason: 0x12 pin_requested false 
== !MIL    -P_Api        		< p:0x00000204 P:APP t:0x01441520 T:PLAYER_MAIN M:player_pin.c F:PLAYER_PIN_Milestone L:2930 > {PR} 
""PREPLAY-PIN_REQUIRED, locator:null events_happened(SFLAGS ) job_type(PLAYER_JOB_TYPE_PLAYBACK) reason(EVENT_RATING WATERSHED ) source(SOURCE_PLANNER) event_rating_state(STATE_PRESENT) event_rating(3) user_rating(4) 


//../DARWIN_PREFS/inc/prefs_api_ca.h *comp-pref*
/**
 @brief Enumeration for PREFS_API_CA_PROPID_UINT32_PIN_ON_PRE_WATERSHED_PLAYBACK
*/
typedef enum prefs_api_ca_pin_on_pre_watershed_playback_type {
    PREFS_API_CA_PIN_ON_PRE_WATERSHED_PLAYBACK_UNDEF            = 0U,
     /**< Uninitialised */
    PREFS_API_CA_PIN_ON_PRE_WATERSHED_PLAYBACK_OFF              = 1U,
    /**< PIN is not required for pre-watershed playback */
    PREFS_API_CA_PIN_ON_PRE_WATERSHED_PLAYBACK_ON		= 2U,
    /**< PIN is required for pre-watershed playback */
    PREFS_API_CA_PIN_ON_PRE_WATERSHED_PLAYBACK_LAST_VALUE       = 3U
    /**< Last Value */
}PREFS_API_CA_PinOnPreWatershedPlayback_Type;

/**
 @brief Enumeration for PREFS_API_CA_PROPID_UINT32_ONLINE_PIN
*/
typedef enum prefs_api_ca_online_pin_type {
    PREFS_API_CA_ONLINE_PIN_UNDEF	= 0U,
     /**< Uninitialised */
    PREFS_API_CA_ONLINE_PIN_OFF		= 1U,
    /**< PIN is not required before going online */
    PREFS_API_CA_ONLINE_PIN_ON		= 2U,
    /**< PIN is required before going online */
    PREFS_API_CA_ONLINE_PIN_LAST_VALUE  = 3U
    /**< Last Value */
}PREFS_API_CA_OnlinePin_Type;

/**
 @brief Enumeration for PREFS_API_CA_PROPID_UINT32_KEEP_PIN_NEEDED
*/
typedef enum prefs_api_ca_keep_pin_needed_type {
    PREFS_API_CA_KEEP_PIN_NEEDED_UNDEF		= 0U,
     /**< Uninitialised */
    PREFS_API_CA_KEEP_PIN_NEEDED_OFF		= 1U,
    /**< PIN is not required to change keep programmes */
    PREFS_API_CA_KEEP_PIN_NEEDED_ON		= 2U,
    /**< PIN is required to change keep programmes */
    PREFS_API_CA_KEEP_PIN_NEEDED_LAST_VALUE     = 3U
    /**< Last Value */
}PREFS_API_CA_KeepPinNeeded_Type;

/**
 @brief Enumeration for PREFS_API_CA_PROPID_UINT32_PIN_RESTRICTIONS
*/
typedef enum prefs_api_ca_pin_restrictions_type {
    PREFS_API_CA_PIN_RESTRICTIONS_UNDEF         = 0U,
     /**< Uninitialised */
    PREFS_API_CA_PIN_RESTRICTIONS_DISABLED      = 1U,
    /**< PIN restrictions are enabled */
    PREFS_API_CA_PIN_RESTRICTIONS_ENABLED       = 2U,
    /**< PIN restrictions are disabled */
    PREFS_API_CA_PIN_RESTRICTIONS_LAST_VALUE    = 3U
    /**< Last Value */
}PREFS_API_CA_PinRestrictions_Type;


<player-rate>
# rating checks
< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessCASI L:04594 > Job is scrambled
< T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessCASI L:04595 > Limit exceeded: true


<player-speed>
NDS: ^[2017:04:24 13:00:32]0946818475.675422 !MIL    -VRM_SERVER   		< p:0x000001e8 P:MW t:0x01d53520 T:VRM_SRV M:pvp_play.c F:PANEL_PlaySetSpeed L:318 > [API_CALL::""MSM_SP""] " "calling MSM_SP_SetSpeed mcon= 0x170, speed: 0x3e8 
NDS: ^[2017:04:24 13:00:32]0946818475.675447 !MIL    -MSM          		< p:0x000001e8 P:MW t:0x01d53520 T:VRM_SRV M:msm_sp.c F:(MSM_SP_SetSpeed) L:781 > MSM_SP_SetSpeed " "hMC=0x170, speed=1000  Starts...  
NDS: ^[2017:04:24 13:00:32]0946818475.675467 !MIL    -MSM          		< p:0x000001e8 P:MW t:0x01d53520 T:VRM_SRV M:msm_sp.c F:(MSM_SP_SetSpeed) L:793 > @@PMON@@,mark,pvr,set-speed,368,new-speed=,1000 
NDS: ^[2017:04:24 13:00:32]0946818475.826793 !ERROR  -EPG_PLAY     		< p:0x000001ea P:APP t:0x2e242520 T:no name M:SpeedChangeDetails F:<init> L:49 > T:PooledExecutor#4:@TM @@: speed=1000 exception=100
NDS: ^[2017:04:24 13:00:32]0946818475.827236 !ERROR  -EPG_PLAY     		< p:0x000001ea P:APP t:0x2e242520 T:no name M:TrickModes F:playbackSpeedChangeCallback L:260 > T:PooledExecutor#4:@TM @@: Speed change notification: Speed=1000:expected:incoming


<player-get-position> <player-session-property>
// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/playerimpl/PlayerSessionImpl.java
    @Override public synchronized int getStreamPosition()
            throws PlayerDataUnavailableException
    {
        assertValid();
        return natPlayerApiSessionGetInt32(nativeHandle, PropId.STREAMPOSITION);
    }

    @Override public int getStreamPositionFromEnd() throws PlayerDataUnavailableException
    {
        assertValid();
        return natPlayerApiSessionGetInt32(nativeHandle, PropId.STREAMPOSITIONFROMEND);
    }

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/c/src/natPlayerSessionImpl.c
JNIEXPORT jint JNICALL Java_com_nds_fusion_playerimpl_PlayerSessionImpl_natPlayerApiSessionGetInt32
{
    status = PLAYER_API_Session_GetInt32(jSessionHandle, (PLAYER_API_Session_PropId)jPropId, &l_value);
}

/**
 @brief Session object property identifiers.
 These are read only values.
*/
typedef enum  {
    PLAYER_API_Session_PropId_Int32_StreamPosition                 = 10U, /**< The session stream position from beginning. This property can be changed via a call to #PLAYER_API_Session_SetPosition. */
    PLAYER_API_Session_PropId_Int32_StreamPositionFromEnd          = 11U, /**< The session stream position from end. This property can be changed via a call to #PLAYER_API_Session_SetPosition. */
} PLAYER_API_Session_PropId;

// CMS_MEDIA_SERVICES/MSM/inc/msm_types.h
/**
 * @brief The data of the position event
 */
typedef struct MSM_POSITION_TAG
{
  MSM_VFILE_POSITION		 vfile_offset_msec; /*!< @brief offset in milli seconds in the vfile */
  xint64_t			 abs_position_msec;	/*!< @brief Absolute position */
  SYSTEMTIME_TIMEDATE	 utc;				/*!< @brief Absolute time */
  xint64_t			 abs_bytes;			/*!< @brief Absolute position in bytes */
} MSM_POSITION;


#define     MSM_UNIT_V_OFFSET       0x00000001U  /*!< @brief Offset from v-file in milliseconds (according to reference point) */
#define     MSM_UNIT_ABS_POSITION   0x00000002U  /*!< @brief Absolute position in milliseconds */
#define     MSM_UNIT_UTC            0x00000004U  /*!< @brief Absolute time in UTC */

// conversion from pts to position?
!INFO   -P_Api        		< P:APP T:no name M:player_api_session.c F:PLAYER_API_Session_GetInt32 L:2237 > Requested property is StreamPosition 
!INFO   -MSM_MS       		< P:MW  T:MSMDispatcher M:ms_fusion.cpp F:(MS_FUSION::GetPosition) L:2028 > < no-ctx >" "-MS_GET_API- hMC=0x7 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:splicer.cpp F:(HandleSplicerRequestDoActionList) L:2911 > <  >" "xcon=7 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:splicer.cpp F:(CompleteDoActionList) L:3580 > <  >" "IN 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:item.cpp F:(DoActionList) L:4101 > < splicer=0x7 hMC=0x7 >" "-MS_GET_API_ITEM- action_list=E_ITEM_LOCAL_PB_ACT_GET_SPEED_POSITION 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:item.cpp F:(CanDoAction) L:15439 > < splicer=0x7 hMC=0x7 >" "action=E_ITEM_LOCAL_PB_ACT_GET_SPEED_POSITION 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:item.cpp F:(IsAtEdgeOfFile) L:7350 > < splicer=0x7 hMC=0x7 >" "xcon = 7, is_edge_of_file = XFALSE 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetPosition) L:781 > < splicer=0x7 hMC=0x7 >" "get position using method 2 
!INFO   -MSM_MS       		< P:MW  T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetPts) L:8490 > < no-ctx >" "-MS_CDI_CONTROL- returning PTS [0,250212598] 

// can use script to see which pts used to calc position and to do
// interpolation.
//
// may see this warning
// /* MAX_ACCEPTED_PTS_JUMP - we don't expected more than 5 seconds without PTS */
// #define MAX_ACCEPTED_PTS_JUMP     (90000*5) /* 5 seconds */
// !WARN   -MSM_MS       		< P:MW T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6174 > < splicer=0x7 hMC=0x7 >" "Warning: received PTS [0,250727398] jumps 7 secs diff from " "previous one (pts=[0,250028998],chunk_id=7518, index=17).  
//
// from ms ppt:
// On request to calculate the display position:
// MS gets the displayed PTS from the video decoder
// MS uses the PTS-packet offset mapping to interpolate the packet number matching the displayed PTS
// MS uses MDI to convert the packet offset to time offset
//
// from the investigation, Tim say:
//
// While I agree that the PTS->packetNum interpolation would be somewhat worse
// in the middle of chunk 17, that error will have reduced as the end of the
// chunk is reached, and the problem is MSM’s assumption that PCRPTS, i.e.
// the next stage in the mapping, where the main error is introduced.
// 
// The following graphs compare the position errors with the PTS-PCR delta.
// Note that they will not be the same, because MSM samples the PTS/packet
// numbers every 2048 packets and interpolates between them, so the errors are
// somewhat less noisy than the PTS-PCR delta. Note that this is not the only
// possible source of errors  variable-length open GOPs can also create large
// errors, but that does not seem relevant in this case.
//
// Looking through the MW log, I don’t see anything that indicates a MW bug.
// E.g. the correct chunks are being selected for the
// PTS->packetNum->playbackPosition mappings. The problem is because XTVe
// indexes with PCR for compatibility with RASP, which uses PCR because PTS
// could be in encrypted packets in linear.
//
// In this case, the video encoder has illegal PTS-PCR differences, but a
// high-but-legal difference would also be problematic.
//
// (So if there are huge ptc-pcr differnece in the strem input, decoder will
// hold up pts longer which returns same pts to MS for longer time. This has
// an effect which looks time go slow. So position go slow.)

!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CalcUserPosByPtsAndNotifyItem) L:10245 > < splicer=0x7 hMC=0x7 >" "Using PTS [0,250212598] to calc position, Audio only=XFALSE 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(FindChunksForPTSInterpolation) L:11086 > < splicer=0x7 hMC=0x7 >" "returning entries 17 (PTS [0,250028998]), 18 (PTS [0,250727398]) 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetPacketAndTimeFromHistory_ByPts) L:10563 > < splicer=0x7 hMC=0x7 >" "Interpolate/extrapolating packet num and time 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(GetPacketAndTimeFromHistory_ByPts) L:10637 > < splicer=0x7 hMC=0x7 >" "pts is (0,250212598), time stamp ([2055:08:12 13:50:34]2147483647,4294967295), packet num (0,12132890) 

!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CalcUserPosByPtsAndNotifyItem) L:10269 > < splicer=0x7 hMC=0x7 >" "USER POSITION using ***PTS***: " "has_advanced XTRUE, packet_number [0,12132890], " "packet_time [[2055:08:12 13:50:34]2147483647,4294967295] 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:transition_controller.cpp F:(FilterGetPositionCallbackHandler) L:5009 > < splicer=0x7 hMC=0x7 >" "xcon = 7, has_advanced = XTRUE, get ms_status = MS_STATUS_OK  
!WARN   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:transition_controller.cpp F:(ResolveUserTimeByPacketWithDelta) L:4276 > < splicer=0x7 hMC=0x7 >" "call packet 2 time conversion for packet=(0, 12132890) with delta=(0, 0)ms 
!INFO   -MSM_MS       		< P:MW  T:MDI_WT_THREAD M:mdi_server.c F:(HandleClientRequest) L:3029 > < no-ctx >" "ConvertPacketToTime - reduced one from packet " "num, as MDI count from 0. new pkt num=[0,12132889] 
!INFO   -MSM_MS       		< P:MW  T:MDI_WT_THREAD M:mdi_server.c F:(HandleClientRequest) L:3062 > < no-ctx >" "called MetaConvertPacket[ToTime](context=[2055:08:12 13:51:00]2147483673," " packetNum=(0, 12132889)) -> 0, newTime=(0, 2777048)," " packet=(0, 12132889)) 
!INFO   -MSM_MS       		< P:MW  T:MDI_WT_THREAD M:mdi_server.c F:(HandleClientRequest) L:3078 > < no-ctx >" "ConvertPacketToTime - added back one to packet num." " given pkt num=[0,12132890]. new pkt num=[0,12132890]. " "time=(0, 12132890) 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:item.cpp F:(CompleteDoingActionList) L:5602 > < splicer=0x7 hMC=0x7 >" "-MS_GET_API_ITEM- Action list done successfully " "action_list=E_ITEM_LOCAL_PB_ACT_GET_SPEED_POSITION 
!INFO   -MSM_MS       		< P:MW  T:EVENT_MGR_THREAD M:splicer.cpp F:(RequestHandlerFsm_HandleRequestCompletedEvent) L:2188 > <  >" "-MS_SPLICE- m_req_handler_fsm_state E_SPLICER_REQ_HANDLER_FSM_ST_HANDLING_REQ 
!INFO   -MSM_MS       		< P:MW  T:CLIENT_NFY_THREAD M:ms_fusion.cpp F:(FusionAPIFrontEndCallback) L:15816 > < no-ctx >" "-MS_GET_API- hMC=0x7 Nfy position nfy_reason=2 status=92295168 pos_in_milli=(0,2777048) 
!INFO   -P_Api        		< P:APP T:no name M:player_api_session.c F:PLAYER_PRV_GetStreamPosition L:2109 > f_position_value = 2777048 
!INFO   -P_Api        		< P:APP T:no name M:player_api_session.c F:PLAYER_PRV_GetStreamPosition L:2184 > l_position = 2777048 


<to-check-pts-from-driver>
// push a chunk and get pts from tpid monitor
!INFO   -MSM_MS       		< P:MW T:CDI_WT_THREAD M:cdi_server.c F:(HandleAddChunkToChunkInput) L:6411 > < no-ctx >" "-MS_CDI_CONTROL- 
  Adding chunk to chunk input queue. " "chunk input fd = 418, p_address = 0x2c6d2000, num bytes = 192512 " "chunk_id = 7519 
!INFO   -MSM_MS       		< P:MW T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:6868 > < no-ctx >" "-MS_CDI_CONTROL- TPIDMONITOR_READ array length 8, " "returned 1 entries 
!INFO   -MSM_MS       		< P:MW T:CDI_WT_THREAD M:cdi_server.c F:(HandleGetChunkInputTPIDMonitorData) L:6884 > < no-ctx >" "-MS_CDI_CONTROL- FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 7519, `PTS (0,250727398)` 

// maps chunk id to list id
!INFO   -MSM_MS       		< P:MW T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5927 > < splicer=0x7 hMC=0x7 >" "num blocks read 1 
!INFO   -MSM_MS       		< P:MW T:EVENT_MGR_THREAD M:display_chunk.cpp F:(HandleChunkInputTPIDMonitorData) L:5946 > < splicer=0x7 hMC=0x7 >" "FIRST_PTS=true, DISCONTINUITY=false pid 481, chunklist ID 7519, PTS (0,250727398) 
!INFO   -MSM_MS       		< P:MW T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6125 > < splicer=0x7 hMC=0x7 >" "found prev_pts (pts=[0,250028998],chunk_id=7518, index=17). 
!INFO   -MSM_MS       		< P:MW T:EVENT_MGR_THREAD M:display_chunk.cpp F:(CheckPTSFromDrivers) L:6136 > < splicer=0x7 hMC=0x7 >" "found prev_prev_pts (pts=[0,249978598],chunk_id=7517, index=16). 


// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_api_session.c

SYSTEM_STATUS PLAYER_API_Session_GetInt32()

        case PLAYER_API_Session_PropId_Int32_StreamPosition:
            PLAYER_DIAG_LOG_INFO(("Requested property is StreamPosition"));

                if(!SYSTEM_STATUS_IS_OK(PLAYER_PRV_GetStreamPosition(&l_sc_data->active_job, MSM_REF_POINT_VSTART, MSM_UNIT_V_OFFSET, &l_position)))
                {
                    PLAYER_DIAG_LOG_ERROR(("Failed to retrieve PLAYER_API_Session_PropId_Int32_StreamPosition"));
                }
                else
                {
                    if (l_position.position_value.position < 0)
                    {
                        l_status = PLAYER_API_STATUS_FAILURE;
                    }
                    else
                    {
                        PLAYER_DIAG_LOG_WARN(("KT: StreamPosition: %d", l_position.position_value.position ));
                        *int32Value = l_position.position_value.position;
                        l_status = PLAYER_API_STATUS_OK;
                    }
                }
            break;


<plyaer-subtitle> comp-subtitle
#-----------------------------------------------------------
# PR#22932: muteSubtitles not working. Player. Closed.  
#-----------------------------------------------------------
From p01.25 baseline, Picasso has changed its implementation to use only mute player API and this cause this problem when DCA back from SCR to CLR.

From log, when DCA back to CLR, player set subtile mute value(subtitle_muted) as 0 meaning subtiltle ON before APP call to subtitle ON.

---
NDS: ^0946685674.711695 !MIL   -MPM          < M:mpm_component_audio.c F:MPMComponentAudioStart L:00392 > DECODER_STARTED: hMC=20

NDS: ^0946685674.720560 !ERROR -P_Api        < M:player_dvb_subtitles.c F:PLAYER_Subtitles_Can_Start_Teletext L:00416 > 
KT: subtitle_muted=1 /prefs subtitles_enabled=1, local subtitles_enabled=0,speed_ok=1,history_enabled=0,subtitles_db_enabled=1 -->can_start_subtitles=1

NDS: ^0946685675.267676 !MIL   -MPM          < M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:00652 > FRAME_PRESENTED: hMC=20

(This is WRONG)
NDS: ^0946685675.289179 !ERROR -P_Api        < M:player_dvb_subtitles.c F:PLAYER_Subtitles_Can_Start_Teletext L:00416 > 
KT: subtitle_muted=0 /prefs subtitles_enabled=1, local subtitles_enabled=0,speed_ok=1,history_enabled=0,subtitles_db_enabled=1 -->can_start_subtitles=1

NDS: ^0946685676.759576 !ERROR -P_Api        < M:player_dvb_subtitles.c F:Set_Visibility L:01052 > KT: Set_Visibility : subtitle_muted=0,visibility=1

(APP API CALL)
NDS: ^0946685680.356890 !ERROR -P_Api        < M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetSubtitleMute L:01817 > KT: Set Subtitle Mute =0

NDS: ^0946685680.357351 !ERROR -P_Api        < M:player_dvb_subtitles.c F:PLAYER_Subtitles_Can_Start_Teletext L:00416 > 
KT: subtitle_muted=0 /prefs subtitles_enabled=1, local subtitles_enabled=0,speed_ok=1,history_enabled=0,subtitles_db_enabled=1 -->can_start_subtitles=1


There is a Player fix which revise Player muteSubtile API and resolves this and other problem. The other problem is subtile over guide when coming out of stand by mode. Previously, this API works only when video is running. 


NDS: ^[2018:03:12 11:04:25]0000019062.866092 !INFO   -com.bskyb.epgui		< p:0x000009a9 P:APP t:0xa4c3b1d0 T:no name M:SubtitlesMediator.cpp F:SubtitlesMediator::SubtitlesMediator(ISubtitles&, const IGadgetV L:28 > ******************************************************* SUBTITLES MUTED

NDS: ^[2018:03:12 11:05:15]0000019112.507201 !INFO   -com.bskyb.epgui		< p:0x000009a9 P:APP t:0xa4c3b1d0 T:no name M:SubtitlesMediator.cpp F:SubtitlesMediator::SubtitlesMediator(ISubtitles&, const IGadgetV L:32 > ******************************************************* SUBTITLES UN-MUTED


#-----------------------------------------------------------
# PlayTone
#-----------------------------------------------------------
PLAYER_API_AVControl_PlayTone
	MPM_PRES_PlayTone
		MPM_IPCClient_CallServer(MPM_IPC_FUNCTION_ID_PRES_PLAY_TONE)
		
		MPM_IPCServer_HandleRPC
			SYSTEMITC_API_PostEvent(g_MPM_ITC_QUEUE_MAIN,MPM_ITC_EV_IPCSERVER_HANDLE_RPC)
			
			MPM_ITCMainThread
				f_MPM_ITC_main_handler
				{MPM_ITC_EV_IPCSERVER_HANDLE_RPC,       MPM_IPCServer_ProcessIncomingCall},         /* offset from MPM_ITC_EV_BASE */
				
				MPM_IPCServer_ProcessIncomingCall
					f_mpm_function_mappings
					{MPM_IPC_FUNCTION_ID_PRES_PLAY_TONE, MPM_PresPlayTone},
					
					MPM_PresPlayTone
						/* We've got the tone info, now check and see if we can get a pcm player */
						if (MPM_SHAREDDEVICE_IoctlWait(audio_clip_info->p_decoder.p_pcm_player->device_fd, PCM_PLAYER_FLUSH_BUFFER, NULL) != MPM_STATUS_OK)
						
						if (MPM_SHAREDDEVICE_IoctlWait(audio_clip_info->p_decoder.p_pcm_player->device_fd, PCM_PLAYER_TONE_START, &player_tone) != MPM_STATUS_OK)


#-----------------------------------------------------------
# PR#26485: moveToNextCACondition 
#-----------------------------------------------------------
# it's right to have the following in app as app need to wait when playback a recording in the CA hole:
in Picasso to not call moveToNextCACondition in the period between starting playback and getting a PlayerEventSessionStartImpl event 


<player-output-control> <player-blue-screen> *player-blank* *player-standby*

JNIEXPORT void JNICALL Java_com_nds_fusion_playerimpl_PlayerAVControlImpl_natSetVisibility
  (JNIEnv *env, jclass jClass, jint l_handle, jint l_source, jboolean l_visible)
{
  /**
   * @brief Set the visibility of a Video or still or graphics source
   *
   * @param[in] avcontrol Handle to the Player AVControl object
   * @param[in] source Indicates whether the Video or Still or graphics source is to be addressed
   * @param[in] visible Indicates whether the source is to be visible or not visible
   * @retval #PLAYER_API_STATUS_OK on success
   * @retval #PLAYER_API_STATUS_FAILURE failure code on an error
   * @post To physically apply the requested modification, the client has to call the
   * @see #PLAYER_API_AVControl_UpdateDisplay
   *
   * This function will visible or not visible the Video or still or graphics source.
   * If visible is false, PLAYER shall disable visibility of the source.
   * If visible is false, PLAYER shall enable visibility of the source.
   */
  status = PLAYER_API_AVControl_SetVisibility((PLAYER_API_AVControl_Handle)l_handle,
      (PLAYER_API_AVControl_SourceType)l_source, l_visible);
}

PLAYER_API_AVControl_UpdateDisplay

JNIEXPORT void JNICALL Java_com_nds_fusion_playerimpl_PlayerAVControlImpl_natUpdateDisplay
  (JNIEnv *env, jclass jClass, jint param1)
{
    PLAYER_API_AVControl_Handle avControl_handle = (PLAYER_API_AVControl_Handle)param1;
    SYSTEM_STATUS status                         = PLAYER_API_STATUS_FAILURE;

    /*
     Method needs to be called after:
        . PLAYER_API_AVControl_SetWindows
        . PLAYER_API_AVControl_SetTransparency
        . PLAYER_API_AVControl_SetVisibility
        . PLAYER_API_AVControl_InvalidateRectangle
        . PLAYER_API_AVControl_InvalidateRegion
    */

    status = PLAYER_API_AVControl_UpdateDisplay(avControl_handle);
}

!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_UpdateDisplay L:5072 > |-> PLAYER_API_AVControl_UpdateDisplay
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_UpdateDisplay L:5076 > avcontrol=2 
!ENTER  -P_Api < T:LAE_THREAD M:player_api_context.c F:PLAYER_Context_GetContextFromSession L:1697 > |-> PLAYER_Context_GetContextFromSession
!INFO   -P_Api < T:LAE_THREAD M:player_api_context.c F:PLAYER_Context_GetContextFromSession L:1715 > Context : MAIN_TARGET 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_context.c F:PLAYER_Context_GetContextFromSession L:1721 > <-| PLAYER_Context_GetContextFromSession : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3212 > |-> PLAYER_PRV_AVControl_UpdateSurface
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3480 > <-| PLAYER_PRV_AVControl_UpdateSurface : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3212 > |-> PLAYER_PRV_AVControl_UpdateSurface
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1124 > |-> PLAYER_AVControl_UpdateVisibility
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1210 > surface 0x0156ccf4 set the visibility 0 of the windows index=0 OK 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1244 > <-| PLAYER_AVControl_UpdateVisibility : return_status = 0x6801000
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3480 > <-| PLAYER_PRV_AVControl_UpdateSurface : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3212 > |-> PLAYER_PRV_AVControl_UpdateSurface
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurface L:3480 > <-| PLAYER_PRV_AVControl_UpdateSurface : return_status = 0x6801000

<player-output-control-resolution>
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateDisplay L:4482 > |-> PLAYER_AVControl_UpdateDisplay
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4663 > |-> PLAYER_PRV_AVControl_UseMixerBlend
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_GetVideoInformation L:4775 > |-> PLAYER_PRV_AVControl_GetVideoInformation
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_GetVideoInformation L:4794 > reset_window=0 app_visibility=1 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_GetVideoInformation L:4809 > l_is_video_visible=1 l_is_video_full_screen=0 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_GetVideoInformation L:4812 > <-| PLAYER_PRV_AVControl_GetVideoInformation : return_status = 0x6801000
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4702 > Mixer Window visible source=3 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4754 > Use mixer blend =0 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4755 > reset output =0 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4756 > Destination dimension  l_max_width=720 l_max_height=576 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UseMixerBlend L:4762 > <-| PLAYER_PRV_AVControl_UseMixerBlend : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:977 > |-> PLAYER_WINGFX_UpdateGraphicsDestinations
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1029 > >> plane surface dimension : width=1280 height=1080 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1030 > >> plane dimension : width=1920 height=1080 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1031 > >> input_window->width=720 input_window->height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1061 > Setting input_plane_width=1280 to avoid watermarking graphics glitches 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1106 > >> input_plane_width=1280 input_plane_height=1080 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1109 > >> input_plane_width=1280 input_plane_height=1080 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1137 > Source Areas Updated 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1153 > Scaler source area has changed 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1029 > >> plane surface dimension : width=720 height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1030 > >> plane dimension : width=720 height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1031 > >> input_window->width=720 input_window->height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1106 > >> input_plane_width=720 input_plane_height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1109 > >> input_plane_width=720 input_plane_height=576 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1137 > Source Areas Updated 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1153 > Scaler source area has changed 
!EXIT   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_UpdateGraphicsDestinations L:1333 > <-| PLAYER_WINGFX_UpdateGraphicsDestinations : return_status = 0x0
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateDisplay L:4611 > GFX_REGION_Empty() returned OK 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateDisplay L:4643 > <-| PLAYER_AVControl_UpdateDisplay : return_status = 0x6801000

!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurfaceVisibility L:3989 > |-> PLAYER_PRV_AVControl_UpdateSurfaceVisibility
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1254 > |-> PLAYER_AVControl_SetVideoVisibility
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1272 > Try to set the video visibility to TRUE of the context MAIN_TARGET and current visibility is FALSE 
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_ConfigureGraphicsPresentation L:6078 > |-> PLAYER_AVControl_ConfigureGraphicsPresentation
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_ConfigureGraphicsPresentation L:6112 > Nothing to configure for MAIN target 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_ConfigureGraphicsPresentation L:6166 > Update Display not required 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_ConfigureGraphicsPresentation L:6169 > <-| PLAYER_AVControl_ConfigureGraphicsPresentation : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1124 > |-> PLAYER_AVControl_UpdateVisibility
!ENTER  -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5534 > |-> PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5539 > plane handle 79, composition 0x0000004c 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5541 > is_plane_hdcp_mute =0, set the plane visibility=1 
!EXIT   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5580 > <-| PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5534 > |-> PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5539 > plane handle 79, composition 0x00000048 
!INFO   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5541 > is_plane_hdcp_mute =0, set the plane visibility=1 
!EXIT   -P_Api < T:LAE_THREAD M:player_wingfx.c F:PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible L:5580 > <-| PLAYER_WINGFX_VideoComposition_MakeSurfacePlaneVisible : return_status = 0x6801000
!MIL    -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1170 > VIDEO IS SHOWN 
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:PLAYER_UAM_SignalVideoStatusUpdate L:1798 > |-> PLAYER_UAM_SignalVideoStatusUpdate
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:FindPlayerSurfaceMatch L:1777 > |-> FindPlayerSurfaceMatch
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:FindPlayerSurfaceMatch L:1788 > <-| FindPlayerSurfaceMatch : return_status = 0x0
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:FindPlayerSurfaceMatch L:1777 > |-> FindPlayerSurfaceMatch
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:FindPlayerSurfaceMatch L:1788 > <-| FindPlayerSurfaceMatch : return_status = 0x1
!INFO   -P_Api < T:LAE_THREAD M:player_uam.c F:PLAYER_UAM_SignalVideoStatusUpdate L:1830 > event type = UAM_API_EVENT_TYPE_VIDEO_STATUS 
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_DisplayTarget L:1934 > |-> Get_UAM_DisplayTarget
!INFO   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_DisplayTarget L:1959 > Display Target = [ 0x1 ] - MAIN 
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_DisplayTarget L:1961 > <-| Get_UAM_DisplayTarget : return_status = 0x1
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_EventSource L:1868 > |-> Get_UAM_EventSource
!INFO   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_EventSource L:1923 > Event Source = [ 0x0 ] - RECORD 
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_EventSource L:1925 > <-| Get_UAM_EventSource : return_status = 0x0
!ENTER  -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_VideoRunningStatus L:1970 > |-> Get_UAM_VideoRunningStatus
!INFO   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_VideoRunningStatus L:1990 > Video Running Status = [ 0x2 ] - PARTIAL SCREEN 
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:Get_UAM_VideoRunningStatus L:1992 > <-| Get_UAM_VideoRunningStatus : return_status = 0x2
!EXIT   -P_Api < T:LAE_THREAD M:player_uam.c F:PLAYER_UAM_SignalVideoStatusUpdate L:1860 > <-| PLAYER_UAM_SignalVideoStatusUpdate : return_status = 0x0
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1244 > <-| PLAYER_AVControl_UpdateVisibility : return_status = 0x6801000
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1446 > <-| PLAYER_AVControl_SetVideoVisibility : return_status = 0x6801000
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_PRV_AVControl_UpdateSurfaceVisibility L:4018 > <-| PLAYER_PRV_AVControl_UpdateSurfaceVisibility : return_status = 0x6801000
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_UpdateDisplay L:5237 > <-| PLAYER_API_AVControl_UpdateDisplay : return_status = 0x6801000

!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1076 > |-> PLAYER_API_AVControl_SetVisibility
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, `source=3, visible=1` 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1098 > SetVisibility GRAPHICS TRUE 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1114 > <-| PLAYER_API_AVControl_SetVisibility : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1076 > |-> PLAYER_API_AVControl_SetVisibility
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=1, visible=1 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1114 > <-| PLAYER_API_AVControl_SetVisibility : return_status = 0x6801000
!ENTER  -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1076 > |-> PLAYER_API_AVControl_SetVisibility
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=2, source=2, visible=0 
!INFO   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1103 > SetVisibility STILL NO 
!EXIT   -P_Api < T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1114 > <-| PLAYER_API_AVControl_SetVisibility : return_status = 0x6801000


<player-output-control-source>
/**
 @brief Types of AV sources
*/
typedef enum {
    PLAYER_API_AVControl_SourceType_Video      = 1U, /**< Video source type */      botton
    PLAYER_API_AVControl_SourceType_Still      = 2U, /**< Still source type */
    PLAYER_API_AVControl_SourceType_Graphics   = 3U, /**< Graphics source type */   top
    PLAYER_API_AVControl_SourceType_ComposedSurface   = 4U, /**< Composed surface source type */
}PLAYER_API_AVControl_SourceType;

// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_api_avcontrol.c

// * @brief Set the visibility of a Video or still or graphics source
SYSTEM_STATUS PLAYER_API_AVControl_SetVisibility(PLAYER_API_AVControl_Handle avcontrol,
                                                 PLAYER_API_AVControl_SourceType source,
                                                 bool visible)
{}

SYSTEM_STATUS PLAYER_AVControl_SetVideoVisibility(PLAYER_SERVICE_CONTEXT_DATA *sc_data, bool visibility)
{
  uint32_t l_background_color = (l_apply_visibility == true) ?
    g_player_component.default_unblancking_background_color : g_player_component.default_blancking_background_color;

  if(!SYSTEM_STATUS_IS_OK(PLAYER_PRV_SetBackgroundColour(PLAYER_PIXEL_FORMAT,
          l_background_color)));

  // leads to
  //
  // /*===========================================================================*/
  // /**  @brief Allows BEM clients to set the background colour for an Output
  //   *  Composition.
  //   *
  //   *  @param[in] composition Identifies the Output Composition to which the
  //   *                         setting applies.
  //   *  @param[in] format Defines the background colour pixel format. As used in
  //   *                    BlenderBackgroundColour from CDI ioctl
  //   *                    BLENDER_SET_BACKROUND_COLOUR (CDI V6 section 10.4.7.6).
  //   *                    i.e. PIXEL_FORMAT_XXX from CDI's graphics.h.
  //   *  @param[in] colour Defines the background colour pixel value in the pixel
  //   *                    format indicated by the pixel format parameter. As used
  //   *                    in BlenderBackgroundColour from CDI ioctl
  //   *                    BLENDER_SET_BACKROUND_COLOUR (CDI V6 section 10.4.7.6).
  //   *
  //   *  @return BEM_STATUS_OK if successful or BEM_STATUS_NOT_OK on any error.
  //   *
  //   */
  // SYSTEM_STATUS BEM_OC_VideoComposition_SetBackgroundColour()
  // {}
}


// player.cfg 
[BACKGROUND_COLORS]
DEFAULT_BLANCKING_COLOUR=0xFF0C0B4F   // blue, blank, HIDE, visibility is false
DEFAULT_UNBLANCKING_COLOUR=0x0        // black, unblank, SHOWN, visibilty is true

// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_common.c
        else if (SYSTEMCONFIG_STATUS_OK != (SYSTEMCONFIG_GetIntegerValue(l_config_handle,
            f_cfg_section_bg_colours, "DEFAULT_UNBLANCKING_COLOUR", &(g_player_component.default_unblancking_background_color))))


// epg and lae use this API
#define GFX_PIXEL_FORMAT_`ARGB32`_8888          (0x00000002UL)   /*!< @brief Pixel mode ARGB32 8888. */

SYSTEM_STATUS PLAYER_API_AVControl_SetBackgroundColour(PLAYER_API_AVControl_Handle avcontrol,
                                                       GFX_PixelFormat format,
                                                       uint32_t colour)
{}

// dark blue
!INFO   -P_Api        		< P:APP t:0x2c157520 T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetBackgroundColour L:1814 > 
avcontrol=3, format=0x2, colour=0xff0a1a3b 

// black
!INFO   -P_Api        		< P:APP t:0x01722520 T:LAE_THREAD M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetBackgroundColour L:1814 > 
avcontrol=2, format=0x2, colour=0xff000000 


note:
refer to "S 4: Handle Video Status" in darwin arch diagrams. UCM-292
Exit Standby [UCM-3154 ] / __Main [ UCM-3157 ] 
FSION-DSN-1823-WP100 - Scart Control.doc
Scart Control UCM-11437

!MIL   -AMS          < T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleLiveEvents L:80 > STANDBY_OUT event 

!WARN  -PREFS_SRV    < P:MW t:0x017a9520 T:PREFS_PTHREAD M:prefs_hdmi_cec.c F:PREFS_HDMI_CEC_Process_OneTouchPlay_StateMachine L:826 > OTP state machine started... Attempting to wake-up TV 
!WARN  -PREFS_SRV    < P:MW t:0x017a9520 T:PREFS_PTHREAD M:prefs_hdmi_cec.c F:iterate_next_state L:739 > OneTouchPlay:  ONE_TOUCH_STATE_IDLE --> ONE_TOUCH_STATE_TV_WAKEUP_IMAGE | ONE_TOUCH_EVENT_TRIGGER_TV_WAKEUP[1] 

!MIL   -EPG_INIT     < P:APP T:PREFS_PTHREAD M:PowerOperatingModes F:`notifyOperatingMode` L:301 > T:threadtracker: notifyOperatingMode of state : 2
!MIL   -EPG_INIT     < T:PREFS_PTHREAD M:PowerOperatingModes F:setState L:230 > T:threadtracker:setState > ON

!MIL   -EPG_INIT     < T:no name M:InitialisationManager$OperatingEventListener F:`moveToActive` L:2201 > T:PooledExecutor#3:MOVING TO ACTIVE

!MIL    -EPG_INIT    < M:InitialisationManager$StateChanger F:startOperatingOn L:2285 > T:IM#0:`Starting state change to ACTIVE`
!MIL    -EPG_INIT    < M:WakeUpFromRegularStandby F:`reachedStateActive` L:37 > T:PooledExecutor#2:#NSS# Waking up from regular standby

!MIL   -JAE          < T:no name M:ceej_bsp.c F:ooBSP_write L:00803 > %%%%%%%  PICASSO ACTIVE STATE...    REACHED  %%%%%%%

!MIL   -EPG_TVVM     < M:SystemCommonObjectHandler F:requestProcessAction L:901 > T:PooledExecutor#4:ACTION_TUNE_AFTER_EXITING_STANDBY
!MIL   -EPG_TVVM     		< p:0x000001f5 P:APP t:0x2df3d520 T:no name M:Tuner F:doTuneToLocatedService L:507 > T:PooledExecutor#3:doTuneToLocatedService - TUNING
!MIL   -EPG_CONF     		< p:0x000001f5 P:APP t:0x2df3d520 T:no name M:ConflictAuthorizer F:doIsAuthorized L:143 > T:PooledExecutor#3:TUNING AUTHORIZED
!MIL   -EPG_TVVM     		< p:0x000001f5 P:APP t:0x2df3d520 T:no name M:Tuner F:playService L:193 > T:PooledExecutor#3:### Tuner.playService
!MIL   -P_Api        		< p:0x000001f5 P:APP t:0x2df3d520 T:no name M:player_api_session.c F:PLAYER_API_Session_Play L:4106 > PLAY 



!MIL   -EPG_ME       < T:no name M:MediaEngine F:playService L:01347 > T:PooledExecutor#1:TUNING TO Sky Intro, 998
!MIL   -P_Api        < T:no name M:player_api_session.c F:PLAYER_API_Session_Play L:03558 > PLAY
!MIL   -VRMS         < T:VRM_SRV M:job_man_srv.c F:JobManSrvStart L:04182 > VRM_JOB_START: jtVRM=jb-live, jhVRM=0x3000001
!MIL   -MPM          < T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:00970 > FRAME_PRESENTED: hMC=0x3
!MIL   -MPM          < T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:00971 > @@PMON@@,mark,hw,first-frame,3
!ERROR -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:01316 > KT: l_back_color(0)           // *to-black*
!MIL   -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:01184 > VIDEO IS SHOWN
!MIL   -P_Api        < T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:07066 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=RUNNING


*to-standby*
!MIL   -EPG_INIT     < T:no name M:InitialisationManager F:`moveToStandby` L:00680 > T:PooledExecutor#4:MOVING TO STANDBY
!MIL   -JAE          < M:modules/jvm-glue/src/c/src/ceej_bsp.c F:ooBSP_write L:1359 > %%%%%%%  PICASSO STANDBY STATE...   REACHED  %%%%%%%
!MIL   -AMS          < T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleLiveEvents L:76 > STANDBY_IN event 

!MIL    -EPG_INIT    < T:PREFS_PTHREAD M:PowerOperatingModes F:notifyOperatingMode L:301 > T:threadtracker: notifyOperatingMode of state : 1
!MIL    -EPG_INIT    < T:PREFS_PTHREAD M:PowerOperatingModes F:setState L:230 > T:threadtracker:setState > STANDBY
!MIL    -P_Api       < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1109 > VIDEO IS HIDDEN 

!MIL   -MPM          < T:MPM_ITCMAIN_THREAD M:mpm_component_audio.c F:MPMComponentAudioStopDecodingReal L:00878 > DECODER_STOPPED: hMC=0x3
!MIL   -UAM          < T:UAM_HP_THREAD M:internal_pbag.c F:Internal_Pbag_Print L:00415 > UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_IN
!MIL   -MCM          < T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Free L:00502 > @@PMON@@,trace,mediacon,mc-free,3
!ERROR -P_Api        < T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:01316 > KT: l_back_color(-15987889)   // *to-blue*
!MIL   -MCM          < T:VRM_SRV M:mcm_mediaconn.c F:MCM_MEDIACONN_Destroy L:00569 > @@PMON@@,trace,mediacon,mc-destroy,3

*change-channel* note that player do video control

"F:PLAYER_AVControl_UpdateVisibility L:1110 > VIDEO IS HIDDEN" do not really
mean blanking or unblanking since this use blender IOCTL and valid only when
video runs.

// when UpdateVisibility has no effect on audio channel since this log shows
// on video as well but seems to work.
!INFO   -P_Api        		< M:player_api_avcontrol.c F:`PLAYER_AVControl_SetVideoVisibility` L:1320 > Can't unblank the video because the video is not running 

So if see this, this means that control has no effect.

!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:245 > KEY_PRESS: code=0x(CHANNEL+)e006 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1110 > VIDEO IS HIDDEN          // *to-blue*
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1435 > Set Visibility to [0]  // this do not mean blank
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8968 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000012, status=NOT_RUNNING 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8968 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000014, status=NOT_RUNNING 
!MIL    -MPM          		< P:MW  T:MPM_PROXYMONITOR_THREAD M:mpm_component_video.c F:MPMComponentVideoFramePresentedHandler L:1374 > FRAME_PRESENTED: hMC=0x13 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1106 > VIDEO IS SHOWN           // *to-black*
!INFO   -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_SetVideoVisibility L:1423 > Set Visibility to [1] 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:8968 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000014, status=RUNNING 

*change-channel-on-audio*
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(0)e300 
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(2)e302 
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(0)e300 
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(2)e302 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "DCAEvent","action": "DCA to channel:0202","title": "DCA to channel:0202","label": "","currentscreen": "/tv/live/998"}
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/0202/banner"}

// player do and has an effect since is tuning from video and there is video
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_api_avcontrol.c F:PLAYER_AVControl_UpdateVisibility L:1174 > VIDEO IS HIDDEN 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessVSI L:9410 > VIDEO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001, status=NOT_RUNNING 
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9596 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000001 [PROCESSED_ASI (524952) NOT_RUNNING] [SELECTION_ASI (524952) NOT_RUNNING] 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","title": "PlayingStatus changed to: LIVE","label": "","currentscreen": "/tv/live/0202/banner"}
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9596 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003 [PROCESSED_ASI (67869) RUNNING] [SELECTION_ASI (67869) RUNNING] 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/0202"}
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","title": "PlayingStatus changed to: LIVE","label": "","currentscreen": "/tv/live/0202"}
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=1 
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 

// no control on blanking when change to audio
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(CHANNEL+)e006 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "CHANNEL_UP","title": "Key Press CHANNEL_UP","label": "","currentscreen": "/tv/live/0202"}
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9596 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000003 [PROCESSED_ASI (67869) NOT_RUNNING] [SELECTION_ASI (67869) NOT_RUNNING] 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","title": "PlayingStatus changed to: LIVE","label": "","currentscreen": "/tv/live/0202"}
!MIL    -P_Api        		< P:APP T:PLAYER_MAIN M:player_sm_vrm.c F:PLAYER_SM_VRM_ProcessASI L:9596 > AUDIO_RUNNING_STATUS: jtVRM=3, jhVRM=0x3000004 [PROCESSED_ASI (133383) RUNNING] [SELECTION_ASI (133383) RUNNING] 
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/tv/live/0203"}
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "LIVE","title": "PlayingStatus changed to: LIVE","label": "","currentscreen": "/tv/live/0203"}
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1078 > avcontrol=3, source=1, visible=1 
!INFO   -P_Api        		< P:APP T:no name M:player_api_avcontrol.c F:PLAYER_API_AVControl_SetVisibility L:1093 > SetVisibility VIDEO TRUE 
!MIL    -aem          		< P:APP T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(CHANNEL+)e006 


*exit-iapp*
background still image from IAPP ---EXIT event 
>>> IAPP decodes blue image to video plane ---IAPP has terminated 
>>> LAE unblanks the video plane ---LAE terminated >>> black and banner (EPG)"


picasso/java/picasso/initialisationmanager/InitialisationManager.java

	class OperatingEventListener implements IOperatingEventListener
	{
		@Override public void `doOn`(IKeyCode keyCode)
		{
			wakingup.wokenWithKey(keyCode);
			moveToActive();
		}
		private void moveToActive()
		{
			LOGGER.logMilestone("MOVING TO ACTIVE");
			disableKeyEvents();
      }
   }


private final IOperatingEventListener   operatingEventListener  = new OperatingEventListener();

	private void runStartupTask()
	{
		try
		{
			notifier.notify(new RebootNotification(theTime.timestampMS(), spmSystem.getWakeupCause(), spmSystem.getPassiveStandbySleepReason()));
		}
		catch (Exception e)
		{
			LOGGER.logMilestone("Failed to notify reboot reason" + e);
		}
		awtExecutor.runLater(new Runnable()
		{
			@Override public void run()
			{
				powerOperatingModesControl.setScartOperatingModeEventListener(operatingEventListener);
            }
      }
   }


picasso/java/picasso/initialisationmanager/PowerOperatingModes.java

// See WP100 - Scart Control
class PowerOperatingModes implements PrefsOperatingModeListener, IPowerKeyListener, IKeyListener
{
	public synchronized void setScartOperatingModeEventListener(IOperatingEventListener listener)
	{
		this.listener = listener;
	}

	class GoToActiveTask extends BaseTask
	{

		private final IKeyCode useKeyCode;

		GoToActiveTask(int mode, IKeyCode useKeyCode)
		{
			super(mode);
			Loggers.EPG_INIT.logMilestone("constructing GoToActiveTask");
			this.useKeyCode = useKeyCode;
		}

		@Override public void run()
		{
			Affirm.affirmNotNull(listener);

			notifyOperatingMode(mode); // this go notifyOperatingMode()
			listener.doOn(useKeyCode);
		}
	}

   // do not see this then means no callback from MW

	@Override public synchronized void notifyOperatingMode(int operatingMode)
	{
		Loggers.EPG_INIT.logMilestone(" notifyOperatingMode of state : " + operatingMode);

      // !MIL    -EPG_INIT     		< M:PowerOperatingModes F:notifyOperatingMode L:302 > T:threadtracker: notifyOperatingMode of state : 2

      // interface OperatingModes
      // {
      //     /**  The standby LED is illuminated and all outputs are disabled. */
      //     int STANDBY            = 1;
      //     /**  The power LED is illuminated and all outputs are enabled. */
      //     int ON                 = 2;
      //     /**  The power LED is illuminated and all output are enabled with the exception of the scart outputs, which remain disabled. */
      //     int ON_2ND             = 3;
      //     /**  The power LED is illuminated and all outputs are enabled.  The scart output is configured for CVBS. */
      //     int TV                 = 4;
      //     /**  The Power LED is illuminated and all outputs are enabled.  The scart output is configured for CVBS. */
      //     int DEEP_STANDBY       = 5;
      //     /**  The standby LED is illuminated and all outputs are disabled. */
      //     int DEEPSTANDBY_FORCED = 6;
      // }
      
		switch (operatingMode)

      case PrefsTerminal.OperatingModes.ON:
      case PrefsTerminal.OperatingModes.ON_2ND:
      case PrefsTerminal.OperatingModes.TV:
         setState(ON);
		   // Loggers.EPG_INIT.logMilestone("setState > " + state);
         break;
   }

	@Override public synchronized void doOn()
	{
		actionOperatingMode(OperatingModeEvents.ON, IKeyCode.POWER);

	}

	private void actionOperatingMode(int mode, IKeyCode keyCode)
   {
      // interface OperatingModeEvents
      // {
      //     /**  TV Button pressed on 1st location remote control. */
      //     int TV                 = 1;
      //     /**  TV Button pressed on 2nd location remote control. */
      //     int TV_2ND             = 2;
      //     /**  Sky, TV Guide, Box Office, Services or Interactive Button pressed on 1st location remote control. */
      //     int SKY                = 3;
      //     /**  Sky, TV Guide, Box Office, Services or Interactive Button pressed on 2nd location remote control. */
      //     int SKY_2ND            = 4;
      //     /**  On/Off Button pressed on 1st location remote control. */
      //     int ON_OFF             = 5;
      // }
      task = new `GoToActiveTask`(mode, decider.useKeyCode);
   }

}

// `mode` is interface OperatingModeEvents but not OperatingMode
!MIL    -EPG_INIT     		< M:PowerOperatingModes F:actionOperatingMode L:384 > 
  T:CEE-J EventQueue Reader 0:actionOperatingMode - mode > 5 currentState > ON

operatingMode      32 jpa/modules/jpa-api/src/java/com/nds/fusion/prefs/PrefsOperatingModeListener.java      void notifyOperatingMode(int operatingMode);

<send-event>

sendOperatingModeEvent  541 picasso/java/picasso/initialisationmanager/PowerOperatingModes.java                         
  prefsTerminal.sendOperatingModeEvent(mode);

// jpa/modules/jpa-api/src/java/com/nds/fusion/prefs/PrefsTerminal.java

    /**
     * Sends an operating mode to the terminal triggered by a user action
     * @param operatingModeEvent
     * {@link PrefsTerminal.OperatingModes} event.
     */
    void sendOperatingModeEvent(int operatingModeEvent);


// jpa/modules/jpa-impl/src/c/src/natPrefsTerminalImpl.c

JNIEXPORT void JNICALL Java_com_nds_fusion_prefsimpl_PrefsTerminalImpl_natPrefsApiTerminalSendOperatingModeEvent
  (JNIEnv *env, jclass jClass, jint param1, jint param2)
{
    PREFS_API_TerminalHandle terminalHandle     = (PREFS_API_TerminalHandle)param1;
    PREFS_API_TERMINAL_OperatingModeEvent event = (PREFS_API_TERMINAL_OperatingModeEvent)param2;
    SYSTEM_STATUS status                        = PREFS_API_STATUS_FAILURE;

    JPA_DIAG_DECLARE_FUNCTION;
    DIAG_LOG_FN_ENTRY(g_prefs_adaptor_api_diag_segment_id);

    status = PREFS_API_TERMINAL_SendOperatingModeEvent(terminalHandle, event);

    (void)PREFS_JAVA_ParseReturn(env, status);

    DIAG_LOG_FN_EXIT(g_prefs_adaptor_api_diag_segment_id, status);
}

/** @brief Send an operating mode event to the TERMINAL interface.
  *
  * @param[in] terminal_handle The handle for this terminal object
  * @param[out] operating_mode_event Event that `has to be notified`
  *
  * @return PREFS_API_STATUS_OK on success.
  * @return PREFS_API_STATUS_FAILURE in case of error.
  */
SYSTEM_STATUS PREFS_API_TERMINAL_SendOperatingModeEvent(
    PREFS_API_TerminalHandle terminal_handle, PREFS_API_TERMINAL_OperatingModeEvent operating_mode_event)
{

}

<callback>
// jpa/modules/jpa-api/src/java/com/nds/fusion/prefs/PrefsOperatingModeListener.java

/** Listener for notifications of operating modes
*<p>
* The listener is defined and instantiated by the application and registered using the 
* {@link PrefsTerminal#`registerOperatingModeListener`} method.
* Whenever an {@link PrefsTerminal.OperatingModes} event occurs, {@link #notifyOperatingMode notifyOperatingMode}
* method is called with an operating mode parameter.
* </p>
*/

// jpa/modules/jpa-impl/src/java/com/nds/fusion/prefsimpl/PrefsTerminalImpl.java

	/**
	 * Registers a listener which is called `whenever an operating mode changes`
	 *
	 * @param operatingModeListener An instance of a {@link com.nds.fusion.prefs.PrefsOperatingModeListener} object.
	 * @return None.
	 */
	@Override public void registerOperatingModeListener(PrefsOperatingModeListener operatingModeListener)
	{
		synchronized (synchronizationObject)
		{
			natPrefsAPITerminalRegisterOperatingModeListener(nativeHandle, operatingModeListeners.registerNew(operatingModeListener));
		}
	}


// jpa/modules/jpa-impl/src/c/src/natPrefsTerminalImpl.c

JNIEXPORT void JNICALL Java_com_nds_fusion_prefsimpl_PrefsTerminalImpl_natPrefsAPITerminalRegisterOperatingModeListener
(JNIEnv *env, jclass jClass, jint native_handle, jint callback_id)
{
    JPA_DIAG_DECLARE_FUNCTION;

    SYSTEM_STATUS status = PREFS_API_TERMINAL_RegisterOperatingModeListener((PREFS_API_TerminalHandle) native_handle,prefsOperatingModeCallback, callback_id);
    if (status != PREFS_API_STATUS_OK )
    {
        DIAG_LOG_ERROR(g_prefs_adaptor_api_diag_segment_id, ("PREFS_API_TERMINAL_RegisterOperatingModeListener call failed"));
    }

    (void) PREFS_JAVA_MaybeThrowException(env, status);

}


// DARWIN_PLATFORM/DARWIN_PREFS/src/client/prefs_api_terminal.c
// MW calls a callback directly

/** @brief Calls all the registered listener of a specified terminal handle.
  *
  * @param[in] terminal_handle the terminal handle
  * @param[in] mode it's the operating mode `coming from the server`
  * @param[in] auto_reply specifies if only the listener that belongs to the specified terminal handle has to be
  *            called or if all the listeners have to be called.
  */
void PREFS_TERMINAL_callOperatingModeListeners(PREFS_API_TerminalHandle terminal_handle,
                                               PREFS_API_TERMINAL_OperatingMode mode,
                                               bool auto_reply)
{
  f_PREFS_API_RegisterOperatingModeListeners[i].listener(mode, f_PREFS_API_RegisterOperatingModeListeners[i].user_tag);
}




UamMainRegisterToPrefs
	PREFS_API_RegisterSystemStateListener(UAM_DCM_Standby_cbPrefsNotification,)
UAM_DCM_Standby_cbPrefsNotification
UamDcmReceiveMessage

UAM_DCM_Internal_ProcessEvent
	Internal_Pbag_Print
	{
		DIAG_LOG_MIL(UamDiagSegmentId, ("UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_OUT"));
		or
		DIAG_LOG_MIL(UamDiagSegmentId, ("UAM_DCM_PARAM_DATA_INTERNAL_TYPE_STANDBY_IN"));
	}


SetBackgroundColour
PLAYER_API_AVControl_SetBackgroundColour
	PLAYER_PRV_SetBackgroundColour

PLAYER_SM_VRM_ProcessVSI
UpdateVideoRunningStatus
	PLAYER_AVControl_SetVideoVisibility
		PLAYER_PRV_SetBackgroundColour( blank or unblank )
		PLAYER_PRV_SetCompositionBackgroundColour
		BEM_OC_VideoComposition_SetBackgroundColour


# to GFX
Ceej_bsp.c
	Video_HandleCommit
		PLAYER_API_AVControl_InvalidateRectangle

// note: WHY this? Used?
// CEEJ_BSP_Blit
//  PLAYER_API_AVControl_UpdateDisplay


# exception
final public class PlayerEventRBStopImpl extends PlayerEventImpl
        implements PlayerEventRBStop
{
	private static final int UINT32_EXCEPTION = 2103; /** The exception code for the failure reason. */
	
    public PlayerEventRBStopImpl(int nativeHandle, int eventID, int userTag, boolean sameSession)
    {
        super(nativeHandle, eventID, userTag, sameSession);
    }
    
    public int getException() throws PlayerDataUnavailableException  {
        assertValid();
        return PlayerEventCommonImpl.natGetUint32(nativeHandle, UINT32_EXCEPTION);
    }
}

public abstract class PlayerEventCommonImpl
{
    protected static native int         natGetUint32(int eventHandle, int propId);
}

/*
 * Class:     com_nds_fusion_playerimpl_PlayerEventCommonImpl
 * Method:    natGetUint32
 * Signature: (II)I
 */
JNIEXPORT jint JNICALL Java_com_nds_fusion_playerimpl_PlayerEventCommonImpl_natGetUint32
  (JNIEnv *THIS, jclass jClass, jint param1, jint param2)
{
    NDSJNI_ENV env;

    env.THIS = THIS;
    env.jClass = &jClass;    
    env.params[0] = &param1;
    env.params[1] = &param2;

    PLAYER_JAVA_EventCommonImplGetUint32(&env);

    return (jint)env.returnVal;
}

(Player_api_events.h)
/**
 * Properties in event #PLAYER_EVENT_RB_STOP
 */
typedef enum
{
    PLAYER_EVENT_RB_Stop_PropId_Undef             = 2100U,
    PLAYER_EVENT_RB_Stop_PropId_Uint32_UserTag    = 2101U, /**< User Tag data passed in #PLAYER_API_Session_Play */
    PLAYER_EVENT_RB_Stop_PropId_Uint32_SessionId  = 2102U, /**< Session handle passed in #PLAYER_API_Session_Play */
    PLAYER_EVENT_RB_Stop_PropId_Uint32_Exception  = 2103U,  /**< The exception code for the failure reason. See "system_exception.h" */
    PLAYER_EVENT_RB_Stop_PropId_LastValue         = 2104U

} PLAYER_EVENT_RB_Stop_PropId;


PLAYER_API_Event_GetUint32(eventHandle, propId, &(env->returnVal))
{
	case PLAYER_EVENT_RB_Stop_PropId_Uint32_Exception:
		if( (l_event->event.type & PLAYER_EVENT_RB_STOP) == PLAYER_EVENT_RB_STOP )
		{
			*value = l_event->event.data.rb.stop.exception;
			l_status = PLAYER_API_STATUS_OK;
		}
		break;
}


={============================================================================
|kt_dev_si_0001| comp-sharedplanner

# In order to increase the number of imported Shared Planner bookings in the system we need to change the system common config file:
[parkkt@ukstbuild3 config]$ egrep -an 'IMPORTED_BOOKINGS' *.cfg
systemcommon.cfg:69:[SP_IMPORTED_BOOKINGS_LIMIT]
systemcommon.cfg:70:SP_IMPORTED_BOOKINGS_LIMIT=6000
systemcommon.cfg:71:[SP_IMPORTED_BOOKINGS_RESYNC_THRESHOLD]
systemcommon.cfg:72:SP_IMPORTED_BOOKINGS_RESYNC_THRESHOLD=5950
systemcommon.cfg:73:[SP_IMPORTED_BOOKINGS_WARNING_THRESHOLD]
systemcommon.cfg:74:SP_IMPORTED_BOOKINGS_WARNING_THRESHOLD=5900

systemcommon.cfg:27:MAX_NUMBER_OF_BOOKINGS=2000
systemcommon.cfg:28:MAX_PDL_BOOKINGS=100


# for a remote items, server_id and cds_locator should be set. there were issues that a remote item by filldisk isn't set cds and no checks in sbm.
# PCAT_CAT_PROP_CDS_LOCATOR
# Number of remote bookings.
$ sqlite3 PCAT.DB 'SELECT COUNT(*) FROM BOOKING_JOBS WHERE CDS_LOCATOR IS NOT NULL'
6000
# Number of local bookings.
$ sqlite3 PCAT.DB 'SELECT COUNT(*) FROM BOOKING_JOBS WHERE CDS_LOCATOR IS NULL'
5856

$ sqlite3 PCAT.DB 'select server_id from item i' | wc -l


={============================================================================
|kt_dev_si_0001| comp-planner

Planner uses PCAT to book/delete a recording or a reminder. 
native

// contacts
David McWha, Rana Ali

<planner-diag>
DARWIN_PLATFORM/DARWIN_PLANNER/src/planner_common.c

        /* General PLANNER DIAG segment */
        l_diag_status |= DIAG_LOG_RegisterTraceSegment(PLANNER_DIAG_NAME,
            (uint32_t)strlen(PLANNER_DIAG_NAME),
            (DIAG_CMN_tRPCTable_t*)NULL,
            (DIAG_LOG_uiSegmentId_t*)&g_planner_diag_segment_id);

        /* PLANNER VTable DIAG segment */
        l_diag_status |= DIAG_LOG_RegisterTraceSegment(PLANNER_VTABLE_DIAG_NAME,
            (uint32_t)strlen(PLANNER_VTABLE_DIAG_NAME),
            (DIAG_CMN_tRPCTable_t*)NULL,
            (DIAG_LOG_uiSegmentId_t*)&g_planner_vtable_diag_segment_id);

        /* PLANNER Low-Level Operation DIAG segment */
        l_diag_status |= DIAG_LOG_RegisterTraceSegment(PLANNER_COMMON_DIAG_NAME,
            (uint32_t)strlen(PLANNER_COMMON_DIAG_NAME),
            (DIAG_CMN_tRPCTable_t*)NULL,
            (DIAG_LOG_uiSegmentId_t*)&g_planner_common_diag_segment_id);

        /* PLANNER Iterator DIAG segment */
        l_diag_status |= DIAG_LOG_RegisterTraceSegment(PLANNER_ITERATOR_DIAG_NAME,
            (uint32_t)strlen(PLANNER_ITERATOR_DIAG_NAME),
            (DIAG_CMN_tRPCTable_t*)NULL,
            (DIAG_LOG_uiSegmentId_t*)&g_planner_iterator_diag_segment_id);


<planner-jpa>
// DARWIN_PLATFORM\DARWIN_PLANNER_JAVA
COMPONENT_NAME:= darwin_planner_native
NDS_BUILD_TYPE_darwin_planner_native = debug
DARWIN_PLATFORM\DARWIN_PLANNER_JAVA\src\inc\natPlannerCommon.h: 
  #define PLANNER_JAVA_DIAGNAME "J_PLANNER"

class PlannerSessionImpl
  iteratorCreateFiltered
    natPlannerApiSessionIteratorCreateFilteredAny
      PLANNER_JAVA_ApiSessionCreateIteratorFilteredAny
        JPA_VTABLE_Create

class PlannerBookedProgrammeIteratorImpl
  PlannerIteratorImpl.natPlannerIteratorDelete
    PLANNER_JAVA_IteratorDelete
      JPA_VTABLE_ReleaseElement


// ADPT_PLANNER

#define JPA_COMPONENT_CONFIG_FILE_NAME "java_adapters.cfg"
#define PLANNER_JAVA_MEMORY_POOL_SECTION_NAME "PLANNER_MEM_CONFIG"
[PLANNER_MEM_CONFIG]                                                                                                            
POOL_FLAGS=123
POOL_NAME="ADPT_PLANNER"
POOL_SIZE=4000

g_planner_native_mem_pool:
DARWIN_ADAPTOR_PLANNER_Init
{
  DARWIN_ADAPTOR_PLANNER_AllocateMemory
  {
    SYSTEMCOMMON_JAVA_AllocateMemory(&g_planner_native_mem_pool,PLANNER_JAVA_MEMORY_POOL_SECTION_NAME);
  }

  DARWIN_ADAPTOR_PLANNER_InitVTables(void)
  {
    // there are other many VTs for each I/F which are all linked to ADPT_PLANNER pool
    //
    if (!IS_OK(DARWIN_ADAPTOR_PLANNER_InitVTable((VTable_t**)&'g_planner_adaptor_IteratorCreateRequest',PLANNER_JAVA_IteratorCreateRequestConstructor,
            PLANNER_JAVA_IteratorCreateRequestDestructor)))
    {
      DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id,("Failed PLANNER_JAVA_InitVTable: g_planner_adaptor_IteratorCreateRequest"));
    }
  }
}


<when-recording-completed>

// only 
SYSTEM_STATUS PLANNER_BookedProgramme_GetBookingState( PCAT_VIEW_VALUE_LIST value_list);

// @brief Maps PCAT states to the PLANNER equivalent.
//
// @param[in] recording_state PCAT recording state
// @param[in] content_completion_state PCAT content completion state
// @param[in] failed value of PCAT property indicating if the recording failed or not.
// @returns PLANNER equivalent of the recording and content completion states
//
!INFO  -PLANNER      < p:000000ec t:015d3520 T:PLANNER_CB4 M:planner_bookedprogramme_properties.c 
  F:PLANNER_BookedProgramme_MapPCATState L:03888 > record_state: 5 completion_state: 2 failed: 0

PLANNER_API_BookingState PLANNER_BookedProgramme_MapPCATState(uint32_t record_state,uint32_t completion_state, bool failed);


<when-delete-recordings>
From a high level, on the middleware side, the following modules are
interacting during the deletion action. EPG sends a message to PLANNER to
start the removal of the booking and the planner forwards this to System
Booking Management (SBM) module on the middleware process. SBM does some
checks with PCAT and then sends a request to the Resource Management Framework
(RMF) to move the booking from the USER_QUOTA to the `RECYCLE_QUOTA`. PCAT
actions this, asynchronously responds back to RMF and then the confirmation
eventually reaches the PLANNER which forward it back to EPG. 


<planner-pool>
// pool PLANNER size 458752, g_planner_mem_pool
// it comes from planner itself but not planner jpa
[MEMORY_CONFIGURATION]
POOL_FLAGS=0
POOL_NAME="PLANNER"
POOL_SIZE=458752
SRM_POOL_FLAGS=0
SRM_POOL_NAME="PLANNER_SRM"
SRM_POOL_SIZE=20480


<planner-pcat-client>

#define DBVIEW_MEMMAN_CONFIG_FILE_SECTION_NAME "PCAT_MEMMAN_CONFIGURATION"
#define DBVIEW_MEMMAN_SRV_POOL_NAME "SERVER_POOL_NAME"
#define DBVIEW_MEMMAN_CLNT_POOL_NAME "CLIENT_POOL_NAME"

// from pcat_db.cfg

[PCAT_MEMMAN_CONFIGURATION]
CLIENT_POOL_FLAG=0
CLIENT_POOL_NAME="PCAT_VIEW_CLNT_POOL"
CLIENT_POOL_SIZE=400
SERVER_POOL_FLAG=0
SERVER_POOL_NAME="PCAT_VIEW_SRV_POOL"
SERVER_POOL_SIZE=580

SYSTEM_STATUS PLANNER_DBINTERFACE_InitPCAT(void)
{
    /* Initialize PCAT interface */
    if (PCAT_VIEW_Init() != PCAT_VIEW_STATUS_OK)
}

PCAT_VIEW_Init()
{
  /* IPC initialization */
  if (SYSTEM_STATUS_IS_OK(stat)) {
    stat = PCAT_VIEW_SRV_PROXY_Init();
  }
}

SYSTEM_STATUS PCAT_VIEW_SRV_PROXY_Init(void)
{
  status = SYSTEMCONFIG_GetStringValue(fileHandle, DBVIEW_MEMMAN_CONFIG_FILE_SECTION_NAME, DBVIEW_MEMMAN_CLNT_POOL_NAME, &len_pool_name, clnt_pool_name);
  PCAT_DIAG_LOG_IF_ERROR(PCAT_diag_segment_id, status, ("Can't read CLNT_POOL_NAME param from pcat_db.cfg"));

  // note: `PCAT_VIEW_CLNT_POOL`
  // `PcatViewVLPool`= `PcatViewProxyPool`;
  // 
  // // pcat_server_proxy.c
  // stat = `PCAT_VIEW_SRV_GetPrivatePool`(&PcatViewVLPool);
  // {
  //  *Pool = PcatViewProxyPool;
  // }

  status = MEMMAN_API_MemoryPoolCreateP(&`PcatViewProxyPool`, clnt_pool_name, clnt_pool_flag, NULL, (1024U * clnt_pool_size), 2048U, MEMMAN_API_MEMORY_POOL_NO_LIMIT);
}


<planner-vtable-debug>
Open Planner\inc\vtable.h and enable the following define:
/* #define ENABLE_VTABLE_DEBUG */


<planner-iterator> <BPH>
http://hetty.cisco.com/fusionmadesimple/index.php/PLANNER

// iterators, planner thread, func table (Planner DC 9.11.11)

The methods allow the user to manipulate iterators containing 'booked
programme objects'. 

The following points should be noted:

* The Iterator position sits between objects within the list. 
Getting the next or previous object moves the Iterator past or before the
object just retrieved.

* For example using `PLANNER_API_Iterator_GetNextIndex` at the initial
position would return 0, but PLANNER_API_Iterator_GetPreviousIndex would
`return -1` to indicate no previous objects.

// when called first time
F:PLANNER_API_Iterator_GetNextIndex L:00616 > KT: return l_index(0), l_count(10)


* Using PLANNER_API_Iterator_CreateNextElement at the initial position returns
the object at index 0, and moves the Iterator past index 0, so that
PLANNER_API_Iterator_GetNextIndex would return 1.  Using
PLANNER_API_Iterator_CreatePreviousElement at this point would also return the
object at position zero, and move the Iterator back before position 0.

* All objects retrieved from the Iterator `must be deleted` when finished with. 

* Planner Booked Programmes

The EPG manipulates bookings themselves using booked programme handles. These
are references to booking data that the EPG can receive on adding a new
booking or getting a booking-related notification, retrieve `using iterators` or
lists, or find using a catalog locator. The EPG can then use this handle to
access booking properties, remove/move a booking, stop-and-save/resume the
booking's recording or download, and make a series link (as shown in the
    screenshot above), for example. The operations permitted on any given
booked programme are determined by its "subclass".

The EPG is responsible for deleting the booked programme handle, even if the
EPG retrieved it from an iterator or list. This allows Planner to release
associated resources. 


* The rebuild routine takes as its arguments the previous and current Iterator
position. This data is used to determine which blocks should be freed or
retrieved.


// NOTE:
// sid(session) is a unique key. Each session populate iterators that has id as
// a count. In a specific session, iid is unique but iterator pointer isn't as
// it's memory address that can be reused when iterator is requested.
//
// iid can be the same between sessions as it's simple counter in a session.
//
// Therefore, can be analysied per a session.
//
// vtable id(handle)s are simple idx of vtable such as sid and iid.
//
// IC
// ===========
// PLANNER_JAVA_ApiSessionCreateIteratorBookmarks
// 	DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("KT-I: JICB:" ));
//
// PLANNER_JAVA_ApiSessionCreateIteratorCopyList
//	DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("KT-I: JICC:" ));
//
// PLANNER_JAVA_ApiSessionCreateIteratorFilteredAny
//	DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("KT-I: JICFA: op=%d, st=%d, ft=%d", operationType, jSortType, jFilterType ));


{planner-rebuild}
(planner) EPG-TCN-130_Planner_Rebuild.doc

In certain circumstances, disk space on the STB may be taken up by recordings
that were not deleted correctly, even though there is no longer a
corresponding entry in the Planner. This disk space cannot be used for new
recordings and so is effectively wasted.  This document describes a disk
clean-up function that will reclaim this wasted disk space.

DOES shutdown process.


{session}
<how-many-sessions>
ATG. JPA. GUIDE. PLAYER are creating planner sessions.

!INFO   -PLANNER                   < p:0x000001f0 P:APP t:0x0131c520 T:ATG_CLIENT_HANDLE_EVENTS M:planner_api.c F:PLANNER_CreateSessionCommon L:565 > Created session 0x1.
!INFO   -PLANNER                   < p:0x000001f0 P:APP t:0x012f9520 T:PLAYER_MAIN M:planner_api.c F:PLANNER_CreateSessionCommon L:565 > Created session 0x2.
!INFO   -PLANNER                   < p:0x000001f0 P:APP t:0x0116d520 T:GUIDE_MAIN M:planner_api.c F:PLANNER_CreateSessionCommon L:565 > Created session 0x3.
!INFO   -PLANNER                   < p:0x000001f0 P:APP t:0x2e0ef520 T:no name M:planner_api.c F:PLANNER_CreateSessionCommon L:565 > Created session 0x4.

// M:atg_api.c F:ATG_SysinitRunLevelHandler() L:02845 > KT: PLANNER_API_CreatePlannerSession: 0x1
// M:player_common.c F:PlayerAsyncRequestActive L:02311 > KT: g_player_component.planner_session 0x2
// M:guide_api_session.c F:GuideSessionRetrievalHandler L:01868 > KT: planner session 0x3
// M:natPlannerSessionImpl.c F:PLANNER_JAVA_ApiSessionPlannerCreate L:00092 > KT: PLANNER_JAVA_ApiSessionPlannerCreate `0x4`

# planner_api.c
#
# session node in g_planner_sessionsList get created only when it's called and
# each session has iterators and other tables.
#
# PLANNER_API_CreateSession(depricated) 
# PLANNER_API_CreatePlannerSession(this is only valid one) 
# PLANNER_CreateSessionVTables session_index is a session handle

l_VTableretVal |= VTABLE_Create(&g_planner_sessionsList, (void **)l_new_session_ptr, session_index, sizeof(PLANNER_SESSION_T));
l_VTableretVal |= VTABLE_InitTable(&(l_new_session->iterators), 'g_planner_mem_pool', g_planner_diag_segment_id, NULL, 100);
l_VTableretVal |= VTABLE_InitTable(&(l_new_session->elements), g_planner_mem_pool, g_planner_diag_segment_id, NULL, 100);
l_VTableretVal |= VTABLE_SetCreateElementFunction(&(l_new_session->iterators), PLANNER_Iterator_Init);
l_VTableretVal |= VTABLE_SetDeleteElementFunction(&(l_new_session->iterators), 'PLANNER_Iterator_Delete');
l_VTableretVal |= VTABLE_SetDeleteElementFunction(&(l_new_session->elements), 'PLANNER_Element_Delete');


// PlannerFilterType.java
public interface PlannerFilterType

typedef struct {
    VTable_t                longLists;
    `VTable_t                iterators`;
    VTable_t                params;
    VTable_t                requests;
    VTable_t                shortLists;
    'VTable_t                elements';
    uint32_t                self_handle;
    PLANNER_API_SessionStatusChangeCb listener;
    PLANNER_API_UserTag     user_tag;
} PLANNER_SESSION_T;


/* A structure containing PCAT vlist and the position in the view 
   of first (min) and last element(max) of the vlist. */
typedef struct
{
    PCAT_VIEW_VALUE_LIST vlist;
    uint32_t min;
    uint32_t max;
} PLANNER_ITERATOR_VLIST_T;

typedef struct
{
    `PCAT_VIEW_HANDLE view;`
    PCAT_VIEW_SPEC_HANDLE viewspec;

    /* Position of iterator within the view */
    uint32_t position;
    /* Locator of element at position, used for position adjustments */
    PCAT_VIEW_OBJECT_ID element_at_position;
    /* Number of elements in the iterator */
    'int32_t count';

    /* VTABLE of PLANNER_ITERATOR_VLIST_T */
    `VTable_t vlists`;

    /* Handle to view parameters: filter, sort types and others.*/
    `PLANNER_PARAMETER_T* params`;

    PLANNER_API_Parameter_Handle param;
    PLANNER_SESSION_T  *session;
    pthread_mutex_t	   mutex;
    pthread_mutex_t	   api_mutex;
} PLANNER_ITERATOR_T;


<app-calls> <iterator-change-listener>
iteraror create -> change listerner -> creation listerner -> hasNext ->
hasPrevious -> getNextIndex -> next -> get booking type
F:PLANNER_API_Iterator_GetNextIndex L:00616 > KT: return l_index(0),
  l_count(10) { hasNext -> next -> get booking type } do this loop until to
  get 6 items when created all BPH then call various apis to get props like
  type, string and int.

when press down key 6 times, it goes new page in the planner and then: hasNext
-> hasPrevious -> getNextIndex -> next -> get booking type
F:PLANNER_API_Iterator_GetNextIndex L:00616 > KT: return l_index(6),
  l_count(10)
 

public interface PlannerBookedProgrammeIteratorCreationListener
{
  /**
   * Notify the successful completion of operation.  @param userTag An opaque
   * value that the API receives and stores at the start of an asynchronous
   * operation and returns unchanged to the listener when the operation
   * completes.  @param iterator The reference of the {@link
   * PlannerBookedProgrammeIterator} just retrieved.  The user must set the
   * iterator to null when done with it. This is to prevent the resources from
   * being unnecessarily tied up and to enable garbage collection.
   */
  public void notifySuccess(Object userTag, PlannerBookedProgrammeIterator iterator);
}


// *PlannerBookedProgrammeIteratorChangeListener*
// /**
//  * @see com.nds.fusion.planner.PlannerBookedProgrammeIteratorChangeListener#notifySuccess(java.lang.Object, com.nds.fusion.planner.PlannerBookedProgrammeIterator, int)
//  */
// @Override public void notifySuccess(final PlannerBookedProgrammeIterator iterator,
//                                     int changeThatHasHappened)
// {
// }
//
// this where fires up callbacks
// PLANNER_DBINTERFACE_PRV_ProcessQueuedNotifications();

public PlannerRequest iteratorCreateFiltered( PlannerBookedProgrammeIteratorCreationListener createListener, 
                                            PlannerBookedProgrammeIteratorChangeListener changeListener, Object userTag, 
                                            int sortType, int filterType,
                                            int genre, int subGenre )
                                            throws PlannerHealthCheckException
{
  PlannerBookedProgrammeIterator iterator = new PlannerBookedProgrammeIteratorImpl(createListener, changeListener, userTag);

  return new PlannerRequestImpl('`natPlannerApiSessionIteratorCreateFilteredAny`'(
        nativeHandle,					  // session handle 
        ListType.BOOKING_FILTERSORT,  // operation
        sortType, filterType, null, null,null, null, genre, subGenre, 
        iterator,                     // PlannerBookedProgrammeIterator for JAVA
        PlannerPpvFilterType.PPV_ANY));
}

public PlannerRequest iteratorCreateFilteredCollapsed( PlannerBookedProgrammeIteratorCreationListener createListener, 
        PlannerBookedProgrammeIteratorChangeListener changeListener, Object userTag, 
        int sortType, int filterType, int genre, int subGenre )throws PlannerHealthCheckException
{
  PlannerBookedProgrammeIterator iterator = new PlannerBookedProgrammeIteratorImpl(createListener, changeListener, userTag);

  return new PlannerRequestImpl('`natPlannerApiSessionIteratorCreateFilteredAny`'(
        nativeHandle, 
        ListType.BOOKING_FILTERSORT_COLLAPSED(2), 
        sortType(2), filterType(2), null, null,null,null, genre, subGenre, 
        iterator,
        PlannerPpvFilterType.PPV_ANY)); 
}

// list type(operation)
PLANNER_API_Parameter_ListTypeTag

// filter and sort type
typedef enum PLANNER_API_FilterTypeTag
typedef enum PLANNER_API_SortTypeTag

PLANNER_JAVA_ApiSessionCreateIteratorBookmarks
PLANNER_JAVA_ApiSessionCreateIteratorCopyList
PLANNER_JAVA_ApiSessionCreateIteratorFilteredAny
{
  // create params
  VTABLE_Create(g_planner_adaptor_IteratorCreateRequest, &vtable_handle );

  // save PlannerBookedProgrammeIterator from java call
  // iteratorCreateRequest is vtable ptr
  // this is java iterator that should map to planner iterator
  iteratorCreateRequest->iterator = jIteratorGlobal; 
  // for JPA
  iteratorCreateRequest->type     = 'PLANNER_JAVA_ITERATOR_TYPE_BOOKED_PROGRAMME'; 
  // from session mem
  PLANNER_API_Session_InitParameters;

  // save params from app, that's all java params
  PLANNER_JAVA_PopulateParameterBag( operationType, jSortType, jFilterType, );
  // l_param->t.list.filterType = filter_type;
  // l_param->t.list.sortType = sort_type;
  // l_param->t.list.listType = type;	// this is operationType
  // l_param->t.list.genre = value;


  // <planner-iterator-create> <planner-iterator-change-notification>
  // `PLANNER_API_Session_IteratorCreate` 
  //
  // DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-I: SIC: iter=0x%x, iid=0x%x, \
  //  sid=0x%x, oper=%d, pfilter=%d, psort=%d, sess.iter.count=%d, sess.ele.count=%d viewh=0x%x",
  //  l_iterator, l_iterator_vtable_pos, session, 
  //  l_params->t.list.listType, l_params->t.list.filterType, l_params->t.list.sortType, icount, ecount, l_iterator->view ));
  //
  // M:planner_api.c F:PLANNER_Iterator_Init L:00417 > Created iterator @0x2b0a1ebc
  // M:planner_session.c F:`PLANNER_API_Session_IteratorCreate` L:01791 > 
  //   KT-I: SIC: iter=0x2b0a1ebc, iid=0x1, sid=0x4, optype=1, pfilter=15, psort=2, sess.iter.count=4, sess.ele.count=1 viewh=0x0
  
  // !ENTER  -PLANNER_ITERATOR		< p:0x00000252 P:APP t:0x2df8b520 T:no name M:planner_session.c F:PLANNER_API_Session_IteratorCreate L:2487 > |-> PLANNER_API_Session_IteratorCreate
  // !PARAM  -PLANNER_ITERATOR		< p:0x00000252 P:APP t:0x2df8b520 T:no name M:planner_session.c F:PLANNER_API_Session_IteratorCreate L:2490 > session = 0x4, param = 0x40001, create_callback = 0x576964, " "change_callback = 0x576940, user_tag = 0, request = 0x2df8a224 
  // !INFO   -PLANNER      		< p:0x00000252 P:APP t:0x2df8b520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_GetView_FromPCAT L:6276 > [filter_type 15] [index 15] 
  // !INFO   -PLANNER      		< p:0x00000252 P:APP t:0x2df8b520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_GetView_FromPCAT L:6284 > [sort_type 4] [index 4] 
 

// DARWIN_PLATFORM/DARWIN_PLANNER/inc/planner_types.h
/** @brief Status result codes returned from list request callbacks */
typedef enum PLANNER_API_ListStatusTag
{
   PLANNER_API_LIST_STATUS_UNDEF            = 0U,
   PLANNER_API_LIST_STATUS_FAILED           = 1U, /**<@brief Failed to create list/iterator */
   PLANNER_API_LIST_STATUS_LIST_AVAILABLE   = 2U, /**<@brief Creation of list/iterator successful */
   PLANNER_API_LIST_STATUS_DELETION         = 3U, /**<@brief Element deleted from list/iterator */
   PLANNER_API_LIST_STATUS_INSERTION        = 4U, /**<@brief Element inserted into list/iterator */
   PLANNER_API_LIST_STATUS_CHANGED          = 5U, /**<@brief Element changed in list/iterator */
   PLANNER_API_LIST_STATUS_LASTVALUE        = 6U
} PLANNER_API_ListStatus;


// DARWIN_PLATFORM/DARWIN_PLANNER/inc/planner_session.h
/** @brief Callback function for notifying the change in the contents of an iterator
  * @param[in] handle The handle to the iterator which has changed
  * @param[in] status The success or otherwise of this request

  * Used in the PLANNER_API_Session_IteratorCreate()
  *
  * @par
  * PLANNER_API_Session_IteratorCreate()
  * @par
  * #PLANNER_API_ListStatus
  */
typedef void (*PLANNER_API_Session_IteratorChangeCb)(PLANNER_API_Iterator_Handle handle, PLANNER_API_ListStatus status);


  // PLANNER_API_Session_IteratorCreate(PLANNER_JAVA_IteratorCreateListener, PLANNER_JAVA_IteratorChangeListener, /* user tagi */ vtable_handle, /*out*/ l_planner_request_handle)

  SYSTEM_STATUS `PLANNER_API_Session_IteratorCreate`( PLANNER_API_Session_Handle session,
                                                  PLANNER_API_Parameter_Handle param,
                                                  PLANNER_API_Session_IteratorCreationCb create_callback,
                                                  PLANNER_API_Session_IteratorChangeCb change_callback,
                                                  PLANNER_API_UserTag user_tag,
                                                  PLANNER_API_Request_Handle *request )
  {
    // payload create
    PLANNER_Payload_Create(); 

    // get 'request' handle
    VTABLE_Create(&(l_session->requests), (void **)&req, request, sizeof(uint32_t));

    *req = (uint32_t)PLANNER_REQUEST_PROCESSING;

    // THIS IS ITERATOR ! from iterator vtable in a session.
    VTABLE_Create(&(l_session->iterators), (void **)&l_iterator, &l_iterator_vtable_pos, sizeof(PLANNER_ITERATOR_T));

    // set payload and iterator structure 
    // it's iterator pointer
    l_payload->data.iterator_creation.iterator = l_iterator;

    // SO ihandle will be (sessid + vtable pos)				
    // it's iteraror handle that app will have
    l_payload->data.iterator_creation.ihandle  = session << 16;

    // it's iterator's handle
    l_payload->data.iterator_creation.ihandle |= l_iterator_vtable_pos;

    l_payload->data.iterator_creation.request = *request;

    // PLANNER_JAVA_IteratorCreateListener
    l_payload->data.iterator_creation.create_callback = create_callback; 	

    l_iterator->param = param;

    // *map-iterator-and-view*
    // Try to get the view for iterator. try to get view if it's already exist. should be exist.
    // params->t.list.filterType and params->t.list.sortType on 'f_pcat_view_handles'
    `PLANNER_DBINTERFACE_GetView`('&(l_iterator->view)', &(l_iterator->viewspec), l_iterator->params)
    {
      PLANNER_DBINTERFACE_GetView_FromPCAT()
      {
        // <planner-view-name>
        *view = `f_pcat_view_handles`[i][j];
      }
    }

    // *map-iterator-and-vlist*
    // Try to initialise VTable for iterator's value lists. create vtable for a vlist
    VTABLE_InitTable('&(l_iterator->vlists)', `g_planner_mem_pool`, g_planner_diag_segment_id, NULL, 100);
    VTABLE_SetDeleteElementFunction(&(l_iterator->vlists), 'PLANNER_Iterator_VlistDelete');
    // PCAT_VIEW_VLIST_Free

    VTABLE_SetCreateElementFunction(&(l_iterator->vlists),PLANNER_Iterator_VlistCreate);

    // this is point where iterator creation was done without any problems.
    PLANNER_PostMessage('PLANNER_EV_SESSION_ITERATOR_CREATION', l_payload_handle);
  }

  // to java
  env->returnVal = (uint32_t)l_planner_request_handle;
}


// ITER DELETE
// `PLANNER_Iterator_Delete` THIS IS ACTUAL DELETION. SHOULD BE MATCHED WITH CREATION.
//
// this is a point more near to actual deletion than
// 'PLANNER_API_Iterator_Delete' since it's actually get deleted when there's
// no booked prog handle of iterator available at the time.
//
// DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-I: ID: iter=0x%x, sid=0x%x, sess.iter.count=%d, sess.ele.count=%d",
//	  l_iter, l_iter->session->self_handle, icount, ecount ));
//
// PLANNER_JAVA_IteratorDelete
// PLANNER_API_Iterator_Delete:
// DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-I: ID: iter=0x%x, iid=0x%x, sid=0x%x, iter.ecount=%d, sess.iter.count=%d, sess.ele.count=%d",
//    l_iter, l_iterId, l_sesId, l_iter->count, icount, ecount ));
//
// M:planner_api.c F:PLANNER_Iterator_Delete L:00167 > KT-I: ID: iter=0x2b0a1a40, sid=0x4, sess.iter.count=1, sess.ele.count=0
// M:planner_iterator.c F:PLANNER_API_Iterator_Delete L:00588 > KT-I: ID: iter=0x2b0a1cd0, iid=0x2, sid=0x4, iter.ecount=0, sess.iter.count=1, sess.ele.count=0


// `PLANNER_JAVA_IteratorNext`
// DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("KT: BPH-JIN: bph=0x%x", env->returnVal ));
//
// JNIEXPORT jint JNICALL Java_com_nds_fusion_plannerimpl_PlannerIteratorImpl_natPlannerIteratorNext
//   (JNIEnv *env, jclass jClass, jint param1)


!PARAM  -PLANNER_ITERATOR		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_iterator.c F:`PLANNER_API_Iterator_MoveToIndex` L:1655 > handle = 0x40001, position = 0 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_SetupTemporaryViewWithFilterSpec L:11250 > Creating temporary view PLANNER_TEMP0 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_PRV_CreateView L:7773 > [PLANNER_TEMP0] view created: [pcat_filter_type 1001][pcat_sort_type 1001][view_handle 0x700006f] 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_SetupTemporaryViewWithFilterSpec L:11275 > Changing the temporary view filter parameters 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_PRV_ApplyFilterParameters L:10914 > Creating a filter spec object 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_ExtractFilterParameterRuleSet L:7586 > Found near match in the filter params ruleset table (index = 37) for list_type(1) and filter_type(15) 
!INFO   -PLANNER      		< p:0x0000021f P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_ExtractFilterParameterRuleSet L:7586 > Found near match in the filter params ruleset table (index = 57) for list_type(1) and filter_type(15) 
!INFO   -PCATC        		< p:0x0000021f P:APP t:0x2e134520 T:no name M:pcat_server_proxy.c F:PcatServerProxy_Send L:653 > [API_CALL::IPC] " "IPC_TL_CLIENT_SendBig conn handle 0x3c0000c message id 0x2a message len 35 
!INFO   -PCATC        		< p:0x0000021f P:APP t:0x2e134520 T:no name M:pcat_server_proxy.c F:PcatServerProxy_Send L:666 > [API_CALL::IPC] " "done.  stat = 0x5c01000 
!INFO   -PCATC        		< p:0x0000021f P:APP t:0x0122d520 T:PCAT_PROXY_THREAD M:pcat_server_proxy.c F:PcatServerProxy_ReceivedStatus L:5601 > func_status=0x5c01000 
!RET    -PCATC        		< p:0x0000021f P:APP t:0x0122d520 T:PCAT_PROXY_THREAD M:pcat_server_proxy.c F:PcatServerProxy_ReceivedStatus L:5605 > Finished successfully.\n 
!WARN   -PCATC        		< p:0x0000021f P:APP t:0x2e134520 T:no name M:value_list_man_clnt.c F:PCAT_VIEW_VL_CreateEmpty L:279 > KIT: defined PCAT_ENABLE_EXTRA_VL_DEBUG 
{
  // `PCAT_VIEW_CLNT_POOL`
  // `PCAT_VIEW_VL_CreateEmpty`(view, &valueListLocal, &value_list);
  // `PCAT_VIEW_VL_Create`();
  (ValueListClntStruct* )MEMMAN_API_AllocElementP(PcatViewVLPool,ValuesListsAllocator);
}


<BPH>
http://hetty.cisco.com/fusionmadesimple/index.php/Planner_Excessive_Booked_Programme_Handles

// from planner.cfg
`EXCESSIVE_BOOKED_PROGRAMME_HANDLES_PER_SESSION`=50

/* PLANNER_BOOKED_PROGRAMME_HANDLE_DEBUG is defined in non-release builds to
 * report excessive numbers of booked programme handles.
 */
#ifdef PLANNER_BOOKED_PROGRAMME_HANDLE_DEBUG

// `BPH CREATE`
// static SYSTEM_STATUS PLANNER_StandardIterator_CreateElementAtIndex()
// {
//    // DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-BPH: BPC: sid=0x%x, bph(eh)=0x%x, sess.ele.count=%d",
//    // l_session->self_handle, element_handle, ecount ));
//    // M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_Create L:00170 > KT-BPH: BPC: sid=0x4, bph(eh)=0x2bac2568, sess.ele.count=7
//
//    // * @param[in]  session_handle Session handle
//    // * @param[in]  book_id        ID of the element in Value List.
//    // * @param[in]  booking_subclass The required booking subclass value
//    // * @param[out] `element_handle` Handle to newly created booked programme instance
//
//    // When a booked programme handle is created from the iterator, Planner
//    // `creates a PCAT value list` to suppport the reading of element properties. 
//
//    `PLANNER_BookedProgramme_Create`();
// }

#define `PLANNER_BookedProgramme_Create`(session_handle, book_id, booking_subclass, element_handle) \
    PLANNER_BookedProgramme_CreateDebug((session_handle), (book_id), (booking_subclass), __FILE__, __LINE__, (element_handle))
{
    PLANNER_BOOKEDPROGRAMME_T *l_booking = NULL;

    PLANNER_BookedProgramme_CreateInner(session_handle, book_id, booking_subclass, &l_booking, element_handle);
    {
      PLANNER_BookedProgramme_CreateWithSessionInner(l_session, book_id, SBM_USERBOOKING_LISTENER_ILLEGAL, booking_subclass, booking, element_handle);
      {
        // typedef struct PLANNER_BOOKEDPROGRAMME_S {
        //     PCAT_VIEW_VALUE_LIST  VL;
        // } PLANNER_BOOKEDPROGRAMME_T;

        PLANNER_BookedProgramme_CreateWithSessionInner(PLANNER_SESSION_T *l_session, PCAT_VIEW_OBJECT_ID book_id,
            VRM_JOB_HANDLE job_id, PLANNER_API_BookingSubclass booking_subclass,
            PLANNER_BOOKEDPROGRAMME_T **booking, PLANNER_API_BookedProgramme_Handle *element_handle)
        {
          PLANNER_BOOKEDPROGRAMME_T *l_booking = NULL;

          // note:
          // DO not set l_booking->VL. WHERE?
          
          l_element->type = PLANNER_ELEMENT_TYPE_BOOKING;
          l_booking = &(l_element->data.booking);
          l_status = PLANNER_API_STATUS_OK;
          l_booking->booking_subclass = booking_subclass;
          // ...

          *element_handle  = l_session->self_handle << 16;
          *element_handle += l_elId;
          *booking = l_booking;
        }
      }
    }

    // to report
    // void PLANNER_BookedProgramme_NoteCreation(PLANNER_BOOKEDPROGRAMME_T *booking, uint32_t handle, const char *file, int line)
    PLANNER_BookedProgramme_NoteCreation(l_booking, *element_handle, file, line);
    {
      static bool PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator(void *object, void *data)
      {
        note: ???
        Does `l_booking-VL` corresponds to 

        // !WARN   -PCATC < p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:value_list_man_clnt.c F:PCAT_VIEW_VL_LogAllocVL L:2816 > 
        // VL hdl=0x76d4 allocated but not freed for view PLANNER17 hdl=0x7000014, " "flags=0, ObType=0, num_rows=1, total_size=712, curpos=0 

        `DIAG_LOG_INFO`(g_planner_diag_segment_id, 
            ("%u: Handle %#x created at %s:%u vlist %#x", l_data->count, l_booking->self_handle, l_booking->file, l_booking->line, `l_booking->VL`));
      }
    }
}


// `BPH DELETE`
//
// PLANNER_JAVA_ApiBookedProgrammeDelete
// DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("KT-BPH: JBD: bph=0x%x", j_bookedprogramme_handle ));
//
// PLANNER_API_BookedProgramme_DeleteHandle	
// DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-BPH: BPD: sid=0x%x, bph(eh)=0x%x, sess.ele.count=%d",
// l_sesId, handle, ecount ));
//
// DIAG_LOG_ERROR(g_planner_diag_segment_id,("Deleted element @%p iterator 0x%X @%p VL 0x%X"
// 	, l_booking, l_booking->iterator_handle, l_booking->iterator, l_booking->VL));
//
// M:planner_common.c F:PLANNER_Element_Delete L:03629 > Deleted element @0x2b0a0704 iterator 0x4023E @0x2b0a0f64 VL 0x24B2
//
// PLANNER_API_BookedProgramme_Handle handle
//
// DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT-BPH: BPD: sid=0x%x, bph=0x%x, sess.ele.count=%d",
// 	l_sesId, handle, ecount ));
//
// M:planner_bookedprogramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02749 > KT-BPH: BPD: sid=0x4, bph(eh)=0x40ec3, sess.ele.count=5

SYSTEM_STATUS PLANNER_API_BookedProgramme_DeleteHandle( PLANNER_API_BookedProgramme_Handle handle )
{
#ifdef PLANNER_BOOKED_PROGRAMME_HANDLE_DEBUG
    /* Booked programme handle tracking. */
    `DIAG_LOG_INFO`(g_planner_diag_segment_id, ("Deleting booked programme handle %#x", handle));
#endif

    // get ids from handle
    l_sesId = handle >> 16;
    l_elId = handle << 16;
    l_elId >>= 16;

    DIAG_LOG_ERROR(g_planner_diag_segment_id, ("KT: BPD: sid=0x%x, bph(eh)=0x%x, sess.ele.count=%d",
			l_sesId, handle, ecount ));

    // note: *bhp-delete-element*
    /* Delete element */
    if (VTABLE_ReleaseElement(&(l_session->elements), l_elId) != VTABLE_STATUS_SUCCESS)
}


<how-to-interpret>
// these are unique.
!INFO   -PLANNER      		< M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_NoteCreation L:241 > Created booked programme handle 0x490f1 

// only when # of bph > 50
!`WARN`   -PLANNER      		< M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_NoteCreation L:268 > 50 booked programme handles in use in session 0x4: 

// see it has vlist value later
// M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_NoteCreation L:241 > Created booked programme handle 0x490f1
// M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 0: Handle 0x490f1 created at planner_iterator.c:2664 vlist 0
// M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 1: Handle 0x490f1 created at planner_iterator.c:2664 vlist 0xf7ae
// M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 2: Handle 0x490f1 created at planner_iterator.c:2664 vlist 0xf7ae
// M:planner_bookedprogramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:5604 > Deleting booked programme handle 0x490f1

// list out all bhp in the session so do not simply grep on this log line.
!INFO F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 0: Handle 0x490f1 created at planner_iterator.c:2664 vlist 0 
!INFO F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 1: Handle 0x490f0 created at planner_iterator.c:2664 vlist 0xf7ad 
...
!INFO F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 48: Handle 0x419e4 created at planner_iterator.c:2664 vlist 0x2ba2 
!INFO F:PLANNER_BookedProgramme_CountAndReportSessionHandlesIterator L:212 > 49: Handle 0x41959 created at planner_iterator.c:2664 vlist 0x2c03 
!INFO   -PLANNER      		< M:planner_list_element.c F:PLANNER_ListElement_UnravelData L:580 > Booked programme is from an iterator 
!INFO   -PLANNER      		< M:planner_dbinterface.c F:PLANNER_DBINTERFACE_AddFilterParameters L:10859 > Filter has already been applied to this view 

!INFO   -PLANNER < M:planner_bookedprogramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:5604 > Deleting booked programme handle 0x490df 
!INFO   -PLANNER < M:planner_bookedprogramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:5604 > Deleting booked programme handle 0x490e0 


<planner-view-name>
Create all view from the start.

Planner creates 147 views in total and uses global tables:

const PLANNER_FILTER_TYPE_MAP f_filter_types_map[];
const PLANNER_SORT_TYPE_MAP f_sort_types_map[];


SYSTEM_STATUS PLANNER_InitialisePCATViews(void)
{
  PLANNER_DBINTERFACE_Create_PCAT_View_Pool()
  {
    for(i = 0U; i < f_filter_types_map_len; i++)
    {
      for( j = 0U; j < f_sort_types_map_len; j++)
      {
        /* In the view parameters set the filter and sort types. */
        l_view_params.t.list.filterType = `f_filter_types_map`[i].planner_type;
        l_view_params.t.list.sortType = `f_sort_types_map`[j].planner_type;

        /* Create PCAT view and store the handle to it in f_pcat_view_handles. */
        if(PLANNER_API_STATUS_OK!=PLANNER_DBINTERFACE_PRV_CreateBookingView(
              &`f_pcat_view_handles`[i][j], &f_pcat_viewspec_handles[i][j],
              &l_view_params));
      }
    }
  }
}


SYSTEM_STATUS PLANNER_DBINTERFACE_PRV_CreateBookingView(PCAT_VIEW_HANDLE* viewHandlePtr,
    PCAT_VIEW_SPEC_HANDLE* viewspecHandlePtr, const PLANNER_PARAMETER_T* params)
{
  static uint32_t l_view_number = 1U;
  (void)snprintf(l_view_name,sizeof(l_view_name),"PLANNER%lu", (long unsigned)l_view_number );
  l_view_number++;

  /* Create the view */
  `PLANNER_DBINTERFACE_PRV_CreateView`(l_view_name,
        l_property_list, l_property_list_length,
        l_pcat_filter_type, l_pcat_sort_type,viewHandlePtr, viewspecHandlePtr)
  {
    PCAT_VIEW_New(g_planner_PCAT_client_id, view_name,*viewspec_handle_ptr,view_handle_ptr);
    {
      PCAT_VIEW_VIEW_Create(const char* pView_name, PCAT_VIEW_HANDLE  pView_handle)
      {
        ViewManClntAllocateNew(PCAT_VIEW_HANDLE view_hdl)
        {
          // `PCAT_VIEW_CLNT_POOL` on view name?
          PCAT_AllocStaticP(PcatViewClntPool, sizeof(char) * (len + 1U), (void**)&p_view_def->view_name);
        }
      }
    }

    // !INFO   -PLANNER      		< p:0x00000222 P:APP t:0x01158520 T:PLANNER_MAIN M:planner_dbinterface.c F:PLANNER_DBINTERFACE_PRV_CreateView L:7773 > 
    // [PLANNER17] view created: [pcat_filter_type 514][pcat_sort_type 9][view_handle 0x7000014] 
    //
    // for iterator move next
    // !INFO   -PLANNER      		< p:0x00000252 P:APP t:0x2e134520 T:no name M:planner_dbinterface.c F:PLANNER_DBINTERFACE_PRV_CreateView L:7773 > 
    // [PLANNER_TEMP0] view created: [pcat_filter_type 1001][pcat_sort_type 1001][view_handle 0x700006f] 
  }
}


// PCAT_CAT_PROP_EXT_FILTER_TYPE_RANGE_START(500)
//
// #define PCAT_CAT_FILTER_TYPE_SEARCHBY_EVENTNAME_AND_GENRE
// (PCAT_CAT_PROP_EXT_FILTER_TYPE_RANGE_START +14) 
//
// /**< @brief Used for A-Z search. Used with 3 filter parameters :*/

// note: this is param type
//
// PLANNER_API_SortTypeTag
// {
//  PLANNER_API_SORT_TYPE_TIME				(2)
//  PLANNER_API_SORT_TYPE_PVOD_PUBLISH_TIME (5)
//  PLANNER_API_SORT_TYPE_ITEM_NAME                          = 9U,  /**<@brief Sort filter by item name */
// }

// #define     PCAT_CAT_SORT_TYPE_TIME_DESC                9       
// /**< @brief  Sort by event scheduled start time descending (and logical channel ID). Reverse of #PCAT_CAT_SORT_TYPE_TIME.  WP943. */

// KTT: f_filter_types_map_len(30), f_sort_types_map_len(10)
// KTT: l_view_name(PLANNER17), param.filterType(9), l_pcat_filter_type(509), param.sortType(7), l_pcat_sort_type(504)
// PLANNER_API_FILTER_TYPE_PVOD(10)
// define PCAT_CAT_FILTER_TYPE_PUSH_ANYTIME_MENU											(PCAT_CAT_PROP_EXT_FILTER_TYPE_RANGE_START +21)					
// /**<Filters BOOKING jobs with signup job of type PUSH and publish time < current time, use PCAT_CAT_FILTER_PARAM_TYPE_GENRE and PCAT_CAT_FILTER_PARAM_TYPE_SUBGENRE to get only wanted genre and subgenre, WP222_223: use PCAT_CAT_FILTER_PARAM_TYPE_STRING to exlude events with a SIGNUP_URI equals to one of the URIs specified in the filter param string, seperated by "," 
// 
// PCAT_CAT_PROP_EXT_SORT_TYPE_RANGE_START (500)
// define		PCAT_CAT_SORT_TYPE_PUSH_PUBLISHTIME						 (PCAT_CAT_PROP_EXT_SORT_TYPE_RANGE_START + 6)		/**< @brief  Sorts according to PUSH PUBLISH TIME and then by ACTUAL START TIME*/


<planner-pcat-use>
SI-10793-pcat-view-clnt-pool-oom/01-darwin_0019fbf2d3c9_e5f6f859c892b462a96b21c1cef1dae1

// seen once
668455: !WARN   -PLANNER                    < p:0x0000020e P:APP t:0x2df8b520 T:no name M:planner_bookedprogramme_management.c F:PLANNER_BookedProgramme_NoteCreation L:268 > 
  50 booked programme handles in use in session 0x4:

// first
705548: !WARN   -PCATC                      < p:0x0000020e P:APP t:0x2dfa4520 T:no name M:value_list_man_clnt.c F:PCAT_VIEW_VL_LogAllocVL L:2774 > 
  `Number of allocated value lists=54` log_all=1 thread=0x2dfa4520 no name

!ERROR  -PCATS        		< p:0x0000020c P:MW t:0x01f12520 T:SBM_UB_MAIN M:value_list_man_clnt.c F:PCAT_VIEW_VL_Free L:619 > PCAT_VIEW_VL_FindByHandle hdl=0 
!ERROR  -PCATS        		< p:0x0000020c P:MW t:0x01f12520 T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_VLIST_Free L:2420 > Finished with error: Invalid parameters (0x5c21029) 
!WARN   -PCATS        		< p:0x0000020c P:MW t:0x01ab3520 T:PCAT_SRV_THREAD M:dbview.c F:DbviewNotifications_NotifyClientOnInsertion L:16476 > The view has been freed. Notifications for this view won't be sent 


// just before OOM
//
// note: counter_elem (# of allocated value list) increases whenever it gets
// called.
//
// `PCAT_VIEW_VL_Create`()
// allocs on `PcatViewVLPool` is `PCAT_VIEW_CLNT_POOL`
// PCAT_VIEW_SRV_GetPrivatePool(&PcatViewVLPool);
//
// note: `value list` on the same view 
//

1533671: !WARN   -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:value_list_man_clnt.c F:PCAT_VIEW_VL_LogAllocVL L:2774 > 
  `Number of allocated value lists=95` log_all=1 thread=0x117a520 PCAT_PROXY_THREAD 

!WARN   -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:value_list_man_clnt.c F:PCAT_VIEW_VL_LogAllocVL L:2816 > 
  VL hdl=0x15466 allocated but not freed for `view PLANNER17 hdl=0x7000014`, " "flags=0, ObType=0, num_rows=1, total_size=905, curpos=0 
!WARN   -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:value_list_man_clnt.c F:PCAT_VIEW_VL_LogAllocVL L:2816 > 
  VL hdl=0x76d4 allocated but not freed for `view PLANNER17 hdl=0x7000014`, " "flags=0, ObType=0, num_rows=1, total_size=712, curpos=0 
...


!ERROR  -MEMMAN       		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:mem_blockpool.c F:MHWMemCheckBank L:310 > CHECK_BANK Size:40 FreeSize:12 Bank:1 PoolMAX:409588 

1533777:!WARN   -MEMMAN       		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:mem_static.c F:MHWMemAllocStatic L:75 > Cannot allocate 40 bytes in pool " "PCAT_VIEW_CLNT_POOL"  


// see others uses that use pool PCAT_VIEW_CLNT_POOL such as serialization.

!WARN   -MEMMAN       		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:mem_static.c F:MHWMemAllocStatic L:78 > Biggest block is 12 bytes 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:pcat_misc.c F:PCAT_AllocStaticP_DBG L:411 > not enough memory: size=19, called from 
  M=pcat_serialize_structs.c, 
  F=PCAT_SERIALIZE_deserialize_PropValue, L=215 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:pcat_serialize_structs.c F:PCAT_SERIALIZE_deserialize_PropValue L:275 > Deserializaton failed 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:pcat_serialize_structs.c F:PCAT_SERIALIZE_deserialize_P_PropValue L:383 > Deserializaton failed 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x0117a520 T:PCAT_PROXY_THREAD M:pcat_serialize_structs.c F:PCAT_SERIALIZE_Deserialize_DBVIEW_ValueListStruct L:771 > Deserializaton failed 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:pcat_server_proxy.c F:PCAT_VIEW_SRV_SelectCollapsedList L:2434 > Finished with error: Failure (0x5c21001) 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:pcat_view_clnt.c F:PCAT_VIEW_SelectCollapsedList L:1097 > PCAT_VIEW_SRV_SelectCollapsedList stat=0x5c21001, view=0x7000014 
!ERROR  -PCATC        		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:pcat_view_clnt.c F:PCAT_VIEW_SelectCollapsedList L:1121 > Finished with error: Failure (0x5c21001) 
!ERROR  -PLANNER      		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_list_element.c F:PLANNER_ListElement_PRV_GetValueListCollapsed L:994 > Call to PCAT_VIEW_SelectCollapsedList failed 
!ERROR  -PLANNER_ITERATOR		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_iterator.c F:PLANNER_StandardIterator_GetVListFromCache L:3449 > Failed to obtain IDs 
!ERROR  -PLANNER_ITERATOR		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_iterator.c F:PLANNER_StandardIterator_RetrieveVListToCache L:4475 > Failed to get vlist 
!ERROR  -PLANNER_ITERATOR		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_iterator.c F:PLANNER_StandardIterator_InitCache L:4654 > Failed to get or retrieve vlist at index -1 
!ERROR  -PLANNER_ITERATOR		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_iterator.c F:PLANNER_StandardIterator_RefreshIfNecessary L:1025 > Failed to initialise the new iterator cache 
!ERROR  -PLANNER_ITERATOR		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:planner_iterator.c F:PLANNER_StandardIteratorImpl_GetNextIndex L:1322 > Failed to refresh iterator 
!ERROR  -J_PLANNER    		< p:0x0000020e P:APP t:0x2bfeb520 T:no name M:modules/jpa-impl/src/c/src/natPlannerIteratorImp 
  F:Java_com_nds_fusion_plannerimpl_PlannerIteratorImpl_natPlannerIt L:77 > PLANNER_API_Iterator_GetNextIndex failed: 0x6422001

JNIEXPORT jint JNICALL Java_com_nds_fusion_plannerimpl_PlannerIteratorImpl_natPlannerIteratorNextIndex
  (JNIEnv *env, jclass jClass, jint param1)
{
    status = PLANNER_API_Iterator_GetNextIndex(jNativeHandle, (int32_t*)&jReturnVal);
    if (!SYSTEM_STATUS_IS_OK(status))
    {
        DIAG_LOG_ERROR(g_planner_adaptor_api_diag_segment_id, ("PLANNER_API_Iterator_GetNextIndex failed: 0x%x", status));
    }

    (void)PLANNER_JAVA_ParseReturn(env, status);

    DIAG_LOG_FN_EXIT(g_planner_adaptor_api_diag_segment_id, status);
    return (jint)jReturnVal;
}

#ifdef PLANNER_ITERATORS_SUPPORTED
/**
 * @brief Standard iterator get `next index` implementation
 *
 * @param[in] iterator Iterator structure
 * @param[out] param_index The next object index to the iterator
 * @retval #PLANNER_API_STATUS_OK on success
 * @retval #PLANNER_API_STATUS_NOT_OK on failure
 */
static SYSTEM_STATUS PLANNER_StandardIteratorImpl_GetNextIndex(`PLANNER_ITERATOR_T` *iterator, int32_t *param_index)
{
    /* Refresh the iterator if there has been a change to the view */
    if (PLANNER_API_STATUS_OK != PLANNER_StandardIterator_RefreshIfNecessary(iterator->handle, false))
    {
        DIAG_LOG_ERROR( g_planner_iterator_diag_segment_id, ("Failed to refresh iterator"));
    }

    DIAG_LOG_FN_EXIT( g_planner_iterator_diag_segment_id, l_status);
    return l_status;
}

// NO longer available
//
// /* PLANNER_API_Iterator_Handle         handle
// ** PLANNER_API_BookedProgramme_Handle  l_element_handle;
// ** PLANNER_ITERATOR_T                 *l_iter
// **
// ** DIAG_LOG_ERROR(g_planner_diag_segment_id,("Created element 0x%X @%p from iterator 0x%X @%p",
// ** 	l_element_handle, l_booking, handle, l_iter));
// */
// // can map BPH, VL and iterator
// M:planner_iterator.c F:PLANNER_Iterator_CreateElementAtIndex L:01464 > Created element 0x40EC5 @0x2b0a0bf4 from iterator 0x40241 @0x2b0a07e0
//
// PLANNER_Iterator_DumpIterators
//   dumps all iterators and elements of a session.
//
// DUMP: l_booking->iterator, l_booking->VL
//
// PCAT_VIEW_VALUE_LIST  VL;
// PLANNER_ITERATOR_T   *iterator;
//
// DIAG_LOG_ERROR(g_planner_diag_segment_id,("PBP @%p Iterator @%p VL 0x%X", l_booking, l_booking->iterator, l_booking->VL));
//
// M:planner_iterator.c F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1ebc:
// M:planner_iterator.c F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a0428 Iterator @0x2b0a07e0 VL 0x24D1
//
// F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1ebc:
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a18c4 Iterator @0x2b0a1a40 VL 0x40
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a1940 Iterator @0x2b0a1a40 VL 0x40
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a1b60 Iterator @0x2b0a1a40 VL 0x40
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a1c08 Iterator @0x2b0a1a40 VL 0x40
// # DIAG_LOG_ERROR(g_planner_diag_segment_id,("PBP @%p Iterator @%p VL 0x%X", 
// # l_booking, l_booking->iterator, l_booking->VL));
// 
// DIAG_LOG_ERROR(g_planner_diag_segment_id,("Deleted element @%p iterator 0x%X @%p VL 0x%X", 
// l_booking, l_booking->iterator_handle, l_booking->iterator, l_booking->VL));
//
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02727 > Deleting PBP 0x40010
// F:PLANNER_Element_Delete L:03629 > Deleted element @0x2b0a1c08 iterator 0x40008 @0x2b0a1a40 VL 0x40
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02749 > KT-BPH: BPD: sid=0x4, bph(eh)=0x40010, sess.ele.count=3
//
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02727 > Deleting PBP 0x40011
// F:PLANNER_Element_Delete L:03629 > Deleted element @0x2b0a1b60 iterator 0x40008 @0x2b0a1a40 VL 0x40
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02749 > KT-BPH: BPD: sid=0x4, bph(eh)=0x40011, sess.ele.count=2
//
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02727 > Deleting PBP 0x40012
// F:PLANNER_Element_Delete L:03629 > Deleted element @0x2b0a1940 iterator 0x40008 @0x2b0a1a40 VL 0x40
// gramme.c F:PLANNER_API_BookedProgramme_DeleteHandle L:02749 > KT-BPH: BPD: sid=0x4, bph(eh)=0x40012, sess.ele.count=1
//
// F:PLANNER_Iterator_RefreshIfNecessary L:00510 > Dumping state
// F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1a40:
// F:PLANNER_DumpVlist L:03213 >  Vlist @0x2b0a1e70 min 160 max 164 vlist 0x54
// F:PLANNER_DumpVlist L:03213 >  Vlist @0x2b0a2024 min 152 max 160 vlist 0x53
// F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1ebc:
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a18c4 Iterator @(nil) VL 0x0
// F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1a40:
// F:PLANNER_DumpVlist L:03213 >  Vlist @0x2b0a1e70 min 160 max 164 vlist 0x54
// F:PLANNER_DumpVlist L:03213 >  Vlist @0x2b0a2024 min 152 max 160 vlist 0x53
// F:PLANNER_DumpSessionIterators L:03228 > Iterator @0x2b0a1ebc:
// F:PLANNER_DumpSessionElements L:03254 > PBP @0x2b0a18c4 Iterator @(nil) VL 0x0
//
// or.c F:PLANNER_API_Iterator_Delete L:00554 > Deleting iterator 0x4000A
// F:PLANNER_Iterator_Delete L:00167 > KT-I: ID: iter=0x2b0a17fc, sid=0x4, sess.iter.count=2, sess.ele.count=4


PLANNER_JAVA_ApiSessionCreateIteratorBookmarks
PLANNER_JAVA_ApiSessionCreateIteratorCopyList
PLANNER_JAVA_ApiSessionCreateIteratorFilteredAny

PlannerThread()
{
  "f_planner_event_message_table" (planner_common.c)
    // PLANNER_EV_REMINDER_ACK
    PLANNER_ProcessNextReminder();

  // PLANNER_EV_ADD_BOOKED_PROGRAMME
  PLANNER_AddBookedProgramme_Handler();

  // PLANNER_EV_REMINDER_TRIGGER_NTFY
  PLANNER_ProcessNextReminder();

  // PLANNER_EV_VIEW_CHANGE_NOTIFICATION
  PLANNER_DBINTERFACE_Notify_ViewChange();

  // PLANNER_EV_SESSION_ITERATOR_CREATION
  // Function is called after creation of iterator to finalise the creation.
  PLANNER_Session_Iterator_Creation(uint32_t payload_handle)
  {
    // create listener
    VTABLE_Create(&l_listener, &l_listener_handle, sizeof(PLANNER_LISTENER_T));

    // ???
    PLANNER_DBINTERFACE_PopulateTempTable();

    // get count from PCAT view and this will be the total count in the view for that filter.
    PLANNER_API_Iterator_GetCount(l_payload->data.iterator_creation.ihandle, &l_count)
    {
      PLANNER_DBINTERFACE_GetNumViewItems()
      {
        PLANNER_DBINTERFACE_GetNumViewItems_FromPCAT();
      }
    }

    // VL is ready?
    PLANNER_Iterator_InitCache( ,l_count, )
    {
      PLANNER_ITERATOR_VLIST_T* vlist = NULL;

      // try to find vlist from cache and if not, create new one.
      PLANNER_Iterator_GetVListFromCache(handle, cache_version, 0U, &vlist, is_locked, false, 0U)
      {
        // create one in the iter's vtable
        VTABLE_Create('&(l_iter->vlists)', (void**)&l_vlist, &l_vlistHandle, sizeof(PLANNER_ITERATOR_VLIST_T));

        // get new vlist. always request 5 to pcat
        PLANNER_ListElement_PRV_GetData( , 1, NUM_ELEMENTS_IN_ITER_VLIST(5), &(l_vlist->vlist))
        {
          PLANNER_ListElement_PRV_GetValueListCollapsed( , PCAT_VIEW_VALUE_LIST* vlist)
          {
            PCAT_VIEW_SelectCollapsedList( /* `out` */ vlist);
            {
              // typedef struct ValueListClntStructTag
              // {
              // 	DBVIEW_ValueListStruct		value_list;
              //  uint32_t					current_position;
              //  PCAT_PROP_HANDLE_UNION**	to_be_destroyed;
              //  PCAT_VIEW_HANDLE dbg_view_hdl; /* associated view for debugging */
              //  uint8_t dbg_usage_flags;       /* usage flags for debugging */
              // }ValueListClntStruct;

              ValueListClnt value_list = NULL;

              PCAT_VIEW_VL_CreateEmpty(view, &valueListLocal, &value_list)
              {
                // note: VL allocates per iterator?
                // value_list_man_clnt.c is only to use `PCAT_VIEW_CLNT_POOL`
                // `allloc` ValueListClnt using MEMMAN_API_AllocElementP(PcatViewVLPool); 
              }

              // (DBVIEW_ValueListStruct* value_list)
              PCAT_VIEW_SRV_SelectCollapsedList(, &(value_list->value_list))
              {
                // `PCAT_VIEW_CLNT_POOL`
                // construct req msg, serialize, and send it to pcat svr
                // and wait response on `PcatViewProxyPool`
                // copy value list from a svr response

                value_list->prop_values_list = value_list_array_from.prop_values_list;
              }

              // set value for each props in the value list?
              PCAT_VIEW_VL_ToBeDestroyStructInit
              { 
                // `PCAT_VIEW_CLNT_POOL`
                PCAT_AllocStaticP(PcatViewVLPool); 
              }

              // return valueListLocal(=value_list)
              *pValueList = valueListLocal;
            }
          }
        }
      }

      l_ihandle = l_payload->data.iterator_creation.ihandle;

      PLANNER_Callback_RunWithArgUsertagStatusHandle(, l_payload->data.iterator_creation.create_callback, l_payload->user_tag, l_ihandle )
      {
        PLANNER_Payload_CB_Create

          payload->data.cb_usertag_status_handle = user_callback;
        // l_ihandle
        payload->handle = handle; 

        PLANNER_PostMessage((l_session_struct->cb_queue_id), PLANNER_EV_CB_USERTAG_STATUS_HANDLE);
      }
    }
  }
}
		
PLANNER_CallbackThread
	PLANNER_ExecuteUserCallback
	  case PLANNER_EV_CB_USERTAG_STATUS_HANDLE:
    	l_payload->data.cb_usertag_handle_status(l_payload->user_tag, l_payload->status, l_payload->handle);

    	
# only supports two type of iterators
PLANNER_JAVA_IteratorCreateListener
(PLANNER_API_UserTag l_user_tag, PLANNER_API_ListStatus l_completion_status, 'PLANNER_API_Iterator_Handle' l_iterator_handle)
{
	JPA_VTABLE_GetElement(&g_planner_adaptor_IteratorCreateRequest,l_user_tag,(void **)&iteratorCreateRequest);
	
	# get PlannerBookedProgrammeIterator that comes from app. that's for java.
	currentIterator                      = iteratorCreateRequest->iterator;

	iteratorCreateRequest->native_handle = l_iterator_handle;

	switch (iteratorCreateRequest->type)	
		case 'PLANNER_JAVA_ITERATOR_TYPE_BOOKED_PROGRAMME':
			use signature PlannerBookedProgrammeIteratorCreationListener
		case PLANNER_JAVA_ITERATOR_TYPE_BOOKMARK:

	# use 'request' which was created when requested and request's data to make a call to the APP.
	
	# currentIterator is a java iterator
	NDSJNI_SetField(&l_env, currentIterator, (uint8_t*)"nativeHandle", (uint8_t*)"I", (void*)&l_iterator_handle, );
	
	JPA_VTABLE_ReleaseElement(&g_planner_adaptor_IteratorCreateRequest, l_user_tag);
}	

#
PLANNER_JAVA_IteratorDelete
	PLANNER_API_Iterator_Handle jNativeHandle             = *(PLANNER_API_Iterator_Handle*)env->params[0];
	PLANNER_API_Iterator_Delete(jNativeHandle)
		# get sid and iid from IteratorHandle and get actual objs from vtables using these ids.
    	# /* Safely get the session ID from handle */
    	# l_sesId = handle >> 16;
    	# /* And the list id */
    	# l_iterId = handle << 16;
    	# l_iterId >>= 16;
		#
		(void)VTABLE_ReleaseElement(&l_session->iterators, l_iterId); 

# when it's called, seems that get the next page(5) and rebuild cache. not every time but do in the first call.
# F:PLANNER_ListElement_PRV_GetData L:00616 > KT: start(6), requested_num(5), *returned_num(5)
PLANNER_JAVA_IteratorHasNext
	PLANNER_API_Iterator_HasNextElement

PLANNER_JAVA_IteratorHasPrevious
	PLANNER_API_Iterator_HasPreviousElement

PLANNER_JAVA_IteratorNextIndex
	PLANNER_API_Iterator_GetNextIndex

PLANNER_JAVA_IteratorMoveByRelative
			


/* Structure that represents a booked programme */
typedef struct {
    PLANNER_API_BookingSubclass booking_subclass;
    PLANNER_SHORT_LIST_T *list;
    PLANNER_ITERATOR_T   *iterator;
    uint32_t              iterator_handle;
    uint32_t              shortlist_handle;
    uint32_t              list_id;
    PLANNER_SESSION_T    *session;
    PCAT_VIEW_OBJECT_ID   element_id;
#ifndef HOME_NETWORK_PLANNER_CLIENT    
    PCAT_VIEW_VALUE_LIST  VL;
#else
    SCM_LIST  VL;
#endif    
    bool                  VL_inited;
    /* Indicates whether automatic update mechanism should be used on this booking.*/
    bool                  allow_VL_updates;
    bool                  is_refresh_element_vl_not_allowed;	
    uint32_t              conflict_element;
    uint32_t              ghost_conflict_element;    
    bool                  conflicting_booking;
    bool                  booking_in_progress;
    bool                  move_booking_in_progress;
    uint32_t              add_booked_programme_payload_id;
    bool                  ppv_purchase_booking;
    PCAT_VIEW_OBJECT_ID   event_id;
    uint32_t              pdl_progress_kb;
    bool                  is_pdl_progress_being_monitored;
    bool                  pdl_trailer_download_timeout_occured;
    uint32_t              ref_count; /* Reference count */
    bool                  waiting_for_access;    
    bool                  is_coherent;
    bool                  is_deleting;
    /* 
     * The field substitute_booking_job_id allows PLANNER_ListElement_DeleteBookingValueList
     * to change the booking job ID of a booking structure.
     * If it is set to PCAT_VIEW_OBJECT_ID_ILLEGAL (the default case), the booking job ID remains unchanged.
     * If it is set to a valid object ID, this is used as the new booking job ID
     */
    PCAT_VIEW_OBJECT_ID   substitute_booking_job_id; 
    PLANNER_API_BookingType bookingType; /* Cached booking type */
    uint32_t              positionInLongList; /* The position of this booked programme in a collapsed long list or iterator */
    SBM_USERBOOKING_LISTENER  job_id;
    SBM_USERBOOKING_LISTENER reference_id; /*This handle will be got it from the SBM*/
} PLANNER_BOOKEDPROGRAMME_T;

typedef union 
{
    PLANNER_BOOKEDPROGRAMME_T booking;
    PLANNER_BOOKMARK_T        bookmark;
} PLANNER_ELEMENT_DATA_T;

typedef enum {
    PLANNER_ELEMENT_TYPE_UNDEF = 0,
    PLANNER_ELEMENT_TYPE_BOOKING,
    PLANNER_ELEMENT_TYPE_BOOKMARK,
    PLANNER_ELEMENT_TYPE_LAST
} PLANNER_ELEMENT_TYPE_T;

typedef struct
{
    PLANNER_ELEMENT_DATA_T data;
    PLANNER_ELEMENT_TYPE_T type;
} PLANNER_LIST_ELEMENT_T;


PLANNER_JAVA_IteratorNext
	PLANNER_API_Iterator_CreateNextElement( /* iter handle, jNativeHandle */ handle, /*out*/ PLANNER_API_ListElement_Handle *item_handle);

PLANNER_JAVA_IteratorPrevious
	PLANNER_API_Iterator_CreatePreviousElement(jNativeHandle, &env->returnVal);
	{
		# Corrects the iterator's position in case the list has changed.
		PLANNER_Iterator_AdjustIteratorPosition
			PLANNER_Iterator_GetVListIfAvailable
				
		PLANNER_API_Iterator_HasNextElement(handle, /* bool */ &l_next_elem);
		
		'PLANNER_Iterator_CreateElementAtIndex'(handle, PLANNER_API_ListElement_Handle * 'item_handle', l_iter->position);
		{
        *value-list*
			ExtractIteratorStructure() # get a actual iter structure from a iter handle

			PLANNER_Iterator_GetVListFromCache(handle, l_iter->cache_version, l_index, &l_vlist, false, false, 0U)
			{
				# If there is a vlist that contains element from this index
				VTABLE_FindElement(&(l_iter->vlists)
				
            *value-list*
				# if there's no vlist(PLANNER_ITERATOR_VLIST_T)
				VTABLE_Create(&(l_iter->vlists), (void**)&l_vlist, &l_vlistHandle, sizeof(PLANNER_ITERATOR_VLIST_T));
				
				## GET VLIST!
				##
				PLANNER_ListElement_PRV_GetData(l_iter->params, l_iter->view, , &(l_vlist->max), &(l_vlist->vlist));
				{
					PLANNER_ListElement_PRV_GetValueList
					{
						PCAT_VIEW_Select(view, requested_num, returned_num, &(l_is_end_of_view), vlist);
					}
				}
				
				*vlist = l_vlist;
			}
			
			# if l_iter->params->t.list.listType != PLANNER_API_PARAMETER_LISTTYPE_BOOKMARKS
			{
				'PLANNER_BookedProgramme_Create'( l_sesId, PLANNER_API_BookedProgramme_Handle *element_handle)
					PLANNER_BookedProgramme_CreateWithSession(, element_handle);
					{
						# PLANNER_LIST_ELEMENT_T has PLANNER_BOOKEDPROGRAMME_T
						#
						VTABLE_Create(&(l_session->elements), (void **)&l_element, &l_elId, sizeof(PLANNER_LIST_ELEMENT_T));
						
						# set l_element
						
						## THIS IS ITEM TO BE RETURNED!
						##
						*element_handle += l_elId;
					}
				
				l_booking = ExtractBookingStructure(l_element_handle));
				
				# Fill the 'l_booking' structure
				l_booking->VL = l_vlist->vlist;
				l_booking->iterator_handle = handle;	

				'*item_handle  = l_element_handle';				
			}
			# PLANNER_API_PARAMETER_LISTTYPE_BOOKMARKS
			else
			{
				VTABLE_Create(&(l_session->elements), (void**)&l_list_element, &l_elId, sizeof(PLANNER_LIST_ELEMENT_T))
	            l_bookmark->iterator_handle = handle;
    	        *item_handle  = (l_sesId<<16) | l_elId;
			}
		} end PLANNER_Iterator_CreateElementAtIndex
		
		# this is WHERE element is created.
		#
		l_iter->position++;
		
		PLANNER_Iterator_RebuildCache
		
		PLANNER_Iterator_SaveElementAtPosition(handle);		
		{
			PLANNER_Iterator_GetVListIfAvailable(handle, l_iter->cache_version, l_iter->position, &l_vlist, 0U);
			{			
				/* If there is a vlist that contains element from this index */
				VTABLE_FindElement(&(l_iter->vlists), PLANNER_Iterator_FindVListForIndex, (void*)(&l_index), (void**)&l_vlist, &l_vlistHandle);
				
				#	static bool PLANNER_Iterator_FindVListForIndex(void *element, void *data)
				#	{
				#	    uint32_t* l_index = (uint32_t*)data;
				#	    bool l_status = false;
				#	    PLANNER_ITERATOR_VLIST_T* l_iter = (PLANNER_ITERATOR_VLIST_T*)element;
				#	
				#	    if((l_iter->min <= *l_index) && (*l_index < l_iter->max))
				#	    {
				#	        l_status = true;
				#	    }
				#	    return l_status;
				#	}
			}
		}
	}


#
# to delete booked prog handle
#
class PlannerBookedProgrammeImpl
    protected void natDelete() 
    {
        natPlannerApiBookedProgrammeDelete(nativeHandle);   
    }

PLANNER_JAVA_ApiBookedProgrammeDelete
	# get sid and delete booked handle from a element vtable of a session.
	SYSTEM_STATUS 'PLANNER_API_BookedProgramme_DeleteHandle'( PLANNER_API_BookedProgramme_Handle handle )
	# lead to PLANNER_Element_Delete that deletes vlist
		'PLANNER_Element_Delete'


<booking-prop-id>
PLANNER_JAVA_ApiBookedProgrammeGetBookingType
	PLANNER_API_BookedProgramme_GetPropertyBookingType
	{
		# SYSTEM_STATUS PLANNER_BookedProgramme_GetInternalDataAndValidatePropID( 
		# const PLANNER_API_BookedProgramme_Handle handle,			# in
		# const PLANNER_API_BookedProgramme_PropId prop_id,			# out 
		# PLANNER_BOOKEDPROGRAMME_T **el,							# out 
		# PCAT_VIEW_VALUE_LIST *vl,									# out 
		# uint32_t *vl_index, 										# out 
		# PLANNER_API_BookingSubclass *booking_subclass)
		#
		# get value list index for this prop from the booked prog handle. from its internal booking structure
		PLANNER_BookedProgramme_GetInternalDataAndValidatePropID(handle, id, &l_el, &l_VL, &l_id, &l_booking_subclass)))

		# get value from pcat using value list and pos. it come from pcat client but not the server.
		#
		PLANNER_BookedProgramme_GetBookingType(l_el, l_VL, l_id, value)
			PCAT_VIEW_VLIST_GetInt(value_list, position, PCAT_CAT_PROP_BOOKING_TYPE, &l_pcat_booking_type)

	}


// DARWIN_PLATFORM/DARWIN_PLANNER/inc/planner_bookedprogramme.h
typedef enum PLANNER_API_BookedProgramme_PropIdTag
{
    /** @brief (Get) Is the BookedProgramme booked for a series link
      *
      * Not supported for subclasses with any of the following characteristics:
      * - SOURCE = SUB_EVENT
      * - SOURCE = CONFLICT_SUBJECT
      */
    PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISSERIESLINKED = 34U,

    /** @brief (Get) Can the BookedProgramme be booked for a series link
      *
      * Supported for all subclasses
      */
    PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISSERIESAVAILABLE = 35U,

    /**
     * @brief (Get) The type of link that exists on a booking, for example a series or show link.
     *              See #PLANNER_API_LinkGroupType for the possible link types.
     *              Use PLANNER_API_BookedProgramme_GetPropertyUint32.
     *
     * Not supported for subclasses with any of the following characteristics:
     * - SOURCE = SUB_EVENT
     * - SOURCE = CONFLICT_SUBJECT
     */
    PLANNER_API_BOOKEDPROG_PROPID_UINT32_SERIES_LINK_GROUP = 161U,

    /**
     * @brief (Get) The types of link available to be made on a booking, for example series and show links.
     *              See #PLANNER_API_LinkGroupType for the possible link types.
     *              Use PLANNER_API_BookedProgramme_GetPropertyUint32.
     *
     * Supported for all subclasses
     */
    PLANNER_API_BOOKEDPROG_PROPID_UINT32_SERIES_LINK_GROUP_AVAILABLE = 162U,

    /** @brief (Get) The series information string
     *
     * @See PLANNER_API_BookedProgramme_GetPropertyString
     *
     * Supported for all subclasses
     */
    PLANNER_API_BOOKEDPROG_PROPID_STRING_SERIES_INFO = 214U,
} PLANNER_API_BookedProgramme_PropId;


# return locator of programme	
PLANNER_JAVA_ApiBookedProgrammeGetBookedProgramme
	status = PLANNER_API_BookedProgramme_GetPropertyLocator(
	            (PLANNER_API_BookedProgramme_Handle)jHandle,
	            (PLANNER_API_BookedProgramme_PropId)jPropertyID,
	            &locatorHandle);


PLANNER_DBINTERFACE_RegisterListeners
	PCAT_VIEW_LISTENER_RegisterUpdateInView(PLANNER_ViewChangeNotification)

PLANNER_ViewChangeNotification
	EV PLANNER_EV_VIEW_CHANGE_NOTIFICATION, PLANNER_UPDATE_LISTENER_TYPE_CHANGE

PLANNER_DBINTERFACE_Notify_ViewChange
	PLANNER_GridJobs_NotifyChanges

#-----------------------------------------------------------
# prop id
#-----------------------------------------------------------
abstract class PlannerBookedProgrammeImpl extends SystemCommonObjectImpl implements PlannerBookedProgramme
{
    /* Values used in multiple impl classes */
    public interface PropertyID
    {
	    static final int INT_DURATION = 1;              /* The 'duration' attribute of the Booked Programme, in seconds */
		...
		BOOL_ISPURCHASECANCELREQ = 31; /*If PPV, does the purchase need to be cancelled for a deletion */

        static final int INT_PDLSTATUS           = 63;   /* The PDL status. */
	}
}

# PLANNER_MapPropertyToPCAT: planner prop id -> pcat prop id
#
# see PlannerBookedProgrammeListChangeListener.java
#
PLANNER_API_BOOKEDPROG_PROPID_BOOL_KEEPFLAG		      (7)       PCAT_CAT_PROP_KEEP_STATUS
PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISCAVIEWED		  (11)
PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISPURCHASECANCELREQ (31)
PLANNER_API_BOOKEDPROG_PROPID_BOOL_BOOKEDASOPPV       (55)
PLANNER_API_BOOKEDPROG_PROPID_UINT32_PDLSTATUS        (63)
PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISRADIO            (65)
PLANNER_API_BOOKEDPROG_PROPID_SYSTEM_TIME_STARTTIMEi  (13)		PCAT_CAT_PROP_START_TIME
PLANNER_API_BOOKEDPROG_PROPID_UINT32_LAST_VIEWED 				PCAT_CAT_PROP_LAST_PLAYBACK_POSITION;
PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISPLAYING			(136)

#
getPropertyStartTime
	natPlannerApiBookedProgrammeGetSystemTime(nativeHandle, PropertyID.SYSTEMTIME_STARTTIME, startTime);
	PLANNER_JAVA_ApiBookedProgrammeGetSystemTime

getPropertyTitle
	natPlannerApiBookedProgrammeGetString(nativeHandle, PropertyID.STRING_TITLE);
	PLANNER_JAVA_ApiBookedProgrammeGetString


#-----------------------------------------------------------
# status
#-----------------------------------------------------------
#define PLANNER_COMP_ID       (25)
#define SEVERITY_SEVERE       (0x2)
#define PLANNER_API_ID        (2)
            

(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((25 & 0x3FF) << 22) | ((0x2 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )
hex(((25 & 0x3FF) << 22) | ((0x2 & 0x3) << 16) | ((2 & 0xF) << 12) | (1 & 0xFFF) )
hex(((25 & 0x3FF) << 22) | ((0x2 & 0x3) << 16) | ((2 & 0xF) << 12) | (33 & 0xFFF) )

PLANNER_API_STATUS_OK						0x6402000 # '0x6420000'
PLANNER_API_STATUS_NOT_OK					'0x6422001'
PLANNER_API_STATUS_PARAMETER_VALUE_NOT_SET	'0x6422021'
PLANNER_API_STATUS_BAD_LOCATOR				'0x6422008'
PLANNER_API_STATUS_UNABLE_TO_GET_PARAMETER  '0x6422002'
PLANNER_API_STATUS_CONFLICT                 '0x642200c'

# logs when deleting recodring from planner happens: 
# these all come from 'PLANNER_JAVA_ApiBookedProgrammeSetBoolean' but not sure if it's real failure or not since these comes 
# when deleting recording is okay or not. 
> KEY_PRESS: YELLOW
+--{53522:E:P_Planner:M:planner_list_element.c:F:PLANNER_ListElement_GetBookingJobID:Call to PCAT_VIEW_VLIST_GetID failed}                              
+--{53523:E:P_Planner:M:planner_dbinterface.c:F:PLANNER_DBINTERFACE_ResetIncoherentBooking:Call to PLANNER_ListElement_GetBookingJobID failed}
+--{53524:E:P_Planner:M:planner_dbinterface.c:F:PLANNER_IterateSessionsToResetIncoherentBookings:Error iterating through calls to PLANNER_DBINTERFACE_ResetIncoherentBooking}
+--{53525:E:P_Planner:M:planner_dbinterface.c:F:PLANNER_DBINTERFACE_ResetIncoherentBookedProgrammes:Error iterating through calls to PLANNER_IterateSessionsToResetIncoherentBookings}
NDS: ^0946724818.427254 !ERROR -J_PLANNER    < M:natPlannerBookedProgrammeImpl.c F:PLANNER_JAVA_ApiBookedProgrammeSetBoolean L:00646 > PLANNER_API_BookedProgramme_SetPropertyBoolean(7) failed: 0x6422001

# logs when recording failed from guide:
> KEY_PRESS: RECORD
NDS: ^0946725871.312699 !ERROR -J_GUIDE      < M:natGuideScheduleImpl.c F:GUIDE_JAVA_ScheduleRetrieveSynopsis L:00715 > Retrieval failed

# it seems important mesg even if these are warns.
NDS: ^0946725872.171199 !WARN  -VRMS         < M:booking_record.c F:BookingRecordGetContentShrec L:06439 > Item id: 0x2900041f, is not shared - fail recording
NDS: ^0946725872.304276 !WARN  -PSRM         < M:planner_srm.c F:PLANNER_SRM_ProcessVRSIJobFailed L:02205 > Failed to find handle - not necessarily a fault
NDS: ^0946725872.304403 !WARN  -PSRM         < M:planner_srm.c F:PLANNER_SRM_ProcessVRM L:01754 > Error processing VRSI - not necessarily a fault

# logs when book a reminder
NDS: ^0946685111.764113 !INFO  -P_Planner    < M:planner_addbookedprogramme.c F:PLANNER_AddBookedProgramme_Init L:00401 > Payload status=PLANNER_ST_ADD_BOOKED_PROGRAMME_INIT
NDS: ^0946685111.923559 !INFO  -P_Planner    < M:planner_addbookedprogramme.c F:PLANNER_AddBookedProgramme_Term L:01033 > Payload status=PLANNER_ST_ADD_BOOKED_PROGRAMME_TERM


#-----------------------------------------------------------
# 
#-----------------------------------------------------------
PLANNER_JAVA_IteratorChangeListener

#-----------------------------------------------------------
# java: PLANNER_API_BookedProgramme_RemoveBookedProgramme
#-----------------------------------------------------------

#
public class PlannerSessionImpl extends SystemCommonObjectImpl implements PlannerSession 
{
    public void addScheduledBookedProgramme( Object userTag, SystemLocator systemLocator, int bookingType, int seriesLinkAction, PlannerAddBookedProgrammeListener listener )
        throws PlannerHealthCheckException, PlannerNoSkyAuthorisationException
    {
        natPlannerApiSessionAddScheduledBookedProgramme(
                nativeHandle, userTag,systemLocator, bookingType, seriesLinkAction, listener, new PlannerScheduledBookedProgrammeImpl()); 
    }
}

#
abstract class PlannerBookedProgrammeImpl extends SystemCommonObjectImpl implements PlannerBookedProgramme
{
    public void removeBookedProgramme( Object userTag, PlannerRemoveBookedProgrammeListener listener )
    {
        assertValid();
        natPlannerApiBookedProgrammeRemove(nativeHandle, userTag, listener);
    }
}

#
const JNINativeMethod com_nds_fusion_plannerimpl_PlannerSessionImpl[]   =
{
    { (char*)"natPlannerApiSessionAddScheduledBookedProgramme", ,
      (void*)Java_com_nds_fusion_plannerimpl_PlannerSessionImpl_natPlannerApiSessionAddScheduledBookedProgramme },
}

#
JNIEXPORT void JNICALL Java_com_nds_fusion_plannerimpl_PlannerSessionImpl_natPlannerApiSessionAddScheduledBookedProgramme
  (JNIEnv *THIS, jclass jClass, jint param1, jobject param2, jobject param3, jint param4, jint param5, jobject param6, jobject param7)
{
     NDSJNI_ENV env;

    env.THIS = THIS;
    env.jClass = &jClass;
    env.params[0] = (void*)&param1; /* Session handle */
    env.params[1] = (void*)&param2; /* User tag */
    env.params[2] = (void*)&param3; /* Prog Inst locator */
    env.params[3] = (void*)&param4; /* Booking Type */
    env.params[4] = (void*)&param5; /* Series link action */
    env.params[5] = (void*)&param6; /* Add booked programme listener */
    env.params[6] = (void*)&param7; /* Booked programme */

    PLANNER_JAVA_ApiSessionAddScheduledBookedProgramme(&env);
}

# natPlannerApiBookedProgrammeRemove. under /src_sun/
JNIEXPORT void JNICALL Java_com_nds_fusion_plannerimpl_PlannerBookedProgrammeImpl_natPlannerApiBookedProgrammeRemove
  (JNIEnv *THIS, jclass jClass, jint param1, jobject param2, jobject param3)
{
    NDSJNI_ENV env;

    env.THIS = THIS;
    env.jClass = &jClass;
    env.params[0] = (void*)&param1; /* Session handle */
    env.params[1] = (void*)&param2; /* User tag */
    env.params[2] = (void*)&param3; /* Remove booked programme listener */
    PLANNER_JAVA_ApiBookedProgrammeRemove(&env);
}

#
void PLANNER_JAVA_ApiBookedProgrammeRemove(NDSJNI_ENV *l_env)
{
	/* Remove the booked programme using the C component */
	l_status =  PLANNER_API_BookedProgramme_RemoveBookedProgramme(
	                    (PLANNER_API_BookedProgramme_Handle)jHandle,
	                    (PLANNER_API_UserTag)vtable_handle,
	                     PLANNER_JAVA_RemoveBookedProgrammeListener);
}

#
SYSTEM_STATUS PLANNER_API_BookedProgramme_RemoveBookedProgramme(
    PLANNER_API_BookedProgramme_Handle handle, PLANNER_API_UserTag user_tag,
    PLANNER_API_BookedProgramme_RemoveBookedProgrammeCb callback )
{
	if(PLANNER_API_STATUS_OK!=PLANNER_PRV_BookedProgramme_RemoveBookedProgramme(handle,
	        l_el,true, user_tag, callback))

}


#-----------------------------------------------------------
# moveToPdlQueueHead
#-----------------------------------------------------------
PlannerPdlBookedProgrammeImpl.java
	public void moveToPdlQueueHead(PlannerBookedProgrammePdlQueueControlListener listener, Object userTag)
	{
		assertValid();
		PlannerBookedProgrammeImpl.natMoveToPdlQueueHead(nativeHandle, listener, userTag);
	}

PLANNER_JAVA_ApiBookedProgrammeMoveToPdlQueueHead
	PLANNER_API_BookedProgramme_PDLQueueControl(PLANNER_JAVA_PDLQueueControlListener)


#-----------------------------------------------------------
# PR#21100: about status of PDL items. 28/03/2011. On 890. See PR rather than WP490.
# - Planner issue which has errors in managing internal item status and as a result, returns wrong status.
#-----------------------------------------------------------
To summary, there is no way to distinguish two cases of status in PDL items:

1) when cancel the download, it's a part(partially downloaded) but not in a queue.
2) when change its priority by moving down in the list, it's a part and in a queue.

Currently MW supports only 'PARTIAL' status and decided to introduce more status in MW to cover these.

# this is current definition
public interface PlannerPdlBookedProgramme extends PlannerBookedProgramme
{
	public interface PdlStatus
	{
		/** The PDL asset is scheduled for download. */
		public static final int	SCHEDULED	= 1;
		/** The PDL asset is partially downloaded. */
		public static final int	PARTIAL		= 2;
		/** The PDL asset is completely downloaded. */
		public static final int	COMPLETE	= 3;
		/** The PDL asset has failed to download. */
		public static final int	FAILED		= 4;
		/**< The PDL asset is currently downloading. */
		public static final int	DOWNLOADING	= 5;
		/** The PDL asset download failed because of timeout. */
		public static final int	TIMEOUT		= 6;
		/**< The PDL asset is in the process of being deleted. If the PDL status is this, no other properties shoudl be retrieved*/
		public static final int	DELETING	= 7;
	}

# this is new definition.
public interface PlannerPdlBookedProgramme extends PlannerBookedProgramme
{
 public interface PdlStatus
 {
  /** The PDL asset is scheduled for download. */
  public static final int SCHEDULED = 1;  
  /** The PDL asset is partially downloaded. */
  public static final int PARTIAL = 2;
  /** The PDL asset is partially downloaded, and still scheduled, or starting. */
# this is new one
  public static final int PARTIAL_SCHEDULED = 3;
  /** The PDL asset is completely downloaded. */
  public static final int COMPLETE = 4; 
  /** The PDL asset has failed to download. */
  public static final int FAILED = 5; 
  /**< The PDL asset is currently downloading. */
  public static final int DOWNLOADING = 6;    
  /** The PDL asset download failed because of timeout. */
  public static final int TIMEOUT = 7;
  /**< The PDL asset is in the process of being deleted. If the PDL status is this, no other properties shoudl be retrieved*/
  public static final int DELETING = 8;
 }

this is defined in 'planner_types.h':

typedef enum PLANNER_API_PDL_StatusTag
{
    PLANNER_API_PDL_STATUS_UNDEF = 0,
    PLANNER_API_PDL_STATUS_SCHEDULED,          /**< The PDL asset is scheduled for download. */
    PLANNER_API_PDL_STATUS_PARTIAL,            /**< The PDL asset is partially downloaded and the download has ended. */
    PLANNER_API_PDL_STATUS_PARTIAL_SCHEDULED,  /**< The PDL asset is partially downloaded but the asset is still scheduled for download. */
    PLANNER_API_PDL_STATUS_COMPLETE,           /**< The PDL asset is completely downloaded. */
    PLANNER_API_PDL_STATUS_FAILED,             /**< The PDL asset has failed to download. */
    PLANNER_API_PDL_STATUS_DOWNLOADING,        /**< The PDL asset is currently downloading. */
    PLANNER_API_PDL_STATUS_TIMEOUT,            /**< The PDL asset download failed because of timeout. */
    PLANNER_API_PDL_STATUS_DELETING,           /**< The PDL asset is in the process of being deleted. If the PDL status is this, no other properties shoudl be retrieved. */
    PLANNER_API_PDL_STATUS_LASTVALUE

} PLANNER_API_PDL_Status;

So you should able to see 'partial scheduled' when move a item to the top and if you see 'part' then it's a problem.

#-----------------------------------------------------------
# to enable PDL at SKY, need to chage 'atg' and 'oigc' cfgs
#-----------------------------------------------------------
# atg.cfg
cas_id=2401
catalog_id=4
default_string="NOT APPLICABLE"

# oigc.cfg
DOMAIN_NAME="oig.sky.com"

#-----------------------------------------------------------
# getPropertyIsPurchaseCancelRequest: natPlannerApiBookedProgrammeGetBoolean: PLANNER_JAVA_ApiBookedProgrammeGetBoolean
#-----------------------------------------------------------
natPlannerApiBookedProgrammeGetBoolean(nativeHandle, PropertyID.BOOL_ISPURCHASECANCELREQ);

static final int BOOL_ISPURCHASECANCELREQ = 31; /*If PPV, does the purchase need to be cancelled for a deletion */

PLANNER_API_BOOKEDPROG_PROPID_BOOL_ISPURCHASECANCELREQ

PLANNER_JAVA_ApiBookedProgrammeGetBoolean
	PLANNER_API_BookedProgramme_GetPropertyBoolean
		PLANNER_BookedProgramme_IsPurchaseCancelReq


#-----------------------------------------------------------
# PR#25220: 
# WP579 - Toggle Reminder/Recording Booking:Convert booking status in Planner from recording to reminder (without deleting in-between)
#-----------------------------------------------------------

# for app log
EPG_LIST and EPG_BOOK 

# used on GUIDE and PLANNER logs
egrep -an "(KEY_PRESS:|GuideScheduleCacheAllRowsBookingProperties|KT|NISHAD|GuideScheduleGetBookingPropsFromPlanner|PLANNER_API_Session_GetProgInstBookingFlags)"

setBookingType: natChangeBookingType: PLANNER_JAVA_ApiBookedProgrammeChangeBookingType: PLANNER_API_BookedProgramme_ChangeBookingType

public interface PlannerListStatus
{
	public static final int	FAILED			= 1;
	public static final int	LIST_AVAILABLE	= 2;
	public static final int	LIST_DELETION	= 3;
	public static final int	LIST_INSERTION	= 4;
	public static final int	LIST_CHANGED	= 5;
}

946685111289: threadtracker: [EPG_LIST:INFO]: ChangeListener.notifySuccess: Planner Planner - change notification:(5)

PLANNER_JAVA_IteratorChangeListener
l_change_status:
PLANNER_API_LIST_STATUS_INSERTION(4)
PLANNER_API_LIST_STATUS_CHANGED(5)

# route 01: use mesg passing
#
GUIDE_API_Session_RetrieveProgrammeInstanceIteratorEx
	GuidePlannerBookingPropertiesUpdateListener
		MesgThread	
			GuidePlannerBookingPropertiesUpdateHandler

GuideScheduleUpdateBookingProps
	GUIDE_Int_PLANNER_API_Session_RetrieveProgInstBookingPropsInTimeWindow( GuideScheduleBookingPropertiesUpdateListener )
	("PLANNER_API_Session_RetrieveProgInstBookingPropsInTimeWindow")
		PLANNER_GridJobs_RetrieveProgInstBookingPropsInTimeWindow
			PLANNER_PostMessage(PLANNER_EV_BOOKING_STATUS_HANDLER)
				PLANNER_BookingStatusHandler
					PlannerThread: call registered callback
			
GuideScheduleBookingPropertiesUpdateListener
SEND:GUIDE_EVENT_SCHEDULE_BOOKING_FLAGS_UPDATED	
				
MesgThread:GUIDE_EVENT_SCHEDULE_BOOKING_FLAGS_UPDATED			
	GuideScheduleBookingPropertiesUpdateHandler
		GuideScheduleCacheAllRowsBookingProperties
		{
			GuideScheduleGetBookingPropsFromPlanner
			{
				GUIDE_Int_PLANNER_API_Session_GetProgTimebasedBookingFlags(&booking_status_flags)
				(PLANNER_API_Session_GetProgTimebasedBookingFlags)
					PLANNER_GridJobs_GetProgTimebasedBookingFlags
						"Feature not supported." PLANNER_API_STATUS_FEATURE_NOT_SUPPORTED
						
				GUIDE_Int_PLANNER_API_Session_GetProgInstBookingFlags(&booking_status_flags)
				(PLANNER_API_Session_GetProgInstBookingFlags)
					PLANNER_GridJobs_GetProgInstBookingFlags
					
				DIAG_LOG_INFO(g_guide_diag_segment_id, ("Row %i booking flags have NOT changed", row_data->row_index));
				*props_changed = false;
			}
			
			if (props_changed == true)
			GUIDE_CALLBACK_SCHEDULE_PROGRAMME_INSTANCE_LIST_CHANGED
		}
		
# route 02: use signal condition
#
GUIDE_JAVA_ProgrammeInstanceGetBookingFlags
GUIDE_JAVA_ProgrammeInstanceGetBookingState
	GUIDE_API_ProgrammeInstance_GetBookingProperties
		GUIDE_Int_PLANNER_API_Session_RetrieveProgInstBookingPropsInTimeWindow(GuideProgrammeInstanceBookingPropsListener)
		("PLANNER_API_Session_RetrieveProgInstBookingPropsInTimeWindow")

		GuideProgrammeInstanceBookingPropsListener (when called, signal condition)

		GUIDE_Int_PLANNER_API_Session_GetProgTimebasedBookingFlags
		GUIDE_Int_PLANNER_API_Session_GetProgInstBookingFlags	

		# PLANNER_API_PROGINSTBOOKINGFLAGS_REMINDER (0x01)
		# PLANNER_API_PROGINSTBOOKINGFLAGS_RECORDING (0x02)
		M:guide_api_programmeinstance.c F:GUIDE_API_ProgrammeInstance_GetBookingProperties L:01911 > PLANNER_API_Session_GetProgInstBookingFlags = 0x2

# when press 'red' key, get booking props first and callback from DG with change event


{si-pvr-state}
SYSTEM_STATUS PLANNER_GridJobs_RetrieveProgInstBookingPropsInTimeWindow(PLANNER_API_Session_Handle session)
{
  if(false == PLANNER_IsAnyOperationAllowed(PLANNER_API_SESSION_STATUS_REMINDERS_READY | PLANNER_API_SESSION_STATUS_PVR_READY))
  {
    l_status = PLANNER_API_STATUS_PVR_NOT_READY;
    DIAG_LOG_ERROR( g_planner_diag_segment_id, ("Neither reminder nor recording functionality is ready yet."));
  }
}


#-----------------------------------------------------------
# REMINDER
#-----------------------------------------------------------
# important milestones
#
NDS: ^0946685125.559123 !MIL   -PCATS        < M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:02814 > client id = 0x4,bookingJobID = 0x29000016
NDS: ^0946685125.773869 !MIL   -VRMS         < M:job_man_srv.c F:JobManSrvStart L:03843 > VRM_JOB_START: jtVRM=8, jhVRM=0x2000003

# register listener
#
PLANNER_JAVA_ApiSessionRegisterProgrammeReminderListener
	PLANNER_API_Session_RegisterProgrammeReminderListener( , , PLANNER_API_Session_ProgrammeReminderCb PLANNER_JAVA_ReminderListener, ) 

# booking
#
PLANNER_JAVA_ApiSessionAddScheduledBookedProgramme( PLANNER_API_BOOKING_TYPE_REMIND(2), PLANNER_JAVA_AddBookedProgrammeListener )
	PLANNER_API_Session_AddBookedProgrammeParam
		PLANNER_BookingParam_AddBookedProgramme
			PLANNER_EV_ADD_BOOKED_PROGRAMME

# We're trying to use the PlannerSession.checkForBookingConflict() API to determine if a reminder can be successfully converted 
# to a recording without conflict.
#
# #define SYSTEMLOCATOR_TYPE_CATALOGUE_ITEM       17U
# F:PLANNER_API_Session_CheckForBookingConflict L:02918 > KT: param_booking_type= 1, l_locator_type= 17
#
PLANNER_JAVA_ApiSessionCheckForBookingConflict
	PLANNER_API_Session_CheckForBookingConflict
	
	
# PLANNER adds a new item to this queue each time it receives notification from VRM that a reminder job has started
#
PLANNER_SBM_REMINDER_Listener
	post PLANNER_EV_SRM_EVENT

# PLANNER_EV_SRM_EVENT
PLANNER_ProcessSRMEvent

	case SBM_USERBOOKING_JOB_STATE_REMINDER_STARTED	
	
		PLANNER_AddReminderToQueue(l_ids);
		# this is current time and will set 'l_data.timestamp' with this value
		#	!INFO  -P_Planner    < M:planner_reminders.c F:PLANNER_AddReminderToQueue L:00542 > New reminder timestamp: [2011:07:20 09:38:59]1311154739.

		PLANNER_TriggerReminderNotification(); 
			post PLANNER_EV_REMINDER_TRIGGER_NTFY

# PLANNER_EV_REMINDER_TRIGGER_NTFY
PLANNER_ProcessNextReminder
	/* check if event has finished so we don't send a reminder for a missed event */
	PLANNER_IsBookedEventNotInThePast
	
	# get event duration from pcat
	PLANNER_GetBookedEventDuration
	
	# set timer for 10mins from the reminder timestamp	
	PLANNER_ConstructTimer
	# REMINDER_TIMEOUT=600 (10mins) from planner.cfg
	# set 600s or event duration if it's less than 600s to a timer
	# !INFO  -P_Planner    < M:planner_reminders.c F:PLANNER_ConstructTimer L:00249 > Setting a timeout of time of [2011:07:20 09:48:59]1311155339 (offset 600)
	
	if(l_timer_status == PLANNER_API_STATUS_PAST_EVENT)
		PLANNER_LinkedList_RemoveFirst
	
	PLANNER_ProcessReminderNotification
		l_callback_payload.data.reminder.action = PLANNER_API_REMINDER_ACTION_NEW;
		PLANNER_Callback_PostWithSession(PLANNER_EV_CB_REMINDER)
		# !INFO  -P_Planner    < M:planner_reminders.c F:PLANNER_ProcessNextReminder L:00488 > Notification sent for reminder 687865873.
	
PLANNER_ExecuteUserCallback
	case PLANNER_EV_CB_REMINDER(9)
	# !INFO  -P_Planner    < M:planner_callback.c F:PLANNER_ExecuteUserCallback L:00209 > Executing the callback of type 9.

PLANNER_JAVA_ReminderListener
	# PLANNER_API_BOOKING_TYPE_REMIND(2), PLANNER_API_REMINDER_ACTION_NEW(1)
	# < M:natPlannerCommon.c F:PLANNER_JAVA_ReminderListener L:02384 > KT: booking type= 2, l_reminder_action= 1

PLANNER_JAVA_ApiSessionAcknowledgeReminder
	PLANNER_API_Session_AcknowledgeReminder


#-----------------------------------------------------------
# REMINDER: PR#26003- Reminder dialog is displayed for events far in future
# when booking a reminder to future event, reminder banner displayed immediately.
#-----------------------------------------------------------

what went wrong? trigger time(PCAT_CAT_PROP_TRIGGER_TIME) in pcat.db is in the past. 
The root case seems a PREFS which reads trigger time from configs.

SrmJobRegisterScheduler (see comp-PCAT)

#
# case 01
#
# F:PSCHED_SCHED_HandleNextEvent L:00385 > KT: Top event for job id 0x80006: prop= 5, booking id 0x29000015, 
# sched=1311539400, start=1311599400
#
# 1311599400 - 1311539400 = 60000
#


# case 02
#
# F:PSCHED_SCHED_HandleNextEvent L:00385 > KT: Top event for job id 0x80006: prop= 5, booking id 0x29000007, 
# sched=[2011:07:21 23:20:00]1311290400, start=[2011:07:22 16:00:00]1311350400
#
# 1311350400 - 1311290400 = 60000
#

#
# M:prefs_api_user_profile.c F:PREFS_API_USER_PROFILE_GetProp L:01115 > KT: property 7 in module 1
# M:prefs_nvram.c F:PREFS_CacheGetProperty L:06994 > KT: property->cache_value(60000)
# M:prefs_api_session.c F:PREFS_Session_GetValue L:02529 > KT: cache *value(60000)
# M:prefs_api_user_profile.c F:PREFS_API_USER_PROFILE_GetProp L:00108 > KT: prop(7), element->uint32_value(60000)
# M:planner_prefs.c F:PLANNER_PREFS_GetUserSettings L:00230 > KT: prop(7), user_settings->time_before_reminder(60000)
#
PLANNER_PREFS_GetUserSettings
{
	l_prefs_status |= PREFS_API_Record_GetPropUint32 (
	    f_planner_prefs_record_handle, PREFS_API_RECORD_PROPID_UINT32_REMINDER_TIME,
	    &user_settings->time_before_reminder);
        
	/* Convert to milliseconds from secconds */
	user_settings->time_before_reminder *= (uint32_t)1000;
}


# from PCAT_VIEW_SRV_InsertBookingJob
DbviewStoreFieldToComputeTriggerTime
{
	#
	# F:DbviewStoreFieldToComputeTriggerTime L:08798 > KT: PCAT_CAT_BOOKING_TYPE_REMINDER: time_in_seconds(60000000)
	#
	if (ComputeTriggerTimeOnInsertion->booking_type == PCAT_CAT_BOOKING_TYPE_REMINDER){
		time_in_seconds = SetupField.time_before_reminder;
		
		DIAG_LOG_ERROR(PCAT_diag_segment_id, ("KT: PCAT_CAT_BOOKING_TYPE_REMINDER: time_in_seconds(%d)",time_in_seconds ));								
	}
	
	#
	# F:DbviewStoreFieldToComputeTriggerTime L:08813 > KT: E PCAT_CAT_BOOKING_TYPE_BDL: ComputeTriggerTimeOnInsertion->start_time(1311686100), time_in_seconds(60000000), ComputeTriggerTimeOnInsertion->TriggerTime(1311626100)	
	#
	# This trigger time saved in PCAT
	#
	ComputeTriggerTimeOnInsertion->TriggerTime = ComputeTriggerTimeOnInsertion->start_time - (time_in_seconds /1000U);
	
	DIAG_LOG_ERROR(PCAT_diag_segment_id, ("KT: E PCAT_CAT_BOOKING_TYPE_BDL: ComputeTriggerTimeOnInsertion->start_time(%d), time_in_seconds(%d), ComputeTriggerTimeOnInsertion->TriggerTime(%d)"
		,ComputeTriggerTimeOnInsertion->start_time, time_in_seconds, ComputeTriggerTimeOnInsertion->TriggerTime ));
}


#-----------------------------------------------------------
# manual book
#-----------------------------------------------------------
BSKYB manual bookings do not have a title.


#-----------------------------------------------------------
# #25668: Affirm when entering showcase due to plannerBookedProgramme.getPropertyTitle() returning null
# PVOD
#-----------------------------------------------------------
Yes, SBM can book a PVOD event without a title. SBM doesnt populate the PVOD event title in PCAT. This is left to SRM.
so it could be an SRM bug.  I doubt Sky would ever broadcast PVOD without a title.

EIProcessing_GetAndSetProgInstanceItemProperties (in SRM)
If you are after the updating of PCAT_CAT_PROP_ITEM_NAME, then yes the EIProcessing_GetAndSetProgInstanceItemProperties() 
is the correct place to add debug.


#-----------------------------------------------------------
# PDL booking (via anytime->movie)
#-----------------------------------------------------------
PLANNER_API_Session_AddBookedProgrammeParam

PLANNER_BookingParam_AddBookedProgramme

PLANNER_BookingParam_SetAddBookedProgrammeDefaults

PLANNER_BookingParam_SetAddBookedProgrammePDL(*)
{
	/* Set the booking type */
	
	payload->data.add_booked_programme_struct.pcat_booking_type = PCAT_CAT_BOOKING_TYPE_PDL;
	
	payload->data.add_booked_programme_struct.type = 
	    (uint32_t)((uint32_t)PLANNER_ADD_BOOKED_PROGRAMME_PDL|(uint32_t)PLANNER_ADD_BOOKED_PROGRAMME_RECORDING);
	
	/* Set the booking base type */
	
	payload->data.add_booked_programme_struct.booking_base_type = PCAT_CAT_BASE_TYPE_DOWNLOAD_ITEM;
	
	if (param_type == SBM_USERBOOKING_PARAM_TYPE_PDL_TRAILER)
	{
	    payload->data.add_booked_programme_struct.is_pdl_trailer = true;
	}
	else
	{
	    payload->data.add_booked_programme_struct.is_pdl_trailer = false;
	}
}

PLANNER_AddBookedProgramme_Handler

PLANNER_AddBookedProgramme_Init
{
    else if (l_payload->data.add_booked_programme_struct.booking_base_type == PCAT_CAT_BASE_TYPE_DOWNLOAD_ITEM)
    {
        l_nextState = (uint32_t)PLANNER_ST_ADD_BOOKED_PROGRAMME_PDL_GET_ATG_ASSET_INFO;
    }
}

PLANNER_AddBookedProgramme_Handler

PLANNER_PDL_AddBookedProgramme_GetATGAssetInfo

PLANNER_PDL_AddBookedProgramme_ATGAssetInfoListener

PLANNER_AddBookedProgramme_Handler

PLANNER_PDL_AddBookedProgramme_GetATGAssetInfoProps

PLANNER_PDL_AddBookedProgramme_GetATGPurchasePackets

SBM_SERVER_SIM_PVOD_ProgInstance_Monitor_AddToQueue

PLANNER_PDL_AddBookedProgramme_ATGPurchasePacketsListener

PLANNER_PDL_AddBookedProgramme_GetATGAssetDeliveryInfo

PLANNER_PDL_AddBookedProgramme_ATGAssetDeliveryInfoListener

PLANNER_PDL_AddBookedProgramme_SetPDLEventProps(*)
{
	set various PCAT props
}

SBM_COMMON_ExtractPVOD_GroupID_FromURI

PLANNER_AddBookedProgramme_SBM_AddBooking

SBM_SERVER_USERBOOKING_HandleExternalMessage

SBM_SERVER_USERBOOKING_AddBooking

SBM_USERBOOKING_BookingParam_AddBookedProgramme

SBM_USERBOOKING_VGC_CheckCAAuthorisation

SBM_USERBOOKING_BookingParam_CheckBookingConditions

SBM_USERBOOKING_BookingParam_SetAddBookedProgrammeDefaults

SBM_USERBOOKING_BookingParam_SetAddBookedProgrammePDL

SBM_USERBOOKING_AddBooking_Handler

SBM_USERBOOKING_AddBooking_Init(*)
{
	l_payload->data.add_booking_struct.pcat_item_object_type = PCAT_CAT_OBJECT_TYPE_DOWNLOAD_ITEM;
	
	/* Properties set in the value list used for insertion of the sched event */
  sched_event_insert_prop_list[25] = (PCAT_VIEW_PROP)PCAT_CAT_PROP_SERVICE_TYPE;
  
  /* Properties set in the value list used for insertion of  the manual recording "event" */
  time_based_event_insert_prop_list[0] = (PCAT_VIEW_PROP)PCAT_CAT_PROP_SERVICE_LOCATOR;
  
	/* Insert PDL object VList properties */
	pdl_event_insert_prop_list[0] = (PCAT_VIEW_PROP)PCAT_CAT_PROP_EVENT_LOCATOR;
	
	else if(PCAT_CAT_BASE_TYPE_DOWNLOAD_ITEM == l_payload->data.add_booking_struct.booking_base_type)
		event_insert_prop_list = pdl_event_insert_prop_list;
		
	/* Create a new PCAT value list for inserting the event */
	# here event means SI event
	#		
	PCAT_VIEW_VLIST_New(
		l_payload->data.add_booking_struct.pcat_item_object_type, ,
		event_insert_prop_list, 
		/* out */ &l_payload->data.add_booking_struct.vl_event_insert);
	
	/* Create a new PCAT value list for inserting the booking table/object */
	PCAT_VIEW_VLIST_New(
    PCAT_CAT_OBJECT_TYPE_BOOKING, 1U,
    booking_obj_insert_prop_list,
    SBM_USERBOOKING_BOOKING_OBJ_INSERT_PROP_LIST,
    &l_payload->data.add_booking_struct.vl_booking_insert);	
}

SBM_USERBOOKING_PDL_AddBooking_SetPDLPurchasePacketsProps

SBM_USERBOOKING_PDL_AddBooking_SetPDLEventProps(*)
{
	set various PCAT props
}

SBM_USERBOOKING_AddBooking_BookingTransaction

SBM_USERBOOKING_InsertBooking

NDS: !INFO  -SBMS_USERBOOKING < M:sbm_server_ub_common.c F:SBM_USERBOOKING_InsertBooking L:03456 > The booking was inserted successfully

	PCAT_VIEW_SRV_InsertBookingJob
		PCAT_VIEW_InsertBookingJob
			DbviewStoreFieldToComputeTriggerTime

SBM_USERBOOKING_AddBooking_PurchaseRequired


# book a rec from a guide
F:PLANNER_JOB_Start L:00069 > |-> PLANNER_JOB_Start

F:PLANNER_AddBookedProgramme_SBM_AddBooking L:00406 > Payload status=PLANNER_ST_ADD_BOOKED_PROGRAMME_SBM_ADD_BOOKING

# quota
PLANNER_API_Disk_GetDiskQuotaStatus


={============================================================================
|kt_dev_si_0001| comp-planner comp-est

http://hetty.cisco.com/fusionmadesimple/index.php/Buy-To-Own_in_PLANNER%26SBM

BUY-TO-OWN Description[edit]

BTO Buy-to-Own (BTO) or Electronic Sell-Through (EST) is a new service that
will enable BSkyB's customers to purchase digital AND physical copies
(DVD/Blu-ray) of AV content via their STB. Such assets will be customer's
property and can be reacquired even after deletion (provide the customer has
    an active Sky+ subscription).

EST utilises the existing PDL and PPV infrastructure within the STB to allow
users to Buy-To-Own (BTO) content. Buy-to-own assets will be included in the
online catalogue provided by OIG. The STB will indicate whether it has support
for buy-to-own by setting an appropriate EPG info bit in the requests to the
  OIG. Buy-to-own assets will be signalled to the STB using the assigned BTO
    flag. The STB will allow the user to purchase a buy-to-own asset using the
    existing Impulse Pay-Per-View (PPV) mechanisms. Buy-to-own assets must be
    downloaded within the configured PPV rental period in order for permanent
    access rights to be granted. Any purchased buy-to-own asset not downloaded
    within the rental period shall fail to download – users will be directed
    to recover the content via an online process. Successfully purchased and
    downloaded buy-to-own assets will be viewable on the STB even after the
    initial PPV rental period expires. The PPV entitlement is only required at
    download time during the index import when the PECM index is generated.
    This generates type 1 PECMs that require a single entitlement at playback
    time, which is present on all authorised smart cards.

The STB shall maintain a `semi-permanent record` of all buy-to-own purchases.
When the user deletes a downloaded buy-to-own asset, only the AV content will
be deleted. The planner entry and content indexes shall remain on the STB, so
that the user can re-download previously purchased assets by downloading only
the AV content again, i.e. without going through the purchase process again.

A separate online process shall be provided to facilitate the recovery of
buy-to-own assets following:

 1.	A full system reset (format of the HDD)
 2.	A STB replacement
 3.	Re-encryption of the asset at the headend (AV content deleted on STB)
 4.	Failure to download the asset within the PPV rental period


A remote booking EMM shall be sent to the STB via the broadcast channel to
initiate recovery for each requested buy-to-own asset. The recovery download
of the asset shall recreate the planner entry and content indexes, so that the
user can re-download the asset.

The recovery process involves obtaining the PPV entitlement using OPPV so that
it can be used during the index import when the PECM index is generated. A
Broadband CA callback shall be invoked by the STB prior to download to
retrieve an OPPV entitlement. The download will be further gated behind an
FECM check to ensure the STB has retrieved the required entitlement prior to
importing the indexes.

A recovery mechanism shall be used to recover from failure to obtain the
correct entitlement prior to starting the download or to re-download own
assets in case of a `system reset or STB swap.` Download shall end as soon as
the index import is complete, without downloading the AV content.


Implementation notes[edit]
For high level design and in depth functionalit, please refer to the Related
Workpackages section

EST Phase 1[edit]
BTO assets are basically normal PDL assets with special characteristics, or
exceptions such as:

KEEP_STATUS_FLAG: A BTO asset will always have its KEEP_STATUS_FLAG enabled,
  and won't be possible to set to false on that asset. This flag will be
    ignored when using the RemoveBooking interface in SBM, relying on the EPG
    in provide such functionality only to trial users of BSkyB.

IPPV/OPPV: A BTO asset will always have this properties disabled, in spite of
triggering the purchase mechanism (only the first time) as if it was a normal
PPV asset.

RemoveContent API: It is meant to allow an incomplete booking to exist in the
database without occupying any space in this. When the user is willing to
watch the recording again and the asset has expired in the headend, he/she
will have to follow a web recovery process that ultimately will trigger an EMM
to the box that will consequently restore the booking's content. If the asset
has not expired yet but for some reason the user decided to remove its
content, the contents will be redownloaded.


EST Phase 2[edit]
The same rules as in EST Phase 1. This phase was purely focused on UPnP
support for EST assets.

EST Phase 3[edit]
Introduces a new license system which involves the usage of CA and DRM
encryption.

In this phase, the constraint for KEEP_STATUS_FLAG is removed for EST Phase 3
assets which are identified by their purchase origin (they are purchased from
    HEP)

For EST Phase 3 assets, the purchase mechanism is perform from the HEP server
and there can be Box sets


={============================================================================
|kt_dev_si_0001| comp-prefs

CO: Sackx, Frederik

COMPONENT_NAME:=darwin_prefs_srv
NDS_BUILD_TYPE_darwin_prefs_srv = debug
NDS_BUILD_TYPE_darwin_prefs_cli = debug
#define PREFS_C2S_DIAG_NAME "PREFS_C2S"

DIAG_LOG_RegisterTraceSegment

# DO NOT USE 'ENTER' as get too much and no useful infos.
#

NDS: ^0946684906.423417 !ENTER -PREFS
# the below is used on spdif device.
FIXED_SD_ATTENUATION=6 in prefs.cfg


# nvram files
# http://hoover.uk.nds.com/fusionmadesimple/index.php/Nvram
#
#define NVRAM_FILENAME "/nv"                    /*!< @brief Name of file (without path) in which NVRAM settings are stored */
#define FAVS_LIST_ACTIVE_FILENAME "/fv"         /*!< @brief Name of file (without path) in which NVRAM FAVS current active list are stored */
#define LOCKED_FILENAME "/lc"                   /*!< @brief Name of file (without path) in which NVRAM Locked are stored */
#define LOCKED_EXT_FILENAME "/le"               /*!< @brief Name of file (without path) in which NVRAM Locked are stored */
#define MACROVISION_FILENAME "/mc"              /*!< @brief Name of file (without path) in which macrovision settings are stored */
#define SERVICE_LIST_FILENAME "/sl"             /*!< @brief Name of file (without path) in which the service list mapping are stored */


# prefs_nvram.c to see properties
#
f_nvram_properties


<prefs-nvram-txt>
 ~~~ Record Properties
Start Guard Time          = 0x0000 (0) 
End Guard Time            = 0x0000 (0) 
Auto Start Guard Time     = 0x0002 (On) 
Auto End Guard Time       = 0x0002 (On) 
Deletion Mode             = 0x0001 (Automatic) 
Review Buffer Length      = 0x0000 (0) 
Reminder Time             = 0x003C (60) 
Conflict Time             = 0x0000 (0) 
Warn Percent              = 0x005A (90 %) 
Skip Forward              = 0xEA60 (60000 ms) 
Skip Backward             = 0xEA60 (60000 ms) 
Skip Forward mode         = 0x01 (Time) 
Skip Backward mode        = 0x01 (Time) 
ARR functionality         = 0x00 (ERROR Value) 
No of Daily ARR           = 0x00 (00) 
Master Personalization    = 0x02 (Enabled) 


<prefs-state-machine>
DARWIN_PLATFORM/DARWIN_PREFS/src/server/prefs_api_terminal.c

static PREFS_OP_MODE_TRANSITION_T operating_mode_sm[] =


<hdcp-event-player-event>

// PREFS -> EPG
//
// build/applications/Picasso/picasso/Picasso/src/java/picasso/mediaengine/HdcpEventPump.java

	public HdcpEventPump(IExecutor executor, MediaEngine mediaEngine)
	{
		this.executor = executor;
		this.mediaEngine = mediaEngine;
	}

	public void registerWithMiddleware(PrefsSession prefsSession)
	{
		PrefsTerminal prefsTerminal = prefsSession.getTerminal();
		`prefsTerminal.registerHdmiStateListener(this);`
	}

	@Override public void notifyChange(final int hdmiState)
	{
		/* logger.logInfo("HDCP / HDMI status is now: " + hdmiState); */

		executor.runLater(new Runnable()
		{
			@Override public void run()
			{
				mediaEngine.onHdcpEvent(hdmiState);
            
			}
		});
	}

   /** An Active HDMI Sink has been detected, but AV is not being transmitted. */
   /** HDCP authentication has failed and been acknowledged by the user. */
   /** HDCP authentication is not being retried. */
   int HDCP_NOT_AVAILABLE = 5;

   /** Transition message from state STATE_HDCP_NOT_AVAILABLE */
   int HDCP_NOT_AVAILABLE_MESSAGE = 6;

   /** HDCP Error: An Active HDMI Sink has been detected and AV is being transmitted unencrypted.  */
   /** HDCP authentication is being retried once per second, unless a revocation error was received. */
   int HDCP_ERROR = 7;

   /** HDCP Revocation: An Active HDMI Sink has been detected and AV is being transmitted unencrypted. */
   /** HDCP authentication is not being retried. */
   int HDCP_REVOCATION = 8;


   // The EPG shows that dialog on receipt of this event > 
   // PrefsHdmiStateListener.HdmiStates.HDCP_NOT_AVAILABLE
   //
   // On receipt of either of these events >
   // PrefsHdmiStateListener.HdmiStates.HDCP_REVOCATION:
   // PrefsHdmiStateListener.HdmiStates.HDCP_ERROR:
   // the dialog is removed.

	public void onHdcpEvent(int event)
	{
		switch (event)
		{
			case PrefsHdmiStateListener.HdmiStates.HDCP_AUTHENTICATING:
				break;

			case PrefsHdmiStateListener.HdmiStates.HDCP_DISABLED:
			case PrefsHdmiStateListener.HdmiStates.HDCP_ENCRYPTING:
			case PrefsHdmiStateListener.HdmiStates.HDMI_NOT_AVAILABLE:
			case PrefsHdmiStateListener.HdmiStates.HDMI_OFF:
			case PrefsHdmiStateListener.HdmiStates.HDCP_NOT_AVAILABLE:
				announcer.doHDCP(true);
				break;
			case PrefsHdmiStateListener.HdmiStates.HDCP_REVOCATION:
			case PrefsHdmiStateListener.HdmiStates.HDCP_ERROR:
				announcer.doHDCP(false);
				break;
			default:
      }
   }

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/FullScreenController.java
	{
		if (isHdcpOK)
		{
			removeHDCPDialog();
		}
		else
		{
			createHDCPDialog();
		}
	}


// build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/prefsimpl/PrefsTerminalImpl.java
	@Override public void registerHdmiStateListener(PrefsHdmiStateListener hdmiStateListener)
	{
		synchronized (synchronizationObject)
		{
			natPrefsAPITerminalRegisterHdmiStateListener(nativeHandle, hdmiStateListeners.registerNew(hdmiStateListener));
		}
	}

JNIEXPORT void JNICALL Java_com_nds_fusion_prefsimpl_PrefsTerminalImpl_natPrefsAPITerminalRegisterHdmiStateListener
    SYSTEM_STATUS status = PREFS_API_TERMINAL_RegisterHdmiStateListener((PREFS_API_TerminalHandle) native_handle,
            hdmiStateCallback, callback_id);


void PREFS_TERMINAL_callHdmiStateListener(PREFS_API_TerminalHandle terminal_handle,
                                          PREFS_API_TERMINAL_HdmiState state,
                                          bool auto_reply)
{
  for (i=0U; i< PREFS_API_MAX_NUM_HDMI_STATE_LISTENER; i++)
  {
    /* In this case only the listener of the terminal_handle has to be called */
    if (auto_reply == true)
    {
      if (f_PREFS_API_RegisterHdmiStateListeners[i].handle == terminal_handle)
      {
        if (f_PREFS_API_RegisterHdmiStateListeners[i].listener != NULL)
        {
          f_PREFS_API_RegisterHdmiStateListeners[i].listener(state, f_PREFS_API_RegisterHdmiStateListeners[i].user_tag);
        }
        break;
      }
    }
    else
    {
      if (f_PREFS_API_RegisterHdmiStateListeners[i].handle != PREFS_API_REGISTER_LISTENER_ILLEGAL_HANDLE)
      {
        if ( (f_PREFS_API_RegisterHdmiStateListeners[i].listener != NULL) &&
            (f_PREFS_API_RegisterHdmiStateListeners[i].last_notified_hdmi_state != state) )
        {
          f_PREFS_API_RegisterHdmiStateListeners[i].last_notified_hdmi_state = state;
          f_PREFS_API_RegisterHdmiStateListeners[i].listener(state, f_PREFS_API_RegisterHdmiStateListeners[i].user_tag);
        }
      }
    }
  }
}


/**
 @brief Terminal object property hdmi state identifiers
*/
typedef enum prefs_api_terminal_hdmi_state
{
	PREFS_API_TERMINAL_HDMI_STATE_UNDEF                         =0U,
	/* Undefined value. */
	PREFS_API_TERMINAL_HDMI_STATE_HDMI_OFF                      =1U,
	/**<  The HDMI Output Port is Disabled. */
	PREFS_API_TERMINAL_HDMI_STATE_HDMI_NOT_AVAILABLE            =2U,
	/**<  The HDMI Output Port is Enabled. Waiting for an Active HDMI Sink Device to be attached and powered. */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_DISABLED                 =3U,
	/**<  An Active HDMI Sink has been detected and AV is being transmitted unencrypted.
          HDCP may be disabled or authenticating. */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_ENCRYPTING               =4U,
	/**<  An Active HDMI Sink has been detected and AV is being transmitted encrypted using HDCP. */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_NOT_AVAILABLE            =5U,
	/**<  An Active HDMI Sink has been detected, but AV is not being transmitted.
          HDCP authentication has failed and been acknowledged by the user.
          HDCP authentication is not being retried.
          PREFS_API_TERMINAL_PROPID_UINT32_HDCP_NOT_AVAILABLE_TIMER indicates the time to remain in ��HDCP Not Available (Initial)�� state */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_NOT_AVAILABLE_MESSAGE    =6U,
	/**<  Transitionning message state from STATE_HDCP_NOT_AVAILABLE
          If PREFS_API_TERMINAL_PROPID_UINT32_HDCP_NOT_AVAILABLE_TIMER is 0, never transit to ��HDCP Not Available message' */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_ERROR                    =7U,
	/**<  HDCP Error - An Active HDMI Sink has been detected and AV is being transmitted unencrypted.
                       HDCP authentication is being retried once per second, unless a revocation error was received. */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_REVOCATION               =8U,
	/**<  HDCP Revocation - An Active HDMI Sink has been detected and AV is being transmitted unencrypted.
                            HDCP authentication is not being retried. */
	PREFS_API_TERMINAL_HDMI_STATE_HDCP_AUTHENTICATING           =9U,
	/**<  HDCP Authenticating - An Active HDMI Sink has been detected and AV is being transmitted unencrypted.
                                HDCP is authenticating. */
	PREFS_API_TERMINAL_HDMI_STATE_LAST_VALUE                    =10U
	/* Last Value */
} PREFS_API_TERMINAL_HdmiState;


!MIL    -P_Api        		< p:0x0000017e P:APP t:0x0131c520 T:PLAYER_MAIN M:player_common.c F:PLAYER_PrefsHDMIStateListenerHandlerSessionAction L:7057 > Received HDMI State PREFS_API_TERMINAL_HDMI_STATE_HDCP_NOT_AVAILABLE 
!WARN   -P_Api        		< p:0x0000017e P:APP t:0x0131c520 T:PLAYER_MAIN M:player_common.c F:PLAYER_PrefsHDMIStateListenerHandlerSessionAction L:7064 > Context is not supported by HDMI state handler. 
!MIL    -P_Api        		< p:0x0000017e P:APP t:0x0131c520 T:PLAYER_MAIN M:player_common.c F:PLAYER_PrefsHDMIStateListenerHandlerSessionAction L:7057 > Received HDMI State PREFS_API_TERMINAL_HDMI_STATE_HDCP_NOT_AVAILABLE 

// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_common.c

static void *MessageThread(void * param)
{
  PLAYER_PrefsHDMIStateListenerHandler(l_payload_struct->data.prefs.event.hdmi_state, l_payload_struct->data.prefs.g_user_tag)
  {
    (void) PLAYER_Context_AllContextsAction(PLAYER_PrefsHDMIStateListenerHandlerSessionAction, (void*) &l_hdmi_state);
  }
}

static void PLAYER_PrefsHDMIStateListener(PREFS_API_TERMINAL_HdmiState hdmi_state, uint32_t user_tag)

else if (PREFS_API_TERMINAL_RegisterHdmiStateListener(g_player_component.terminal_handle, PLAYER_PrefsHDMIStateListener, g_player_component.prefs_session) != PREFS_API_STATUS_OK)


4993:NDS: ^[2018:02:14 14:07:09]0946685343.063136 !WARN   -BEM          		< p:0x0000017c P:MW t:0x018b7520 T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdmiAndStatus L:2507 > Starting HDCP retry - set alarm 500 ms, hdcp_failed_count 0 
5003:NDS: ^[2018:02:14 14:07:09]0946685343.903056 !MIL    -BEM          		< p:0x0000017c P:MW t:0x018b7520 T:BEM_INTERNAL_EVENT_THREAD M:bem_internal_event.c F:BEM_InternalEvent_CheckHdmiAndStatus L:2389 > Authentication/encryption failed [events: HDMI_EVENT_CP_KSV_INVALID (0x800000), hdcp_status: HDMI_STATUS_NOT_AUTHENTICATED_KSV_INVALID (0x3)] 


={============================================================================
|kt_dev_si_0001| comp-systemobject

Each Component that needs to generate a Media Status or Media Selection object
shall use the SYSTEMOBJECT library to set/get the various properties of that
object. There shall be a separate header file for each system object type,
e.g. systemobject_sci.h, which will be used by any component needing access to
  the properties of the corresponding object.

The SYSTEMOBJECT library will also be used to serialise and de-serialise the
object for the purposes of copying.  This should only be required when
transferring the object across a process boundary, i.e. via IPC.

DeliverySystemInfo (DSI) 
ServiceComponentInfo (SCI)
Transport Stream Information (TSI) : Transport Stream ID, Original Network ID 

$ more systemobject.cfg 
[SYSTEMUTIL_MEMORY_APP_Process]
SYSTEMOBJECT_FLAGS=0
SYSTEMOBJECT_NAME="systemobject"
SYSTEMOBJECT_SIZE=100000
[SYSTEMUTIL_MEMORY_MW_Process]
SYSTEMOBJECT_FLAGS=0
SYSTEMOBJECT_NAME="systemobject"
SYSTEMOBJECT_SIZE=51200

    stat = SYSTEMOBJECT_GetInteger(dplai,
            SYSTEMOBJECT_DPLAI_PROPID_I_TRICK_MODE_CONTROL,
            &trickModeControlType);


={============================================================================
|kt_dev_si_0001| comp-systemutil

#-----------------------------------------------------------
# status
#-----------------------------------------------------------
# SYSTEMUTIL_COMP_ID         	(71)
# SYSTEMUTIL_IF_ID				(1)
# SEVERITY_SEVERE				(2)
# SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMALARM_COMP_ID, SYSTEMALARM_COMP_ID, SEVERITY_NONE,    0)            

(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((71 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (3 & 0xFFF) )

SYSTEMUTIL_STATUS_INVALID_PARAMETER						0x10802000
#define SYSTEMUTIL_STATUS_INVALID_PARAMETER (SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMUTIL_COMP_ID, SYSTEMUTIL_IF_ID, SEVERITY_SEVERE,  3))

// 0x11c2100d
hex(((71 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (13 & 0xFFF) )
#define SYSTEMUTIL_STATUS_TIMEDOUT          (SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMUTIL_COMP_ID, SYSTEMUTIL_IF_ID, SEVERITY_SEVERE,  13))


={============================================================================
|kt_dev_si_0001| comp-systemalarm


COMPONENT_NAME := systemalarm

(systemalarm.c)
#ifdef ALARMLIST_DEBUG		

#-----------------------------------------------------------
# status
#-----------------------------------------------------------
# define SYSTEMALARM_COMP_ID         (66)
# SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMALARM_COMP_ID, SYSTEMALARM_COMP_ID, SEVERITY_NONE,    0)            

(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((66 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((66 & 0xF) << 12) | (0 & 0xFFF) )

SYSTEMALARM_STATUS_OK						0x10802000

CMS_SYSTEM_INFRASTRUCTURE/SYSTEMALARM/src/systemalarm.c

    system_status = SYSTEMALARM_Set(&alarmInfo, &alarmHandle);

SYSTEM_STATUS SYSTEMALARM_Set(const SYSTEMALARM_ALARM_INFO *info,SYSTEMALARM_ALARM_HANDLE *handle)

static void *AlarmThreadFunction(void *data)
                        gAlarmList.alarmList[idx].info.alarm_data.rel_info.callback(gAlarmList.alarmList[idx].handle,gAlarmList.alarmList[idx].info.alarm_data.rel_info.user_data);

={============================================================================
|kt_dev_si_0001| comp-systemtime

# returns current time in sec
SYSTEMTIME_GetTime
	SYSTEMTIME_GetTimeVals(systemtime, &milliseconds_dummy)

# call to convert time to string
char time_str[SYSTEMTIME_MIN_STRING_BUFFER_SIZE];
int32_t size = SYSTEMTIME_MIN_STRING_BUFFER_SIZE;

# SYSTEM_STATUS SYSTEMTIME_DebugString(SYSTEMTIME_TIMEDATE systemtime,char *buffer,int32_t *size)
if(SYSTEM_STATUS_IS_OK(SYSTEMTIME_DebugString(list->alarmList[i].info.alarm_data.abs_info.timeout, time_str, &size )))

# F:PrintAlarmList L:00971 > Alarm 19, Handle 0x14, next 7, prev 65535, timeout 20/07/2011 22:20:00
DIAG_LOG_INFO(gAlarmDiagSegmentId,("timeout %s", time_str));


# OR
#

#if (defined(DIAG_DEBUG) || defined(__DIAG_DEBUG))
static char* pschedGetCurrentTimeStr(void)
{

    SYSTEMTIME_TIMEDATE     current_time = 0U;
    SYSTEMTIME_CLOCK_CALENDAR cc_currtime;

    (void)SYSTEMTIME_GetTime(&current_time);
    (void)SYSTEMTIME_ConvertTimeDateToClockCalendar(current_time,&cc_currtime);	

    if(snprintf(current_time_str, (size_t)SYSTEMTIME_MIN_STRING_BUFFER_SIZE,
        "KT: %02d/%02d/%04d %02d:%02d:%02d", cc_currtime.day, cc_currtime.month, cc_currtime.year, cc_currtime.hour, cc_currtime.minute, cc_currtime.second)>=SYSTEMTIME_MIN_STRING_BUFFER_SIZE){
        current_time_str[SYSTEMTIME_MIN_STRING_BUFFER_SIZE-1]='\0';/*make sure that string is null terminated */        
    }

    return current_time_str;
}

static char* pschedGetTimeStr(SYSTEMTIME_TIMEDATE timedate)
{

    SYSTEMTIME_CLOCK_CALENDAR cc_time;

    (void)SYSTEMTIME_ConvertTimeDateToClockCalendar(timedate,&cc_time);	

    if(snprintf(general_time_str, (size_t)SYSTEMTIME_MIN_STRING_BUFFER_SIZE,
        "KT: %02d/%02d/%04d %02d:%02d:%02d", cc_currtime.day, cc_currtime.month, cc_currtime.year, cc_currtime.hour, cc_currtime.minute, cc_currtime.second)>=SYSTEMTIME_MIN_STRING_BUFFER_SIZE){
        general_time_str[SYSTEMTIME_MIN_STRING_BUFFER_SIZE-1]='\0';/*make sure that string is null terminated */        
    }

    return general_time_str;
}
#endif /* (defined(DIAG_DEBUG) || defined(__DIAG_DEBUG)) */


#
#
typedef struct SYSTEMTIME_CLOCK_CALENDAR_TAG
{
    uint16_t year;      /*!< @brief The year. */
    uint8_t month;      /*!< @brief The month of the year (1 = January). */
    uint8_t day;        /*!< @brief Day of the month (1 = 1st of the month). */
    uint8_t hour;       /*!< @brief Hour of the day. */
    uint8_t minute;     /*!< @brief Minute of the hour. */
    uint8_t second;     /*!< @brief Second of the minute. */
    uint8_t day_of_week;/*!< @brief Day of the week (0 = Monday) - this field is output only and is not checked when the structure is passed into an interface. */
} SYSTEMTIME_CLOCK_CALENDAR;

SYSTEM_STATUS SYSTEMTIME_SetTime(const SYSTEMTIME_CLOCK_CALENDAR *utc_time, int32_t local_offset)

NDS: ^[20:00:18]0946756818.527260 !MIL    -SYSTEMTIME           < p:0x00000000 P: t:0x2b149b80 T:SIM_PLUGIN_XSI_MC_ENGINE_THREAD M:systemtime.c F:SYSTEMTIME_SetTime L:929 > Time has been updated to (Year:Month:Day:Hour:Min:Sec) 2011:12:16:8:50:59


<sytemtime-heart-beat>
Has 5 secs interval

systemtime.cfg:11:SYSTEMTIME_TIMESTAMP_INTERVAL=5


    if( SYSTEMCONFIG_STATUS_OK == SYSTEMCONFIG_GetIntegerValue(Config_file_Handle,
                                                               "SYSTEMTIME_CONFIGURATION",
                                                               "SYSTEMTIME_TIMESTAMP_INTERVAL",
                                                               &f_systemtime_timestamp_interval) )


static void SYSTEMTIME_TimeStampCallback(void)
{
  {
    if ((systemtime - prev_systemtime) >= f_systemtime_timestamp_interval)
    {
      prev_systemtime = systemtime;

      time_status = SYSTEMTIME_ConvertTimeDateToClockCalendar(systemtime, &clockcalendar);
      if(SYSTEMTIME_STATUS_OK == time_status)
      {
        DIAG_LOG_MIL(g_systemtime_diag_id,("Time is (Year:Month:Day:Hour:Min:Sec) %04d:%02d:%02d:%02d:%02d:%02d",
              clockcalendar.year,clockcalendar.month,clockcalendar.day,clockcalendar.hour,clockcalendar.minute,clockcalendar.second));
      }
    }
  }
}


^[2016:08:21 14:09:07]0946685094.138404 !MIL    -SYSTEMTIME                < T:SYSTEMTIME_NOTIFICATION_THREAD M:systemtime_thread.c F:SYSTEMTIME_TimeStampCallback L:153 >
is (Year:Month:Day:Hour:Min:Sec) 2016:08:21:14:09:07

^[2016:08:21 14:09:12]0946685099.144471 !MIL    -SYSTEMTIME                < T:SYSTEMTIME_NOTIFICATION_THREAD M:systemtime_thread.c F:SYSTEMTIME_TimeStampCallback L:153 >
Time is (Year:Month:Day:Hour:Min:Sec) 2016:08:21:14:09:12


={============================================================================
|kt_dev_si_0001| comp-systemcommon comp-systemexception

<system-common-failure>
system_exception.h defines SYSTEM_EXCEPTIONS_TYPEs and it links to
'SystemCommonFailureType.java'. 


/** Reasons for non-fatal failure. */
/* Enum SYSTEM_EXCEPTION_Type in system_exception.h */
public interface SystemCommonFailureType
{
	int TYPE_UNDEF = 0;

	/** Stopped by the viewer */
	int VIEWER_STOPPED = 1;

	/** Restarted by viewer after recording stopped */
	int VIEWER_RESTARTED_AFTER_RECORDING_STOPPED = 2;

	/** Event booked after its scheduled start time */
	int VIEWER_BOOKED_TOO_LATE = 3;

	/** Viewer stopped in response to disk conflict message */
	int VIEWER_STOPPED_DISK_CONFLICT = 6;

	/** queue paused */
	int USER_PAUSED_QUEUE = 48;

	/** raw HTTP error */
	int HTTP_401_UNAUTHORIZED = 53;

	/** raw HTTP error */
	int HTTP_404_NOT_FOUND = 55;

	/** No Exception */
	int NO_EXCEPTION = 100;
};


<recording-failure-reason>
RecordingFailureReason uses this.

// CMS_SYSTEM_INFRASTRUCTURE/SYSTEMCOMMON/inc/system_exception.h

/** @brief System exception types */
typedef enum SYSTEM_EXCEPTIONS_TYPE_TAG   *booking-exception* *record-error*
{
  // 1
  SYSTEM_EXCEPTION_TYPE_VIEWER_STOPPED,           /*!< @brief Stopped by the viewer */
  // 3
  SYSTEM_EXCEPTION_TYPE_VIEWER_BOOKED_TOO_LATE,   /*!< @brief Event booked after its scheduled start time */
  // 10
  SYSTEM_EXCEPTION_TYPE_POWER_FAILURE,            /*!< @brief Power failure */
  // 15
  SYSTEM_EXCEPTION_TYPE_NO_TUNER_AVAILABLE,       /*!< @brief Tuner not available due to tuner conflict */
  SYSTEM_EXCEPTION_TYPE_HTTP_404_NOT_FOUND,       /*!< @brief raw HTTP error */

  // 35
  SYSTEM_EXCEPTION_TYPE_RECORDING_SUCCEEDED,                       /*!< @brief Recording ended successfully */

  // 45
  SYSTEM_EXCEPTION_TYPE_CONNECTION_LOST,                           /*!< @brief connection lost during PDL job */

  // 75
  SYSTEM_EXCEPTION_TYPE_HTTP_CONNECTION_ERROR,                     /*!< @brief Connection error */

  // 100
  SYSTEM_EXCEPTION_TYPE_NO_EXCEPTION,             /*!< @brief No exceptions occured */

  // 252
  SYSTEM_EXCEPTION_TYPE_PROGRAM_NOT_AVAILABLE,    /*!< @brief Program not available */

  // 254
  /*!< @brief SYSTEMEXCEPTION definition which indicates that the channel is currently not recordable*/
  SYSTEM_EXCEPTION_TYPE_CHANNEL_OR_EVENT_NOT_RECORDABLE,           
}


If there are mismatch between MW definitions in system_exception.h and JPA
definitions in SystemCommonFailureType.java then Picasso displays wrong
messages. 


// build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/si/RecordingFailureReason.java
public class RecordingFailureReason
public static String getRecordingFailureString(int reason, boolean failed)
{
  case SystemCommonFailureType.VIEWER_RESTARTED_AFTER_RECORDING_STOPPED:
    failureReason = "Interrupted";
  case SystemCommonFailureType.NO_CA_AUTHORISATION:
    failureReason = "Subscription needed";
    break;
  case SystemCommonFailureType.NO_XTV_SUBSCRIPTION:
    failureReason = "Subscription needed";
    break;
  case SystemCommonFailureType.HTTP_401_UNAUTHORIZED:
    failureReason = "Subscription needed";
    break;
  case SystemCommonFailureType.HTTP_CA_IMPORT_FAILURE:
    failureReason = "Subscription needed";
    break;

  case SystemCommonFailureType.HTTP_500_INTERNAL_SERVER_ERROR:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_501_NOT_IMPLEMENTED:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_502_BAD_GATEWAY:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_503_SERVICE_UNAVAILABLE:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_504_GATEWAY_TIMEOUT:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_505_HTTP_VERSION_NOT_SUPPORTED:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_CONNECTION_ERROR:
    failureReason = "Remote network problem";
    break;

  case SystemCommonFailureType.HTTP_SEND_ERROR:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_RECV_ERROR:
    failureReason = "Remote network problem";
    break;
  case SystemCommonFailureType.HTTP_COULDNT_CONNECT:
    failureReason = "Remote network problem";
}


={============================================================================
|kt_dev_si_0001| comp-systemlocator

# but the main difference from system objects is in the usage rules. Once a locator is created, 
# the only component thats allowed to read the values from it 
# is the component that created it  Clients can get locator handles, pass them around, etc., 
# but they are not allowed to look inside a locator.
#
# provides a mechanism of packaging system information object identifiers in a form that is transparent to component interfaces. 
#
# format: locator:protocal:object:property value in hex
#
# protocols:
# SYSTEMLOCATOR_PROTOCOL_XSI (5)
# SYSTEMLOCATOR_PROTOCOL_LOCAL (3)
#
# objects:
# SYSTEMLOCATOR_TYPE_SERVICE               3U
# SYSTEMLOCATOR_TYPE_PROGRAMME_INSTANCE    5U
# SYSTEMLOCATOR_TYPE_VOD_ASSET            11U
# SYSTEMLOCATOR_TYPE_AV_PRESENTATION         31U /*!< @brief locates an AV Presentation event. */#

# event locator
locator:5:5:FFE:17C

# service locator
locator:5:3:FFE

job-srcloc=,locator:3:11:29015519:0,job-destloc=,locator:3:1F:4B:19:54:0 


# (((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((47 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((1 & 0xF) << 12) | (1 & 0xFFF) )

'0xbc21001'
#define SYSTEMLOCATOR_STATUS_FAILED           (SYSTEM_MAKE_COMPONENT_STATUS(SYSTEMLOCATOR_COMP_ID, SYSTEMLOCATOR_IF_ID, SEVERITY_SEVERE,  (uint32_t)1U))  /*!< @brief Generic Failure status for SYSTEMLOCATOR */


={============================================================================
|kt_dev_si_0001| comp-systemipc

# Pereira Vega, Francisco 
#
# (((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((99 & 0x3FF) << 22) | ((1 & 0x3) << 16) | ((1 & 0xF) << 12) | (1 & 0xFFF) )

SYSTEMITC_NOT_OK 0c18C11001


={============================================================================
|kt_dev_si_0001| comp-sysinit

COMPONENT_NAME:=SYSINIT_CLIENT
COMPONENT_NAME:=SYSINIT_SERVER


# process spawn from SCD
SYSINIT_SERVER_Init
	spawnProcess
		posix_spawn


<run-ring>
Run level	
The current activity state of a component as determined by SYSINIT

Ring level	
A logical grouping of components. All components `in a given ring level` must
reach the Active run level before SYSINIT shall start the components in the
next ring level.


<sysinit-config>
// # Components to start (PLEASE KEEP IN RING-LEVEL ORDER)
// COMPONENT SSM 1			(MW)
// COMPONENT PDM 2
// COMPONENT SFM 2
// COMPONENT BEM 2
// COMPONENT MM  2
// COMPONENT PREFS       3
// COMPONENT MPM         3
// COMPONENT GFX         3
// COMPONENT CAMM_SERVER 3
// COMPONENT NCM         3
// COMPONENT DHCP        3
// COMPONENT PPPD        3
// COMPONENT FDM         3

// COMPONENT MSM           4
// COMPONENT SIM           4

// COMPONENT FEM 5

// COMPONENT NDS_CA_KERNEL 6
// COMPONENT CAPPROC 6
// COMPONENT PCAT 6
// COMPONENT RNC 6

// COMPONENT SDM 7
// COMPONENT RMF    7
// COMPONENT PSCHED 7

// COMPONENT RMP    8
// COMPONENT MCM 8
// COMPONENT UAM     8

// COMPONENT VRM_SRV 9

// COMPONENT CTM 10

// COMPONENT SPM_SERVER 11
// COMPONENT OFS   11

// COMPONENT SRM        12

// COMPONENT SBM   13
// COMPONENT DLM_SERVER 13

// COMPONENT GUIDE 14
// COMPONENT PLANNER 14
// COMPONENT REMBOOK 14
// COMPONENT SCM 14

// COMPONENT PLAYER     15
// COMPONENT ATG 15

// COMPONENT AEM 16
// COMPONENT WLM 16

// COMPONENT ADAPTOR_INIT      19
// COMPONENT JAVAENGINE        19 # vobs\THIRD_PARTY_LIBRARIES\BSKYB_JTH\build\engines\java\src\javaengine.c
// COMPONENT LAE               19


<sysint-config-new>
// ./FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/fs/NDS/etc/sysinit.cfg

[RING_LEVELS]
NUM_RING_LEVELS=19
[RING_LEVEL_1]
COMPONENT_1="SSM"
NUM_COMPONENTS=1
[RING_LEVEL_10]
COMPONENT_1="CTM"
NUM_COMPONENTS=1
[RING_LEVEL_11]
COMPONENT_1="SPM_SERVER"
COMPONENT_2="OFS"
NUM_COMPONENTS=2

[RING_LEVEL_12]
COMPONENT_1="`SRM`"
NUM_COMPONENTS=1

[RING_LEVEL_13]
COMPONENT_1="SBM"
COMPONENT_2="DLM_SERVER"
NUM_COMPONENTS=2

[RING_LEVEL_14]
COMPONENT_1="GUIDE"
COMPONENT_2="PLANNER"
COMPONENT_3="REMBOOK"
COMPONENT_4="SCM"
NUM_COMPONENTS=4

[RING_LEVEL_15]
COMPONENT_1="PLAYER"
COMPONENT_2="ATG"
COMPONENT_3="VWS"
NUM_COMPONENTS=3
[RING_LEVEL_16]
COMPONENT_1="AEM"
COMPONENT_2="WLM"
NUM_COMPONENTS=2
[RING_LEVEL_17]
NUM_COMPONENTS=0
[RING_LEVEL_18]
NUM_COMPONENTS=0
[RING_LEVEL_19]
COMPONENT_1="JAVAENGINE"
COMPONENT_2="LAE"
NUM_COMPONENTS=2
[RING_LEVEL_2]
COMPONENT_1="PDM"
COMPONENT_2="SFM"
COMPONENT_3="BEM"
COMPONENT_4="MM"
NUM_COMPONENTS=4
[RING_LEVEL_3]
COMPONENT_1="PREFS"
COMPONENT_2="MPM"
COMPONENT_3="GFX"
COMPONENT_4="CAMM_SERVER"
COMPONENT_5="NCM"
COMPONENT_6="DHCP"
COMPONENT_7="PPPD"
COMPONENT_8="FDM"
COMPONENT_9="SPC"
NUM_COMPONENTS=9
[RING_LEVEL_4]
COMPONENT_1="MSM"
NUM_COMPONENTS=1
[RING_LEVEL_5]
COMPONENT_1="SIM"
COMPONENT_2="FEM"
NUM_COMPONENTS=2

[RING_LEVEL_6]
COMPONENT_1="RNC"
COMPONENT_2="NDS_CA_KERNEL"
COMPONENT_3="CAPPROC"
COMPONENT_4="`PCAT`"
NUM_COMPONENTS=4

[RING_LEVEL_7]
COMPONENT_1="SDM"
COMPONENT_2="RMF"
COMPONENT_3="PSCHED"
COMPONENT_4="ATM"
COMPONENT_5="ASM"
COMPONENT_6="SDPC"
NUM_COMPONENTS=6
[RING_LEVEL_8]
COMPONENT_1="MCM"
COMPONENT_2="UAM"
NUM_COMPONENTS=2

[RING_LEVEL_9]
COMPONENT_1="`VRM_SRV`"
NUM_COMPONENTS=1

# each comp follows the below state changes
SYSINIT_RunLevelRequestInitialise, 
SYSINIT_RunLevelRequestPrepare, 
SYSINIT_RunLevelRequestActive, 

# processes
# vobs\FUSION_SYSTEM_INTEGRATION\BSKYB_INTEGRATION\build\processes\. main.c for each process will be automatically generated in building.
APP_Process: app_process_main.c
{
    SYSINIT_ComponentRunLevelStruct componentList[] = {
        {(uint8_t *)"ADAPTOR_INIT", ADAPTOR_INIT_RunLevelRequest},  # JPA
		{(uint8_t *)"JAVAENGINE", JAVAENGINE_RunLevelRequest},      # JVM

	adaptor_init_list[] =	
	{
        DARWIN_ADAPTOR_DIAG_Init,
		DARWIN_ADAPTOR_SYSTEMCOMMON_Init,
		...
	}

	# set 'f_adaptor_init_adaptors' with init_list
	ADAPTOR_INIT_AddRunlevelListeners(adaptor_init_list);

	# register to SYSINT and start
	SYSINIT_StartComponents(sizeof(componentList)/sizeof(*componentList), componentList))
}

ADAPTOR_INIT_RunLevelRequest
	ADAPTOR_INIT_DoFirstTimeOnly
		ADAPTOR_INIT_CreateThread(ADAPTOR_INIT_MainThread)
	PostEvt(ADAPTOR_INIT_MainThread)

ADAPTOR_INIT_MainThread
	case SYSINIT_RunLevelRequestPrepare:
		ADAPTOR_INIT_ChangeWrapperStartState
			for 
				f_adaptor_init_adaptors[i](newstate,&env): DARWIN_ADAPTOR_DIAG_Init ...

	case SYSINIT_RunLevelRequestShutdown:

CA_Process
MW_Process: mw_process_main.c
{
    SYSINIT_ComponentRunLevelStruct componentList[NUM_COMPONENTS] =
    {
        {(uint8_t *)"BEM", BEM_RunLevelRequest}, 
		...
        {(uint8_t *)"MSM", MSM_RunLevelRequest},
		{(uint8_t *)"SIM", SIM_RunLevelRequest}, 
		{(uint8_t *)"PDM", PDM_RunLevelRequest},
        {(uint8_t *)"WLM", WLM_RunLevelRequest}
    };

	SYSINIT_ClientInit: SYSINIT_API_InitMsgHandling: IPC_CLIENT_Init: IPC_CLIENT_Open
	SYSINIT_StartComponents
}

// sysinit.cfg, startup process
// [PROCESSES]
// NUM_CHILD_PROCESSES=3
// SYSINIT_SERVER_PROCESS_NAME="SCD_Process"
SCD_Process: SCD_Process_main.c
{
  SYSINIT_ComponentRunLevelStruct componentList[NUM_COMPONENTS] =
  {
    {(uint8_t*)"DHCP", DHCP_RunLevelRequest},	# this is {comp name, comp init func}
    {(uint8_t*)"NCM", NCM_RunLevelRequest},
      {(uint8_t*)"MM", MODEM_RunLevelRequest},
      {(uint8_t*)"PPPD", PPPD_RunLevelRequest}
  };

  SYSINIT_SERVER_Init
    SYSINIT_ClientInit
    SYSINIT_StartComponents
    SYSINIT_API_SendStartComponentsMsg # pass comp name to sysinit svr
}	


<comp-sysinit-reset>

// build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/InitialisationManager.java
class InitialisationManager
{
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2c1c5520 T:no name M:InitialisationManager$StateChanger F:startOperatingOn L:2393 > T:IM#0:Starting state change to SHUTDOWN
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2c1c5520 T:no name M:PowerOperatingModes F:waitForNonTransitionState L:278 > T:IM#0:waitForNonTransitionState - state > ON
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2c1c5520 T:no name M:PowerOperatingModes F:waitForNonTransitionState L:290 > T:IM#0:state > ON
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2c1c5520 T:no name M:PowerOperatingModes F:waitForNonTransitionState L:291 > T:IM#0:state > ON
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2c1c5520 T:no name M:PowerOperatingModes F:setState L:231 > T:IM#0:setState > TRANSITION
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x011dc520 T:PREFS_PTHREAD M:PowerOperatingModes F:notifyOperatingMode L:302 > T:threadtracker: notifyOperatingMode of state : 1
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x011dc520 T:PREFS_PTHREAD M:PowerOperatingModes F:setState L:231 > T:threadtracker:setState > STANDBY
  // !MIL    -SYSINIT_S    		< p:0x000001c0 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:state_machine.c F:switchAllRingLevelsToShutdownLevel L:545 > STARTING Moving system to runlevel SHUTDOWN. 
  // !MIL    -SYSINIT_S    		< p:0x000001c0 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:state_machine.c F:sendChangeForRingLevel L:240 > STARTING Moving ring level 19 to runlevel SHUTDOWN. 
  // !MIL    -SYSINIT_S    		< p:0x000001c0 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:server_msghandling.c F:sendRunLevelRequest L:965 > STARTING Moving component JAVAENGINE to runlevel SHUTDOWN 
  // !MIL    -SYSINIT_S    		< p:0x000001c0 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:server_msghandling.c F:sendRunLevelRequest L:965 > STARTING Moving component LAE to runlevel SHUTDOWN 
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2eee5520 T:no name M:InitialisationManager F:shutdown L:2226 > T:threadtracker:Entering shutdown
  // !MIL    -EPG_INIT     		< p:0x000001c5 P:APP t:0x2eee5520 T:no name M:InitialisationManager F:shutdown L:2233 > T:threadtracker:Exiting shutdown

  @Override public void startOperatingOn(final List<PicassoLifecycleListener> components)
  {
    LOGGER.logMilestone("Starting state change to " + state.getName());
  }

  @Override public void requestSystemReset()
  {
    powerOperatingModesControl.doOff();
    apiFactory.getSpmApi().initiateShutdown(SpmApi.ShutDownType.FULL_SYSTEM_RESET);
  }

  public void shutdown()
  {
    LOGGER.logMilestone("Entering shutdown");
    disableKeyEvents();
    shutdownAllComponents();
    Executors.killPool();
    killMiddlewareSessions();
    stateChangeExecutor.shutdown();
    myExecutor.shutdown();
    LOGGER.logMilestone("Exiting shutdown");
  }
}


class SpmApiImpl:
public void initiateShutdown(int shutdownType)
{
  natSpmApiShutdownInitiate(shutdownType);
}


SPM_JAVA_ShutdownInitiate
SPM_API_Shutdown_Initiate:
	post SPM_CLIENT_INTERNAL_EVENT_SHUTDOWN_INITIATE and shutdownType

SPM_CLIENT_Task:
	case SPM_CLIENT_INTERNAL_EVENT_SHUTDOWN_INITIATE:
	    SPM_CLIENT_DIAG_LOG_EVENT(("Internal event for SPM_SHUTDOWN"));
	    (void)SPM_CLIENT_Shutdown_message_handler(SPM_CLIENT_EVENT_INTERNAL_TYPE, &myMessage);
	    break;

	SPM_CLIENT_SHUTDOWN_ProcessMessageShutdownStart
		post SPM_CLIENT2SERVER_EVENT_SHUTDOWN_INITIATE

		
SPM_CLIINT_EventHandler:
  case SPM_CLIENT2SERVER_EVENT_SHUTDOWN_INITIATE:

      systemStateMessage.messageType = SPM_SYSTEMSTATE_MESSAGE_SHUTDOWN_INITIATE;
      systemStateMessage.data.shutdown.clientHandle = spm_cliint_handle;
      systemStateMessage.data.shutdown.shutdownType  = payload->shutdown_payload.shutdownType;

      /* Set destination module*/
      messageType = SPM_SVR_SYSTEM_STATE_MODULE;
      messagePtr = (uint8_t *)&systemStateMessage;
      messageSize = (uint32_t)sizeof(systemStateMessage);


SPM_SVR_RegisterMessageHandlers:
/* register the SYSTEM STATE message handler with the dispatcher */
dispatcherStatus |= SPM_DISPATCHER_RegisterMessageHandler((uint16_t)SPM_SVR_SYSTEM_STATE_MODULE, SPM_SystemState_MessageHandler, "SPM SYSTEMSTATE MODULE");


SPM_SystemState_MessageHandler:
	case SPM_SYSTEMSTATE_MESSAGE_SHUTDOWN_INITIATE:
	    SPM_SystemState_ResetTheSystem(msg_data);
	    break;


<com-sysinit-shutdown-type>
/**
 * Various Shutdown Types
*/
typedef enum spm_api_shutdown_type
{
    SPM_API_SHUTDOWN_UNDEF = 0,
    SPM_API_SHUTDOWN_CLEAN = 1,             /**< shutdown of the box*/
    SPM_API_SHUTDOWN_FULL_SYSTEM_RESET = 2, /**< format devices listed in spm.cfg (section [STORAGE_DEVICES]) and restart the box*/
    SPM_API_SHUTDOWN_CLEAN_RESTART = 3,     /**< restart the box without formatting any devices */
    SPM_API_SHUTDOWN_FACTORY_RESET = 4,     /**< restart with factory defaults retaining CA data (format devices listed in spm.cfg section [STORAGE_DEVICES]) */
    SPM_API_SHUTDOWN_FACTORY_RESET_RETAINING_CONTENT = 5,   /**< restart with factory defaults retaining recordings and CA data (format devices listed in spm.cfg section [STORAGE_DEVICES]) */
    SPM_API_SHUTDOWN_UNPAIR = 6,            /**< [IPC only] restart the box after un-pairing from the GW. A new pairing operation will be required. */
    SPM_API_SHUTDOWN_LAST_VALUE = 7
} SPM_API_SHUTDOWN_TYPE;

// DARWIN_PLATFORM/DARWIN_SPM/src/server/spm_system/spm_systemstate.c
SYSTEM_STATUS `SPM_SystemState_ResetTheSystem`(const SPM_API_SHUTDOWN_TYPE shutdownType)
{
    else if(shutdownType == SPM_API_SHUTDOWN_FULL_SYSTEM_RESET)
    {
        /* Reformat the device types listed in the configuration file. */
        status = SPM_SystemState_ResetTheSystemWithFormat(SPM_COMMON_GetConfig()->full_system_reset_device_types);
    }
		SPM_Disk_RequestDataReset
		SYSINIT_API_SetException(SYSTEM_EXCEPTION_TYPE_RESTARTED_LOCALLY)
        SYSINIT_API_SetActivityState(SPM_GetComponentSysinitHandle(), ** "SYSINIT_API_ActivityStateRequestRestart" **)
					SYSINIT_API_SendSetActivityState
						IPC_CLIENT_Send(msgSetActivityState)
  }

// for FSR
== 14885:NDS: ^[2017:12:20 15:28:20]0946685905.457728 !ENTER  -SPM_SERVER   		< p:0x000001ca P:MW t:0x0202e520 T:SPM_DISPATCHER M:spm_systemstate.c F:SPM_SystemState_ResetTheSystem L:1060 > |-> SPM_SystemState_ResetTheSystem
== 14915:NDS: ^[2017:12:20 15:28:21]0946685906.525616 !MIL    -SPM_SERVER   		< p:0x000001ca P:MW t:0x0202e520 T:SPM_DISPATCHER M:spm_systemstate.c F:SPM_SystemState_ResetTheSystemWithFormat L:1198 > SYSINIT_API_SetException(SYSTEM_EXCEPTION_TYPE_RESTARTED_LOCALLY) 


# 
# server side
#
SYSINIT_SERVER_Init:
	ParseConfig("/NDS/etc/sysinit.cfg")
	SYSINIT_initIPCServer
	spawnProcess
	SYSINIT_initStateMachine(stateMachineThread)
		# brings all the components through Undefined, Prepared, Initialised and Active 
		for(l_currentRingLevel=lowestRingLevel; l_currentRingLevel<=highestRingLevel; l_currentRingLevel++)
			for(initStage = 0; initStage <= lastForwardStage; initStage ++)
				switchRingLevelRunLevel("false") # this means that not use timeout when boots up so if there are failed comps then get stuck.


# server_msghandling.c 
#
# IPC_SERVER_AddInterface(listenerAPI)
listenerAPI on IPC 

  case msgRunLevelNotification:
      DIAG_LOG_INFO(g_SYSINIT_SERVER_segment, ("run level notification message"));
      status = "listenerRunLevelNotification"(connectionHandle, message, messageLen);
      break;

	case msgStartComponents:
			status = listenerComponentStarted(connectionHandle, message, messageLen);
			
	case msgSetActivityState:
	    DIAG_LOG_INFO(g_SYSINIT_SERVER_segment, ("activity state message"));
	    status = listenerSetActivityState(connectionHandle, message, messageLen);
	    break;


tasks_function: # server task on g_SYSINIT_SERVER_Tasks_Queue


listenerSetActivityState:
	setActivityStateCallback:
    "whatToDo" = SYSINT_CHANGE_STATE_REQUEST;
    "queuedActivityState" = activityState;
	(void)pthread_cond_broadcast("&somethingToDoCondVariable"); ## here


listenerRunLevelNotification
	# set if comp has reponded sysinit request.
	runLevelNotificationCallback
		# if all comps on the same ring have responded, then signal it.
		sem_post(&ringLevelCompleteSignal)

// CMS_SYSTEM_INFRASTRUCTURE/SYSINIT/src/server/state_machine.c
stateMachineThread:
	/* Start the loop and process the requests as they arrive */
	while(targetRunLevel != SYSINIT_RunLevelRequestShutdown)
	{
	    SYSINIT_API_ActivityStateRequest prevActivityState = SYSINIT_API_ActivityStateRequestUndef;
	    /* Wait for the requested state to change */
	    (void)pthread_mutex_lock(&somethingToDoMutex);
	    if (whatToDo == 0U)
	    {
	        /* wait for something to do... */
	        DIAG_LOG_EVENT(g_SYSINIT_SERVER_segment,("Waiting for something to do..."));
	        (void)pthread_cond_wait("&somethingToDoCondVariable", &somethingToDoMutex);
	    }

		if (myWhatToDo == SYSINT_CHANGE_STATE_REQUEST)
	   	{ 
			switch("queuedActivityState")
			  case SYSINIT_API_ActivityStateRequestRestart:
			  case SYSINIT_API_ActivityStateRequestShutdown:

				DIAG_LOG_MIL(g_SYSINIT_SERVER_segment, ("Moving to SHUTDOWN run level"));

				targetRunLevel = SYSINIT_RunLevelRequestShutdown;

            switchAllRingLevelsToShutdownLevel(highestRingLevel, lowestRingLevel, true);
				// for(`from high ring level to low ring level`)
			   //  switchRingLevelRunLevel 

				DIAG_LOG_MIL(g_SYSINIT_SERVER_segment, ("Reached run level SHUTDOWN"));

            // *comp-sysinit-reset*
            // this is old
				// if(ioctl(t_fd, RESET_CONTROL_RESET) == -1)
            //
            // the new approach uses pwm

          case SYSINIT_API_ActivityStateRequestRestart:
          case SYSINIT_API_ActivityStateRequestShutdown:
		}					

<comp-pwm> *comp-sysinit-reset*
// COMMON_MIDDLEWARE/HGH/src/server/pwm_init.c

/*===========================================================================*/
static void PwmShutdownRestartImmediate(SYSTEMALARM_ALARM_HANDLE handle, uint32_t user_data_handle)
{
    handle = handle;
    user_data_handle = user_data_handle;
    
    DIAG_DECLARE_FUNCTION("PwmShutdownRestartImmediate");

    /* This is used in testing.
     * It allows CI to know the box was forced to shutdown (and is about to finish).
     * Simply output this exact diag to allow the tests to complete.
     **/
    DIAG_LOG_MIL(g_PWM_SERVER_PwmDiag, ("Forcing Restart"));

    PWM_CallPowerHelper(PWM_REQUEST_SHUTDOWN_RESTART);

    return;
}

// PWM is not on SYSINIT config
//
// void* PwmMainThread(void *args)
// {
// 	PWM_Term (pwm_request);
// }
//
// COMMON_MIDDLEWARE/HGH/src/server/pwm_main.c
//
// SYSTEM_STATUS PWM_Term(PWM_REQUEST pwm_request)
// PWM_CallPowerHelper(pwm_request);
//
// void PWM_CallPowerHelper(PWM_REQUEST pwm_request):
// case PWM_REQUEST_SHUTDOWN_RESTART:
//    (void)PWM_SERVER_power_device_restart();
//
//  COMMON_MIDDLEWARE/HGH/src/server/pwm_pow.c
//  SYSTEM_STATUS PWM_SERVER_power_device_restart(void)
//      /* Call the ioctl for reset */
//      if (PWM_SERVER_POW_IOCTL_WD(g_PWM_POW_reset_device_fd, RESET_CONTROL_RESET) == -1)


# SYSINIT_RUNLEVEL_TIMEOUT=60 is used for each comp to respond
switchRingLevelRunLevel
	# This function first instructs all components at the given ring level to change run level.  
	# see runLevelNotificationCallback
	sendChangeForRingLevel(ringLevel, targetRunLevel)
    DIAG_LOG_INFO(g_SYSINIT_SERVER_segment, ("Sent run level changes - waiting for responses"));
	fprintf(stderr, "KT: Sent ring/target run(%d/%d) level changes - waiting for responses\n", ringLevel, targetRunLevel );

	# waits until comps responded on the ring level
	sem_timedwait(&ringLevelCompleteSignal, &timeout);

runLevelNotificationCallback


# client side
#
SYSINIT_API_MyListener: 
	SYSINIT_API_HandleRunLevelRequest
		status = clientNode->callback(runLevel, handle);
			# this calls each comp SPM_RunLevelRequest

"SPM_RunLevelRequest"(SYSINIT_RunLevelRequest, SYSINIT_ComponentHandle)
	SYSINIT_API_NotifyRunLevelChanged(SYSINIT_API_RunLevelNotificationShutdown)
		SEND IPC msgRunLevelNotification


<version-info>
SYSINIT_API_GetVersionInformationString

// CMS_SYSTEM_INFRASTRUCTURE/SYSINIT/src/server/server_tasks.c

#define SERVER_TASKS_VER_INFO_DEV_NAME "/dev/nds/versioninformation"

void getHardwareStringFromDevice(const char *string, uint32_t string_length, SYSINIT_PRIV_HardwareString *pstHardwareString)

            /* Call the ioctl to get property size */
            if (SYSINIT_IOCTL(device_fd, VI_GET_PROPERTY_SIZE, &vi_property_size) != SYSINIT_POSIX_OK)


#
# JVM
#
(engines/java/src/javaengine.c)
JAVAENGINE_RunLevelRequest
	# start
	case SYSINIT_RunLevelRequestActive: 
	{
		DIAG_LOG_INFO( g_javaengine_segment_id, ("JAVAENGINE handling RunLevelRequestActive") );
		status = JAVAENGINE_StartANewThread( JAVAENGINE_ActivateThread, (void *) handle);
	break;
	}

	case SYSINIT_RunLevelRequestShutdown:
		JAVAENGINE_ShutdownThread
			CEEJ_LookupMethod(&javaMethod, MAINCLASSNAME, "shutdown", "()Z");
			SYSINIT_API_RunLevelNotificationShutdown
			
			
(./applications/java_common/src/com/bskyb/darwin/AppEngine.java)
public static boolean shutdown()

#
# not sure how this lead to 'terminateApplication as below.
#
at com/nds/fusion/diagimpl/DiagImpl.logChunksExtended(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V (DiagImpl.java:262:96)
at com/nds/fusion/diagimpl/DiagImpl.checkThrowableExtended(Ljava/lang/Throwable;ILjava/lang/String;Ljava/lang/String;I)Z (DiagImpl.java:442:25)
at com/nds/fusion/diagimpl/DiagImpl.logExtended(ILjava/lang/String;Ljava/lang/Throwable;Ljava/lang/String;Ljava/lang/String;I)V (DiagImpl.java:662:12)
at picasso/i.a(ILjava/lang/String;Ljava/lang/Throwable;Ljava/lang/String;Ljava/lang/String;I)V (:0:188)
at picasso/i.a(Ljava/lang/String;Ljava/lang/Throwable;Ljava/lang/String;Ljava/lang/String;I)V (:0:12)
at picasso/i.a(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V (:0:10)
at picasso/im.y()V (:0:17)
at MainPicasso.terminate()V (:0:16)
at com/bskyb/darwin/AppEngine.terminateApplication(I)Z (AppEngine.java:104:18)


# shutdown. ring/run level
#
F:runLevelNotificationCallback L:00333 > component LAE changed to run/ring level 19/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component JAVAENGINE changed to run/ring level 19/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component ADAPTOR_INIT changed to run/ring level 19/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component WLM changed to run/ring level 16/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component AEM changed to run/ring level 16/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PLAYER changed to run/ring level 15/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component ATG changed to run/ring level 15/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component GUIDE changed to run/ring level 14/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component REMBOOK changed to run/ring level 14/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SCM changed to run/ring level 14/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PLANNER changed to run/ring level 14/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SBM changed to run/ring level 13/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component DLM_SERVER changed to run/ring level 13/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SRM changed to run/ring level 12/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component OFS changed to run/ring level 11/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SPM_SERVER changed to run/ring level 11/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component CTM changed to run/ring level 10/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component VRM_SRV changed to run/ring level 9/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component MCM changed to run/ring level 8/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component UAM changed to run/ring level 8/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component RMP changed to run/ring level 8/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component RMF changed to run/ring level 7/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SDM changed to run/ring level 7/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PSCHED changed to run/ring level 7/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component CAPPROC changed to run/ring level 6/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PCAT changed to run/ring level 6/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component RNC changed to run/ring level 6/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component NDS_CA_KERNEL changed to run/ring level 6/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component FEM changed to run/ring level 5/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component MSM changed to run/ring level 4/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SIM changed to run/ring level 4/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component GFX changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PREFS changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component MPM changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component NCM changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component CAMM_SERVER changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component DHCP changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component FDM changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PPPD changed to run/ring level 3/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component SFM changed to run/ring level 2/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component BEM changed to run/ring level 2/6 (SYSINIT_API_RunLevelNotificationShutdown)
F:runLevelNotificationCallback L:00333 > component PDM changed to run/ring level 2/6 (SYSINIT_API_RunLevelNotificationShutdown)


<init-startup>
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SSM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SSM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SSM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SFM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PDM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component BEM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PDM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component BEM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SFM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PDM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SFM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component BEM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GFX to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MPM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAMM_SERVER to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DHCP to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PPPD to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FDM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PREFS to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPC to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NCM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PREFS to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MPM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GFX to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NCM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DHCP to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAMM_SERVER to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPC to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PPPD to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FDM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MPM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GFX to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PPPD to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAMM_SERVER to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NCM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DHCP to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPC to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FDM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PREFS to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MSM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MSM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MSM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SIM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FEM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FEM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SIM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SIM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FEM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RNC to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAPPROC to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PCAT to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NDS_CA_KERNEL to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RNC to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAPPROC to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PCAT to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NDS_CA_KERNEL to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAPPROC to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PCAT to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NDS_CA_KERNEL to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RNC to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RMF to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PSCHED to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDPC to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ASM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDPC to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PSCHED to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RMF to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ASM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDPC to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RMF to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PSCHED to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ASM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MCM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component UAM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component UAM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MCM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MCM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component UAM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VRM_SRV to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VRM_SRV to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VRM_SRV to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CTM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CTM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CTM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component OFS to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPM_SERVER to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component OFS to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPM_SERVER to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component OFS to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPM_SERVER to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SRM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SRM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SRM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SBM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DLM_SERVER to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DLM_SERVER to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SBM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DLM_SERVER to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SBM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLANNER to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component REMBOOK to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SCM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GUIDE to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SCM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GUIDE to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component REMBOOK to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLANNER to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GUIDE to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component REMBOOK to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SCM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLANNER to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLAYER to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATG to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VWS to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATG to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VWS to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLAYER to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VWS to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATG to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLAYER to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component AEM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component WLM to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component AEM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component WLM to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component WLM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component AEM to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component JAVAENGINE to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component LAE to runlevel INITIALISED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component JAVAENGINE to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component LAE to runlevel PREPARED. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component JAVAENGINE to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component LAE to runlevel ACTIVE. 

!MIL    -SYSINIT_S    		< P:SCD T:STATE_MACHINE_THREAD M:state_machine.c F:stateMachineThread L:1183 > ENDING   Moving system to runlevel ACTIVE. 
!MIL    -SYSINIT_S    		< P:SCD T:STATE_MACHINE_THREAD M:state_machine.c F:stateMachineThread L:1388 > STARTING Moving system to runlevel PVR. 

!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SSM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PDM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SFM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component BEM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PREFS to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MPM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GFX to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAMM_SERVER to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PPPD to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NCM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DHCP to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FDM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPC to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MSM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SIM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component FEM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component NDS_CA_KERNEL to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RNC to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CAPPROC to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PCAT to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDPC to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SDM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PSCHED to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ASM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component RMF to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component MCM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component UAM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VRM_SRV to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component CTM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SPM_SERVER to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component OFS to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SRM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SBM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component DLM_SERVER to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component GUIDE to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component REMBOOK to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component SCM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLANNER to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component PLAYER to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component ATG to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component VWS to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component AEM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component WLM to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component JAVAENGINE to runlevel PVR. 
!MIL    -SYSINIT_S    		< P:SCD T:IPC_WRAPPER_THREAD M:state_machine.c F:runLevelNotificationCallback L:311 > ENDING   Moving component LAE to runlevel PVR. 


*comp-standby* standby out can happen during transition to pvr level

!MIL    -aem          		< p:0x000001d6 P:APP t:0x01479520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SKY)ef01 
!MIL    -EPG_INIT     		< p:0x000001d6 P:APP t:0x2c12f520 T:no name M:PowerOperatingModes F:actionOperatingMode L:385 > T:CEE-J EventQueue Reader 0:actionOperatingMode - mode > 3 currentState > STANDBY
!MIL    -AMS          		< p:0x000001d4 P:MW t:0x01d53520 T:UAM_HP_THREAD M:dataClient.cpp F:DataClient::handleLiveEvents L:83 > STANDBY_OUT event 

{si-pvr-state}
// last sysinit log
!MIL    -SYSINIT_S    		< p:0x000001d1 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:state_machine.c F:switchRingLevelRunLevel L:460 > ENDING   Moving ring level 19 to runlevel PVR. 
!MIL    -SYSINIT_S    		< p:0x000001d1 P:SCD t:0x00648530 T:STATE_MACHINE_THREAD M:state_machine.c F:stateMachineThread L:1416 > ENDING   Moving system to runlevel PVR. 

NDS: ^[2018:04:13 06:22:27]0946685080.367464 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:SystemPvrListener$1 F:run L:97 > T:IM#0:STB isSingleFeedMode=false
NDS: ^[2018:04:13 06:22:27]0946685080.367741 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:STBProfile F:setStbProfileId L:143 > T:IM#0:setStbProfileId: new=aa, old=aa
NDS: ^[2018:04:13 06:22:27]0946685080.367911 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:InitialisationManager F:init_postSTBProfileSet L:1762 > T:IM#0:postSTBmethodCalled set
NDS: ^[2018:04:13 06:22:27]0946685080.368187 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:PlannerStarter F:notifyTransition L:90 > T:IM#0:notifyTransition(3, 6)

	/**
	 * The callback from the middleware notifying us of the SPM system status
	 *
	 * Forwarded from InitialisationManager.SystemPvrListener.notifyChange()
	 */
	@Override public synchronized void notifyTransition(int newState, int reason)
	{
		logger.logMilestone("notifyTransition(" + newState + ", " + reason +")");
		systemState = newState;
		maybeNotifyPlannerSessionAvailable();
	}

	private void maybeNotifyPlannerSessionAvailable()
	{
		/* logger.logInfo("systemState=" + systemState + " sessionState=" + sessionStatusToString(sessionState)); */

		if (hasNotified)
		{
			return;
		}

					logger.logMilestone("PLANNER READY");
   }


NDS: ^[2018:04:13 06:22:27]0946685080.370607 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:PlannerStarter$2 F:run L:140 > T:IM#0:PLANNER READY

		@Override protected void onPlannerSessionAvailable(final PlannerSession plannerSession)

		private void notifyPlannerSessionAvailable(final PlannerSession ses)
		{
			synchronized (doingTheRoundsLock)
			{
				new StateChanger(DISK_RECEIVED, stateChangeExecutor)
				{
					@Override protected void operateOn(PicassoLifecycleListener component,
					                                   StateChangeCompleteListener l)
					{
						component.statusNotifyHDDAvailable(l);
					}
				}.startOperatingOn(managers);
				new StateChanger(PLANNER_SESSION_RECEIVED, stateChangeExecutor)
				{
					@Override protected void betweenUpgradeAndOperation()
					{
						cr.setPlannerSession(ses);
						availability.setPlannerAvailable();
					}
            }
         }
      }

NDS: ^[2018:04:13 06:22:27]0946685080.373559 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:InitialisationManager$StateChanger F:startOperatingOn L:2539 > T:IM#0:Starting state change to DISK RECEIVED
NDS: ^[2018:04:13 06:22:27]0946685080.386518 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c1c5520 T:no name M:InitialisationManager$StateChanger F:startOperatingOn L:2539 > T:IM#0:Starting state change to PLANNER SESSION RECEIVED
NDS: ^[2018:04:13 06:22:27]0946685080.551100 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c193520 T:no name M:SetTopBoxReadinessMilestoneLogger F:onPlannerSessionAvailable L:22 > T:PooledExecutor#3:Planner is ready
NDS: ^[2018:04:13 06:22:27]0946685080.556585 !MIL    -EPG_INIT     		< p:0x0000023d P:APP t:0x2c193520 T:no name M:InitialisationManager$MyPlannerStarter$3 F:onComplete L:2732 > T:PooledExecutor#3:Listeners informed of planner session availability


={============================================================================
|kt_dev_si_0001| comp-wlm

COMPONENT_NAME:=wlm_client
COMPONENT_NAME:=wlm_server

# JPA
#
# DARWIN_PLATFORM\DARWIN_WLM_JAVA
#
COMPONENT_NAME:= darwin_wlm_native
DARWIN_PLATFORM\DARWIN_WLM_JAVA\src\inc\natwlm.h #define WLM_JAVA_DIAG_NAME "J_WLM"

# picasso
vobs/FUSION_SYSTEM_INTEGRATION/BSKYB_INTEGRATION/build/projects/picasso/build_options.mk

# DIAG tip
# to get func name from WLM diags, need to change like below. This should apply for client, server and util component.
# 
# (wlm_server.h)
#define WLM_SERVER_DIAG_ENTRY()      DIAG_DECLARE_FUNCTION(""); do { DIAG_LOG_FN_ENTRY(WLM_SERVER_Globals.diagSegId); } while(0)
# like as below
#define WLM_JAVA_DIAG_ENTRY()     DIAG_DECLARE_FUNCTION(__FUNCTION__); do { DIAG_LOG_FN_ENTRY(g_wlm_adaptor_api_diag_segment_id); } while(0)


# picasso logs for wlm. NetworkAccessModel.java 
# Preferences
EPG_PRF = fatal error warn info
# Preferences (Models)
EPG_PRFM = fatal error warn info                                                                                                

#
# 
Local Connection refers to whether or not DHCP has successfully negotiated a lease. 
Service Connection refers to the connection between the STB and the PDL servers.

On EPG screen in case wireless:
0th - local connection
1th - service connection
2th - IP
3th - DHCP
4th - Network name

#
# this is bridge's ip for configuration which came from wlm.cfg
F:WLM_SERVER_HTTP_Perform L:03056 > URL: "http://90.223.243.225/stbadmin?capabilities

# this is stb's ip for bridge connection. NOTE! it's from SPM and PREFS.
# 90.223.243.226. Is this MNGT connection 'sub-interface' as eth0:1.
# 
# = STB ================== --- WIRED ---- = BRIDGE ========================== - WIRELESS- = AP ========== - WAN
# = MAIN CONNECTION: 192.168.2.x          =                           =     =             = 192.168.2.x =
# = MNGT: 90.223.243.226 =                = MNGT CONNECTION: 90.223.243.225 =             = DHCP        =

#-----------------------------------------------------------
# status
#-----------------------------------------------------------
#define WLM_COMP_ID     (87)
#define SEVERITY_SEVERE (0x2))
#define SEVERITY_NONE	(0)
#define WLM_API        	(0)
            
(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )
hex(((87 & 0x3FF) << 22) | ((0 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )
hex(((87 & 0x3FF) << 22) | ((2 & 0x3) << 16) | ((0 & 0xF) << 12) | (7 & 0xFFF) )

WLM_API_STATUS_OK		0x15c00000	(364904448)
WLM_API_STATUS_ERROR	0x15C20001 	(365035521)
WLM_API_STATUS_TIMEOUT	0x15C20007	(365035527)


# wlm.cfg: wlm_server_readconfigfile()
#
[BRIDGE_PROTOCOL]
INFO_INTERVAL=5		# used for 'WLM_MONITOR_DETECT_BRIDGE' which is WLM_API_IsWirelessPresent.
INFO_TIMEOUT=30

JOIN_DELAY=1
JOIN_INTERVAL=5
JOIN_TIMEOUT=120
REBOOT_DELAY=5
REBOOT_INTERVAL=15
REBOOT_TIMEOUT=360
RESET_DELAY=5
RESET_INTERVAL=15
RESET_TIMEOUT=360
SURVEY_DELAY=5
SURVEY_INTERVAL=5
SURVEY_TIMEOUT=60
UPGRADE_DELAY=240
UPGRADE_INTERVAL=15
UPGRADE_TIMEOUT=360


NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01529 > Creating memory pool...
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01530 >   Pool name: WLM_SERVER_POOL
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01531 >   Pool flags: 0
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01532 >   Pool size: 65536
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01563 > Allocating networks list of 5180 bytes
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01572 > Allocating server transmit message buffer of 5180 bytes
NDS: !INFO  -WLM_SERVER   < M:wlm_server.c  L:01583 > Allocating server receive message buffer of 500 bytes


NDS: ^0946684866.050956 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00582 > Configuration:
NDS: ^0946684866.051098 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00583 >   Bridge IP address: 90.223.243.225
NDS: ^0946684866.051210 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00584 >   Bridge port: 80
NDS: ^0946684866.051317 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00585 >   INFO timeout: 30
NDS: ^0946684866.051429 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00586 >   INFO interval: 5
NDS: ^0946684866.051535 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00587 >   REBOOT delay: 5
NDS: ^0946684866.051644 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00588 >   REBOOT timeout: 360
NDS: ^0946684866.051755 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00589 >   REBOOT interval: 15
NDS: ^0946684866.051861 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00590 >   RESET delay: 5
NDS: ^0946684866.051971 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00591 >   RESET timeout: 360
NDS: ^0946684866.052094 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00592 >   RESET interval: 15
NDS: ^0946684866.052202 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00593 >   UPGRADE delay: 240
NDS: ^0946684866.052311 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00594 >   UPGRADE timeout: 360
NDS: ^0946684866.052418 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00595 >   UPGRADE interval: 15
NDS: ^0946684866.052531 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00596 >   SURVEY delay: 5
NDS: ^0946684866.052640 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00597 >   SURVEY timeout: 60
NDS: ^0946684866.052748 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00598 >   SURVEY interval: 5
NDS: ^0946684866.052856 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00599 >   JOIN delay: 1
NDS: ^0946684866.052966 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00600 >   JOIN timeout: 120
NDS: ^0946684866.053095 !INFO  -WLM_SERVER   < T:IPC_IPCP_THREAD M:wlm_server.c  L:00601 >   JOIN interval: 5


#
# app use this to get stat info after running command like join.
#
natWlmRetrieveInfo
	WLM_JAVA_INFO_TYPE_INFO
	WLM_JAVA_RetrieveInfo(WLM_JAVA_InfoRetrievalListener)
		WLM_CLIENT_SendMessage(WLM_MSGTYPE_API_RETRIEVE_INFO);
		
# client
WLM_API_Join
	WLM_CLIENT_CopyToTransmitBuffer
		WLM_CLIENT_SendMessage(WLM_MSGTYPE_API_JOIN) # to server via IPC

WLM_SERVER_Task:

	WLM_SERVER_ReceiveMessage # read from IPC and copy mesg to 'WLM_SERVER_Globals.rcvbuf.message'

	# JOIN starting point
	#
	case WLM_MSGTYPE_API_JOIN:
		WLM_SERVER_DIAG_INFO(("Dispatch: JOIN"));
		status = WLM_SERVER_Join(0);

	# when completed from monitor thread
	#
	case WLM_MSGTYPE_EVENT_JOIN_COMPLETE:
		WLM_SERVER_DIAG_INFO(("Dispatch: JOIN_COMPLETE"));
		status = WLM_SERVER_Join(WLM_API_STATUS_OK);
		if (status != WLM_API_STATUS_OK)
		{
			WLM_SERVER_DIAG_ERROR(("Join failed, status=%lu", status));
		}
					WLM_SERVER_DIAG_INFO(("Force stop of the Monitor on WLM_MSGTYPE_EVENT_JOIN_COMPLETE"));

		WLM_SERVER_HTTP_StopMonitor(true);
		break;
	
	case WLM_MSGTYPE_API_RETRIEVE_INFO:
		WLM_SERVER_RetrieveInfo
		{
			WLM_SERVER_Globals.rcvbuf.message # read mesg from 'WLM_SERVER_Globals.rcvbuf.message'
			
			WLM_SERVER_HTTP_GetInfo(&WLM_SERVER_Globals.info) 	# WLM_SERVER_Globals.info is a global struct
				WLM_SERVER_HTTP_Perform 													# URL: "http://90.223.243.225/stbadmin?info"
				
				# httpMessageBuffer is a buffer for response from a bridge and is updated from WLM_SERVER_HTTP_WriteData
				
				# update 'info' struct from a response
				#
				WLM_SERVER_HTTP_ParseInfo(&WLM_SERVER_Globals.info)
					WLM_SERVER_HTTP_SetValue
					
			WLM_SERVER_HTTP_GetCaps(&WLM_SERVER_Globals.info.caps)
				WLM_SERVER_HTTP_Perform														# URL: "http://90.223.243.225/stbadmin?capabilities"
				WLM_SERVER_HTTP_ParseInfo
				
			#	send 'info' back to client
			#		
			WLM_SERVER_CopyToTransmitBuffer(sizeof(WLM_API_Info_t), &WLM_SERVER_Globals.info);
			WLM_SERVER_SendClientMessage(WLM_MSGTYPE_RESP_RETRIEVE_INFO);
		}				


# fill Java struct with info struct from WLM
#
WLM_JAVA_InfoRetrievalListener:


# example response. info. send req and parse response. For others, use monitor threads to check response.
#				
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_Perform L:03056 > URL: "http://90.223.243.225/stbadmin?info"
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_WriteData L:01179 > Received 496 bytes, total 496 bytes
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01524 > Setting protocol: 2
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01539 > Setting manufacturer: netgear
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01554 > Setting model: wg902
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01569 > Setting firmware: V1.1.5WW
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01584 > Setting skyid: skywirelessbridge
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01599 > Setting name: netgear083836
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01614 > Setting buildtype: test
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01645 > Setting macAddress: E0:91:F5:08:38:36
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01660 > Ignoring mgmtIp: 90.223.243.225
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01674 > Ignoring mgmtSubnet: 255.255.255.248
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01695 > Setting dhcpClient: true
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01719 > Setting ip: 192.168.2.7 
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01723 > Invalid bridge IP address "192.168.2.7 "
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01748 > Setting subnet: 255.255.255.0 
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01752 > Invalid bridge IP subnet mask "255.255.255.0 "
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01777 > Setting gateway: 192.168.2.1 
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01781 > Invalid gateway IP address "192.168.2.1 "
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01806 > Setting dns: 192.168.2.1
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01830 > Setting ssid: Belkin_7d2ee0
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01853 > Setting security: open
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01894 > Setting encryption: none
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01944 > Setting channel: 13
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01966 > Setting mode: g
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:01999 > Setting apMacAddress: 94:44:52:7D:2E:E0
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02021 > Setting strength: 78
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02041 > Setting state: AUTH
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02077 > Setting surveying: false
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02100 > Setting joining: false

T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_Perform L:03056 > URL: "http://90.223.243.225/stbadmin?capabilities"
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_WriteData L:01179 > Received 43 bytes, total 43 bytes
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02359 > Setting upgradableFirmware: true
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02382 > Setting upgradeCommand: true
T:WLM_SERVER M:wlm_server_http.c F:WLM_SERVER_HTTP_SetValue L:02405 > Setting dhcpClient: true
				
# set dhcpclient in bridge
#
NDS: ^0946687613.080084 !INFO  -WLM_SERVER   < M:wlm_server_http.c  L:03056 > URL: "http://90.223.243.225/stbadmin?set&dhcpclient=1"


WLM_SERVER_HTTP_Init

	# set write func for receiving response from HTTP
	HTTP_API_Setopt(WLM_SERVER_Globals.httpHandle, HTTP_API_OPT_WRITEFUNCTION, WLM_SERVER_HTTP_WriteData);
	
	# 5 seconds timeout
	HTTP_API_Setopt(WLM_SERVER_Globals.httpHandle, HTTP_API_OPT_TIMEOUT, WLM_HTTP_TIMEOUT);

	SPM_API_Network_GetNetworkBridgeConnConf(&network_conf)
	
	...
	SPM_Network_GetBridgeConf
		SPM_Network_SetBridgeConf

WLM_SERVER_HTTP_WriteData
	memcpy(httpMessageBuffer + httpMessageOffset, (uint8_t *)buffer, size * nmemb);


#
WLM_SERVER_Join

	WLM_SERVER_Globals.joinPending = true;

	WLM_SERVER_HTTP_Join
		WLM_SERVER_HTTP_Perform
			HTTP_API_Perform # send req to http
	WLM_SERVER_HTTP_StartMonitor(WLM_MONITOR_JOIN_COMPLETE) # create a thread which checks response from the bridge
		WLM_THREAD_Spawn(WLM_SERVER_HTTP_MonitorTask)

WLM_SERVER_HTTP_MonitorTask
	case WLM_MONITOR_JOIN_COMPLETE:
		WLM_SERVER_HTTP_GetInfo
			WLM_SERVER_HTTP_ParseInfo # parse http response and fill info struct

		SYSTEMITC_API_PostEvent(WLM_SERVER_Globals, WLM_MSGTYPE_EVENT_JOIN_COMPLETE)
		# send evt to server task (see above)


# PR 27096
#
# OK CASE
#
# case WLM_MSGTYPE_API_JOIN:
#   WLM_SERVER_DIAG_INFO(("Dispatch: JOIN"));
#   status = WLM_SERVER_Join(0);
#
NDS: ^0946687092.621281 !INFO  -WLM_SERVER   < M:wlm_server.c  L:01019 > Dispatch: JOIN
NDS: ^0946687092.621659 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03285 > KT: ENT WLM_SERVER_Join:
NDS: ^0946687092.621773 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03289 > KT: joinPending: false!, 0

NDS: ^0946687092.622373 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03316 > Setting pending request...

NDS: ^0946687095.717718 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03332 > Starting monitor...

NDS: ^0946687095.721201 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03341 > KTM: joinPending: 1, opStatus:0, startStatus:364904448
NDS: ^0946687095.721330 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03387 > KT: EXIT WLM_SERVER_Join: status:364904448

#
# case WLM_MSGTYPE_EVENT_JOIN_COMPLETE:
#   WLM_SERVER_DIAG_INFO(("Dispatch: JOIN_COMPLETE"));
#   status = WLM_SERVER_Join(WLM_API_STATUS_OK);
#
NDS: ^0946687106.879011 !INFO  -WLM_SERVER   < M:wlm_server.c  L:01389 > Dispatch: JOIN_COMPLETE
NDS: ^0946687106.879131 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03285 > KT: ENT WLM_SERVER_Join:
NDS: ^0946687106.879251 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03341 > KTM: joinPending: 1, opStatus:364904448, startStatus:364904448

# set 'pending' = false and join the thread
#
NDS: ^0946687106.880785 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03373 > KT: joinPending: 0, opStatus:364904448, startStatus:364904448
NDS: ^0946687106.882284 !INFO  -WLM_SERVER   < M:wlm_server.c  L:01395 > Force stop of the Monitor on WLM_MSGTYPE_EVENT_JOIN_COMPLETE

# ERROR CASE

# In the first part, failure to 'WLM_SERVER_HTTP_Join' set startStatus with  WLM_API_STATUS_TIMEOUT(365035527)
# this set 'pending' to false.
NDS: ^0946687238.954403 !INFO  -WLM_SERVER   < M:wlm_server_http.c  L:03069 > HTTP_API_Perform status: Timeout was reached
NDS: ^0946687238.954566 !ERROR -WLM_SERVER   < M:wlm_server_http.c  L:02697 > Error performing HTTP request
NDS: ^0946687238.954676 !FATAL -WLM_SERVER   < M:wlm_server.c  L:03326 > Bridge join failed.

NDS: ^0946687238.958103 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03341 > KTM: joinPending: 1, opStatus:0, startStatus:365035527

# set pending to false
#    if ((opStatus == WLM_API_STATUS_OK || opStatus == WLM_API_STATUS_ERROR || opStatus == WLM_API_STATUS_TIMEOUT) ||
#        !SYSTEM_STATUS_IS_OK(startStatus))
#
#        WLM_SERVER_DIAG_INFO(("KT: joinPending: %d, opStatus:%d, startStatus:%d", WLM_SERVER_Globals.joinPending, opStatus, startStatus ));
#        WLM_SERVER_Globals.joinPending = false;
#        WLM_SERVER_DIAG_INFO(("KT: joinPending: %d, opStatus:%d, startStatus:%d", WLM_SERVER_Globals.joinPending, opStatus, startStatus ));
# 
NDS: ^0946687238.959649 !INFO  -WLM_SERVER   < M:wlm_server.c  L:03373 > KT: joinPending: 0, opStatus:0, startStatus:365035527

# send resp to a client
#
WLM_SERVER_SendClientMessage(WLM_MSGTYPE_RESP_JOIN);

# so in the second call, it will create a thread again and get OOM on WLM_SERVER_POOL
#
#if (!WLM_SERVER_Globals.joinPending)
#	create a monitor again
#

# and got this because server used ipc mesg from client duing a first call so no more mesg to copy from a client
NDS: ^0946687250.122749 !ERROR -WLM_SERVER   < M:wlm_server.c  L:03304 > Invalid session


={============================================================================
|kt_dev_si_0001| comp-ca

# APP -> VGC IF
# '1039' and '072' docs are basically the same.
#
# CA. When app get CA event from player, app uses VGC to get more infos. 
#
CASI	CA Status Information
CAEI	CA Entitlement Information

#define PLAYER_EVENT_CA                             0x82000000      
#/**< Represents all CA events notified by PLAYER */

#define PLAYER_EVENT_CA_VIDEO						0x82000001      
# /**< Notification of a Video elementry component CA exception. @see #PLAYER_EVENT_CA_Video_PropId */

#define PLAYER_EVENT_CA_AUDIO                       0x82000002      
#/**< Notification of a Audio elementry component CA exception. @see #PLAYER_EVENT_CA_Audio_PropId */

#define PLAYER_EVENT_CA_TELETEXT                    0x82000004      
#/**< Notification of a Teletext elementry component CA exception. @see #PLAYER_EVENT_CA_Teletext_PropId */

#define PLAYER_EVENT_CA_SUBTITLE                    0x82000008      
#/**< Notification of a Subtitle elementry component CA exception. @see #PLAYER_EVENT_CA_Subtitle_PropId */

PLAYER_VGC_GetViewingProblems
PLAYER_PRV_CheckFreeToAirStatus
	# CAMM_MODULE_CAStreamStatusAccessDeniedOther 0x7F. Picasso: PlayerEventCA.CAScrambledStatus


# app side
#
class PlayerEventCAVideoImpl
	getConditionID()
		PlayerEventCommonImpl.natGetUint32(nativeHandle, I_CA_COND_ID);
			# PLAYER_JAVA_EventCommonImplGetUint32 
			# 	PLAYER_API_Event_GetUint32
			# 		PLAYER_API_Video_PropId_Uint32_CACondId: from SYSTEMOBJECT_GetInteger(caei_handle, SYSTEMOBJECT_CAEI_PROPID_I_CA_CONDITION_ID )


PlayerEventPump::processEvent 
	mediaEngine.onCAEvent((PlayerEventCA) event);
		onCAEvent:handlePlayerEventCA
		{
			data.setCondition(caEvent.getConditionID());
			int newProb = extractMWContentProblem();
			currentData.setMWContentProblem(newProb);
		}

int extractMWContentProblem
{
	topMWProblem = ((CA) CR.getCA()).contentCheck(currentData.getCondition(), session.getCpHandle());
	return topMWProblem;
}

# /Picasso/src/java/picasso/mediaengine/ca/ContentInfo.java
public int contentCheck(int conditionID, int cpHandle)
{
	contentInfo.getViewingProblems(cpHandle, conditionID);
}

OR

# \applications\Picasso\picasso\Picasso\src\java\picasso\mediaengine\ca\VGCDebug.java
private static VGCDebugBuffer getCAContentCaInfo
{
byte[] viewingProblemIds = caCCI.getViewingProblems(cpHandle, conditionId);
}

# \DARWIN_PLATFORM\DARWIN_VGC_JAVA\impl\base\CAContentCaInfoImpl.java
public byte[] getViewingProblems(int cpHandle, int conditionId) throws CAException


946685486026: PooledExecutor#0: [  EPG_ME:INFO]: PlayerEventPump.processEvent: event --> com.nds.fusion.playerimpl.PlayerEventCAVideoImpl
946685486365: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.handlePlayerEventCA: 
946685486034: threadtracker: [  EPG_ME:INFO]: GuideRetrievalEventPump.notifySuccess: 
946685486369: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.contentCheck: contentCheck has condition: 48 handle: 50331657
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo: CAContentCaInfo:
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Operation status:                       1 (OPERATION_STATUS_SUCCESS)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   CA service ID:                          16
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Purchase information available:         false
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement type:                       1 (ENTITLEMENT_TYPE_SUBSCRIPTION)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot type:                  1 (SLOT_TYPE_SUBSCRIPTION)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot number:                0
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Promo ID:                               65535
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   SI sync token:                          -1
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Allowed taping modes:                   1 (ANALOG_TAPING_ALLOWED)
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of viewing problems:             0
946685486385: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of exceeded limits:              0
946685486389: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: 0 CONTENT PROBLEMS
946685486390: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.extractMWContentProblem: topMWProblem=-1

946685486391: PooledExecutor#0: [  EPG_ME:INFO]: PlayerEventPump.processEvent: event --> com.nds.fusion.playerimpl.PlayerEventCAAudioImpl
946685486395: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.handlePlayerEventCA: 
946685486399: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.contentCheck: contentCheck has condition: 48 handle: 50331657
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo: CAContentCaInfo:
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Operation status:                       1 (OPERATION_STATUS_SUCCESS)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   CA service ID:                          16
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Purchase information available:         false
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement type:                       1 (ENTITLEMENT_TYPE_SUBSCRIPTION)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot type:                  1 (SLOT_TYPE_SUBSCRIPTION)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot number:                0
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Promo ID:                               65535
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   SI sync token:                          -1
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Allowed taping modes:                   1 (ANALOG_TAPING_ALLOWED)
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of viewing problems:             0
946685486414: PooledExecutor#0: [  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of exceeded limits:              0
946685486753: PooledExecutor#0: [  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: 0 CONTENT PROBLEMS
946685486754: PooledExecutor#0: [  EPG_ME:INFO]: MediaEngine.extractMWContentProblem: topMWProblem=-1



# /Picasso/src/java/picasso/mediaengine/MediaEngine.java
public synchronized void contentProblemUpdate(int context)
{
	//this gets the problem as a ME Problem type
	contentProblem = getProblem(currentData.getMWContentProblem(),
								currentData.getScrambledStatus(),
								context);
}

# \DARWIN_PLATFORM\DARWIN_PLAYER_JAVA\api\PlayerEventCA.java
    public interface CAScrambledStatus
    {
        /** Free to air */
        public static final int FREE_TO_AIR         = 0x76;
            
        /** Access granted */  
        public static final int ACCESS_GRANTED  = 0x01;

        /** Access granted for free preview */ 
        public static final int ACCESS_GRANTED_FREE_PREVIEW     = 0x77;

        /** Access possible by PPV purchase */ 
        public static final int ACCESS_POSSIBLE_BY_PPV  = 0x02;

        /** Access possible if rating control is bypassed */   
        public static final int ACCESS_POSSIBLE_MATURITY_RATING     = 0x04;

        /** Access denied due to user not entitled */  
        public static final int ACCESS_DENIED_NOT_ENTITLED  = 0x71;

        /** Access denied based on geographic blackout */  
        public static final int ACCESS_DENIED_GEOGRAPHIC    = 0x75;

        /** Access denied  due to other reason */  
        public static final int ACCESS_DENIED_OTHER     = 0x7F; (127)
    }

int getProblem(int mwContentProblem, int scrambledStatus, int context)
{
	use IMediaEngineListener.ME_CP_XXX as a return
	# /Picasso/src/java/picasso/common/mediaengine/IMediaEngineListener.java
	static final int		ME_CP_NO_PROBLEM					= 0;
	static final int		ME_CP_CARD_REMOVED					= 1;
	static final int		ME_CP_CARD_INITIALISING				= 2;
	static final int		ME_CP_CARD_PROBLEM					= 3;
	static final int		ME_CP_CARD_ALREADY_CHAINED			= 4;
	static final int		ME_CP_CARD_NOT_AUTHORISED			= 5;
	static final int		ME_CP_SPECIAL_REASON				= 6;
	static final int		ME_CP_PURCHASE_WINDOW_CLOSED		= 7;
	static final int		ME_CP_TIME_BLACKOUT					= 8;
	static final int		ME_CP_LIMIT_EXCEEDED				= 9;
	static final int		ME_CP_PPV_IFP_SLOTS_FULL			= 10;
	static final int		ME_CP_INVALID_CA_PACKET				= 11;
	static final int		ME_CP_PPV_EXPIRED					= 12;
	static final int		ME_CP_SERVICE_NOT_AUTHORIZED		= 13;
	static final int		ME_CP_PPV_BAD_PRICING_TABLE_INDEX	= 14;
	static final int		ME_CP_BLACKOUT						= 15;
	static final int		ME_CP_HD_SERVICE_NOT_AUTHORIZED		= 16;
	static final int		ME_CP_CARD_NOT_PAIRED				= 17;
	static final int		ME_CP_CA_RECORDING_HOLE				= 18;
	static final int		ME_CP_PIN_REQUIRED_PLAYER			= 19;	//PIN_TYPE_PLAYER
	static final int		ME_CP_PIN_REQUIRED					= 20;	//JB i don't think this is required anymore?
	static final int		ME_CP_PIN_REQUIRED_PLAYER_RECORDING	= 21;	//PIN_TYPE_PLAYER
	static final int		ME_CP_PIN_REQUIRED_LOCKED_SERVICE	= 22;	//PIN_TYPE_PLAYER
	static final int		ME_CP_CHAINING_IN_PROGRESS			= 23;
	static final int		ME_CP_CHAINING_COMPLETED			= 24;
	static final int		ME_CP_CHAINING_FAILED				= 25;
	static final int		ME_CP_ACCESS_DENIED_BY_PLAYER		= 26;
	static final int		ME_CP_NO_PDL_ENTITLEMENT			= 27;
	static final int		ME_CP_NUM_PROBLEMS					= 28;	// last problem + 1
}


# INFO for one service
#
# /Picasso/src/java/picasso/mediaengine/ca/ContentInfo.java for contentCheck()
#
[  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: 2 CONTENT PROBLEMS
[  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: CONTENT_PROBLEM_CARD_NOT_PAIRED
[  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: SET AS TOP PROB
[  EPG_CA:INFO]: ContentInfo.getHighestContentProblem: CONTENT_PROBLEM_SERVICE_NOT_AUTHORIZED
[  EPG_ME:ERROR]: MediaEngine.notifyMediaEngineListeners: NotifyMessage:5
[  EPG_CA:INFO]: ContentInfo.contentCheck: contentCheck has condition: 13 handle: 50331651
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo: CAContentCaInfo:
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Operation status:                       0 (OPERATION_STATUS_FAILURE)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   CA service ID:                          0
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Purchase information available:         false
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement type:                       0 (ENTITLEMENT_TYPE_UNKNOWN)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot type:                  0 (SLOT_TYPE_UNKNOWN)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Entitlement slot number:                255
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Promo ID:                               65535
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   SI sync token:                          -1
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Allowed taping modes:                   3 (ANALOG_TAPING_ALLOWED, DIGITAL_TAPING_ALLOWED)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of viewing problems:             2
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:     Viewing problem [0]:
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:       Problem ID:                         3 (CONTENT_PROBLEM_CARD_NOT_PAIRED)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:       Problem code:                       20
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:     Viewing problem [1]:
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:       Problem ID:                         25 (CONTENT_PROBLEM_SERVICE_NOT_AUTHORIZED)
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:       Problem code:                       37
[  EPG_CA:INFO]: VGCDebug.dumpCAContentCaInfo:   Number of exceeded limits:              0


<ca-log>
note: seems not to be the latest since cannot see value 6.

CMS_MEDIA_SERVICES/Media_Streamer/proj_specific/fusion2/build/xtv_temp/inc/n3t009.h

/* Purchase Actions Constants Definition */
#define PREPARE_CA_DATA                   0
#define GET_NUMBER_OF_PURCHASE_OPTIONS    1
#define GET_PURCHASE_OPTION_DATA          2
#define PURCHASE_VIEWING_ONLY             3
#define PURCHASE_VIEWING_AND_TAPING       4
#define GET_PURCHASE_PACKET_DATA          5


// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/mediaengine/ca/CA.java
// @Override public String getUserString()

!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CARD ID: 535426415
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CARD TYPE: 1
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > SUBSCRIBER ID: 26403151
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CAS ID: 2403
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > BOUQUET ID: 4101
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > SUB-BOUQUET ID: 1
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > COUNTRY CODE: 4670034
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CURRENCY CODE: 1
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > ZIP CODE: TW18
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CARD AUTHORIZED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CARD PAIRED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > PVR SUB: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > BSKYB IPPV ALLOWED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > BSKYB PPV CREDIT: 598 / 3501
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > HOUSEHOLD ID: 0033EFD7
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > BSKYB VIP: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > PDL ENTITLEMENT: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > COMMERCIAL: false
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > BB CALLBACK PREFERRED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > PAIRING CALLBACK ENABLED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > LOCAL TV ENABLED: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > ANALYTICS ENABLED: false
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > DOWNLOAD NEXT CAPABLE: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CATCHUP SERIES LINK CAPABLE: true
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > EPG INFO BITS: 0a700000
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > EPG INFO BITS MASK: 0a7a0000
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > PVOD CONTENT GROUP: 130050
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > SHOWCASE BOOKMARK: SH_UK_HDPREMIUM_SPORTS_MOVIES
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > System Details:
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > MODEL NUMBER: R015.084.48.00U (4nvjtz4)
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > VERSION NUMBER: 4f3101
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > SERIAL NUMBER: 330807110
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > RECEIVER ID: C2BC7708200000000
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > CA SYSTEM ID: [2078:01:22 04:51:03]2881974402
!MIL    -EPG_CA                    < p:0x000001f6 P:APP t:0x2dfbd520 T:no name M:CA F:stateActive L:191 > VCA PAIRING INFO: 535426415      4F3101  [2010:06:25 18:51:50]0330807110 7       C2BC7708200000000


<ca-ippv>
when ippv goes okay

// ca ppv happens first but can happen after epg
!MIL    -EPG_CA       		< P:APP t:0x2bfeb520 T:no name M:PPVInfo F:<init> L:181 > T:CEE-J EventQueue Reader 0:Created session on vg@5a6a82e
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_CreatePurchaseObject Enter
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS. DS_NotificationHandler # PO[0] 0, notfication_status = 1, ippv_msg_flag = 0x0
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_CreatePurchaseObject EXIT handle = 0x56
!MIL    -EPG_CA       		< P:APP t:0x2dfa4520 T:no name M:PPVInfo F:setupPPVOptionsCallback L:462 > T:PooledExecutor#2:SYSTEMTEST DEBUG Retrieving ca options
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV_SetPurchaseRequest ENTER, handle 0x56
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction, purchase_action 1
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_SetPurchaseRequest EXIT 8. OK.
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction, EXIT stat = 0
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV_SetPurchaseRequest ENTER, handle 0x56
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction, purchase_action 2
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_SetPurchaseRequest EXIT 8. OK.
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction options_in_pack 11, start_option_index 0, options_to_read 3
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction options_in_pack 11, start_option_index 3, options_to_read 3
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction options_in_pack 11, start_option_index 6, options_to_read 3
!MIL    -VGV          		< P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV Ippv_ExecutePurchaseAction options_in_pack 11, start_option_index 9, options_to_read 2
!MIL    -EPG_CA       		< P:APP t:0x010c18a0 T:no name M:PPVInfo F:objectNotify L:1433 > T:threadtracker:SYSTEMTEST DEBUG CA objectNotify
!MIL    -EPG_CA       		< P:APP t:0x2dfbd520 T:no name M:PPVInfo F:dispose L:208 > T:PooledExecutor#3:Deleting session on caPpvAction vg@5a6a82e
!MIL    -EPG_TVG      		< P:APP t:0x2bfeb520 T:no name M:StartAgainEntsTask$2$3 F:apply L:171 > T:CEE-J EventQueue Reader 0:2 valid subscription(s).
!MIL    -JAE          		< P:APP t:0x2bfeb520 T:no name M:modules/jvm-glue/src/c/src/ceej_bsp.c F:ooBSP_printf L:1382 > [CEE-J EventQueue Reader 0] Scheduling YoungGenGC - youngGenSize=288768, fGCEphemeralBytesAllocd = 288960,  fHeapSize = 20971520
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_DestroyPurchaseObject Enter handle = 0x56
!MIL    -VGV          		< P:CA t:0x0093db30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:IPPV L:162 > NDS.PPV IPPV_DestroyPurchaseObject EXIT handle = 0x56
!MIL    -EPG_TVG      		< P:APP t:0x2bfeb520 T:no name M:StartAgainTask$2$1$1 F:success L:176 > T:CEE-J EventQueue Reader 0:Got [2] assets back
!MIL    -EPG_TVG      		< P:APP t:0x2bfeb520 T:no name M:StartAgainTask$2$1$1 F:success L:180 > T:CEE-J EventQueue Reader 0: Got asset = Fish Town channel = Sky Atlantic HD m/f = false hd = true ppv = false
!MIL    -EPG_TVG      		< P:APP t:0x2bfeb520 T:no name M:StartAgainTask$2$1$1 F:success L:180 > T:CEE-J EventQueue Reader 0: Got asset = Fish Town channel = Sky Atlantic m/f = false hd = false ppv = false

// then epg
!MIL    -EPG_NET      		< P:APP M:HttpNotifier F:send L:31 > d3=508273075&cd4=off&cd5=off&de=UTF-8&t=event&cd=%2Fanytime&ec=AssetAction&el=Title%3DBreaking+Bad+Season+2%3BState%3DNOT_BOOKED%3Btemplatename%3DViewBuyAndKeepBoxSet&ea=SELECT
!ERROR  -EPG_DEV1     		< P:APP M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /buy_and_keep_prepurchase
// int BUY_AND_KEEP_`PREPURCHASE`  = 41;
!MIL    -EPG_SCR      		< P:APP M:Screens F:doOpenScreen L:1103 > T:CEE-J EventQueue Reader 0:SCREEN EST PREPURCHASE layer=4, id=41 opened
// int BUY_AND_KEEP_`PURCHASE`     = 43;
!MIL    -EPG_SCR      		< P:APP M:Screens F:doOpenScreen L:1103 > T:CEE-J EventQueue Reader 0:SCREEN EST PURCHASE layer=4, id=43 opened
!MIL    -EPG_MISC     		< P:APP M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PinEvent","action": "VERIFY_PIN;success","title": "","label": "","currentscreen": "/buy_and_keep_purchase"}
!MIL    -EPG_NET      		< P:APP M:HttpNotifier F:send L:31 > d3=508273075&cd4=off&cd5=off&de=UTF-8&t=event&cd=%2Fbuy_and_keep_purchase&ec=PinEvent&el=&ea=VERIFY_PIN%3Bsuccess
!MIL    -EPG_NET      		< P:APP M:Purchaser F:logResponse L:132 > T:CEE-J EventQueue Reader 0:Response: {"purchase":[{"offerId":"5026","purchaseId":"c14a7a73-5d46-4b60-bf64-6919427d5a98","rentalPeriod":175200}]}
!MIL    -EPG_DLG      		< P:APP M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1475

// then ctm downloads starts


<ca-api>
# com.nds.fusion.vgc.base.CASubscriberConfig
# \vobs\DARWIN_PLATFORM\DARWIN_VGC_JAVA\api\base\CASubscriberConfig.java
package com.nds.fusion.vgc.base;

public interface CASubscriberConfig extends CAObject
{
}


# CAContentCaInfo.java
{
	package com.nds.fusion.vgc.base;
	
	public interface CAContentCaInfo extends CAObject
	{
	    /* Content viewing problems */
    public static final byte CONTENT_PROBLEM_UNKNOWN = 0;
    public static final byte CONTENT_PROBLEM_CARD_PROBLEM = 1;
    public static final byte CONTENT_PROBLEM_CARD_NOT_AUTHORIZED = 2;
    public static final byte CONTENT_PROBLEM_CARD_NOT_PAIRED = 3;
    public static final byte CONTENT_PROBLEM_CARD_ALREADY_CHAINED = 4;
    public static final byte CONTENT_PROBLEM_INVALID_CA_PACKET = 5;
    public static final byte CONTENT_PROBLEM_BLACKOUT = 6;
    public static final byte CONTENT_PROBLEM_TIME_BLACKOUT = 7;
    public static final byte CONTENT_PROBLEM_CONTENT_EXPIRED = 8;
    public static final byte CONTENT_PROBLEM_LIMIT_EXCEEDED = 9;
    public static final byte CONTENT_PROBLEM_PURCHASE_WINDOW_CLOSED = 20;
    public static final byte CONTENT_PROBLEM_PPV_BLOCKED = 22;
    public static final byte CONTENT_PROBLEM_CONSUMMATION_WARNING = 23;
    public static final byte CONTENT_PROBLEM_PENDING_REPORTBACK = 24;
    public static final byte CONTENT_PROBLEM_SERVICE_NOT_AUTHORIZED = 25;
    public static final byte CONTENT_PROBLEM_XTV_PAUSE_AND_RECORDING_NOT_ALLOWED = 50;
    public static final byte CONTENT_PROBLEM_PPV_EXPIRED = 62;
    public static final byte CONTENT_PROBLEM_PPV_BAD_PRICING_TABLE_INDEX = 65;
    public static final byte CONTENT_PROBLEM_SPECIAL_REASON = 70;
    public static final byte CONTENT_PROBLEM_PPV_IFP_SLOTS_FULL	= 71;
    
    public SystemTime getBlackoutEndTime(int cpHandle, int conditionId) throws CAException;
    
    ...
	}
}


# IMPL

# \vobs\DARWIN_PLATFORM\DARWIN_VGC_JAVA\impl\base\CASubscriberConfigImpl.java
package com.nds.fusion.vgcimpl.base;

public class CASubscriberConfigImpl extends CAObjectImpl implements CASubscriberConfig
{
}

# SRC_SUN

# \vobs\DARWIN_PLATFORM\DARWIN_VGC_JAVA\src_sun\sunCAObjectImpl.c
Java_com_nds_fusion_vgcimpl_generic_CAObjectImpl_nativeCall
{
	VGCA_Call(&ndsEnv);
}

# SRC: IF TO VGV

# \vobs\DARWIN_PLATFORM\DARWIN_VGC_JAVA\src\CAObjectImpl.c
void VGCA_Call(NDSJNI_ENV * env)
{
	# VGV Adaptor intercafe
	#
	VGCA_VGC_CALL(function idx)
	{
		case idx:
		
		# VGV Client(VGC) library interface
		#
		VGC_API_XXX();
	}
}

NDS: ^0946686468.121513 !ERROR -VGC_JAVA     < T:no name M:CADebug.c F:VGCA_VGC_CALL L:00041 > The call to concrete VGC method has failed with status 5
NDS: ^0946686468.122413 !ERROR -VGC_JAVA     < T:no name M:CADebug.c F:VGCA_Call L:00041 > The call to methodId 4117 has failed with status 5.
#CONTENTCAINFO_ISPURCHASEINFOAVAILABLE = 0x1015,
#define VGCA_VGC_API_STATUS_OBJECT_NOT_FOUND          5  


<ca-skyplus>
// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/mediaengine/ca/CA.java
// @Override public String getUserString()
      sb.append("\nPVR SUB: ").append(subInfo.isPVRSubscriber());

30354:NDS: ^[2017:05:10 17:03:36]0946690274.838381 !MIL    -EPG_CA                      < p:0x000001ea P:APP t:0x2e229520 T:no name M:CA F:stateActive L:195 > PVR SUB: false


17558:NDS: ^[2017:05:10 16:32:38]0946688416.108480 !MIL    -EPG_UI       		< p:0x000001ea P:APP t:0x2c157520 T:no name M:HomePageController F:populate L:342 > T:CEE-J EventQueue Reader 0:HP: NO SKY+ SUBSCRIPTION OR VIEWING CARD PROBLEM

	public void populate(HomePageTilesInfo tiles)

			if (!pvrSubscriberFlag.isEnabled())
			{
				LOGGER.logMilestone("HP: NO SKY+ SUBSCRIPTION OR VIEWING CARD PROBLEM");
				gridTiles = tiles.getConnectedDefaultGridTiles();
				concreteView.showConnectivityNoSkySubscription();
			}

see <dialog-1042> <dialog-1235>

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/model/BannerActions.java
		@Override public boolean doRecord(@NeverNull ProgrammeItem item, @NeverNull IScheduledBookingAgent agent, IBannerActionHandler actionHandler)
		{
			boolean success = false;

			ICA ca = componentRetriever.getCA();

			IDialogManager dialogManager = componentRetriever.getDialogManager();
			if (!(ca.isSmartCardRemoved()))
			{
				if (!(ca.isSmartCardFailure()))
				{
					if (ca.isPVRSubscriber())
					{
						if (componentRetriever.hasPlannerSession())
						{
							success = addRecording(agent, actionHandler, item);
						}
						else
						{
							actionHandler.showDialog(IDialogID.SKYPLUS_INITIALISING_ID);
						}
					}
					else
					{
						actionHandler.showDialog(IDialogID.RECORD_PLAYBACK_NOT_AVAILABLE_ID);
					}
				}


<comp-ca-vespa> comp-ams ca-callback

http://theyard.cisco.com/si_logs/translation/darwin_0019fb1ae3ac_26e9bedf8a00f6a9636c102f2f87b941/vespa_results.txt

// vespaLogParser.py

egrep -an "NDS.SSF|ssf_set_forward_timer called|FWD_PLUGIN|SSFDataClient|SSF|Cannot allocate|FileSysAdapter" LOGlastrun_realtime_b941 > b941.nds

"NDS.SSF AMS settings|ssf_set_forward_timer called|FWD_FUSION"
"NDS.SSF|ssf_set_forward_timer called|FWD_FUSION"

NDS: ^[2018:03:20 19:00:00]0946710329.482569 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_process_forward_timer called with state WAIT_FOR_WINDOW
NDS: ^[2018:03:20 19:00:00]0946710329.482834 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_set_forward_timer called at mjd 58197, sec 68400, timer for <4480> seconds requested

// NDS: ^[2018:03:20 18:59:45]0946710314.720962 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, PANEL_ID                   0xd
// NDS: ^[2018:03:20 18:59:45]0946710314.721056 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Randomization depth:       7200 seconds
// NDS: ^[2018:03:20 18:59:45]0946710314.721108 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Number of retries          2
// NDS: ^[2018:03:20 18:59:45]0946710314.721157 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Number of retries left     2
// NDS: ^[2018:03:20 18:59:45]0946710314.721209 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Retry timeout              1800 seconds
// NDS: ^[2018:03:20 18:59:45]0946710314.721261 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Recurrence                 1 days
// NDS: ^[2018:03:20 18:59:45]0946710314.721333 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, start time                 0xe355 (DD/MM/YY 20/3/2018)
// NDS: ^[2018:03:20 18:59:45]0946710314.721399 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, start connection window    68400 seconds from midnight (HH:MM:SS 19:0:0)
// NDS: ^[2018:03:20 18:59:45]0946710314.721466 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, end connection window      82800 seconds from midnight (HH:MM:SS 23:0:0)
// NDS: ^[2018:03:20 18:59:45]0946710314.721534 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, certificate exp date       0xffff (DD/MM/YY 22/4/2038)
// NDS: ^[2018:03:20 18:59:45]0946710314.721604 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, file exp date              0xffff (DD/MM/YY 22/4/2038)
// NDS: ^[2018:03:20 18:59:45]0946710314.721665 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x0097ab30 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF AMS settings, Scheme ID  [0x00] group [1] flags [0x01]

timer after 74 mins

NDS: ^[2018:03:20 20:14:40]0946714809.482615 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_process_forward_timer called with state WAIT_FOR_PRE_SESSION
NDS: ^[2018:03:20 20:14:45]0946714814.482434 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_process_forward_timer called with state WAIT_FOR_SESSION
NDS: ^[2018:03:20 20:14:45]0946714814.782341 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Http_OpenEthernetConnection ENTER
NDS: ^[2018:03:20 20:14:45]0946714814.875126 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Unilateral authentication succeeded
NDS: ^[2018:03:20 20:14:45]0946714814.875190 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: start Bilateral authentication
NDS: ^[2018:03:20 20:14:46]0946714815.091398 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Bilateral authentication succeeded
NDS: ^[2018:03:20 20:14:46]0946714815.091452 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Http_OpenEthernetConnection EXIT stat = 0
NDS: ^[2018:03:20 20:14:46]0946714815.091533 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state OPEN_CONNECTION_COMPLETED[0] flags 0x00
NDS: ^[2018:03:20 20:14:46]0946714815.091710 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31000000]
NDS: ^[2018:03:20 20:14:46]0946714815.107262 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528677
NDS: ^[2018:03:20 20:14:46]0946714815.107333 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Http_OpenSession entered
NDS: ^[2018:03:20 20:14:46]0946714815.107406 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Http_OpenSession Exit stat = 0
NDS: ^[2018:03:20 20:14:46]0946714815.107545 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: TransferData Enter
NDS: ^[2018:03:20 20:14:46]0946714815.411721 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:FWD_PLUGIN L:162 > NDS. FWD_FUSION: Http_TransferData EXIT stat = 0
NDS: ^[2018:03:20 20:14:46]0946714815.411893 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_file for owner file [31000000] completed with status FILE_DONE(0)
NDS: ^[2018:03:20 20:14:46]0946714815.412060 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state OWNER_FILE_COMPLETED[2] flags 0x00
NDS: ^[2018:03:20 20:14:46]0946714815.412273 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_file called for file [32000000]
NDS: ^[2018:03:20 20:14:46]0946714815.412356 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [32000000] completed with status SESSION_FAILED(2)
NDS: ^[2018:03:20 20:14:46]0946714815.412428 !ERROR  -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:168 > NDS.SSF ssf_get_file_forward_scheme done - file forward is not required or not allowed
NDS: ^[2018:03:20 20:14:46]0946714815.424817 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state GROUPED_FILES_COMPLETED[4] flags 0x00
NDS: ^[2018:03:20 20:14:46]0946714815.424986 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state MEMORY_USAGE_REPORT_COMPLETED[6] flags 0x00
NDS: ^[2018:03:20 20:14:46]0946714815.425154 !MIL    -VGV          		< p:0x000001f3 P:CA t:0x009a5d50 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state EXTENDED_REPORT_COMPLETED[8] flags 0x00


// changed logging

2553148:NDS: ^[2018:07:19 19:00:14]0946911294.976165 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_set_forward_timer called at mjd 58318, sec 68576, timer for <4931> seconds requested

// 82 mins

2563293:NDS: ^[2018:07:19 20:22:25]0946916225.981803 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_process_forward_timer called with state WAIT_FOR_PRE_SESSION
2563300:NDS: ^[2018:07:19 20:22:30]0946916230.984319 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_process_forward_timer called with state WAIT_FOR_SESSION
2563301:NDS: ^[2018:07:19 20:22:31]0946916231.549414 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF forward session starting media use
2563302:NDS: ^[2018:07:19 20:22:31]0946916231.609363 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenConnection authentication type = FWDMGR_SAC_AUTH_TYPE
2563303:NDS: ^[2018:07:19 20:22:31]0946916231.609485 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state OPEN_CONNECTION_COMPLETED[0] flags 0x00
2563306:NDS: ^[2018:07:19 20:22:31]0946916231.609774 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31340000]
2563307:NDS: ^[2018:07:19 20:22:31]0946916231.704596 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563308:NDS: ^[2018:07:19 20:22:31]0946916231.704647 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563309:NDS: ^[2018:07:19 20:22:31]0946916231.704698 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563310:NDS: ^[2018:07:19 20:22:31]0946916231.704861 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563311:NDS: ^[2018:07:19 20:22:31]0946916231.705320 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563329:NDS: ^[2018:07:19 20:22:31]0946916231.794989 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563330:NDS: ^[2018:07:19 20:22:31]0946916231.795537 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563331:NDS: ^[2018:07:19 20:22:31]0946916231.795985 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563332:NDS: ^[2018:07:19 20:22:31]0946916231.796101 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for owner file [31340000] completed with status FILE_DONE(0)
2563333:NDS: ^[2018:07:19 20:22:31]0946916231.796161 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state OWNER_FILE_COMPLETED[2] flags 0x00
2563334:NDS: ^[2018:07:19 20:22:31]0946916231.796912 !ERROR  -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:168 > NDS.SSF ssf_get_file_forward_scheme done - file forward is not required or not allowed
2563335:NDS: ^[2018:07:19 20:22:31]0946916231.797337 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [38000000]
2563337:NDS: ^[2018:07:19 20:22:31]0946916231.883096 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563338:NDS: ^[2018:07:19 20:22:31]0946916231.883148 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563339:NDS: ^[2018:07:19 20:22:31]0946916231.883200 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563340:NDS: ^[2018:07:19 20:22:31]0946916231.883343 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563341:NDS: ^[2018:07:19 20:22:31]0946916231.883789 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563359:NDS: ^[2018:07:19 20:22:31]0946916231.975968 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563360:NDS: ^[2018:07:19 20:22:31]0946916231.976504 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563361:NDS: ^[2018:07:19 20:22:31]0946916231.976936 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563362:NDS: ^[2018:07:19 20:22:31]0946916231.977049 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [38000000] completed with status FILE_DONE(0)
2563363:NDS: ^[2018:07:19 20:22:31]0946916231.977512 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [39000000]
2563365:NDS: ^[2018:07:19 20:22:32]0946916232.063421 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563366:NDS: ^[2018:07:19 20:22:32]0946916232.063472 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563367:NDS: ^[2018:07:19 20:22:32]0946916232.063523 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563368:NDS: ^[2018:07:19 20:22:32]0946916232.063666 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563369:NDS: ^[2018:07:19 20:22:32]0946916232.064132 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1045 bytes
2563387:NDS: ^[2018:07:19 20:22:32]0946916232.145297 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563388:NDS: ^[2018:07:19 20:22:32]0946916232.145821 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563389:NDS: ^[2018:07:19 20:22:32]0946916232.146282 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563390:NDS: ^[2018:07:19 20:22:32]0946916232.146373 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [39000000] completed with status FILE_DONE(0)
2563391:NDS: ^[2018:07:19 20:22:32]0946916232.146833 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31300000]
2563393:NDS: ^[2018:07:19 20:22:32]0946916232.242824 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563394:NDS: ^[2018:07:19 20:22:32]0946916232.242876 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563395:NDS: ^[2018:07:19 20:22:32]0946916232.242927 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563396:NDS: ^[2018:07:19 20:22:32]0946916232.243579 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563397:NDS: ^[2018:07:19 20:22:32]0946916232.244037 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1054 bytes
2563415:NDS: ^[2018:07:19 20:22:32]0946916232.321720 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563416:NDS: ^[2018:07:19 20:22:32]0946916232.322431 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563417:NDS: ^[2018:07:19 20:22:32]0946916232.323391 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563418:NDS: ^[2018:07:19 20:22:32]0946916232.323484 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31300000] completed with status FILE_DONE(0)
2563419:NDS: ^[2018:07:19 20:22:32]0946916232.323993 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31310000]
2563421:NDS: ^[2018:07:19 20:22:32]0946916232.411806 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563422:NDS: ^[2018:07:19 20:22:32]0946916232.411858 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563423:NDS: ^[2018:07:19 20:22:32]0946916232.411910 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563424:NDS: ^[2018:07:19 20:22:32]0946916232.412070 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563425:NDS: ^[2018:07:19 20:22:32]0946916232.412531 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563443:NDS: ^[2018:07:19 20:22:32]0946916232.503700 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563444:NDS: ^[2018:07:19 20:22:32]0946916232.504248 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563445:NDS: ^[2018:07:19 20:22:32]0946916232.504680 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563446:NDS: ^[2018:07:19 20:22:32]0946916232.504770 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31310000] completed with status FILE_DONE(0)
2563447:NDS: ^[2018:07:19 20:22:32]0946916232.505294 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31320000]
2563449:NDS: ^[2018:07:19 20:22:32]0946916232.590814 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563450:NDS: ^[2018:07:19 20:22:32]0946916232.590863 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563451:NDS: ^[2018:07:19 20:22:32]0946916232.590915 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563452:NDS: ^[2018:07:19 20:22:32]0946916232.591073 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563453:NDS: ^[2018:07:19 20:22:32]0946916232.591500 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563471:NDS: ^[2018:07:19 20:22:32]0946916232.669680 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563472:NDS: ^[2018:07:19 20:22:32]0946916232.670209 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563473:NDS: ^[2018:07:19 20:22:32]0946916232.670663 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563474:NDS: ^[2018:07:19 20:22:32]0946916232.670753 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31320000] completed with status FILE_DONE(0)
2563475:NDS: ^[2018:07:19 20:22:32]0946916232.671218 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31330000]
2563481:NDS: ^[2018:07:19 20:22:32]0946916232.768300 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563482:NDS: ^[2018:07:19 20:22:32]0946916232.768352 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563483:NDS: ^[2018:07:19 20:22:32]0946916232.768404 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563484:NDS: ^[2018:07:19 20:22:32]0946916232.768546 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563485:NDS: ^[2018:07:19 20:22:32]0946916232.769052 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563505:NDS: ^[2018:07:19 20:22:32]0946916232.854649 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563506:NDS: ^[2018:07:19 20:22:32]0946916232.855162 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563507:NDS: ^[2018:07:19 20:22:32]0946916232.855588 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563508:NDS: ^[2018:07:19 20:22:32]0946916232.855677 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31330000] completed with status FILE_DONE(0)
2563509:NDS: ^[2018:07:19 20:22:32]0946916232.856325 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31350000]
2563511:NDS: ^[2018:07:19 20:22:32]0946916232.973722 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563512:NDS: ^[2018:07:19 20:22:32]0946916232.973773 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563513:NDS: ^[2018:07:19 20:22:32]0946916232.973825 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563514:NDS: ^[2018:07:19 20:22:32]0946916232.973961 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563515:NDS: ^[2018:07:19 20:22:32]0946916232.974416 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563533:NDS: ^[2018:07:19 20:22:33]0946916233.055659 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563534:NDS: ^[2018:07:19 20:22:33]0946916233.056178 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563535:NDS: ^[2018:07:19 20:22:33]0946916233.056623 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563536:NDS: ^[2018:07:19 20:22:33]0946916233.056717 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31350000] completed with status FILE_DONE(0)
2563537:NDS: ^[2018:07:19 20:22:33]0946916233.057221 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [31000000]
2563541:NDS: ^[2018:07:19 20:22:33]0946916233.144940 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563542:NDS: ^[2018:07:19 20:22:33]0946916233.144991 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563543:NDS: ^[2018:07:19 20:22:33]0946916233.145071 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563544:NDS: ^[2018:07:19 20:22:33]0946916233.145215 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563545:NDS: ^[2018:07:19 20:22:33]0946916233.145643 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 1051 bytes
2563563:NDS: ^[2018:07:19 20:22:33]0946916233.242583 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563564:NDS: ^[2018:07:19 20:22:33]0946916233.243703 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563565:NDS: ^[2018:07:19 20:22:33]0946916233.244190 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563566:NDS: ^[2018:07:19 20:22:33]0946916233.244280 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [31000000] completed with status FILE_DONE(0)
2563567:NDS: ^[2018:07:19 20:22:33]0946916233.244735 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [32000000]
2563571:NDS: ^[2018:07:19 20:22:33]0946916233.330814 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file Card ID 50528767
2563572:NDS: ^[2018:07:19 20:22:33]0946916233.330868 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession entered
2563573:NDS: ^[2018:07:19 20:22:33]0946916233.330919 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_OpenSession authentication type = FWDMGR_SAC_AUTH_TYPE
2563574:NDS: ^[2018:07:19 20:22:33]0946916233.331081 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:165 > ParseConfigTemplate can't find section_name 3
2563575:NDS: ^[2018:07:19 20:22:33]0946916233.331528 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData ENTER 539 bytes
2563593:NDS: ^[2018:07:19 20:22:33]0946916233.408127 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_TransferData EXIT stat = 0
2563594:NDS: ^[2018:07:19 20:22:33]0946916233.408615 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession ENTER
2563595:NDS: ^[2018:07:19 20:22:33]0946916233.409130 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseSession EXIT stat = 0
2563596:NDS: ^[2018:07:19 20:22:33]0946916233.409222 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [32000000] completed with status FILE_DONE(0)
2563597:NDS: ^[2018:07:19 20:22:33]0946916233.410378 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file called for file [33000000]
2563598:NDS: ^[2018:07:19 20:22:33]0946916233.410497 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_file for grouped file [33000000] completed with status SESSION_FAILED(2)
2563599:NDS: ^[2018:07:19 20:22:33]0946916233.410559 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state GROUPED_FILES_COMPLETED[4] flags 0x00
2563600:NDS: ^[2018:07:19 20:22:33]0946916233.410713 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state MEMORY_USAGE_REPORT_COMPLETED[6] flags 0x00
2563601:NDS: ^[2018:07:19 20:22:33]0946916233.410843 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF ssf_forward_session_stm cur_state EXTENDED_REPORT_COMPLETED[8] flags 0x00
2563602:NDS: ^[2018:07:19 20:22:33]0946916233.411347 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:162 > NDS.SSF forward session ending media use
2563603:NDS: ^[2018:07:19 20:22:33]0946916233.411584 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseConnection ENTER
2563604:NDS: ^[2018:07:19 20:22:33]0946916233.411633 !MIL    -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:FWD_PLUGIN L:162 > FWD_MGR: Http_CloseConnection EXIT stat = 0
2563605:NDS: ^[2018:07:19 20:22:33]0946916233.412233 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:165 > NDS.SSF ssf_dispatch_forward ssf_verify_open failed media_type 6 stat 10006
2563606:NDS: ^[2018:07:19 20:22:33]0946916233.412280 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:165 > NDS.SSF ssf_dispatch_forward ssf_verify_open failed file name
2563608:NDS: ^[2018:07:19 20:22:33]0946916233.412903 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:165 > NDS.SSF ssf_dispatch_forward ssf_verify_open failed media_type 6 stat 10006
2563609:NDS: ^[2018:07:19 20:22:33]0946916233.412950 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:165 > NDS.SSF ssf_dispatch_forward ssf_verify_open failed file name
2563611:NDS: ^[2018:07:19 20:22:33]0946916233.413307 !WARN   -VGC          		< p:0x000001fc P:MW t:0x01b2fe80 T:no name M:../../../../OS_Port/posix_merge/p_fusion_ext.c F:SSF L:165 > NDS.SSF ssf_dispatch_forward failed - no file for forward was found



={============================================================================
|kt_dev_si_0001| comp-ca-vgv

## comp-VGV, Security Services Process

# Galperin, Moshe; Rabinovich, Julia
#

# debug build
# copy debug libs to release_dbg
\vobs\VGV\VGV_DARWIN\src\AMS_BCM_MIPS4K_LNUX_DARWIN_01\BigEndian\debug\

\vobs\VGV\VGV_DARWIN\src\AMS_BCM_MIPS4K_LNUX_DARWIN_01\BigEndian\release_dbg\

# and change diag.cfg
TRACE_LEVEL_VER="AFEWMIPR!"
TRACE_LEVEL_VGC="AFEWMIPR!"
TRACE_LEVEL_VGV="AFEWMIPR!"

NDS: ^0946685191.285129 !INFO  -VGV          < p:00000079 t:2abddb90 T:no name M:p_posix.c F:CDI_SC L:01036 > CMD 000000009020
NDS: ^0946685192.278475 !INFO  -VGV          < p:00000079 t:2abddb90 T:no name M:p_posix.c F:CDI_SC L:01036 > CMD D15C000004
NDS: ^0946685192.286905 !INFO  -VGV          < p:00000079 t:2abddb90 T:no name M:p_posix.c F:CDI_SC L:01036 > SCREADER_TRANSFER returned OK [0x0]


!INFO  -VGC          < F:VGC_INFRA L:01036 > VIEWING_CARD_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x3 Len : 15 Data:  0307963A017017AC01060101FE0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card_id:                       0x0307963A
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	subscriber_id:                 0x017017AC
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	pairing:                       PAIRED
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card check digit:              0x06
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	authorization:                 AUTHORIZED
!INFO  -VGC          < F:VGC_INFRA L:01036 > SYSTEM_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x4 Len : 8 Data:  09630B01000000FF
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	cas_id:                        0x0963
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	si_filtering:                  0x0B01
!INFO  -VGC          < F:VGC_INFRA L:01036 > VERIFIER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x5 Len : 2 Data:  0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	ca_api_version:                0x0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > SUBSCRIBER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x6 Len : 14 Data:  0047425200015457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	region_code:                   0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	country_code:                  474252
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	currency:                      0x0001
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	zipcode:                       5457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > RECEIVER_ID_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x35 Len : 16 Data:  42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	receiver_id                    42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > CA_STB_LABEL_DESCRIPTOR_TAG
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x53 Len : 16 Data:  1020225001234567810B288154732780
!INFO  -VGC          < F:VGC_INFRA L:01036 >  ca_stb_label digits:  20225001234567810B28
!INFO  -VGC          < F:VGC_INFRA L:01036 >  chip_id digits:  547327803601C0680002ABCEC1CB0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00500000000000000000000000400000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 0010FFFFFFF70131ABF00051F7140000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000018800000000000000010000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000000000000000000000000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00
!INFO  -VGC          < F:VGC_INFRA L:01036 > EXTENDED_CONFIG_INFO_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x36 Len : 1 Data:  C0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	is_xtv_subscriber:             YES
!INFO  -VGC          < F:VGC_INFRA L:01036 > VIEWING_CARD_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x3 Len : 15 Data:  0307963A017017AC01060101FE0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card_id:                       0x0307963A
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	subscriber_id:                 0x017017AC
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	pairing:                       PAIRED
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card check digit:              0x06
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	authorization:                 AUTHORIZED
!INFO  -VGC          < F:VGC_INFRA L:01036 > SYSTEM_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x4 Len : 8 Data:  09630B01000000FF
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	cas_id:                        0x0963
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	si_filtering:                  0x0B01
!INFO  -VGC          < F:VGC_INFRA L:01036 > VERIFIER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x5 Len : 2 Data:  0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	ca_api_version:                0x0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > SUBSCRIBER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x6 Len : 14 Data:  0047425200015457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	region_code:                   0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	country_code:                  474252
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	currency:                      0x0001
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	zipcode:                       5457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > RECEIVER_ID_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x35 Len : 16 Data:  42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	receiver_id                    42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > CA_STB_LABEL_DESCRIPTOR_TAG
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x53 Len : 16 Data:  1020225001234567810B288154732780
!INFO  -VGC          < F:VGC_INFRA L:01036 >  ca_stb_label digits:  20225001234567810B28
!INFO  -VGC          < F:VGC_INFRA L:01036 >  chip_id digits:  547327803601C0680002ABCEC1CB0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00500000000000000000000000400000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 0010FFFFFFF70131ABF00051F7140000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000018800000000000000010000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000000000000000000000000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00
!INFO  -VGC          < F:VGC_INFRA L:01036 > EXTENDED_CONFIG_INFO_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x36 Len : 1 Data:  C0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	is_xtv_subscriber:             YES
!INFO  -VGC          < F:VGC_INFRA L:01036 > VIEWING_CARD_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x3 Len : 15 Data:  0307963A017017AC01060101FE0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card_id:                       0x0307963A
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	subscriber_id:                 0x017017AC
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	pairing:                       PAIRED
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	card check digit:              0x06
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	authorization:                 AUTHORIZED
!INFO  -VGC          < F:VGC_INFRA L:01036 > SYSTEM_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x4 Len : 8 Data:  09630B01000000FF
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	cas_id:                        0x0963
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	si_filtering:                  0x0B01
!INFO  -VGC          < F:VGC_INFRA L:01036 > VERIFIER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x5 Len : 2 Data:  0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	ca_api_version:                0x0301
!INFO  -VGC          < F:VGC_INFRA L:01036 > SUBSCRIBER_CONFIG_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x6 Len : 14 Data:  0047425200015457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	region_code:                   0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	country_code:                  474252
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	currency:                      0x0001
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	zipcode:                       5457372020202020
!INFO  -VGC          < F:VGC_INFRA L:01036 > RECEIVER_ID_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x35 Len : 16 Data:  42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	receiver_id                    42733510D59251AB2BC0EC3F00000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > CA_STB_LABEL_DESCRIPTOR_TAG
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x53 Len : 16 Data:  1020225001234567810B288154732780
!INFO  -VGC          < F:VGC_INFRA L:01036 >  ca_stb_label digits:  20225001234567810B28
!INFO  -VGC          < F:VGC_INFRA L:01036 >  chip_id digits:  547327803601C0680002ABCEC1CB0000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00500000000000000000000000400000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 0010FFFFFFF70131ABF00051F7140000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000018800000000000000010000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00000000000000000000000000000000
!INFO  -VGC          < F:VGC_INFRA L:01036 > 00
!INFO  -VGC          < F:VGC_INFRA L:01036 > EXTENDED_CONFIG_INFO_DESCRIPTOR
!INFO  -VGC          < F:VGC_INFRA L:01036 > Tag: 0x36 Len : 1 Data:  C0
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	is_xtv_subscriber:             YES


!INFO  -VGC          < F:VGC_INFRA L:01036 > 	ca_service_id:                 0x00006035
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	cost:                          0x000000C8
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	entitlement type:              XTV_RENT
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	payment_method:                PURCHASE_VIA_SMS_SLOT
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	account slot:                  0x0065
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	expiration date                27-03-2012 23:59:58
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	purchase date                  21-03-2012 14:22:56
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	cancellation date              00-01-0000 00:00:00
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	event viewed:                  NO
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	event cancelled:               NO
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	event reported:                NO
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	analog taping allowed:         NO
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	digital taping allowed:        NO
!INFO  -VGC          < F:VGC_INFRA L:01036 > 	max extension date             00-01-0000 00:00:00


(/BookingManager/src/java/picasso/bookingmgr/controller/PurchaseViewController.java)
946712387696: CEE-J EventQueue Reader 0: [EPG_BOOK:INFO]: PurchaseViewController.purchase: CMS: 1
946712387698: CEE-J EventQueue Reader 0: [EPG_BOOK:INFO]: PurchaseViewController.purchase: OPPV: true

		this.isOppv = !componentRetriever.getCA().isCmsIppvSubscriber(cms); //if not! subscribed then we are OPPV

		LOGGER.logInfo("CMS: " + cms);
		LOGGER.logInfo("OPPV: " + this.isOppv);
		
# Logger.create("EPG_CA"); EPG_ME

(/MediaEngine/src/java/picasso/mediaengine/ca/CA.java)
isCmsIppvSubscriber()
	CASubscriberConfig meh
	result = (1 == meh.getRegionBit(0, 159 + (id - 1)));//now thats magic!
return result

#-----------------------------------------------------------
# flash0/fs/NDS/config/siege_deg.cfg file 
#-----------------------------------------------------------

# see EPGProperties.java
#
#	/** If set, turns on verbose VGC debug **/
#	String	VGC_DEBUG_ENABLE						= "epg.enableverbosevgcdebug";
#
-Depg.enableverbosevgcdebug=true


# VGC debug
(/MediaEngine/src/java/picasso/mediaengine/ca/VGCDebug.java)


# SC 01
#
[  EPG_CA:INFO]: VGCDebug.dumpAll: CA:
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASysCaConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Version:                              1.6 (build 0)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     STB ID:                               12345678 (0x00bc614e)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAViewingCard:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Status:                               4 (CARD_STATUS_READY)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Type:                                 1 (CARD_TYPE_VIEWING_CARD)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card ID:                              42705542
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Check digit:                          1
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Exception code:                       0 (EXCEPTION_IDLE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASubscriberInfo:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAS ID:                               2403 (0x0963)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Subscriber ID:                        22633364
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Country code:                         4670034 ("GBR")
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Currency ID:                          1 (CURRENCY_GBP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Region:                               0
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Zip code:                             TW7     
[  EPG_CA:INFO]: VGCDebug.dumpAll:     SI info:                              2817 (0x00000b01)
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Bouquet ID:                         4101 (0x1005)
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Sub-bouquet ID:                     1 (0x0001)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card authorized:                      true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card paired:                          true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     PVR subscriber:                       true
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [0]:                        1 (RATING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [1]:                        2 (SPENDING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     1 (LIMIT_TYPE_RANGE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value range:                    PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [2]:                        3 (CUMULATIVE_SPENDING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     1 (LIMIT_TYPE_RANGE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value range:                    PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [3]:                        4 (CUMULATIVE_BALANCE_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     3 (LIMIT_TYPE_VALUE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value number:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [4]:                        5 (WATERSHED_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [5]:                        6 (WATERSHED_AUTO_PLAYBACK_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [6]:                        7 (WATERSHED_MANUAL_PLAYBACK_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAParentalSettings:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Temp unlock:                          0 (TEMPORARY_UNLOCK_OFF)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASysParentalConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Master PIN set:                       true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     System lock mode:                     1 (SYSTEM_LOCK_MODE_LOCK_ON)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     PIN retry count:                      3
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of users:                      1
[  EPG_CA:INFO]: VGCDebug.dumpAll:     User [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Local restrictions mode:            1 (LOCAL_RESTRICTIONS_ON)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAReportBack:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Status:                               UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_FAIL)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Allowed:                              true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Connection available:                 false
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Max xfer data size:                   256
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CABackgroundChaining:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Chaining status:                      255 (CHAINING_STATUS_INACTIVE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAEntitlementInfo:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Consummation warning supported:       false
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of account slots:              32
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAAccountSlot [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Slot ID:                            101
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Balance:                            1
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Limit:                              0
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Bonus points balance:               0
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Currency ID:                        1 (CURRENCY_GBP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of subscription slots:         250
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      3
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [1]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      11
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [2]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      16
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [3]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      29
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [4]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      12513
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [5]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      12514
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [6]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      12515
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [7]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      12516
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [8]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      12517
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [9]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46898
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [10]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46902
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [11]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46949
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [12]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46950
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [13]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46962
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [14]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      46963
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [15]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      47174
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [16]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      47200
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [17]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      47314
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionSlot [18]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID:                      47464
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of subscription bitmap slots:  16
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 0
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               3, 11, 16, 29
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [5]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 12288
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               12513, 12514, 12515, 12516, 12517
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [13]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 46848
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               46898, 46902, 46949, 46950, 46962, 46963
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [14]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 47104
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               47174, 47200, 47314
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [15]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 47360
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               47464
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    21/08/2011 23:59:59
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of IPPV slots:                 50
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of OPPV slots:                 250
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of IFP slots:                  0
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASubscriberConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of region blocks:              4
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [0]:                   010b2a0a0037f000000000000201000000000000000000000000000001524247
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [1]:                   0000000000000000000000000000000000000000000000000000000000000000
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [2]:                   0602000000000000000000000000000000000000000000000000000000000000
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [3]:                   0000000000000000000000000000000000000000000000000000000000000000

# SC 02
#
[  EPG_CA:INFO]: VGCDebug.dumpAll: CA:
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASysCaConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Version:                              1.6 (build 0)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     STB ID:                               12345678 (0x00bc614e)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAViewingCard:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Status:                               4 (CARD_STATUS_READY)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Type:                                 1 (CARD_TYPE_VIEWING_CARD)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card ID:                              52594028
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Check digit:                          4
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Exception code:                       0 (EXCEPTION_IDLE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASubscriberInfo:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAS ID:                               2403 (0x0963)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Subscriber ID:                        25670535
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Country code:                         4670034 ("GBR")
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Currency ID:                          1 (CURRENCY_GBP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Region:                               0
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Zip code:                             UK4  2ES
[  EPG_CA:INFO]: VGCDebug.dumpAll:     SI info:                              2817 (0x00000b01)
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Bouquet ID:                         4101 (0x1005)
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Sub-bouquet ID:                     1 (0x0001)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card authorized:                      true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Card paired:                          false
[  EPG_CA:INFO]: VGCDebug.dumpAll:     PVR subscriber:                       false
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [0]:                        1 (RATING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [1]:                        2 (SPENDING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     1 (LIMIT_TYPE_RANGE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value range:                    PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [2]:                        3 (CUMULATIVE_SPENDING_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     1 (LIMIT_TYPE_RANGE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value range:                    PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [3]:                        4 (CUMULATIVE_BALANCE_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     3 (LIMIT_TYPE_VALUE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value number:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [4]:                        5 (WATERSHED_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [5]:                        6 (WATERSHED_AUTO_PLAYBACK_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAUserLimit [6]:                        7 (WATERSHED_MANUAL_PLAYBACK_LIMIT_ID)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value type:                     2 (LIMIT_TYPE_BITMAP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Limit value bitmap:                   PIN needed
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAParentalSettings:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Temp unlock:                          0 (TEMPORARY_UNLOCK_OFF)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASysParentalConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Master PIN set:                       true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     System lock mode:                     1 (SYSTEM_LOCK_MODE_LOCK_ON)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     PIN retry count:                      3
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of users:                      1
[  EPG_CA:INFO]: VGCDebug.dumpAll:     User [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Local restrictions mode:            1 (LOCAL_RESTRICTIONS_ON)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAReportBack:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Status:                               UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_FAIL)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Allowed:                              true
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Connection available:                 false
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Max xfer data size:                   256
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CABackgroundChaining:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Chaining status:                      255 (CHAINING_STATUS_INACTIVE)
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CAEntitlementInfo:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Consummation warning supported:       false
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of account slots:              32
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAAccountSlot [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Slot ID:                            101
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Balance:                            1
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Limit:                              3501
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Bonus points balance:               0
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Currency ID:                        1 (CURRENCY_GBP)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of subscription slots:         250
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of subscription bitmap slots:  16
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [0]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 0
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               3, 11, 16, 29
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    16/04/2011 23:59:59 (EXPIRED)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [5]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 12288
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               12513, 12514, 12515, 12516, 12517
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    16/04/2011 23:59:59 (EXPIRED)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [13]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 46848
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               46898, 46902, 46949, 46950, 46962, 46963
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    16/04/2011 23:59:59 (EXPIRED)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CASubscriptionBitmapSlot [14]:
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Base CA service ID:                 47104
[  EPG_CA:INFO]: VGCDebug.dumpAll:       CA service ID bitmap:               47200, 47314
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Expiration date:                    16/04/2011 23:59:59 (EXPIRED)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of IPPV slots:                 50
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [0]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [1]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [2]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [3]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [4]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [5]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [6]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [7]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [8]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [9]:                       UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [10]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [11]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [12]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [13]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [14]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [15]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [16]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [17]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [18]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [19]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [20]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [21]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [22]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [23]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [24]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [25]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [26]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [27]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [28]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [29]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [30]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [31]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [32]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [33]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [34]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [35]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [36]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [37]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [38]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [39]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [40]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [41]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [42]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [43]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [44]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [45]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [46]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [47]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [48]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     CAIppvSlot [49]:                      UNKNOWN (com.nds.fusion.vgc.generic.CAException: VGCA_VGC_API_STATUS_CARD_ERROR)
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of OPPV slots:                 250
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of IFP slots:                  0
[  EPG_CA:INFO]: VGCDebug.dumpAll:   CASubscriberConfig:
[  EPG_CA:INFO]: VGCDebug.dumpAll:     Number of region blocks:              4
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [0]:                   010b0a0a0037f000000000008201000000000000000000000000000001524247
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [1]:                   0000000000000000000000000000000000000000000000000000000000000000
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [2]:                   0002000000000000000000000000000000000000000000000000000000000000
[  EPG_CA:INFO]: VGCDebug.dumpAll:       Region block [3]:                   0000000000000000000000000000000000000000000000000000000000000000


={============================================================================
|kt_dev_si_0001| comp-ca-camm

## comp-CAMM (CA Module Mgt)

CAMM shall provide a path for communication between VGC and the CA kernel and
shall relay all the messages that VGC and the CA kernel exchange.

# terms
#
VGV : CA Kernel or CA Module(CA System)
VGC : CA Module Client
MCI	: Middleware - CAS Interface

# conns
#
MCM_SysinitPrepare
	CAMM_DEVICEMAN_RegisterListenerMso(MCM_DEV_MAN_ListenerMSO) # only one place


={============================================================================
|kt_dev_si_0001| comp-xtvfs

git clone ssh://kyoupark@wwwin-git-gpk-2.cisco.com:29418/XTVFS_Comp.git

XTVFS description.

On XTV project start we didn’t have any file system experience. So we decided
to take existing embedded file system and extend it to support XTV
requirements. The only ready to use portable embedded file system was ERTFS,
FAT based file system. We used FAT32 mode. We extended ERTFS API to support
  OpenTV file system driver API and recording and playback of stream file. To
  increase the efficiency of work with huge stream files we allocated for them
  special virtual partition with increased cluster size and use extents tables
  for fast searches. This destroys FAT32 compatibility. Other non-FAT32
    compatible feature is support of huge files, with length more then 2 GB
      and instant replay files.  All those features will be discussed further.

XTVFS assumes to be the only file system on disc. So disc partition table is
overwritten on format.


XTV FS Group <XTVFSGroup@nds.com>

# see below as there are some tools and docs
\\ukbackup.uk.nds.com\STB Development\XTVFS


<xtvfs-build>

// this is where source is
/home/kyoupark/platform_hub/XTV_Low_Level_VOB/XTVFS_Comp

output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/debug/xtvfs.ko
output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/debug/mhxnvramfs.ko
output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/release/xtvfs.ko
output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/release/mhxnvramfs.ko
output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/release_dbg/xtvfs.ko
output/linux_lib/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/release_dbg/mhxnvramfs.ko


<xtvfs-error>
/* XSTATUS warning/error creation
  parametrs:
	mod - Name of module, generating Warning / error
	num - Number of error
	txt - Error description
*/
#define X_WARN_CREATE(mod,num,txt)		((XSTATUS)(((mod & 0x7f)<< 8) | (num & 0xff)))
#define X_ERR_CREATE(mod,num,txt)		((XSTATUS)(0x8000 | X_WARN_CREATE(mod,num,txt)))

0x8000 | (((1 & 0x7f) << 8) | (num & 0xff) )

	XTVFS_E_NOENT		=   XTVFS_ERR(2),				/*!< @brief   File not found or path to file not found */
	XTVFS_E_NO_MEM		=   XTVFS_ERR(3),				/*!< @brief   Out of memory */

>>> hex(0x8000 | (((1 & 0x7f) << 8) | (2 & 0xff) ))
'0x8102'

// from KMSG.LOG
<4>[0946685585.773993] XTVFS_InodeRead:GetMaxOffsetFromExtentFile failed, stat = 0x8102, fullPath= A:\S22236\STREAM.STR!!!!!


//
[0946684904.764040] xtvfs_write_inode: XtvfsWriteInodeNoLock failed
[0946684904.761040] BufRead: pc_read_blk  failed, ret= 0x8103 !!!!!
[0946684904.762040]InodeGet: BufRead failed, block = 243623 !!!
[0946684904.763040]XTVFS_InodeWrite: InodeGet failed !!!
[0946684904.764040]
[0946684904.764040] xtvfs_write_inode: XtvfsWriteInodeNoLock failed


XTVFSSTATUS pc_alloc_blk(BLKBUFF **ppblk, LPARTITION *plpart, BLOCKT blockno, int *pbufValid)
{
  BLKBUFF *pblk;
  // return(mem_block_pool);
  return(XTVFS_E_NO_MEM);
}


/*---------------------------------------------------------------------------*/
static FINODE* InodeGet(int ppartno,  unsigned long block, unsigned int index,
                  BLKBUFF** ppbuff, int* pb_myNode)
/*!<
  \Description: Find finode, defined by block index in cache, if not found, read from disc   
  \Parameters:  
  \- ppartno:	in, partition number
  \- block		:in: directory sector 
  \- index		:in: index of dosinode  
  \- ppbuff		:out: if not equal to 0, RAM copy of sector block, should be freed by caller after use.  
  \- pb_myNode	:out: 1, if finode was allocated (should free) 
  \Returns:  finode on sucess;
			0 on failure
  \*---------------------------------------------------------------------------*/ 
{
	DOSINODE*  pi;
	FINODE*	   pfinode;
	LPARTITION *plpart = 0;
	
	*pb_myNode = 0;
	*ppbuff = 0;

	
	/* TODO :  Currently we get the the plpart of partition 0 i.e. only internal partition is supported.
	           This should be changed to support external disk by receiveing ppartno as parameter
			   to this function
			   Please note that the third parameter of pc_prtno2prt instruct whther to check that the partition is mounted
	*/

   /* Get Pointer to the structure of data partition */
	plpart = pc_prtno2prt(ppartno,DATA_PARTITION,FALSE); 
	if (!plpart) {
		printk("XTVFS::InodeGet, ppartno = %d, Null data logical partition !!!!!\n",ppartno);
		return 0;
	}
		/* search in inode cache */
	pfinode = pc_scani( plpart, block, index);
	if(pfinode) {	/* found */
		return pfinode;
	}

	/* finode did not found - allocate new and read */
	*ppbuff = BufRead(ppartno, block);
	if(!*ppbuff) {
		printk("InodeGet: BufRead failed, block = %lu !!!\n", block);

      // NOTE: WHY RETURN???
		return 0;
	}

	pfinode = pc_memory_finode();
	if(!pfinode) {
		printk("\n InodeGet: no free finodes !!!!! \n");
		pc_free_buf(*ppbuff, 0);
		return 0;
	}
	*pb_myNode = 1;
	pi = (DOSINODE *) &((*ppbuff)->data[0]);
	pc_dos2inode( pfinode, (pi + index));
	pc_marki(pfinode, plpart, block, index);
	pfinode->opencount = 1;
	return pfinode;
}


// FINODE

NOTE: Where are to call pc_memory_finode()?

// /*  the FINODE structure freed (returned to the heap.) */
// void pc_free_memory_inode(FINODE *pinode)

kyoupark@kit-debian64:~/si/XTVFS_Comp$ gl -r pc_free_memory_inode
pc_free_memory_inode  216 XTVFS_CMA_Wrapper/src/xtvfs4kernel.c          pc_free_memory_inode(pobj->finode);
pc_free_memory_inode 3506 ertfs/src/api.c                       pc_free_memory_inode(((DROBJ *)statobj->pobj)->finode);
pc_free_memory_inode  481 ertfs/src/bss.c       XDEBUG_DEFINE_FUNC(pc_free_memory_inode) /* automatically added */
pc_free_memory_inode 2014 ertfs/src/drobj.c     pc_free_memory_inode(pfi);
pc_free_memory_inode  826 inc/xtvdisk.h    void pc_free_memory_inode(FINODE *pinode);


// PC_MEMORY_FINODE -  Allocate a FINODE structure

// static FINODE* InodeGet(int ppartno,  unsigned long block, unsigned int index,
pc_memory_finode  145 XTVFS_CMA_Wrapper/src/xtvfs4kernel.c      pfinode = pc_memory_finode();

pc_memory_finode  526 ertfs/src/bss.c   XDEBUG_DEFINE_FUNC(pc_memory_finode) /* automatically added */

// FINODE *pc_alloci(int ppartno)                                         /*__fn__*/
pc_memory_finode 1882 ertfs/src/drobj.c         p = pc_memory_finode();

pc_memory_finode  825 inc/xtvdisk.h    FINODE *pc_memory_finode(void);


static XTVFSSTATUS Init(void)
{
  ret = init_xtvfs_data_array();
}

static XTVFSSTATUS init_xtvfs_data_array()
{
    // to `NBLKBUFFS`
    ret |= pc_init_blks_pool();

    if (_mem_buff_pool == NULL)
    #define MEM_SIZE_BUFF_POOL      (BUFFER_POOL_SIZE * sizeof(byte))
    #define BUFFER_POOL_SIZE ((BUF_SIZE * `NBLKBUFFS`) + BUFFER_ALIGNMENT)

    // array 
    if (mem_block_pool == NULL)

    // from XTV Darwin Source NOTE: baseline is different!
    BLKBUFF   mem_block_pool[NBLKBUFFS];
    // #define NBLKBUFFS        BUFFERS_POOL_BLOCKS  

    PC_FILE   mem_file_pool[NUSERFILES];
    // #define NUSERFILES       MAX_OPENED_FILES  

    DROBJ     mem_drobj_pool[NDROBJS];
    // #define `NDROBJS`    (32 + NUM_USERS*MAX_NUM_PHYS_PARTS + NUM_USERS + `NUSERFILES`)

    FINODE    mem_finode_pool[NFINODES];
    // /* Directory Object Needs. Conservative guess is One CWD per user per partition(In VGDRM - We have one CWD per user) +
    // One per file + one per User for directory traversal */
    // /* This is calculated... do not change */
    // #define `NFINODES`   (32 + NUM_USERS*MAX_NUM_PHYS_PARTS + NUM_USERS + `NUSERFILES`)

    byte      _mem_buff_pool[BUFFER_POOL_SIZE];
    byte      _mem_buff[CLUSTER_SIZE + BUFFER_ALIGNMENT];
}


//
#else
#define NBLKBUFFS        BUFFERS_POOL_BLOCKS  
								/* Number of blocks in the buffer pool. Uses 532
                                bytes per block. Impacts performance during
                                directory traversals Since disk Reads on
                                Sandisk is very fast we can keep this low
                                (must be at least 1) */

#define NUSERFILES       MAX_OPENED_FILES  
								/* Maximum Number of open Files */
#endif /*LOW_MEM*/


///////////////////////////////////////////////////////////
// platform/dogan/inc/xtvfs_config.h

/* Maximum number of opened files at the same time (data & stream files) */
#define MAX_OPENED_FILES			80
/* Number of blocks in the buffers' pool */
/* !!! we need to check how does this number affects the performance. Maybe it can be reduced to
    save memory */
#define BUFFERS_POOL_BLOCKS			(MAX_OPENED_FILES*2)



// For DARWIN

/**********************************************************
 *    Data files' configuration constants                 *
 **********************************************************/
/* Maximum number of opened files at the same time (data & stream files) */
#define MAX_OPENED_FILES			80

/* Number of blocks in the buffers' pool */
/* !!! we need to check how does this number affects the performance. Maybe it can be reduced to
    save memory */
#define BUFFERS_POOL_BLOCKS			(MAX_OPENED_FILES*2)



# The stat = 0x8123 means partition table error. It seemed to be a failure in
# mount operation when trying to read the partition table.
# 
# XTVFS have a data structure called "Additional Info" reside at sector 5 and
# use sector 6 as a backup.  In version Z6, sector 5 is copied into sector 6
# in case the two have different content and in version 20, a difference
# between the two copies fails the mount. 
#
# old one (baseline) XTVFS_ALL_OS17.13.8Z6_XTVFS_MAIN_2_Int (from log)
# @(#)XTVFS FORMAT 17.13.8Z6 PRODUCT Aug 31 2011 11:41:42
#
# new one (baseline)
# XTVFS_ALL_OS20.0.8_XTVFS_MAIN_2_Int@/vobs/FUSIONOS_PROJECTS

# so if old xtvfs(Z release) had a way to fix a sector06 by copying it from
# sector05, then why are we seeing this problem when shifting to R2(new xtvfs)
# as it should be fixed before when ran R1??

# Exactly my question too. If you consider that sector 6 is corrupted by a
# copy of sector 0, I can only assume that some component in R2 still write to
# sector 6. This is why I asked if the content of sector 5 and 6 be chcked
# before running R2.  (expected to be the same as old xtvfs fixes if it's
# different) 

# You're suspecting that some component, PDM or Storage Helper here, may back
# up sector06 with sector#0(partition table)?  Yes.  (Currently PDM uses #32
# for backing up #00 and before it was #06 and storage helper did.)

# why I didn't hit the same problem when tried to move from clean R1 to R2 on
# a differnt box?  Well, on normal legacy box the partition starts at sector
# 63 not at sector 1!

# To be correct, legacy means disk formatted by Orchid software.  Fusion
# software formats the partition to start at sector 64. Most important, not at
# sector 1.


# Well, if the partition starts at 63 (or 64) then wrting to sector 6 will not
# corrupt file system.  When the partition start at 63, the additional sector
# will be at sector 65 and 66 as there location is relative to teh start of
# partition

# So it's not just about #06. If partion starts 01 and 06 is broken, then
# xtvfs would think that whole partition is broken and cannot mount a
# partition. that's the problem we're seeing. am i correct?

# yes. To be more accurate, XTVFS do check but, deccide that sector 5 will be
# copied to sector6.  It is always a debate whether to try and recover or to
# fail a mount.  In this case we would not find the issue is XTVFS would not
# fails the mount.  However, if such issue will happen in the field, probably
# the best is to try and recover. Tough question. 
#
# However, it turned out that version R1 check and fixed 16 bytes (size of the
# structure), while version R2 checked 512 bytes (whole sector).  So for R1 it
# was fixed, but for R2 it was still corrupted. Please note that we changed
# this during the 4k change to compatible with other XTVFS met-data. And most
# important, this is extra anyway, such corruption should never happen!

# ORG problem box: sec 5 : sec 6 = diff
# ENG box        : sec 5 : sec 6 = same
#                  =smae   =diff

# In eng fix, it make a copy of whole 5 to 6.
#
# you can also do the following:
# dd if=/dev/sda of=5.bin skip=5 count=1
# dd if=/dev/sda of=6.bin skip=6 count=1
# diff 5.bin 6.bin
# 
# # to stb's hdd
# dd if=./5-problem.bin of=/dev/sda seek=5 count=1
# dd if=./6-problem.bin of=/dev/sda seek=6 count=1

#
# problem case
#
Disk /dev/sda: 500.1 GB, 500107862016 bytes
97 heads, 1 sectors/track, 10069826 cylinders, total 976773168 sectors
Units = sectors of 1 * 512 = 512 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1               1   976773121   488386560+  1 FAT12

#
# R1 (clean box)
#####
XTVFS_ALL_OS17.13.8Z6_XTVFS_MAIN_2_Int
@(#)XTVFS FORMAT 17.13.8Z6 PRODUCT Aug 31 2011 11:41:42
 
-sh-3.2# fdisk -lu

Disk /dev/sda: 500.1 GB, 500107862016 bytes
255 heads, 63 sectors/track, 60801 cylinders, total 976773168 sectors
Units = sectors of 1 * 512 = 512 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1              64   976751999   488375968   1 FAT12

#diff r1.5.bin r1.6.bin 
(not same)


#
# R2
#####
-sh-3.2# fdisk -lu

Disk /dev/sda: 500.1 GB, 500107862016 bytes
255 heads, 63 sectors/track, 60801 cylinders, total 976773168 sectors
Units = sectors of 1 * 512 = 512 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1              63   976768064   488384001   1 FAT12

#diff r2.5.bin r2.6.bin 
(same)

#
# For a problem case as below,
#   1) partition starts #01
#   2) #00 is valid but has some garbage
#   3) #06 has the copy of #00(partition table) 
#
# After all, if partition starts 63/64 then shouldn't be the problem whether
# #06 is corrupted or not as it's out of the fs. The main problem is that
# partition starts #01 in this case that failed to mount. 
#
# From looking at #05 and #06 for R1 and R2 case, there are two things: 
# 1) For R1, #05 and #06 is different. not sure that's because xtvfs don't supports
# copying #05 or some overwrites this.
# 2)

 xtvfs_read_super:XTVFS_Init stat = 0x8123
 xtvfs_fill_super:  xtvfs_read_super failed 
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionMount L:01163 > Failure in Storage Helper library.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionMount L:01163 > If no debug has been produced, recompile Storage Helper library in debug mode.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionMount L:01164 > ...Storage Helper library failed:  mount partition /dev/sda1 at mount point /mnt/nds/dev_5/part_0
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionMount L:01165 > error: 22: Undefined error
!ERROR -PDM          < ppdm_srv_fs_thread.c F:PDM_FS_DevMountAllPartitions L:01014 > failed mounting
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01238 > Failure in Storage Helper library.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01238 > If no debug has been produced, recompile Storage Helper library in debug mode.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01239 > Storage Helper library has reported:  failure to unmount partition /dev/sda1 (/mnt/nds/dev_5/part_0)
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01240 > error: 22: Undefined error
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01248 > Failure in Storage Helper library.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01248 > If no debug has been produced, recompile Storage Helper library in debug mode.
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01249 > Storage Helper library has reported:  failure to force unmount of partition /dev/sda1 (/mnt/nds/dev_5/part_0)
!ERROR -STORAGE_HELPER <M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01250 > error: 22: Undefined error
!ERROR -PDM          < ppdm_srv_fs_thread.c F:PDM_FS_ThreadDeviceStateAction L:03436 > failed mounting device


# debug libs. Thing is that tar files in the input_del are not right ones so
# should pull debug files from output_del as below. damm.  so replace the
# below and replace a lib with debug one.  (this is input_del where the build
# picks up the tars)
# vobs/FUSIONOS_INPUT_DEL_2/DEL_AMS_BCM_MIPS4K_LNUX_DARWIN_01/Tarball/nds-drv-ams-drx890-debug.tar.bz2

/home/NDS-UK/parkkt/cc/parkkt_BSKYB_GM_001/vobs/FUSIONOS_OUTPUT_DEL_2/KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian
drwxr-xr-x 5 parkkt ccusers 4096 Mar 28  2011 debug
drwxr-xr-x 5 parkkt ccusers 4096 Mar 28  2011 preprod
drwxr-xr-x 5 parkkt ccusers 4096 Mar 28  2011 prod

/home/NDS-UK/parkkt/cc/parkkt_BSKYB_GM_001/vobs/FUSIONOS_OUTPUT_DEL_2/KERN_AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/debug/debug/lib/xtvfs.ko


# This message means the garbage collection failure. It should not lead to any problems except that disc could be full while XTV thinks 
# that there is a free space.
# This could lead to a recording failure. I dont see connection between the garbage collection failure and no responding of STB.  
!ERROR  -MSM                 < T:VRM_SRV M:xtvfspc.c F:XTVFS_FreeRange L:2795 > XTVFS: 42-To-POSIX: " "XTVFS_FreeRange: ioctl 0x80047802 failed for handle = 267: errno = 14 (Bad address), " "XTVFS status = 1 !!!!!\n 
!ERROR  -MSM                 <  T:VRM_SRV M:msm_pfm.c F:PFM_GarbageCollect L:237 > XTVFS_FreeRange failed, s_str_file_gc_handle = 267,  xtvfsstatus = 1 
!WARN   -MSM_MDI             < T:VRM_SRV M:meta_sup.c F:MetaSupGc L:1571 > Milestone : con=0x26, GC startPkt=0_00000000, endPkt=0_0101f99d 
!ERROR  -MSM_MFS             < T:VRM_SRV M:mfs_gc.c F:MFSGC_ReportToPFM L:492 > PFM_GarbageCollect failed


#
/dev/sda1 on /mnt/nds/dev_5/part_0 type xtvfs (rw,nosuid)
-sh-3.2# ls -al /mnt/nds/dev_5/part_0
drwxrwxrwx    2 NDS_U2   NDS_MW          0 Jan  1 00:23 FSN_DATA
-rwxrwxrwx    1 NDS_U2   NDS_MW         17 Jan  1 00:01 PDM.UID
-rwxrwxrwx    1 NDS_U2   NDS_MW      32768 Jan  1 00:01 ROOT_DIR.CP0
drwxrwxrwx    1 NDS_U2   NDS_MW          0 Jan  1 00:29 S1


if [ -e /etc/load-nds-drivers.sh ]; then
insmod /lib/modules/2.6.18.8/mhxnvramfs.ko
insmod /lib/modules/2.6.18.8/xtvfs.ko

-sh-3.2# lsmod
xtvfs 2209792 0 - Live 0xc04c5000
mhxnvramfs 38800 1 - Live 0xc033a000
callisto_periph 241120 2 - Live 0xc03e6000
callisto_tuner 322640 0 - Live 0xc0394000
callisto 5871232 2 callisto_periph,callisto_tuner, Live 0xc0762000


<source>
// ../../XTVFS_CMA_Wrapper/src/xtvfs_imodule.c
module_init(xtvfs_init);

// ../../XTVFS_CMA_Wrapper/src/xtvfs_iinode.c
struct inode_operations xtvfs_inode_operations = {
        create:
            xtvfs_create,
        lookup:
            xtvfs_lookup,
        unlink:
            xtvfs_unlink,
        mkdir:
            xtvfs_mkdir,
        rmdir:
            xtvfs_rmdir,
        rename:
            xtvfs_rename,
#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,36)
        truncate:
		    xtvfs_truncate,
#else
        setattr:
		    xtvfs_setattr,
#endif
};

static int xtvfs_create(struct inode *pdir, struct dentry *pdentry,)
{
  InodeInit();
}


// ../../XTVFS_CMA_Wrapper/src/xtvfs_iinode.c                   inode->i_fop = &xtvfs_file_operations;
/* new file or directory inode initialisation */
static void InodeInit(
	struct inode *pdir,  	/* in, the parent directory inode */
	struct inode *inode, 	/* in, the file or directory inode */
	int ino, 			 	/* in, the file or directory inode number */
	DIR_OR_FILE dirOrFile	/* in, is it file or directory */
	)
{
#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,29)
		inode->i_uid = current->cred->fsuid;
		inode->i_gid = (pdir->i_mode & S_ISGID) ? pdir->i_gid : current->cred->fsgid;
#else
		inode->i_uid = current->fsuid;
		inode->i_gid = (pdir->i_mode & S_ISGID) ? pdir->i_gid : current->fsgid;
#endif
		inode->i_op = &`xtvfs_inode_operations`;
		inode->i_mapping->a_ops = &xtvfs_aops;
		inode->i_mode = S_IRWXUGO;		   /*all can all */
		if(dirOrFile == DIR){
			inode->i_mode |= S_IFDIR;
			inode->i_fop = &xtvfs_dir_operations;
		} else {
			inode->i_mode |= S_IFREG;	/* regular file */
			inode->i_fop = &`xtvfs_file_operations`;
			i_size_write(inode, 0);
		}
		insert_inode_hash(inode);
}


// ../../XTVFS_CMA_Wrapper/src/xtvfs_ifile.c
/* data file operations */
struct file_operations xtvfs_generic_file_operations = {
		read:
            xtvfs_generic_file_read,
        write:
            xtvfs_generic_file_write,
#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,19)
		/* for kernel version >= 2.6.19 generic_file_write/read are defined as do_sync_write/read, 
			which call asynchrous IO and wait its end. Because of this 
			aio_read/aio_write should be implemented. It opens possibility for user 
			to do async IO. Currently it is not used, so it is OK to have less debug output for it. */
        aio_read:
            generic_file_aio_read,
        aio_write:
            xtvfs_generic_file_aio_write,
#endif	
#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,36)
		ioctl:
#else
		unlocked_ioctl:
#endif
            xtvfs_ioctl,
        open:
            xtvfs_open,
        flush:
            xtvfs_flush,
        release:
            xtvfs_release,
        fsync:
            xtvfs_fsync,
		mmap:
			generic_file_mmap,
        llseek:
            xtvfs_data_seek_check
        };


int xtvfs_open (struct inode * pinode,  struct file* pfile )
/*!<
  \Description: 
	Opens a file and saves its handle in pfile->private_data.
  \Parameters: 
      \- pinode : in, file to open inode
      \- pfile	: in, file to open
  \Returns: 0 on success -error code on error
\*---------------------------------------------------------------------------*/ 
{
    if(FileIsStream(pdentry)) {
        mode = XFS_MODE_VFS;
		if(!(pfile->f_flags & O_TRUNC)){
			mode |= XFS_MODE_LOOPING;
		}
        pfile->f_op = &xtvfs_stream_file_operations;
    }
    else {
		if (!(pfile->f_flags & O_NOCTTY)) {
			pfile->f_op = &xtvfs_generic_file_operations;
		}
    }
}


static ssize_t xtvfs_generic_file_write(struct file *file, 
    const char __user *buf, size_t count, loff_t *ppos)
{
  size = generic_file_write(file, buf, count, ppos);
}


// // ../../posix/inc/pxtvfs.h ssize_t xtvfs_write(int fildes, const void *buf, size_t nbyte);
// // ../../XTVFS_CMA_Wrapper/src/xtvfs_ifile.c
// ssize_t xtvfs_write(struct file * pfile, const char * buf,  size_t count,loff_t * offset)
// {
//   m = XTVFS_Write(handle, lbuf, count, -1);
// }
// 
// 
// // xtvfs_api/src/xtvfs_file.c
// int XTVFS_Write(xtvfsFile handle,char *buffer,int numbytes,XTVFS_Trans trans_handle)
// {
// 	int		    bytesWritten;
//     XTVFSSTATUS status;
// 	
// 	ARGSUSED_INT((int)trans_handle)  ; 
// 	status = XTVFS_WriteEx(handle, buffer, numbytes, &bytesWritten);
// 	if(XTVFS_SUCCEED != status) {
// 		bytesWritten = -1;
// 	}
// 	return bytesWritten;
// }
// 
// // // Translate XTT042 API into Posix (Linux) system calls
// // // posix/src/pos_to_42.c
// // /*---------------------------------------------------------------------------*/
// // int  XTVFS_Write(					/* Writes a designated number of bytes to file. Returns actual number of written bytes */
// //     xtvfsFile	handle,			/* in, The file handle */
// //     char*		buffer,			/* in, data to be written into the file */
// //     int		numBytes,		/* in, number of bytes to be written into the file */
// //     XTVFS_Trans trans_handle	/* for future use. Set it to -1 */
// // )
// // {
// // 	int ret = 0, n;
// // 	size_t rest = (size_t)numBytes;
// // 	ReadErrorSet(0);
// // 	while(ret < rest) {
// // 		n = (int)write((int)handle, (const void *)buffer, rest);
// // 		if(n < 1)
// // 			break;
// // 		ret += n;
// // 		rest -= n;
// // 	}
// // 	return ret;
// // }


// /ertfs/src/api.c/
XTVFSSTATUS _po_write(PCFD fd, byte *buf, int count_to_write, int count_for_fsize, int *pnumWritten);


// XTVFS_CMA_Wrapper/src/xtvfs_ifile.c
int xtvfs_flush (struct file * pfile
#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,18)
				 ,  fl_owner_t id
#endif
)

// xtvfs_api/src/xtvfs_file.c
XTVFSSTATUS XTVFS_Flush(xtvfsFile handle)
{
	unsigned long FTIME_;
	XTVFSSTATUS   status = XTVFS_ERROR;
    int           ppartno;
    PC_FILE       *pfile = 0;	

	XDEBUG_DEFINE_FUNC(XTVFS_Flush);
	XDEBUG_APIENTER_1(0u, "handle=%d", handle); 
	
	/*Check XTVFS is initialized*/
	CHECK_XTVFS_INIT("XTVFS_Flush")
    /*-1 says flush all*/
	if(-1 == handle){
		/* Loop on all partitions and flush */
		for (ppartno=0; ppartno<MAX_NUM_PHYS_PARTS; ppartno++){
			if (IsUsedPpartno(ppartno)){
				In(ppartno);
				XDEBUG_LOW_REPORT_1(0u, "flush ppartno=%d", ppartno); 
				/* Flush the file to disk */
				status = po_flush_partition(ppartno);
				Out(ppartno,FNAME_,  FTIME_);
			}
		}
	}
    else if(handle >= 0){ /* Try to extract ppartno and PC_FILE from handle*/
		/*Get PC_FILE and check handle validity and related ppartno validity*/
		CHECK_PPART_NUMBER_BY_HANDLE(pfile,handle,0,ppartno,"XTVFS_Flush")
		In(ppartno)
		/* Flush the file to disk */
		status = po_flush(handle);
		Out(ppartno,FNAME_,  FTIME_);
	}
	else{
		XDBG_Printf(" XTVFS::XTVFS_Flush Wrong parameter handle = %d\n", handle);
        status = XTVFS_E_ARGUMENT;
	}
	XDEBUG_APIEXIT_1(0u,"status=0x%x",status); 
	set_errno(status);
	return status;
}

// fat/src/lowl.c
/* Consult the dirty fat block list and write any. write all copies
    of the fat */
/* Note: The caller locks the fat before calling this routine   */
int pc_pfflush(LPARTITION *plpart)
{
  ret = devio_write(ppartno,blockno,(byte *)pdata,8, FALSE);
}


={============================================================================
|kt_dev_si_0001| comp-xtvfs-tool

Usage: xtvfs_copy <option> <source> <target>

       <option> :
                  0 - XTVFS to XTVFS.
                  1 - XTVFS to other.
                  2 - other to XTVFS.
                  3 - other to other.

Usage example: /NDS/xtvfs_copy 1 /XTV/RASP/EXPECTED/2_1_5/STREAM.STR /mnt/nfs/Expected/2_1_5/stream.str

note: must set destination file name. only for stream files since can use cp
for normal text files.

-sh-3.2# /mnt/tmp/si_logs/xtvfs_copyb 1 /mnt/nds/dev_6/part_0/S2069/STREAM.STR /mnt/tmp/x.str


={============================================================================
|kt_dev_si_0001| comp-nvram

-sh-3.2# mount
/dev/nds/nvram0 on /mnt/nds/dev_2/part_0 type MHNVRAMFS (rw,nosuid)

-sh-3.2# pwd
/mnt/nds/dev_2/part_0
-sh-3.2# ls -al
-rwxrwxrwx    1 root     root          176 Jan  1  1970 99
-rwxrwxrwx    1 root     root            8 Jan  1  1970 dk
-rwxrwxrwx    1 root     root          696 Jan  1  1970 dt
-rwxrwxrwx    1 root     root         2999 Jan  1  1970 du
-rwxrwxrwx    1 root     root            0 Jan  1  1970 f0
-rwxrwxrwx    1 root     root           27 Jan  1  1970 fv
-rwxrwxrwx    1 root     root            0 Jan  1 00:00 lc
-rwxrwxrwx    1 root     root            0 Jan  1 00:00 le
-rwxrwxrwx    1 root     root         1257 Jan  1  1970 mp
-rwxrwxrwx    1 root     root         1018 Jan  1  1970 nv
-rwxrwxrwx    1 root     root            0 Jan  1  1970 sl

-sh-3.2# umount /dev/nds/nvram0
-sh-3.2# umount /dev/nds/nvram1

mount -t nfs 172.18.253.143:/home/NDS-UK/parkkt/fob/890/PClarkes /tmp/xx
cp /tmp/xx/paulclarke.nvram* .


# it's only required when dump out nvram out of a box
#


dd if=./paulclarke.nvram0.bin of=/dev/nds/nvram0
# -sh-3.2# dd if=./paulclarke.nvram0.bin of=/dev/nds/nvram0
# 46+0 records in
# 46+0 records out

dd if=./paulclarke.nvram1.bin of=/dev/nds/nvram1
# -sh-3.2# dd if=./paulclarke.nvram1.bin of=/dev/nds/nvram1
# 16+0 records in
# 16+0 records out


={============================================================================
|kt_dev_si_0001| comp-helper

http://shareatnds.nds.com/global/Fusion/Fusion-OS/FOSHelpers/default.aspx

http://ndpedia.nds.com/index.php/Storage_Helper

Component Lead: Sridhar Gaddam(sridharg@nds.com)
For any queries drop a mail to HELPERS_Support@nds.com 

# STORAGE_HELPER
# STB_SW/FUSIONOS/STORAGE_HELPER/src/storage_helper/src$
NDS: ^0946686085.188970 !ERROR -STORAGE_HELPER < p:00000077 t:01146180 T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01238 > Failure in Storage Helper library.
NDS: ^0946686085.189150 !ERROR -STORAGE_HELPER < p:00000077 t:01146180 T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01238 > If no debug has been produced, recompile Storage Helper library in debug mode.
NDS: ^0946686085.189279 !ERROR -STORAGE_HELPER < p:00000077 t:01146180 T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01239 > Storage Helper library has reported:  failure to unmount partition /dev/sda1 (/mnt/nds/dev_5/part_0)
NDS: ^0946686085.189416 !ERROR -STORAGE_HELPER < p:00000077 t:01146180 T:PDM_FS M:pdm_srv_fs_utility.c F:PDM_FS_PartitionUnmount L:01240 > error: 16: Undefined error


={============================================================================
|kt_dev_si_0001| comp-app

<technical-fault>
https://www.stb.bskyb.com/confluence/pages/viewpage.action?pageId=27099835

Text from Planner UI: Technical Fault - 8(19)

static final String commonTechnicalFaultPrefix = "Technical fault - ";

private static String tfErrorFor(int tfCode, int reason)
{
  return commonTechnicalFaultPrefix + tfCode + " (" + reason + ")";
}

private static String tf8ErrorFor(int reason)
{
  return tfErrorFor(8, reason);
}

case SystemCommonFailureType.RECORDED_CONTENT_MISSING:
  failureReason = tf8ErrorFor(reason);

// jpa/modules/jpa-api/src/java/com/nds/fusion/planner/PlannerBookingFailureType.java

int RECORDED_CONTENT_MISSING = 19; /* Robustness check identified recorded content missing from disk */
int INSUFFICIENT_DISK_SPACE = 11; /* Not enough disk space to record event */

<system-fault>
		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(NONE)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(false)
						.actions(BACKUP_IGNORE)));

		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_MODAL_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(BACKUP_TO_CANCEL)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(true)
						.actions(BACKUP_BACKUP)));

<screen-id>

egrep -an "screen seen to|Showing dialog"

NDS: ^[2016:10:03 09:55:44]0947123825.760899 !MIL    -EPG_SCR      		< p:0x00000238 P:APP t:0x2bfeb520 T:no name M:Screens F:`doOpenScreen` L:1103 > 
  T:CEE-J EventQueue Reader 0:SCREEN PURCHASE MULTI_FORMAT layer=4, `id=15` opened

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/common/screenmanager/IScreenType.java
public interface IScreenType
{
	int NONE                      = -1;
	int FULLSCREEN                = 0;
	int BANNER                    = 1;
	int GUIDE                     = 2;
	int HOMEPAGE                  = 3;
	int PLANNER                   = 4;
	int PLAYBACK                  = 5;
	int SERIES_LINK_SHOWINGS      = 6;
	int PLANNERPURCHASEFROMEPG    = 7;
	int PREFERENCES               = 8;
	int MANREC_ONLY               = 9;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =10;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =11;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =12;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =13;
	int DIALOG                    = 14;
	int PURCHASE_MULTIFORMAT      = 15;
	int SEARCH                    = 16;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =17;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =18;
	int BOXOFFICE                 = 19;
	int INTERACTIVE_BACKGROUND    = 20;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =21;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =22;
	int INTERACTIVE_APPLICATIONS  = 23;
	int BOOKMARK_SCREEN           = 24;
	int PROMO                     = 25;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =26;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =27;
	int OPTICAL_DELAY_SCREEN      = 28;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =29;
	int BANNER_CHILD_LISTINGS     = 30;
	int GUIDE_CHILD_LISTINGS      = 31;
	int ANYTIME                   = 32;
	int COPY                      = 33;
	int NO_TLM_MINITV             = 34;
	int WHATS_NEW                 = 35;
	int SPORTS                    = 36;
	int AIRINGS                   = 37;
	int MORE_LIKE_THIS            = 38;
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~ =39;
	int KIDS                      = 40;
	int BUY_AND_KEEP_`PREPURCHASE`  = 41;
	int BUY_AND_KEEP_POSTPURCHASE = 42;
	int BUY_AND_KEEP_`PURCHASE`     = 43;
	int MLT_SHOWINGS              = 44;
	int WL_SHOWINGS               = 45;
	int DOWNLOAD_ALL              = 46;
	int BUY_AND_KEEP_OFFLINE      = 47;
	int SERVICES                  = 48;
	int HELP                      = 49;


	// This is used by SynopsisDataFactory - it creates an array of max screens
	// So update this if more screens are added
	int MAX_SCREENS = 50;
}


<screen-change>
!MIL    -EPG_MISC     		< M:`MilestoneNotifier` F:send L:21 > 
  T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/guide"}


<dialog-1030> <live-pause>
int LIVE_PAUSE_NOT_AVAILABLE_ID                                          = 1030;

!MIL   -EPG_DLG      < M:DialogManager F:showDialog L:01400 > T:CEE-J EventQueue Reader 0:Showing dialog 1030
!ERROR -EPG_DEV1     < M:NotificationConverter F:setLastScreenSeen L:00011 > T:CEE-J EventQueue Reader 0:setting last screen seen to /tv/live/503/live_pause_not_available_id
!MIL   -EPG_MISC     < M:`MilestoneNotifier` F:send L:00021 > T:CEE-J EventQueue Reader 0:
  Screen changed to:/tv/live/503/live_pause_not_available_id


int LIVE_PAUSE_NOT_AVAILABLE_INSUFFICIENT_DISK_SPACE_ID                  = 1302;

!MIL    -EPG_DLG      		< M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1302
!ERROR  -EPG_DEV1     		< M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:
  setting last screen seen to /tv/live/410/live_pause_not_available_insufficient_disk_space_id


<dialog-id>
// Dialog IDs are listed in IDialogID.java. The other important file is
// DialogConfig.java. This maps the dialog ids to the text that's displayed.

./picasso/dialogmgr/dialogs/config/DialogConfig.java
THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/common/dialogmgr/IDialogID.java


int AUTO_STANDBY_ID                                       = 1162;
	int START_AGAIN_MINI_BANNER                                          = 1213;
   int DISK_FAIL_SYSTEM_FAULT_ID                             = 1299;
   int ECO_STANDBY_EXIT                                      = 1312;
   int NO_PROGRAMMES_OF_THIS_TYPE_ID                         = 1555;
   int	LIVE_PAUSE_NOT_AVAILABLE_INSUFFICIENT_DISK_SPACE_ID   = 1302;
   int	REMINDER_ALERT_WITHOUT_RECORD_ID                      = 1234;
   int	SHARED_PLANNER_INGEST_ERROR_SH20_SPN11                = 1324;

	int BOX_INITIALISING_NON_MODAL_ID                                    = 1236;
   int SEARCHING_FOR_LISTINGS_ID                             = 1112;
   int NO_OTHER_CHANNELS_ID                                  = 1115;

	int PDL_ASSET_AVAILABLE_ID                                           = 1172;
	int END_OF_DOWNLOAD_BUFFER_ID                                        = 1089;

	int `BUY_AND_KEEP_PURCHASE_CONFIRMATION_NON_MODAL`                     = 1475;

<dialog-1477>
  // End of programme
  // For next episode press <green> or <backup> to return
	int END_OF_RECORDING_WITH_WATCH_NEXT                                 = 1477;
		register(dialog(IDialogID.END_OF_RECORDING_WITH_WATCH_NEXT).with(textContent().instruction(GREEN_FOR_WATCH_NEXT_OR_BACKUP_TO_RETURN)
				.textStrings("End of programme")

<dialog-1009>
	int END_OF_RECORDING_ID                                              = 1009;
		register(dialog(IDialogID.END_OF_RECORDING_ID).with(textContent().instruction(BACKUP_TO_RETURN)
				.textStrings("End of programme")
<dialog-1020>
		register(dialog(IDialogID.HDCP_NOT_SUPPORTED_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.FYI)
						.textStrings("This display does not support HDCP\nGo to skyviewinghelp.com for further information\nPlease disconnect your HDMI connection")
						.instruction(BACKUP_TO_CANCEL))
				.with(behaviour().primaryPriority(IPrimaryPriority.SYSTEM)
						.secondaryPriority(ISecondaryPriority.SYSTEM)
						.flags(DISPLAY_IN_PIG | MODAL | PERSISTENT | HIDE_VIDEO)
						.actions(BACKUP_BACKUP)
						.screenLayer(IScreenLayer.TV_DIALOG)));

<dialog-1034>
	int PIN_PROTECTED_WITH_RESET_PIN                                     = 1034;

<dialog-1235>
	int RECORD_PLAYBACK_NOT_AVAILABLE_ID                                 = 1235;

		register(dialog(IDialogID.RECORD_PLAYBACK_NOT_AVAILABLE_ID).type(DialogType.FYI)
						.textStrings("Sky+HD playback and recording are unavailable\nPlease go to sky.com/help"))

<dialog-1042>
	int NOSKYPLUS_3                                                      = 1042;
		register(dialog(IDialogID.NOSKYPLUS_3).with(textContent().instruction(BACKUP_TO_CANCEL)
				.textStrings("Sky+ playback and recording are not available\nGo to skyviewinghelp.com for assistance"))

NOSKYPLUS_3       178
THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/banner/BannerBookingAgentListener.java
  showDialog(IDialogID.NOSKYPLUS_3);

				case NO_SKY_PLUS_SUBSCRIBER:
					showDialog(IDialogID.NOSKYPLUS_3);
					break;

<dialog-1306>
	int RECORDING_INTERRUPTED_BY_SIGNAL_ID                               = 1306;

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/dialogmgr/dialogs/config/DialogConfig.java
						.textStrings("Recording interrupted by loss of signal"))

<1219>
	int LAUNCHING_INTERACTIVE_APP                                        = 1219;

		register(dialog(IDialogID.LAUNCHING_INTERACTIVE_APP).with(textContent().title(DialogTitle.LOADING)
				.instruction(NONE)
				.textStrings("%s"))
				.with(behaviour().modal(true)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.flags(HIDE_TVVM_COMPONENTS     // to hide S&S Banner when launching PIN Reset app
								| HIDE_VIDEO)           // try to avoid flash of video
						.actions(BACKUP_BACKUP)));

<dialog-1249>
   int	TECHNICAL_FAULT_ON_SERVICE_ID                         = 1249;

		register(dialog(IDialogID.TECHNICAL_FAULT_ON_SERVICE_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.FYI)
						.textStrings("There is a technical fault with this channel\nPlease try later")
						.altString("There is a technical fault\nwith this channel\nPlease try later")
						.instruction(NONE))
				.with(behaviour().primaryPriority(IPrimaryPriority.SYSTEM)
						.secondaryPriority(ISecondaryPriority.SYSTEM)
						.flags(DISPLAY_IN_PIG | PERSISTENT | HIDE_VIDEO)
						.actions(BACKUP_IGNORE)
						.screenLayer(IScreenLayer.TV_DIALOG)));

<1417>
	int UNCONNECTED_CATCHUP_ID                                           = 1417;

<1125>
	int DISKSPACE_IMMINENT_DISK_ID                                       = 1125;

<1124>
	int DISKSPACE_BOOKING_DISK_FAIL_ID                                   = 1124;

<1183>
	int DELETE_KEEP_CONFIRM_ID                                           = 1183;

		register(dialog(IDialogID.DELETE_KEEP_CONFIRM_ID).type(DialogType.PROGRAMME_INFO)
				.with(textContent().instruction(SELECT_OR_BACKUP)
						.textStrings("To delete this programme"))
				.with(behaviour().screenLayer(IScreenLayer.MENU_DIALOG)
						.modal(true)
						.actions(BACKUP_DISPEL,
								new KeyAndAction(IKeyCode.SELECT,
										IActionCodes.CONFIRMED_DELETE_PROGRAMME))));

<dialog-1357>
	int ONLINE_SEARCH_NETWORK_FAILURE                                    = 1357;
   setting last screen seen to /homepage/homepage_online_search_network_error

<id-1380> <id-1465>
	int WEB_RESULTS_NO_MATCHES_MODAL                                     = 1380;
	int WEB_RESULTS_NETWORK_PROBLEM_NON_MODAL_BACKUP_TO_RETURN           = 1464;
	int WEB_RESULTS_NETWORK_PROBLEM_MODAL_BACKUP_TO_RETURN               = 1465;

<dialog-1256>
	int PDL_NO_CONNECTIVITY_ID                                           = 1256;

    register(dialog(IDialogID.PDL_NO_CONNECTIVITY_ID).with(textContent().instruction(SELECT_TO_SETUP_IN_SETTINGS_SCREEN_OR_BACKUP_TO_CANCEL)
                    .reference(51)
                    .textStrings("To explore the best of on demand, simply connect your box to broadband, \n" +
                                    "go to sky.com/connect to find out how or sky.com/fixondemand for help"))

<1294>
	int OPPV_PVOD_UNAVAILABLE_ID                                         = 1294;

		register(dialog(IDialogID.OPPV_PVOD_UNAVAILABLE_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.FYI)
						.instruction(BACKUP_TO_CANCEL)
						.textStrings("This programme is currently unavailable\nPlease try later"))
				.with(behaviour().modal(true)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.actions(BACKUP_DISPEL)
						.timeoutInMinutes(10)));
<1344>
!MIL    -EPG_DLG      		< p:0x000001e2 P:APP t:0x2bf25520 T:no name M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1344
!ERROR  -EPG_DEV1     		< p:0x000001e2 P:APP t:0x2bf25520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /preferences/network_connection_successful

<not-initializing>
	int NOT_ENOUGH_GUIDE_CACHE_FOR_BOOKING                               = 1393;

   THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/dialogmgr/dialogs/config/DialogConfig.java

	public static final String `BOX_INITIALISING_RETURN_LATER` = "Your box is still initialising, please return in a short time to use this feature";

		register(dialog(`IDialogID.NOT_ENOUGH_GUIDE_CACHE_FOR_BOOKING`).type(DialogType.FYI)
				.with(textContent().instruction(BACKUP_TO_CANCEL)
						.textStrings(`BOX_INITIALISING_RETURN_LATER`))
				.with(behaviour().screenLayer(IScreenLayer.MENU_DIALOG)
						.modal(true)
						.actions(new KeyAndAction(IKeyCode.BACKUP,
								IActionCodes.DIALOG_DISPEL))));

!MIL    -EPG_NET      		< P:APP M:HttpNotifier F:send L:31 > d3=508288677&cd4=off&cd5=off&de=UTF-8&t=event&cd=%2Fsearch&ec=WebItemEvent&el=BOOK_REMINDER%3Btitle%3DPeppa+Pig+S4+ep18%3Bmid%3D305175&ea=select
!WARN   -SQ13         		< P:MW  M:sim_dbc_sched_query.c F:SIM_DBC_QUERY_GetProgrammeInstanceByXsiLocator L:648 > SIM_DBC_UTIL_GetProgInstObjectFromQuery()=NOT FOUND by XSI locator: ""INSTKEY=1178"" ""SVCK2=0x10F4"" ""CNID=0x0020 
!ERROR  -SQ08         		< P:MW  M:sim_dbc_merged_query.c F:SIM_DBC_MERGED_QUERY_GetProgrammeInstanceByXsiLocator L:2412 > SIM_dbc_merged_query_ProcessAndMergeRetrievedPI() FAILED 
!WARN   -SQ35         		< P:MW  M:sim_sc_si.c F:SIM_sc_si_LocateProgrammeInstanceObject L:1236 > Failed to get program instance object from DB. status = ""0x00010002 
!ERROR  -SQ35         		< P:MW  M:sim_sc_si.c F:SIM_SC_SI_RetrieveLocatedObject L:4502 > Failed to retrieve located object from cache." "STATUS=0x00010002 
!WARN   -G_Sess       		< P:APP M:guide_api_programmeinstance.c F:GuideProgrammeInstanceRetrievalHandler L:2972 > SIM completion FAILED 
!WARN   -G_Sess       		< P:APP M:guide_api_common.c F:MessageThread L:1013 > GuideProgrammeInstanceRetrievalHandler() FAILED 
!ERROR  -EPG_MISC     		< P:APP M:SystemListenerLatch F:doNotify L:87 > T:threadtracker:MW notified failure
!MIL    -EPG_BOOK     		< P:APP M:BookingManager F:createScheduledWebBookingAgent L:751 > T:CEE-J EventQueue Reader 0:Creating limited booking agent without gpi
!MIL    -EPG_MISC     		< P:APP M:ScheduledWebItemActions F:getTemplate L:113 > T:CEE-J EventQueue Reader 0:### SearchActionTemplate<WebItem, ScheduledWebBookingControl> getTemplate() - established > aGF@5985bc3
!MIL    -EPG_UI       		< P:APP M:ScreenDirectingKeyListener F:dispatchKeyToViewOf L:57 > T:CEE-J EventQueue Reader 0:KEYPRESS 1:SELECT x1 @946927538990-946927541913 handled by Screen SEARCH layer=4, id=16 View 393298
!MIL    -EPG_KEY      		< P:APP M:KeyProcessor F:keyReleased L:316 > T:CEE-J EventQueue Reader 0:Keycode is 1:RELEASED x1 @946927541913-946927542231 for 1:SELECT x1 @946927541913-946927542231
!MIL    -EPG_INIT     		< P:APP M:PowerOperatingModes F:possiblyDelayPowerOperatingModeKeys L:158 > T:CEE-J EventQueue Reader 0:Executing delayed action
!MIL    -EPG_INIT     		< P:APP M:PowerOperatingModes$Action$1 F:execute L:107 > T:CEE-J EventQueue Reader 0:executing empty action)
!MIL    -EPG_UI       		< P:APP M:ScreenDirectingKeyListener F:dispatchKeyToViewOf L:57 > T:CEE-J EventQueue Reader 0:KEYPRESS 1:RELEASED x1 @946927541913-946927542231 handled by Screen FULLSCREEN layer=0, id=0 View 458756
!MIL    -EPG_BOOK     		< P:APP M:WebScheduledBookingAgent F:doAddBooking L:35 > T:PooledExecutor#1:Booking rejected
!MIL    -EPG_MISC     		< P:APP M:ScheduledWebItemActions F:getTemplate L:113 > T:CEE-J EventQueue Reader 0:### SearchActionTemplate<WebItem, ScheduledWebBookingControl> getTemplate() - established > aGF@5985bc3
!MIL    -EPG_KEY      		< P:APP M:Activity F:finish L:63 > T:CEE-J EventQueue Reader 0:finish activity (aGu@5968718)
!MIL    -EPG_KEY      		< P:APP M:QueueingInputEventFilterAgent F:removeFilter L:81 > T:CEE-J EventQueue Reader 0:Clearing filter for activity (aGu@5968718).
!MIL    -EPG_KEY      		< P:APP M:KeyEventValve F:open L:186 > T:CEE-J EventQueue Reader 0:KeyEventValve has opened for (aGu@5968718), all activities have been completed []
!MIL    -EPG_BOOK     		< P:APP M:BookingAgent F:dispose L:474 > T:CEE-J EventQueue Reader 0:dispose - in
!MIL    -EPG_BOOK     		< P:APP M:BookingAgent F:dispose L:483 > T:CEE-J EventQueue Reader 0:dispose - out
!MIL    -EPG_KEY      		< P:APP M:ActivityFinishedListener$1 F:activityFinished L:14 > T:CEE-J EventQueue Reader 0:ActivityFinishedListener.activityFinished - NO CLIENT
!MIL    -EPG_DLG      		< P:APP M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog `1393`
!MIL    -EPG_DLG      		< P:APP M:DialogVisibilityDecorator$OnAwtBehaviour$1 F:run L:183 > T:CEE-J EventQueue Reader 0:Dialog visibility decorator behavior invokation. Behavior: OH@59d3598, dialog visibility: true, view: [RC@59cd362 viewId:196618 controller:OF@59ecb30 concreteView:aYp@5a8c656[id=-1,x=902,y=81,w=316,h=178] scrId:16 vwId:196618]
!ERROR  -EPG_DEV1     		< P:APP M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /search/not_enough_guide_cache_for_booking


<not-initializing-others>

!MIL    -EPG_DLG      		< M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1393
!MIL    -EPG_DLG      		< M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1377

   public static final String 
   BOX_INITIALISING_RETURN_LATER = "Your box is still initialising, please
   return in a short time to use this feature";

	int BOX_INITIALISING                                                 = *1377*

		register(dialog(IDialogID.BOX_INITIALISING)
				.type(DialogType.FYI)
				.with(textContent().instruction(NONE)
						.textStrings(BOX_INITIALISING_RETURN_LATER))
				.with(behaviour().screenLayer(IScreenLayer.MENU_DIALOG)
						.modal(false)
						.actions(BACKUP_IGNORE)));

	int HD_BOX_EXITING_STANDBY_ID                                        = 1391;

		register(dialog(IDialogID.HD_BOX_EXITING_STANDBY_ID).type(DialogType.FYI)
				.with(textContent().instruction(NONE)
						.textStrings(BOX_INITIALISING_RETURN_LATER))
				.with(behaviour().primaryPriority(IPrimaryPriority.SYSTEM)
						.secondaryPriority(ISecondaryPriority.SYSTEM)
						.actions(BACKUP_IGNORE)
						.flags(DISPLAY_IN_PIG | PERSISTENT)
						.screenLayer(IScreenLayer.TV_DIALOG)
						.modal(false)));

	int LIVE_PAUSE_NOT_AVAILABLE_NOT_IN_PVR_MODE                         = 1311;

		register(dialog(IDialogID.LIVE_PAUSE_NOT_AVAILABLE_NOT_IN_PVR_MODE).with(textContent().instruction(BACKUP_TO_CANCEL)
				.textStrings(BOX_INITIALISING_RETURN_LATER))
				.with(behaviour().modal(true)

						.actions(BACKUP_DISPEL)
						.screenLayer(IScreenLayer.MENU_DIALOG)));

<app-banner>
/picasso/ui/epg15/zapper/widget/composite/BannerWidget.java

	private static final String SEARCHING_FOR_LISTINGS = "Searching For Listings";

!MIL    -EPG_BAN      		< M:TimeoutHandler$1 F:perform L:86 > T:CEE-J EventQueue Reader 0:Banner timeout, visibleComponent=NO_VISIBLE_COMPONENT
!MIL    -EPG_BAN      		< M:BannerData F:setChannelLocked L:355 > T:PooledExecutor#0:setChannelLocked > false


<recording-not-available> <diskless>
	int DISK_FAIL_SYSTEM_FAULT_ID                                        = 1299;
	int DISK_FAIL_SYSTEM_FAULT_MODAL_ID                                  = 1300;

		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(NONE)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(false)
						.actions(BACKUP_IGNORE)));

		register(dialog(IDialogID.DISK_FAIL_SYSTEM_FAULT_MODAL_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.SYSTEM_FAULT)
						.instruction(BACKUP_TO_CANCEL)
						.textStrings("There is an issue with your Sky+HD box, so recording and playback are unavailable.\nFor help resolving this issue, please go to sky.com/record"))
				.with(behaviour().primaryPriority(IPrimaryPriority.CA_EXCEPTION)
						.secondaryPriority(ISecondaryPriority.CA_EXCEPTION_VIEWING_CARD)
						.screenLayer(IScreenLayer.MENU_DIALOG)
						.flags(SHOW_DISK_FAULT_REFERENCE)
						.modal(true)
						.actions(BACKUP_BACKUP)));


<no-satellite-signal>
	int NO_SATELLITE_SIGNAL_ID                                           = 1000;

		register(dialog(IDialogID.NO_SATELLITE_SIGNAL_ID).type(DialogType.FYI)
				.with(textContent().title(DialogTitle.FYI)
						.instruction(GOTO_SKY_NOSIGNAL)
						.textStrings(
								"Your Sky+HD box isn't getting a satellite signal.\nYour recordings in the Planner and the On Demand service may still be " +
										"available.")
						.digiboxTextStrings("Your SkyHD box isn't receiving a satellite signal.")
						.altString("Mini TV Unavailable\nNo Satellite Signal"))
				.with(behaviour().primaryPriority(IPrimaryPriority.SYSTEM)
						.secondaryPriority(ISecondaryPriority.SYSTEM)
						.flags(DISPLAY_IN_PIG | PERSISTENT | HIDE_VIDEO)
						.actions(BACKUP_IGNORE)
						.screenLayer(IScreenLayer.TV_DIALOG)));

<dialog-1371>
!MIL    -EPG_DLG      		< p:0x00000203 P:APP t:0x2c12f520 T:no name M:DialogManager F:showDialog L:1407 > T:CEE-J EventQueue Reader 0:Showing dialog 1371
!ERROR  -EPG_DEV1     		< p:0x00000203 P:APP t:0x2c12f520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /planner/empty_text_generic_error_id
!MIL    -EPG_MISC     		< p:0x00000203 P:APP t:0x2c12f520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/planner/empty_text_generic_error_id"}
!ERROR  -EPG_DEV1     		< p:0x00000203 P:APP t:0x2c242520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:Analytics#0:setting last screen seen to /planner/empty_text_generic_error_id

		register(dialog(IDialogID.EMPTY_TEXT_GENERIC_ERROR_ID).with(textContent().title(DialogTitle.THERE_HAS_BEEN_A_PROBLEM)
				.instruction(BACKUP_TO_RETURN)
				.textStrings("%s"))
				.with(behaviour().screenLayer(IScreenLayer.MENU_DIALOG)
						.primaryPriority(IPrimaryPriority.OTHER)
						.secondaryPriority(ISecondaryPriority.OTHER_HIGH_PRIORITY)
						.actions(BACKUP_BACKUP)
						.modal(true)));

note:
need to gerp on ID.

NO_SATELLITE_SIGNAL_ID  164 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/SatelliteSignalController.java                  dialogManager.removeDialog(IDialogID.NO_SATELLITE_SIGNAL_ID);
NO_SATELLITE_SIGNAL_ID  178 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/SatelliteSignalController.java                  dialogId = IDialogID.NO_SATELLITE_SIGNAL_ID;
NO_SATELLITE_SIGNAL_ID  324 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/SatelliteSignalController.java          
if (dialogManager.isDialogCreated(IDialogID.NO_SATELLITE_SIGNAL_ID))
NO_SATELLITE_SIGNAL_ID  328 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/SatelliteSignalController.java
  dialogManager.removeDialog(IDialogID.NO_SATELLITE_SIGNAL_ID);

RECORD_PLAYBACK_NOT_AVAILABLE_ID 1188 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/banner/BannerController.java                                   bookingAgentListener.showDialog(RECORD_PLAYBACK_NOT_AVAILABLE_ID);
RECORD_PLAYBACK_NOT_AVAILABLE_ID  898 THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/model/BannerActions.java                                       actionHandler.showDialog(IDialogID.RECORD_PLAYBACK_NOT_AVAILABLE_ID);

THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvviewingmgr/fullscreen/SatelliteSignalController.java

	public void doSignal(SatSignalCondition satSignalCondition, TechnicalFaultCondition technicalFaultCondition, PlayingStatus contentType)
	{
		logger.logMilestone("doSignal: " + satSignalCondition.details() + technicalFaultCondition.details());

		// Show the NSS dialog - regardless of the playback type - if the grace period has expired.
		// We check both that we haven't signal and aren't in grace as sometimes when coming out of standby after boot the first
		// tune can be delayed and the removal of a tech-fault can happen when we are not "in grace" but do have signal
		// See PICASSODEV-14245
		if (!satSignalCondition.hasSignal() || !mediaEngine.isSignalInGrace())
		{
			logger.logMilestone("#NSS# no signal or not in grace");
			showDialogNoSatelliteSignalOrTechnicalFaultIfAllowed(satSignalCondition, technicalFaultCondition, contentType);
		}
		else if (technicalFaultCondition.hasTechnicalFault())
		{
			showDialogNoSatelliteSignalOrTechnicalFaultIfAllowed(satSignalCondition, technicalFaultCondition, contentType);
		}
		else
		{
			removeNoSatelliteSignalDialog();
			doSignalGained();
		}
	}

	/**
	 * TODO we should pass in grace period as a boolean
	 * 
	 * Handle showing or hiding the NoSignal based on satSignalConditions and content type
	 */
	public void handleShowOrHideNoSignalDialogs(SatSignalCondition satSignalCondition, TechnicalFaultCondition technicalFaultCondition, PlayingStatus contentType)
	{
		boolean signalInGrace = mediaEngine.isSignalInGrace();

		if (signalInGrace && satSignalCondition != null)
		{
			if (satSignalCondition.hasSignal() || !canContentTypeDisplayNoSatelliteSignalDialog(contentType))
			{
				removeNoSatelliteSignalDialog();
			}

			if (!technicalFaultCondition.hasTechnicalFault())
			{
				removeTechnicalFaultDialog();
			}

			if ((!satSignalCondition.hasSignal() || technicalFaultCondition.hasTechnicalFault()))
			{
				showDialogNoSatelliteSignalOrTechnicalFaultIfAllowed(satSignalCondition, technicalFaultCondition, contentType);
			}
		}
	}


<rmf-conflict-dialog>

	int CURRENT_VIEWING_CONFLICT_ID                                          = 1004;

!MIL    -EPG_DLG      < M:DialogManager F:showDialog L:1400 > 
  T:CEE-J EventQueue Reader 0:Showing dialog 1004

<app-affirm>
!ERROR  -EPG_BOOK     		< P:APP M:BookingManager F:purchase L:956 > T:CEE-J EventQueue Reader 0:`Affirm` should not be null: Pbp = null listener = FU@5a4fc4c
!  /!\  -EPG_AFRM     		< p:0x00000238 P:APP t:0x2bfeb520 T:no name M:BookingManager F:purchase L:958 > T:CEE-J EventQueue Reader 0:AFFIRM!!!  
!  /!\  -EPG_AFRM     		< p:0x00000238 P:APP t:0x2bfeb520 T:no name M:BookingManager F:purchase L:958 > java.lang.Throwable


<app-grid-guide-update>
To understand the MW interaction for TV Guide schedule, see GuideSchedule.java
and GuideScheduleListener.java

note: do not see these logs when enters guide screen. seems it does this
sometime and do use cache?

First page of All Channels tab in TV guide is `cached`: loaded when you close
the TV Guide screen and updated when the schedule changes / time passes.  So
you will not see any schedule retrieval when you first open the TV Guide grid.

From GuideSchedule.java:

    /** Indicates all rows in the window of a schedule object */
    int ALL_ROWS = 0xFFFFFFFF;                                // -1

    /** Indicates schedule service data is available */
    int SERVICE_DATA_AVAILABLE = 0xFFFFFFFE;    // -2


Page down to next page of channels:

!MIL   -EPG_UI       M:ScreenDirectingKeyListener F:dispatchKeyToViewOf L:00057 > T:CEE-J EventQueue Reader 0:KEYPRESS 1:CHANNEL_DOWN x1 @946686455797-946686458411 handled by Screen GUIDE layer=4, id=2 View 393222 

// Service data available
!MIL   -EPG_TVG      T:GUIDE_CALLBACK M:ScheduleListener F:onScheduleUpdate L:00105 > T:threadtracker:SI-9834 :: 
  onScheduleUpdate - status 62914560 readyRowIndex `-2` 

// One row at a time arrives at EPG
MIL   -EPG_TVG       T:GUIDE_CALLBACK M:ScheduleListener F:onScheduleUpdate L:00105 > T:threadtracker:SI-9834 :: 
  onScheduleUpdate - status 62914561 readyRowIndex 0 
  onScheduleUpdate - status 62914561 readyRowIndex 1 
  ...
  onScheduleUpdate - status 62914561 readyRowIndex 7
  onScheduleUpdate - status 62914561 readyRowIndex `-1`


// All rows retrieved
!MIL   -EPG_TVG      T:GUIDE_CALLBACK M:ScheduleListener F:onScheduleUpdate L:00105 > T:threadtracker:SI-9834 :: onScheduleUpdate - status 62914560 readyRowIndex -1

!MIL   -EPG_TVG      M:ProgrammesRetriever F:retrieveProgrammes L:00067 > T:PooledExecutor#1:SI-9834 :: retrieveProgrammes

// 2 programmes on first row / channel
!MIL   -EPG_TVG      M:ProgrammesRetriever F:addProgrammesFromSchedule L:00287 > T:PooledExecutor#1:SI-9834 :: addProgrammesFromSchedule - programmesCount 2
!MIL   -EPG_TVG      M:ProgrammesRetriever F:createProgrammesList L:00307 > T:PooledExecutor#1:SI-9834 :: createProgrammesList 

// Details of each programme
!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:307 > T:PooledExecutor#3:SI-9834 :: createProgrammesList
!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:00326 > T:PooledExecutor#1:Guide Programme 0 Title: Tipping Point Start Time 1475748000 Duration 3600
!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:00326 > T:PooledExecutor#1:Guide Programme 0 Title: Tipping Point Start Time 1475751600 Duration 3600 

!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:307 > T:PooledExecutor#3:SI-9834 :: createProgrammesList
!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:326 > T:PooledExecutor#3:Guide Programme 7 Title: House Start Time [2016:09:30 17:00:00]1475254800 Duration 3600
!MIL    -EPG_TVG     M:ProgrammesRetriever F:createProgrammesList L:326 > T:PooledExecutor#3:Guide Programme 7 Title: Without A Trace Start Time [2016:09:30 18:00:00]1475258400 Duration 3600

!MIL    -EPG_TVG     M:GuideUIData F:logUpdateType L:241 > T:CEE-J EventQueue Reader 0:PICASSODev-16173: updateType=0x214
!MIL    -EPG_TVG     M:GuideGridController F:gridUpdateFinished L:1092 > T:CEE-J EventQueue Reader 0:gridUpdateFinished

!MIL    -EPG_TVG     M:GuideGridController F:setGridUpdateInProgress L:1086 > T:CEE-J EventQueue Reader 0:gridUpdateInProgress
!MIL    -EPG_KEY     M:Activity F:start L:45 > T:CEE-J EventQueue Reader 0:start activity (NamedActivity(GUIDE_GRID_UPDATE)@59b54c5)
!MIL    -EPG_KEY     M:KeyEventValve F:activate L:145 > T:CEE-J EventQueue Reader 0:Added NamedActivity(GUIDE_GRID_UPDATE)@59b54c5 to live activities
!MIL    -EPG_TVG     M:GuideGridController F:onServicesListUpdated L:1223 > T:CEE-J EventQueue Reader 0:onServicesListUpdated with 98 services


<no-listing>
NDS: ^0946685333.172412 !MIL   -EPG_TVVM     < p:000000e1 t:2e326520 T:no name M:BouquetChangeMonitor F:changeStarted L:00016 > T:PooledExecutor#4:Starting bouquet change 
NDS: ^0946685338.812387 !MIL   -EPG_TVVM     < p:000000e1 t:2e326520 T:no name M:BouquetChangeMonitor F:changeComplete L:00021 > T:PooledExecutor#4:Bouquet change complete 

You will probably see many more "Bouquet change complete" than "Starting
bouquet change" so suggest you look for either of these occurring close to
when the no listing available is displayed.

Bouquet changes happen a lot.

By the way, if the message in the TV Guide grid is "..no listings available"
then you will probably see `one of` the following errors in the log (don't know
if/how these relate to bouquet change):

LOGGER.logMilestone("SI-9834 :: addProgrammesFromSchedule - programmesCount 0"
LOGGER.logError("Attribute not yet retrieved from guide! ", e);
LOGGER.logError("Middleware has told us that schedule data is NOT available for row "
LOGGER.logError("GuideRuntimeException caught " + ex);

So if you see a lot of any of these messages it may help identify the cause.

Dave.

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/tvguidemgr/model/ProgrammesRetriever.java

  public static final  String NO_PROGRAMME_DATA  = "..no listings available";

  programmeDataArrayList.add(model.createFillProgramme(NO_PROGRAMME_DATA, relativeRowIndex));

!ERROR  -EPG_TVG      		< p:0x000001d7 P:APP t:0x2dfd6520 T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
!ERROR  -EPG_TVG      		< p:0x000001d7 P:APP t:0x2dfd6520 T:no name M:ProgrammesRetriever F:updateRow L:211 > T:PooledExecutor#4:Middleware has told us that schedule data is NOT available for row 29

// indicate not to update schedule
!MIL    -EPG_TVG                     < p:0x000001d7 P:APP t:0x014de520 T:GUIDE_CALLBACK M:ScheduleListener F:notifySuccess L:71 > T:threadtracker:Ignoring schedule update notifications whilst in standy or shutdown


<case-log>
198941: !MIL    -EPG_TVG                            < T:GUIDE_CALLBACK M:ScheduleListener F:onScheduleUpdate L:105 > T:threadtracker:SI-9834 :: onScheduleUpdate - status 62914564 readyRowIndex -1
198943: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
198967: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
198984: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
199001: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
199018: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateAllRows L:177 > T:PooledExecutor#4:Attribute not yet retrieved from guide! 
199035: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateRow L:211 > T:PooledExecutor#4:Middleware has told us that schedule data is NOT available for row 29
199036: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateRow L:211 > T:PooledExecutor#4:Middleware has told us that schedule data is NOT available for row 30
199037: !ERROR  -EPG_TVG                        < T:no name M:ProgrammesRetriever F:updateRow L:211 > T:PooledExecutor#4:Middleware has told us that schedule data is NOT available for row 31
199040: !MIL    -EPG_TVG                            < T:GUIDE_CALLBACK M:ScheduleListener F:onScheduleUpdate L:105 > T:threadtracker:SI-9834 :: onScheduleUpdate - status 62914560 readyRowIndex -2
199042: !MIL    -EPG_TVG                            < T:no name M:GuideGridController F:gridUpdateFinished L:1092 > T:CEE-J EventQueue Reader 0:gridUpdateFinished
199121: !MIL    -EPG_TVVM                         < T:no name M:BouquetChangeMonitor F:changeComplete L:21 > T:PooledExecutor#0:Bouquet change complete


={============================================================================
|kt_dev_si_0001| comp-app-affirm-runner

https://www.stb.bskyb.com/confluence/pages/viewpage.action?spaceKey=epgdevelopment&title=Affirm+Report+Parser


={============================================================================
|kt_dev_si_0001| comp-app-analytics

https://www.stb.bskyb.com/confluence/display/STB/Google+Analytics

build/applications/Picasso/picasso/Picasso/build.gradle:255:        // Required to get screen and dialog names (by reflection) for analytics

build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/default.properties:37:epg.analytics.google.address=http://www.google-analytics.com/
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/default.properties:38:epg.analytics.webitem.enable=false
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/development.properties:1:epg.analytics.google.profile=stbdev
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/development.properties:2:epg.analytics.webitem.enable=true
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/production.properties:1:epg.analytics.google.profile=prod
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/trials_customer.properties:1:epg.analytics.google.profile=trials
build/applications/Picasso/picasso/Picasso/src/java/picasso/initialisationmanager/configuration/trials_user.properties:1:epg.analytics.google.profile=trials
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:34:     private static final String GOOGLE_ANALYTICS_SCOPE = "epg.analytics.google";
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:39:      * google analytics account number
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:48:     private static final PropertyKey<Boolean> WEBITEM_ANALYTICS_PROPERTY = PropertyKey.define("epg.analytics.webite
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:82:                                     analyticsBitChanged(caControlledFeature.isEnabled());
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:90:             private void analyticsBitChanged(boolean enabled)
build/applications/Picasso/picasso/Picasso/src/java/picasso/notification/Analytics.java:144:                    LOGGER.logMilestone("Configuring google analytics to address " + address + ", with account " +

build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:78:                   notifier.notify(notification.get());
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:91:           notifier.notify(new MenuNavigationNotification(path, clock));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:96:           notifier.notify(new MenuNavigationNotification(tabName + "/" + name, clock));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:101:          notifier.notify(new MenuNavigationNotification("Entering grid: " + preferenceTabName, c
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:106:          notifier.notify(factory.bannerOpenedNotification());
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:111:          notifier.notify(factory.bannerClosedNotification());
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:117:          notifier.notify(factory.openDialogNotification(dialog));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:122:          notifier.notify(factory.closeDialogNotification(dialog));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:127:          notifier.notify(factory.colourButtonEvent(mapping));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:132:          notifier.notify(factory.homepageJumpEvent(homepageJump));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:137:          notifier.notify(factory.predictiveSearchSelectedEvent(text));

build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:142:          notifier.notify(new KeyPressedNotification(keyEvent));

build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:147:          notifier.notify(factory.webItemEvent(mediaIdentifier, fullTitle, bookingReportMapper.ge
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:152:          notifier.notify(factory.webItemEvent(mediaIdentifier, fullTitle, bookingReportMapper.ge
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:193:                  notifier.notify(factory.timingEvent("PDLDOWNLOAD", "isDPL:" + plannerBookedProg
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:200:          notifier.notify(factory.timingEvent("Search", "Predictive Search", timing, "pred"));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:205:          notifier.notify(new EventNotification(clock.timestampMS())
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:226:          notifier.notify(new StartAgainEvent(clock.timestampMS(), title, "Play", startAgainChann
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:231:          notifier.notify(new StartAgainEvent(clock.timestampMS(), title, "Cancelled", startAgain
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:236:          notifier.notify(new StartAgainEvent(clock.timestampMS(), title, "Download", startAgainC
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:246:                  notifier.notify(new AssetPurchaseEvent(clock.timestampMS(), propertyTitle, Stri
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:257:          notifier.notify(new AssetActionEvent(clock.timestampMS(), templateName, title, action,
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:262:          notifier.notify(new AssetActionEvent(clock.timestampMS(), "Add", title, "ADD_TO_WATCHLI
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:267:          notifier.notify(new AssetActionEvent(clock.timestampMS(), "Remove", propertyTitle, "REM
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:272:          notifier.notify(new PinEvent(clock.timestampMS(), PinEvent.PinActions.LAUNCH_RESET_APP,
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:277:          notifier.notify(new PinEvent(clock.timestampMS(), PinEvent.PinActions.VERIFY_PIN, reaso
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:282:          notifier.notify(new SessionEnd(clock.timestampMS()));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:287:          notifier.notify(new AutoPlayEvent(clock.timestampMS(), WatchNextEvent.Action.PROMPT_ONS
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:297:          notifier.notify(new AutoPlayEvent(clock.timestampMS(), WatchNextEvent.Action.PROMPT_DIS
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:302:          notifier.notify(new AutoPlayEvent(clock.timestampMS(), WatchNextEvent.Action.BACKUP_DIS
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:307:          notifier.notify(new WatchNextEvent(clock.timestampMS(), WatchNextEvent.Action.PLAY_NEXT
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:312:          notifier.notify(new AutoPlayEvent(clock.timestampMS(), WatchNextEvent.Action.PLAY_NEXT_
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:317:          notifier.notify(new ServiceLinkJumpEvent(clock.timestampMS(), title));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:326:          notifier.notify(new PreferenceEvent(clock.timestampMS(), analyticsName, storedValue, st
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:331:          notifier.notify(new InteractiveMenuApplicationLaunch(clock.timestampMS(), description,
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:341:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:351:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:360:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:369:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:375:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:381:          notifier.notify(notification);
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:396:          notifier.notify(new ClashManagmentAction(clock.timestampMS(), title, template, left, ri
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:401:          notifier.notify(new ClashPrompt(clock.timestampMS(), ClashPrompt.Prompt.NEW_PROMPT, s))
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:406:          notifier.notify(new ClashPrompt(clock.timestampMS(), ClashPrompt.Prompt.TIMEDOUT, s));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:411:          notifier.notify(new ClashPrompt(clock.timestampMS(), ClashPrompt.Prompt.USER_EXIT, s));
build/applications/Picasso/picasso/Picasso/src/java/picasso/utils/listings/support/NavigationTracker.java:417:          notifier.notify(new InteractiveAppLaunch(clock.timestampMS(), channel, appName, analyti

// DownloadNext	AssetAction
// build/applications/Picasso/picasso/Picasso/src/java/picasso/downloadnext/DownloadNext.java
					navigationTracker.itemAction(pbp.getEpisodeTitle(), "DownloadNext", "", pbp.getState(), aWebUUID(pbp.getUuidAsString(), WebUUID.Type.PROGRAMME));
					LOGGER.logMilestone("DOWNLOADNEXT: Set next episode = " + locator.asURI());


={============================================================================
|kt_dev_si_0001| comp-pdl-hld

CTM obtains the different objects within the NFF file using the Byte Range
operation (see RFC2616, section 14.35). CTM knows the offsets of the objects
from the NFF Table of Contents (TOC), which is contained in the first 188
bytes of the NFF file.

// for analysis
https://cisco.app.box.com/v/overviewer


={============================================================================
|kt_dev_si_0001| comp-dpl comp-pdl

http://hetty.cisco.com/fusionmadesimple/index.php/BSkyB_DPL

PA 	Primary Asset
SA 	Secondary Asset
SAC 	Secure Authenticated Channel
SGW 	Secure GateWay (HE component) 

<dpl-list-live>
# sky site
http://10.64.134.118/tools/dpl-asset.php


<dpl-playlist> <pdl-playlist>
Now STB will send Forward request to A-S SGW which is nothing but to get the
playlist.

A-S SGW will forward this request to ADM.

ADM will talk to ADS to fill the Ad Slot in the playlist.

ADS will fill the Ad Slot with the particular Content Instance Handle

ADM will map this Content Instance Handle with the actual content location on
CDN and forward this to A-S SGW.

A-S SGW forward the playlist to STB.

WP2602 - PDL DPL - Download Playlist Assets

// PA, SA has sequential index.
// sample from a box
{
  "playList" : {
    "admId" : 2,
    "playlistId" : 691117768,
    "trickModeControl" : 0,
    "caRating" : 0,
    "events" : [ {
      "eventtype" : "ResolvedItem",           // SA
      "index" : 1,
      "providerId" : "bsky_secpresevent_hd",
      "assetId" : "SCVT0000000002361495",
      "duration" : 25040,                     // in ms
      "assetLocationURL" : "http://cdn.sky.com/329553/60449/bsky_secpresevent_hd/SECONDARY_ASSET/bsky_secpresevent_hd-SCVT0000000002361495-201606081317070000.nff",
      "fileSize" : 10,
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 2,
      "providerId" : "bsky_secpresevent_hd",
      "assetId" : "SCVT0000000002537895",
      "expiryDate" : 1514764799,
      "duration" : 1040,
      "assetLocationURL" : "http://cdn.sky.com/329553/60449/bsky_secpresevent_hd/SECONDARY_ASSET/bsky_secpresevent_hd-SCVT0000000002537895-201609081722550000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=19680210&reid=5811490&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=19680210,5811490,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"             // generate <dpl-report> DPLTI
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 3,
      "providerId" : "bsky_seccomcmpgn_hd",
      "assetId" : "SCVT0000000003040000",
      "expiryDate" : 1501541999,
      "duration" : 40000,
      "assetLocationURL" : "http://cdn.sky.com/329553/60442/bsky_seccomcmpgn_hd/SECONDARY_ASSET/bsky_seccomcmpgn_hd-SCVT0000000003040000-201707201401360001.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=20104141&reid=7565132&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=20104141,7565132,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&asid=124324693&ssid=1167665&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 4,
      "providerId" : "bsky_seccomcmpgn_hd",
      "assetId" : "SCVT0000000003029371",
      "expiryDate" : 1501541999,
      "duration" : 30000,
      "assetLocationURL" : "http://cdn.sky.com/329553/60448/bsky_seccomcmpgn_hd/SECONDARY_ASSET/bsky_seccomcmpgn_hd-SCVT0000000003029371-201707141619480000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=19945208&reid=7496078&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=19945208,7496078,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&asid=124324693&ssid=1167665&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 5,
      "providerId" : "bsky_seccomcmpgn_hd",
      "assetId" : "SCVT0000000002990474",
      "expiryDate" : 1501541999,
      "duration" : 30000,
      "assetLocationURL" : "http://cdn.sky.com/329553/60442/bsky_seccomcmpgn_hd/SECONDARY_ASSET/bsky_seccomcmpgn_hd-SCVT0000000002990474-201706230956450000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=19497282&reid=7385040&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=19497282,7385040,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&asid=124324693&ssid=1167665&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 6,
      "providerId" : "bsky_secpromover_hd",
      "assetId" : "SCVT0000000003032034",
      "expiryDate" : 1501541999,
      "duration" : 40000,
      "assetLocationURL" : "http://cdn.sky.com/329553/60442/bsky_secpromover_hd/SECONDARY_ASSET/bsky_secpromover_hd-SCVT0000000003032034-201707141052560000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=20151260&reid=7502917&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=20151260,7502917,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&asid=124324693&ssid=1167665&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 7,
      "providerId" : "bsky_seccomcmpgn_hd",
      "assetId" : "SCVT0000000002872369",
      "expiryDate" : 1514764799,
      "duration" : 15000,
      "assetLocationURL" : "http://cdn.sky.com/329553/60456/bsky_seccomcmpgn_hd/SECONDARY_ASSET/bsky_seccomcmpgn_hd-SCVT0000000002872369-201704121427360000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g007&n=144750%3B144750%3B394492&t=1501231395684624008&f=1&r=144750&adid=17923364&reid=6986325&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=17923364,6986325,,,1501231395,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {
      "eventtype" : "MainItem",
      "assetPartId" : 1,
      "index" : 8,
      "providerId" : "bsky_atlantic_hd",
      "assetId" : "MAIN0000000002867944",
      "duration" : 3358000,
      "assetLocationURL" : "http://cdn.sky.com/60452/bsky_atlantic_hd/MOVIE/bsky_atlantic_hd-MAIN0000000002867944-201707201508500000.nff",
      "fileSize" : 30,
      "reportingThreshold" : 25
    }, {
      "eventtype" : "ResolvedItem",
      "index" : 9,
      "providerId" : "bsky_secpresevent_hd",
      "assetId" : "SCVT0000000002278790",
      "duration" : 2040,
      "assetLocationURL" : "http://cdn.sky.com/329553/60453/bsky_secpresevent_hd/SECONDARY_ASSET/bsky_secpresevent_hd-SCVT0000000002278790-201604141552330000.nff",
      "fileSize" : 10,
      "reportingThreshold" : 75
    }, {
    ...
    }
  }
}


// CMS_MEDIA_SERVICES/CTM/src/server/ctm_svr_job_manager.h
/**
 * @brief Playlist for a DPL booking, contructed from
 * the JSON response from the ADM
 */
typedef struct CTM_JOB_Playlist_t
{
    uint32_t playlist_id;
    uint32_t playList_admId;
    uint32_t playList_trickModeControl;
    uint32_t playlist_numberOfEvents;
    CTM_JOB_DPL_Asset assets[MAX_NUMBER_OF_DPL_ASSETS];
    uint32_t primary_asset_event_index; /* Index of events[] where the primary asset is located.*/
    bool primary_asset_toc_imported; /* set to true when the TOC for the primary asset has been imported.*/
} CTM_JOB_Playlist;

// CMS_MEDIA_SERVICES/CTM/src/server/ctm_svr_dpl_asset.h
/**
 * @brief Represent an individual asset in a DPL playlist.
 */
typedef struct CTM_JOB_DPL_Asset_t
{
    uint32_t event_index;
    char*    event_providerId;
    char*    event_assetId;
    SYSTEMTIME_TIMEDATE event_expiryDate;
    PCAT_CAT_DPL_EXPIRY_STATE asset_expiry_state;
    uint32_t event_duration;
    char*    event_assetLocationURL;
    uint32_t event_fileSize;
    PCAT_CAT_DPL_ASSET_TYPE event_type;
    uint32_t asset_partId;
    char*  event_cdn_url;
    xint64_t event_mdi_offset;
    xint64_t event_mdi_size;
    xint64_t event_content_size;
    xint64_t event_content_offset;
    char*    event_MDI_path;
    char*    tracking_url;
    VRM_IMP_DPL_TRACKING_EVENT tracking_action;
    int32_t reporting_threshold;
    xint64_t catalog_object_offset;
    xint64_t catalog_object_length;

    /* Values of the first and last PTS in the asset,
     * used to determine whether restamping is needed.
     * Should be set to CTM_ILLEGAL_PTS if unavailable.
     * This is expressed in PCR units. */
    uint64_t pts_in_value;
    uint64_t pts_out_value;

} CTM_JOB_DPL_Asset;


The only metadata that will be imported by MSM is the PMT of the primary
asset.

7.	All assets must have the same video PID.

Requirements

14.	If an SA does not contain a superset of the elementary streams present
in the PA, the asset shall be removed from the playlist. This does not include
sub-titles, which are optional.


The check that the elementary streams in the SAs are a superset of those in
the PA will be added in WP2754 “PDL DPL: Handling Unavailable Secondary
Assets”.

  (pdl-dpl) FSION-DSN-3962 WP2754 - PDL DPL Download Exception Handling

  Anomaly in the PMT of one of the SAs

  6.	If an SA does not contain a superset of the audio and video elementary
  streams present in the PA, the asset shall be skipped in the playlist. This
  does not include sub-titles, which are optional.  
  
  7.	Every common video and audio elementary stream must have the same type
  in the PA and in SAs.  Type mismatch such as video MPEG-2 and MPEG-4 (HD and
      SD), or different audio stream type, are to be rejected and such a SA
  skipped.  
  
  Note	This error is only expected in case of a misconfiguration of a
  playlist on the HE. This requirement exists in order to mitigate the
  consequences of such error.

  3.5	Incorrect or Missing Elementary Stream in a Secondary Asset


  Since CTM will have already started to download the media objects, on
  receiving an assetStatus of missingEs, CTM shall:

  Skip the asset, mark it as Skipped in PCAT, and carry on with the indexing.

  CMS_MEDIA_SERVICES/CTM/src/server/ctm_svr_dpl.c
    CTM_SVR_DBG_WARN(("Item %d will be SKIPPED", i));

    job->dpl_job->dpl_playlist->assets[i].asset_expiry_state = PCAT_CAT_DPL_EXPIRY_STATE_SKIPPED;

    CTM_PCAT_Update_Booking_t update_playlist = {0};

    /********************************************************************************************************/
    /** @brief Different values to be used for the property #PCAT_CAT_PROP_DPL_ASSET_TYPE, WP2592          */
    typedef enum PCAT_CAT_DPL_EXPIRY_STATE_
    {
        PCAT_CAT_DPL_EXPIRY_STATE_UNDEF = 0,
        PCAT_CAT_DPL_EXPIRY_STATE_UNEXPIRED,                   /**< @brief Play list asset expiry has not yet been reached. */
        PCAT_CAT_DPL_EXPIRY_STATE_EXPIRED_AWAITING_CONTENT,    /**< @brief Play list asset expiry has passed without asset being downloaded */
        PCAT_CAT_DPL_EXPIRY_STATE_EXPIRED,                     /**< @brief Play list asset expiry has passed and asset was downloaded */
        PCAT_CAT_DPL_EXPIRY_STATE_REMOVED,                     /**< @brief Play list asset expiry has passed and the SA has been removed */
        PCAT_CAT_DPL_EXPIRY_STATE_SKIPPED,                     /**< @brief Play list asset was skipped and not downloaded */
        PCAT_CAT_DPL_EXPIRY_STATE_LAST                         /**< @brief dummy - last enum value */
    } PCAT_CAT_DPL_EXPIRY_STATE;

  note: DPL_ITEM in PCAT. SHOW this maps to *booking-job-id*

  3.5.3.2	MSM Component Requirements

  Before starting appending an index object, MSM will check its PMT_IE index
  event. It must contain at least all the video and audio elementary streams
  contained in the PA for the operation to proceed.

  MSM shall check the type of each video and audio elementary stream for
  mismatch with the one in the PA.

  All other ESes (in particular subtitles) are ignored for the purpose of this
  check.

  In case of a missing elementary stream, MSM shall return a specific
  “elementary stream mismatch” error.

The additional metadata required for reporting will not be created. This
capability will be added in WP2605 “PDL DPL: Create MSM Index Files for
Reporting”.

<ex>
Below is the Citizen Khan asset details from my box: - 
Name |Shrec |BookingJob| Booking id| Event id |episode info |Length |MD5 |
==============================================================================================================
Citizen Khan |s3363 |687888517 | 553670789 | 1056987269| 1/6 |391661056|DDC798808358CC0440DF4D27C853BE32|
Citizen Khan |s3365 |687888526 | 553670798 | 1056987278| 1/5 |370690048|0A473A0106DE6B1165866BB914759063|
Citizen Khan |s3366 |687888536 | 553670808 | 1056987288| 1/4 |393209344|D14105B658E9AD2D0303B7A956FE6857|
Citizen Khan |s3367 |687888539 | 553670811 | 1056987291| 1/3 |401741312|E2696A22299B9E55814A395430CEA1A5|
Citizen Khan |s3369 |687888543 | 553670815 | 1056987295| 1/1 |393441280|F73E44F3156B2B6A13BFEC47E2EBFEE5|
Citizen Khan |s3368 |687888541 | 553670813 | 1056987293| 1/2 |402436608|E99D1CE5E96D38F92AFCE094DE7B7046|


<playlist-when-skipped>
// skipped two
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_DPL_TOCDL_TOCImport_OECMDL L:9003 > TOC NOT FOUND for SA index 0 SKIP the asset 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_DPL_TOCDL_TOCImport_OECMDL L:9003 > TOC NOT FOUND for SA index 5 SKIP the asset 

!MIL    -EPG_MISC     		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "WebItemEvent","action": "select","title": "START_PDL_EVENT_DOWNLOAD;title=Riviera S1 ep3;mid=3250153;referer=urn:sky:vod:v1:Darwin:srch:riviera","label": "START_PDL_EVENT_DOWNLOAD;title=Riviera S1 ep3;mid=3250153\
!MIL    -EPG_MISC     		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:MilestoneNotifier F:send L:21 > ;referer=urn:sky:vod:v1:Darwin:srch:riviera","currentscreen": "/search"}
!MIL    -EPG_KEY      		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:KeyProcessor F:keyReleased L:320 > T:CEE-J EventQueue Reader 0:Keycode is 1:RELEASED x1 @946687336985-946687337301 for 1:SELECT x1 @946687336985-946687337301
!MIL    -J_GC         		< p:0x000001f2 P:APP t:0x2e229520 T:no name M: F: L:0 > T:PooledExecutor#3:REFER: addPdlBookedProgramme: referrer=urn:sky:vod:v1:Darwin:srch:riviera

// matches up with. only shows up when downloads assets.
//
        CTM_SVR_DBG_MIL(( "Asset %03d: iP %013lld:%013lld rO % 013lld",
                    i,
                    playlist->assets[i].pts_in_value,
                    playlist->assets[i].pts_out_value,
                    worklist->workitems[i].offset ));

!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 000: iP 0004294967295:0004294967295 rO  004294967295 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 001: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 002: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 003: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 004: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 005: iP 0004294967295:0004294967295 rO  004294967295 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 006: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 007: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 008: iP 0000000000000:0000038339700 rO  000000000035 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 009: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 010: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 011: iP 0000000000000:0000038339700 rO  000000000000 
!MIL    -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_restamper.c F:CTM_Restamper_GenerateWorklistForPlaylist L:347 > Asset 012: iP 0000000000000:0000038339700 rO  000000000000 


!MIL    -EPG_MISC     		< p:0x000001f2 P:APP t:0x2e210520 T:no name M:MilestoneNotifier F:send L:21 > T:PooledExecutor#2:{"category": "PDLDOWNLOAD","action": "TimedEvent","title": "PDLDOWNLOAD took 13862ms","label": "isDPL:true,Title:Riviera,sizeKB:13878","currentscreen": "/search"}
!MIL    -EPG_DLG      		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:DialogManager F:showDialog L:1405 > T:CEE-J EventQueue Reader 0:Showing dialog 1259
!ERROR  -EPG_DEV1     		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /search/pdl_asset_available_fyi_id
!MIL    -EPG_MISC     		< p:0x000001f2 P:APP t:0x2c157520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/search/pdl_asset_available_fyi_id"}


<playlist-when-pid-different>
note:
In this case, CTM_Restamper_GenerateWorklistForPlaylist shows all okay since
this is a problem when try to play when downloads are all done.

SA PID should match with PA

We see that SA PID didn't match up with PA and hence no download happened, no
SA playback. 

# during import
!MIL    -VRM_SERVER   		< p:0x000001a8 P:MW t:0x01d3c520 T:VRM_SRV M:fsm.c F:FSMRun L:917 > 
VRM-FSM: VRM_IMP_OBJECT_0x60007: VRM_IMP_OBJECT_INT_STATE_NULL -> (VRM_IMP_OBJECT_STATE_INPUT_CREATED) -> VRM_IMP_OBJECT_INT_STATE_CREATED 

note: PID is packet id from PMT.
/* Parse the PMT index payload and retrieve all the PID's of the SP indexes. */

!WARN   -MSM          		< T:VRM_SRV M:msm_concatenate_index_obj.c F:(checkPrimaryAssetPidsMatchSecondaryAsset) L:2093 > PA PID (2005) not found in SA 
!ERROR  -VRM_IMPORT   		< T:VRM_SRV M:vrm_imp_server_object.c F:VRM_IMP_SERVER_OBJECT_InternalActionAppended L:1981 > MSM_IMPORT_CAT_INDEX_OBJ_GetObjectHeaderInfo() failed returnStatus[0x5823002] on index=[/mnt/nds/dev_5/part_0/S382/index/idx0.dat]\n 
!FATAL  -VRM_COMMON   		< T:VRM_SRV M:type2str.c F:VRM_TYPE2STR_PrintDplai L:2854 > ~~~~~~~~~~~~ VRM_DIAG_ASSERT at file=<type2str.c>, line=2854, failed on: " "!IS_ERR(stat) 
!ERROR  -VRM_COMMON   		< T:VRM_SRV M:type2str.c F:VRM_TYPE2STR_PrintDplai L:2854 > VRM ERR in " "type2str.c" ":2854 
!WARN   -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_vrm.c F:CTM_SVR_VRM_AppendIndexObject L:2834 > The current asset has to be skipped... 
!WARN   -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_dpl.c F:CTM_SVR_DPL_ProcessIndexFiles L:701 > Item 0 will be SKIPPED 

!WARN   -CTM_SVR      		< T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_Import_StartImport L:8177 > 
Index import started 

!MIL    -EPG_NET      		< p:0x000001dd P:APP t:0x2e149520 T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"MIDROLL_FFWD_1st_SA_Exp_PA_Sub" 
firstStatus:DOWNLOADING_BUT_NOT_AVAILABLE->DOWNLOADING_AND_AVAILABLE firstFailureReason:100 firstIsDpl:true

!MIL    -CTM_SVR      		< p:0x000001db P:MW t:0x01e37520 T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:519 > FTM Callback (Success) status called for job 0xbec78004 step CTM_JOB_STEP_6_DPL_INDEX_IMPORT_START_DL 


<pdl-report-ams-report>
note: the ADMRS logs only the SAs
(pdl-dpl) BSKYB-ICD-3250  STB to ADM Reporting Server.doc

4.2.1.5	Request Body

The body of the HTTP POST request shall contain the data structure that will
represent the STB report.  This shall be represented using a JSON document
compliant to the following schema:

// 4th

"playlistIndex" : {
			"type" : "integer",
			"optional" : "false"
		},

playlistIndex: Asset index within the playlist.

360224232,2,1,1,bskyb.com,bskyb.com,Primary_Asset_Plist2,Secondary_Asset_num1,09:14:17.208,2009-07-15T09:01:49.567,09:14:47.479,0,30080,100,1,http://adServer1/ADS/23648238 


(pdl-dpl) FSION-DSN-3780 WP2605 - PDL DPL - Real-Time Reporting during Normal Playback

5.	The following notification events are supported [5]:
  Impression: The playback of the asset has finished or playback has been
  terminated.

!WARN   -VRM_SERVER   		< p:0x000001db P:MW t:0x01d4d520 T:VRM_SRV M:dpl_play.c F:DplPlayNotifyAssetTransition L:1831 > 
Received request from MSM to queue Asset transition that we have already queued, can occur when speed changes happen near asset boundaries. 

!INFO   -AMS                          < p:0x0000025a P:MW t:0x02133520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_InitHttpOptions L:410 > 
Setting option HTTP_API_OPT_URL to default url /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy

!MIL    -AMS          		< p:0x000001db P:MW t:0x01d2e520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > 
Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=642,isLastSent=1 

!MIL   -AMS          < p:00000470 t:02170520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:00228 > 
Post the report to server http://10.10.200.142:12960/ADMReportingServerProxy, buffNum=0, buffer size=623,isLastSent=1

// void RTRDataClient::UploadData()
// {
//        if (AMS_FTM_API_UploadFile(s_buff[buffNum].buff, file_size, buffNum, ip_address_)!= AMS_FTM_STATUS_OK);
//        {
//            AMS_DEBUG_MIL(("Post the report to server %s, buffNum=%d, buffer size=%d,isLastSent=%d",ip_address_, buffNum,file_size,isLastSent));
//        }
// }
//
// XTV_High_Level_VOB/EGEN/DataClient/FileTransMngr/src/fusionfs/AMS_ftm.cpp
//
// AMS_FTM_STATUS AMS_FTM_API_UploadFile(const char* buffer, uint32_t size, uint32_t user_tag, const char * ip_address)
// {
//        if (SYSTEMITC_API_PostEvent( &AMS_FTM_Ctxt.reqQueue, (uint32_t)AMS_FTM_EVENT_UPLOAD, &message, sizeof(message) ) != SYSTEMITC_OK)
// }
//
// static void* AMS_FTM_Thread_HttpRequestHandler(void *p)
// {
//         switch (event)
//         {
//             case AMS_FTM_EVENT_UPLOAD: /*request to upload information using http */
//                 AMS_DEBUG_TRACE(("AMS_FTM_EVENT_UPLOAD received. calling AMS_FTM_HttpPost"));
//                 if(message.url_size > 0)
//                 {
//                     system_status = HTTP_API_Setopt(AMS_FTM_Ctxt.httpHandle, HTTP_API_OPT_URL, message.url);
//                     if (!SYSTEM_STATUS_IS_OK(system_status))
//                     {
//                         AMS_DEBUG_ERROR(("Set option HTTP_API_OPT_URL FAILURE:error  [%s]", HTTP_API_Strerror(system_status)));
//                     }
//                     else
//                     {
//                         AMS_DEBUG_TRACE(("AMS_FTM_HttpPost url=%s,size =%d timeout=%d connection_timeout=%d", message.url, message.url_size, AMS_FTM_Ctxt.timeout,AMS_FTM_Ctxt.connecttimeout));
//                         (void) `AMS_FTM_HttpPost`(message.buffer, message.buffer_size, message.user_tag);
//                     }
//                 }
//                 break;
//          }
// }

// <onw-debug-logging>
// XTV_High_Level_VOB/EGEN/DataClient/FileTransMngr/src/fusionfs/AMS_ftm.cpp
// 
// /** @brief perform Http POST request */
// static AMS_FTM_STATUS `AMS_FTM_HttpPost`(char * buffer, uint32_t size, uint32_t user_tag);
//     AMS_DEBUG_ERROR(("KT: %s", buffer));

NDS: ^1489061802.439050 !ERROR -AMS          < p:00000470 t:0217e520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:00491 > KT: {
	"immediateReport":	[{
			"subscriberId":	360235568,
			"playlistId":	1,
			"admId":	1,
			"playlistIndex":	2,
			"primaryProviderId":	"bskyb.com",
			"secondaryProviderId":	"bskyb.com",
			"primaryAssetId":	"Primary_Asset_Plist1",
			"secondaryAssetId":	"Secondary_Asset_num1",
			"currentTime":	"09:02:53.430",
			"assetPlaybackStartTime":	"09:02:23.102",

<asset-transition-info>
Yes, the ADMRS logs `only the SAs.` it logs the `last played SA.` For both cases,
the Asset was playedback to SA3 and ends there. So in OK case, the last SA,
SA3, was logged but for NOT OK case, the last SA, SA1, was logged.

In the following playlist

SA1 PA1 SA2 SA3 PA2 SA4 PA3 SA5

  Trick Mode suppression is on (Trick play on SAs are prohobitid so only 1x
  playback is possible)

  SA2 expired

  Trick play at 30x performed on PA1 (the problem does not happen when 2x, 6x
  or 12x used)

  When playback reaches to SA3, it starts playing back at 1x as expected but
  no ADMRS log sent out for SA3.

  (means that "playlistid" is 1 which is the last, sa1. it's 3 for okay case.)

// CMS_INFORMATION_SERVICES/SIM/src/utils/inc/real/real_systemobject.h
#define SYSTEMOBJECT_DPLAI_PROPID_I_PL_INDEX                     SYSTEMOBJECT_MAKEPROP(SYSTEMOBJECT_TYPE_DPLAI, SYSTEMOBJECT_PROP_TYPE_I, 3U)    /*!< @brief DPL Asset Info Playlist Index */

// CMS_MEDIA_SERVICES/VRM/src/server/engine/dpl_play.c
static SYSTEM_STATUS DplPlayGetEventType( const DPL_PLAY *pThis, SYSTEMOBJECT_HANDLE Asset_Info_handle, uint32_t *event_Info )


1481160:NDS: ^[2017:09:11 06:46:11]0946916711.007831 !MIL    -VRM_SERVER   		< p:0x00000209 P:MW t:0x0211c520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x200 
1481186:NDS: ^[2017:09:11 06:46:11]0946916711.015769 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_common.c F:MessageThread L:3977 > *** Message received (event = PLAYER_EVT_ASSET_TRANSITION) *** 
1481187:NDS: ^[2017:09:11 06:46:11]0946916711.015922 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > In PLAYER_UAM_SignalAssetTransition, l_evt_type = 78 
1481188:NDS: ^[2017:09:11 06:46:11]0946916711.016498 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2472 > Succeed to send param bag to UAM 

1486105:NDS: ^[2017:09:11 06:46:26]0946916726.291884 !MIL    -VRM_SERVER   		< p:0x00000209 P:MW t:0x0211c520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x200 
1486122:NDS: ^[2017:09:11 06:46:26]0946916726.295154 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_common.c F:MessageThread L:3977 > *** Message received (event = PLAYER_EVT_ASSET_TRANSITION) *** 
1486123:NDS: ^[2017:09:11 06:46:26]0946916726.295318 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > In PLAYER_UAM_SignalAssetTransition, l_evt_type = 77 
1486124:NDS: ^[2017:09:11 06:46:26]0946916726.295896 !INFO   -P_Api        		< p:0x0000020b P:APP t:0x013aa520 T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2472 > Succeed to send param bag to UAM 

// DARWIN_PLATFORM/DARWIN_PLAYER/src/player_uam.c
void PLAYER_UAM_SignalAssetTransition( SYSTEMOBJECT_HANDLE l_obj_handle )
{
                                                    else if (UAM_API_STATUS_OK != UAM_API_ParamDataProcessEvent( l_uam_handle ))
}

1486618:NDS: ^[2017:09:11 06:46:28]0946916728.301981 !MIL    -AMS          		< p:0x00000209 P:MW t:0x0210b520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=918,isLastSent=1 
1486619:NDS: ^[2017:09:11 06:46:28]0946916728.302140 !ERROR  -AMS          		< p:0x00000209 P:MW t:0x0212a520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:491 > KT: {
1486620:	"immediateReport":	[{
1486621:			"subscriberId":	22844813,
1486622:			"playlistId":	692491100,
1486623:			"admId":	3,
1486624:			"playlistIndex":	8,
1486625:			"primaryProviderId":	"bsky_skyatlanprev_hd",
1486626:			"secondaryProviderId":	"bsky_seccomcmpgn_hd",
1486627:			"primaryAssetId":	"MAIN00[2017:09:08 14:25:51]0000000291 

note:
[3.3‑3.5] UAM’s state machine decides whether this event should trigger a
report and, if so, uses HTTP to deliver the report to the ADM RS via the
  ADM RS SGW.


<when-sa2-expired> see there are three DPLTI but two sa reports when sa2 is expired
egrep -an "KEY_PRESS|MessageThread|DplPlayIsTrickModeRestriction|GenerateWorklistForPlaylist|player_uam|\-AMS"

40646:!MIL    -aem          		< p:0x000001da P:APP t:0x01540520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SELECT)e001 
41308:!INFO   -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(MSM_SP_SetSpeedInternal) L:832 > hMC=0x5, speed=1000  Starts...  
41316:!MIL    -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(raiseSpeedNotification) L:2701 > raiseSpeedNotification " "hMC=0x5, nfy_reason=0x1, status=0x5805000, speed=1000,  
43283:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
54784:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
54912:!MIL    -aem          		< p:0x000001da P:APP t:0x01540520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(FORWARD)e405 
58662:!INFO   -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(MSM_SP_SetSpeedInternal) L:832 > hMC=0x5, speed=30000  Starts...  
58801:!MIL    -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(raiseSpeedNotification) L:2701 > raiseSpeedNotification " "hMC=0x5, nfy_reason=0x1, status=0x5805000, speed=30000,  
60685:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:pvp_play.c F:PANEL_PlaySetSpeed L:318 > [API_CALL::""MSM_SP""] " "calling MSM_SP_SetSpeed mcon= 0x5, speed: 0x3e8 
60686:!MIL    -MSM          		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:msm_sp.c F:(MSM_SP_SetSpeed) L:781 > MSM_SP_SetSpeed " "hMC=0x5, speed=1000  Starts...  
60688:!MIL    -MSM          		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:msm_sp.c F:(MSM_SP_SetSpeed) L:793 > @@PMON@@,mark,pvr,set-speed,5,new-speed=,1000 
60699:!INFO   -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(MSM_SP_SetSpeedInternal) L:832 > hMC=0x5, speed=1000  Starts...  
60822:!MIL    -MSM          		< p:0x000001d8 P:MW t:0x01d19520 T:MSMDispatcher M:msm_sp.c F:(raiseSpeedNotification) L:2701 > raiseSpeedNotification " "hMC=0x5, nfy_reason=0x1, status=0x5805000, speed=1000,  
61763:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
72703:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
73343:!MIL    -AMS          		< p:0x000001d8 P:MW t:0x02134520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=640,isLastSent=1 
82168:!MIL    -VRM_SERVER   		< p:0x000001d8 P:MW t:0x02154520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
82675:!MIL    -AMS          		< p:0x000001d8 P:MW t:0x02134520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=642,isLastSent=1 


<when-sa2-not-expired> see there are three DPLTI and three sa reports when sa2 is not expired
40908:NDS: ^[2017:02:17 08:52:52]0946685185.670029 !MIL    -aem          		< p:0x000001b9 P:APP t:0x01540520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(SELECT)e001 
41470:NDS: ^[2017:02:17 08:52:53]0946685186.158392 !INFO   -MSM          		< p:0x000001b7 P:MW t:0x01d1a520 T:MSMDispatcher M:msm_sp.c F:(MSM_SP_SetSpeedInternal) L:832 > hMC=0x5, speed=1000  Starts...  
41478:NDS: ^[2017:02:17 08:52:53]0946685186.159289 !MIL    -MSM          		< p:0x000001b7 P:MW t:0x01d1a520 T:MSMDispatcher M:msm_sp.c F:(raiseSpeedNotification) L:2701 > raiseSpeedNotification " "hMC=0x5, nfy_reason=0x1, status=0x5805000, speed=1000,  
43583:NDS: ^[2017:02:17 08:52:54]0946685187.147877 !MIL    -VRM_SERVER   		< p:0x000001b7 P:MW t:0x02153520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
55411:NDS: ^[2017:02:17 08:53:24]0946685217.405802 !MIL    -VRM_SERVER   		< p:0x000001b7 P:MW t:0x02153520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
55951:NDS: ^[2017:02:17 08:53:26]0946685219.415496 !MIL    -AMS          		< p:0x000001b7 P:MW t:0x02134520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > 
  Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=642,isLastSent=1 
63561:NDS: ^[2017:02:17 08:53:31]0946685224.447112 !MIL    -VRM_SERVER   		< p:0x000001b7 P:MW t:0x02153520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
74521:NDS: ^[2017:02:17 08:54:01]0946685254.977601 !MIL    -VRM_SERVER   		< p:0x000001b7 P:MW t:0x02153520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
75158:NDS: ^[2017:02:17 08:54:03]0946685256.988519 !MIL    -AMS          		< p:0x000001b7 P:MW t:0x02134520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=640,isLastSent=1 
83969:NDS: ^[2017:02:17 08:54:32]0946685285.240605 !MIL    -VRM_SERVER   		< p:0x000001b7 P:MW t:0x02153520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 
84477:NDS: ^[2017:02:17 08:54:34]0946685287.250533 !MIL    -AMS          		< p:0x000001b7 P:MW t:0x02134520 T:UAM_HP_THREAD M:RTRDataClient.cpp F:RTRDataClient::UploadData L:228 > Post the report to server /ADMReportingServerProxy?securityscheme=DRM_SCHEME&auth_server=http://admrs.sky.com:80/ADMReportingServerProxy, buffNum=0, buffer size=642,isLastSent=1 


<dpl-pcat>

See dplitem.csv

/********************************************************************************************************/
/** @brief Different values to be used for the property #PCAT_CAT_PROP_DPL_ASSET_TYPE, WP2592          */
typedef enum PCAT_CAT_DPL_ASSET_TYPE_
{
    PCAT_CAT_DPL_ASSET_TYPE_UNDEF = 0,
    PCAT_CAT_DPL_ASSET_TYPE_PRIMARY,       /**< @brief Primary/Main asset */
    PCAT_CAT_DPL_ASSET_TYPE_SECONDARY,     /**< @brief Secondary asset */
    PCAT_CAT_DPL_ASSET_TYPE_LAST           /**< @brief dummy - last enum value */
} PCAT_CAT_DPL_ASSET_TYPE;

/** @brief Different values to be used for the property #PCAT_CAT_PROP_DPL_ASSET_TYPE, WP2592          */
typedef enum PCAT_CAT_DPL_EXPIRY_STATE_
{
    PCAT_CAT_DPL_EXPIRY_STATE_UNDEF = 0,
    PCAT_CAT_DPL_EXPIRY_STATE_UNEXPIRED,                   /**< @brief Play list asset expiry has not yet been reached. */
    PCAT_CAT_DPL_EXPIRY_STATE_EXPIRED_AWAITING_CONTENT,    /**< @brief Play list asset expiry has passed without asset being downloaded */
    PCAT_CAT_DPL_EXPIRY_STATE_EXPIRED,                     /**< @brief Play list asset expiry has passed and asset was downloaded */
    PCAT_CAT_DPL_EXPIRY_STATE_REMOVED,                     /**< @brief Play list asset expiry has passed and the SA has been removed */
    PCAT_CAT_DPL_EXPIRY_STATE_SKIPPED,                     /**< @brief Play list asset was skipped and not downloaded */
    PCAT_CAT_DPL_EXPIRY_STATE_LAST                         /**< @brief dummy - last enum value */
} PCAT_CAT_DPL_EXPIRY_STATE;


<dpl-report> <dpl-trick-mode-suppresion>
{
  "playList" : {
    "admId" : 2,
    "playlistId" : 691117768,
    `"trickModeControl" : 0,` or
    `"trickModeControl" : 2,`
  }
}

/* Values of SYSTEMOBJECT_DPLAI_PROPID_I_TRICK_MODE_CONTROL setting */
#define DPL_PLAY_TRICK_MODES_NO_RESTRICTION   0U
#define DPL_PLAY_TRICK_MODES_RESTRICT_ALL     1U
#define DPL_PLAY_TRICK_MODES_RESTRICT_FF      2U

!WARN   -VRM_SERVER   		< p:0x000001db P:MW t:0x01d4d520 T:VRM_SRV M:dpl_play.c F:DplPlayIsTrickModeRestriction L:4009 > trick modes rejected (2) for current asset (handle 0xa8a1801a) 


(pdl-dpl) BSKYB-DSN-3169 Dynamic Playlists in Anytime STB HLD.doc

12	Real-Time Reporting

  For each asset, a threshold may have been signalled in the playlist that the
  inNormalPlay property must exceed for a real-time report to be generated. 

  Note that reports are only sent if inNormalPlay exceeds a threahold set in
  the playlist. Does the defining of the DPLAI need to be extended with this
  threshold?

the number of DPLTI matches up to the number of assets in the playlist

!INFO   -VRM_SERVER   		< p:0x000001bf P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DplPlayGenerateDplti L:2606 > SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME timestamp=41102085 (calc info timestamp64[0:41102085] ) 
!MIL    -VRM_SERVER   		< p:0x000001bf P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 

DPLSI which matches up to speed changes 

Something to look at is that VRM also generates DPLSIs on speed changes. These
are used by UAM to determine the inNormalPlay field of the report, which is
also compared with the reportingThreshold. One must be generated when dropping
out of trick modes.

58196:NDS: ^[2017:09:08 11:22:59]0946686083.793450 !INFO   -VRM_SERVER   		< p:0x000001bf P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DPL_PLAY_SetSpeedResponse L:1770 > send DPLSI to anchor. hPlay = 0x100 


duration in PTS matches to the differecne in transition time.

T:VRM_SRV M:dpl_play.c F:DplPlayGenerateDplti L:2606 > SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME timestamp=22660836 (calc info timestamp64[0:22660836] ) 
T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 

  DARWIN_PLATFORM/DARWIN_UAM/inc/uam_api.h
  UAM_API_EVENT_TYPE_DPL_ASSET_TO,\    // 78

T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > KT: In PLAYER_UAM_SignalAssetTransition, l_evt_type = 78 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2456 > KT: get PLAYLIST_INDEX(3) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2457 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_REPORTING_THRESHOLD(75) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2459 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_PART_DURATION(1120) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2461 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_END_OFFSET(1120) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2462 > KT: get SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME(22660836) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2463 > KT: set UAM_API_DESC_DPL_EVENT_TYPE(1) 

>>> 22662047-22660836
1211

  UAM_API_DESC_EVENT_TIME,				/* UNIX time format , 4 bytes */\

  CMS_MEDIA_SERVICES/VRM/src/server/engine/dpl_play.c

            stat = DplPlayConvertTimeStampfromMidnight(pThis, &timestamp64);
            E_AB(stat);
            timestamp = xint64_t_low(&timestamp64);
            stat = SYSTEMOBJECT_SetInteger(dplti_sys_obj, SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME, timestamp);
            E_AB(stat);
    
            DIAG_LOG_INFO (VRM_diag_segment_id, ("SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME timestamp=%u (calc info timestamp64[%d:%u] )",
                           timestamp,
                           xint64_t_high(&timestamp64), xint64_t_low(&timestamp64)));

  !INFO   -VRM_SERVER   		< p:0x0000027e P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DplPlayGenerateDplti L:2506 > DplPlayGenerateDplti called for job_type = 0x9 
  !INFO   -VRM_SERVER   		< p:0x0000027e P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DplPlayGenerateDplti L:2606 > SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME timestamp=22662047 (calc info timestamp64[0:22662047] ) 

    }, {
      "eventtype" : "ResolvedItem",
      "index" : 3,
      "providerId" : "bsky_secpresevent_hd",
      "assetId" : "SCVT0000000002537895",
      "expiryDate" : 1514764799,
      "duration" : 1040,
      "assetLocationURL" : "http://cdn.sky.com/329553/60449/bsky_secpresevent_hd/SECONDARY_ASSET/bsky_secpresevent_hd-SCVT0000000002537895-201609081722550000.nff",
      "fileSize" : 10,
      "trackingEvents" : [ {
        "trackingURL" : "https://2356e.v.fwmrm.net/ad/l/1?s=g004&n=144750%3B144750%3B394492&t=1506090225893245012&f=1&r=144750&adid=19680210&reid=5811490&arid=0&auid=&wpct=[PERCENTAGE]&cn=defaultImpression&et=i&_cc=19680210,5811490,,,1506090225,1&tpos=0&iw=&uxnw=&uxss=&uxct=&init=1&vcid2=LTM5MTAxMjk2OTU4NTYzMjA5Mg%3D%3D",
        "action" : "impression"
      } ],
      "reportingThreshold" : 75
    }, {


T:VRM_SRV M:dpl_play.c F:DplPlayGenerateDplti L:2606 > SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME timestamp=22662047 (calc info timestamp64[0:22662047] ) 
T:VRM_SRV M:dpl_play.c F:DplPlayCheckPassedBoundaries L:3189 > send DPLTI to anchor. hPlay = 0x100 

  UAM_API_EVENT_TYPE_DPL_ASSET_FROM,\  // 77

T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > KT: In PLAYER_UAM_SignalAssetTransition, l_evt_type = 77 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2456 > KT: get PLAYLIST_INDEX(3) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2457 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_REPORTING_THRESHOLD(75) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2459 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_PART_DURATION(1120) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2460 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_START_OFFSET(0) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2461 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_END_OFFSET(1120) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2462 > KT: get SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME(22662047) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2463 > KT: set UAM_API_DESC_DPL_EVENT_TYPE(1) 

  UAM_API_EVENT_TYPE_DPL_ASSET_TO,\    // 78

T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2264 > KT: In PLAYER_UAM_SignalAssetTransition, l_evt_type = 78 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2456 > KT: get PLAYLIST_INDEX(4) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2457 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_REPORTING_THRESHOLD(75) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2458 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_EVENT_TYPE, vrm event(2) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2459 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_PART_DURATION(30080) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2460 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_START_OFFSET(0) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2461 > KT: get SYSTEMOBJECT_DPLAI_PROPID_I_ASSET_END_OFFSET(30080) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2462 > KT: get SYSTEMOBJECT_DPLTI_PROPID_I_TRANSITION_TIME(22662047) 
T:PLAYER_MAIN M:player_uam.c F:PLAYER_UAM_SignalAssetTransition L:2463 > KT: set UAM_API_DESC_DPL_EVENT_TYPE(1) 

53381:NDS: ^[2017:09:27 06:17:44]0946685298.287492 !ERROR  -AMS          		< p:0x0000027e P:MW t:0x02119520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:AMS_ftm.cpp F:AMS_FTM_HttpPost L:491 > KT: {
53382:	"immediateReport":	[{
53383:			"subscriberId":	22844813,
53384:			"playlistId":	718013459,
53385:			"admId":	3,
53386:			"playlistIndex":	3,
53387:			"primaryProviderId":	"bsky_atlantic_hd",
53388:			"secondaryProviderId":	"bsky_secpresevent_hd",
53389:			"primaryAssetId":	"MAIN00000[2017:09:28 00:27:13]0000065867 


        DPLTI     DPLTI     DPLTI     DPLTI     DPLTI     DPLTI     NO DPLTI
          /         /         /         /         /         /
  | PA    | SA3     | SA4     | SA5     | SA6     | SA7     | PA    | EOF
              \         \         \         \         \ 
              report    report    report    report    report

<dpl-report-boundary-calc>
On to the real problem: 

NDS: ^[2017:10:16 11:55:09]0946686158.812731 !INFO   -VRM_SERVER           < p:0x000001e3 P:MW t:0x0212a520 T:VRM_SRV M:dpl_play.c F:DplPlayCalcAssetTransitionTime L:3098 
  > elapsed time: partBoundaryMs(INT64(0,`89996`)) prevPositionMs(INT64(0,`72445`)) speed(1000) " 
  > "pThis->previousPosition.timestamp=INT64(220,[2044:08:14 21:17:33]1793353502) tmp64=INT64(0,17551) ==> timestamp64=INT64(220,[2044:08:15 02:10:04]1793371053)

This is shortly after the jump to the beginning of the SA and is where VRM has
just detected that asset boundary has just been crossed. You will see that
there is a large difference between the asset boundary (89996) and the last
measured position (72445). Since playback is now 1000, VRM will calculate that
the asset boundary was passed 17.551s after the time at which the last
position was measured whereas, because of the jump, it should have been at the
time of the last measured position.


={============================================================================
|kt_dev_si_0001| comp-dpl-auto-play

https://www.stb.bskyb.com/confluence/display/PBFeatures/AutoPlay

114093:NDS: ^[2017:07:03 14:32:41]0946685882.369136 !MIL    -EPG_PLAY     		< p:0x00000206 P:APP t:0x2c157520 T:no name M:AutoPlayTimings F:<init> L:213 > T:CEE-J EventQueue Reader 0:AutoPlay: Enabled: rule=5, promptPosition=2492239ms, promptDuration=30000ms, autoPlayPosition=2522239ms, programmeEnd=2527239ms, programmeDuration=2527239ms

// when no autoplay happens
196544:NDS: ^[2017:07:03 14:36:25]0946686106.897697 !MIL    -EPG_DLG      		< p:0x00000206 P:APP t:0x2c157520 T:no name M:DialogManager F:showDialog L:1405 > T:CEE-J EventQueue Reader 0:Showing dialog 1477
196545:NDS: ^[2017:07:03 14:36:25]0946686106.904516 !ERROR  -EPG_DEV1     		< p:0x00000206 P:APP t:0x2c157520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /playback/pdl/Riviera/end_of_recording_with_watch_next
196942:NDS: ^[2017:07:03 14:36:26]0946686107.004875 !ERROR  -EPG_DEV1     		< p:0x00000206 P:APP t:0x2c157520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /playback/pdl/Riviera/end_of_recording_with_watch_next


Content Markers for VOD
http://spvss-confluence.cisco.com/display/SE/Binge+Viewing

The following use cases are not scheduled for development:

Calculate Playback Time between Positions
Calculate Playback Time between Positions on MR Device
Notification of Playback across Content Markers

http://spvss-confluence.cisco.com/display/SE/Content+Markers+for+VOD

These are defined as follows:

PA Position	
The position within the PA, disregarding SAs. During playback, Playback
Positions within the SAs do not have a corresponding PA Position.

Playback Position	
This is the playback position reported by the MW. In this diagram, this is
continuous, e.g. it takes the duration of expired/removed SAs into account.
This is used to set the start of playback and for bookmarks.

Elapsed Playback Time	
The time required to play at normal speed from the beginning of the playlist
to a particular Playback Position. In this diagram, this has discontinuities
where SAs have expired and been removed, since it takes no time to skip the
removed SA. Therefore, Playback Positions in removed SAs are not reachable. If
playback starts from a bookmark is set in such a position, it actually
commences in the next available asset.

Note: From the EPG’s perspective, if it were to continuously poll the playback
position, the Elapsed Playback Time is continuous, and the Playback Position
would have discontinuities when skipping expired SAs.

http://spvss-confluence.cisco.com/display/FSUB/F2277+%3A+%5BMID-6988%5D+Storing+VOD+Content+Markers+in+PCAT


As an EPG developer, when starting the download of an asset/playlist, or
starting over its download, I want the VOD Content Markers string asset
property to be stored with bookings and exposed as a booking property so that
I can ascertain whether a particular Content Marker is present and access its
position, e.g. to trigger the Auto Play countdown.


={============================================================================
|kt_dev_si_0001| comp-atg comp-oigc comp-pdl

COMPONENT_NAME:=darwin_atg

Ian Moore was looking at ATG before now Steven Williams 

#
OIGC	On demand Information Generator Client

# suppose that atgs gets listing and info from OIG and get actuall DN from DLM.
ATG uses OIGC to get listings and information from OIG Server. (request to send to OIGC)
ATG uses DLM to get network status.

# from atg doc
Figure 5	Asset List Retrieval: Creation of the Iterator
[3][4] Then, the Client has to register the server connection to be warned if the OIG Server is alive and if the DLM connection status is OK.
[5][6] Then the client checks the network connection status and the VOD Catalogue Server status [7][8].

The server is alive if the Catalogue ID is retrieved successfully. Otherwise, it is not alive.


<vcs>
# VCS is Vod Catalog Server status.
Figure 15	Retrieval of Catalogue ID
This diagram represents the static behaviour. It does not take into account
the different events that can occur during the process of Retrieval of the
Catalogue ID like the removal of the card or a connection loss. 

ATG has to retrieve the Catalogue ID:

[2]ATG calls the method ATG_RetrieveCatalogId() which triggers the following process for the Catalogue ID retrieval.
[3] ATG needs an open session with PREF before it can get the lang value [4].
[5][6] ATG gets the user interface object from PREF, then the anytime handle [7][8].
[9] to [25] ATG uses VGC API to get the bouquet ID and subbouquet ID.
[26][27] ATG retrieves the STB version string from SYSINIT.
Finally, ATG retrieves the catalogue ID from OIGC and sends the status to its Clients.


<pdl-status>
// picasso/pdl/PdlServiceProbe.java
!MIL    -EPG_NET      		< M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 7003ms: pdlAvailable=false

public class PdlServiceProbe implements Runnable
	private boolean isPdlAvailable()
	{
		long start = System.currentTimeMillis();
		boolean pdlAvailable = atgSession.getVcsStatus();
		long end = System.currentTimeMillis();
		LOGGER.logMilestone("Probed PDL server in " + (end - start) + "ms: pdlAvailable=" + pdlAvailable);
		return pdlAvailable;
	}

// jpa/modules/jpa-api/src/java/com/nds/fusion/atg/AtgSession.java
	/**
	 * Get the Vod Catalog Server status.
	 *
	 * @return VCS status is ok (true) or not ok (false).
	 */
	boolean getVcsStatus();

// jpa/modules/jpa-impl/src/java/com/nds/fusion/atgimpl/AtgSessionImpl.java
	@Override public boolean getVcsStatus()
	{
		assertValid();
		return natAtgGetVcsStatus(nativeHandle);
	}

// jpa/modules/jpa-impl/src/c/src/natAtgSessionImpl.c
/*
 * Get the VOD Catalogue Server status
 */
JNIEXPORT jboolean JNICALL Java_com_nds_fusion_atgimpl_AtgSessionImpl_natAtgGetVcsStatus
  (JNIEnv *env, jclass jClass, jint param1)
{
    status = ATG_API_GetVcsStatus(sessionHandle, &isOK);
    if (status != ATG_API_STATUS_OK)
    {
        DIAG_LOG_ERROR(g_atg_adaptor_api_diag_segment_id, ("Failed to get vcs status"));
    }
}

// STB_SW/DARWIN_PLATFORM/DARWIN_ATG/src/atg_api_session.c
/** @brief Get the Vod Catalog Server status.
 *
 *  @param[in] session - The handle of the session.
 *  @param[out] isOK    - true: ATG status is OK else false.
 *  @retval #ATG_API_STATUS_OK in case of success
 *  @retval #ATG_API_STATUS_ERROR in case of failure
 *  @retval #ATG_API_STATUS_INVALID_PARAMETER if the iterator handle is not valid
 */
SYSTEM_STATUS ATG_API_GetVcsStatus(ATG_API_Session_Handle session,
                                   bool* isOK)
{
  // DARWIN_PLATFORM/DARWIN_ATG/src/oigc/atg_api_oigc.c
  SYSTEM_STATUS ATG_VODCL_GetVcsStatus(ATG_API_Session_Handle session,
                                   bool* isOK )
  {}
}


picasso/pdl/PdlServiceMonitor.java

	@Override public void notify(final int queueStatus, final int failureType)
	{
		Executors.submitOnAWT(new Runnable()
		{
			@Override public void run()
			{
				synchronized (PdlServiceMonitor.this)
				{
					LOGGER.logMilestone("PDL downloadqueue " + queueStatus + " failureType=" + failureType);
					pdlServiceStatus = pdlServiceStatus.setDownloadQueueStatus(queueStatus, failureType);
					notifyListeners();
				}
			}
		});
	}


!MIL    -EPG_DLG      		< p:0x000001e2 P:APP t:0x2bf25520 T:no name M:DialogManager F:showDialog L:1400 > T:CEE-J EventQueue Reader 0:Showing dialog 1344
!ERROR  -EPG_DEV1     		< p:0x000001e2 P:APP t:0x2bf25520 T:no name M:NotificationConverter F:setLastScreenSeen L:11 > T:CEE-J EventQueue Reader 0:setting last screen seen to /preferences/network_connection_successful

!MIL    -EPG_NET      		< M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 7003ms: pdlAvailable=false

!ERROR  -OIGC         		< T:OIGC thread list. M:oigc.c F:common_callback L:7321 > The timeout callback is being called\n 
!ERROR  -OIGC         		< T:OIGC thread list. M:oigc.c F:common_callback L:7321 > The timeout callback is being called\n 
!WARN   -ATG_API      		< T:ATG_CLIENT_HANDLE_EVENTS M:atg_api_oigc.c F:ATG_VODCL_Evt_Handler L:1789 > message status from OIGC is ERROR  => Retry the request  
!ERROR  -ATG_API      		< T:ATG_CLIENT_HANDLE_EVENTS M:atg_api.c F:ATG_ManageRetry L:2138 > ATG_GET_NUM_RETRY() > iteratorData->requestCounter : 3 > 0  
!MIL    -EPG_NET      		< T:no name M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 7003ms: pdlAvailable=false


# Registers a listener to receive OIG server status
registerServerConnection
		ATG_API_RegisterServerConnection

# oigc cfg
[MEM_CONFIG]
POOL_FLAGS_OIGC=0
POOL_NAME_OIGC="OIGC"
POOL_SIZE_OIGC=58900
[OIGC_DNS]
DNS_FLAG=1
DOMAIN_NAME="oig.sky.com"	# read into g_oig_server_dns. used in dns_input_parameter(). 
DOMAIN_PORT=3700
OIGC_DNS_RESPONSE_TIMEOUT=3500
TTL=3600
[OIG_CLIENT]
OIGC_CLIENT_PORT=12345
OIGC_PACKET_CAPTURE=0
OIGC_TIMEOUT=3500
[OIG_SERVER]
IP="80.238.12.230"
PORT=3700


ATG_API_STATUS_PROPERTY_NOT_AVAILABLE	0x13020007
ATG_API_STATUS_ERROR                    0x13020006


# use planner ses id 0
#
ATG_CLIENT_Evt_Handler_Thread
	PLANNER_API_Iterator_CreateNextElement
		PLANNER_Iterator_CreateElementAtIndex
			PLANNER_BookedProgramme_Create

#
ATG_VODCL_Session_RetrievePvodThumbnails
	PLANNER_API_Session_GetBookedProgramme
		PLANNER_Session_Get_Catalogue_ItemID
			PLANNER_DBINTERFACE_FindItem
				PLANNER_PostMessage(PLANNER_EV_FIND_ITEM)
				PLANNER_DBINTERFACE_FindItemID
					PLANNER_BookedProgramme_Create

/** Listener used to notify a change in a property on a monitored booked programme.
 * 
 * @see PlannerSession#registerBookedProgrammeChangeListener
*/
public interface PlannerBookedProgrammeChangeListener {

 interface PropertyID
 {
   /** The 'duration' attribute of the Booked Programme, in seconds */
   int DURATION                            = 1;
   /** The type of Booking of the Booked Programme */
   int BOOKINGTYPE                         = 2;
   /** Returns the space used (so far) by this programme or PDL asset on the disk in KB*/
   int DISKSPACE                           = 3;
   /** Keep parameter of the Booked Programme */
   int KEEPFLAG                            = 7;

   int PDLISREADYTOPLAY                    = 57;
 }
}

<comp-atg>

(void)ATG_API_SetAlarm(true, randomNumber, ATG_GET_CURRENT_SESSION() );

goes to:

// DARWIN_PLATFORM/DARWIN_ATG/src/atg_api.c
ATG_STATIC void ATG_API_AlarmScheduleThread(SYSTEMALARM_ALARM_HANDLE alarm_handle,
                                            uint32_t user_data_handle)
{
   ATG_Msg_Event_t msgEvent;  /**< List structure of message to send to client thread  */
   SYSTEM_STATUS system_status = ATG_API_STATUS_OK;

   ATG_DIAG_LOG_FN_ENTRY(("ATG_API_AlarmScheduleThread()"));

   /* -------------------- */
   /* Reschedule the alarm */
   /* ------------------- */
   msgEvent.eventType = (uint32_t) ATG_INFINITE_TIMER_RETRY_EVENT;
   msgEvent.data.userTag = ATG_GET_CURRENT_SESSION();
   msgEvent.data.status =  ATG_API_STATUS_OK;
   msgEvent.data.handle = 0U;
}


ATG_STATIC void * ATG_CLIENT_Evt_Handler_Thread (void *p)
{
  system_status = SYSTEMITC_API_ReadEvent(&ATG_GET_MSG_QUEUE());

  case ATG_TIMER_RETRY_EVENT:

}

SYSTEM_STATUS ATG_VODCL_Evt_Handler( ATG_Msg_Data_t  myMessage, uint32_t event )
{
      case ATG_TIMER_RETRY_EVENT:

         ATG_DIAG_LOG_INFO(("ATG_TIMER_RETRY_EVENT message is received"));
}


DARWIN_PLATFORM/DARWIN_ATG/src/atg_api.c

ATG_API_Ctxt_t  ATG_API_Ctxt;      /** @brief ATG Internal Context */

<oigc>
!WARN   -ATG_API      		< p:0x00000220 P:APP t:0x0112f520 T:PLANNER_MAIN M:atg_api_object_oigc.c F:ATG_VODCL_Object_CreateStringPropertyUsingKey L:6285 > OIGC indicates property not available 
!MIL    -aem          		< p:0x00000220 P:APP t:0x01497520 T:AEM_INPUT_MONITOR_THREAD M:aem_gfxevent.c F:AEM_GFXEvent L:240 > KEY_PRESS: code=0x(RECORD)e403 
!ERROR  -OIGC         		< p:0x00000220 P:APP t:0x012c5520 T:OIGC thread list. M:oigc.c F:oigc_recv_thread L:4382 > error message from server -> 04: Asset is not published in catalogue\n 


={============================================================================
|kt_dev_si_0001| comp-dlm

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/dlmimpl/DlmApiImpl.java

	@Override public void retrieveQueueStatus(DlmQueueStatusListener listener)
	{
		natDlmApiRetrieveQueueStatus(retrieveQueueStatusListeners.registerNew(listener));
	}

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/c/src/dlm_jpa_api.c

JNIEXPORT void JNICALL Java_com_nds_fusion_dlmimpl_DlmApiImpl_natDlmApiRetrieveQueueStatus(JNIEnv *env, jclass jClass, jint callbackId) {

    SYSTEM_STATUS status = status = DLM_API_RetrieveQueueStatus(retrieveQueueStatusCallback, (uint32_t) callbackId);

    JPA_DIAG_DECLARE_FUNCTION
    ;

    if (!SYSTEM_STATUS_IS_OK(status)) {
        DIAG_LOG_ERROR(g_dlm_adaptor_diag_segment_id, ("DLM_API_RetrieveQueueStatus failed: 0x%x", status));
    }

    maybeThrowException(env, status);
}


={============================================================================
|kt_dev_si_0001| comp-http comp-ctm comp-pdl

<pdl-download-speed-bitrate>
// slow speed?
!WARN   -RMF          		< p:0x000001f7 P:MW t:0x01bb3520 T:RMF_Server M:rmp_pdl_job.c F:RMP_PDL_JOB_GetBitrate L:446 > job=0x20104d2(0)[D] effective vfile size is still zero time diff=55 assuming default bitrate 


<HTTP_POOL>  
http.cfg
52:HTTP_POOL_FLAGS=0
53:HTTP_POOL_NAME="APP_HTTP_POOL"
54:HTTP_POOL_SIZE=224288
68:HTTP_POOL_FLAGS=0
69:HTTP_POOL_NAME="CA_HTTP_POOL"
70:HTTP_POOL_SIZE=38912
81:HTTP_POOL_FLAGS=0
82:HTTP_POOL_NAME="MW_HTTP_POOL"
83:HTTP_POOL_SIZE=388036


#define prvHTTP_MEMMAN_Malloc(size) \
    MEMMAN_API_AllocStaticP(httpMemmanHandle, (uint32_t)size)

#define SYSCONFIG_HTTP_POOL_PREFIX                  "HTTP_POOL"

// Looks likes that it add MW/APP to the pool name.

MW_MW_HTTP_POOL


        /* Initialize main pool */
        if (SYSTEMUTIL_THR_CreateMemoryPool(&httpMemmanHandle,
                                            SYSCONFIG_HTTP_FILENAME, 
                                            SYSCONFIG_HTTP_POOL_PREFIX, 
                                            true)
                                            != SYSTEMUTIL_STATUS_OK)

// function mappings
// CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/http/src/http_api.c

        if ((ret_curl = curl_global_init_mem(
                LINT_ERRORS_ONLY /* Exclude CURL_GLOBAL_ALL (comes from curl.h, open source) from lint checking */
                CURL_GLOBAL_ALL,
                LINT_RESTORE
#ifdef HTTP_MEMMAN_USE_MACRO
                HTTP_MEMMAN_Malloc,
                HTTP_MEMMAN_Free,
                HTTP_MEMMAN_Realloc,
#else /* HTTP_MEMMAN_USE_MACRO */
                prvHTTP_MEMMAN_Malloc,
                prvHTTP_MEMMAN_Free,
                prvHTTP_MEMMAN_Realloc,
#endif /* HTTP_MEMMAN_USE_MACRO */
                NDS_HTTP_strdup,
                prvHTTP_MEMMAN_Calloc)) != CURLE_OK)


<comp-ctm>
note:
1. LOG should be analysed per process since each process uses HTTP.

2. NO expired cookies since data->cookies, data->share->cookies are the same.
Hence NO Curl_cookie_cleanup_expired_cookies to OOM

T:CTM_SVR_DL_CONTENT M:libcurl_http.c F:Curl_http_patch_expired_cookies L:344 > 
KIT: free cookie: data->share(0x1da2928), data->cookies(0x1da2458), data->share->cookies(0x1da2458)
`libcurl_http.c is NDS code but not libcurl`

3. NO Curl_flush_cookies() to OOM


SBM uses CTM to download PDL

CMS_MEDIA_SERVICES/CTM/src/server/ctm_svr_file_transfer_manager.c

note: From libcurl

https://curl.haxx.se/libcurl/c/curl_easy_perform.html
https://curl.haxx.se/libcurl/c/curl_easy_cleanup.html

You can do any amount of calls to curl_easy_perform while using the same
easy_handle. If you intend to transfer more than one file, you are even
encouraged to do so. libcurl will then attempt to re-use the same connection
for the following transfers, thus making the operations faster, less CPU
  intense and using less network resources. Just note that you will have to
    use curl_easy_setopt between the invokes to set options for the following
    curl_easy_perform. 

https://curl.haxx.se/libcurl/c/libcurl-errors.html#CURLEOK
CURLE_WRITE_ERROR (23)
An error occurred when writing received data to a local file, or an error was
returned to libcurl from a write callback.


static CTM_SVR_FTM_P_DL_Context_t g_dl_ctx[FTM_NB_CTX];

typedef struct _CTM_SVR_FTM_P_DL_Context_t
{
  CTM_Download_Request_t request;
}


dl_ctx = &g_dl_ctx[i];

if (SYSTEMUTIL_THR_Create(&dl_ctx->download_thread,
                    (i==FTM_ID_CONTENT) ? "CTM_SVR_DL_CONTENT" : "CTM_SVR_DL_TRAILER",
                    CTM_SVR_FTM_Download_Thread,
                    (void*)dl_ctx, g_ctm_svr_systemutil_ctx) == SYSTEMUTIL_STATUS_OK)

// allocte a handle, calloc
handle = (HTTP_API_Handle_t *) curl_easy_init();

CTM_SVR_FTM_Download_Thread()
{
  CTM_SVR_FTM_P_DL_Context_t * dl_ctx = (CTM_SVR_FTM_P_DL_Context_t*)p;

  // loop per request
  while(keep)
  {
    // do download per a requst message
    CTM_SVR_FTM_WaitForRequest(dl_ctx, &thread_request_received);

    // `get global request` which is null at first  
    // do not alloc for requst itself but do alloc for sub structrue
    const CTM_Download_Request_t* request = &dl_ctx->request;

    /* Set the HTTP options depending on the request */

    CTM_FTM_SetHTTPOptions( dl_ctx );
    // static SYSTEM_STATUS CTM_FTM_SetHTTPOptions( CTM_SVR_FTM_P_DL_Context_t* dl_ctx )
    // {
    //   else if ( dl_ctx->request.http_request_type == REQUEST_TYPE_JSON_POST )
    //   {
    //     struct HTTP_API_Slist *l_http_list = dl_ctx->request.http_hdr_list;
    // 
    //     CTM_SVR_DBG_INFO(("- Configure HTTP for JSON POST requests"));
    // 
    //     // add a node to the list. what if list is not null when is
    //     supposed to be null?
    //     l_http_list = HTTP_API_SlistAppend(l_http_list, "Content-Type: application/json");
    //
    //     // `update global request` which is the fix made and update `request` as well.
    //     dl_ctx->request.http_hdr_list = l_http_list;
    //   }
    // }

    perform_info.handle = dl_ctx->handle;

    // ctm_svr_file_transfer_manager.c:2339
    // perform_info is local structure
    //
    // ctm_svr_standard_communication.c:74
    // still no allocation
    // CTM_SVR_HTTP_PerformStandard(CTM_SVR_PerformInfo_t* download_info)
    http_perform_post_action = CTM_SVR_HTTP_PerformStandard(&perform_info);
    {
      ret = HTTP_API_Perform(download_info->handle);
      // SYSTEM_STATUS HTTP_API_Perform(HTTP_API_Handle_t * handle)
      {
        status = ConvErrorCodeLib2HTTP( (uint8_t)curl_easy_perform((CURL *)handle) );

        else
        {
            /* If perform failed, we don't do any post processing but try to
             * give the caller relevant information about the error */

            DBG_PRINT_E(("Perform failure. status : %#x", status));
            status = HTTP_SAC_SYNC_ProcessSACPerformError( status );
        }
      }

      return http_perform_post_action;
    }

    /* We are finished with this request */
    // do per request
    CTM_SVR_FTM_CleanUpRequest( const request );
    // `use request`
    // if ( request->http_hdr_list != NULL )
    // {
    //     CTM_SVR_DBG_ERROR(("** KIT: SI-10728: IRH: HIJACK **"));
    //     (void)HTTP_API_SlistFreeAll(request->http_hdr_list);
    //
    //     // note: this is missed. should be implemented?
    //     // request->http_hdr_list = NULL;
    // }
  }
}


// note: when cookies are freed? Here. Keep a session live until gets closed.

int32_t CTM_SVR_FTM_Term( void )
{
  // #define FTM_NB_CTX                  3
  
  for (i=0; i< FTM_NB_CTX; i++)
  {
    HTTP_API_SessionDestroy(`dl_ctx->handle`);
    {
      curl_easy_cleanup((CURL *) handle);
      { 
        Curl_close(data);
          Curl_flush_cookies(data, 1);
      }
    }
  }
}


SYSTEM_STATUS CTM_SVR_FTM_Init(CTM_SVR_FTM_Callback_t *callback)
{
  // only one session
  dl_ctx->handle = HTTP_API_SessionCreate();

  HTTP_API_Handle_t *HTTP_API_SessionCreate(void)
  {
    handle = (HTTP_API_Handle_t *) curl_easy_init();
  }
}

/*
 * Initiate a download request using the passed parameters (see header file)
 */
int32_t CTM_SVR_FTM_RequestDownload(int32_t ftm_id, const CTM_Download_Request_t* request)
{
}

!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2235 > Downloading... 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2236 > Use bitrate of 40000 

!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1577 > - Set option : SET HTTP VERSION 1.1 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1586 > - Set option : DONT IGNORE_CONTENT_LENGTH 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1595 > - Set option : NORMAL GET 0 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1604 > - Set option : BUFFERSIZE 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1613 > - Set option :HTTP_API_OPT_FAILONERROR 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1638 > - Set mode HTTP_API_SECURITY_MODE_DIGEST_SRP_SCHEME 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetDefaultHTTPOptions L:1673 > - Set default header 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:1810 > No range 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:1829 > - Set option : URL <http://cdn.sky.com/60440/1174/bsky_4od-MAIN000000[2016:09:05 18:20:58]0000368413-20160820[2042:03:25 21:40:45]1753350000.nff_001477174_02403.oecm> 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:1861 > - Reset default headers 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:1976 > - Set option HTTP_API_OPT_COOKIEFILE: 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:1986 > - Set option HTTP_API_OPT_FOLLOWLOCATION: 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2012 > - Set option HTTP_API_OPT_IPRESOLVE [1] 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2046 > No referrer 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2049 > - Set option HTTP_API_OPT_TCP_KEEPALIVE : 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2058 > - Set option HTTP_API_OPT_LOW_SPEED_LIMIT : 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2067 > - Set option HTTP_API_OPT_LOW_SPEED_TIME : 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_FTM_SetHTTPOptions L:2076 > - Set option HTTP_API_OPT_MAXREDIRS 123 : 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2296 > - HTTP_API_Perform ! 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2353 > HTTP_API_Perform : Request 
!ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:http_api.c F:HTTP_API_Perform L:1789 > KIT: Calling curl_easy_perform() 

!ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:http_api.c F:HTTP_API_Perform L:1791 > KIT: from curl_easy_perform(): status = 0xd400000 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2399 > - HTTP_API_Perform : Successful 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2485 > Total written to disk [00000000 00001ec2] 
!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2488 > Close file (fd=388) 

!INFO   -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_Download_Thread L:2509 > Download finished ok: 'http://cdn.sky.com/60440/1174/bsky_4od-MAIN000000[2016:09:05 18:20:58]0000368413-20160820[2042:03:25 21:40:45]1753350000.nff_001477174_02403.oecm' 
!ERROR  -CTM_SVR < P:MW T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_CleanUpRequest L:2096 > ** KIT: SI-10728: IRH: HIJACK { ** 


<ctm-download-asset>
// d9478006 is a jobid 
!INFO   -CTM          		< P:MW T:SBM_UB_MAIN M:ctm_job_request.c F:CTM_API_JOB_Commit L:460 > CTM_API_JOB_Commit d9478006 ok 

!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:CTM_PARAM_SetOECMPolicy L:308 > CTM_PARAM_SetOECMPolicy ok 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:CTM_PARAM_SetStartPolicy L:388 > -> CTM_RESUME_POLICY 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:CTM_PARAM_SetStartPolicy L:407 > CTM_PARAM_SetStartPolicy ok (44000001) 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:`CTM_PARAM_SetAssetURI` L:453 > CTM_PARAM_SetAssetURI ok (http://cdn.sky.com/60422/est__sbo_hd/preview-est3/est__sbo_hd-TRVT990000[2017:05:30 12:44:28]0000011853-20161206[2009:11:26 18:26:40]1259260000-VMS.nff?u=57300393&c=t&s=n) 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:CTM_PARAM_SetReferrerData L:553 > CTM_PARAM_SetReferrerData ok (urn:sky:vod:v1:Darwin:cat:HPSTORER13:Sky%20%20Store:Movies:Buy%20%26%20Keep:EST3B:STB%20EST3B:STB%20Full%20EST%20Offer%203b) 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_pbag.c F:CTM_PARAM_SetIPFamily L:794 > CTM_PARAM_SetIPFamily ok (0x1) 
!INFO   -CTM          		< P:MW T:DLM_HANDLEEVENTS M:ctm_job_request.c F:CTM_API_JOB_Start L:526 > CTM_API_JOB_Start 2ba78006 ok 


<comp-http-status>
#define HTTP_COMP_ID          ((uint32_t)(53)) /*!< @brief HTTP */
#define HTTP_API_ID       (0)

#define SEVERITY_NONE    ((uint32_t)(0x0))
#define SEVERITY_WARNING ((uint32_t)(0x1))
#define SEVERITY_SEVERE  ((uint32_t)(0x2))
#define SEVERITY_FATAL   ((uint32_t)(0x3))

(((COMP_COMP_ID & 0x3FF) << 22) | ((SEVERITY & 0x3) << 16) | ((COMP_IF_ID & 0xF) << 12) | (STATUS & 0xFFF) )

hex(((53 & 0x3FF) << 22) | ((3 & 0x3) << 16) | ((0 & 0xF) << 12) | (0 & 0xFFF) )
'0xd430000'

#define HTTP_API_E_OK                      (_HTTP_INFO(0))    /*!< @brief Success */
`0xd400000`

#define HTTP_API_E_COULDNT_CONNECT         (_HTTP_FATAL(7))   /*!< @brief Couldn't connect to server */
Perform failure. status : `0xd430007` 

hex(((53 & 0x3FF) << 22) | ((3 & 0x3) << 16) | ((0 & 0xF) << 12) | (10 & 0xFFF) )
#define HTTP_API_E_WRITE_ERROR             (_HTTP_FATAL(10))  /*!< @brief Failed writing received data */

// #define HTTP_API_E_HTTP_RETURNED_ERROR     (_HTTP_FATAL(9))   /*!< @brief HTTP response code said error */
F:HTTP_API_Perform L:1722 > curl_easy_perform(): status = 0xd430009 

//CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/http/src/http_conv.c
`arrayErrorCodeLibToHTTP`[CURLE_WRITE_ERROR] = HTTP_API_E_WRITE_ERROR;
`0xd43000a`

hex(((53 & 0x3FF) << 22) | ((3 & 0x3) << 16) | ((0 & 0xF) << 12) | (13 & 0xFFF) )
#define HTTP_API_E_OPERATION_TIMEOUTED     (_HTTP_FATAL(13))  /*!< @brief A timeout time was reached */
`0xd43000d`


/// #define HTTP_API_E_ABORTED_BY_CALLBACK     (_HTTP_FATAL(18))  /*!< @brief The operation was aborted by an application callback */
0xd430012


/*! @brief  HTTP fatal error definition */
#define _HTTP_FATAL(e)  \
        SYSTEM_MAKE_COMPONENT_STATUS(\
                                HTTP_COMP_ID,\
                                HTTP_API_ID,\
                                SEVERITY_FATAL,\
                                (e))

!ERROR  -HTTP         		< T:CTM_SVR_DL_CONTENT M:http_api.c 
  F:HTTP_API_Perform L:1811 > Perform failure. status : 0xd43000a 


<comp-http-diag>
CTM_SVR_DBG_ERROR(("** KIT: SI-10728: IRH: HIJACK } **"));

!ERROR  -CTM_SVR                   < T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_FTM_CleanUpRequest L:2099 > *
* KIT: SI-10728: IRH: HIJACK { **

// HTTP diag from manatee makes on HTTP but not LIBCURL

<note>
Curl_cookie_init is called continously but not once for each process. But
cookie list remains valid between this calls.

T:CTM_SVR_DL_CONTENT M:cookie.c F:Curl_cookie_init L:977 > KIT: cookie file() 


<process-and-thread>
$ grep TRACE_LEVEL_LIBCURL LOGlastrun_realtime
!INFO   -HTTP < P:`CA` t:0x00991810 T:no name M:http_api.c F:`HTTP_API_Init` L:452 > To activate libcurl traces : please use the diag segment TRACE_LEVEL_LIBCURL = \"FEWI!APR<>\" in the file diag.cfg
!INFO   -HTTP < P:MW t:0x01d5e520 T:AMS_FTM_HTTP_REQUEST_HANDLER M:http_api.c F:HTTP_API_Init L:452 > To activate libcurl traces : please use the diag segment TRACE_LEVEL_LIBCURL = \"FEWI!APR<>\" in the file diag.cfg
!INFO   -HTTP < P:APP t:0x01108520 T:GUIDE_MAIN M:http_api.c F:HTTP_API_Init L:452 > To activate libcurl traces : please use the diag segment TRACE_LEVEL_LIBCURL = \"FEWI!APR<>\" in the file diag.cfg

!INFO   -HTTP < P:MW t:0x0228a520 T:WLM_MONITOR M:http_api.c F:HTTP_API_Perform L:1788 > Calling curl_easy_perform()
!INFO   -HTTP < P:APP t:0x0139c520 T:ATG_FTM_HTTP_DWL M:http_api.c F:HTTP_API_Perform L:1788 > Calling curl_easy_perform ()
!INFO   -HTTP < P:MW t:0x01e16520 T:CTM_SVR_DL_CONTENT M:http_api.c F:HTTP_API_Perform L:1788 > Calling curl_easy_perform()


<comp-libcurl>

<curl-version>
CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/lib/curl/curl_v7_26_0/src/cookie.c
CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/lib/curl/curl_v7_15_2/src/cookie.c
CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/lib/curl/curl_v7_21_3/src/cookie.c

Use curl_v7_26_0

/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components/misc_libraries/http/src/lib/curl/curl_v7_26_0$ nm libhttp_curl.a | grep NDS_HTTP_strdup
279:         U NDS_HTTP_strdup
2169:         U NDS_HTTP_strdup
2170:00000000 T NDS_HTTP_strdup_DEBUG

/build/picasso/AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_dbg/components/misc_libraries/http/src/lib/upset$ nm libhttp_upset.a | grep NDS_HTTP_strdup
12:00000000 T NDS_HTTP_strdup

kyoupark@st-castor-03:~/STB_SW/CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/lib/curl$ ls -al
drwxr-xr-x 4 kyoupark ccisco 4096 Jul 12 08:18 curl_v7_60_0


// Manatee adds LIBCURL which works 
NDS_BUILD_TYPE_http_curl=debug

// CMS_SYSTEM_INFRASTRUCTURE/HTTP/src/lib/curl/curl_v7_26_0/makefile
COMPONENT_NAME:=http_curl
include $(NDS_ROOT)/projects/$(NDS_PROJECT)/build_options.mk

CMS_SYSTEM_INFRASTRUCTURE/HTTP/inc/config/http_master_config.xml
11:    <key name="TRACE_LEVEL_LIBCURL" type="STRING" value="AFEWM">

// <key name="TRACE_LEVEL_LIBCURL" type="STRING" value="AFEWMI&lt;&gt;"/>

!ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:cookie.c F:Curl_cookie_add L:257 > KIT: co = calloc(56) 


// *booking-job-id* in PCAT

note:
When there are network glitch, ctm job failed and resumed again then start
time will be the one last successful commit state.

<pdl-status-queue> <pdl-download>

<comp-dpl>
applications/Picasso/picasso/Picasso/src/java/picasso/bookingmgr/DownloadQueueModel.java

	private void activateQueue(boolean resume)
	{
		final int action = (resume) ? DlmApi.QueueAction.RESUME : DlmApi.QueueAction.PAUSE;
		modelExecutor.runLater(new Runnable()
		{
			@Override public void run()
			{
				dlmApi.manageQueue(manangeQueueListener, action);
			}
		});
	}

./THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion/dlm/DlmApi.java
	/**
	 * Manage the download queue by performing actions in {@link QueueAction}.
	 *
	 * @param listener User defined function that is called on completion of action.
	 * @param action   The action to perform on the download queue, valid values from {@link com.nds.fusion.dlm.DlmApi.QueueAction}
	 */
	void manageQueue(DlmManangeQueueListener listener, int action);

DlmApiImpl.java
	@Override public void manageQueue(DlmManangeQueueListener listener, int action)
	{
		natDlmApiManageQueue(action, manageQueueListeners.registerNew(listener));
	}

JNIEXPORT void JNICALL Java_com_nds_fusion_dlmimpl_DlmApiImpl_natDlmApiManageQueue(JNIEnv *env, jclass jClass, jint actionIndex, jint callbackId) {

    DLM_API_ACTION_QUEUE_STATUS action = (DLM_API_ACTION_QUEUE_STATUS) actionIndex;
    SYSTEM_STATUS status = DLM_API_ManageQueue(manageQueueListenerCallback, action, callbackId);

    JPA_DIAG_DECLARE_FUNCTION
    ;

    if (!SYSTEM_STATUS_IS_OK(status)) {
        DIAG_LOG_ERROR(g_dlm_adaptor_diag_segment_id, ("DLM_JAVA_API_ManageQueue failed: 0x%x", status));
    }

    maybeThrowException(env, status);
}


// DPL
// firstIsDpl = firstPbp.isDynamicPlaylist();
//
// public interface DlmQueueStatusListener {
// 
//     /**
//      * Defines possible outcomes for action performed on the download queue.
//      */
//     interface QueueStatus
//     {
//         /** queue is active */
//         int ACTIVE = 41;
// 
//         /** queue has been paused by the user */
//         int USER_PAUSED = 42;
// 
//         /** queue has been paused by the system */
//         int SYSTEM_PAUSED = 43;
// 
//         /** queue has been paused by the system, but the user can resume */
//         int RETRY_PAUSED = 44;
//     }
// }
//
// <pdl-status-failure-type> firstFailureReason failureType *booking-exception* *booking-state*
// import static com.nds.fusion.systemcommon.SystemCommonFailureType.NO_EXCEPTION; 100
//
// public enum ProgrammeState
// {
// 	UNKNOWN("FAILED"),
// 
// 	NOT_BOOKED(""),
// 	REMINDER("BOOKED"),
// 	SCHEDULED("SCHEDULED"),
// 	PART_SCHEDULED("SCHEDULED"),
// 	PREPARING_DOWNLOAD("DOWNLOADING"),
// 	DOWNLOADING_BUT_NOT_AVAILABLE("DOWNLOADING"),
// 	DOWNLOADING_AND_AVAILABLE("AVAILABLE"),
// 	RECORDING("RECORDING"),
// 	PART_RECORDING("RECORDING"),
// 	RECORDED("RECORDED"),
// 	PART_RECORDED("PART REC"),
// 	FAILED("FAILED"),
// 	TIMEOUT("FAILED"),
// 	DELETING("DELETING"),
// 	ARCHIVED("ARCHIVED"),
// 	DOWNLOADED("DOWNLOADED"),
// 	PENDING("PENDING");
// }


typedef enum PLANNER_API_BookingStateTag
{
    PLANNER_API_BOOKING_STATE_UNDEF             = 0U,
    PLANNER_API_BOOKING_STATE_BOOKED            = 1U, /**<@brief Booked pending action*/
    PLANNER_API_BOOKING_STATE_RECORDED          = 2U, /**<@brief Booked programme has been recorded */
    PLANNER_API_BOOKING_STATE_RECORDING         = 3U, /**<@brief Currently recording, includes all of the event so far */
    PLANNER_API_BOOKING_STATE_NOT_RECORDED      = 4U, /**<@brief Booked programme which was to be recorded, was not */
    PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED  = 5U, /**<@brief Booked programme has finished recorded, but part of the programme is missing */
    PLANNER_API_BOOKING_STATE_PARTIAL_RECORDING = 6U, /**<@brief Currently recording, but the recording does not include all of the event so far */
    PLANNER_API_BOOKING_STATE_DELETING          = 7U, /**<@brief Booking in the process of being deleted. If the booking is in this state, no other properties shoudl be retrieved*/
    PLANNER_API_BOOKING_STATE_LASTVALUE         = 8U

} PLANNER_API_BookingState;

// DARWIN_PLATFORM/DARWIN_PLANNER/src/planner_bookedprogramme_properties.c
SYSTEM_STATUS PLANNER_BookedProgramme_GetBookingState( PCAT_VIEW_VALUE_LIST value_list)
{
  // *pact-record-status* PCAT_VIEW_VLIST_GetInt(PCAT_CAT_PROP_RECORD_STATUS);
  // *pcat-content-status* PCAT_VIEW_VLIST_GetInt(PCAT_CAT_PROP_CONTENT_STATUS);

    PLANNER_API_BookingState PLANNER_BookedProgramme_MapPCATState(uint32_t record_state,uint32_t completion_state, bool failed)
    {
      PLANNER_API_BookingState l_state;

      DIAG_DECLARE_FUNCTION("PLANNER_BookedProgramme_MapPCATState");
      DIAG_LOG_FN_ENTRY(g_planner_diag_segment_id);

      DIAG_LOG_INFO(g_planner_diag_segment_id, ("record_state: %u completion_state: %u failed: %d\n", record_state, completion_state, failed));

      if (failed == true)
      {
        l_state = PLANNER_API_BOOKING_STATE_NOT_RECORDED;
      }
      else
      {
        switch (record_state)
        {
          case PCAT_CAT_RECORD_STATUS_TO_RECORD:
            switch(completion_state)
            {
              case PCAT_CAT_CONTENT_STATUS_NO_CONTENT:
                l_state = PLANNER_API_BOOKING_STATE_BOOKED;
                break;
              case PCAT_CAT_CONTENT_STATUS_PARTIAL:
                /* This combination may occur for a partial recording that is being resumed */
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              case PCAT_CAT_CONTENT_STATUS_ALL:
                l_state = PLANNER_API_BOOKING_STATE_RECORDED;
                break;
              case PCAT_CAT_CONTENT_STATUS_SUSPENDED:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              default:
                l_state = PLANNER_API_BOOKING_STATE_UNDEF;
                break;
            }
            break;

          case PCAT_CAT_RECORD_STATUS_START_RECORDING:
            switch(completion_state)
            {
              case PCAT_CAT_CONTENT_STATUS_NO_CONTENT:
#ifdef HOME_NETWORK_ABR_RECORDING
                /* For HIP bookings which are in the start recording state but which have no content
                   should be reported as recording. The recording will be triggered automatically when
                   the user chooses to view it */
                l_state = PLANNER_API_BOOKING_STATE_RECORDING;
#else
                l_state = PLANNER_API_BOOKING_STATE_BOOKED;
#endif
                break;
              case PCAT_CAT_CONTENT_STATUS_PARTIAL:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              case PCAT_CAT_CONTENT_STATUS_ALL:
                l_state = PLANNER_API_BOOKING_STATE_BOOKED;
                break;
              case PCAT_CAT_CONTENT_STATUS_SUSPENDED:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              default:
                l_state = PLANNER_API_BOOKING_STATE_UNDEF;
                break;
            }
            break;

          case PCAT_CAT_RECORD_STATUS_RECORDING:
            switch(completion_state)
            {
              case PCAT_CAT_CONTENT_STATUS_PARTIAL:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDING;
                break;
              case PCAT_CAT_CONTENT_STATUS_ALL:
                l_state = PLANNER_API_BOOKING_STATE_RECORDING;
                break;
              case PCAT_CAT_CONTENT_STATUS_SUSPENDED:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDING;
                break;
              default:
                l_state = PLANNER_API_BOOKING_STATE_UNDEF;
                break;
            }
            break;

          case PCAT_CAT_RECORD_STATUS_STOPPING:
            switch(completion_state)
            {
              case PCAT_CAT_CONTENT_STATUS_PARTIAL:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDING;
                break;
              case PCAT_CAT_CONTENT_STATUS_ALL:
                l_state = PLANNER_API_BOOKING_STATE_RECORDING;
                break;
              case PCAT_CAT_CONTENT_STATUS_SUSPENDED:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDING;
                break;
              default:
                l_state = PLANNER_API_BOOKING_STATE_UNDEF;
                break;
            }
            break;

          case PCAT_CAT_RECORD_STATUS_ENDED:
            switch(completion_state)
            {
              case PCAT_CAT_CONTENT_STATUS_PARTIAL:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              case PCAT_CAT_CONTENT_STATUS_ALL:
                l_state = PLANNER_API_BOOKING_STATE_RECORDED;
                break;
              case PCAT_CAT_CONTENT_STATUS_SUSPENDED:
                l_state = PLANNER_API_BOOKING_STATE_PARTIAL_RECORDED;
                break;
              default:
                l_state = PLANNER_API_BOOKING_STATE_UNDEF;
                break;
            }
            break;

          default:
            DIAG_LOG_ERROR(g_planner_diag_segment_id, ("Invalid arguments: record_state %u completion_state %u failed %s", record_state, completion_state, ((failed == true) ? "true" : "false")));
            l_state = PLANNER_API_BOOKING_STATE_UNDEF;
            break;
        }
      }

      DIAG_LOG_FN_EXIT(g_planner_diag_segment_id, l_state);
      return l_state;
    }
}

//build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/c/src/natPlannerBookedProgrammeImpl.c
JNIEXPORT jint JNICALL Java_com_nds_fusion_plannerimpl_PlannerBookedProgrammeImpl_natPlannerApiBookedProgrammeGetBookingState
  (JNIEnv *env, jclass jClass, jint param1)
{
    /* Retrieve the booking state from the C component */
    status = PLANNER_API_BookedProgramme_GetPropertyBookingState(jHandle,
                                                                 PLANNER_API_BOOKEDPROG_PROPID_BOOKINGSTATE,

    /* The booking state is an integer and so may be returned directly */
    jReturnVal = (uint32_t)l_state;
}


build/applications/Picasso/picasso/jpa/modules/jpa-api/src/java/com/nds/fusion/planner/PlannerBookingState.java

/** Current state of a Booked Service Event */
public interface PlannerBookingState
{
	/** pbp not in planner (e.g pbp in conflict resolution process) */
    int UNDEFINED = 0;

    /** Booked pending action*/
    int BOOKED = 1;

    /** Booked programme has been recorded */
    int RECORDED = 2;

    /** Currently recording */
    int RECORDING = 3;

    /** Booked porgramme which was to be recorded, was not */
    int NOT_RECORDED = 4;

    /** Booked programme has finished recorded, by part of the programme is missing */
    int PARTIAL_RECORDED = 5;

    /** Booked programme which is currently recording, but the recording does not include all of the event so far */
    int PARTIAL_RECORDING = 6;

    /** Booked programme which is in the process of being deleted. If the booking is in this state, no other properties shoudl be retrieved*/
    int DELETING = 7;

}
// build/applications/Picasso/picasso/jpa/modules/jpa-impl/src/java/com/nds/fusion/plannerimpl/PlannerBookedProgrammeStateMapper.java
			case PlannerBookingState.PARTIAL_RECORDED:
				return ProgrammeState.PART_RECORDED;

//
// build/applications/Picasso/picasso/Picasso/src/java/picasso/pdl/DownloadQueueState.java
//
public class DownloadQueueState implements Lifecycle
{
	public static final DownloadQueueState INITIAL_STATE = new DownloadQueueState(ACTIVE, NO_EXCEPTION, null, ProgrammeState.UNKNOWN, NO_EXCEPTION, false);

	private final int                       status;
	private final int                       failureType;
	private final PlannerPdlBookedProgramme firstPbp;
	private final ProgrammeState            firstStatus;
	private final int                       firstFailureReason;
	private final boolean                   firstIsDpl;

	private DownloadQueueState(int status, int failureType, PlannerPdlBookedProgramme firstPbp, ProgrammeState firstStatus, int firstFailureReason, boolean firstIsDpl)
	{
		this.status = status;
		this.failureType = failureType;
		this.firstPbp = Lifecycles.newRef(firstPbp);
		this.firstStatus = firstStatus;
		this.firstFailureReason = firstFailureReason;
		this.firstIsDpl = firstIsDpl;
	}

// THIRD_PARTY_LIBRARIES/BSKYB_JTH/build/applications/Picasso/picasso/Picasso/src/java/picasso/pdl/DownloadQueueMonitor.java
//
//			@Override public void onDownloadQueueUpdate(DownloadQueueState oldState, DownloadQueueState newState)
//			{
//				PlannerPdlBookedProgramme oldFirstPbp = oldState.getFirstPbp();
//				PlannerPdlBookedProgramme newFirstPbp = newState.getFirstPbp();
//				try
//				{
//					String debug = "Download queue changed:"
//							+ addDebug("queueStatus", oldState, newState, MAP_QUEUE_STATUS)
//							+ addDebug("queueFailureType", oldState, newState, MAP_QUEUE_FAILURE_TYPE)
//							+ addDebug("firstPbp", oldFirstPbp, newFirstPbp, MAP_FIRST_PBP)
//							+ addDebug("firstStatus", oldState, newState, MAP_FIRST_STATUS)
//							+ addDebug("firstFailureReason", oldState, newState, MAP_FIRST_FAILURE_REASON)
//							+ addDebug("firstIsDpl", oldState, newState, MAP_FIRST_IS_DPL);
//					LOGGER.logMilestone(debug);
//				}
//				finally
//				{
//					Lifecycles.release(oldFirstPbp);
//					Lifecycles.release(newFirstPbp);
//				}
//			}

egrep -an "EPG_NET|CTM_SVR|DLM_SVR|Download|DOWNLOAD|

>>> hex(688316759) '0x2906e157'
Seen|PDL |2016:09:26 06:12:24|2016:09:26 06:12:59|Anna Scher: In Confidence               |s66709|    0|  1|Sky Arts            |     0| 0.25|        |UNDF  |    |688316759

!MIL    -EPG_TVVM     		< P:APP T:no name M:ServiceInfo F:doProgrammeChanged L:1341 > T:PooledExecutor#1:PICASSODEV-19255 ServiceInfo.doProgrammeChanged Programme Matches current event in Banner: Anna Scher: In Confidence
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "StartAgain","action": "Download","title": "Anna Scher: In Confidence","label": "Title:Anna Scher: In Confidence;State:NOT_BOOKED;Type:Ents","currentscreen": "/tv/live/121/start_again_mini_banner"}

!MIL    -PCATS   P:MW T:SBM_UB_MAIN M:pcat_view_clnt.c F:PCAT_VIEW_CommitJob L:3077 > client id = 0x5, `bookingJobID = 0x2906e157`

// Q: how maps vrm job and ctm job?

// note: search ctm job with no-case



// `STARTED`
!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job `0xca278008` (Type = 2) from 3 (CREATED) to 4 (COMMITED) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[`0xCA278008`] ; ctm_status=[UNKNOWN_CTM_STATUS](0x63000040) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_READY_TO_DOWNLOAD](0x63000001) 

!MIL    -EPG_NET                    < p:0x0000021c P:APP t:0x2e03a520 T:no name M:HttpNotifier F:send L:31 > 
  d3=508288677&cd4=off&cd5=off&de=UTF-8&t=event&cd=%2Fanytime&ec=AssetAction&el=Title%3DThe+Martian%3BState%3DNOT_BOOKED%3Btemplatename%3DMultiFormat&ea=SELECT

!MIL    -EPG_MISC                   < p:0x000001f6 P:APP t:0x2bfeb520 T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category":
"StartAgain", `"action": "Download"`,"title": "Anna Scher: In Confidence","label": "Title:Anna Scher: In Confidence;State:NOT_BOOKED;Type:Ents","currentscreen": "/tv/live/121/start_again_mini_banner"}


!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:`onDownloadQueueUpdate` L:251 > T:DownloadQueueMonitor#0:
  Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:null->"Anna Scher: In Confidence" 
  `firstStatus:UNKNOWN->SCHEDULED` firstFailureReason:100->0 firstIsDpl:false->true

!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_READY_TO_DOWNLOAD](0x63000001) 
!WARN   -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Override_Active_Job L:2255 > Replacing active job: [tag=R2D-A ; id=0x00000173 ; job_id=0xCA278008] 

// ctm job is different from vrm job
!MIL    -RMF          		< p:0x00000202 P:MW t:0x01e5d520 T:CTM_SVR_HANDLEREQUESTS M:rmf_allocate.c F:RMF_ALLOCATE_ControlPermissions L:1012 > job=0x201004e(0)[D] request=0x10004000 released=0xf0000000 change request if fails. 

!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 4 (COMMITED) to 1 (STARTED) 
!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_1_DPL_DOWNLOAD_RESPONSE 

!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:
  41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence" 
  `firstStatus:SCHEDULED->PREPARING_DOWNLOAD` firstFailureReason:0->100 firstIsDpl:true

!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_2_DPL_DOWNLOAD_TOC 
!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_3_DPL_OECM_IMPORT 
!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_4_DPL_CATALOG_DL 
!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_5_DPL_INDEX_DL 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_JOB_STARTED](0x63000004) 

!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: 
  queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence" 
  `firstStatus:PREPARING_DOWNLOAD->DOWNLOADING_BUT_NOT_AVAILABLE` firstFailureReason:100 firstIsDpl:true

!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_6_DPL_INDEX_`IMPORT`_START_DL 

// <pdl-import> creates vrm import sesssion and job
!WARN   -CTM_SVR      		< P:MW t:0x01dbb520 T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_Import_StartImport L:7792 > Index import started 
!MIL    -CTM_SVR      		< P:MW t:0x01e3e520 T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_ConcludeDPLAssetContentDownload L:10505 > Restamping done 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:921 > 
  VRM-FSM: VRM_IMP_OBJECT_0x50004: VRM_IMP_OBJECT_INT_STATE_NULL -> (VRM_IMP_OBJECT_STATE_INPUT_CREATED) -> VRM_IMP_OBJECT_INT_STATE_CREATED 


!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_IMP_OBJECT_0x50001: VRM_IMP_OBJECT_INT_STATE_IMPORT_STARTED -> (VRM_IMP_OBJECT_STATE_INPUT_IMPORT_ENDING) -> VRM_IMP_OBJECT_INT_STATE_IMPORT_ENDING 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_IMP_OBJECT_0x50001: VRM_IMP_OBJECT_INT_STATE_IMPORT_ENDING -> (VRM_IMP_OBJECT_STATE_INPUT_IMPORT_ENDED) -> VRM_IMP_OBJECT_INT_STATE_IMPORT_ENDED 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_REPORT_REGISTERED -> (VRM_MONITOR_STATE_INPUT_IMPORT_FINISHED) -> VRM_MONITOR_INT_STATE_IMPORT_FINISHED 

// or when import fails
// 
// !MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_IMP_OBJECT_0xa0007: VRM_IMP_OBJECT_INT_STATE_IMPORT_STARTED -> (VRM_IMP_OBJECT_STATE_INPUT_FAILING) -> VRM_IMP_OBJECT_INT_STATE_FAILING 
// !MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_IMP_OBJECT_0xa0007: VRM_IMP_OBJECT_INT_STATE_FAILING -> (VRM_IMP_OBJECT_STATE_INPUT_FAILED) -> VRM_IMP_OBJECT_INT_STATE_FAILED 
// !ERROR  -CTM_SVR      		< P:MW T:VRM_SRV M:ctm_svr_vrm.c F:vrm_index_import_finished L:1568 > Error from VRM for object state (VRM_IMP_OBJECT_STATE_FAILED) - VRM object is destroyed 
// !ERROR  -MSM_MFS      		< P:MW T:VRM_SRV M:mfs_low.c F:(MFS_LOW_INTERNAL_GetMdiCurrentRecordPosition) L:1981 > Import is not completed for shrecId=0x44b, Status=8, Type=2 


!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_IMPORT_FINISHED -> (VRM_MONITOR_STATE_INPUT_EVALUATE_OBSERVATION_WINDOW) -> VRM_MONITOR_INT_STATE_OBSERVATION_WINDOW_EVALUATED 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_OBSERVATION_WINDOW_EVALUATED -> (VRM_MONITOR_STATE_INPUT_EVALUATE_REPORT) -> VRM_MONITOR_INT_STATE_REPORT_EVALUATED 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_REPORT_EVALUATED -> (VRM_MONITOR_STATE_INPUT_PLAYABLE) -> `VRM_MONITOR_INT_STATE_PLAYABLE` 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_PLAYABLE -> (VRM_MONITOR_STATE_INPUT_STOPPING) -> VRM_MONITOR_INT_STATE_STOPPING 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_STOPPING -> (VRM_MONITOR_STATE_INPUT_STOPPED) -> VRM_MONITOR_INT_STATE_STOPPED 
!MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_STOPPED -> (VRM_MONITOR_STATE_INPUT_DESTROYED) -> VRM_MONITOR_INT_STATE_NULL 

// so ready to play
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:PooledExecutor#4:{"category": "PDLDOWNLOAD","action": "","title": "PDLDOWNLOAD took 21357ms","label": "isDPL:true,Title:Anna Scher: In Confidence,sizeKB:10985","currentscreen": "/tv/live/121"}
!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: 
  queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence" 
  `firstStatus:DOWNLOADING_BUT_NOT_AVAILABLE->DOWNLOADING_AND_AVAILABLE` firstFailureReason:100 firstIsDpl:true

// when not ready to play
// !MIL    -EPG_NET      		< p:0x000001e9 P:APP t:0x2e3a0520 T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > 
// T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"10 Things I Hate About You" firstStatus:PREPARING_DOWNLOAD->DOWNLOADING_BUT_NOT_AVAILABLE firstFailureReason:100 firstIsDpl:true


!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 1 (STARTED) to 5 (STOPPED) 
!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 5 (STOPPED) to 4 (COMMITED) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_JOB_STOPPED](0x63000080) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[UNKNOWN_CTM_STATUS](0x63000040) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_READY_TO_DOWNLOAD](0x63000001) 

!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: 
  queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence"->"Fish Town" 
  `firstStatus:DOWNLOADING_AND_AVAILABLE->SCHEDULED` firstFailureReason:100->0 firstIsDpl:true->false

!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 4 (COMMITED) to 1 (STARTED) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_JOB_STARTED](0x63000004) 

!MIL    -EPG_NET      		< P:APP T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: 
  queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence" 
  `firstStatus:PART_SCHEDULED->DOWNLOADING_AND_AVAILABLE` firstFailureReason:100 firstIsDpl:true

!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_2_DPL_DOWNLOAD_TOC 
!MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:474 > FTM Callback (Success) status called for job 0xca278008 step CTM_JOB_STEP_4_DPL_CATALOG_DL 
!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 1 (STARTED) to 5 (STOPPED) 
!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 5 (STOPPED) to 4 (COMMITED) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_JOB_STOPPED](0x63000080) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[UNKNOWN_CTM_STATUS](0x63000040) 

// note: this explans why there is no `COMPLETED` in this case
!MIL    -EPG_MISC     		< P:APP T:no name M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ColourButtonAction","action": "YELLOW_DELETE","title": "Colour Button to: YELLOW_DELETE","label": "","currentscreen": "Entering grid: //Planner/All"}
!MIL    -EPG_KEY      		< P:APP T:no name M:KeyEventValve F:open L:167 > T:CEE-J EventQueue Reader 0:Legacy activity has opened the KeyEventValve.
!MIL    -EPG_LIST     		< P:APP T:no name M:CommonBookedItem F:lockState L:952 > T:CEE-J EventQueue Reader 0:The state of this item is now locked to DELETING
!MIL    -EPG_KEY      		< P:APP T:no name M:Activity F:start L:45 > T:CEE-J EventQueue Reader 0:start activity (NamedActivity(DELETE_BOOKING)@5a7154d)
!MIL    -EPG_KEY      		< P:APP T:no name M:KeyEventValve F:activate L:145 > T:CEE-J EventQueue Reader 0:Added NamedActivity(DELETE_BOOKING)@5a7154d to live activities
!MIL    -EPG_BOOK     		< P:APP T:no name M:BookingAgent F:doRemoveBookedProgramme L:1517 > T:PooledExecutor#3:Removing booking with middleware removeBookedProgramme

!MIL    -EPG_NET      		< p:0x000001f6 P:APP t:0x2e134520 T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: 
  queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence"->"Fish Town" 
  `firstStatus:DOWNLOADING_AND_AVAILABLE->PREPARING_DOWNLOAD` firstFailureReason:100 firstIsDpl:true->false

!WARN   -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xca278008 (Type = 2) from 4 (COMMITED) to 5 (STOPPED) 
!MIL    -DLM_SVR      		< P:MW T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xCA278008] ; ctm_status=[CTM_STATUS_JOB_STOPPED](0x63000080) 

// note: actual downlod *comp-libcurl*
// !ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:cookie.c F:Curl_cookie_add L:257 > KIT: co = calloc(56) 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:libcurl_portage.c F:NDS_HTTP_strdup_DEBUG L:33 > (F: src/cookie.c, L: 444) Strdup: sky-pdl-client-credentials-a 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:libcurl_portage.c F:NDS_HTTP_strdup_DEBUG L:33 > (F: src/cookie.c, L: 445) Strdup: ip=91.234.201.1~expires=[2016:08:16 14:38:26]1471358306~access=/60448/bsky_skydisney/MOVIE/bsky_skydisney-MAIN000000[2016:08:31 03:38:46]0001258819-20150926[2018:12:28 15:13:20]1546010000.nff*~md5=84f19af32707950c1db4e742cdc1eb89 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:libcurl_portage.c F:NDS_HTTP_strdup_DEBUG L:33 > (F: src/cookie.c, L: 210) Strdup: 1800 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:libcurl_portage.c F:NDS_HTTP_strdup_DEBUG L:33 > (F: src/cookie.c, L: 210) Strdup: /60448/bsky_skydisney/MOVIE/bsky_skydisney-MAIN000000[2016:08:31 03:38:46]0001258819-20150926[2018:12:28 15:13:20]1546010000.nff 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:libcurl_portage.c F:NDS_HTTP_strdup_DEBUG L:33 > (F: src/cookie.c, L: 210) Strdup: cdn.sky.com 
// !ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:cookie.c F:Curl_cookie_add L:755 > KIT: Added cookie sky-pdl-client-credentials-a=\"ip=91.234.201.1~expires=[2016:08:16 14:38:26]1471358306~access=/60448/bsky_skydisney/MOVIE/bsky_skydisney-MAIN000000[2016:08:31 03:38:46]0001258819-20150926[2018:12:28 15:13:20]1546010000.nff*~md5=84f19af32707950c1db4e742cdc1eb89\" for domain cdn.sky.com, path /60448/bsky_skydisney/MOVIE/bsky_skydisney-MAIN000000[2016:08:31 03:38:46]0001258819-20150926[2018:12:28 15:13:20]1546010000.nff, " "expire %" "lld" "\n 
// !ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:cookie.c F:Curl_cookie_add L:760 > KIT: replace_old is null. make it last? 
// !INFO   -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:http_api.c F:debugFunction L:224 > HTTP 0 HEADER IN: Set-Cookie: sky-pdl-client-credentials-a=ip=91.234.201.1~expires=[2016:08:16 14:38:26]1471358306~access=/60448/bsky_skydisney/MOVIE/bsky_skydisney-MAIN000000[2016:08:31 03:38:46]0001258819-20150926[2018:12:28 15:13:20]1546010000.nff*~md5=84f19af32707950c1db4e742cdc1eb89;Max-Age=1800;Path=/60448/bsky_skydisney/MOVIE/b 
// !ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:http.c F:Curl_http_readwrite_headers L:3791 > KIT: from Curl_client_write(): result = 0 
// !ERROR  -LIBCURL < P:MW T:CTM_SVR_DL_CONTENT M:http.c F:Curl_http_readwrite_headers L:3711 > KIT: call Curl_cookie_add() 

// `COMPLETED`
!WARN   -CTM_SVR < P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xbcc78005 (Type = 0) from 1 (STARTED) to 0 (COMPLETED)


// stopped due to disk full
!MIL    -DLM_SVR      		< p:0x0000020e P:MW t:0x01f21520 T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > 
  ctm_job=[0x1E07809D] ; ctm_status=[CTM_STATUS_STOPPED_BY_DISK_CONFLICT](0x63002000) 


<pdl-download-next>
117797:NDS: ^[2017:12:02 12:10:45]0946725496.338424 !MIL    -EPG_ME       		< p:0x00000203 P:APP t:0x2c148520 T:no name M:DownloadNext$8 F:success L:609 > T:PooledExecutor#0:DOWNLOADNEXT: Set next episode = locator:3:11:2909E720:0


<pdl-status> <pdl-faulure-type> pdlAvailable
!MIL    -OIGC         		< M:dns_resolver.c F:DNS_RESOLVER_ResolvAddr L:847 > Using the cached value: 176.255.205.145 
!MIL    -EPG_NET      		< M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 50ms: pdlAvailable=true
!MIL    -EPG_NET      		< M:PdlServiceProbe F:setPdlServerAvailable L:137 > T:PdlServiceMonitor#0:Notifying service monitor: pdlAvailable=true
!MIL    -EPG_NET      		< M:PdlServiceMonitor$1 F:run L:183 > T:CEE-J EventQueue Reader 0:PDL downloadqueue 42 failureType=48

!ERROR  -EPG_NET      		< M:ErrorLoggingConsumer F:failure L:24 > T:pool-1-thread-1:Failed fetching from [http://epgservices.sky.com/downloadnext/4101/5/branding/Nick%20Jr.%20HD/programme/8d09cf5a-702b-4818-88dd-3111ec74b129]
!ERROR  -EPG_NET      		< M:ErrorLoggingConsumer F:failure L:24 > bmd: server at http://epgservices.sky.com/downloadnext/4101/5/branding/Nick%20Jr.%20HD/programme/8d09cf5a-702b-4818-88dd-3111ec74b129 didn't respond within timeout of 3000ms
!ERROR  -EPG_NET      		< M:ErrorLoggingConsumer F:failure L:24 > 	at picasso.utils.io.AsyncHttpFetcher$FetchTask.timeoutException (Unknown Source, bco=83)
!MIL    -EPG_NET      		< M:PdlServiceProbe F:isPdlAvailable L:110 > T:PdlServiceMonitor#0:Probed PDL server in 3513ms: pdlAvailable=false


<failed-case>
!MIL    -EPG_TVVM     		< M:ServiceInfo F:doProgrammeChanged L:1341 > T:PooledExecutor#4:PICASSODEV-19255 ServiceInfo.doProgrammeChanged Programme Matches current event in Banner: Fish Town
!MIL    -EPG_TVG      		< M:StartAgainTask$2$1$1 F:success L:180 > T:CEE-J EventQueue Reader 0: Got asset = Fish Town channel = Sky Atlantic HD m/f = false hd = true ppv = false
!MIL    -EPG_TVG      		< M:StartAgainTask$2$1$1 F:success L:180 > T:CEE-J EventQueue Reader 0: Got asset = Fish Town channel = Sky Atlantic m/f = false hd = false ppv = false
!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "StartAgain","action": "Download","title": "Fish Town","label": "Title:Fish Town;State:NOT_BOOKED;Type:Ents","currentscreen": "/tv/live/108/start_again_mini_banner"}

!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town" 
  firstStatus:SCHEDULED->PREPARING_DOWNLOAD firstFailureReason:0->100 firstIsDpl:false

!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town" 
  firstStatus:PREPARING_DOWNLOAD->FAILED firstFailureReason:100->53 firstIsDpl:false

!WARN   -CTM_SVR T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xff078009 (Type = 0) from 7 (`NETWORK_ERROR`) to 5 (STOPPED) 
!WARN   -CTM_SVR T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_Change_State L:7022 > Transition : CTM job 0xff078009 (Type = 0) from 5 (STOPPED) to 2 (FAILED) 
!MIL    -DLM_SVR T:DLM_HANDLEEVENTS M:dlm_mqp_server.c F:DLM_SVR_Dispatch_ctm_Status L:3803 > ctm_job=[0xFF078009] ; ctm_status=[`CTM_STATUS_JOB_FAILED`](0x63000010) 

!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town"->"Anna Scher: In Confidence" 
  `firstStatus:FAILED`->PART_SCHEDULED firstFailureReason:`53`->100 firstIsDpl:false->true

// 294455:NDS: ^[2016:09:26 06:13:01]0946792120.586161 !MIL    -EPG_NET      		< p:0x000001f6 P:APP t:0x2e134520 T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Anna Scher: In Confidence"->"Fish Town" firstStatus:DOWNLOADING_AND_AVAILABLE->PREPARING_DOWNLOAD firstFailureReason:100 firstIsDpl:true->false

!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town" 
  firstStatus:PREPARING_DOWNLOAD->DOWNLOADING_BUT_NOT_AVAILABLE firstFailureReason:100 firstIsDpl:false

!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:PooledExecutor#2:{"category": "PDLDOWNLOAD","action": "","title": "PDLDOWNLOAD took 14187ms","label": "isDPL:false,Title:Fish Town,sizeKB:10080","currentscreen": "/homepage"}

!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town" 
  firstStatus:DOWNLOADING_BUT_NOT_AVAILABLE->DOWNLOADING_AND_AVAILABLE firstFailureReason:100 firstIsDpl:false

!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "ScreenChange","changed to": "/playback/pdl/Fish Town/banner"}
!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "PDL_DOWNLOAD","title": "PlayingStatus changed to: PDL_DOWNLOAD","label": "","currentscreen": "/playback/pdl/Fish Town/banner"}


<pdl-download-drm-pov> see times and ok case

<check-drm-version>
!MIL    -DRM_Manager  		< p:0x000001ed P:CA t:0x00937530 T:IPC_WRAPPER_THREAD M:vgdrmlib.c F:NDS_DrmVerInit L:157 > 
!DRM_MIL_API! Drm Agent what Version is:@(#)STB DRM Agent: 0x03.4 DrmDebug rev:13146/N/"BS"@DRMAgent/code/trunk build time:May  3 2017 12:36:27 

== ^[2017:08:07 `15:04:58`]0946686044.984105 !MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > 
  VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_NULL -> (VRM_MONITOR_STATE_INPUT_CREATED) -> VRM_MONITOR_INT_STATE_CREATED 
== ^[2017:08:07 15:04:58]0946686044.984331 !MIL    -VRM_SERVER   		< P:MW T:VRM_SRV M:fsm.c F:FSMRun L:917 > 
  VRM-FSM: VRM_MONITOR_0x2000001: VRM_MONITOR_INT_STATE_CREATED -> (VRM_MONITOR_STATE_INPUT_STARTING) -> VRM_MONITOR_INT_STATE_STARTING 

!MIL    -DRM_Manager  		< P:CA t:0x00a041d0 T:no name M:agentapi.c F:NDS_CreateSessionObject L:1666 > !DRM_MIL_API! handle=8 created Session Object
!MIL    -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:drmc_rp.c F:DRMC_RP_BackChannel_CreateObject L:349 > !VGC_DRM_MIL_API! handle=[2082:08:31 20:04:23]3000000009, linked to T17 handle=[2082:08:31 20:04:24]3000000010, status: 0xac05000
!MIL    -EPG_NET      		< P:APP t:0x2bc2a520 T:no name M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Jack Reacher: Never Go Back" firstStatus:SCHEDULED->PREPARING_DOWNLOAD firstFailureReason:0->100 firstIsDpl:true
!MIL    -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:drmc_rp.c F:DRMC_RP_BackChannel_EstablishCommunicationSession L:984 > !VGC_DRM_MIL_API! handle=[2082:08:31 20:04:23]3000000009, session descriptor tag=1
!WARN   -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:ipc_module_client.c F:NDS_SetConnectionProperties L:2428 > null target - this can be valid, ipc_handle -[2011:01:14 01:08:06]1294967286, valid_obj_handle -[2011:01:14 01:08:06]1294967286
!MIL    -DRM_Manager  		< P:CA t:0x00a041d0 T:no name M:agentapi.c F:NDS_SetConnectionProperties L:2451 > !DRM_MIL_API! handle=8, input properties: type :4 - "PRIVATE_CONNECTION_TYPE" ( adm.sky.com:80/ )
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:ProcessEV_ClientRequestRaised L:6432 > !DSAM_MIL_SAC! Cancelling Startup Delay (if set) due to Client request
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:CancelStartupDelayIfSet L:3152 > !DSAM_MIL_SAC! Cancelling Startup Delay
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:RemoveBlocks L:2944 > Removed Blocks 0x02 [Str ]. New Blocks:0x00 []
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:ProcessEV_ClientRequestRaised L:6459 > !DSAM_MIL_SAC! Client Request - Trying again to create SAC if possible
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:ConnectToServer L:3402 > !DSAM_MIL_SAC! Calling NDS_ConnectToServer (handle=4)
!MIL    -DRM_Manager  		< P:CA t:0x00a4e530 T:DSAM M:agentapi.c F:NDS_ConnectToServer L:2005 > !DRM_MIL_API! handle=4, connection_type 1 ("DEFAULT_CONNECTION_TYPE")
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:time_server.c F:DetectFirstValidDeviceTime L:1379 > !DRM_MIL_TIME! device time was not valid on boot and is now valid (0xA55068:59 [15:04:59 07/08/2017]). Calling TIME_SERVER_MSG_ID_HANDLE_DEVICE_TIME_
!MIL    -DRM_Manager  		< P:CA t:0x009c9ab0 T:no name M:time_server.c F:HandleFirstValidDeviceTime L:929 > !DRM_MIL_TIME! device time calculated from LKT is 0xA55032:19 [14:10:19 07/08/2017], Current device time is 0xA55068:59 [15:04:59 07/08/2017] - secure time was adjusted t
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:sac_usage.c F:SacUsageProcess L:957 > !DRM_MIL_SAC! Starting SAC creation, session 4, user id: 04-2[2081:08:18 06:50:13]2967293159EA256-5B0A8D1EE36BBBFA
!WARN   -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:SetSessionStatusFlags L:5885 > Setting session status to final 0 status is unhealthy!
!WARN   -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:SetSessionStatusFlags L:5885 > Setting session status to final 0 status is unhealthy!
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:sac_usage.c F:OpenSac2 L:2290 > !DRM_MIL_SAC! Starting SAC2 creation, session 4, user id: 04-2[2081:08:18 06:50:13]2967293159EA256-5B0A8D1EE36BBBFA
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:DSAM_Activation_UpdateSACStatus L:2691 > !DSAM_MIL_SAC! Notifying: VGC_DSAM_ACTIVATION_NOTIFY_TYPE_SAC status=2 [VGC_DSAM_SAC_STATUS_IN_PROGRESS], sac error=0x00, ext. error=0x00
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:ProcessEV_IsConnectionAllowed L:6409 > !DSAM_MIL_REQ! URL connection for type [4] Non Default is  ALLOWED 0 [DSAM_CONNECTION_ALLOWED]
!MIL    -DRM_Manager  		< P:CA t:0x009c9ab0 T:no name M:time_server.c F:HandleFirstValidDeviceTime L:942 > !DRM_MIL_TIME! secure minutes has changed, sending 'SECURE_TIME_UPDATED_SIGNAL'
!WARN   -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:httputils.c F:HTTP_UTILS_GetHeader L:272 > Missing header < drms-version > - not all headers are expected in all requests.
!WARN   -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:httputils.c F:HTTP_UTILS_GetHeader L:272 > Missing header < drms-version > - not all headers are expected in all requests.
!MIL    -DRM_Manager  		< P:CA t:0x009c9ab0 T:no name M:time_server.c F:SetSecureTime L:851 > !DRM_MIL_TIME! saving the time received from the H/E in LKT: secure_time 0xA55069:0 [15:05:00 07/08/2017], device_time 0xA55068:59 [15:04:59 07/08/2017], minutes delta 4294967295
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:MDL_DrmAgentSignal L:729 > !DRM_MIL_SAC! SAC_MIL Sac2 is open on session 4! ("SAC2_READY_SIGNAL" was received)
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:NotifySession L:6219 > !DRM_MIL_API! handle=4 - notification was successfully called with status 0x00000001, extended status 0
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:StartMinRetryInterval L:3067 > !DSAM_MIL_TIMER! Minimum retry interval timer handle=2 ACTIVATED - 60000 ms
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:HandleSacSessionSuccess L:4944 > !DSAM_MIL_SAC! SAC UP
!MIL    -DSAM         		< P:CA t:0x00a4e530 T:DSAM M:dsam_ctrl.c F:DSAM_Activation_UpdateSACStatus L:2691 > !DSAM_MIL_SAC! Notifying: VGC_DSAM_ACTIVATION_NOTIFY_TYPE_SAC status=0 [VGC_DSAM_SAC_STATUS_OK], sac error=0x01, ext. error=0x00
!MIL    -DRM_Manager  		< P:CA t:0x00a041d0 T:no name M:agentapi.c F:NDS_ConnectToServer L:2005 > !DRM_MIL_API! handle=8, connection_type 4 ("PRIVATE_CONNECTION_TYPE")
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:MDL_DrmAgentSignal L:729 > !DRM_MIL_SAC! SAC_MIL Sac2 is open on session 8! ("SAC2_READY_SIGNAL" was received)
!MIL    -DRM_Manager  		< P:CA t:0x009fbeb0 T:no name M:agentapi.c F:NotifySession L:6219 > !DRM_MIL_API! handle=8 - notification was successfully called with status 0x00000001, extended status 0
!MIL    -DRM_Manager  		< P:MW t:0x0213ec20 T:no name M:drmc_rp.c F:DrmcRpContextCallback L:1984 > !VGC_DRM_MIL! handle=[2082:08:31 20:04:23]3000000009 notifying on the session, status flags=0x1, extended status=0 
!MIL    -DRM_Manager  		< P:CA t:0x009c9ab0 T:no name M:time_server.c F:SetSecureTime L:857 > !DRM_MIL_TIME! secure minutes has changed, sending 'SECURE_TIME_UPDATED_SIGNAL'
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:drm_info.c F:DrmInfoGet L:476 > Tag "DRM_NV_DESC_PROVISIONING_SLOT_0_TAG"=0x8000112 was not found in primary or secondary storage
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:drm_info.c F:DrmInfoGet L:476 > Tag "DRM_NV_DESC_PROVISIONING_SLOT_1_TAG"=0x8000113 was not found in primary or secondary storage
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_obj_module.c F:GetSdll L:1980 > Security Object not found, sec_obj_type 0xc4 ("DOMAIN_PROVISIONING_SECURITY_OBJECT"), OK on Boot after a while, problem otherwise
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:domain_mngr.c F:LoadDomainSO L:1950 > Security Object not found, sec_obj_type 0xc4 ("DOMAIN_PROVISIONING_SECURITY_OBJECT"), OK on Boot after a while, problem otherwise
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10034
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10025
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:274 > minimal_retry_timeout is zero (H/E issue). override with 2 (sec obj type "VIEWING_SECURITY_OBJECT")
!MIL    -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:secobj_common.c F:SECOBJ_COMMON_PrintSdllServerVersion L:148 > !DRM_MIL_ID! SDLL created in SDLLG version @(#)SDLLG version SDLLG_Server_main 0.3.0-27-SNAPSHOT @2390  Jan 25 2017 15:31:29 CI: Enabled
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10501
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:drm_info.c F:DrmInfoGet L:476 > Tag "DRM_NV_DESC_VIEWING_SLOT_1_TAG"=0x8000117 was not found in primary or secondary storage
!WARN   -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:httputils.c F:HTTP_UTILS_GetHeader L:272 > Missing header < nds-padding > - not all headers are expected in all requests.
!WARN   -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:httputils.c F:HTTP_UTILS_GetHeader L:272 > Missing header < nds-padding-data > - not all headers are expected in all requests.
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10034
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10025
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:274 > minimal_retry_timeout is zero (H/E issue). override with 2 (sec obj type "VIEWING_SECURITY_OBJECT")
!MIL    -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:secobj_common.c F:SECOBJ_COMMON_PrintSdllServerVersion L:148 > !DRM_MIL_ID! SDLL created in SDLLG version @(#)SDLLG version SDLLG_Server_main 0.3.0-27-SNAPSHOT @2390  Jan 25 2017 15:31:29 CI: Enabled
!WARN   -DRM_Manager  		< P:CA t:0x00a29150 T:no name M:sec_parser_emb.c F:SEC_PARSER_EMB_ParseSecObj L:718 > ignoring unknown descriptor tag 0x10501
!MIL    -DRM_Manager  		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:drmc_rp.c F:DRMC_RP_BackChannel_DestroyObject L:375 > !VGC_DRM_MIL_API! handle=[2082:08:31 20:04:23]3000000009, enter
!MIL    -DRM_Manager  		< P:CA t:0x00a041d0 T:no name M:agentapi.c F:NDS_DestroySessionObject L:1678 > !DRM_MIL_API! handle=8 Destroy Session Object
!WARN   -CTM_SVR      		< P:MW t:0x021f0520 T:CTM_SVR_DL_CONTENT M:ctm_svr_file_transfer_manager.c F:CTM_SVR_Handle_HTTP_Error L:4949 > This is a non retryable error 

== ^[2017:08:07 15:04:59]0946686045.758739 !MIL    -CTM_SVR      		< P:MW T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:519 > 
  FTM Callback (Success) status called for job 0x34e78029 step CTM_JOB_STEP_1_DPL_DOWNLOAD_RESPONSE 

== ^[2017:08:07 `15:05:01`]0946686047.567800 !MIL    -CTM_SVR      		< p:0x00000201 P:MW t:0x02214520 T:CTM_SVR_HANDLEREQUESTS M:ctm_svr_job_manager.c F:CTM_SVR_HandleFTMReturnedSuccess L:519 > 
  FTM Callback (Success) status called for job 0x34e78029 step CTM_JOB_STEP_2_DPL_DOWNLOAD_TOC 

  
<playback-asset-name> <pdl-asset-name>
!MIL    -EPG_ME       		< M:SpcPortOutput F:write L:24 > 220SSCN019On Demand TVSSCA012All 4SSDT025 6.59pm Fri 10 MarSSN0016Peep ShowSSE0128Simon, Dobby's ex-boyfriend, invites Mark, Dobby, Jeremy and Super Hans to join him for a paintballing weekend. (S8, Ep3)SSEI015Playback4c

!MIL    -EPG_ME       		< M:DownloadNext F:isDownloadNextAllowedFor L:219 > T:CEE-J EventQueue Reader 0:DOWNLOADNEXT: item = Fish Town candidate for `DN = true`

!MIL    -EPG_PLAY     		< M:AutoPlayMilestoneControl F:sessionStarted L:94 > T:PooledExecutor#4:AutoPlay - current playing Fish Town
!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "PlayingStatus","action": "PDL_DOWNLOAD","title": "PlayingStatus changed to: PDL_DOWNLOAD","label": "","currentscreen": "/playback/pdl/Fish Town/banner"}
!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": "KeyPressRemote","action": "TVGUIDE","title": "Key Press TVGUIDE","label": "","currentscreen": "/playback/pdl/Fish Town"}
!MIL    -EPG_MISC     		< M:MilestoneNotifier F:send L:21 > T:CEE-J EventQueue Reader 0:{"category": 
  "AssetAction","action": "RECORD","title": "CancellableViewablePdlItem","label": "Title=Fish Town;State=DOWNLOADING_AND_AVAILABLE;templatename=CancellableViewablePdlItem","currentscreen": "Entering grid: //Planner/\
!MIL    -EPG_NET      		< M:DownloadQueueMonitor$9 F:onDownloadQueueUpdate L:251 > 
  T:DownloadQueueMonitor#0:Download queue changed: queueStatus:41 queueFailureType:100 firstPbp:"Fish Town"->null firstStatus:DOWNLOADING_AND_AVAILABLE->UNKNOWN firstFailureReason:100 firstIsDpl:false

<serviceinfo>
!MIL    -EPG_TVVM     		< M:ServiceInfo F:doProgrammeChanged L:1284 > T:PooledExecutor#3:PICASSODEV-19255 doProgrammeChanged gpi Fish Town start time: 26/09/2016 06:00:00
!MIL    -EPG_TVVM     		< M:ServiceInfo F:doProgrammeChanged L:1341 > T:PooledExecutor#3:PICASSODEV-19255 ServiceInfo.doProgrammeChanged Programme Matches current event in Banner: Fish Town


<http-status>
egrep -an "GET http" LOGlastrun_realtime |

!MIL    -EPG_NET      		< F:retrieveImageSynchronously L:98 > T:DynamicHomePage#0:GET http://feedr.search.sky.com/feedr/images/183/116/5851174ae4b01f8c4512ebbf returned HTTP status 200


!MIL    -EPG_NET      		< M:AsyncHttpFetcher$FetchTask F:run L:96 > T:DownloadNext#0:GET 
http://epgservices.sky.com/downloadnext/4101/5/branding/CBeebies%20HD/programme/38809554-9c9a-4d08-974b-b792fabfa8b1 returned HTTP status 200

{
  "seasonNumber": 2,
  "uuid": "38809554-9c9a-4d08-974b-b792fabfa8b1",
  "downloadNextable": true,
  "nextItem": {
    "seasonNumber": 2,
    "uuid": "c338c1b6-d0df-4cda-b049-d623e7d49763",
    "episodeNumber": 23,
    "sd": {
      "programmeId": "3787043",
      "pushedProgrammeId": null,
      "providerId": "bbc.co.uk"
    },
    "title": "Subway",
    "hd": {
      "programmeId": "3787044",
      "pushedProgrammeId": null,
      "providerId": "bbc.co.uk"
    },
    "lastInSeason": false
  },
  "episodeNumber": 22,
  "title": "Thunder",
  "lastInSeason": false
}


!MIL    -EPG_NET                    < M:AsyncHttpFetcher$FetchTask F:run L:96 > T:DynamicHomePage#0:GET http://prdserapi.skycdc.com/feedr/landing/day/v1/stbb/4101/5 returned HTTP status 200

{"hst":"http://feedr.search.sky.com/feedr/images/264/116/","pol":86400000,"stl":86400000,"tls":
[
[{"srt":1459951200,"end":32503680000,"lbl":"TV Guide","syn":"Browse all the channels and see what’s on over the next seven days.","img":"54f589b1e4b06109e32abdf1"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"5852740ae4b00e1474f25e14"},{"srt":1482451260,"end":1482505200,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"584e66c7e4b01f8c4512e96f"},{"srt":1482505200,"end":1482519600,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"56654efde4b0a45e499fce71"},{"srt":1482519600,"end":1482526800,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"5596701de4b03d646434a0ad"},{"srt":1482526800,"end":1482537660,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"58527036e4b00e1474f25dd5"},{"srt":1482537660,"end":1482570000,"lbl":"Sky Box Sets","syn":"Watch entire series of the latest and greatest shows whenever you want.","img":"56583e13e4b07701a72c5bc0"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"5857c80de4b00e1474f25fca"},{"srt":1482451260,"end":1482505200,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"55114057e4b0778f2f37f4ce"},{"srt":1482505200,"end":1482519600,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"55114057e4b0778f2f37f4ce"},{"srt":1482519600,"end":1482526800,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"5739d5dbe4b0a45e499ff3e9"},{"srt":1482526800,"end":1482537660,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"5739d5dbe4b0a45e499ff3e9"},{"srt":1482537660,"end":1482570000,"lbl":"Sky Cinema","syn":"From the latest premieres to all time classic films, enjoy over 1000 movies on demand with Sky Cinema.","img":"55f2bcf8e4b03d646434acea"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"5859673be4b00e1474f26089"},{"srt":1482451260,"end":1482483600,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"558c14a2e4b03d6464349f9f"},{"srt":1482483600,"end":1482505200,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"5859673be4b00e1474f26089"},{"srt":1482505200,"end":1482519600,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"584ab30ae4b0d779afb3d46f"},{"srt":1482519600,"end":1482526800,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"584ab30ae4b0d779afb3d46f"},{"srt":1482526800,"end":1482537660,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"584ab30ae4b0d779afb3d46f"},{"srt":1482537660,"end":1482570000,"lbl":"Kids","syn":"Watch a wide range of kids shows from the top channels.","img":"558c1413e4b0fe2d6bf1d7ef"}],
[{"srt":1459951200,"end":32503680000,"lbl":"Planner","syn":"Find all the TV shows and movies you’ve recorded or downloaded.","img":"54f072cee4b069b604fd3b86"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"},{"srt":1482451260,"end":1482505200,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"},{"srt":1482505200,"end":1482519600,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"},{"srt":1482519600,"end":1482526800,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"},{"srt":1482526800,"end":1482537660,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"},{"srt":1482537660,"end":1482570000,"lbl":"Catch Up TV","syn":"Catch up on shows you’ve missed from up to the last 30 days.","img":"5859133be4b01f8c4512ef27"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"},{"srt":1482451260,"end":1482505200,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"},{"srt":1482505200,"end":1482519600,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"},{"srt":1482519600,"end":1482526800,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"},{"srt":1482526800,"end":1482537660,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"},{"srt":1482537660,"end":1482570000,"lbl":"Sports","syn":"Browse all the sports channels and see what live sports are currently on.","img":"58590a89e4b00e1474f26043"}],
[{"srt":1482444000,"end":1482451260,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58569775e4b00e1474f25f4b"},{"srt":1482451260,"end":1482505200,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58502ceee4b01f8c4512eb5b"},{"srt":1482505200,"end":1482512400,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58502ceee4b01f8c4512eb5b"},{"srt":1482512400,"end":1482516000,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"5852b924e4b01f8c4512ed66"},{"srt":1482516000,"end":1482519600,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58569775e4b00e1474f25f4b"},{"srt":1482519600,"end":1482526800,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58569775e4b00e1474f25f4b"},{"srt":1482526800,"end":1482537660,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"58387f51e4b01f8c4512e084"},{"srt":1482537660,"end":1482570000,"lbl":"Sky Store","syn":"Find a wide choice of movies to rent or buy, from blockbusters to classics.","img":"584a8ec7e4b0d779afb3d42b"}]
]
}

<asset-not-avalible> ?
!WARN   -ATG_API      		< T:PLANNER_MAIN M:atg_api_object_oigc.c F:ATG_VODCL_Object_CreateStringPropertyUsingKey L:6285 > OIGC indicates property not available 

<green-key>
Cancel ?


<comp-pdl-sac>
NDS: ^[2017:12:03 21:39:44]0946846035.332149 !WARN   -HTTP         		< p:0x00000201 P:MW t:0x02373520 T:HTTP_ASYNC_Encoding_0 M:http_sac.c F:HTTP_SAC_ProcessDecryption L:475 > Received 500 from SGW when send message over SAC. Report as SERVER_BUSY. 

NDS: ^[2017:12:03 21:39:44]0946846035.453979 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > T:est3#0:Failed fetching from [http://localhost:8080/cmdc/content/programid%3A%2F%2F4290669899~programid%3A%2F%2F4290669899/offers?count=2&lang=eng&clientId=00C6A6971655F2B5%7E00C6A697_0%7E00C6A697&filter=purchasable%7Etrue%2Centitled%7Etrue&sort=expiryD\
NDS: ^[2017:12:03 21:39:44]0946846035.454014 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > ateTime&marketingTarget=1&logicOperand=FAF5FFC1%7E1FFA0000]
NDS: ^[2017:12:03 21:39:44]0946846035.454034 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > bvO: 
NDS: ^[2017:12:03 21:39:44]0946846035.454055 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > 	at picasso.utils.io.AsyncHttpFetcher$FetchTask.run (Unknown Source, bco=82)
NDS: ^[2017:12:03 21:39:44]0946846035.454075 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > 	at picasso.utils.concurrent.task.RunnableWrapper.call (Unknown Source, bco=4)
NDS: ^[2017:12:03 21:39:44]0946846035.454095 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > 	at picasso.utils.concurrent.task.Task.run (Unknown Source, bco=40)
NDS: ^[2017:12:03 21:39:44]0946846035.454113 !ERROR  -EPG_NET      		< p:0x00000203 P:APP t:0x2ed4f520 T:no name M:ErrorLoggingConsumer F:failure L:18 > 	at picasso.utils.concurrent.task.ThreadPoolExecutor$WorkerThread.run (Unknown Source, bco=71)

can cause *dialog-1371*


={============================================================================
|kt_dev_si_0001| comp-update

UCM-10619

!MIL    -VGV                       < p:0x000001e3 P:CA t:0x0095cb90 T:no name M:AMS_BCM_MIPS4K_LNUX_DARWIN_01/BigEndian/release_ F:SWDOWNLD L:162 > 
NDS. X_InstructSwDownload called, new version 0xd2a, download_type 0x0 user_acceptance 0x0, switch_condition 0x0, high_priority 0x1 sw_component_id 0x31 sw_component_provider_id 0x4f

    SYSTEMJOB_TYPE_SW_UPDATE_SCAN,     /*!<@brief sw download scan job  */
    SYSTEMJOB_TYPE_DOWNLOAD_RESET_JOB, /*!<@brief sw download reset job */

SYSINIT_API_ActivityStateRequestRestart

DARWIN_PLATFORM/DARWIN_SPM/src/server/dvb/software_update/spm_sum.c:1498:    DIAG_LOG_INFO(SUM_Segment, ("SPM requests reboot SYSINIT_API_ActivityStateRequestRestart"));
DARWIN_PLATFORM/DARWIN_SPM/src/server/dvb/software_update/spm_sum.c:1511:    (void)SYSINIT_API_SetActivityStateForced(SPM_Comp_handle, SYSINIT_API_ActivityStateRequestRestart, f_spmConfigPtr->forced_shutdown_time);
DARWIN_PLATFORM/DARWIN_SPM/src/server/emm_swdl/spm_server_software.c:75:            (void)SYSINIT_API_SetActivityStateForced(SPM_Comp_handle, SYSINIT_API_ActivityStateRequestRestart, SPM_COMMON_GetConfig()->forced_shutdown_time);
DARWIN_PLATFORM/DARWIN_SPM/src/server/emm_swdl/spm_server_software.c:125:                (void)SYSINIT_API_SetActivityStateForced(SPM_Comp_handle, SYSINIT_API_ActivityStateRequestRestart, SPM_COMMON_GetConfig()->forced_shutdown_time);
DARWIN_PLATFORM/DARWIN_SPM/src/server/emm_swdl/spm_switch_condition.c:453:    (void)SYSINIT_API_SetActivityStateForced(SPM_Comp_handle, SYSINIT_API_ActivityStateRequestRestart, SPM_COMMON_GetConfig()->forced_shutdown_time);

<passive-standby>
SYSINIT_API_ActivityStatePassiveStandby
DARWIN_PLATFORM/DARWIN_SPM/src/server/spm_system/spm_standby.c
/**
 * @brief WP2481.1: handle all sysinit calls related to passive standby. Set Sysinit exception, devices deferred standby state and request passive standby activity
 * @param[in] defaultStandbyMode Default Standby Power State setting from PREFS
 * @param[out] defaultStandbyMode SPM_API_STATUS_OK if all sysinit settings suceeded, SPM_API_STATUS_ERROR otherwise
 */
static SYSTEM_STATUS SPM_Standby_ConfigureSysInitForPassiveStandby(uint32_t defaultStandbyMode)

  newstate = SYSINIT_API_ActivityStateRequestShutdown;
  if(SYSINIT_STATUS_OK != SYSINIT_API_SetActivityStateForced( SPM_GetComponentSysinitHandle(), newstate, );


=}============================================================================
Copyright: see |ktkb|                              vim:tw=100:ts=3:ft=help:norl:
